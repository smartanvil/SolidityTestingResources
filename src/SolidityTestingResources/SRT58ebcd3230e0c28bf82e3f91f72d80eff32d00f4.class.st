Class {
	#name : #SRT58ebcd3230e0c28bf82e3f91f72d80eff32d00f4,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT58ebcd3230e0c28bf82e3f91f72d80eff32d00f4 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7Ci8qKgogKiBAdGl0bGUgRVJDMjBCYXNpYwogKiBAZGV2IFNpbXBsZXIgdmVyc2lvbiBvZiBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE3OQogKi8KY29udHJhY3QgRVJDMjBCYXNpYyB7CiAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSByZXR1cm5zIChib29sKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKfQovKioKICogQHRpdGxlIE1hdGgKICogQGRldiBBc3NvcnRlZCBtYXRoIG9wZXJhdGlvbnMKICovCmNvbnRyYWN0IE1hdGggewogIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQogIGZ1bmN0aW9uIG1pbjY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICB9CiAgZnVuY3Rpb24gbWF4MjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQogIGZ1bmN0aW9uIG1pbjI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQp9Ci8qKgogKiBAdGl0bGUgT3duYWJsZQogKiBAZGV2IFRoZSBPd25hYmxlIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgYXV0aG9yaXphdGlvbiBjb250cm9sCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICAvKioKICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgKiBhY2NvdW50LgogICAqLwogIGZ1bmN0aW9uIE93bmFibGUoKSB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgKi8KICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciB7CiAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgb3duZXIgPSBuZXdPd25lcjsKICB9Cn0KLyoqCiAqIEB0aXRsZSBTYWZlTWF0aAogKiBAZGV2IE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MgdGhhdCB0aHJvdyBvbiBlcnJvcgogKi8KY29udHJhY3QgU2FmZU1hdGggewogIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSAqIGI7CiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CiAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQogIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQogIGZ1bmN0aW9uIG1pbjY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICB9CiAgZnVuY3Rpb24gbWF4MjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQogIGZ1bmN0aW9uIG1pbjI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQp9Ci8qKgogKiBAdGl0bGUgQmFzaWMgdG9rZW4KICogQGRldiBCYXNpYyB2ZXJzaW9uIG9mIFN0YW5kYXJkVG9rZW4sIHdpdGggbm8gYWxsb3dhbmNlcy4KICovCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgU2FmZU1hdGgsIEVSQzIwQmFzaWMgewogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKICAvKioKICAqIEBkZXYgdHJhbnNmZXIgdG9rZW4gZm9yIGEgc3BlY2lmaWVkIGFkZHJlc3MKICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8uCiAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJyZWQuCiAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHJldHVybnMgKGJvb2wpewogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBzdWIoYmFsYW5jZXNbbXNnLnNlbmRlcl0sX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBhZGQoYmFsYW5jZXNbX3RvXSxfdmFsdWUpOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQogIC8qKgogICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdG8gcXVlcnkgdGhlIHRoZSBiYWxhbmNlIG9mLgogICogQHJldHVybiBBbiB1aW50IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcy4KICAqLwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludCBiYWxhbmNlKSB7CiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICB9Cn0KLyoqCiAqIEB0aXRsZSBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqLwpjb250cmFjdCBFUkMyMCBpcyBFUkMyMEJhc2ljIHsKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSByZXR1cm5zIChib29sKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7Cn0KLyoqCiAqIEB0aXRsZSBTdGFuZGFyZCBFUkMyMCB0b2tlbgogKgogKiBAZGV2IEltcGxlbWVudGF0aW9uIG9mIHRoZSBiYXNpYyBzdGFuZGFyZCB0b2tlbi4KICogQGRldiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICogQGRldiBCYXNlZCBvbiBjb2RlIGJ5IEZpcnN0Qmxvb2Q6IGh0dHBzOi8vZ2l0aHViLmNvbS9GaXJzdGJsb29kaW8vdG9rZW4vYmxvYi9tYXN0ZXIvc21hcnRfY29udHJhY3QvRmlyc3RCbG9vZFRva2VuLnNvbAogKi8KY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBFUkMyMCwgQmFzaWNUb2tlbiB7CiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwogIC8qKgogICAqIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlcgogICAqIEBwYXJhbSBfZnJvbSBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20KICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gdHJhbnNmZXIgdG8KICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgdGhlIGFtb3V0IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcmVkCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCkgewogICAgdmFyIF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsKICAgIC8vIENoZWNrIGlzIG5vdCBuZWVkZWQgYmVjYXVzZSBzdWIoX2FsbG93YW5jZSwgX3ZhbHVlKSB3aWxsIGFscmVhZHkgdGhyb3cgaWYgdGhpcyBjb25kaXRpb24gaXMgbm90IG1ldAogICAgLy8gcmVxdWlyZSAoX3ZhbHVlIDw9IF9hbGxvd2FuY2UpOwogICAgYmFsYW5jZXNbX3RvXSA9IGFkZChiYWxhbmNlc1tfdG9dLF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfZnJvbV0gPSBzdWIoYmFsYW5jZXNbX2Zyb21dLF92YWx1ZSk7CiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IHN1YihfYWxsb3dhbmNlLF92YWx1ZSk7CiAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQogIC8qKgogICAqIEBkZXYgQXByb3ZlIHRoZSBwYXNzZWQgYWRkcmVzcyB0byBzcGVuZCB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiB0b2tlbnMgb24gYmVoYWxmIG9mIG1zZy5zZW5kZXIuCiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICovCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCkgewogICAgLy8gVG8gY2hhbmdlIHRoZSBhcHByb3ZlIGFtb3VudCB5b3UgZmlyc3QgaGF2ZSB0byByZWR1Y2UgdGhlIGFkZHJlc3Nlc2AKICAgIC8vICBhbGxvd2FuY2UgdG8gemVybyBieSBjYWxsaW5nIGBhcHByb3ZlKF9zcGVuZGVyLCAwKWAgaWYgaXQgaXMgbm90CiAgICAvLyAgYWxyZWFkeSAwIHRvIG1pdGlnYXRlIHRoZSByYWNlIGNvbmRpdGlvbiBkZXNjcmliZWQgaGVyZToKICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgcmVxdWlyZSgoX3ZhbHVlID09IDApIHx8IChhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9PSAwKSk7CiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF9zcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHJldHVybiBBIHVpbnQyNTYgc3BlY2lmaW5nIHRoZSBhbW91bnQgb2YgdG9rZW5zIHN0aWxsIGF2YWlsYWJsZSBmb3IgdGhlIHNwZW5kZXIuCiAgICovCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgfQp9Ci8qKgogKiBAdGl0bGUgTWludGFibGUgdG9rZW4KICogQGRldiBTaW1wbGUgRVJDMjAgVG9rZW4gZXhhbXBsZSwgd2l0aCBtaW50YWJsZSB0b2tlbiBjcmVhdGlvbgogKiBAZGV2IElzc3VlOiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9PcGVuWmVwcGVsaW4vemVwcGVsaW4tc29saWRpdHkvaXNzdWVzLzEyMAogKiBCYXNlZCBvbiBjb2RlIGJ5IFRva2VuTWFya2V0TmV0OiBodHRwczovL2dpdGh1Yi5jb20vVG9rZW5NYXJrZXROZXQvaWNvL2Jsb2IvbWFzdGVyL2NvbnRyYWN0cy9NaW50YWJsZVRva2VuLnNvbAogKi8KY29udHJhY3QgTWludGFibGVUb2tlbiBpcyBTdGFuZGFyZFRva2VuLCBPd25hYmxlIHsKICBldmVudCBNaW50KGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiBhbW91bnQpOwogIGV2ZW50IE1pbnRGaW5pc2hlZCgpOwogIGJvb2wgcHVibGljIG1pbnRpbmdGaW5pc2hlZCA9IGZhbHNlOwogIG1vZGlmaWVyIGNhbk1pbnQoKSB7CiAgICByZXF1aXJlKCFtaW50aW5nRmluaXNoZWQpOwogICAgXzsKICB9CiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBtaW50IHRva2VucwogICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHJlY2lldmUgdGhlIG1pbnRlZCB0b2tlbnMuCiAgICogQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gbWludC4KICAgKiBAcmV0dXJuIEEgYm9vbGVhbiB0aGF0IGluZGljYXRlcyBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLgogICAqLwogIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgb25seU93bmVyIGNhbk1pbnQgcmV0dXJucyAoYm9vbCkgewogICAgdG90YWxTdXBwbHkgPSBhZGQodG90YWxTdXBwbHksX2Ftb3VudCk7CiAgICBiYWxhbmNlc1tfdG9dID0gYWRkKGJhbGFuY2VzW190b10sX2Ftb3VudCk7CiAgICBNaW50KF90bywgX2Ftb3VudCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBzdG9wIG1pbnRpbmcgbmV3IHRva2Vucy4KICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bC4KICAgKi8KICBmdW5jdGlvbiBmaW5pc2hNaW50aW5nKCkgb25seU93bmVyIHJldHVybnMgKGJvb2wpIHsKICAgIG1pbnRpbmdGaW5pc2hlZCA9IHRydWU7CiAgICBNaW50RmluaXNoZWQoKTsKICAgIHJldHVybiB0cnVlOwogIH0KfQovKioKICogQHRpdGxlIFBhdXNhYmxlCiAqIEBkZXYgQmFzZSBjb250cmFjdCB3aGljaCBhbGxvd3MgY2hpbGRyZW4gdG8gaW1wbGVtZW50IGFuIGVtZXJnZW5jeSBzdG9wIG1lY2hhbmlzbS4KICovCmNvbnRyYWN0IFBhdXNhYmxlIGlzIE93bmFibGUgewogIGV2ZW50IFBhdXNlKCk7CiAgZXZlbnQgVW5wYXVzZSgpOwogIGJvb2wgcHVibGljIHBhdXNlZCA9IGZhbHNlOwogIC8qKgogICAqIEBkZXYgbW9kaWZpZXIgdG8gYWxsb3cgYWN0aW9ucyBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IElTIHBhdXNlZAogICAqLwogIG1vZGlmaWVyIHdoZW5Ob3RQYXVzZWQoKSB7CiAgICByZXF1aXJlKCFwYXVzZWQpOwogICAgXzsKICB9CiAgLyoqCiAgICogQGRldiBtb2RpZmllciB0byBhbGxvdyBhY3Rpb25zIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgSVMgTk9UIHBhdXNlZAogICAqLwogIG1vZGlmaWVyIHdoZW5QYXVzZWQoKSB7CiAgICByZXF1aXJlKHBhdXNlZCk7CiAgICBfOwogIH0KICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gcGF1c2UsIHRyaWdnZXJzIHN0b3BwZWQgc3RhdGUKICAgKi8KICBmdW5jdGlvbiBwYXVzZSgpIG9ubHlPd25lciB3aGVuTm90UGF1c2VkIHsKICAgIHBhdXNlZCA9IHRydWU7CiAgICBQYXVzZSgpOwogIH0KICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gdW5wYXVzZSwgcmV0dXJucyB0byBub3JtYWwgc3RhdGUKICAgKi8KICBmdW5jdGlvbiB1bnBhdXNlKCkgb25seU93bmVyIHdoZW5QYXVzZWQgewogICAgcGF1c2VkID0gZmFsc2U7CiAgICBVbnBhdXNlKCk7CiAgfQp9Ci8qKgogKiBQYXVzYWJsZSB0b2tlbgogKgogKiBTaW1wbGUgRVJDMjAgVG9rZW4gZXhhbXBsZSwgd2l0aCBwYXVzYWJsZSB0b2tlbiBjcmVhdGlvbgogKiovCmNvbnRyYWN0IFBhdXNhYmxlVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiwgUGF1c2FibGUgewogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogIH0KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzdXBlci50cmFuc2ZlckZyb20oX2Zyb20sIF90bywgX3ZhbHVlKTsKICB9Cn0KLyoqCiAqIEB0aXRsZSBMaW1pdGVkVHJhbnNmZXJUb2tlbgogKiBAZGV2IExpbWl0ZWRUcmFuc2ZlclRva2VuIGRlZmluZXMgdGhlIGdlbmVyaWMgaW50ZXJmYWNlIGFuZCB0aGUgaW1wbGVtZW50YXRpb24gdG8gbGltaXQgdG9rZW4KICogdHJhbnNmZXJhYmlsaXR5IGZvciBkaWZmZXJlbnQgZXZlbnRzLiBJdCBpcyBpbnRlbmRlZCB0byBiZSB1c2VkIGFzIGEgYmFzZSBjbGFzcyBmb3Igb3RoZXIgdG9rZW4KICogY29udHJhY3RzLgogKiBMaW1pdGVkVHJhbnNmZXJUb2tlbiBoYXMgYmVlbiBkZXNpZ25lZCB0byBhbGxvdyBmb3IgZGlmZmVyZW50IGxpbWl0aW5nIGZhY3RvcnMsCiAqIHRoaXMgY2FuIGJlIGFjaGlldmVkIGJ5IHJlY3Vyc2l2ZWx5IGNhbGxpbmcgc3VwZXIudHJhbnNmZXJhYmxlVG9rZW5zKCkgdW50aWwgdGhlIGJhc2UgY2xhc3MgaXMKICogaGl0LiBGb3IgZXhhbXBsZToKICogICAgIGZ1bmN0aW9uIHRyYW5zZmVyYWJsZVRva2VucyhhZGRyZXNzIGhvbGRlciwgdWludDY0IHRpbWUpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CiAqICAgICAgIHJldHVybiBtaW4yNTYodW5sb2NrZWRUb2tlbnMsIHN1cGVyLnRyYW5zZmVyYWJsZVRva2Vucyhob2xkZXIsIHRpbWUpKTsKICogICAgIH0KICogQSB3b3JraW5nIGV4YW1wbGUgaXMgVmVzdGVkVG9rZW4uc29sOgogKiBodHRwczovL2dpdGh1Yi5jb20vT3BlblplcHBlbGluL3plcHBlbGluLXNvbGlkaXR5L2Jsb2IvbWFzdGVyL2NvbnRyYWN0cy90b2tlbi9WZXN0ZWRUb2tlbi5zb2wKICovCmNvbnRyYWN0IExpbWl0ZWRUcmFuc2ZlclRva2VuIGlzIEVSQzIwIHsKICAvKioKICAgKiBAZGV2IENoZWNrcyB3aGV0aGVyIGl0IGNhbiB0cmFuc2ZlciBvciBvdGhlcndpc2UgdGhyb3dzLgogICAqLwogIG1vZGlmaWVyIGNhblRyYW5zZmVyKGFkZHJlc3MgX3NlbmRlciwgdWludDI1NiBfdmFsdWUpIHsKICAgcmVxdWlyZShfdmFsdWUgPD0gdHJhbnNmZXJhYmxlVG9rZW5zKF9zZW5kZXIsIHVpbnQ2NChub3cpKSk7CiAgIF87CiAgfQogIC8qKgogICAqIEBkZXYgQ2hlY2tzIG1vZGlmaWVyIGFuZCBhbGxvd3MgdHJhbnNmZXIgaWYgdG9rZW5zIGFyZSBub3QgbG9ja2VkLgogICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHJlY2lldmUgdGhlIHRva2Vucy4KICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgY2FuVHJhbnNmZXIobXNnLnNlbmRlciwgX3ZhbHVlKSByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogIH0KICAvKioKICAqIEBkZXYgQ2hlY2tzIG1vZGlmaWVyIGFuZCBhbGxvd3MgdHJhbnNmZXIgaWYgdG9rZW5zIGFyZSBub3QgbG9ja2VkLgogICogQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBzZW5kIHRoZSB0b2tlbnMuCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCByZWNpZXZlIHRoZSB0b2tlbnMuCiAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgY2FuVHJhbnNmZXIoX2Zyb20sIF92YWx1ZSkgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogIH0KICAvKioKICAgKiBAZGV2IERlZmF1bHQgdHJhbnNmZXJhYmxlIHRva2VucyBmdW5jdGlvbiByZXR1cm5zIGFsbCB0b2tlbnMgZm9yIGEgaG9sZGVyIChubyBsaW1pdCkuCiAgICogQGRldiBPdmVyd3JpdGluZyB0cmFuc2ZlcmFibGVUb2tlbnMoYWRkcmVzcyBob2xkZXIsIHVpbnQ2NCB0aW1lKSBpcyB0aGUgd2F5IHRvIHByb3ZpZGUgdGhlCiAgICogc3BlY2lmaWMgbG9naWMgZm9yIGxpbWl0aW5nIHRva2VuIHRyYW5zZmVyYWJpbGl0eSBmb3IgYSBob2xkZXIgb3ZlciB0aW1lLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyYWJsZVRva2VucyhhZGRyZXNzIGhvbGRlciwgdWludDY0IHRpbWUpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYmFsYW5jZU9mKGhvbGRlcik7CiAgfQp9Ci8qKgogKiBAdGl0bGUgVmVzdGVkIHRva2VuCiAqIEBkZXYgVG9rZW5zIHRoYXQgY2FuIGJlIHZlc3RlZCBmb3IgYSBncm91cCBvZiBhZGRyZXNzZXMuCiAqLwpjb250cmFjdCBWZXN0ZWRUb2tlbiBpcyBNYXRoLCBTdGFuZGFyZFRva2VuLCBMaW1pdGVkVHJhbnNmZXJUb2tlbiB7CiAgdWludDI1NiBNQVhfR1JBTlRTX1BFUl9BRERSRVNTID0gMjA7CiAgc3RydWN0IFRva2VuR3JhbnQgewogICAgYWRkcmVzcyBncmFudGVyOyAgICAgLy8gMjAgYnl0ZXMKICAgIHVpbnQyNTYgdmFsdWU7ICAgICAgIC8vIDMyIGJ5dGVzCiAgICB1aW50NjQgY2xpZmY7CiAgICB1aW50NjQgdmVzdGluZzsKICAgIHVpbnQ2NCBzdGFydDsgICAgICAgIC8vIDMgKiA4ID0gMjQgYnl0ZXMKICAgIGJvb2wgcmV2b2thYmxlOwogICAgYm9vbCBidXJuc09uUmV2b2tlOyAgLy8gMiAqIDEgPSAyIGJpdHM/IG9yIDIgYnl0ZXM/CiAgfSAvLyB0b3RhbCA3OCBieXRlcyA9IDMgc3N0b3JlIHBlciBvcGVyYXRpb24gKDMyIHBlciBzc3RvcmUpCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBUb2tlbkdyYW50W10pIHB1YmxpYyBncmFudHM7CiAgZXZlbnQgTmV3VG9rZW5HcmFudChhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlLCB1aW50MjU2IGdyYW50SWQpOwogIC8qKgogICAqIEBkZXYgR3JhbnQgdG9rZW5zIHRvIGEgc3BlY2lmaWVkIGFkZHJlc3MKICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggdGhlIHRva2VucyB3aWxsIGJlIGdyYW50ZWQgdG8uCiAgICogQHBhcmFtIF92YWx1ZSB1aW50MjU2IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGdyYW50ZWQuCiAgICogQHBhcmFtIF9zdGFydCB1aW50NjQgVGltZSBvZiB0aGUgYmVnaW5uaW5nIG9mIHRoZSBncmFudC4KICAgKiBAcGFyYW0gX2NsaWZmIHVpbnQ2NCBUaW1lIG9mIHRoZSBjbGlmZiBwZXJpb2QuCiAgICogQHBhcmFtIF92ZXN0aW5nIHVpbnQ2NCBUaGUgdmVzdGluZyBwZXJpb2QuCiAgICovCiAgZnVuY3Rpb24gZ3JhbnRWZXN0ZWRUb2tlbnMoCiAgICBhZGRyZXNzIF90bywKICAgIHVpbnQyNTYgX3ZhbHVlLAogICAgdWludDY0IF9zdGFydCwKICAgIHVpbnQ2NCBfY2xpZmYsCiAgICB1aW50NjQgX3Zlc3RpbmcsCiAgICBib29sIF9yZXZva2FibGUsCiAgICBib29sIF9idXJuc09uUmV2b2tlCiAgKSBwdWJsaWMgewogICAgLy8gQ2hlY2sgZm9yIGRhdGUgaW5jb25zaXN0ZW5jaWVzIHRoYXQgbWF5IGNhdXNlIHVuZXhwZWN0ZWQgYmVoYXZpb3IKICAgIHJlcXVpcmUoX2NsaWZmID49IF9zdGFydCAmJiBfdmVzdGluZyA+PSBfY2xpZmYpOwogICAgcmVxdWlyZSh0b2tlbkdyYW50c0NvdW50KF90bykgPCBNQVhfR1JBTlRTX1BFUl9BRERSRVNTKTsgICAvLyBUbyBwcmV2ZW50IGEgdXNlciBiZWluZyBzcGFtbWVkIGFuZCBoYXZlIGhpcyBiYWxhbmNlIGxvY2tlZCAob3V0IG9mIGdhcyBhdHRhY2sgd2hlbiBjYWxjdWxhdGluZyB2ZXN0aW5nKS4KICAgIHVpbnQyNTYgY291bnQgPSBncmFudHNbX3RvXS5wdXNoKAogICAgICAgICAgICAgICAgVG9rZW5HcmFudCgKICAgICAgICAgICAgICAgICAgX3Jldm9rYWJsZSA/IG1zZy5zZW5kZXIgOiAwLCAvLyBhdm9pZCBzdG9yaW5nIGFuIGV4dHJhIDIwIGJ5dGVzIHdoZW4gaXQgaXMgbm9uLXJldm9rYWJsZQogICAgICAgICAgICAgICAgICBfdmFsdWUsCiAgICAgICAgICAgICAgICAgIF9jbGlmZiwKICAgICAgICAgICAgICAgICAgX3Zlc3RpbmcsCiAgICAgICAgICAgICAgICAgIF9zdGFydCwKICAgICAgICAgICAgICAgICAgX3Jldm9rYWJsZSwKICAgICAgICAgICAgICAgICAgX2J1cm5zT25SZXZva2UKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICApOwogICAgdHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogICAgTmV3VG9rZW5HcmFudChtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSwgY291bnQgLSAxKTsKICB9CiAgLyoqCiAgICogQGRldiBSZXZva2UgdGhlIGdyYW50IG9mIHRva2VucyBvZiBhIHNwZWNpZmVkIGFkZHJlc3MuCiAgICogQHBhcmFtIF9ob2xkZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBoYXZlIGl0cyB0b2tlbnMgcmV2b2tlZC4KICAgKiBAcGFyYW0gX2dyYW50SWQgVGhlIGlkIG9mIHRoZSB0b2tlbiBncmFudC4KICAgKi8KICBmdW5jdGlvbiByZXZva2VUb2tlbkdyYW50KGFkZHJlc3MgX2hvbGRlciwgdWludDI1NiBfZ3JhbnRJZCkgcHVibGljIHsKICAgIFRva2VuR3JhbnQgc3RvcmFnZSBncmFudCA9IGdyYW50c1tfaG9sZGVyXVtfZ3JhbnRJZF07CiAgICByZXF1aXJlKGdyYW50LnJldm9rYWJsZSk7CiAgICByZXF1aXJlKGdyYW50LmdyYW50ZXIgPT0gbXNnLnNlbmRlcik7IC8vIE9ubHkgZ3JhbnRlciBjYW4gcmV2b2tlIGl0CiAgICBhZGRyZXNzIHJlY2VpdmVyID0gZ3JhbnQuYnVybnNPblJldm9rZSA/IDB4ZGVhZCA6IG1zZy5zZW5kZXI7CiAgICB1aW50MjU2IG5vblZlc3RlZCA9IG5vblZlc3RlZFRva2VucyhncmFudCwgdWludDY0KG5vdykpOwogICAgLy8gcmVtb3ZlIGdyYW50IGZyb20gYXJyYXkKICAgIGRlbGV0ZSBncmFudHNbX2hvbGRlcl1bX2dyYW50SWRdOwogICAgZ3JhbnRzW19ob2xkZXJdW19ncmFudElkXSA9IGdyYW50c1tfaG9sZGVyXVtzdWIoZ3JhbnRzW19ob2xkZXJdLmxlbmd0aCwxKV07CiAgICBncmFudHNbX2hvbGRlcl0ubGVuZ3RoIC09IDE7CiAgICBiYWxhbmNlc1tyZWNlaXZlcl0gPSBhZGQoYmFsYW5jZXNbcmVjZWl2ZXJdLG5vblZlc3RlZCk7CiAgICBiYWxhbmNlc1tfaG9sZGVyXSA9IHN1YihiYWxhbmNlc1tfaG9sZGVyXSxub25WZXN0ZWQpOwogICAgVHJhbnNmZXIoX2hvbGRlciwgcmVjZWl2ZXIsIG5vblZlc3RlZCk7CiAgfQogIC8qKgogICAqIEBkZXYgQ2FsY3VsYXRlIHRoZSB0b3RhbCBhbW91bnQgb2YgdHJhbnNmZXJhYmxlIHRva2VucyBvZiBhIGhvbGRlciBhdCBhIGdpdmVuIHRpbWUKICAgKiBAcGFyYW0gaG9sZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgb2YgdGhlIGhvbGRlcgogICAqIEBwYXJhbSB0aW1lIHVpbnQ2NCBUaGUgc3BlY2lmaWMgdGltZS4KICAgKiBAcmV0dXJuIEFuIHVpbnQyNTYgcmVwcmVzZW50aW5nIGEgaG9sZGVyJ3MgdG90YWwgYW1vdW50IG9mIHRyYW5zZmVyYWJsZSB0b2tlbnMuCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJhYmxlVG9rZW5zKGFkZHJlc3MgaG9sZGVyLCB1aW50NjQgdGltZSkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgZ3JhbnRJbmRleCA9IHRva2VuR3JhbnRzQ291bnQoaG9sZGVyKTsKICAgIGlmIChncmFudEluZGV4ID09IDApIHJldHVybiBzdXBlci50cmFuc2ZlcmFibGVUb2tlbnMoaG9sZGVyLCB0aW1lKTsgLy8gc2hvcnRjdXQgZm9yIGhvbGRlciB3aXRob3V0IGdyYW50cwogICAgLy8gSXRlcmF0ZSB0aHJvdWdoIGFsbCB0aGUgZ3JhbnRzIHRoZSBob2xkZXIgaGFzLCBhbmQgYWRkIGFsbCBub24tdmVzdGVkIHRva2VucwogICAgdWludDI1NiBub25WZXN0ZWQgPSAwOwogICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgZ3JhbnRJbmRleDsgaSsrKSB7CiAgICAgIG5vblZlc3RlZCA9IGFkZChub25WZXN0ZWQsIG5vblZlc3RlZFRva2VucyhncmFudHNbaG9sZGVyXVtpXSwgdGltZSkpOwogICAgfQogICAgLy8gQmFsYW5jZSAtIHRvdGFsTm9uVmVzdGVkIGlzIHRoZSBhbW91bnQgb2YgdG9rZW5zIGEgaG9sZGVyIGNhbiB0cmFuc2ZlciBhdCBhbnkgZ2l2ZW4gdGltZQogICAgdWludDI1NiB2ZXN0ZWRUcmFuc2ZlcmFibGUgPSBzdWIoYmFsYW5jZU9mKGhvbGRlciksIG5vblZlc3RlZCk7CiAgICAvLyBSZXR1cm4gdGhlIG1pbmltdW0gb2YgaG93IG1hbnkgdmVzdGVkIGNhbiB0cmFuc2ZlciBhbmQgb3RoZXIgdmFsdWUKICAgIC8vIGluIGNhc2UgdGhlcmUgYXJlIG90aGVyIGxpbWl0aW5nIHRyYW5zZmVyYWJpbGl0eSBmYWN0b3JzIChkZWZhdWx0IGlzIGJhbGFuY2VPZikKICAgIHJldHVybiBtaW4yNTYodmVzdGVkVHJhbnNmZXJhYmxlLCBzdXBlci50cmFuc2ZlcmFibGVUb2tlbnMoaG9sZGVyLCB0aW1lKSk7CiAgfQogIC8qKgogICAqIEBkZXYgQ2hlY2sgdGhlIGFtb3VudCBvZiBncmFudHMgdGhhdCBhbiBhZGRyZXNzIGhhcy4KICAgKiBAcGFyYW0gX2hvbGRlciBUaGUgaG9sZGVyIG9mIHRoZSBncmFudHMuCiAgICogQHJldHVybiBBIHVpbnQyNTYgcmVwcmVzZW50aW5nIHRoZSB0b3RhbCBhbW91bnQgb2YgZ3JhbnRzLgogICAqLwogIGZ1bmN0aW9uIHRva2VuR3JhbnRzQ291bnQoYWRkcmVzcyBfaG9sZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGluZGV4KSB7CiAgICByZXR1cm4gZ3JhbnRzW19ob2xkZXJdLmxlbmd0aDsKICB9CiAgLyoqCiAgICogQGRldiBDYWxjdWxhdGUgYW1vdW50IG9mIHZlc3RlZCB0b2tlbnMgYXQgYSBzcGVjaWZjIHRpbWUuCiAgICogQHBhcmFtIHRva2VucyB1aW50MjU2IFRoZSBhbW91bnQgb2YgdG9rZW5zIGdyYW50dGVkLgogICAqIEBwYXJhbSB0aW1lIHVpbnQ2NCBUaGUgdGltZSB0byBiZSBjaGVja2VkCiAgICogQHBhcmFtIHN0YXJ0IHVpbnQ2NCBBIHRpbWUgcmVwcmVzZW50aW5nIHRoZSBiZWdpbmluZyBvZiB0aGUgZ3JhbnQKICAgKiBAcGFyYW0gY2xpZmYgdWludDY0IFRoZSBjbGlmZiBwZXJpb2QuCiAgICogQHBhcmFtIHZlc3RpbmcgdWludDY0IFRoZSB2ZXN0aW5nIHBlcmlvZC4KICAgKiBAcmV0dXJuIEFuIHVpbnQyNTYgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb2YgdmVzdGVkIHRva2Vuc29mIGEgc3BlY2lmIGdyYW50LgogICAqICB0cmFuc2ZlcmFibGVUb2tlbnMKICAgKiAgIHwgICAgICAgICAgICAgICAgICAgICAgICAgXy8tLS0tLS0tLSAgIHZlc3RlZFRva2VucyByZWN0CiAgICogICB8ICAgICAgICAgICAgICAgICAgICAgICBfLwogICAqICAgfCAgICAgICAgICAgICAgICAgICAgIF8vCiAgICogICB8ICAgICAgICAgICAgICAgICAgIF8vCiAgICogICB8ICAgICAgICAgICAgICAgICBfLwogICAqICAgfCAgICAgICAgICAgICAgICAvCiAgICogICB8ICAgICAgICAgICAgICAufAogICAqICAgfCAgICAgICAgICAgIC4gIHwKICAgKiAgIHwgICAgICAgICAgLiAgICB8CiAgICogICB8ICAgICAgICAuICAgICAgfAogICAqICAgfCAgICAgIC4gICAgICAgIHwKICAgKiAgIHwgICAgLiAgICAgICAgICB8CiAgICogICArPT09Kz09PT09PT09PT09Ky0tLS0tLS0tLSstLS0tLS0tLS0tPiB0aW1lCiAgICogICAgICBTdGFydCAgICAgICBDbGlmdCAgICBWZXN0aW5nCiAgICovCiAgZnVuY3Rpb24gY2FsY3VsYXRlVmVzdGVkVG9rZW5zKAogICAgdWludDI1NiB0b2tlbnMsCiAgICB1aW50MjU2IHRpbWUsCiAgICB1aW50MjU2IHN0YXJ0LAogICAgdWludDI1NiBjbGlmZiwKICAgIHVpbnQyNTYgdmVzdGluZykgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgLy8gU2hvcnRjdXRzIGZvciBiZWZvcmUgY2xpZmYgYW5kIGFmdGVyIHZlc3RpbmcgY2FzZXMuCiAgICAgIGlmICh0aW1lIDwgY2xpZmYpIHJldHVybiAwOwogICAgICBpZiAodGltZSA+PSB2ZXN0aW5nKSByZXR1cm4gdG9rZW5zOwogICAgICAvLyBJbnRlcnBvbGF0ZSBhbGwgdmVzdGVkIHRva2Vucy4KICAgICAgLy8gQXMgYmVmb3JlIGNsaWZmIHRoZSBzaG9ydGN1dCByZXR1cm5zIDAsIHdlIGNhbiB1c2UganVzdCBjYWxjdWxhdGUgYSB2YWx1ZQogICAgICAvLyBpbiB0aGUgdmVzdGluZyByZWN0IChhcyBzaG93biBpbiBhYm92ZSdzIGZpZ3VyZSkKICAgICAgLy8gdmVzdGVkVG9rZW5zID0gdG9rZW5zICogKHRpbWUgLSBzdGFydCkgLyAodmVzdGluZyAtIHN0YXJ0KQogICAgICB1aW50MjU2IHZlc3RlZFRva2VucyA9IGRpdigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXVsKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWIodGltZSwgc3RhcnQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ViKHZlc3RpbmcsIHN0YXJ0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICByZXR1cm4gdmVzdGVkVG9rZW5zOwogIH0KICAvKioKICAgKiBAZGV2IEdldCBhbGwgaW5mb3JtYXRpb24gYWJvdXQgYSBzcGVjaWZjIGdyYW50LgogICAqIEBwYXJhbSBfaG9sZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgaGF2ZSBpdHMgdG9rZW5zIHJldm9rZWQuCiAgICogQHBhcmFtIF9ncmFudElkIFRoZSBpZCBvZiB0aGUgdG9rZW4gZ3JhbnQuCiAgICogQHJldHVybiBSZXR1cm5zIGFsbCB0aGUgdmFsdWVzIHRoYXQgcmVwcmVzZW50IGEgVG9rZW5HcmFudChhZGRyZXNzLCB2YWx1ZSwgc3RhcnQsIGNsaWZmLAogICAqIHJldm9rYWJpbGl0eSwgYnVybnNPblJldm9rZSwgYW5kIHZlc3RpbmcpIHBsdXMgdGhlIHZlc3RlZCB2YWx1ZSBhdCB0aGUgY3VycmVudCB0aW1lLgogICAqLwogIGZ1bmN0aW9uIHRva2VuR3JhbnQoYWRkcmVzcyBfaG9sZGVyLCB1aW50MjU2IF9ncmFudElkKSBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzIGdyYW50ZXIsIHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgdmVzdGVkLCB1aW50NjQgc3RhcnQsIHVpbnQ2NCBjbGlmZiwgdWludDY0IHZlc3RpbmcsIGJvb2wgcmV2b2thYmxlLCBib29sIGJ1cm5zT25SZXZva2UpIHsKICAgIFRva2VuR3JhbnQgc3RvcmFnZSBncmFudCA9IGdyYW50c1tfaG9sZGVyXVtfZ3JhbnRJZF07CiAgICBncmFudGVyID0gZ3JhbnQuZ3JhbnRlcjsKICAgIHZhbHVlID0gZ3JhbnQudmFsdWU7CiAgICBzdGFydCA9IGdyYW50LnN0YXJ0OwogICAgY2xpZmYgPSBncmFudC5jbGlmZjsKICAgIHZlc3RpbmcgPSBncmFudC52ZXN0aW5nOwogICAgcmV2b2thYmxlID0gZ3JhbnQucmV2b2thYmxlOwogICAgYnVybnNPblJldm9rZSA9IGdyYW50LmJ1cm5zT25SZXZva2U7CiAgICB2ZXN0ZWQgPSB2ZXN0ZWRUb2tlbnMoZ3JhbnQsIHVpbnQ2NChub3cpKTsKICB9CiAgLyoqCiAgICogQGRldiBHZXQgdGhlIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIGF0IGEgc3BlY2lmaWMgdGltZS4KICAgKiBAcGFyYW0gZ3JhbnQgVG9rZW5HcmFudCBUaGUgZ3JhbnQgdG8gYmUgY2hlY2tlZC4KICAgKiBAcGFyYW0gdGltZSBUaGUgdGltZSB0byBiZSBjaGVja2VkCiAgICogQHJldHVybiBBbiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG9mIHZlc3RlZCB0b2tlbnMgb2YgYSBzcGVjaWZpYyBncmFudCBhdCBhIHNwZWNpZmljIHRpbWUuCiAgICovCiAgZnVuY3Rpb24gdmVzdGVkVG9rZW5zKFRva2VuR3JhbnQgZ3JhbnQsIHVpbnQ2NCB0aW1lKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBjYWxjdWxhdGVWZXN0ZWRUb2tlbnMoCiAgICAgIGdyYW50LnZhbHVlLAogICAgICB1aW50MjU2KHRpbWUpLAogICAgICB1aW50MjU2KGdyYW50LnN0YXJ0KSwKICAgICAgdWludDI1NihncmFudC5jbGlmZiksCiAgICAgIHVpbnQyNTYoZ3JhbnQudmVzdGluZykKICAgICk7CiAgfQogIC8qKgogICAqIEBkZXYgQ2FsY3VsYXRlIHRoZSBhbW91bnQgb2Ygbm9uIHZlc3RlZCB0b2tlbnMgYXQgYSBzcGVjaWZpYyB0aW1lLgogICAqIEBwYXJhbSBncmFudCBUb2tlbkdyYW50IFRoZSBncmFudCB0byBiZSBjaGVja2VkLgogICAqIEBwYXJhbSB0aW1lIHVpbnQ2NCBUaGUgdGltZSB0byBiZSBjaGVja2VkCiAgICogQHJldHVybiBBbiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG9mIG5vbiB2ZXN0ZWQgdG9rZW5zIG9mIGEgc3BlY2lmYyBncmFudCBvbiB0aGUKICAgKiBwYXNzZWQgdGltZSBmcmFtZS4KICAgKi8KICBmdW5jdGlvbiBub25WZXN0ZWRUb2tlbnMoVG9rZW5HcmFudCBncmFudCwgdWludDY0IHRpbWUpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHN1YihncmFudC52YWx1ZSx2ZXN0ZWRUb2tlbnMoZ3JhbnQsIHRpbWUpKTsKICB9CiAgLyoqCiAgICogQGRldiBDYWxjdWxhdGUgdGhlIGRhdGUgd2hlbiB0aGUgaG9sZGVyIGNhbiB0cmFzZmVyIGFsbCBpdHMgdG9rZW5zCiAgICogQHBhcmFtIGhvbGRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIG9mIHRoZSBob2xkZXIKICAgKiBAcmV0dXJuIEFuIHVpbnQyNTYgcmVwcmVzZW50aW5nIHRoZSBkYXRlIG9mIHRoZSBsYXN0IHRyYW5zZmVyYWJsZSB0b2tlbnMuCiAgICovCiAgZnVuY3Rpb24gbGFzdFRva2VuSXNUcmFuc2ZlcmFibGVEYXRlKGFkZHJlc3MgaG9sZGVyKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDY0IGRhdGUpIHsKICAgIGRhdGUgPSB1aW50NjQobm93KTsKICAgIHVpbnQyNTYgZ3JhbnRJbmRleCA9IGdyYW50c1tob2xkZXJdLmxlbmd0aDsKICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IGdyYW50SW5kZXg7IGkrKykgewogICAgICBkYXRlID0gbWF4NjQoZ3JhbnRzW2hvbGRlcl1baV0udmVzdGluZywgZGF0ZSk7CiAgICB9CiAgfQp9Ci8qKgogKiBAdGl0bGUgQnVybmFibGUgVG9rZW4KICogQGRldiBUb2tlbiB0aGF0IGNhbiBiZSBpcnJldmVyc2libHkgYnVybmVkIChkZXN0cm95ZWQpLgogKi8KY29udHJhY3QgQnVybmFibGVUb2tlbiBpcyBTYWZlTWF0aCwgU3RhbmRhcmRUb2tlbiB7CiAgICBldmVudCBCdXJuKGFkZHJlc3MgaW5kZXhlZCBidXJuZXIsIHVpbnQgaW5kZXhlZCB2YWx1ZSk7CiAgICAvKioKICAgICAqIEBkZXYgQnVybnMgYSBzcGVjaWZpYyBhbW91bnQgb2YgdG9rZW5zLgogICAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VuIHRvIGJlIGJ1cm5lZC4KICAgICAqLwogICAgZnVuY3Rpb24gYnVybih1aW50IF92YWx1ZSkKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICByZXF1aXJlKF92YWx1ZSA+IDApOwogICAgICAgIGFkZHJlc3MgYnVybmVyID0gbXNnLnNlbmRlcjsKICAgICAgICBiYWxhbmNlc1tidXJuZXJdID0gc3ViKGJhbGFuY2VzW2J1cm5lcl0sIF92YWx1ZSk7CiAgICAgICAgdG90YWxTdXBwbHkgPSBzdWIodG90YWxTdXBwbHksIF92YWx1ZSk7CiAgICAgICAgQnVybihidXJuZXIsIF92YWx1ZSk7CiAgICB9Cn0KLyoqCiAqIEB0aXRsZSBQTEMKICogQGRldiBQTEMgaXMgRVJDMjAgdG9rZW4gY29udHJhY3QsIGluaGVyaXRpbmcgTWludGFibGVUb2tlbiwgUGF1c2FibGVUb2tlbiwKICogVmVzdGVkVG9rZW4sIEJ1cm5hYmxlVG9rZW4gY29udHJhY3QgZnJvbSBvcGVuIHplcHBlbGluLgogKi8KY29udHJhY3QgUExDIGlzIE1pbnRhYmxlVG9rZW4sIFBhdXNhYmxlVG9rZW4sIFZlc3RlZFRva2VuLCBCdXJuYWJsZVRva2VuIHsKICBzdHJpbmcgcHVibGljIG5hbWUgPSAiUGx1c0NvaW4iOwogIHN0cmluZyBwdWJsaWMgc3ltYm9sID0gIlBMQyI7CiAgdWludDI1NiBwdWJsaWMgZGVjaW1hbHMgPSAxODsKfQovKioKICogQHRpdGxlIFJlZnVuZFZhdWx0CiAqIEBkZXYgVGhpcyBjb250cmFjdCBpcyB1c2VkIGZvciBzdG9yaW5nIGZ1bmRzIHdoaWxlIGEgY3Jvd2RzYWxlCiAqIGlzIGluIHByb2dyZXNzLiBTdXBwb3J0cyByZWZ1bmRpbmcgdGhlIG1vbmV5IGlmIGNyb3dkc2FsZSBmYWlscywKICogYW5kIGZvcndhcmRpbmcgaXQgaWYgY3Jvd2RzYWxlIGlzIHN1Y2Nlc3NmdWwuCiAqLwpjb250cmFjdCBSZWZ1bmRWYXVsdCBpcyBPd25hYmxlLCBTYWZlTWF0aHsKICBlbnVtIFN0YXRlIHsgQWN0aXZlLCBSZWZ1bmRpbmcsIENsb3NlZCB9CiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgZGVwb3NpdGVkOwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIHJlZnVuZGVkOwogIFN0YXRlIHB1YmxpYyBzdGF0ZTsKICBhZGRyZXNzIHB1YmxpYyBkZXZNdWx0aXNpZzsKICBhZGRyZXNzW10gcHVibGljIHJlc2VydmVXYWxsZXQ7CiAgZXZlbnQgQ2xvc2VkKCk7CiAgZXZlbnQgUmVmdW5kc0VuYWJsZWQoKTsKICBldmVudCBSZWZ1bmRlZChhZGRyZXNzIGluZGV4ZWQgYmVuZWZpY2lhcnksIHVpbnQyNTYgd2VpQW1vdW50KTsKICAvKioKICAgKiBAZGV2IFRoaXMgY29uc3RydWN0b3Igc2V0cyB0aGUgYWRkcmVzc2VzIG9mIG11bHRpLXNpZ25hdHVyZSB3YWxsZXQgYW5kCiAgICogNSByZXNlcnZlIHdhbGxldHMuCiAgICogYW5kIGZvcndhcmRpbmcgaXQgaWYgY3Jvd2RzYWxlIGlzIHN1Y2Nlc3NmdWwuCiAgICogQHBhcmFtIF9kZXZNdWx0aVNpZyBhZGRyZXNzIFRoZSBhZGRyZXNzIG9mIG11bHRpLXNpZ25hdHVyZSB3YWxsZXQuCiAgICogQHBhcmFtIF9yZXNlcnZlV2FsbGV0IGFkZHJlc3NbNV0gVGhlIGFkZHJlc3NlcyBvZiByZXNlcnZlIHdhbGxldC4KICAgKi8KICBmdW5jdGlvbiBSZWZ1bmRWYXVsdChhZGRyZXNzIF9kZXZNdWx0aVNpZywgYWRkcmVzc1tdIF9yZXNlcnZlV2FsbGV0KSB7CiAgICBzdGF0ZSA9IFN0YXRlLkFjdGl2ZTsKICAgIGRldk11bHRpc2lnID0gX2Rldk11bHRpU2lnOwogICAgcmVzZXJ2ZVdhbGxldCA9IF9yZXNlcnZlV2FsbGV0OwogIH0KICAvKioKICAgKiBAZGV2IFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIHdoZW4gdXNlciBidXkgdG9rZW5zLiBPbmx5IFJlZnVuZFZhdWx0CiAgICogY29udHJhY3Qgc3RvcmVzIHRoZSBFdGhlciB1c2VyIHNlbnQgd2hpY2ggZm9yd2FyZGVkIGZyb20gY3Jvd2RzYWxlCiAgICogY29udHJhY3QuCiAgICogQHBhcmFtIGludmVzdG9yIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hvIGJ1eSB0aGUgdG9rZW4gZnJvbSBjcm93ZHNhbGUuCiAgICovCiAgZnVuY3Rpb24gZGVwb3NpdChhZGRyZXNzIGludmVzdG9yKSBvbmx5T3duZXIgcGF5YWJsZSB7CiAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLkFjdGl2ZSk7CiAgICBkZXBvc2l0ZWRbaW52ZXN0b3JdID0gYWRkKGRlcG9zaXRlZFtpbnZlc3Rvcl0sIG1zZy52YWx1ZSk7CiAgfQogIGV2ZW50IFRyYW5zZmVycmVkKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSk7CiAgLyoqCiAgICogQGRldiBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCB3aGVuIGNyb3dkc2FsZSBpcyBzdWNjZXNzZnVsbHkgZmluYWxpemVkLgogICAqLwogIGZ1bmN0aW9uIGNsb3NlKCkgb25seU93bmVyIHsKICAgIHJlcXVpcmUoc3RhdGUgPT0gU3RhdGUuQWN0aXZlKTsKICAgIHN0YXRlID0gU3RhdGUuQ2xvc2VkOwogICAgdWludDI1NiBiYWxhbmNlID0gdGhpcy5iYWxhbmNlOwogICAgdWludDI1NiBkZXZBbW91bnQgPSBkaXYoYmFsYW5jZSwgMTApOwogICAgZGV2TXVsdGlzaWcudHJhbnNmZXIoZGV2QW1vdW50KTsKICAgIFRyYW5zZmVycmVkKGRldk11bHRpc2lnLCBkZXZBbW91bnQpOwogICAgdWludDI1NiByZXNlcnZlQW1vdW50ID0gZGl2KG11bChiYWxhbmNlLCA5KSwgMTApOwogICAgdWludDI1NiByZXNlcnZlQW1vdW50Rm9yRWFjaCA9IGRpdihyZXNlcnZlQW1vdW50LCByZXNlcnZlV2FsbGV0Lmxlbmd0aCk7CiAgICBmb3IodWludDggaSA9IDA7IGkgPCByZXNlcnZlV2FsbGV0Lmxlbmd0aDsgaSsrKXsKICAgICAgcmVzZXJ2ZVdhbGxldFtpXS50cmFuc2ZlcihyZXNlcnZlQW1vdW50Rm9yRWFjaCk7CiAgICAgIFRyYW5zZmVycmVkKHJlc2VydmVXYWxsZXRbaV0sIHJlc2VydmVBbW91bnRGb3JFYWNoKTsKICAgIH0KICAgIENsb3NlZCgpOwogIH0KICAvKioKICAgKiBAZGV2IFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIHdoZW4gY3Jvd2RzYWxlIGlzIHVuc3VjY2Vzc2Z1bGx5IGZpbmFsaXplZAogICAqIGFuZCByZWZ1bmQgaXMgcmVxdWlyZWQuCiAgICovCiAgZnVuY3Rpb24gZW5hYmxlUmVmdW5kcygpIG9ubHlPd25lciB7CiAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLkFjdGl2ZSk7CiAgICBzdGF0ZSA9IFN0YXRlLlJlZnVuZGluZzsKICAgIFJlZnVuZHNFbmFibGVkKCk7CiAgfQogIC8qKgogICAqIEBkZXYgVGhpcyBmdW5jdGlvbiBhbGxvd3MgZm9yIHVzZXIgdG8gcmVmdW5kIEV0aGVyLgogICAqLwogIGZ1bmN0aW9uIHJlZnVuZChhZGRyZXNzIGludmVzdG9yKSByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLlJlZnVuZGluZyk7CiAgICBpZiAocmVmdW5kZWRbaW52ZXN0b3JdID4gMCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICB1aW50MjU2IGRlcG9zaXRlZFZhbHVlID0gZGVwb3NpdGVkW2ludmVzdG9yXTsKICAgIGRlcG9zaXRlZFtpbnZlc3Rvcl0gPSAwOwogICAgcmVmdW5kZWRbaW52ZXN0b3JdID0gZGVwb3NpdGVkVmFsdWU7CiAgICBpbnZlc3Rvci50cmFuc2ZlcihkZXBvc2l0ZWRWYWx1ZSk7CiAgICBSZWZ1bmRlZChpbnZlc3RvciwgZGVwb3NpdGVkVmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQp9Ci8qKgogKiBAdGl0bGUgS1lDCiAqIEBkZXYgS1lDIGNvbnRyYWN0IGhhbmRsZXMgdGhlIHdoaXRlIGxpc3QgZm9yIFBMQ0Nyb3dkc2FsZSBjb250cmFjdAogKiBPbmx5IGFjY291bnRzIHJlZ2lzdGVyZWQgaW4gS1lDIGNvbnRyYWN0IGNhbiBidXkgUExDIHRva2VuLgogKiBBZG1pbnMgY2FuIHJlZ2lzdGVyIGFjY291bnQsIGFuZCB0aGUgcmVhc29uIHdoeQogKi8KY29udHJhY3QgS1lDIGlzIE93bmFibGUsIFNhZmVNYXRoLCBQYXVzYWJsZSB7CiAgLy8gY2hlY2sgdGhlIGFkZHJlc3MgaXMgcmVnaXN0ZXJlZCBmb3IgdG9rZW4gc2FsZQogIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIHJlZ2lzdGVyZWRBZGRyZXNzOwogIC8vIGNoZWNrIHRoZSBhZGRyZXNzIGlzIGFkbWluIG9mIGt5YyBjb250cmFjdAogIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGFkbWluOwogIGV2ZW50IFJlZ2lzdGVyZWQoYWRkcmVzcyBpbmRleGVkIF9hZGRyKTsKICBldmVudCBVbnJlZ2lzdGVyZWQoYWRkcmVzcyBpbmRleGVkIF9hZGRyKTsKICBldmVudCBOZXdBZG1pbihhZGRyZXNzIGluZGV4ZWQgX2FkZHIpOwogIC8qKgogICAqIEBkZXYgY2hlY2sgd2hldGhlciB0aGUgYWRkcmVzcyBpcyByZWdpc3RlcmVkIGZvciB0b2tlbiBzYWxlIG9yIG5vdC4KICAgKiBAcGFyYW0gX2FkZHIgYWRkcmVzcwogICAqLwogIG1vZGlmaWVyIG9ubHlSZWdpc3RlcmVkKGFkZHJlc3MgX2FkZHIpIHsKICAgIHJlcXVpcmUoaXNSZWdpc3RlcmVkKF9hZGRyKSk7CiAgICBfOwogIH0KICAvKioKICAgKiBAZGV2IGNoZWNrIHdoZXRoZXIgdGhlIG1zZy5zZW5kZXIgaXMgYWRtaW4gb3Igbm90CiAgICovCiAgbW9kaWZpZXIgb25seUFkbWluKCkgewogICAgcmVxdWlyZShhZG1pblttc2cuc2VuZGVyXSk7CiAgICBfOwogIH0KICBmdW5jdGlvbiBLWUMoKSB7CiAgICBhZG1pblttc2cuc2VuZGVyXSA9IHRydWU7CiAgfQogIC8qKgogICAqIEBkZXYgc2V0IG5ldyBhZG1pbiBhcyBhZG1pbiBvZiBLWUMgY29udHJhY3QKICAgKiBAcGFyYW0gX2FkZHIgYWRkcmVzcyBUaGUgYWRkcmVzcyB0byBzZXQgYXMgYWRtaW4gb2YgS1lDIGNvbnRyYWN0CiAgICovCiAgZnVuY3Rpb24gc2V0QWRtaW4oYWRkcmVzcyBfYWRkcikKICAgIHB1YmxpYwogICAgb25seU93bmVyCiAgewogICAgcmVxdWlyZShfYWRkciAhPSBhZGRyZXNzKDApICYmIGFkbWluW19hZGRyXSA9PSBmYWxzZSk7CiAgICBhZG1pbltfYWRkcl0gPSB0cnVlOwogICAgTmV3QWRtaW4oX2FkZHIpOwogIH0KICAvKioKICAgKiBAZGV2IGNoZWNrIHRoZSBhZGRyZXNzIGlzIHJlZ2lzdGVyIGZvciB0b2tlbiBzYWxlCiAgICogQHBhcmFtIF9hZGRyIGFkZHJlc3MgVGhlIGFkZHJlc3MgdG8gY2hlY2sgd2hldGhlciByZWdpc3RlciBvciBub3QKICAgKi8KICBmdW5jdGlvbiBpc1JlZ2lzdGVyZWQoYWRkcmVzcyBfYWRkcikKICAgIHB1YmxpYwogICAgY29uc3RhbnQKICAgIHJldHVybnMgKGJvb2wpCiAgewogICAgcmV0dXJuIHJlZ2lzdGVyZWRBZGRyZXNzW19hZGRyXTsKICB9CiAgLyoqCiAgICogQGRldiByZWdpc3RlciB0aGUgYWRkcmVzcyBmb3IgdG9rZW4gc2FsZQogICAqIEBwYXJhbSBfYWRkciBhZGRyZXNzIFRoZSBhZGRyZXNzIHRvIHJlZ2lzdGVyIGZvciB0b2tlbiBzYWxlCiAgICovCiAgZnVuY3Rpb24gcmVnaXN0ZXIoYWRkcmVzcyBfYWRkcikKICAgIHB1YmxpYwogICAgb25seUFkbWluCiAgICB3aGVuTm90UGF1c2VkCiAgewogICAgcmVxdWlyZShfYWRkciAhPSBhZGRyZXNzKDApICYmIHJlZ2lzdGVyZWRBZGRyZXNzW19hZGRyXSA9PSBmYWxzZSk7CiAgICByZWdpc3RlcmVkQWRkcmVzc1tfYWRkcl0gPSB0cnVlOwogICAgUmVnaXN0ZXJlZChfYWRkcik7CiAgfQogIC8qKgogICAqIEBkZXYgcmVnaXN0ZXIgdGhlIGFkZHJlc3NlcyBmb3IgdG9rZW4gc2FsZQogICAqIEBwYXJhbSBfYWRkcnMgYWRkcmVzc1tdIFRoZSBhZGRyZXNzZXMgdG8gcmVnaXN0ZXIgZm9yIHRva2VuIHNhbGUKICAgKi8KICBmdW5jdGlvbiByZWdpc3RlckJ5TGlzdChhZGRyZXNzW10gX2FkZHJzKQogICAgcHVibGljCiAgICBvbmx5QWRtaW4KICAgIHdoZW5Ob3RQYXVzZWQKICB7CiAgICBmb3IodWludDI1NiBpID0gMDsgaSA8IF9hZGRycy5sZW5ndGg7IGkrKykgewogICAgICByZXF1aXJlKF9hZGRyc1tpXSAhPSBhZGRyZXNzKDApICYmIHJlZ2lzdGVyZWRBZGRyZXNzW19hZGRyc1tpXV0gPT0gZmFsc2UpOwogICAgICByZWdpc3RlcmVkQWRkcmVzc1tfYWRkcnNbaV1dID0gdHJ1ZTsKICAgICAgUmVnaXN0ZXJlZChfYWRkcnNbaV0pOwogICAgfQogIH0KICAvKioKICAgKiBAZGV2IHVucmVnaXN0ZXIgdGhlIHJlZ2lzdGVyZWQgYWRkcmVzcwogICAqIEBwYXJhbSBfYWRkciBhZGRyZXNzIFRoZSBhZGRyZXNzIHRvIHVucmVnaXN0ZXIgZm9yIHRva2VuIHNhbGUKICAgKi8KICBmdW5jdGlvbiB1bnJlZ2lzdGVyKGFkZHJlc3MgX2FkZHIpCiAgICBwdWJsaWMKICAgIG9ubHlBZG1pbgogICAgb25seVJlZ2lzdGVyZWQoX2FkZHIpCiAgewogICAgcmVnaXN0ZXJlZEFkZHJlc3NbX2FkZHJdID0gZmFsc2U7CiAgICBVbnJlZ2lzdGVyZWQoX2FkZHIpOwogIH0KICAvKioKICAgKiBAZGV2IHVucmVnaXN0ZXIgdGhlIHJlZ2lzdGVyZWQgYWRkcmVzc2VzCiAgICogQHBhcmFtIF9hZGRycyBhZGRyZXNzW10gVGhlIGFkZHJlc3NlcyB0byB1bnJlZ2lzdGVyIGZvciB0b2tlbiBzYWxlCiAgICovCiAgZnVuY3Rpb24gdW5yZWdpc3RlckJ5TGlzdChhZGRyZXNzW10gX2FkZHJzKQogICAgcHVibGljCiAgICBvbmx5QWRtaW4KICB7CiAgICBmb3IodWludDI1NiBpID0gMDsgaSA8IF9hZGRycy5sZW5ndGg7IGkrKykgewogICAgICByZXF1aXJlKGlzUmVnaXN0ZXJlZChfYWRkcnNbaV0pKTsKICAgICAgcmVnaXN0ZXJlZEFkZHJlc3NbX2FkZHJzW2ldXSA9IGZhbHNlOwogICAgICBVbnJlZ2lzdGVyZWQoX2FkZHJzW2ldKTsKICAgIH0KICB9Cn0KLyoqCiAqIEB0aXRsZSBQTENDcm93ZHNhbGUKICogQGRldiBQTENDcm93ZHNhbGUgaXMgYSBiYXNlIGNvbnRyYWN0IGZvciBtYW5hZ2luZyBhIHRva2VuIGNyb3dkc2FsZS4KICogQ3Jvd2RzYWxlcyBoYXZlIGEgc3RhcnQgYW5kIGVuZCB0aW1lc3RhbXBzLCB3aGVyZSBpbnZlc3RvcnMgY2FuIG1ha2UKICogdG9rZW4gcHVyY2hhc2VzIGFuZCB0aGUgY3Jvd2RzYWxlIHdpbGwgYXNzaWduIHRoZW0gdG9rZW5zIGJhc2VkCiAqIG9uIGEgdG9rZW4gcGVyIEVUSCByYXRlLiBGdW5kcyBjb2xsZWN0ZWQgYXJlIGZvcndhcmRlZCB0byBhIHdhbGxldAogKiBhcyB0aGV5IGFycml2ZS4KICovCmNvbnRyYWN0IFBMQ0Nyb3dkc2FsZSBpcyBPd25hYmxlLCBTYWZlTWF0aCwgUGF1c2FibGUgewogIC8vIHRva2VuIHJlZ2lzdGVyeSBjb250cmFjdAogIEtZQyBwdWJsaWMga3ljOwogIC8vIFRoZSB0b2tlbiBiZWluZyBzb2xkCiAgUExDIHB1YmxpYyB0b2tlbjsKICAvLyBzdGFydCBhbmQgZW5kIHRpbWVzdGFtcHMgd2hlcmUgaW52ZXN0bWVudHMgYXJlIGFsbG93ZWQgKGJvdGggaW5jbHVzaXZlKQogIHVpbnQ2NCBwdWJsaWMgc3RhcnRUaW1lOyAvLyAxNTA2Mzg0MDAwOyAvLzIwMTcuOS4yNiAxMjowMCBhbSAoVVRDKQogIHVpbnQ2NCBwdWJsaWMgZW5kVGltZTsgLy8gMTUwNzU5MzYwMDsgLy8yMDE3LjEwLjEwIDEyOjAwIGFtIChVVEMpCiAgdWludDY0WzVdIHB1YmxpYyBkZWFkbGluZXM7IC8vIFsxNTA2NjQzMjAwLCAxNTA2OTAyNDAwLCAxNTA3MTYxNjAwLCAxNTA3NDIwODAwLCAxNTA3NTkzNjAwXTsgLy8gWzIwMTcuOS4yNiwgMjAxNy4xMC4wMiwgMjAxNy4xMC4wNSwgMjAxNy4xMC4wOCwgMjAxNy4xMC4xMF0KICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBwcmVzYWxlUmF0ZTsKICB1aW50OFs1XSBwdWJsaWMgcmF0ZXMgPSBbMjQwLCAyMzAsIDIyMCwgMjEwLCAyMDBdOwogIC8vIGFtb3VudCBvZiByYWlzZWQgbW9uZXkgaW4gd2VpCiAgdWludDI1NiBwdWJsaWMgd2VpUmFpc2VkOwogIC8vIGFtb3VudCBvZiBldGhlciBidXllciBjYW4gYnV5CiAgdWludDI1NiBjb25zdGFudCBwdWJsaWMgbWF4R3VhcmFudGVlZExpbWl0ID0gNTAwMCBldGhlcjsKICAvLyBhbW91bnQgb2YgZXRoZXIgcHJlc2FsZSBidXllciBjYW4gYnV5CiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgcHJlc2FsZUd1YXJhbnRlZWRMaW1pdDsKICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBpc0RlZmVycmVkOwogIC8vIGFtb3VudCBvZiBldGhlciBmdW5kZWQgZm9yIGVhY2ggYnV5ZXIKICAvLyBib29sOiB0cnVlIGlmIGRlZmVycmVkIG90aGVyd2lzZSBmYWxzZQogIG1hcHBpbmcgKGJvb2wgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgcHVibGljIGJ1eWVyRnVuZGVkOwogIC8vIGFtb3VudCBvZiB0b2tlbnMgbWludGVkIGZvciBkZWZlcnJlZEJ1eWVycwogIHVpbnQyNTYgcHVibGljIGRlZmVycmVkVG90YWxUb2tlbnM7CiAgLy8gYnV5YWJsZSBpbnRlcnZhbCBpbiBibG9jayBudW1iZXIgMjAKICB1aW50MjU2IGNvbnN0YW50IHB1YmxpYyBtYXhDYWxsRnJlcXVlbmN5ID0gMjA7CiAgLy8gYmxvY2sgbnVtYmVyIHdoZW4gYnV5ZXIgYnV5CiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgbGFzdENhbGxCbG9jazsKICBib29sIHB1YmxpYyBpc0ZpbmFsaXplZCA9IGZhbHNlOwogIC8vIG1pbmltdW0gYW1vdW50IG9mIGZ1bmRzIHRvIGJlIHJhaXNlZCBpbiB3ZWlzCiAgdWludDI1NiBwdWJsaWMgbWF4RXRoZXJDYXA7IC8vIDEwMDAwMCBldGhlcjsKICB1aW50MjU2IHB1YmxpYyBtaW5FdGhlckNhcDsgLy8gMzAwMDAgZXRoZXI7CiAgLy8gaW52ZXN0b3IgYWRkcmVzcyBsaXN0CiAgYWRkcmVzc1tdIGJ1eWVyTGlzdDsKICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIGluQnV5ZXJMaXN0OwogIC8vIG51bWJlciBvZiByZWZ1bmRlZCBpbnZlc3RvcnMKICB1aW50MjU2IHJlZnVuZENvbXBsZXRlZDsKICAvLyBuZXcgb3duZXIgb2YgdG9rZW4gY29udHJhY3Qgd2hlbiBjcm93ZHNhbGUgaXMgRmluYWxpemVkCiAgYWRkcmVzcyBuZXdUb2tlbk93bmVyID0gMHg1NjhFMkI1ZTk2NDNEMzhlNkQ4MTQ2RmVFOGQ4MGExMzUwYjJGMUI5OwogIC8vIHJlZnVuZCB2YXVsdCB1c2VkIHRvIGhvbGQgZnVuZHMgd2hpbGUgY3Jvd2RzYWxlIGlzIHJ1bm5pbmcKICBSZWZ1bmRWYXVsdCBwdWJsaWMgdmF1bHQ7CiAgLy8gZGV2IHRlYW0gbXVsdGlzaWcgd2FsbGV0CiAgYWRkcmVzcyBkZXZNdWx0aXNpZzsKICAvLyByZXNlcnZlCiAgYWRkcmVzc1tdIHJlc2VydmVXYWxsZXQ7CiAgLyoqCiAgICogQGRldiBDaGVja3Mgd2hldGhlciBidXllciBpcyBzZW5kaW5nIHRyYW5zYWN0aW9uIHRvbyBmcmVxdWVudGx5CiAgICovCiAgbW9kaWZpZXIgY2FuQnV5SW5CbG9jayAoKSB7CiAgICByZXF1aXJlKGFkZChsYXN0Q2FsbEJsb2NrW21zZy5zZW5kZXJdLCBtYXhDYWxsRnJlcXVlbmN5KSA8IGJsb2NrLm51bWJlcik7CiAgICBsYXN0Q2FsbEJsb2NrW21zZy5zZW5kZXJdID0gYmxvY2subnVtYmVyOwogICAgXzsKICB9CiAgLyoqCiAgICogQGRldiBDaGVja3Mgd2hldGhlciBpY28gaXMgc3RhcnRlZAogICAqLwogIG1vZGlmaWVyIG9ubHlBZnRlclN0YXJ0KCkgewogICAgcmVxdWlyZShub3cgPj0gc3RhcnRUaW1lICYmIG5vdyA8PSBlbmRUaW1lKTsKICAgIF87CiAgfQogIC8qKgogICAqIEBkZXYgQ2hlY2tzIHdoZXRoZXIgaWNvIGlzIG5vdCBzdGFydGVkCiAgICovCiAgbW9kaWZpZXIgb25seUJlZm9yZVN0YXJ0KCkgewogICAgcmVxdWlyZShub3cgPCBzdGFydFRpbWUpOwogICAgXzsKICB9CiAgLyoqCiAgICogQGRldiBDaGVja3Mgd2hldGhlciB0aGUgYWNjb3VudCBpcyByZWdpc3RlcmVkCiAgICovCiAgbW9kaWZpZXIgb25seVJlZ2lzdGVyZWQoYWRkcmVzcyBfYWRkcikgewogICAgcmVxdWlyZShreWMuaXNSZWdpc3RlcmVkKF9hZGRyKSk7CiAgICBfOwogIH0KICAvKioKICAgKiBldmVudCBmb3IgdG9rZW4gcHVyY2hhc2UgbG9nZ2luZwogICAqIEBwYXJhbSBwdXJjaGFzZXIgd2hvIHBhaWQgZm9yIHRoZSB0b2tlbnMKICAgKiBAcGFyYW0gYmVuZWZpY2lhcnkgd2hvIGdvdCB0aGUgdG9rZW5zCiAgICogQHBhcmFtIHZhbHVlIHdlaXMgcGFpZCBmb3IgcHVyY2hhc2UKICAgKiBAcGFyYW0gYW1vdW50IGFtb3VudCBvZiB0b2tlbnMgcHVyY2hhc2VkCiAgICovCiAgZXZlbnQgVG9rZW5QdXJjaGFzZShhZGRyZXNzIGluZGV4ZWQgcHVyY2hhc2VyLCBhZGRyZXNzIGluZGV4ZWQgYmVuZWZpY2lhcnksIHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgYW1vdW50KTsKICBldmVudCBQcmVzYWxlVG9rZW5QdXJjaGFzZShhZGRyZXNzIGluZGV4ZWQgcHVyY2hhc2VyLCBhZGRyZXNzIGluZGV4ZWQgYmVuZWZpY2lhcnksIHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgYW1vdW50KTsKICBldmVudCBEZWZlcnJlZFByZXNhbGVUb2tlblB1cmNoYXNlKGFkZHJlc3MgaW5kZXhlZCBwdXJjaGFzZXIsIGFkZHJlc3MgaW5kZXhlZCBiZW5lZmljaWFyeSwgdWludDI1NiB2YWx1ZSwgdWludDI1NiBhbW91bnQpOwogIC8qKgogICAqIGV2ZW50IGZvciBmaW5hbGl6ZSBsb2dnaW5nCiAgICovCiAgZXZlbnQgRmluYWxpemVkKCk7CiAgLyoqCiAgICogZXZlbnQgZm9yIHJlZ2lzdGVyIHByZXNhbGUgbG9nZ2luZwogICAqIEBwYXJhbSBwcmVzYWxlSW52ZXN0b3Igd2hvIHJlZ2lzdGVyIGZvciBwcmVzYWxlCiAgICogQHBhcmFtIHByZXNhbGVBbW91bnQgd2VpcyBwcmVzYWxlSW52ZXN0b3IgY2FuIGJ1eSBhcyBwcmVzYWxlCiAgICogQHBhcmFtIF9wcmVzYWxlUmF0ZSByYXRlIGF0IHdoaWNoIHByZXNhbGVJbnZlc3RvciBjYW4gYnV5IHRva2VucwogICAqIEBwYXJhbSBfaXNEZWZlcnJlZCB3aGV0aGVyIHRoZSBpbnZlc3RvciBpcyBkZWZlcnJlZCBpbnZlc3RvcgogICAqLwogIGV2ZW50IFJlZ2lzdGVyUHJlc2FsZShhZGRyZXNzIGluZGV4ZWQgcHJlc2FsZUludmVzdG9yLCB1aW50MjU2IHByZXNhbGVBbW91bnQsIHVpbnQyNTYgX3ByZXNhbGVSYXRlLCBib29sIF9pc0RlZmVycmVkKTsKICAvKioKICAgKiBldmVudCBmb3IgdW5yZWdpc3RlciBwcmVzYWxlIGxvZ2dpbmcKICAgKiBAcGFyYW0gcHJlc2FsZUludmVzdG9yIHdobyByZWdpc3RlciBmb3IgcHJlc2FsZQogICAqLwogIGV2ZW50IFVucmVnaXN0ZXJQcmVzYWxlKGFkZHJlc3MgaW5kZXhlZCBwcmVzYWxlSW52ZXN0b3IpOwogIC8qKgogICAqIEBkZXYgUExDQ3Jvd2RzYWxlIGNvbnN0cnVjdG9yIHNldHMgdmFyaWFibGVzCiAgICogQHBhcmFtIF9reWMgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCBLWUMgY29udHJhY3QgaXMgZGVwbG95ZWQgYXQKICAgKiBAcGFyYW0gX3Rva2VuIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggUExDIGNvbnRyYWN0IGlzIGRlcGxveWVkIGF0CiAgICogQHBhcmFtIF9yZWZ1bmRWYXVsdCBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIFJlZnVuZFZhdWx0IGlzIGRlcGxveWVkIGF0CiAgICogQHBhcmFtIF9kZXZNdWx0aXNpZyBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIE11bHRpU2lnV2FsbGV0IGZvciBkZXZUZWFtIGlzIGRlcGxveWVkIGF0CiAgICogQHBhcmFtIF9yZXNlcnZlV2FsbGV0IGFkZHJlc3NbNV0gVGhlIGFkZHJlc3MgbGlzdCBvZiByZXNlcnZlV2FsbGV0IGFkZHJlc3NlcwogICAqIEBwYXJhbSBfdGltZWxpbmVzIHVpbnQ2NFs1XSBsaXN0IG9mIHRpbWVsaW5lcyBmcm9tIHN0YXJ0VGltZSB0byBlbmRUaW1lIHdpdGggdGltZWxpbmVzIGZvciByYXRlIGNoYW5nZXMKICAgKiBAcGFyYW0gX21heEV0aGVyQ2FwIHVpbnQyNTYgVGhlIHZhbHVlIHdoaWNoIG1heGltdW0gd2VpcyB0byBiZSBmdW5kZWQKICAgKiBAcGFyYW0gX21pbkV0aGVyQ2FwIHVpbnQyNTYgVGhlIHZhbHVlIHdoaWNoIG1pbmltdW0gd2VpcyB0byBiZSBmdW5kZWQKICAgKi8KICBmdW5jdGlvbiBQTENDcm93ZHNhbGUoCiAgICBhZGRyZXNzIF9reWMsCiAgICBhZGRyZXNzIF90b2tlbiwKICAgIGFkZHJlc3MgX3JlZnVuZFZhdWx0LAogICAgYWRkcmVzcyBfZGV2TXVsdGlzaWcsCiAgICBhZGRyZXNzW10gX3Jlc2VydmVXYWxsZXQsCiAgICB1aW50NjRbNl0gX3RpbWVsaW5lcywgLy8gW3N0YXJ0VGltZSwgLi4uICwgZW5kVGltZV0KICAgIHVpbnQyNTYgX21heEV0aGVyQ2FwLAogICAgdWludDI1NiBfbWluRXRoZXJDYXApCiAgewogICAgLy90aW1lbGluZXMgY2hlY2sKICAgIGZvcih1aW50OCBpID0gMDsgaSA8IF90aW1lbGluZXMubGVuZ3RoLTE7IGkrKyl7CiAgICAgIHJlcXVpcmUoX3RpbWVsaW5lc1tpXSA8IF90aW1lbGluZXNbaSsxXSk7CiAgICB9CiAgICByZXF1aXJlKF90aW1lbGluZXNbMF0gPj0gbm93KTsKICAgIC8vYWRkcmVzcyBjaGVjawogICAgcmVxdWlyZShfa3ljICE9IDB4MDAgJiYgX3Rva2VuICE9IDB4MDAgJiYgX3JlZnVuZFZhdWx0ICE9IDB4MDAgJiYgX2Rldk11bHRpc2lnICE9IDB4MDApOwogICAgZm9yKGkgPSAwOyBpIDwgX3Jlc2VydmVXYWxsZXQubGVuZ3RoOyBpKyspewogICAgICByZXF1aXJlKF9yZXNlcnZlV2FsbGV0W2ldICE9IDB4MDApOwogICAgfQogICAgLy9jYXAgY2hlY2sKICAgIHJlcXVpcmUoX21pbkV0aGVyQ2FwIDwgX21heEV0aGVyQ2FwKTsKICAgIGt5YyAgID0gS1lDKF9reWMpOwogICAgdG9rZW4gPSBQTEMoX3Rva2VuKTsKICAgIHZhdWx0ID0gUmVmdW5kVmF1bHQoX3JlZnVuZFZhdWx0KTsKICAgIGRldk11bHRpc2lnICAgPSBfZGV2TXVsdGlzaWc7CiAgICByZXNlcnZlV2FsbGV0ID0gX3Jlc2VydmVXYWxsZXQ7CiAgICBzdGFydFRpbWUgICAgPSBfdGltZWxpbmVzWzBdOwogICAgZW5kVGltZSAgICAgID0gX3RpbWVsaW5lc1s1XTsKICAgIGRlYWRsaW5lc1swXSA9IF90aW1lbGluZXNbMV07CiAgICBkZWFkbGluZXNbMV0gPSBfdGltZWxpbmVzWzJdOwogICAgZGVhZGxpbmVzWzJdID0gX3RpbWVsaW5lc1szXTsKICAgIGRlYWRsaW5lc1szXSA9IF90aW1lbGluZXNbNF07CiAgICBkZWFkbGluZXNbNF0gPSBfdGltZWxpbmVzWzVdOwogICAgbWF4RXRoZXJDYXAgID0gX21heEV0aGVyQ2FwOwogICAgbWluRXRoZXJDYXAgID0gX21pbkV0aGVyQ2FwOwogIH0KICAvKioKICAgKiBAZGV2IFBMQ0Nyb3dkc2FsZSBmYWxsYmFjayBmdW5jdGlvbiBmb3IgYnV5aW5nIFRva2VucwogICAqLwogIGZ1bmN0aW9uICgpIHBheWFibGUgewogICAgaWYoaXNEZWZlcnJlZFttc2cuc2VuZGVyXSkKICAgICAgYnV5RGVmZXJyZWRQcmVzYWxlVG9rZW5zKG1zZy5zZW5kZXIpOwogICAgZWxzZSBpZihub3cgPCBzdGFydFRpbWUpCiAgICAgIGJ1eVByZXNhbGVUb2tlbnMobXNnLnNlbmRlcik7CiAgICBlbHNlCiAgICAgIGJ1eVRva2VucygpOwogIH0KICAvKioKICAgKiBAZGV2IHB1c2ggYWxsIHRva2VuIGJ1eWVycyBpbiBsaXN0CiAgICogQHBhcmFtIF9hZGRyIGFkZHJlc3MgQWNjb3VudCB0byBwdXNoIGludG8gYnV5ZXJMaXN0CiAgICovCiAgZnVuY3Rpb24gcHVzaEJ1eWVyTGlzdChhZGRyZXNzIF9hZGRyKSBpbnRlcm5hbCB7CiAgICBpZiAoIWluQnV5ZXJMaXN0W19hZGRyXSkgewogICAgICBpbkJ1eWVyTGlzdFtfYWRkcl0gPSB0cnVlOwogICAgICBidXllckxpc3QucHVzaChfYWRkcik7CiAgICB9CiAgfQogIC8qKgogICAqIEBkZXYgcmVnaXN0ZXIgcHJlc2FsZSBhY2NvdW50IGNoZWNraW5nIG1vZGlmaWVyCiAgICogQHBhcmFtIHByZXNhbGVJbnZlc3RvciBhZGRyZXNzIFRoZSBhY2NvdW50IHRvIHJlZ2lzdGVyIGFzIHByZXNhbGUgYWNjb3VudAogICAqIEBwYXJhbSBwcmVzYWxlQW1vdW50IHVpbnQyNTYgVGhlIHZhbHVlIHdoaWNoIGludmVzdG9yIGlzIGFsbG93ZWQgdG8gYnV5CiAgICogQHBhcmFtIF9wcmVzYWxlUmF0ZSB1aW50MjU2IFRoZSByYXRlIGF0IHdoaWNoIGludmVzdG9yIGJ1eSB0b2tlbnMKICAgKiBAcGFyYW0gX2lzRGVmZXJyZWQgYm9vbCB3aGV0aGVyIHByZXNhbGVJbnZlc3RvciBpcyBkZWZlcnJlZCBidXllcgogICAqLwogIGZ1bmN0aW9uIHJlZ2lzdGVyUHJlc2FsZShhZGRyZXNzIHByZXNhbGVJbnZlc3RvciwgdWludDI1NiBwcmVzYWxlQW1vdW50LCB1aW50MjU2IF9wcmVzYWxlUmF0ZSwgYm9vbCBfaXNEZWZlcnJlZCkKICAgIG9ubHlCZWZvcmVTdGFydAogICAgb25seU93bmVyCiAgewogICAgcmVxdWlyZShwcmVzYWxlSW52ZXN0b3IgIT0gMHgwMCk7CiAgICByZXF1aXJlKHByZXNhbGVBbW91bnQgPiAwKTsKICAgIHJlcXVpcmUoX3ByZXNhbGVSYXRlID4gMCk7CiAgICByZXF1aXJlKHByZXNhbGVHdWFyYW50ZWVkTGltaXRbcHJlc2FsZUludmVzdG9yXSA9PSAwKTsKICAgIHByZXNhbGVHdWFyYW50ZWVkTGltaXRbcHJlc2FsZUludmVzdG9yXSA9IHByZXNhbGVBbW91bnQ7CiAgICBwcmVzYWxlUmF0ZVtwcmVzYWxlSW52ZXN0b3JdID0gX3ByZXNhbGVSYXRlOwogICAgaXNEZWZlcnJlZFtwcmVzYWxlSW52ZXN0b3JdID0gX2lzRGVmZXJyZWQ7CiAgICBpZihfaXNEZWZlcnJlZCkgewogICAgICB3ZWlSYWlzZWQgPSBhZGQod2VpUmFpc2VkLCBwcmVzYWxlQW1vdW50KTsKICAgICAgdWludDI1NiBkZWZlcnJlZEludmVzdG9yVG9rZW4gPSBtdWwocHJlc2FsZUFtb3VudCwgX3ByZXNhbGVSYXRlKTsKICAgICAgdWludDI1NiBkZWZlcnJlZERldlRva2VuID0gZGl2KG11bChkZWZlcnJlZEludmVzdG9yVG9rZW4sIDIwKSwgNzApOwogICAgICB1aW50MjU2IGRlZmVycmVkUmVzZXJ2ZVRva2VuID0gZGl2KG11bChkZWZlcnJlZEludmVzdG9yVG9rZW4sIDEwKSwgNzApOwogICAgICB1aW50MjU2IHRvdGFsQW1vdW50ID0gYWRkKGRlZmVycmVkSW52ZXN0b3JUb2tlbiwgYWRkKGRlZmVycmVkRGV2VG9rZW4sIGRlZmVycmVkUmVzZXJ2ZVRva2VuKSk7CiAgICAgIHRva2VuLm1pbnQoYWRkcmVzcyh0aGlzKSwgdG90YWxBbW91bnQpOwogICAgICBkZWZlcnJlZFRvdGFsVG9rZW5zID0gYWRkKGRlZmVycmVkVG90YWxUb2tlbnMsIHRvdGFsQW1vdW50KTsKICAgIH0KICAgIFJlZ2lzdGVyUHJlc2FsZShwcmVzYWxlSW52ZXN0b3IsIHByZXNhbGVBbW91bnQsIF9wcmVzYWxlUmF0ZSwgX2lzRGVmZXJyZWQpOwogIH0KICAvKioKICAgKiBAZGV2IHJlZ2lzdGVyIHByZXNhbGUgYWNjb3VudCBjaGVja2luZyBtb2RpZmllcgogICAqIEBwYXJhbSBwcmVzYWxlSW52ZXN0b3IgYWRkcmVzcyBUaGUgYWNjb3VudCB0byByZWdpc3RlciBhcyBwcmVzYWxlIGFjY291bnQKICAgKi8KICBmdW5jdGlvbiB1bnJlZ2lzdGVyUHJlc2FsZShhZGRyZXNzIHByZXNhbGVJbnZlc3RvcikKICAgIG9ubHlCZWZvcmVTdGFydAogICAgb25seU93bmVyCiAgewogICAgcmVxdWlyZShwcmVzYWxlSW52ZXN0b3IgIT0gMHgwMCk7CiAgICByZXF1aXJlKHByZXNhbGVHdWFyYW50ZWVkTGltaXRbcHJlc2FsZUludmVzdG9yXSA+IDApOwogICAgdWludDI1NiBfYW1vdW50ID0gcHJlc2FsZUd1YXJhbnRlZWRMaW1pdFtwcmVzYWxlSW52ZXN0b3JdOwogICAgdWludDI1NiBfcmF0ZSA9IHByZXNhbGVSYXRlW3ByZXNhbGVJbnZlc3Rvcl07CiAgICBib29sIF9pc0RlZmVycmVkID0gaXNEZWZlcnJlZFtwcmVzYWxlSW52ZXN0b3JdOwogICAgcmVxdWlyZShidXllckZ1bmRlZFtfaXNEZWZlcnJlZF1bcHJlc2FsZUludmVzdG9yXSA9PSAwKTsKICAgIHByZXNhbGVHdWFyYW50ZWVkTGltaXRbcHJlc2FsZUludmVzdG9yXSA9IDA7CiAgICBwcmVzYWxlUmF0ZVtwcmVzYWxlSW52ZXN0b3JdID0gMDsKICAgIGlzRGVmZXJyZWRbcHJlc2FsZUludmVzdG9yXSA9IGZhbHNlOwogICAgaWYoX2lzRGVmZXJyZWQpIHsKICAgICAgd2VpUmFpc2VkID0gc3ViKHdlaVJhaXNlZCwgX2Ftb3VudCk7CiAgICAgIHVpbnQyNTYgZGVmZXJyZWRJbnZlc3RvclRva2VuID0gbXVsKF9hbW91bnQsIF9yYXRlKTsKICAgICAgdWludDI1NiBkZWZlcnJlZERldlRva2VuID0gZGl2KG11bChkZWZlcnJlZEludmVzdG9yVG9rZW4sIDIwKSwgNzApOwogICAgICB1aW50MjU2IGRlZmVycmVkUmVzZXJ2ZVRva2VuID0gZGl2KG11bChkZWZlcnJlZEludmVzdG9yVG9rZW4sIDEwKSwgNzApOwogICAgICB1aW50MjU2IHRvdGFsQW1vdW50ID0gYWRkKGRlZmVycmVkSW52ZXN0b3JUb2tlbiwgYWRkKGRlZmVycmVkRGV2VG9rZW4sIGRlZmVycmVkUmVzZXJ2ZVRva2VuKSk7CiAgICAgIGRlZmVycmVkVG90YWxUb2tlbnMgPSBzdWIoZGVmZXJyZWRUb3RhbFRva2VucywgdG90YWxBbW91bnQpOwogICAgICB0b2tlbi5idXJuKHRvdGFsQW1vdW50KTsKICAgIH0KICAgIFVucmVnaXN0ZXJQcmVzYWxlKHByZXNhbGVJbnZlc3Rvcik7CiAgfQogIC8qKgogICAqIEBkZXYgYnV5IHRva2VuIChkZWZlcnJlZCBwcmVzYWxlIGludmVzdG9yKQogICAqIEBwYXJhbSBiZW5lZmljaWFyeSBhZGRyZXNzIFRoZSBhY2NvdW50IHRvIHJlY2VpdmUgdG9rZW5zCiAgICovCiAgZnVuY3Rpb24gYnV5RGVmZXJyZWRQcmVzYWxlVG9rZW5zKGFkZHJlc3MgYmVuZWZpY2lhcnkpCiAgICBwYXlhYmxlCiAgICB3aGVuTm90UGF1c2VkCiAgewogICAgcmVxdWlyZShiZW5lZmljaWFyeSAhPSAweDAwKTsKICAgIHJlcXVpcmUoaXNEZWZlcnJlZFtiZW5lZmljaWFyeV0pOwogICAgdWludCBndWFyYW50ZWVkTGltaXQgPSBwcmVzYWxlR3VhcmFudGVlZExpbWl0W2JlbmVmaWNpYXJ5XTsKICAgIHJlcXVpcmUoZ3VhcmFudGVlZExpbWl0ID4gMCk7CiAgICB1aW50MjU2IHdlaUFtb3VudCA9IG1zZy52YWx1ZTsKICAgIHJlcXVpcmUod2VpQW1vdW50ICE9IDApOwogICAgdWludDI1NiB0b3RhbEFtb3VudCA9IGFkZChidXllckZ1bmRlZFt0cnVlXVtiZW5lZmljaWFyeV0sIHdlaUFtb3VudCk7CiAgICB1aW50MjU2IHRvRnVuZDsKICAgIGlmICh0b3RhbEFtb3VudCA+IGd1YXJhbnRlZWRMaW1pdCkgewogICAgICB0b0Z1bmQgPSBzdWIoZ3VhcmFudGVlZExpbWl0LCBidXllckZ1bmRlZFt0cnVlXVtiZW5lZmljaWFyeV0pOwogICAgfSBlbHNlIHsKICAgICAgdG9GdW5kID0gd2VpQW1vdW50OwogICAgfQogICAgcmVxdWlyZSh0b0Z1bmQgPiAwKTsKICAgIHJlcXVpcmUod2VpQW1vdW50ID49IHRvRnVuZCk7CiAgICB1aW50MjU2IHRva2VucyA9IG11bCh0b0Z1bmQsIHByZXNhbGVSYXRlW2JlbmVmaWNpYXJ5XSk7CiAgICB1aW50MjU2IHRvUmV0dXJuID0gc3ViKHdlaUFtb3VudCwgdG9GdW5kKTsKICAgIGJ1eShiZW5lZmljaWFyeSwgdG9rZW5zLCB0b0Z1bmQsIHRvUmV0dXJuLCB0cnVlKTsKICAgIC8vIHRva2VuIGRpc3RyaWJ1dGlvbiA6IDcwJSBmb3Igc2FsZSwgMjAlIGZvciBkZXYsIDEwJSBmb3IgcmVzZXJ2ZQogICAgdWludDI1NiBkZXZBbW91bnQgPSBkaXYobXVsKHRva2VucywgMjApLCA3MCk7CiAgICB1aW50MjU2IHJlc2VydmVBbW91bnQgPSBkaXYobXVsKHRva2VucywgMTApLCA3MCk7CiAgICBkaXN0cmlidXRlVG9rZW4oZGV2QW1vdW50LCByZXNlcnZlQW1vdW50LCB0cnVlKTsKICAgIC8vIGV0aGVyIGRpc3RyaWJ1dGlvbiA6IDEwJSBmb3IgZGV2LCA5MCUgZm9yIHJlc2VydmUKICAgIHVpbnQyNTYgZGV2RXRoZXJBbW91bnQgPSBkaXYodG9GdW5kLCAxMCk7CiAgICB1aW50MjU2IHJlc2VydmVFdGhlckFtb3VudCA9IGRpdihtdWwodG9GdW5kLCA5KSwgMTApOwogICAgZGlzdHJpYnV0ZUV0aGVyKGRldkV0aGVyQW1vdW50LCByZXNlcnZlRXRoZXJBbW91bnQpOwogICAgRGVmZXJyZWRQcmVzYWxlVG9rZW5QdXJjaGFzZShtc2cuc2VuZGVyLCBiZW5lZmljaWFyeSwgdG9GdW5kLCB0b2tlbnMpOwogIH0KICAvKioKICAgKiBAZGV2IGJ1eSB0b2tlbiAobm9ybWFsIHByZXNhbGUgaW52ZXN0b3IpCiAgICogQHBhcmFtIGJlbmVmaWNpYXJ5IGFkZHJlc3MgVGhlIGFjY291bnQgdG8gcmVjZWl2ZSB0b2tlbnMKICAgKi8KICBmdW5jdGlvbiBidXlQcmVzYWxlVG9rZW5zKGFkZHJlc3MgYmVuZWZpY2lhcnkpCiAgICBwYXlhYmxlCiAgICB3aGVuTm90UGF1c2VkCiAgICBvbmx5QmVmb3JlU3RhcnQKICB7CiAgICAvLyBjaGVjayB2YWxpZGl0eQogICAgcmVxdWlyZShiZW5lZmljaWFyeSAhPSAweDAwKTsKICAgIHJlcXVpcmUodmFsaWRQdXJjaGFzZSgpKTsKICAgIHJlcXVpcmUoIWlzRGVmZXJyZWRbYmVuZWZpY2lhcnldKTsKICAgIHVpbnQgZ3VhcmFudGVlZExpbWl0ID0gcHJlc2FsZUd1YXJhbnRlZWRMaW1pdFtiZW5lZmljaWFyeV07CiAgICByZXF1aXJlKGd1YXJhbnRlZWRMaW1pdCA+IDApOwogICAgLy8gY2FsY3VsYXRlIGV0aCBhbW91bnQKICAgIHVpbnQyNTYgd2VpQW1vdW50ID0gbXNnLnZhbHVlOwogICAgdWludDI1NiB0b3RhbEFtb3VudCA9IGFkZChidXllckZ1bmRlZFtmYWxzZV1bYmVuZWZpY2lhcnldLCB3ZWlBbW91bnQpOwogICAgdWludDI1NiB0b0Z1bmQ7CiAgICBpZiAodG90YWxBbW91bnQgPiBndWFyYW50ZWVkTGltaXQpIHsKICAgICAgdG9GdW5kID0gc3ViKGd1YXJhbnRlZWRMaW1pdCwgYnV5ZXJGdW5kZWRbZmFsc2VdW2JlbmVmaWNpYXJ5XSk7CiAgICB9IGVsc2UgewogICAgICB0b0Z1bmQgPSB3ZWlBbW91bnQ7CiAgICB9CiAgICByZXF1aXJlKHRvRnVuZCA+IDApOwogICAgcmVxdWlyZSh3ZWlBbW91bnQgPj0gdG9GdW5kKTsKICAgIHVpbnQyNTYgdG9rZW5zID0gbXVsKHRvRnVuZCwgcHJlc2FsZVJhdGVbYmVuZWZpY2lhcnldKTsKICAgIHVpbnQyNTYgdG9SZXR1cm4gPSBzdWIod2VpQW1vdW50LCB0b0Z1bmQpOwogICAgYnV5KGJlbmVmaWNpYXJ5LCB0b2tlbnMsIHRvRnVuZCwgdG9SZXR1cm4sIGZhbHNlKTsKICAgIGZvcndhcmRGdW5kcyh0b0Z1bmQpOwogICAgUHJlc2FsZVRva2VuUHVyY2hhc2UobXNnLnNlbmRlciwgYmVuZWZpY2lhcnksIHRvRnVuZCwgdG9rZW5zKTsKICB9CiAgLyoqCiAgICogQGRldiBidXkgdG9rZW4gKG5vcm1hbCBpbnZlc3RvcnMpCiAgICovCiAgZnVuY3Rpb24gYnV5VG9rZW5zKCkKICAgIHBheWFibGUKICAgIHdoZW5Ob3RQYXVzZWQKICAgIGNhbkJ1eUluQmxvY2sKICAgIG9ubHlBZnRlclN0YXJ0CiAgICBvbmx5UmVnaXN0ZXJlZChtc2cuc2VuZGVyKQogIHsKICAgIC8vIGNoZWNrIHZhbGlkaXR5CiAgICByZXF1aXJlKHZhbGlkUHVyY2hhc2UoKSk7CiAgICByZXF1aXJlKGJ1eWVyRnVuZGVkW2ZhbHNlXVttc2cuc2VuZGVyXSA8IG1heEd1YXJhbnRlZWRMaW1pdCk7CiAgICAvLyBjYWxjdWxhdGUgZXRoIGFtb3VudAogICAgdWludDI1NiB3ZWlBbW91bnQgPSBtc2cudmFsdWU7CiAgICB1aW50MjU2IHRvdGFsQW1vdW50ID0gYWRkKGJ1eWVyRnVuZGVkW2ZhbHNlXVttc2cuc2VuZGVyXSwgd2VpQW1vdW50KTsKICAgIHVpbnQyNTYgdG9GdW5kOwogICAgaWYgKHRvdGFsQW1vdW50ID4gbWF4R3VhcmFudGVlZExpbWl0KSB7CiAgICAgIHRvRnVuZCA9IHN1YihtYXhHdWFyYW50ZWVkTGltaXQsIGJ1eWVyRnVuZGVkW2ZhbHNlXVttc2cuc2VuZGVyXSk7CiAgICB9IGVsc2UgewogICAgICB0b0Z1bmQgPSB3ZWlBbW91bnQ7CiAgICB9CiAgICBpZihhZGQod2VpUmFpc2VkLHRvRnVuZCkgPiBtYXhFdGhlckNhcCkgewogICAgICB0b0Z1bmQgPSBzdWIobWF4RXRoZXJDYXAsIHdlaVJhaXNlZCk7CiAgICB9CiAgICByZXF1aXJlKHRvRnVuZCA+IDApOwogICAgcmVxdWlyZSh3ZWlBbW91bnQgPj0gdG9GdW5kKTsKICAgIHVpbnQyNTYgdG9rZW5zID0gbXVsKHRvRnVuZCwgZ2V0UmF0ZSgpKTsKICAgIHVpbnQyNTYgdG9SZXR1cm4gPSBzdWIod2VpQW1vdW50LCB0b0Z1bmQpOwogICAgYnV5KG1zZy5zZW5kZXIsIHRva2VucywgdG9GdW5kLCB0b1JldHVybiwgZmFsc2UpOwogICAgZm9yd2FyZEZ1bmRzKHRvRnVuZCk7CiAgICBUb2tlblB1cmNoYXNlKG1zZy5zZW5kZXIsIG1zZy5zZW5kZXIsIHRvRnVuZCwgdG9rZW5zKTsKICB9CiAgLyoqCiAgICogQGRldiBnZXQgYnV5IHJhdGUgZm9yIG5vdwogICAqIEByZXR1cm4gcmF0ZSB1aW50MjU2IHJhdGUgZm9yIG5vdwogICAqLwogIGZ1bmN0aW9uIGdldFJhdGUoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJhdGUpIHsKICAgIGZvcih1aW50OCBpID0gMDsgaSA8IGRlYWRsaW5lcy5sZW5ndGg7IGkrKykKICAgICAgaWYobm93IDwgZGVhZGxpbmVzW2ldKQogICAgICAgIHJldHVybiByYXRlc1tpXTsKICAgICAgcmV0dXJuIHJhdGVzW3JhdGVzLmxlbmd0aC0xXTsvL3Nob3VsZCBuZXZlciBiZSByZXR1cm5lZCwgYnV0IHRvIGJlIHN1cmUgdG8gbm90IGRpdmlkZSBieSAwCiAgfQogIC8qKgogICAqIEBkZXYgZ2V0IHRoZSBudW1iZXIgb2YgYnV5ZXJzCiAgICogQHJldHVybiB1aW50MjU2IHRoZSBudW1iZXIgb2YgYnV5ZXJzCiAgICovCiAgZnVuY3Rpb24gZ2V0QnV5ZXJOdW1iZXIoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYnV5ZXJMaXN0Lmxlbmd0aDsKICB9CiAgLyoqCiAgICogQGRldiBzZW5kIGV0aGVyIHRvIHRoZSBmdW5kIGNvbGxlY3Rpb24gd2FsbGV0CiAgICogQHBhcmFtIHRvRnVuZCB1aW50MjU2IFRoZSB2YWx1ZSBvZiB3ZWlzIHRvIHNlbmQgdG8gdmF1bHQKICAgKi8KICBmdW5jdGlvbiBmb3J3YXJkRnVuZHModWludDI1NiB0b0Z1bmQpIGludGVybmFsIHsKICAgIHZhdWx0LmRlcG9zaXQudmFsdWUodG9GdW5kKShtc2cuc2VuZGVyKTsKICB9CiAgLyoqCiAgICogQGRldiBjaGVja3Mgd2hldGhlciBwdXJjaGFzZSB2YWx1ZSBpcyBub3QgemVybyBhbmQgbWF4RXRoZXJDYXAgaXMgbm90IHJlYWNoZWQKICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlIHRyYW5zYWN0aW9uIGNhbiBidXkgdG9rZW5zCiAgICovCiAgZnVuY3Rpb24gdmFsaWRQdXJjaGFzZSgpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIGJvb2wgbm9uWmVyb1B1cmNoYXNlID0gbXNnLnZhbHVlICE9IDA7CiAgICByZXR1cm4gbm9uWmVyb1B1cmNoYXNlICYmICFtYXhSZWFjaGVkKCk7CiAgfQogIGZ1bmN0aW9uIGJ1eSgKICAgIGFkZHJlc3MgX2JlbmVmaWNpYXJ5LAogICAgdWludDI1NiBfdG9rZW5zLAogICAgdWludDI1NiBfdG9GdW5kLAogICAgdWludDI1NiBfdG9SZXR1cm4sCiAgICBib29sIF9pc0RlZmVycmVkKQogICAgaW50ZXJuYWwKICB7CiAgICBpZiAoIV9pc0RlZmVycmVkKSB7CiAgICAgIHB1c2hCdXllckxpc3QobXNnLnNlbmRlcik7CiAgICAgIHdlaVJhaXNlZCA9IGFkZCh3ZWlSYWlzZWQsIF90b0Z1bmQpOwogICAgfQogICAgYnV5ZXJGdW5kZWRbX2lzRGVmZXJyZWRdW19iZW5lZmljaWFyeV0gPSBhZGQoYnV5ZXJGdW5kZWRbX2lzRGVmZXJyZWRdW19iZW5lZmljaWFyeV0sIF90b0Z1bmQpOwogICAgaWYgKCFfaXNEZWZlcnJlZCkgewogICAgICB0b2tlbi5taW50KGFkZHJlc3ModGhpcyksIF90b2tlbnMpOwogICAgfQogICAgLy8gMSB3ZWVrIGxvY2sKICAgIHRva2VuLmdyYW50VmVzdGVkVG9rZW5zKAogICAgICBfYmVuZWZpY2lhcnksCiAgICAgIF90b2tlbnMsCiAgICAgIHVpbnQ2NChlbmRUaW1lKSwKICAgICAgdWludDY0KGVuZFRpbWUgKyAxIHdlZWtzKSwKICAgICAgdWludDY0KGVuZFRpbWUgKyAxIHdlZWtzKSwKICAgICAgZmFsc2UsCiAgICAgIGZhbHNlKTsKICAgIC8vIHJldHVybiBldGhlciBpZiBuZWVkZWQKICAgIGlmIChfdG9SZXR1cm4gPiAwKSB7CiAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoX3RvUmV0dXJuKTsKICAgIH0KICB9CiAgLyoqCiAgICogQGRldiBkaXN0cmlidXRlIHRva2VuIHRvIG11bHRpc2lnIHdhbGxldCBhbmQgcmVzZXJ2ZSB3YWxsZXRlcy4KICAgKiBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBpbiB0d28gY29udGV4dCB3aGVyZSBjcm93ZHNhbGUgaXMgY2xvc2luZyBhbmQKICAgKiBkZWZlcnJlZCB0b2tlbiBpcyBib3VnaHQuCiAgICogQHBhcmFtIGRldkFtb3VudCB1aW50MjU2IHRva2VuIGFtb3VudCBmb3IgZGV2IG11bHRpc2lnIHdhbGxldAogICAqIEBwYXJhbSByZXNlcnZlQW1vdW50IHVpbnQyNTYgdG9rZW4gYW1vdW50IGZvciByZXNlcnZlIHdhbGxldGVzCiAgICogQHBhcmFtIF9pc0RlZmVycmVkIGJvb2wgY2hlY2sgd2hldGhlciBmdW5jdGlvbiBpcyBjYWxsZWQgd2hlbiBkZWZlcnJlZCB0b2tlbiBpcyBzb2xkCiAgICovCiAgZnVuY3Rpb24gZGlzdHJpYnV0ZVRva2VuKHVpbnQyNTYgZGV2QW1vdW50LCB1aW50MjU2IHJlc2VydmVBbW91bnQsIGJvb2wgX2lzRGVmZXJyZWQpIGludGVybmFsIHsKICAgIHVpbnQyNTYgZWFjaFJlc2VydmVBbW91bnQgPSBkaXYocmVzZXJ2ZUFtb3VudCwgcmVzZXJ2ZVdhbGxldC5sZW5ndGgpOwogICAgdG9rZW4uZ3JhbnRWZXN0ZWRUb2tlbnMoCiAgICAgIGRldk11bHRpc2lnLAogICAgICBkZXZBbW91bnQsCiAgICAgIHVpbnQ2NChlbmRUaW1lKSwKICAgICAgdWludDY0KGVuZFRpbWUpLAogICAgICB1aW50NjQoZW5kVGltZSArIDEgeWVhcnMpLAogICAgICBmYWxzZSwKICAgICAgZmFsc2UpOwogICAgaWYgKF9pc0RlZmVycmVkKSB7CiAgICAgIGZvcih1aW50OCBpID0gMDsgaSA8IHJlc2VydmVXYWxsZXQubGVuZ3RoOyBpKyspIHsKICAgICAgICB0b2tlbi50cmFuc2ZlcihyZXNlcnZlV2FsbGV0W2ldLCBlYWNoUmVzZXJ2ZUFtb3VudCk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGZvcih1aW50OCBqID0gMDsgaiA8IHJlc2VydmVXYWxsZXQubGVuZ3RoOyBqKyspIHsKICAgICAgICB0b2tlbi5taW50KHJlc2VydmVXYWxsZXRbal0sIGVhY2hSZXNlcnZlQW1vdW50KTsKICAgICAgfQogICAgfQogIH0KICAvKioKICAgKiBAZGV2IGRpc3RyaWJ1dGUgZXRoZXIgdG8gbXVsdGlzaWcgd2FsbGV0IGFuZCByZXNlcnZlIHdhbGxldGVzCiAgICogQHBhcmFtIGRldkFtb3VudCB1aW50MjU2IGV0aGVyIGFtb3VudCBmb3IgZGV2IG11bHRpc2lnIHdhbGxldAogICAqIEBwYXJhbSByZXNlcnZlQW1vdW50IHVpbnQyNTYgZXRoZXIgYW1vdW50IGZvciByZXNlcnZlIHdhbGxldGVzCiAgICovCiAgZnVuY3Rpb24gZGlzdHJpYnV0ZUV0aGVyKHVpbnQyNTYgZGV2QW1vdW50LCB1aW50MjU2IHJlc2VydmVBbW91bnQpIGludGVybmFsIHsKICAgIHVpbnQyNTYgZWFjaFJlc2VydmVBbW91bnQgPSBkaXYocmVzZXJ2ZUFtb3VudCwgcmVzZXJ2ZVdhbGxldC5sZW5ndGgpOwogICAgZGV2TXVsdGlzaWcudHJhbnNmZXIoZGV2QW1vdW50KTsKICAgIGZvcih1aW50OCBpID0gMDsgaSA8IHJlc2VydmVXYWxsZXQubGVuZ3RoOyBpKyspewogICAgICByZXNlcnZlV2FsbGV0W2ldLnRyYW5zZmVyKGVhY2hSZXNlcnZlQW1vdW50KTsKICAgIH0KICB9CiAgLyoqCiAgICogQGRldiBjaGVja3Mgd2hldGhlciBjcm93ZHNhbGUgaXMgZW5kZWQKICAgKiBAcmV0dXJuIHRydWUgaWYgY3Jvd2RzYWxlIGV2ZW50IGhhcyBlbmRlZAogICAqLwogIGZ1bmN0aW9uIGhhc0VuZGVkKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBub3cgPiBlbmRUaW1lOwogIH0KICAvKioKICAgKiBAZGV2IHNob3VsZCBiZSBjYWxsZWQgYWZ0ZXIgY3Jvd2RzYWxlIGVuZHMsIHRvIGRvCiAgICovCiAgZnVuY3Rpb24gZmluYWxpemUoKSB7CiAgICByZXF1aXJlKCFpc0ZpbmFsaXplZCk7CiAgICByZXF1aXJlKGhhc0VuZGVkKCkgfHwgbWF4UmVhY2hlZCgpKTsKICAgIGZpbmFsaXphdGlvbigpOwogICAgRmluYWxpemVkKCk7CiAgICBpc0ZpbmFsaXplZCA9IHRydWU7CiAgfQogIC8qKgogICAqIEBkZXYgZW5kIHRva2VuIG1pbnRpbmcgb24gZmluYWxpemF0aW9uLCBtaW50IHRva2VucyBmb3IgZGV2IHRlYW0gYW5kIHJlc2VydmUgd2FsbGV0cwogICAqLwogIGZ1bmN0aW9uIGZpbmFsaXphdGlvbigpIGludGVybmFsIHsKICAgIGlmIChtaW5SZWFjaGVkKCkpIHsKICAgICAgdmF1bHQuY2xvc2UoKTsKICAgICAgdWludDI1NiB0b3RhbFRva2VuID0gdG9rZW4udG90YWxTdXBwbHkoKTsKICAgICAgdWludDI1NiB0b2tlblNvbGQgPSBzdWIodG90YWxUb2tlbiwgZGVmZXJyZWRUb3RhbFRva2Vucyk7CiAgICAgIC8vIHRva2VuIGRpc3RyaWJ1dGlvbiA6IDcwJSBmb3Igc2FsZSwgMjAlIGZvciBkZXYsIDEwJSBmb3IgcmVzZXJ2ZQogICAgICB1aW50MjU2IGRldkFtb3VudCA9IGRpdihtdWwodG9rZW5Tb2xkLCAyMCksIDcwKTsKICAgICAgdWludDI1NiByZXNlcnZlQW1vdW50ID0gZGl2KG11bCh0b2tlblNvbGQsIDEwKSwgNzApOwogICAgICB0b2tlbi5taW50KGFkZHJlc3ModGhpcyksIGRldkFtb3VudCk7CiAgICAgIGRpc3RyaWJ1dGVUb2tlbihkZXZBbW91bnQsIHJlc2VydmVBbW91bnQsIGZhbHNlKTsKICAgIH0gZWxzZSB7CiAgICAgIHZhdWx0LmVuYWJsZVJlZnVuZHMoKTsKICAgIH0KICAgIHRva2VuLmZpbmlzaE1pbnRpbmcoKTsKICAgIHRva2VuLnRyYW5zZmVyT3duZXJzaGlwKG5ld1Rva2VuT3duZXIpOwogIH0KICAvKioKICAgKiBAZGV2IHNob3VsZCBiZSBjYWxsZWQgd2hlbiBldGhlcmV1bSBpcyBmb3JrZWQgZHVyaW5nIGNyb3dkc2FsZSBmb3IgcmVmdW5kaW5nIGV0aGVycyBvbiBub3Qgc3VwcG9ydGVkIGZvcmsKICAgKi8KICBmdW5jdGlvbiBmaW5hbGl6ZVdoZW5Gb3JrZWQoKSBvbmx5T3duZXIgd2hlblBhdXNlZCB7CiAgICByZXF1aXJlKCFpc0ZpbmFsaXplZCk7CiAgICBpc0ZpbmFsaXplZCA9IHRydWU7CiAgICB2YXVsdC5lbmFibGVSZWZ1bmRzKCk7CiAgICB0b2tlbi5maW5pc2hNaW50aW5nKCk7CiAgfQogIC8qKgogICAqIEBkZXYgcmVmdW5kIGEgbG90IG9mIGludmVzdG9ycyBhdCBhIHRpbWUgY2hlY2tpbmcgb25seU93bmVyCiAgICogQHBhcmFtIG51bVRvUmVmdW5kIHVpbnQyNTYgVGhlIG51bWJlciBvZiBpbnZlc3RvcnMgdG8gcmVmdW5kCiAgICovCiAgZnVuY3Rpb24gcmVmdW5kQWxsKHVpbnQyNTYgbnVtVG9SZWZ1bmQpIG9ubHlPd25lciB7CiAgICByZXF1aXJlKGlzRmluYWxpemVkKTsKICAgIHJlcXVpcmUoIW1pblJlYWNoZWQoKSk7CiAgICByZXF1aXJlKG51bVRvUmVmdW5kID4gMCk7CiAgICB1aW50MjU2IGxpbWl0ID0gcmVmdW5kQ29tcGxldGVkICsgbnVtVG9SZWZ1bmQ7CiAgICBpZiAobGltaXQgPiBidXllckxpc3QubGVuZ3RoKSB7CiAgICAgIGxpbWl0ID0gYnV5ZXJMaXN0Lmxlbmd0aDsKICAgIH0KICAgIGZvcih1aW50MjU2IGkgPSByZWZ1bmRDb21wbGV0ZWQ7IGkgPCBsaW1pdDsgaSsrKSB7CiAgICAgIHZhdWx0LnJlZnVuZChidXllckxpc3RbaV0pOwogICAgfQogICAgcmVmdW5kQ29tcGxldGVkID0gbGltaXQ7CiAgfQogIC8qKgogICAqIEBkZXYgaWYgY3Jvd2RzYWxlIGlzIHVuc3VjY2Vzc2Z1bCwgaW52ZXN0b3JzIGNhbiBjbGFpbSByZWZ1bmRzIGhlcmUKICAgKiBAcGFyYW0gaW52ZXN0b3IgYWRkcmVzcyBUaGUgYWNjb3VudCB0byBiZSByZWZ1bmRlZAogICAqLwogIGZ1bmN0aW9uIGNsYWltUmVmdW5kKGFkZHJlc3MgaW52ZXN0b3IpIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoaXNGaW5hbGl6ZWQpOwogICAgcmVxdWlyZSghbWluUmVhY2hlZCgpKTsKICAgIHJldHVybiB2YXVsdC5yZWZ1bmQoaW52ZXN0b3IpOwogIH0KICAvKioKICAgKiBAZGV2IENoZWNrcyB3aGV0aGVyIG1heEV0aGVyQ2FwIGlzIHJlYWNoZWQKICAgKiBAcmV0dXJuIHRydWUgaWYgbWF4IGV0aGVyIGNhcCBpcyByZWFjZWQKICAgKi8KICBmdW5jdGlvbiBtYXhSZWFjaGVkKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiB3ZWlSYWlzZWQgPT0gbWF4RXRoZXJDYXA7CiAgfQogIC8qKgogICAqIEBkZXYgQ2hlY2tzIHdoZXRoZXIgbWluRXRoZXJDYXAgaXMgcmVhY2hlZAogICAqIEByZXR1cm4gdHJ1ZSBpZiBtaW4gZXRoZXIgY2FwIGlzIHJlYWNlZAogICAqLwogIGZ1bmN0aW9uIG1pblJlYWNoZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHdlaVJhaXNlZCA+PSBtaW5FdGhlckNhcDsKICB9CiAgLyoqCiAgICogQGRldiBzaG91bGQgYnVybiB1bnBhaWQgdG9rZW5zIG9mIGRlZmVycmVkIHByZXNhbGUgaW52ZXN0b3JzCiAgICovCiAgZnVuY3Rpb24gYnVyblVucGFpZFRva2VucygpCiAgICBvbmx5T3duZXIKICB7CiAgICByZXF1aXJlKGlzRmluYWxpemVkKTsKICAgIHVpbnQyNTYgdW5wYWlkVG9rZW5zID0gdG9rZW4uYmFsYW5jZU9mKGFkZHJlc3ModGhpcykpOwogICAgdG9rZW4uYnVybih1bnBhaWRUb2tlbnMpOwogIH0KfQ=='.
	

]
