Class {
	#name : #SRTe03070d46c30b30cfc792fa3b586f2b71be89ad1,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTe03070d46c30b30cfc792fa3b586f2b71be89ad1 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMjE7CgppbnRlcmZhY2UgaXRva2VuIHsKICAgIGZ1bmN0aW9uIGZyZWV6ZUFjY291bnQoYWRkcmVzcyBfdGFyZ2V0LCBib29sIF9mcmVlemUpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gZnJlZXplQWNjb3VudFBhcnRpYWx5KGFkZHJlc3MgX3RhcmdldCwgdWludDI1NiBfdmFsdWUpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgZXh0ZXJuYWwgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKTsKICAgIC8vIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gZnJvemVuQWNjb3VudChhZGRyZXNzIF9hY2NvdW50KSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gZnJvemVuQW1vdW50KGFkZHJlc3MgX2FjY291bnQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1Nik7Cn0KCmxpYnJhcnkgU2FmZU1hdGggewoKICAvKioKICAqIEBkZXYgTXVsdGlwbGllcyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93LgogICovCiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGlmIChhID09IDApIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgLyoqCiAgKiBAZGV2IEludGVnZXIgZGl2aXNpb24gb2YgdHdvIG51bWJlcnMsIHRydW5jYXRpbmcgdGhlIHF1b3RpZW50LgogICovCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICAvKioKICAqIEBkZXYgU3VidHJhY3RzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cgKGkuZS4gaWYgc3VidHJhaGVuZCBpcyBncmVhdGVyIHRoYW4gbWludWVuZCkuCiAgKi8KICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICAvKioKICAqIEBkZXYgQWRkcyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93LgogICovCiAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKCiAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIHByZXZpb3VzT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBuZXdPd25lcik7CgoKICAvKioKICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgKiBhY2NvdW50LgogICAqLwogIGZ1bmN0aW9uIE93bmFibGUoKSBwdWJsaWMgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZShuZXdPd25lciAhPSBhZGRyZXNzKDApKTsKICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBuZXdPd25lcik7CiAgICBvd25lciA9IG5ld093bmVyOwogIH0KCn0KCmNvbnRyYWN0IENsYWltYWJsZSBpcyBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBwZW5kaW5nT3duZXI7CgogIC8qKgogICAqIEBkZXYgTW9kaWZpZXIgdGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBwZW5kaW5nT3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seVBlbmRpbmdPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBwZW5kaW5nT3duZXIpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHNldCB0aGUgcGVuZGluZ093bmVyIGFkZHJlc3MuCiAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgIHBlbmRpbmdPd25lciA9IG5ld093bmVyOwogIH0KCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIHBlbmRpbmdPd25lciBhZGRyZXNzIHRvIGZpbmFsaXplIHRoZSB0cmFuc2Zlci4KICAgKi8KICBmdW5jdGlvbiBjbGFpbU93bmVyc2hpcCgpIG9ubHlQZW5kaW5nT3duZXIgcHVibGljIHsKICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBwZW5kaW5nT3duZXIpOwogICAgb3duZXIgPSBwZW5kaW5nT3duZXI7CiAgICBwZW5kaW5nT3duZXIgPSBhZGRyZXNzKDApOwogIH0KfQoKY29udHJhY3QgT3duZXJDb250cmFjdCBpcyBDbGFpbWFibGUgewogICAgQ2xhaW1hYmxlIHB1YmxpYyBvd25lZENvbnRyYWN0OwogICAgYWRkcmVzcyBpbnRlcm5hbCBvcmlnT3duZXI7CgogICAgLyoqCiAgICAgKiBAZGV2IGJpbmQgYSBjb250cmFjdCBhcyBpdHMgb3duZXIKICAgICAqCiAgICAgKiBAcGFyYW0gX2NvbnRyYWN0IHRoZSBjb250cmFjdCBhZGRyZXNzIHRoYXQgd2lsbCBiZSBiaW5kZWQgYnkgdGhpcyBPd25lciBDb250cmFjdAogICAgICovCiAgICBmdW5jdGlvbiBiaW5kQ29udHJhY3QoYWRkcmVzcyBfY29udHJhY3QpIG9ubHlPd25lciBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoX2NvbnRyYWN0ICE9IGFkZHJlc3MoMCkpOwogICAgICAgIG93bmVkQ29udHJhY3QgPSBDbGFpbWFibGUoX2NvbnRyYWN0KTsKICAgICAgICBvcmlnT3duZXIgPSBvd25lZENvbnRyYWN0Lm93bmVyKCk7CgogICAgICAgIC8vIHRha2Ugb3duZXJzaGlwIG9mIHRoZSBvd25lZCBjb250cmFjdAogICAgICAgIG93bmVkQ29udHJhY3QuY2xhaW1Pd25lcnNoaXAoKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IGNoYW5nZSB0aGUgb3duZXIgb2YgdGhlIGNvbnRyYWN0IGZyb20gdGhpcyBjb250cmFjdCBhZGRyZXNzIHRvIHRoZSBvcmlnaW5hbCBvbmUuCiAgICAgKgogICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcEJhY2soKSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICBvd25lZENvbnRyYWN0LnRyYW5zZmVyT3duZXJzaGlwKG9yaWdPd25lcik7CiAgICAgICAgb3duZWRDb250cmFjdCA9IENsYWltYWJsZShhZGRyZXNzKDApKTsKICAgICAgICBvcmlnT3duZXIgPSBhZGRyZXNzKDApOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBjaGFuZ2UgdGhlIG93bmVyIG9mIHRoZSBjb250cmFjdCBmcm9tIHRoaXMgY29udHJhY3QgYWRkcmVzcyB0byBhbm90aGVyIG9uZS4KICAgICAqCiAgICAgKiBAcGFyYW0gX25leHRPd25lciB0aGUgY29udHJhY3QgYWRkcmVzcyB0aGF0IHdpbGwgYmUgbmV4dCBPd25lciBvZiB0aGUgb3JpZ2luYWwgQ29udHJhY3QKICAgICAqLwogICAgZnVuY3Rpb24gY2hhbmdlT3duZXJzaGlwdG8oYWRkcmVzcyBfbmV4dE93bmVyKSAgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgb3duZWRDb250cmFjdC50cmFuc2Zlck93bmVyc2hpcChfbmV4dE93bmVyKTsKICAgICAgICBvd25lZENvbnRyYWN0ID0gQ2xhaW1hYmxlKGFkZHJlc3MoMCkpOwogICAgICAgIG9yaWdPd25lciA9IGFkZHJlc3MoMCk7CiAgICB9Cn0KCmNvbnRyYWN0IFJlbGVhc2VUb2tlbiBpcyBPd25lckNvbnRyYWN0IHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAgIC8vIHJlY29yZCBsb2NrIHRpbWUgcGVyaW9kIGFuZCByZWxhdGVkIHRva2VuIGFtb3VudAogICAgc3RydWN0IFRpbWVSZWMgewogICAgICAgIHVpbnQyNTYgYW1vdW50OwogICAgICAgIHVpbnQyNTYgcmVtYWluOwogICAgICAgIHVpbnQyNTYgZW5kVGltZTsKICAgICAgICB1aW50MjU2IHJlbGVhc2VQZXJpb2RFbmRUaW1lOwogICAgfQoKICAgIGl0b2tlbiBpbnRlcm5hbCBvd25lZDsKCiAgICBhZGRyZXNzW10gcHVibGljIGZyb3plbkFjY291bnRzOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBUaW1lUmVjW10pIGZyb3plblRpbWVzOwogICAgLy8gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSByZWxlYXNlZEFtb3VudHM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHByZVJlbGVhc2VBbW91bnRzOwoKICAgIGV2ZW50IFJlbGVhc2VGdW5kcyhhZGRyZXNzIF90YXJnZXQsIHVpbnQyNTYgX2Ftb3VudCk7CgogICAgLyoqCiAgICAgKiBAZGV2IGJpbmQgYSBjb250cmFjdCBhcyBpdHMgb3duZXIKICAgICAqCiAgICAgKiBAcGFyYW0gX2NvbnRyYWN0IHRoZSBjb250cmFjdCBhZGRyZXNzIHRoYXQgd2lsbCBiZSBiaW5kZWQgYnkgdGhpcyBPd25lciBDb250cmFjdAogICAgICovCiAgICBmdW5jdGlvbiBiaW5kQ29udHJhY3QoYWRkcmVzcyBfY29udHJhY3QpIG9ubHlPd25lciBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoX2NvbnRyYWN0ICE9IGFkZHJlc3MoMCkpOwogICAgICAgIG93bmVkID0gaXRva2VuKF9jb250cmFjdCk7CiAgICAgICAgcmV0dXJuIHN1cGVyLmJpbmRDb250cmFjdChfY29udHJhY3QpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiByZW1vdmUgYW4gYWNjb3VudCBmcm9tIHRoZSBmcm96ZW4gYWNjb3VudHMgbGlzdAogICAgICoKICAgICAqIEBwYXJhbSBfaW5kIHRoZSBpbmRleCBvZiB0aGUgYWNjb3VudCBpbiB0aGUgbGlzdAogICAgICovCiAgICBmdW5jdGlvbiByZW1vdmVBY2NvdW50KHVpbnQgX2luZCkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoX2luZCA8IGZyb3plbkFjY291bnRzLmxlbmd0aCk7CgogICAgICAgIHVpbnQyNTYgaSA9IF9pbmQ7CiAgICAgICAgd2hpbGUgKGkgPCBmcm96ZW5BY2NvdW50cy5sZW5ndGguc3ViKDEpKSB7CiAgICAgICAgICAgIGZyb3plbkFjY291bnRzW2ldID0gZnJvemVuQWNjb3VudHNbaS5hZGQoMSldOwogICAgICAgICAgICBpID0gaS5hZGQoMSk7CiAgICAgICAgfQoKICAgICAgICBkZWxldGUgZnJvemVuQWNjb3VudHNbZnJvemVuQWNjb3VudHMubGVuZ3RoLnN1YigxKV07CiAgICAgICAgZnJvemVuQWNjb3VudHMubGVuZ3RoID0gZnJvemVuQWNjb3VudHMubGVuZ3RoLnN1YigxKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgcmVtb3ZlIGEgdGltZSByZWNvcmRzIGZyb20gdGhlIHRpbWUgcmVjb3JkcyBsaXN0IG9mIG9uZSBhY2NvdW50CiAgICAgKgogICAgICogQHBhcmFtIF90YXJnZXQgdGhlIGFjY291bnQgdGhhdCBob2xkcyBhIGxpc3Qgb2YgdGltZSByZWNvcmRzIHdoaWNoIHJlY29yZCB0aGUgZnJlZXplIHBlcmlvZAogICAgICovCiAgICBmdW5jdGlvbiByZW1vdmVMb2NrZWRUaW1lKGFkZHJlc3MgX3RhcmdldCwgdWludCBfaW5kKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfdGFyZ2V0ICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICBUaW1lUmVjW10gc3RvcmFnZSBsb2NrZWRUaW1lcyA9IGZyb3plblRpbWVzW190YXJnZXRdOwogICAgICAgIHJlcXVpcmUoX2luZCA8IGxvY2tlZFRpbWVzLmxlbmd0aCk7CgogICAgICAgIHVpbnQyNTYgaSA9IF9pbmQ7CiAgICAgICAgd2hpbGUgKGkgPCBsb2NrZWRUaW1lcy5sZW5ndGguc3ViKDEpKSB7CiAgICAgICAgICAgIGxvY2tlZFRpbWVzW2ldID0gbG9ja2VkVGltZXNbaS5hZGQoMSldOwogICAgICAgICAgICBpID0gaS5hZGQoMSk7CiAgICAgICAgfQoKICAgICAgICBkZWxldGUgbG9ja2VkVGltZXNbbG9ja2VkVGltZXMubGVuZ3RoLnN1YigxKV07CiAgICAgICAgbG9ja2VkVGltZXMubGVuZ3RoID0gbG9ja2VkVGltZXMubGVuZ3RoLnN1YigxKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgZ2V0IHRvdGFsIHJlbWFpbiBsb2NrZWQgdG9rZW5zIG9mIGFuIGFjY291bnQKICAgICAqCiAgICAgKiBAcGFyYW0gX2FjY291bnQgdGhlIG93bmVyIG9mIHNvbWUgYW1vdW50IG9mIHRva2VucwogICAgICovCiAgICBmdW5jdGlvbiBnZXRSZW1haW5Mb2NrZWRPZihhZGRyZXNzIF9hY2NvdW50KSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmVxdWlyZShfYWNjb3VudCAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgdWludDI1NiB0b3RhbFJlbWFpbiA9IDA7CiAgICAgICAgdWludDI1NiBsZW4gPSBmcm96ZW5BY2NvdW50cy5sZW5ndGg7CiAgICAgICAgdWludDI1NiBpID0gMDsKICAgICAgICB3aGlsZSAoaSA8IGxlbikgewogICAgICAgICAgICBhZGRyZXNzIGZyb3plbkFkZHIgPSBmcm96ZW5BY2NvdW50c1tpXTsKICAgICAgICAgICAgaWYgKGZyb3plbkFkZHIgPT0gX2FjY291bnQpIHsKICAgICAgICAgICAgICAgIHVpbnQyNTYgdGltZVJlY0xlbiA9IGZyb3plblRpbWVzW2Zyb3plbkFkZHJdLmxlbmd0aDsKICAgICAgICAgICAgICAgIHVpbnQyNTYgaiA9IDA7CiAgICAgICAgICAgICAgICB3aGlsZSAoaiA8IHRpbWVSZWNMZW4pIHsKICAgICAgICAgICAgICAgICAgICBUaW1lUmVjIHN0b3JhZ2UgdGltZVBhaXIgPSBmcm96ZW5UaW1lc1tmcm96ZW5BZGRyXVtqXTsKICAgICAgICAgICAgICAgICAgICB0b3RhbFJlbWFpbiA9IHRvdGFsUmVtYWluLmFkZCh0aW1lUGFpci5yZW1haW4pOwoKICAgICAgICAgICAgICAgICAgICBqID0gai5hZGQoMSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGkgPSBpLmFkZCgxKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0b3RhbFJlbWFpbjsKICAgIH0KCiAgICAvKioKICAgICAqIGp1ZGdlIHdoZXRoZXIgd2UgbmVlZCB0byByZWxlYXNlIHNvbWUgb2YgdGhlIGxvY2tlZCB0b2tlbgogICAgICoKICAgICAqLwogICAgZnVuY3Rpb24gbmVlZFJlbGVhc2UoKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgdWludDI1NiBsZW4gPSBmcm96ZW5BY2NvdW50cy5sZW5ndGg7CiAgICAgICAgdWludDI1NiBpID0gMDsKICAgICAgICB3aGlsZSAoaSA8IGxlbikgewogICAgICAgICAgICBhZGRyZXNzIGZyb3plbkFkZHIgPSBmcm96ZW5BY2NvdW50c1tpXTsKICAgICAgICAgICAgdWludDI1NiB0aW1lUmVjTGVuID0gZnJvemVuVGltZXNbZnJvemVuQWRkcl0ubGVuZ3RoOwogICAgICAgICAgICB1aW50MjU2IGogPSAwOwogICAgICAgICAgICB3aGlsZSAoaiA8IHRpbWVSZWNMZW4pIHsKICAgICAgICAgICAgICAgIFRpbWVSZWMgc3RvcmFnZSB0aW1lUGFpciA9IGZyb3plblRpbWVzW2Zyb3plbkFkZHJdW2pdOwogICAgICAgICAgICAgICAgaWYgKG5vdyA+PSB0aW1lUGFpci5lbmRUaW1lKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaiA9IGouYWRkKDEpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpID0gaS5hZGQoMSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IGZyZWV6ZSB0aGUgYW1vdW50IG9mIHRva2VucyBvZiBhbiBhY2NvdW50CiAgICAgKgogICAgICogQHBhcmFtIF90YXJnZXQgdGhlIG93bmVyIG9mIHNvbWUgYW1vdW50IG9mIHRva2VucwogICAgICogQHBhcmFtIF92YWx1ZSB0aGUgYW1vdW50IG9mIHRoZSB0b2tlbnMKICAgICAqIEBwYXJhbSBfZnJvemVuRW5kVGltZSB0aGUgZW5kIHRpbWUgb2YgdGhlIGxvY2sgcGVyaW9kLCB1bml0IGlzIHNlY29uZAogICAgICogQHBhcmFtIF9yZWxlYXNlUGVyaW9kIHRoZSBsb2NraW5nIHBlcmlvZCwgdW5pdCBpcyBzZWNvbmQKICAgICAqLwogICAgZnVuY3Rpb24gZnJlZXplKGFkZHJlc3MgX3RhcmdldCwgdWludDI1NiBfdmFsdWUsIHVpbnQyNTYgX2Zyb3plbkVuZFRpbWUsIHVpbnQyNTYgX3JlbGVhc2VQZXJpb2QpIG9ubHlPd25lciBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIC8vcmVxdWlyZShfdG9rZW5BZGRyICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX3RhcmdldCAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF92YWx1ZSA+IDApOwogICAgICAgIHJlcXVpcmUoX2Zyb3plbkVuZFRpbWUgPiAwKTsKCiAgICAgICAgdWludDI1NiBsZW4gPSBmcm96ZW5BY2NvdW50cy5sZW5ndGg7CgogICAgICAgIHVpbnQyNTYgaSA9IDA7CiAgICAgICAgZm9yICg7IGkgPCBsZW47IGkgPSBpLmFkZCgxKSkgewogICAgICAgICAgICBpZiAoZnJvemVuQWNjb3VudHNbaV0gPT0gX3RhcmdldCkgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChpID49IGxlbikgewogICAgICAgICAgICBmcm96ZW5BY2NvdW50cy5wdXNoKF90YXJnZXQpOyAvLyBhZGQgbmV3IGFjY291bnQKICAgICAgICB9CgogICAgICAgIC8vIGVhY2ggdGltZSB0aGUgbmV3IGxvY2tlZCB0aW1lIHdpbGwgYmUgYWRkZWQgdG8gdGhlIGJhY2tlbmQKICAgICAgICBmcm96ZW5UaW1lc1tfdGFyZ2V0XS5wdXNoKFRpbWVSZWMoX3ZhbHVlLCBfdmFsdWUsIF9mcm96ZW5FbmRUaW1lLCBfZnJvemVuRW5kVGltZS5hZGQoX3JlbGVhc2VQZXJpb2QpKSk7CiAgICAgICAgaWYgKG93bmVkLmZyb3plbkFjY291bnQoX3RhcmdldCkpIHsKICAgICAgICAgICAgdWludDI1NiBwcmVGcm96ZW5BbW91bnQgPSBvd25lZC5mcm96ZW5BbW91bnQoX3RhcmdldCk7CiAgICAgICAgICAgIG93bmVkLmZyZWV6ZUFjY291bnRQYXJ0aWFseShfdGFyZ2V0LCBfdmFsdWUuYWRkKHByZUZyb3plbkFtb3VudCkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG93bmVkLmZyZWV6ZUFjY291bnRQYXJ0aWFseShfdGFyZ2V0LCBfdmFsdWUpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IHRyYW5zZmVyIGFuIGFtb3VudCBvZiB0b2tlbnMgdG8gYW4gYWNjb3VudCwgYW5kIHRoZW4gZnJlZXplIHRoZSB0b2tlbnMKICAgICAqCiAgICAgKiBAcGFyYW0gX3RhcmdldCB0aGUgYWNjb3VudCBhZGRyZXNzIHRoYXQgd2lsbCBob2xkIGFuIGFtb3VudCBvZiB0aGUgdG9rZW5zCiAgICAgKiBAcGFyYW0gX3ZhbHVlIHRoZSBhbW91bnQgb2YgdGhlIHRva2VucyB3aGljaCBoYXMgYmVlbiB0cmFuc2ZlcnJlZAogICAgICogQHBhcmFtIF9mcm96ZW5FbmRUaW1lIHRoZSBlbmQgdGltZSBvZiB0aGUgbG9jayBwZXJpb2QsIHVuaXQgaXMgc2Vjb25kCiAgICAgKiBAcGFyYW0gX3JlbGVhc2VQZXJpb2QgdGhlIGxvY2tpbmcgcGVyaW9kLCB1bml0IGlzIHNlY29uZAogICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlckFuZEZyZWV6ZShhZGRyZXNzIF90YXJnZXQsIHVpbnQyNTYgX3ZhbHVlLCB1aW50MjU2IF9mcm96ZW5FbmRUaW1lLCB1aW50MjU2IF9yZWxlYXNlUGVyaW9kKSBvbmx5T3duZXIgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICAvL3JlcXVpcmUoX3Rva2VuT3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfdGFyZ2V0ICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX3ZhbHVlID4gMCk7CiAgICAgICAgcmVxdWlyZShfZnJvemVuRW5kVGltZSA+IDApOwoKICAgICAgICAvLyBjaGVjayBmaXJzdGx5IHRoYXQgdGhlIGFsbG93YW5jZSBvZiB0aGlzIGNvbnRyYWN0IGhhcyBiZWVuIHNldAogICAgICAgIHJlcXVpcmUob3duZWQuYWxsb3dhbmNlKG1zZy5zZW5kZXIsIHRoaXMpID4gMCk7CgogICAgICAgIC8vIG5vdyB3ZSBuZWVkIHRyYW5zZmVyIHRoZSBmdW5kcyBiZWZvcmUgZnJlZXplIHRoZW0KICAgICAgICByZXF1aXJlKG93bmVkLnRyYW5zZmVyRnJvbShtc2cuc2VuZGVyLCBfdGFyZ2V0LCBfdmFsdWUpKTsKCiAgICAgICAgLy8gZnJlZXplIHRoZSBhY2NvdW50IGFmdGVyIHRyYW5zZmVyaW5nIGZ1bmRzCiAgICAgICAgaWYgKCFmcmVlemUoX3RhcmdldCwgX3ZhbHVlLCBfZnJvemVuRW5kVGltZSwgX3JlbGVhc2VQZXJpb2QpKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogcmVsZWFzZSB0aGUgdG9rZW4gd2hpY2ggYXJlIGxvY2tlZCBmb3Igb25jZSBhbmQgd2lsbCBiZSB0b3RhbCByZWxlYXNlZCBhdCBvbmNlCiAgICAgKiBhZnRlciB0aGUgZW5kIHBvaW50IG9mIHRoZSBsb2NrIHBlcmlvZAogICAgICovCiAgICBmdW5jdGlvbiByZWxlYXNlQWxsT25jZUxvY2soKSBvbmx5T3duZXIgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICAvL3JlcXVpcmUoX3Rva2VuQWRkciAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgdWludDI1NiBsZW4gPSBmcm96ZW5BY2NvdW50cy5sZW5ndGg7CiAgICAgICAgdWludDI1NiBpID0gMDsKICAgICAgICB3aGlsZSAoaSA8IGxlbikgewogICAgICAgICAgICBhZGRyZXNzIHRhcmdldCA9IGZyb3plbkFjY291bnRzW2ldOwogICAgICAgICAgICBpZiAoZnJvemVuVGltZXNbdGFyZ2V0XS5sZW5ndGggPT0gMSAmJiBmcm96ZW5UaW1lc1t0YXJnZXRdWzBdLmVuZFRpbWUgPT0gZnJvemVuVGltZXNbdGFyZ2V0XVswXS5yZWxlYXNlUGVyaW9kRW5kVGltZSAmJiBmcm96ZW5UaW1lc1t0YXJnZXRdWzBdLmVuZFRpbWUgPiAwICYmIG5vdyA+PSBmcm96ZW5UaW1lc1t0YXJnZXRdWzBdLmVuZFRpbWUpIHsKICAgICAgICAgICAgICAgIHVpbnQyNTYgcmVsZWFzZWRBbW91bnQgPSBmcm96ZW5UaW1lc1t0YXJnZXRdWzBdLmFtb3VudDsKCiAgICAgICAgICAgICAgICAvLyByZW1vdmUgY3VycmVudCByZWxlYXNlIHBlcmlvZCB0aW1lIHJlY29yZAogICAgICAgICAgICAgICAgaWYgKCFyZW1vdmVMb2NrZWRUaW1lKHRhcmdldCwgMCkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gcmVtb3ZlIHRoZSBmcm96ZSBhY2NvdW50CiAgICAgICAgICAgICAgICBpZiAoIXJlbW92ZUFjY291bnQoaSkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdWludDI1NiBwcmVGcm96ZW5BbW91bnQgPSBvd25lZC5mcm96ZW5BbW91bnQodGFyZ2V0KTsKICAgICAgICAgICAgICAgIGlmIChwcmVGcm96ZW5BbW91bnQgPiByZWxlYXNlZEFtb3VudCkgewogICAgICAgICAgICAgICAgICAgIG93bmVkLmZyZWV6ZUFjY291bnRQYXJ0aWFseSh0YXJnZXQsIHByZUZyb3plbkFtb3VudC5zdWIocmVsZWFzZWRBbW91bnQpKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgb3duZWQuZnJlZXplQWNjb3VudCh0YXJnZXQsIGZhbHNlKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBSZWxlYXNlRnVuZHModGFyZ2V0LCByZWxlYXNlZEFtb3VudCk7CiAgICAgICAgICAgICAgICBsZW4gPSBsZW4uc3ViKDEpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gbm8gYWNjb3VudCBoYXMgYmVlbiByZW1vdmVkCiAgICAgICAgICAgICAgICBpID0gaS5hZGQoMSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiByZWxlYXNlIHRoZSBsb2NrZWQgdG9rZW5zIG93bmVkIGJ5IGFuIGFjY291bnQsIHdoaWNoIG9ubHkgaGF2ZSBvbmx5IG9uZSBsb2NrZWQgdGltZQogICAgICogYW5kIGRvbid0IGhhdmUgcmVsZWFzZSBzdGFnZS4KICAgICAqCiAgICAgKiBAcGFyYW0gX3RhcmdldCB0aGUgYWNjb3VudCBhZGRyZXNzIHRoYXQgaG9sZCBhbiBhbW91bnQgb2YgbG9ja2VkIHRva2VucwogICAgICovCiAgICBmdW5jdGlvbiByZWxlYXNlQWNjb3VudChhZGRyZXNzIF90YXJnZXQpIG9ubHlPd25lciBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIC8vcmVxdWlyZShfdG9rZW5BZGRyICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX3RhcmdldCAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgdWludDI1NiBsZW4gPSBmcm96ZW5BY2NvdW50cy5sZW5ndGg7CiAgICAgICAgdWludDI1NiBpID0gMDsKICAgICAgICB3aGlsZSAoaSA8IGxlbikgewogICAgICAgICAgICBhZGRyZXNzIGRlc3RBZGRyID0gZnJvemVuQWNjb3VudHNbaV07CiAgICAgICAgICAgIGlmIChkZXN0QWRkciA9PSBfdGFyZ2V0KSB7CiAgICAgICAgICAgICAgICBpZiAoZnJvemVuVGltZXNbZGVzdEFkZHJdLmxlbmd0aCA9PSAxICYmIGZyb3plblRpbWVzW2Rlc3RBZGRyXVswXS5lbmRUaW1lID09IGZyb3plblRpbWVzW2Rlc3RBZGRyXVswXS5yZWxlYXNlUGVyaW9kRW5kVGltZSAmJiBmcm96ZW5UaW1lc1tkZXN0QWRkcl1bMF0uZW5kVGltZSA+IDAgJiYgbm93ID49IGZyb3plblRpbWVzW2Rlc3RBZGRyXVswXS5lbmRUaW1lKSB7CiAgICAgICAgICAgICAgICAgICAgdWludDI1NiByZWxlYXNlZEFtb3VudCA9IGZyb3plblRpbWVzW2Rlc3RBZGRyXVswXS5hbW91bnQ7CgogICAgICAgICAgICAgICAgICAgIC8vIHJlbW92ZSBjdXJyZW50IHJlbGVhc2UgcGVyaW9kIHRpbWUgcmVjb3JkCiAgICAgICAgICAgICAgICAgICAgaWYgKCFyZW1vdmVMb2NrZWRUaW1lKGRlc3RBZGRyLCAwKSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyByZW1vdmUgdGhlIGZyb3plIGFjY291bnQKICAgICAgICAgICAgICAgICAgICBpZiAoIXJlbW92ZUFjY291bnQoaSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgdWludDI1NiBwcmVGcm96ZW5BbW91bnQgPSBvd25lZC5mcm96ZW5BbW91bnQoZGVzdEFkZHIpOwogICAgICAgICAgICAgICAgICAgIGlmIChwcmVGcm96ZW5BbW91bnQgPiByZWxlYXNlZEFtb3VudCkgewogICAgICAgICAgICAgICAgICAgICAgICBvd25lZC5mcmVlemVBY2NvdW50UGFydGlhbHkoZGVzdEFkZHIsIHByZUZyb3plbkFtb3VudC5zdWIocmVsZWFzZWRBbW91bnQpKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBvd25lZC5mcmVlemVBY2NvdW50KGRlc3RBZGRyLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBSZWxlYXNlRnVuZHMoZGVzdEFkZHIsIHJlbGVhc2VkQW1vdW50KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBpZiB0aGUgYWNjb3VudCBhcmUgbm90IGxvY2tlZCBmb3Igb25jZSwgd2Ugd2lsbCBkbyBub3RoaW5nIGhlcmUKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpID0gaS5hZGQoMSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IHJlbGVhc2UgdGhlIGxvY2tlZCB0b2tlbnMgb3duZWQgYnkgYW4gYWNjb3VudCB3aXRoIHNldmVyYWwgc3RhZ2VzCiAgICAgKiB0aGlzIG5lZWQgdGhlIGNvbnRyYWN0IGdldCBhcHByb3ZhbCBmcm9tIHRoZSBhY2NvdW50IGJ5IGNhbGwgYXBwcm92ZSgpIGluIHRoZSB0b2tlbiBjb250cmFjdAogICAgICoKICAgICAqIEBwYXJhbSBfdGFyZ2V0IHRoZSBhY2NvdW50IGFkZHJlc3MgdGhhdCBob2xkIGFuIGFtb3VudCBvZiBsb2NrZWQgdG9rZW5zCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJlbGVhc2VXaXRoU3RhZ2UoYWRkcmVzcyBfdGFyZ2V0LyosIGFkZHJlc3MgX2Rlc3QqLykgb25seU93bmVyIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgLy9yZXF1aXJlKF90b2tlbmFkZHIgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfdGFyZ2V0ICE9IGFkZHJlc3MoMCkpOwogICAgICAgIC8vIHJlcXVpcmUoX2Rlc3QgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgLy8gcmVxdWlyZShfdmFsdWUgPiAwKTsKCiAgICAgICAgLy8gY2hlY2sgZmlyc3RseSB0aGF0IHRoZSBhbGxvd2FuY2Ugb2YgdGhpcyBjb250cmFjdCBmcm9tIF90YXJnZXQgYWNjb3VudCBoYXMgYmVlbiBzZXQKICAgICAgICAvLyByZXF1aXJlKG93bmVkLmFsbG93YW5jZShfdGFyZ2V0LCB0aGlzKSA+IDApOwoKICAgICAgICB1aW50MjU2IGxlbiA9IGZyb3plbkFjY291bnRzLmxlbmd0aDsKICAgICAgICB1aW50MjU2IGkgPSAwOwogICAgICAgIHdoaWxlIChpIDwgbGVuKSB7CiAgICAgICAgICAgIC8vIGZpcnN0bHkgZmluZCB0aGUgdGFyZ2V0IGFkZHJlc3MKICAgICAgICAgICAgYWRkcmVzcyBmcm96ZW5BZGRyID0gZnJvemVuQWNjb3VudHNbaV07CiAgICAgICAgICAgIGlmIChmcm96ZW5BZGRyID09IF90YXJnZXQpIHsKICAgICAgICAgICAgICAgIHVpbnQyNTYgdGltZVJlY0xlbiA9IGZyb3plblRpbWVzW2Zyb3plbkFkZHJdLmxlbmd0aDsKCiAgICAgICAgICAgICAgICBib29sIHJlbGVhc2VkID0gZmFsc2U7CiAgICAgICAgICAgICAgICB1aW50MjU2IG5vd1RpbWUgPSBub3c7CiAgICAgICAgICAgICAgICBmb3IgKHVpbnQyNTYgaiA9IDA7IGogPCB0aW1lUmVjTGVuOyByZWxlYXNlZCA9IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gaXRlcmF0ZSBldmVyeSB0aW1lIHJlY29yZHMgdG8gY2FjdWxhdGUgaG93IG1hbnkgdG9rZW5zIG5lZWQgdG8gYmUgcmVsZWFzZWQuCiAgICAgICAgICAgICAgICAgICAgVGltZVJlYyBzdG9yYWdlIHRpbWVQYWlyID0gZnJvemVuVGltZXNbZnJvemVuQWRkcl1bal07CiAgICAgICAgICAgICAgICAgICAgaWYgKG5vd1RpbWUgPiB0aW1lUGFpci5lbmRUaW1lICYmIHRpbWVQYWlyLmVuZFRpbWUgPiAwICYmIHRpbWVQYWlyLnJlbGVhc2VQZXJpb2RFbmRUaW1lID4gdGltZVBhaXIuZW5kVGltZSkgewogICAgICAgICAgICAgICAgICAgICAgICB1aW50MjU2IGxhc3RSZWxlYXNlZCA9IHRpbWVQYWlyLmFtb3VudC5zdWIodGltZVBhaXIucmVtYWluKTsKICAgICAgICAgICAgICAgICAgICAgICAgdWludDI1NiB2YWx1ZSA9ICh0aW1lUGFpci5hbW91bnQgKiBub3dUaW1lLnN1Yih0aW1lUGFpci5lbmRUaW1lKSAvIHRpbWVQYWlyLnJlbGVhc2VQZXJpb2RFbmRUaW1lLnN1Yih0aW1lUGFpci5lbmRUaW1lKSkuc3ViKGxhc3RSZWxlYXNlZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA+IHRpbWVQYWlyLnJlbWFpbikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB0aW1lUGFpci5yZW1haW47CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRpbWVQYWlyLmVuZFRpbWUgPSBub3dUaW1lOwogICAgICAgICAgICAgICAgICAgICAgICB0aW1lUGFpci5yZW1haW4gPSB0aW1lUGFpci5yZW1haW4uc3ViKHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgUmVsZWFzZUZ1bmRzKGZyb3plbkFkZHIsIHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgcHJlUmVsZWFzZUFtb3VudHNbZnJvemVuQWRkcl0gPSBwcmVSZWxlYXNlQW1vdW50c1tmcm96ZW5BZGRyXS5hZGQodmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGltZVBhaXIucmVtYWluIDwgMWU4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXJlbW92ZUxvY2tlZFRpbWUoZnJvemVuQWRkciwgaikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWxlYXNlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lUmVjTGVuID0gdGltZVJlY0xlbi5zdWIoMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG5vd1RpbWUgPj0gdGltZVBhaXIuZW5kVGltZSAmJiB0aW1lUGFpci5lbmRUaW1lID4gMCAmJiB0aW1lUGFpci5yZWxlYXNlUGVyaW9kRW5kVGltZSA9PSB0aW1lUGFpci5lbmRUaW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVQYWlyLnJlbWFpbiA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIFJlbGVhc2VGdW5kcyhmcm96ZW5BZGRyLCB0aW1lUGFpci5hbW91bnQpOwogICAgICAgICAgICAgICAgICAgICAgICBwcmVSZWxlYXNlQW1vdW50c1tmcm96ZW5BZGRyXSA9IHByZVJlbGVhc2VBbW91bnRzW2Zyb3plbkFkZHJdLmFkZCh0aW1lUGFpci5hbW91bnQpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXJlbW92ZUxvY2tlZFRpbWUoZnJvemVuQWRkciwgaikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZWxlYXNlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVSZWNMZW4gPSB0aW1lUmVjTGVuLnN1YigxKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmICghcmVsZWFzZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaiA9IGouYWRkKDEpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyB3ZSBnb3Qgc29tZSBhbW91bnQgbmVlZCB0byBiZSByZWxlYXNlZAogICAgICAgICAgICAgICAgaWYgKHByZVJlbGVhc2VBbW91bnRzW2Zyb3plbkFkZHJdID4gMCkgewogICAgICAgICAgICAgICAgICAgIHVpbnQyNTYgcHJlUmVsZWFzZWRBbW91bnQgPSBwcmVSZWxlYXNlQW1vdW50c1tmcm96ZW5BZGRyXTsKICAgICAgICAgICAgICAgICAgICB1aW50MjU2IHByZUZyb3plbkFtb3VudCA9IG93bmVkLmZyb3plbkFtb3VudChmcm96ZW5BZGRyKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gc2V0IHRoZSBwcmUtcmVsZWFzZSBhbW91bnQgdG8gMCBmb3IgbmV4dCB0aW1lCiAgICAgICAgICAgICAgICAgICAgcHJlUmVsZWFzZUFtb3VudHNbZnJvemVuQWRkcl0gPSAwOwogICAgICAgICAgICAgICAgICAgIGlmIChwcmVGcm96ZW5BbW91bnQgPiBwcmVSZWxlYXNlZEFtb3VudCkgewogICAgICAgICAgICAgICAgICAgICAgICBvd25lZC5mcmVlemVBY2NvdW50UGFydGlhbHkoZnJvemVuQWRkciwgcHJlRnJvemVuQW1vdW50LnN1YihwcmVSZWxlYXNlZEFtb3VudCkpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG93bmVkLmZyZWV6ZUFjY291bnQoZnJvemVuQWRkciwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAvLyBpZiAoIW93bmVkLnRyYW5zZmVyRnJvbShfdGFyZ2V0LCBfZGVzdCwgcHJlUmVsZWFzZUFtb3VudHNbZnJvemVuQWRkcl0pKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAvLyB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gaWYgYWxsIHRoZSBmcm96ZW4gYW1vdW50cyBoYWQgYmVlbiByZWxlYXNlZCwgdGhlbiB1bmxvY2sgdGhlIGFjY291bnQgZmluYWxseQogICAgICAgICAgICAgICAgaWYgKGZyb3plblRpbWVzW2Zyb3plbkFkZHJdLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFyZW1vdmVBY2NvdW50KGkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IC8qZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gc3RpbGwgaGFzIHNvbWUgdG9rZW5zIG5lZWQgdG8gYmUgcmVsZWFzZWQgaW4gZnV0dXJlCiAgICAgICAgICAgICAgICAgICAgb3duZWQuZnJlZXplQWNjb3VudChmcm96ZW5BZGRyLCB0cnVlKTsKICAgICAgICAgICAgICAgIH0qLwoKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpID0gaS5hZGQoMSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IHNldCB0aGUgbmV3IGVuZHRpbWUgb2YgdGhlIHJlbGVhc2VkIHRpbWUgb2YgYW4gYWNjb3VudAogICAgICoKICAgICAqIEBwYXJhbSBfdGFyZ2V0IHRoZSBvd25lciBvZiBzb21lIGFtb3VudCBvZiB0b2tlbnMKICAgICAqIEBwYXJhbSBfb2xkRW5kVGltZSB0aGUgb3JpZ2luYWwgZW5kdGltZSBmb3IgdGhlIGxvY2sgcGVyaW9kCiAgICAgKiBAcGFyYW0gX25ld0VuZFRpbWUgdGhlIG5ldyBlbmR0aW1lIGZvciB0aGUgbG9jayBwZXJpb2QKICAgICAqLwogICAgZnVuY3Rpb24gc2V0TmV3RW5kdGltZShhZGRyZXNzIF90YXJnZXQsIHVpbnQyNTYgX29sZEVuZFRpbWUsIHVpbnQyNTYgX25ld0VuZFRpbWUpIG9ubHlPd25lciBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoX3RhcmdldCAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF9vbGRFbmRUaW1lID4gMCAmJiBfbmV3RW5kVGltZSA+IDApOwoKICAgICAgICB1aW50MjU2IGxlbiA9IGZyb3plbkFjY291bnRzLmxlbmd0aDsKICAgICAgICB1aW50MjU2IGkgPSAwOwogICAgICAgIHdoaWxlIChpIDwgbGVuKSB7CiAgICAgICAgICAgIGFkZHJlc3MgZnJvemVuQWRkciA9IGZyb3plbkFjY291bnRzW2ldOwogICAgICAgICAgICBpZiAoZnJvemVuQWRkciA9PSBfdGFyZ2V0KSB7CiAgICAgICAgICAgICAgICB1aW50MjU2IHRpbWVSZWNMZW4gPSBmcm96ZW5UaW1lc1tmcm96ZW5BZGRyXS5sZW5ndGg7CiAgICAgICAgICAgICAgICB1aW50MjU2IGogPSAwOwogICAgICAgICAgICAgICAgd2hpbGUgKGogPCB0aW1lUmVjTGVuKSB7CiAgICAgICAgICAgICAgICAgICAgVGltZVJlYyBzdG9yYWdlIHRpbWVQYWlyID0gZnJvemVuVGltZXNbZnJvemVuQWRkcl1bal07CiAgICAgICAgICAgICAgICAgICAgaWYgKF9vbGRFbmRUaW1lID09IHRpbWVQYWlyLmVuZFRpbWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdWludDI1NiBkdXJhdGlvbiA9IHRpbWVQYWlyLnJlbGVhc2VQZXJpb2RFbmRUaW1lLnN1Yih0aW1lUGFpci5lbmRUaW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGltZVBhaXIuZW5kVGltZSA9IF9uZXdFbmRUaW1lOwogICAgICAgICAgICAgICAgICAgICAgICB0aW1lUGFpci5yZWxlYXNlUGVyaW9kRW5kVGltZSA9IHRpbWVQYWlyLmVuZFRpbWUuYWRkKGR1cmF0aW9uKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaiA9IGouYWRkKDEpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaSA9IGkuYWRkKDEpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBzZXQgdGhlIG5ldyByZWxlYXNlZCBwZXJpb2QgbGVuZ3RoIG9mIGFuIGFjY291bnQKICAgICAqCiAgICAgKiBAcGFyYW0gX3RhcmdldCB0aGUgb3duZXIgb2Ygc29tZSBhbW91bnQgb2YgdG9rZW5zCiAgICAgKiBAcGFyYW0gX29yaWdFbmRUaW1lIHRoZSBvcmlnaW5hbCBlbmR0aW1lIGZvciB0aGUgbG9jayBwZXJpb2QKICAgICAqIEBwYXJhbSBfZHVyYXRpb24gdGhlIG5ldyByZWxlYXNpbmcgcGVyaW9kCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldE5ld1JlbGVhc2VQZXJpb2QoYWRkcmVzcyBfdGFyZ2V0LCB1aW50MjU2IF9vcmlnRW5kVGltZSwgdWludDI1NiBfZHVyYXRpb24pIG9ubHlPd25lciBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoX3RhcmdldCAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF9vcmlnRW5kVGltZSA+IDAgJiYgX2R1cmF0aW9uID4gMCk7CgogICAgICAgIHVpbnQyNTYgbGVuID0gZnJvemVuQWNjb3VudHMubGVuZ3RoOwogICAgICAgIHVpbnQyNTYgaSA9IDA7CiAgICAgICAgd2hpbGUgKGkgPCBsZW4pIHsKICAgICAgICAgICAgYWRkcmVzcyBmcm96ZW5BZGRyID0gZnJvemVuQWNjb3VudHNbaV07CiAgICAgICAgICAgIGlmIChmcm96ZW5BZGRyID09IF90YXJnZXQpIHsKICAgICAgICAgICAgICAgIHVpbnQyNTYgdGltZVJlY0xlbiA9IGZyb3plblRpbWVzW2Zyb3plbkFkZHJdLmxlbmd0aDsKICAgICAgICAgICAgICAgIHVpbnQyNTYgaiA9IDA7CiAgICAgICAgICAgICAgICB3aGlsZSAoaiA8IHRpbWVSZWNMZW4pIHsKICAgICAgICAgICAgICAgICAgICBUaW1lUmVjIHN0b3JhZ2UgdGltZVBhaXIgPSBmcm96ZW5UaW1lc1tmcm96ZW5BZGRyXVtqXTsKICAgICAgICAgICAgICAgICAgICBpZiAoX29yaWdFbmRUaW1lID09IHRpbWVQYWlyLmVuZFRpbWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGltZVBhaXIucmVsZWFzZVBlcmlvZEVuZFRpbWUgPSBfb3JpZ0VuZFRpbWUuYWRkKF9kdXJhdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaiA9IGouYWRkKDEpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaSA9IGkuYWRkKDEpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBnZXQgdGhlIGxvY2tlZCBzdGFnZXMgb2YgYW4gYWNjb3VudAogICAgICoKICAgICAqIEBwYXJhbSBfdGFyZ2V0IHRoZSBvd25lciBvZiBzb21lIGFtb3VudCBvZiB0b2tlbnMKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0TG9ja2VkU3RhZ2VzKGFkZHJlc3MgX3RhcmdldCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJlcXVpcmUoX3RhcmdldCAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgdWludDI1NiBsZW4gPSBmcm96ZW5BY2NvdW50cy5sZW5ndGg7CiAgICAgICAgdWludDI1NiBpID0gMDsKICAgICAgICB3aGlsZSAoaSA8IGxlbikgewogICAgICAgICAgICBhZGRyZXNzIGZyb3plbkFkZHIgPSBmcm96ZW5BY2NvdW50c1tpXTsKICAgICAgICAgICAgaWYgKGZyb3plbkFkZHIgPT0gX3RhcmdldCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZyb3plblRpbWVzW2Zyb3plbkFkZHJdLmxlbmd0aDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaSA9IGkuYWRkKDEpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IGdldCB0aGUgZW5kdGltZSBvZiB0aGUgbG9ja2VkIHN0YWdlcyBvZiBhbiBhY2NvdW50CiAgICAgKgogICAgICogQHBhcmFtIF90YXJnZXQgdGhlIG93bmVyIG9mIHNvbWUgYW1vdW50IG9mIHRva2VucwogICAgICogQHBhcmFtIF9udW0gdGhlIHN0YWdlIG51bWJlciBvZiB0aGUgcmVsZWFzaW5nIHBlcmlvZAogICAgICovCiAgICBmdW5jdGlvbiBnZXRFbmRUaW1lT2ZTdGFnZShhZGRyZXNzIF90YXJnZXQsIHVpbnQgX251bSkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJlcXVpcmUoX3RhcmdldCAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgdWludDI1NiBsZW4gPSBmcm96ZW5BY2NvdW50cy5sZW5ndGg7CiAgICAgICAgdWludDI1NiBpID0gMDsKICAgICAgICB3aGlsZSAoaSA8IGxlbikgewogICAgICAgICAgICBhZGRyZXNzIGZyb3plbkFkZHIgPSBmcm96ZW5BY2NvdW50c1tpXTsKICAgICAgICAgICAgaWYgKGZyb3plbkFkZHIgPT0gX3RhcmdldCkgewogICAgICAgICAgICAgICAgVGltZVJlYyBzdG9yYWdlIHRpbWVQYWlyID0gZnJvemVuVGltZXNbZnJvemVuQWRkcl1bX251bV07CiAgICAgICAgICAgICAgICByZXR1cm4gdGltZVBhaXIuZW5kVGltZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaSA9IGkuYWRkKDEpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IGdldCB0aGUgcmVtYWluIHVucmxlYXNlZCB0b2tlbnMgb2YgdGhlIGxvY2tlZCBzdGFnZXMgb2YgYW4gYWNjb3VudAogICAgICoKICAgICAqIEBwYXJhbSBfdGFyZ2V0IHRoZSBvd25lciBvZiBzb21lIGFtb3VudCBvZiB0b2tlbnMKICAgICAqIEBwYXJhbSBfbnVtIHRoZSBzdGFnZSBudW1iZXIgb2YgdGhlIHJlbGVhc2luZyBwZXJpb2QKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0UmVtYWluT2ZTdGFnZShhZGRyZXNzIF90YXJnZXQsIHVpbnQgX251bSkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJlcXVpcmUoX3RhcmdldCAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgdWludDI1NiBsZW4gPSBmcm96ZW5BY2NvdW50cy5sZW5ndGg7CiAgICAgICAgdWludDI1NiBpID0gMDsKICAgICAgICB3aGlsZSAoaSA8IGxlbikgewogICAgICAgICAgICBhZGRyZXNzIGZyb3plbkFkZHIgPSBmcm96ZW5BY2NvdW50c1tpXTsKICAgICAgICAgICAgaWYgKGZyb3plbkFkZHIgPT0gX3RhcmdldCkgewogICAgICAgICAgICAgICAgVGltZVJlYyBzdG9yYWdlIHRpbWVQYWlyID0gZnJvemVuVGltZXNbZnJvemVuQWRkcl1bX251bV07CiAgICAgICAgICAgICAgICByZXR1cm4gdGltZVBhaXIucmVtYWluOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpID0gaS5hZGQoMSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgZ2V0IHRoZSByZW1haW4gcmVsZWFzaW5nIHBlcmlvZCBvZiBhbiBhY2NvdW50CiAgICAgKgogICAgICogQHBhcmFtIF90YXJnZXQgdGhlIG93bmVyIG9mIHNvbWUgYW1vdW50IG9mIHRva2VucwogICAgICogQHBhcmFtIF9udW0gdGhlIHN0YWdlIG51bWJlciBvZiB0aGUgcmVsZWFzaW5nIHBlcmlvZAogICAgICovCiAgICBmdW5jdGlvbiBnZXRSZW1haW5SZWxlYXNlVGltZU9mU3RhZ2UoYWRkcmVzcyBfdGFyZ2V0LCB1aW50IF9udW0pIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXF1aXJlKF90YXJnZXQgIT0gYWRkcmVzcygwKSk7CgogICAgICAgIHVpbnQyNTYgbGVuID0gZnJvemVuQWNjb3VudHMubGVuZ3RoOwogICAgICAgIHVpbnQyNTYgaSA9IDA7CiAgICAgICAgd2hpbGUgKGkgPCBsZW4pIHsKICAgICAgICAgICAgYWRkcmVzcyBmcm96ZW5BZGRyID0gZnJvemVuQWNjb3VudHNbaV07CiAgICAgICAgICAgIGlmIChmcm96ZW5BZGRyID09IF90YXJnZXQpIHsKICAgICAgICAgICAgICAgIFRpbWVSZWMgc3RvcmFnZSB0aW1lUGFpciA9IGZyb3plblRpbWVzW2Zyb3plbkFkZHJdW19udW1dOwogICAgICAgICAgICAgICAgdWludDI1NiBub3dUaW1lID0gbm93OwogICAgICAgICAgICAgICAgaWYgKHRpbWVQYWlyLnJlbGVhc2VQZXJpb2RFbmRUaW1lID09IHRpbWVQYWlyLmVuZFRpbWUgfHwgbm93VGltZSA8PSB0aW1lUGFpci5lbmRUaW1lICkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAodGltZVBhaXIucmVsZWFzZVBlcmlvZEVuZFRpbWUuc3ViKHRpbWVQYWlyLmVuZFRpbWUpKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAodGltZVBhaXIucmVsZWFzZVBlcmlvZEVuZFRpbWUgPCBub3dUaW1lKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuICh0aW1lUGFpci5yZWxlYXNlUGVyaW9kRW5kVGltZS5zdWIobm93VGltZSkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpID0gaS5hZGQoMSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgcmVsZWFzZSB0aGUgbG9ja2VkIHRva2VucyBvd25lZCBieSBhIG51bWJlciBvZiBhY2NvdW50cwogICAgICoKICAgICAqIEBwYXJhbSBfdGFyZ2V0cyB0aGUgYWNjb3VudHMgbGlzdCB0aGF0IGhvbGQgYW4gYW1vdW50IG9mIGxvY2tlZCB0b2tlbnMKICAgICAqLwogICAgZnVuY3Rpb24gcmVsZWFzZU11bHRpQWNjb3VudHMoYWRkcmVzc1tdIF90YXJnZXRzKSBvbmx5T3duZXIgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICAvL3JlcXVpcmUoX3Rva2VuQWRkciAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF90YXJnZXRzLmxlbmd0aCAhPSAwKTsKCiAgICAgICAgYm9vbCByZXMgPSBmYWxzZTsKICAgICAgICB1aW50MjU2IGkgPSAwOwogICAgICAgIHdoaWxlIChpIDwgX3RhcmdldHMubGVuZ3RoKSB7CiAgICAgICAgICAgIHJlcyA9IHJlbGVhc2VBY2NvdW50KF90YXJnZXRzW2ldKSB8fCByZXM7CiAgICAgICAgICAgIGkgPSBpLmFkZCgxKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiByZXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IHJlbGVhc2UgdGhlIGxvY2tlZCB0b2tlbnMgb3duZWQgYnkgYW4gYWNjb3VudAogICAgICoKICAgICAqIEBwYXJhbSBfdGFyZ2V0cyB0aGUgYWNjb3VudCBhZGRyZXNzZXMgbGlzdCB0aGF0IGhvbGQgYW1vdW50cyBvZiBsb2NrZWQgdG9rZW5zCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJlbGVhc2VNdWx0aVdpdGhTdGFnZShhZGRyZXNzW10gX3RhcmdldHMpIG9ubHlPd25lciBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoX3RhcmdldHMubGVuZ3RoICE9IDApOwoKICAgICAgICBib29sIHJlcyA9IGZhbHNlOwogICAgICAgIHVpbnQyNTYgaSA9IDA7CiAgICAgICAgd2hpbGUgKGkgPCBfdGFyZ2V0cy5sZW5ndGgpIHsKICAgICAgICAgICAgcmVxdWlyZShfdGFyZ2V0c1tpXSAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgICAgIHJlcyA9IHJlbGVhc2VXaXRoU3RhZ2UoX3RhcmdldHNbaV0pIHx8IHJlczsgLy8gYXMgbG9uZyBhcyB0aGVyZSBpcyBvbmUgdHJ1ZSB0cmFuc2FjdGlvbiwgdGhlbiB0aGUgcmVzdWx0IHdpbGwgYmUgdHJ1ZQogICAgICAgICAgICBpID0gaS5hZGQoMSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmVzOwogICAgfQoKICAgICAvKioKICAgICAqIEBkZXYgZnJlZXplIG11bHRpcGxlIG9mIHRoZSBhY2NvdW50cwogICAgICoKICAgICAqIEBwYXJhbSBfdGFyZ2V0cyB0aGUgb3duZXJzIG9mIHNvbWUgYW1vdW50IG9mIHRva2VucwogICAgICogQHBhcmFtIF92YWx1ZXMgdGhlIGFtb3VudHMgb2YgdGhlIHRva2VucwogICAgICogQHBhcmFtIF9mcm96ZW5FbmRUaW1lcyB0aGUgbGlzdCBvZiB0aGUgZW5kIHRpbWUgb2YgdGhlIGxvY2sgcGVyaW9kLCB1bml0IGlzIHNlY29uZAogICAgICogQHBhcmFtIF9yZWxlYXNlUGVyaW9kcyB0aGUgbGlzdCBvZiB0aGUgbG9ja2luZyBwZXJpb2QsIHVuaXQgaXMgc2Vjb25kCiAgICAgKi8KICAgIGZ1bmN0aW9uIGZyZWV6ZU11bHRpKGFkZHJlc3NbXSBfdGFyZ2V0cywgdWludDI1NltdIF92YWx1ZXMsIHVpbnQyNTZbXSBfZnJvemVuRW5kVGltZXMsIHVpbnQyNTZbXSBfcmVsZWFzZVBlcmlvZHMpIG9ubHlPd25lciBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoX3RhcmdldHMubGVuZ3RoICE9IDApOwogICAgICAgIHJlcXVpcmUoX3ZhbHVlcy5sZW5ndGggIT0gMCk7CiAgICAgICAgcmVxdWlyZShfZnJvemVuRW5kVGltZXMubGVuZ3RoICE9IDApOwogICAgICAgIHJlcXVpcmUoX3JlbGVhc2VQZXJpb2RzLmxlbmd0aCAhPSAwKTsKICAgICAgICByZXF1aXJlKF90YXJnZXRzLmxlbmd0aCA9PSBfdmFsdWVzLmxlbmd0aCAmJiBfdmFsdWVzLmxlbmd0aCA9PSBfZnJvemVuRW5kVGltZXMubGVuZ3RoICYmIF9mcm96ZW5FbmRUaW1lcy5sZW5ndGggPT0gX3JlbGVhc2VQZXJpb2RzLmxlbmd0aCk7CgogICAgICAgIGJvb2wgcmVzID0gdHJ1ZTsKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBfdGFyZ2V0cy5sZW5ndGg7IGkgPSBpLmFkZCgxKSkgewogICAgICAgICAgICByZXF1aXJlKF90YXJnZXRzW2ldICE9IGFkZHJlc3MoMCkpOwogICAgICAgICAgICByZXMgPSBmcmVlemUoX3RhcmdldHNbaV0sIF92YWx1ZXNbaV0sIF9mcm96ZW5FbmRUaW1lc1tpXSwgX3JlbGVhc2VQZXJpb2RzW2ldKSAmJiByZXM7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmVzOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiB0cmFuc2ZlciBhIGxpc3Qgb2YgYW1vdW50cyBvZiB0b2tlbnMgdG8gYSBsaXN0IG9mIGFjY291bnRzLCBhbmQgdGhlbiBmcmVlemUgdGhlIHRva2VucwogICAgICoKICAgICAqIEBwYXJhbSBfdGFyZ2V0cyB0aGUgYWNjb3VudCBhZGRyZXNzZXMgdGhhdCB3aWxsIGhvbGQgYSBsaXN0IG9mIGFtb3VudHMgb2YgdGhlIHRva2VucwogICAgICogQHBhcmFtIF92YWx1ZXMgdGhlIGFtb3VudHMgb2YgdGhlIHRva2VucyB3aGljaCBoYXZlIGJlZW4gdHJhbnNmZXJyZWQKICAgICAqIEBwYXJhbSBfZnJvemVuRW5kVGltZXMgdGhlIGVuZCB0aW1lIGxpc3Qgb2YgdGhlIGxvY2tlZCBwZXJpb2RzLCB1bml0IGlzIHNlY29uZAogICAgICogQHBhcmFtIF9yZWxlYXNlUGVyaW9kcyB0aGUgbGlzdCBvZiBsb2NraW5nIHBlcmlvZHMsIHVuaXQgaXMgc2Vjb25kCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyQW5kRnJlZXplTXVsdGkoYWRkcmVzc1tdIF90YXJnZXRzLCB1aW50MjU2W10gX3ZhbHVlcywgdWludDI1NltdIF9mcm96ZW5FbmRUaW1lcywgdWludDI1NltdIF9yZWxlYXNlUGVyaW9kcykgb25seU93bmVyIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfdGFyZ2V0cy5sZW5ndGggIT0gMCk7CiAgICAgICAgcmVxdWlyZShfdmFsdWVzLmxlbmd0aCAhPSAwKTsKICAgICAgICByZXF1aXJlKF9mcm96ZW5FbmRUaW1lcy5sZW5ndGggIT0gMCk7CiAgICAgICAgcmVxdWlyZShfcmVsZWFzZVBlcmlvZHMubGVuZ3RoICE9IDApOwogICAgICAgIHJlcXVpcmUoX3RhcmdldHMubGVuZ3RoID09IF92YWx1ZXMubGVuZ3RoICYmIF92YWx1ZXMubGVuZ3RoID09IF9mcm96ZW5FbmRUaW1lcy5sZW5ndGggJiYgX2Zyb3plbkVuZFRpbWVzLmxlbmd0aCA9PSBfcmVsZWFzZVBlcmlvZHMubGVuZ3RoKTsKCiAgICAgICAgYm9vbCByZXMgPSB0cnVlOwogICAgICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IF90YXJnZXRzLmxlbmd0aDsgaSA9IGkuYWRkKDEpKSB7CiAgICAgICAgICAgIHJlcXVpcmUoX3RhcmdldHNbaV0gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgICAgIHJlcyA9IHRyYW5zZmVyQW5kRnJlZXplKF90YXJnZXRzW2ldLCBfdmFsdWVzW2ldLCBfZnJvemVuRW5kVGltZXNbaV0sIF9yZWxlYXNlUGVyaW9kc1tpXSkgJiYgcmVzOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJlczsKICAgIH0KfQ=='.
	

]
