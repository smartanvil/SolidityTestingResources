Class {
	#name : #SRTb1400278014f34c8243b15613a4b463b51fb6f2a,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTb1400278014f34c8243b15613a4b463b51fb6f2a >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciBwdWJsaWMgewogICAgcmVxdWlyZShuZXdPd25lciAhPSBhZGRyZXNzKDApKTsKICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBuZXdPd25lcik7CiAgICBvd25lciA9IG5ld093bmVyOwogIH0KCn0KCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKfQoKY29udHJhY3QgQmFzaWNUb2tlbiBpcyBFUkMyMEJhc2ljIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOwoKICAvKioKICAqIEBkZXYgdHJhbnNmZXIgdG9rZW4gZm9yIGEgc3BlY2lmaWVkIGFkZHJlc3MKICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8uCiAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJyZWQuCiAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKCiAgICAvLyBTYWZlTWF0aC5zdWIgd2lsbCB0aHJvdyBpZiB0aGVyZSBpcyBub3QgZW5vdWdoIGJhbGFuY2UuCiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdG8gcXVlcnkgdGhlIHRoZSBiYWxhbmNlIG9mLgogICogQHJldHVybiBBbiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcy4KICAqLwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgfQoKfQoKY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwp9Cgpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEVSQzIwLCBCYXNpY1Rva2VuIHsKCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwoKCiAgLyoqCiAgICogQGRldiBUcmFuc2ZlciB0b2tlbnMgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyCiAgICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gc2VuZCB0b2tlbnMgZnJvbQogICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAqIEBwYXJhbSBfdmFsdWUgdWludDI1NiB0aGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKCiAgICB1aW50MjU2IF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsKCiAgICAvLyBDaGVjayBpcyBub3QgbmVlZGVkIGJlY2F1c2Ugc3ViKF9hbGxvd2FuY2UsIF92YWx1ZSkgd2lsbCBhbHJlYWR5IHRocm93IGlmIHRoaXMgY29uZGl0aW9uIGlzIG5vdCBtZXQKICAgIC8vIHJlcXVpcmUgKF92YWx1ZSA8PSBfYWxsb3dhbmNlKTsKCiAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gX2FsbG93YW5jZS5zdWIoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgQXBwcm92ZSB0aGUgcGFzc2VkIGFkZHJlc3MgdG8gc3BlbmQgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIG9uIGJlaGFsZiBvZiBtc2cuc2VuZGVyLgogICAqCiAgICogQmV3YXJlIHRoYXQgY2hhbmdpbmcgYW4gYWxsb3dhbmNlIHdpdGggdGhpcyBtZXRob2QgYnJpbmdzIHRoZSByaXNrIHRoYXQgc29tZW9uZSBtYXkgdXNlIGJvdGggdGhlIG9sZAogICAqIGFuZCB0aGUgbmV3IGFsbG93YW5jZSBieSB1bmZvcnR1bmF0ZSB0cmFuc2FjdGlvbiBvcmRlcmluZy4gT25lIHBvc3NpYmxlIHNvbHV0aW9uIHRvIG1pdGlnYXRlIHRoaXMKICAgKiByYWNlIGNvbmRpdGlvbiBpcyB0byBmaXJzdCByZWR1Y2UgdGhlIHNwZW5kZXIncyBhbGxvd2FuY2UgdG8gMCBhbmQgc2V0IHRoZSBkZXNpcmVkIHZhbHVlIGFmdGVyd2FyZHM6CiAgICogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAgKi8KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBjaGVjayB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAqIEBwYXJhbSBfb3duZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCBvd25zIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3NwZW5kZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcmV0dXJuIEEgdWludDI1NiBzcGVjaWZ5aW5nIHRoZSBhbW91bnQgb2YgdG9rZW5zIHN0aWxsIGF2YWlsYWJsZSBmb3IgdGhlIHNwZW5kZXIuCiAgICovCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogIH0KCiAgLyoqCiAgICogYXBwcm92ZSBzaG91bGQgYmUgY2FsbGVkIHdoZW4gYWxsb3dlZFtfc3BlbmRlcl0gPT0gMC4gVG8gaW5jcmVtZW50CiAgICogYWxsb3dlZCB2YWx1ZSBpcyBiZXR0ZXIgdG8gdXNlIHRoaXMgZnVuY3Rpb24gdG8gYXZvaWQgMiBjYWxscyAoYW5kIHdhaXQgdW50aWwKICAgKiB0aGUgZmlyc3QgdHJhbnNhY3Rpb24gaXMgbWluZWQpCiAgICogRnJvbSBNb25vbGl0aERBTyBUb2tlbi5zb2wKICAgKi8KICBmdW5jdGlvbiBpbmNyZWFzZUFwcHJvdmFsIChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hZGRlZFZhbHVlKQogICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdLmFkZChfYWRkZWRWYWx1ZSk7CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiBkZWNyZWFzZUFwcHJvdmFsIChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9zdWJ0cmFjdGVkVmFsdWUpCiAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIHVpbnQgb2xkVmFsdWUgPSBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXTsKICAgIGlmIChfc3VidHJhY3RlZFZhbHVlID4gb2xkVmFsdWUpIHsKICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSAwOwogICAgfSBlbHNlIHsKICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBvbGRWYWx1ZS5zdWIoX3N1YnRyYWN0ZWRWYWx1ZSk7CiAgICB9CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgcmV0dXJuIHRydWU7CiAgfQoKfQoKY29udHJhY3QgTWludGFibGVUb2tlbiBpcyBTdGFuZGFyZFRva2VuLCBPd25hYmxlIHsKICBldmVudCBNaW50KGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiBhbW91bnQpOwogIGV2ZW50IE1pbnRGaW5pc2hlZCgpOwoKICBib29sIHB1YmxpYyBtaW50aW5nRmluaXNoZWQgPSBmYWxzZTsKCgogIG1vZGlmaWVyIGNhbk1pbnQoKSB7CiAgICByZXF1aXJlKCFtaW50aW5nRmluaXNoZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gbWludCB0b2tlbnMKICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCByZWNlaXZlIHRoZSBtaW50ZWQgdG9rZW5zLgogICAqIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIG1pbnQuCiAgICogQHJldHVybiBBIGJvb2xlYW4gdGhhdCBpbmRpY2F0ZXMgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bC4KICAgKi8KICBmdW5jdGlvbiBtaW50KGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIG9ubHlPd25lciBjYW5NaW50IHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LmFkZChfYW1vdW50KTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfYW1vdW50KTsKICAgIE1pbnQoX3RvLCBfYW1vdW50KTsKICAgIFRyYW5zZmVyKDB4MCwgX3RvLCBfYW1vdW50KTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBzdG9wIG1pbnRpbmcgbmV3IHRva2Vucy4KICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bC4KICAgKi8KICBmdW5jdGlvbiBmaW5pc2hNaW50aW5nKCkgb25seU93bmVyIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBtaW50aW5nRmluaXNoZWQgPSB0cnVlOwogICAgTWludEZpbmlzaGVkKCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KCmNvbnRyYWN0IEJhbGxvdCB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKICAgIEV0aGVhcm5hbFJlcFRva2VuIHB1YmxpYyB0b2tlbkNvbnRyYWN0OwoKICAgIC8vIERhdGUgd2hlbiB2b3RlIGhhcyBzdGFydGVkCiAgICB1aW50MjU2IHB1YmxpYyBiYWxsb3RTdGFydGVkOwoKICAgIC8vIFJlZ2lzdHJ5IG9mIHZvdGVzCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIHZvdGVzQnlBZGRyZXNzOwoKICAgIC8vIFN1bSBvZiB3ZWlnaHRzIG9mIFlFUyB2b3RlcwogICAgdWludDI1NiBwdWJsaWMgeWVzVm90ZVN1bSA9IDA7CgogICAgLy8gU3VtIG9mIHdlaWdodHMgb2YgTk8gdm90ZXMKICAgIHVpbnQyNTYgcHVibGljIG5vVm90ZVN1bSA9IDA7CgogICAgLy8gTGVuZ3RoIG9mIGB2b3RlcnNgCiAgICB1aW50MjU2IHB1YmxpYyB2b3RlcnNMZW5ndGggPSAwOwoKICAgIHVpbnQyNTYgcHVibGljIGluaXRpYWxRdW9ydW1QZXJjZW50ID0gNTE7CgogICAgVm90aW5nUHJveHkgcHVibGljIHByb3h5Vm90aW5nQ29udHJhY3Q7CgogICAgLy8gVGVsbHMgaWYgdm90aW5nIHByb2Nlc3MgaXMgYWN0aXZlCiAgICBib29sIHB1YmxpYyBpc1ZvdGluZ0FjdGl2ZSA9IGZhbHNlOwoKICAgIGV2ZW50IEZpbmlzaEJhbGxvdCh1aW50MjU2IF90aW1lKTsKICAgIGV2ZW50IFZvdGUoYWRkcmVzcyBpbmRleGVkIHNlbmRlciwgYnl0ZXMgdm90ZSk7CiAgICAKICAgIG1vZGlmaWVyIG9ubHlXaGVuQmFsbG90U3RhcnRlZCB7CiAgICAgICAgcmVxdWlyZShiYWxsb3RTdGFydGVkICE9IDApOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gQmFsbG90KGFkZHJlc3MgX3Rva2VuQ29udHJhY3QpIHsKICAgICAgICB0b2tlbkNvbnRyYWN0ID0gRXRoZWFybmFsUmVwVG9rZW4oX3Rva2VuQ29udHJhY3QpOwogICAgICAgIHByb3h5Vm90aW5nQ29udHJhY3QgPSBWb3RpbmdQcm94eShtc2cuc2VuZGVyKTsKICAgICAgICBiYWxsb3RTdGFydGVkID0gZ2V0VGltZSgpOwogICAgICAgIGlzVm90aW5nQWN0aXZlID0gdHJ1ZTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0UXVvcnVtUGVyY2VudCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmVxdWlyZShpc1ZvdGluZ0FjdGl2ZSk7CiAgICAgICAgLy8gZmluZCBudW1iZXIgb2YgZnVsbCB3ZWVrcyBhbGFwc2VkIHNpbmNlIHZvdGluZyBzdGFydGVkCiAgICAgICAgdWludDI1NiB3ZWVrc051bWJlciA9IGdldFRpbWUoKS5zdWIoYmFsbG90U3RhcnRlZCkuZGl2KDEgd2Vla3MpOwogICAgICAgIGlmKHdlZWtzTnVtYmVyID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIGluaXRpYWxRdW9ydW1QZXJjZW50OwogICAgICAgIH0KICAgICAgICBpZiAoaW5pdGlhbFF1b3J1bVBlcmNlbnQgPCB3ZWVrc051bWJlciAqIDEwKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBpbml0aWFsUXVvcnVtUGVyY2VudC5zdWIod2Vla3NOdW1iZXIgKiAxMCk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHZvdGUoYnl0ZXMgX3ZvdGUpIHB1YmxpYyBvbmx5V2hlbkJhbGxvdFN0YXJ0ZWQgewogICAgICAgIHJlcXVpcmUoX3ZvdGUubGVuZ3RoID4gMCk7CiAgICAgICAgaWYgKGlzRGF0YVllcyhfdm90ZSkpIHsKICAgICAgICAgICAgcHJvY2Vzc1ZvdGUodHJ1ZSk7CiAgICAgICAgfSBlbHNlIGlmIChpc0RhdGFObyhfdm90ZSkpIHsKICAgICAgICAgICAgcHJvY2Vzc1ZvdGUoZmFsc2UpOwogICAgICAgIH0KICAgICAgICBWb3RlKG1zZy5zZW5kZXIsIF92b3RlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBpc0RhdGFZZXMoYnl0ZXMgZGF0YSkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICAvLyBjb21wYXJlIGRhdGEgd2l0aCAiWUVTIiBzdHJpbmcKICAgICAgICByZXR1cm4gKAogICAgICAgICAgICBkYXRhLmxlbmd0aCA9PSAzICYmCiAgICAgICAgICAgIChkYXRhWzBdID09IDB4NTkgfHwgZGF0YVswXSA9PSAweDc5KSAmJgogICAgICAgICAgICAoZGF0YVsxXSA9PSAweDQ1IHx8IGRhdGFbMV0gPT0gMHg2NSkgJiYKICAgICAgICAgICAgKGRhdGFbMl0gPT0gMHg1MyB8fCBkYXRhWzJdID09IDB4NzMpCiAgICAgICAgKTsKICAgIH0KCiAgICAvLyBURVNURUQKICAgIGZ1bmN0aW9uIGlzRGF0YU5vKGJ5dGVzIGRhdGEpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgLy8gY29tcGFyZSBkYXRhIHdpdGggIk5PIiBzdHJpbmcKICAgICAgICByZXR1cm4gKAogICAgICAgICAgICBkYXRhLmxlbmd0aCA9PSAyICYmCiAgICAgICAgICAgIChkYXRhWzBdID09IDB4NGUgfHwgZGF0YVswXSA9PSAweDZlKSAmJgogICAgICAgICAgICAoZGF0YVsxXSA9PSAweDRmIHx8IGRhdGFbMV0gPT0gMHg2ZikKICAgICAgICApOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBwcm9jZXNzVm90ZShib29sIGlzWWVzKSBpbnRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShpc1ZvdGluZ0FjdGl2ZSk7CiAgICAgICAgcmVxdWlyZSghdm90ZXNCeUFkZHJlc3NbbXNnLnNlbmRlcl0pOwogICAgICAgIHZvdGVyc0xlbmd0aCA9IHZvdGVyc0xlbmd0aC5hZGQoMSk7CiAgICAgICAgdWludDI1NiB2b3RlV2VpZ2h0ID0gdG9rZW5Db250cmFjdC5iYWxhbmNlT2YobXNnLnNlbmRlcik7CiAgICAgICAgaWYgKGlzWWVzKSB7CiAgICAgICAgICAgIHllc1ZvdGVTdW0gPSB5ZXNWb3RlU3VtLmFkZCh2b3RlV2VpZ2h0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBub1ZvdGVTdW0gPSBub1ZvdGVTdW0uYWRkKHZvdGVXZWlnaHQpOwogICAgICAgIH0KICAgICAgICByZXF1aXJlKGdldFRpbWUoKS5zdWIodG9rZW5Db250cmFjdC5sYXN0TW92ZW1lbnQobXNnLnNlbmRlcikpID4gNyBkYXlzKTsKICAgICAgICB1aW50MjU2IHF1b3J1bVBlcmNlbnQgPSBnZXRRdW9ydW1QZXJjZW50KCk7CiAgICAgICAgaWYgKHF1b3J1bVBlcmNlbnQgPT0gMCkgewogICAgICAgICAgICBpc1ZvdGluZ0FjdGl2ZSA9IGZhbHNlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRlY2lkZSgpOwogICAgICAgIH0KICAgICAgICB2b3Rlc0J5QWRkcmVzc1ttc2cuc2VuZGVyXSA9IHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gZGVjaWRlKCkgaW50ZXJuYWwgewogICAgICAgIHVpbnQyNTYgcXVvcnVtUGVyY2VudCA9IGdldFF1b3J1bVBlcmNlbnQoKTsKICAgICAgICB1aW50MjU2IHF1b3J1bSA9IHF1b3J1bVBlcmNlbnQubXVsKHRva2VuQ29udHJhY3QudG90YWxTdXBwbHkoKSkuZGl2KDEwMCk7CiAgICAgICAgdWludDI1NiBzb0ZhclZvdGVkID0geWVzVm90ZVN1bS5hZGQobm9Wb3RlU3VtKTsKICAgICAgICBpZiAoc29GYXJWb3RlZCA+PSBxdW9ydW0pIHsKICAgICAgICAgICAgdWludDI1NiBwZXJjZW50WWVzID0gKDEwMCAqIHllc1ZvdGVTdW0pLmRpdihzb0ZhclZvdGVkKTsKICAgICAgICAgICAgaWYgKHBlcmNlbnRZZXMgPj0gaW5pdGlhbFF1b3J1bVBlcmNlbnQpIHsKICAgICAgICAgICAgICAgIC8vIGRvZXMgbm90IG1hdHRlciBpZiBpdCB3b3VsZCBiZSBncmVhdGVyIHRoYW4gd2VpUmFpc2VkCiAgICAgICAgICAgICAgICBwcm94eVZvdGluZ0NvbnRyYWN0LnByb3h5SW5jcmVhc2VXaXRoZHJhd2FsQ2h1bmsoKTsKICAgICAgICAgICAgICAgIEZpbmlzaEJhbGxvdChub3cpOwogICAgICAgICAgICAgICAgaXNWb3RpbmdBY3RpdmUgPSBmYWxzZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIGRvIG5vdGhpbmcsIGp1c3QgZGVhY3RpdmF0ZSB2b3RpbmcKICAgICAgICAgICAgICAgIGlzVm90aW5nQWN0aXZlID0gZmFsc2U7CiAgICAgICAgICAgICAgICBGaW5pc2hCYWxsb3Qobm93KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRUaW1lKCkgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NikgewogICAgICAgIC8vIEp1c3QgcmV0dXJucyBgbm93YCB2YWx1ZQogICAgICAgIC8vIFRoaXMgZnVuY3Rpb24gaXMgcmVkZWZpbmVkIGluIEV0aGVhcm5hbFJlcFRva2VuQ3Jvd2RzYWxlTW9jayBjb250cmFjdAogICAgICAgIC8vIHRvIGFsbG93IHRlc3RpbmcgY29udHJhY3QgYmVoYXZpb3VyIGF0IGRpZmZlcmVudCB0aW1lIG1vbWVudHMKICAgICAgICByZXR1cm4gbm93OwogICAgfQogICAgCn0KCmNvbnRyYWN0IExvY2thYmxlVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiwgT3duYWJsZSB7CiAgICBib29sIHB1YmxpYyBpc0xvY2tlZCA9IHRydWU7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBsYXN0TW92ZW1lbnQ7CiAgICBldmVudCBCdXJuKGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF9hbW91bnQpOwoKCiAgICBmdW5jdGlvbiB1bmxvY2soKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBpc0xvY2tlZCA9IGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZSghaXNMb2NrZWQpOwogICAgICAgIGxhc3RNb3ZlbWVudFttc2cuc2VuZGVyXSA9IGdldFRpbWUoKTsKICAgICAgICBsYXN0TW92ZW1lbnRbX3RvXSA9IGdldFRpbWUoKTsKICAgICAgICByZXR1cm4gc3VwZXIudHJhbnNmZXIoX3RvLCBfYW1vdW50KTsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoIWlzTG9ja2VkKTsKICAgICAgICBsYXN0TW92ZW1lbnRbX2Zyb21dID0gZ2V0VGltZSgpOwogICAgICAgIGxhc3RNb3ZlbWVudFtfdG9dID0gZ2V0VGltZSgpOwogICAgICAgIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZSghaXNMb2NrZWQpOwogICAgICAgIHN1cGVyLmFwcHJvdmUoX3NwZW5kZXIsIF92YWx1ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gYnVybkZyb20oYWRkcmVzcyBfZnJvbSwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyAgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGJhbGFuY2VzW19mcm9tXSk7CiAgICAgICAgcmVxdWlyZShfdmFsdWUgPD0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0pOwogICAgICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX3ZhbHVlKTsKICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwoKICAgICAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LnN1YihfdmFsdWUpOwogICAgICAgIEJ1cm4oX2Zyb20sIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VGltZSgpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICAvLyBKdXN0IHJldHVybnMgYG5vd2AgdmFsdWUKICAgICAgICAvLyBUaGlzIGZ1bmN0aW9uIGlzIHJlZGVmaW5lZCBpbiBFdGhlYXJuYWxSZXBUb2tlbkNyb3dkc2FsZU1vY2sgY29udHJhY3QKICAgICAgICAvLyB0byBhbGxvdyB0ZXN0aW5nIGNvbnRyYWN0IGJlaGF2aW91ciBhdCBkaWZmZXJlbnQgdGltZSBtb21lbnRzCiAgICAgICAgcmV0dXJuIG5vdzsKICAgIH0KCiAgICBmdW5jdGlvbiBjbGFpbVRva2VucyhhZGRyZXNzIF90b2tlbikgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgaWYgKF90b2tlbiA9PSAweDApIHsKICAgICAgICAgICAgb3duZXIudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIAogICAgICAgIEVSQzIwQmFzaWMgdG9rZW4gPSBFUkMyMEJhc2ljKF90b2tlbik7CiAgICAgICAgdWludDI1NiBiYWxhbmNlID0gdG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgICAgIHRva2VuLnRyYW5zZmVyKG93bmVyLCBiYWxhbmNlKTsKICAgIH0KCn0KCmNvbnRyYWN0IEV0aGVhcm5hbFJlcFRva2VuIGlzIE1pbnRhYmxlVG9rZW4sIExvY2thYmxlVG9rZW4gewogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBuYW1lID0gJ0V0aGVhcm5hbCBSZXAgVG9rZW4nOwogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAnRVJUJzsKICAgIHVpbnQ4IHB1YmxpYyBjb25zdGFudCBkZWNpbWFscyA9IDE4Owp9Cgpjb250cmFjdCBNdWx0aU93bmFibGUgewogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgb3duZXJSZWdpc3RyeTsKICAgIGFkZHJlc3NbXSBvd25lcnM7CiAgICBhZGRyZXNzIHB1YmxpYyBtdWx0aU93bmFibGVDcmVhdG9yID0gMHgwOwoKICAgIGZ1bmN0aW9uIE11bHRpT3duYWJsZSgpIHB1YmxpYyB7CiAgICAgICAgbXVsdGlPd25hYmxlQ3JlYXRvciA9IG1zZy5zZW5kZXI7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0dXBPd25lcnMoYWRkcmVzc1tdIF9vd25lcnMpIHB1YmxpYyB7CiAgICAgICAgLy8gT3duZXJzIGFyZSBhbGxvd2VkIHRvIGJlIHNldCB1cCBvbmx5IG9uZSB0aW1lCiAgICAgICAgcmVxdWlyZShtdWx0aU93bmFibGVDcmVhdG9yID09IG1zZy5zZW5kZXIpOwogICAgICAgIHJlcXVpcmUob3duZXJzLmxlbmd0aCA9PSAwKTsKICAgICAgICBmb3IodWludDI1NiBpZHg9MDsgaWR4IDwgX293bmVycy5sZW5ndGg7IGlkeCsrKSB7CiAgICAgICAgICAgIHJlcXVpcmUoCiAgICAgICAgICAgICAgICAhb3duZXJSZWdpc3RyeVtfb3duZXJzW2lkeF1dICYmCiAgICAgICAgICAgICAgICBfb3duZXJzW2lkeF0gIT0gMHgwICYmCiAgICAgICAgICAgICAgICBfb3duZXJzW2lkeF0gIT0gYWRkcmVzcyh0aGlzKQogICAgICAgICAgICApOwogICAgICAgICAgICBvd25lclJlZ2lzdHJ5W19vd25lcnNbaWR4XV0gPSB0cnVlOwogICAgICAgIH0KICAgICAgICBvd25lcnMgPSBfb3duZXJzOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgICAgICByZXF1aXJlKG93bmVyUmVnaXN0cnlbbXNnLnNlbmRlcl0gPT0gdHJ1ZSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRPd25lcnMoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzc1tdKSB7CiAgICAgICAgcmV0dXJuIG93bmVyczsKICAgIH0KfQoKY29udHJhY3QgRXRoZWFybmFsUmVwVG9rZW5Dcm93ZHNhbGUgaXMgTXVsdGlPd25hYmxlIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAgIC8qICoqKioqKioqKioqKioqKioqKioqKgogICAgICogVmFyaWFibGVzICYgQ29uc3RhbnRzCiAgICAgKi8KCiAgICAvLyBUb2tlbiBDb250cmFjdAogICAgRXRoZWFybmFsUmVwVG9rZW4gcHVibGljIHRva2VuOwoKICAgIC8vIEV0aGVyZXVtIHJhdGUsIGhvdyBtdWNoIFVTRCBkb2VzIDEgZXRoZXIgY29zdAogICAgLy8gVGhlIGFjdHVhbCB2YWx1ZSBpcyBzZXQgYnkgc2V0RXRoZXJSYXRlVXNkCiAgICB1aW50MjU2IGV0aGVyUmF0ZVVzZCA9IDEwMDA7CgogICAgLy8gVG9rZW4gcHJpY2UgaW4gVXNkLCAxIHRva2VuIGlzIDEuMCBVU0QsIDMgZGVjaW1hbHMuIFNvLCAxMDAwID0gJDEuMDAwCiAgICB1aW50MjU2IHB1YmxpYyB0b2tlblJhdGVVc2QgPSAxMDAwOwoKICAgIC8vIE1haW5zYWxlIFN0YXJ0IERhdGUgRmVicnVhcnkgMjgsIDIwMTggMzowMDowMCBQTQogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgc2FsZVN0YXJ0RGF0ZSA9IDE1MTk4MzAwMDA7CgogICAgLy8gTWFpbnNhbGUgRW5kIERhdGUgTWFyY2ggMzEsIDIwMTggMTE6NTk6NTkgUE0gR01UCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBzYWxlRW5kRGF0ZSA9IDE1MjI1NDA3OTk7CgogICAgLy8gSG93IG1hbnkgdG9rZW5zIGdlbmVyYXRlIGZvciB0aGUgdGVhbSwgcmF0aW8gd2l0aCAzIGRlY2ltYWxzIGRpZ2l0cwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgdGVhbVRva2VuUmF0aW8gPSB1aW50MjU2KDEgKiAxMDAwKSAvIDM7CgogICAgLy8gQ3Jvd2RzYWxlIFN0YXRlCiAgICBlbnVtIFN0YXRlIHsKICAgICAgICBCZWZvcmVNYWluU2FsZSwgLy8gcHJlLXNhbGUgZmluaXNlaGQsIGJlZm9yZSBtYWluIHNhbGUKICAgICAgICBNYWluU2FsZSwgLy8gbWFpbiBzYWxlIGlzIGFjdGl2ZQogICAgICAgIE1haW5TYWxlRG9uZSwgLy8gbWFpbiBzYWxlIGRvbmUsIElDTyBpcyBub3QgZmluYWxpemVkCiAgICAgICAgRmluYWxpemVkIC8vIHRoZSBmaW5hbCBzdGF0ZSB0aWxsIHRoZSBlbmQgb2YgdGhlIHdvcmxkCiAgICB9CgogICAgLy8gSGFyZCBjYXAgZm9yIHRvdGFsIHNhbGUKICAgIHVpbnQyNTYgcHVibGljIHNhbGVDYXBVc2QgPSAzMCAqICgxMCoqNik7CgogICAgLy8gTW9uZXkgcmFpc2VkIHRvdGFsbHkKICAgIHVpbnQyNTYgcHVibGljIHdlaVJhaXNlZCA9IDA7CgogICAgLy8gVGhpcyBldmVudCBtZWFucyBldmVyeXRoaW5nIGlzIGZpbmlzaGVkIGFuZCB0b2tlbnMKICAgIC8vIGFyZSBhbGxvd2VkIHRvIGJlIHVzZWQgYnkgdGhlaXIgb3duZXJzCiAgICBib29sIHB1YmxpYyBpc0ZpbmFsaXplZCA9IGZhbHNlOwoKICAgIC8vIFdhbGxldCB0byBzZW5kIHRlYW0gdG9rZW5zCiAgICBhZGRyZXNzIHB1YmxpYyB0ZWFtVG9rZW5XYWxsZXQgPSAweDA7CgogICAgLy8gbW9uZXkgcmVjZWl2ZWQgZnJvbSBlYWNoIGN1c3RvbWVyCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIHJhaXNlZEJ5QWRkcmVzczsKCiAgICAvLyB3aGl0ZWxpc3RlZCBpbnZlc3RvcnMKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgd2hpdGVsaXN0OwogICAgLy8gaG93IG1hbnkgd2hpdGVsaXN0ZWQgaW52ZXN0b3JzCiAgICB1aW50MjU2IHB1YmxpYyB3aGl0ZWxpc3RlZEludmVzdG9yQ291bnRlcjsKCgogICAgLy8gRXh0cmEgbW9uZXkgZWFjaCBhZGRyZXNzIGNhbiBzcGVuZCBlYWNoIGhvdXIKICAgIHVpbnQyNTYgaG91ckxpbWl0QnlBZGRyZXNzVXNkID0gMTAwMDsKCiAgICAvLyBXYWxsZXQgdG8gc3RvcmUgYWxsIHJhaXNlZCBtb25leQogICAgVHJlYXN1cnkgcHVibGljIHRyZWFzdXJ5Q29udHJhY3QgPSBUcmVhc3VyeSgweDApOwoKICAgIC8qICoqKioqKioKICAgICAqIEV2ZW50cwogICAgICovCiAgICAKICAgIGV2ZW50IENoYW5nZVJldHVybihhZGRyZXNzIGluZGV4ZWQgcmVjaXBpZW50LCB1aW50MjU2IGFtb3VudCk7CiAgICBldmVudCBUb2tlblB1cmNoYXNlKGFkZHJlc3MgaW5kZXhlZCBidXllciwgdWludDI1NiB3ZWlBbW91bnQsIHVpbnQyNTYgdG9rZW5BbW91bnQpOwogICAgLyogKioqKioqKioqKioqKioKICAgICAqIFB1YmxpYyBtZXRob2RzCiAgICAgKi8KCiAgICBmdW5jdGlvbiBFdGhlYXJuYWxSZXBUb2tlbkNyb3dkc2FsZSgKICAgICAgICBhZGRyZXNzW10gX293bmVycywKICAgICAgICBhZGRyZXNzIF90cmVhc3VyeUNvbnRyYWN0LAogICAgICAgIGFkZHJlc3MgX3RlYW1Ub2tlbldhbGxldAogICAgKSB7CiAgICAgICAgcmVxdWlyZShfb3duZXJzLmxlbmd0aCA+IDEpOwogICAgICAgIHJlcXVpcmUoX3RyZWFzdXJ5Q29udHJhY3QgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfdGVhbVRva2VuV2FsbGV0ICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoVHJlYXN1cnkoX3RyZWFzdXJ5Q29udHJhY3QpLnZvdGluZ1Byb3h5Q29udHJhY3QoKSAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKFRyZWFzdXJ5KF90cmVhc3VyeUNvbnRyYWN0KS50b2tlbkNvbnRyYWN0KCkgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgdHJlYXN1cnlDb250cmFjdCA9IFRyZWFzdXJ5KF90cmVhc3VyeUNvbnRyYWN0KTsKICAgICAgICB0ZWFtVG9rZW5XYWxsZXQgPSBfdGVhbVRva2VuV2FsbGV0OwogICAgICAgIHNldHVwT3duZXJzKF9vd25lcnMpOwogICAgfQoKICAgIGZ1bmN0aW9uKCkgcHVibGljIHBheWFibGUgewogICAgICAgIGlmICh3aGl0ZWxpc3RbbXNnLnNlbmRlcl0pIHsKICAgICAgICAgICAgYnV5Rm9yV2hpdGVsaXN0ZWQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBidXlUb2tlbnMoKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gc2V0VG9rZW5Db250cmFjdChhZGRyZXNzIF90b2tlbikgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShfdG9rZW4gIT0gYWRkcmVzcygwKSAmJiB0b2tlbiA9PSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKEV0aGVhcm5hbFJlcFRva2VuKF90b2tlbikub3duZXIoKSA9PSBhZGRyZXNzKHRoaXMpKTsKICAgICAgICByZXF1aXJlKEV0aGVhcm5hbFJlcFRva2VuKF90b2tlbikudG90YWxTdXBwbHkoKSA9PSAwKTsKICAgICAgICByZXF1aXJlKEV0aGVhcm5hbFJlcFRva2VuKF90b2tlbikuaXNMb2NrZWQoKSk7CiAgICAgICAgcmVxdWlyZSghRXRoZWFybmFsUmVwVG9rZW4oX3Rva2VuKS5taW50aW5nRmluaXNoZWQoKSk7CiAgICAgICAgdG9rZW4gPSBFdGhlYXJuYWxSZXBUb2tlbihfdG9rZW4pOwogICAgfQoKICAgIGZ1bmN0aW9uIGJ1eUZvcldoaXRlbGlzdGVkKCkgcHVibGljIHBheWFibGUgewogICAgICAgIHJlcXVpcmUodG9rZW4gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgYWRkcmVzcyB3aGl0ZWxpc3RlZEludmVzdG9yID0gbXNnLnNlbmRlcjsKICAgICAgICByZXF1aXJlKHdoaXRlbGlzdFt3aGl0ZWxpc3RlZEludmVzdG9yXSk7CiAgICAgICAgdWludDI1NiB3ZWlUb0J1eSA9IG1zZy52YWx1ZTsKICAgICAgICByZXF1aXJlKHdlaVRvQnV5ID4gMCk7CiAgICAgICAgdWludDI1NiB0b2tlbkFtb3VudCA9IGdldFRva2VuQW1vdW50Rm9yRXRoZXIod2VpVG9CdXkpOwogICAgICAgIHJlcXVpcmUodG9rZW5BbW91bnQgPiAwKTsKICAgICAgICB3ZWlSYWlzZWQgPSB3ZWlSYWlzZWQuYWRkKHdlaVRvQnV5KTsKICAgICAgICByYWlzZWRCeUFkZHJlc3Nbd2hpdGVsaXN0ZWRJbnZlc3Rvcl0gPSByYWlzZWRCeUFkZHJlc3Nbd2hpdGVsaXN0ZWRJbnZlc3Rvcl0uYWRkKHdlaVRvQnV5KTsKICAgICAgICBmb3J3YXJkRnVuZHMod2VpVG9CdXkpOwogICAgICAgIGFzc2VydCh0b2tlbi5taW50KHdoaXRlbGlzdGVkSW52ZXN0b3IsIHRva2VuQW1vdW50KSk7CiAgICAgICAgVG9rZW5QdXJjaGFzZSh3aGl0ZWxpc3RlZEludmVzdG9yLCB3ZWlUb0J1eSwgdG9rZW5BbW91bnQpOwogICAgfQoKICAgIGZ1bmN0aW9uIGJ1eVRva2VucygpIHB1YmxpYyBwYXlhYmxlIHsKICAgICAgICByZXF1aXJlKHRva2VuICE9IGFkZHJlc3MoMCkpOwogICAgICAgIGFkZHJlc3MgcmVjaXBpZW50ID0gbXNnLnNlbmRlcjsKICAgICAgICBTdGF0ZSBzdGF0ZSA9IGdldEN1cnJlbnRTdGF0ZSgpOwogICAgICAgIHVpbnQyNTYgd2VpVG9CdXkgPSBtc2cudmFsdWU7CiAgICAgICAgcmVxdWlyZSgKICAgICAgICAgICAgKHN0YXRlID09IFN0YXRlLk1haW5TYWxlKSAmJgogICAgICAgICAgICAod2VpVG9CdXkgPiAwKQogICAgICAgICk7CiAgICAgICAgd2VpVG9CdXkgPSBtaW4od2VpVG9CdXksIGdldFdlaUFsbG93ZWRGcm9tQWRkcmVzcyhyZWNpcGllbnQpKTsKICAgICAgICByZXF1aXJlKHdlaVRvQnV5ID4gMCk7CiAgICAgICAgd2VpVG9CdXkgPSBtaW4od2VpVG9CdXksIGNvbnZlcnRVc2RUb0V0aGVyKHNhbGVDYXBVc2QpLnN1Yih3ZWlSYWlzZWQpKTsKICAgICAgICByZXF1aXJlKHdlaVRvQnV5ID4gMCk7CiAgICAgICAgdWludDI1NiB0b2tlbkFtb3VudCA9IGdldFRva2VuQW1vdW50Rm9yRXRoZXIod2VpVG9CdXkpOwogICAgICAgIHJlcXVpcmUodG9rZW5BbW91bnQgPiAwKTsKICAgICAgICB1aW50MjU2IHdlaVRvUmV0dXJuID0gbXNnLnZhbHVlLnN1Yih3ZWlUb0J1eSk7CiAgICAgICAgd2VpUmFpc2VkID0gd2VpUmFpc2VkLmFkZCh3ZWlUb0J1eSk7CiAgICAgICAgcmFpc2VkQnlBZGRyZXNzW3JlY2lwaWVudF0gPSByYWlzZWRCeUFkZHJlc3NbcmVjaXBpZW50XS5hZGQod2VpVG9CdXkpOwogICAgICAgIGlmICh3ZWlUb1JldHVybiA+IDApIHsKICAgICAgICAgICAgcmVjaXBpZW50LnRyYW5zZmVyKHdlaVRvUmV0dXJuKTsKICAgICAgICAgICAgQ2hhbmdlUmV0dXJuKHJlY2lwaWVudCwgd2VpVG9SZXR1cm4pOwogICAgICAgIH0KICAgICAgICBmb3J3YXJkRnVuZHMod2VpVG9CdXkpOwogICAgICAgIHJlcXVpcmUodG9rZW4ubWludChyZWNpcGllbnQsIHRva2VuQW1vdW50KSk7CiAgICAgICAgVG9rZW5QdXJjaGFzZShyZWNpcGllbnQsIHdlaVRvQnV5LCB0b2tlbkFtb3VudCk7CiAgICB9CgogICAgLy8gVEVTVAogICAgZnVuY3Rpb24gZmluYWxpemVCeUFkbWluKCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgZmluYWxpemUoKTsKICAgIH0KCiAgICAvKiAqKioqKioqKioqKioqKioqCiAgICAgKiBJbnRlcm5hbCBtZXRob2RzCiAgICAgKi8KCiAgICBmdW5jdGlvbiBmb3J3YXJkRnVuZHModWludDI1NiBfd2VpVG9CdXkpIGludGVybmFsIHsKICAgICAgICB0cmVhc3VyeUNvbnRyYWN0LnRyYW5zZmVyKF93ZWlUb0J1eSk7CiAgICB9CgogICAgLy8gVEVTVEVECiAgICBmdW5jdGlvbiBjb252ZXJ0VXNkVG9FdGhlcih1aW50MjU2IHVzZEFtb3VudCkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiB1c2RBbW91bnQubXVsKDEgZXRoZXIpLmRpdihldGhlclJhdGVVc2QpOwogICAgfQoKICAgIC8vIFRFU1RFRAogICAgZnVuY3Rpb24gZ2V0VG9rZW5SYXRlRXRoZXIoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIC8vIGRpdigxMDAwKSBiZWNhdXNlIDMgZGVjaW1hbHMgaW4gdG9rZW5SYXRlVXNkCiAgICAgICAgcmV0dXJuIGNvbnZlcnRVc2RUb0V0aGVyKHRva2VuUmF0ZVVzZCkuZGl2KDEwMDApOwogICAgfQoKICAgIC8vIFRFU1RFRAogICAgZnVuY3Rpb24gZ2V0VG9rZW5BbW91bnRGb3JFdGhlcih1aW50MjU2IHdlaUFtb3VudCkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiB3ZWlBbW91bnQKICAgICAgICAgICAgLmRpdihnZXRUb2tlblJhdGVFdGhlcigpKQogICAgICAgICAgICAubXVsKDEwICoqIHVpbnQyNTYodG9rZW4uZGVjaW1hbHMoKSkpOwogICAgfQoKICAgIC8vIFRFU1RFRAogICAgZnVuY3Rpb24gaXNSZWFkeVRvRmluYWxpemUoKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuKAogICAgICAgICAgICAod2VpUmFpc2VkID49IGNvbnZlcnRVc2RUb0V0aGVyKHNhbGVDYXBVc2QpKSB8fAogICAgICAgICAgICAoZ2V0Q3VycmVudFN0YXRlKCkgPT0gU3RhdGUuTWFpblNhbGVEb25lKQogICAgICAgICk7CiAgICB9CgogICAgLy8gVEVTVEVECiAgICBmdW5jdGlvbiBtaW4odWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gKGEgPCBiKSA/IGE6IGI7CiAgICB9CgogICAgLy8gVEVTVEVECiAgICBmdW5jdGlvbiBtYXgodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gKGEgPiBiKSA/IGE6IGI7CiAgICB9CgogICAgLy8gVEVTVEVECiAgICBmdW5jdGlvbiBjZWlsKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuICgoYS5hZGQoYikuc3ViKDEpKS5kaXYoYikpLm11bChiKTsKICAgIH0KCiAgICAvLyBURVNURUQKICAgIGZ1bmN0aW9uIGdldFdlaUFsbG93ZWRGcm9tQWRkcmVzcyhhZGRyZXNzIF9zZW5kZXIpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IHNlY29uZHNFbGFwc2VkID0gZ2V0VGltZSgpLnN1YihzYWxlU3RhcnREYXRlKTsKICAgICAgICB1aW50MjU2IGZ1bGxIb3VycyA9IGNlaWwoc2Vjb25kc0VsYXBzZWQsIDM2MDApLmRpdigzNjAwKTsKICAgICAgICBmdWxsSG91cnMgPSBtYXgoMSwgZnVsbEhvdXJzKTsKICAgICAgICB1aW50MjU2IHdlaUxpbWl0ID0gZnVsbEhvdXJzLm11bChjb252ZXJ0VXNkVG9FdGhlcihob3VyTGltaXRCeUFkZHJlc3NVc2QpKTsKICAgICAgICByZXR1cm4gd2VpTGltaXQuc3ViKHJhaXNlZEJ5QWRkcmVzc1tfc2VuZGVyXSk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VGltZSgpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICAvLyBKdXN0IHJldHVybnMgYG5vd2AgdmFsdWUKICAgICAgICAvLyBUaGlzIGZ1bmN0aW9uIGlzIHJlZGVmaW5lZCBpbiBFdGhlYXJuYWxSZXBUb2tlbkNyb3dkc2FsZU1vY2sgY29udHJhY3QKICAgICAgICAvLyB0byBhbGxvdyB0ZXN0aW5nIGNvbnRyYWN0IGJlaGF2aW91ciBhdCBkaWZmZXJlbnQgdGltZSBtb21lbnRzCiAgICAgICAgcmV0dXJuIG5vdzsKICAgIH0KCiAgICAvLyBURVNURUQKICAgIGZ1bmN0aW9uIGdldEN1cnJlbnRTdGF0ZSgpIGludGVybmFsIHJldHVybnMgKFN0YXRlKSB7CiAgICAgICAgcmV0dXJuIGdldFN0YXRlRm9yVGltZShnZXRUaW1lKCkpOwogICAgfQoKICAgIC8vIFRFU1RFRAogICAgZnVuY3Rpb24gZ2V0U3RhdGVGb3JUaW1lKHVpbnQyNTYgdW5peFRpbWUpIGludGVybmFsIHJldHVybnMgKFN0YXRlKSB7CiAgICAgICAgaWYgKGlzRmluYWxpemVkKSB7CiAgICAgICAgICAgIC8vIFRoaXMgY291bGQgYmUgYmVmb3JlIGVuZCBkYXRlIG9mIElDTwogICAgICAgICAgICAvLyBpZiBoYXJkIGNhcCBpcyByZWFjaGVkCiAgICAgICAgICAgIHJldHVybiBTdGF0ZS5GaW5hbGl6ZWQ7CiAgICAgICAgfQogICAgICAgIGlmICh1bml4VGltZSA8IHNhbGVTdGFydERhdGUpIHsKICAgICAgICAgICAgcmV0dXJuIFN0YXRlLkJlZm9yZU1haW5TYWxlOwogICAgICAgIH0KICAgICAgICBpZiAodW5peFRpbWUgPCBzYWxlRW5kRGF0ZSkgewogICAgICAgICAgICByZXR1cm4gU3RhdGUuTWFpblNhbGU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBTdGF0ZS5NYWluU2FsZURvbmU7CiAgICB9CgogICAgLy8gVEVTVEVECiAgICBmdW5jdGlvbiBmaW5hbGl6ZSgpIHByaXZhdGUgewogICAgICAgIGlmICghaXNGaW5hbGl6ZWQpIHsKICAgICAgICAgICAgcmVxdWlyZShpc1JlYWR5VG9GaW5hbGl6ZSgpKTsKICAgICAgICAgICAgaXNGaW5hbGl6ZWQgPSB0cnVlOwogICAgICAgICAgICBtaW50VGVhbVRva2VucygpOwogICAgICAgICAgICB0b2tlbi51bmxvY2soKTsKICAgICAgICAgICAgdHJlYXN1cnlDb250cmFjdC5zZXRDcm93ZHNhbGVGaW5pc2hlZCgpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBURVNURUQKICAgIGZ1bmN0aW9uIG1pbnRUZWFtVG9rZW5zKCkgcHJpdmF0ZSB7CiAgICAgICAgLy8gZGl2IGJ5IDEwMDAgYmVjYXVzZSBvZiAzIGRlY2ltYWxzIGRpZ2l0cyBpbiB0ZWFtVG9rZW5SYXRpbwogICAgICAgIHVpbnQyNTYgdG9rZW5BbW91bnQgPSB0b2tlbi50b3RhbFN1cHBseSgpLm11bCh0ZWFtVG9rZW5SYXRpbykuZGl2KDEwMDApOwogICAgICAgIHRva2VuLm1pbnQodGVhbVRva2VuV2FsbGV0LCB0b2tlbkFtb3VudCk7CiAgICB9CgoKICAgIGZ1bmN0aW9uIHdoaXRlbGlzdEludmVzdG9yKGFkZHJlc3MgX25ld0ludmVzdG9yKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBpZighd2hpdGVsaXN0W19uZXdJbnZlc3Rvcl0pIHsKICAgICAgICAgICAgd2hpdGVsaXN0W19uZXdJbnZlc3Rvcl0gPSB0cnVlOwogICAgICAgICAgICB3aGl0ZWxpc3RlZEludmVzdG9yQ291bnRlcisrOwogICAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHdoaXRlbGlzdEludmVzdG9ycyhhZGRyZXNzW10gX2ludmVzdG9ycykgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKF9pbnZlc3RvcnMubGVuZ3RoIDw9IDI1MCk7CiAgICAgICAgZm9yKHVpbnQ4IGk9MDsgaTxfaW52ZXN0b3JzLmxlbmd0aDtpKyspIHsKICAgICAgICAgICAgYWRkcmVzcyBuZXdJbnZlc3RvciA9IF9pbnZlc3RvcnNbaV07CiAgICAgICAgICAgIGlmKCF3aGl0ZWxpc3RbbmV3SW52ZXN0b3JdKSB7CiAgICAgICAgICAgICAgICB3aGl0ZWxpc3RbbmV3SW52ZXN0b3JdID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHdoaXRlbGlzdGVkSW52ZXN0b3JDb3VudGVyKys7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBibGFja2xpc3RJbnZlc3RvcihhZGRyZXNzIF9pbnZlc3RvcikgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgaWYod2hpdGVsaXN0W19pbnZlc3Rvcl0pIHsKICAgICAgICAgICAgZGVsZXRlIHdoaXRlbGlzdFtfaW52ZXN0b3JdOwogICAgICAgICAgICBpZih3aGl0ZWxpc3RlZEludmVzdG9yQ291bnRlciAhPSAwKSB7CiAgICAgICAgICAgICAgICB3aGl0ZWxpc3RlZEludmVzdG9yQ291bnRlci0tOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGNsYWltVG9rZW5zKGFkZHJlc3MgX3Rva2VuLCBhZGRyZXNzIF90bykgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgaWYgKF90b2tlbiA9PSAweDApIHsKICAgICAgICAgICAgX3RvLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAKICAgICAgICBFUkMyMEJhc2ljIHRva2VuID0gRVJDMjBCYXNpYyhfdG9rZW4pOwogICAgICAgIHVpbnQyNTYgYmFsYW5jZSA9IHRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgICAgICB0b2tlbi50cmFuc2ZlcihfdG8sIGJhbGFuY2UpOwogICAgfQoKfQoKY29udHJhY3QgUmVmdW5kSW52ZXN0b3JzQmFsbG90IHsKCiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKICAgIEV0aGVhcm5hbFJlcFRva2VuIHB1YmxpYyB0b2tlbkNvbnRyYWN0OwoKICAgIC8vIERhdGUgd2hlbiB2b3RlIGhhcyBzdGFydGVkCiAgICB1aW50MjU2IHB1YmxpYyBiYWxsb3RTdGFydGVkOwoKICAgIC8vIFJlZ2lzdHJ5IG9mIHZvdGVzCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIHZvdGVzQnlBZGRyZXNzOwoKICAgIC8vIFN1bSBvZiB3ZWlnaHRzIG9mIFlFUyB2b3RlcwogICAgdWludDI1NiBwdWJsaWMgeWVzVm90ZVN1bSA9IDA7CgogICAgLy8gU3VtIG9mIHdlaWdodHMgb2YgTk8gdm90ZXMKICAgIHVpbnQyNTYgcHVibGljIG5vVm90ZVN1bSA9IDA7CgogICAgLy8gTGVuZ3RoIG9mIGB2b3RlcnNgCiAgICB1aW50MjU2IHB1YmxpYyB2b3RlcnNMZW5ndGggPSAwOwoKICAgIHVpbnQyNTYgcHVibGljIGluaXRpYWxRdW9ydW1QZXJjZW50ID0gNTE7CgogICAgVm90aW5nUHJveHkgcHVibGljIHByb3h5Vm90aW5nQ29udHJhY3Q7CgogICAgLy8gVGVsbHMgaWYgdm90aW5nIHByb2Nlc3MgaXMgYWN0aXZlCiAgICBib29sIHB1YmxpYyBpc1ZvdGluZ0FjdGl2ZSA9IGZhbHNlOwogICAgdWludDI1NiBwdWJsaWMgcmVxdWlyZWRNYWpvcml0eVBlcmNlbnQgPSA2NTsKCiAgICBldmVudCBGaW5pc2hCYWxsb3QodWludDI1NiBfdGltZSk7CiAgICBldmVudCBWb3RlKGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIGJ5dGVzIHZvdGUpOwogICAgCiAgICBtb2RpZmllciBvbmx5V2hlbkJhbGxvdFN0YXJ0ZWQgewogICAgICAgIHJlcXVpcmUoYmFsbG90U3RhcnRlZCAhPSAwKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIHZvdGUoYnl0ZXMgX3ZvdGUpIHB1YmxpYyBvbmx5V2hlbkJhbGxvdFN0YXJ0ZWQgewogICAgICAgIHJlcXVpcmUoX3ZvdGUubGVuZ3RoID4gMCk7CiAgICAgICAgaWYgKGlzRGF0YVllcyhfdm90ZSkpIHsKICAgICAgICAgICAgcHJvY2Vzc1ZvdGUodHJ1ZSk7CiAgICAgICAgfSBlbHNlIGlmIChpc0RhdGFObyhfdm90ZSkpIHsKICAgICAgICAgICAgcHJvY2Vzc1ZvdGUoZmFsc2UpOwogICAgICAgIH0KICAgICAgICBWb3RlKG1zZy5zZW5kZXIsIF92b3RlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBpc0RhdGFZZXMoYnl0ZXMgZGF0YSkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICAvLyBjb21wYXJlIGRhdGEgd2l0aCAiWUVTIiBzdHJpbmcKICAgICAgICByZXR1cm4gKAogICAgICAgICAgICBkYXRhLmxlbmd0aCA9PSAzICYmCiAgICAgICAgICAgIChkYXRhWzBdID09IDB4NTkgfHwgZGF0YVswXSA9PSAweDc5KSAmJgogICAgICAgICAgICAoZGF0YVsxXSA9PSAweDQ1IHx8IGRhdGFbMV0gPT0gMHg2NSkgJiYKICAgICAgICAgICAgKGRhdGFbMl0gPT0gMHg1MyB8fCBkYXRhWzJdID09IDB4NzMpCiAgICAgICAgKTsKICAgIH0KCiAgICAvLyBURVNURUQKICAgIGZ1bmN0aW9uIGlzRGF0YU5vKGJ5dGVzIGRhdGEpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgLy8gY29tcGFyZSBkYXRhIHdpdGggIk5PIiBzdHJpbmcKICAgICAgICByZXR1cm4gKAogICAgICAgICAgICBkYXRhLmxlbmd0aCA9PSAyICYmCiAgICAgICAgICAgIChkYXRhWzBdID09IDB4NGUgfHwgZGF0YVswXSA9PSAweDZlKSAmJgogICAgICAgICAgICAoZGF0YVsxXSA9PSAweDRmIHx8IGRhdGFbMV0gPT0gMHg2ZikKICAgICAgICApOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBwcm9jZXNzVm90ZShib29sIGlzWWVzKSBpbnRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShpc1ZvdGluZ0FjdGl2ZSk7CiAgICAgICAgcmVxdWlyZSghdm90ZXNCeUFkZHJlc3NbbXNnLnNlbmRlcl0pOwogICAgICAgIHZvdGVyc0xlbmd0aCA9IHZvdGVyc0xlbmd0aC5hZGQoMSk7CiAgICAgICAgdWludDI1NiB2b3RlV2VpZ2h0ID0gdG9rZW5Db250cmFjdC5iYWxhbmNlT2YobXNnLnNlbmRlcik7CiAgICAgICAgaWYgKGlzWWVzKSB7CiAgICAgICAgICAgIHllc1ZvdGVTdW0gPSB5ZXNWb3RlU3VtLmFkZCh2b3RlV2VpZ2h0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBub1ZvdGVTdW0gPSBub1ZvdGVTdW0uYWRkKHZvdGVXZWlnaHQpOwogICAgICAgIH0KICAgICAgICByZXF1aXJlKGdldFRpbWUoKS5zdWIodG9rZW5Db250cmFjdC5sYXN0TW92ZW1lbnQobXNnLnNlbmRlcikpID4gNyBkYXlzKTsKICAgICAgICB1aW50MjU2IHF1b3J1bVBlcmNlbnQgPSBnZXRRdW9ydW1QZXJjZW50KCk7CiAgICAgICAgaWYgKHF1b3J1bVBlcmNlbnQgPT0gMCkgewogICAgICAgICAgICBpc1ZvdGluZ0FjdGl2ZSA9IGZhbHNlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRlY2lkZSgpOwogICAgICAgIH0KICAgICAgICB2b3Rlc0J5QWRkcmVzc1ttc2cuc2VuZGVyXSA9IHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VGltZSgpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICAvLyBKdXN0IHJldHVybnMgYG5vd2AgdmFsdWUKICAgICAgICAvLyBUaGlzIGZ1bmN0aW9uIGlzIHJlZGVmaW5lZCBpbiBFdGhlYXJuYWxSZXBUb2tlbkNyb3dkc2FsZU1vY2sgY29udHJhY3QKICAgICAgICAvLyB0byBhbGxvdyB0ZXN0aW5nIGNvbnRyYWN0IGJlaGF2aW91ciBhdCBkaWZmZXJlbnQgdGltZSBtb21lbnRzCiAgICAgICAgcmV0dXJuIG5vdzsKICAgIH0KCiAgICBmdW5jdGlvbiBSZWZ1bmRJbnZlc3RvcnNCYWxsb3QoYWRkcmVzcyBfdG9rZW5Db250cmFjdCkgewogICAgICAgIHRva2VuQ29udHJhY3QgPSBFdGhlYXJuYWxSZXBUb2tlbihfdG9rZW5Db250cmFjdCk7CiAgICAgICAgcHJveHlWb3RpbmdDb250cmFjdCA9IFZvdGluZ1Byb3h5KG1zZy5zZW5kZXIpOwogICAgICAgIGJhbGxvdFN0YXJ0ZWQgPSBnZXRUaW1lKCk7CiAgICAgICAgaXNWb3RpbmdBY3RpdmUgPSB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGRlY2lkZSgpIGludGVybmFsIHsKICAgICAgICB1aW50MjU2IHF1b3J1bVBlcmNlbnQgPSBnZXRRdW9ydW1QZXJjZW50KCk7CiAgICAgICAgdWludDI1NiBxdW9ydW0gPSBxdW9ydW1QZXJjZW50Lm11bCh0b2tlbkNvbnRyYWN0LnRvdGFsU3VwcGx5KCkpLmRpdigxMDApOwogICAgICAgIHVpbnQyNTYgc29GYXJWb3RlZCA9IHllc1ZvdGVTdW0uYWRkKG5vVm90ZVN1bSk7CiAgICAgICAgaWYgKHNvRmFyVm90ZWQgPj0gcXVvcnVtKSB7CiAgICAgICAgICAgIHVpbnQyNTYgcGVyY2VudFllcyA9ICgxMDAgKiB5ZXNWb3RlU3VtKS5kaXYoc29GYXJWb3RlZCk7CiAgICAgICAgICAgIGlmIChwZXJjZW50WWVzID49IHJlcXVpcmVkTWFqb3JpdHlQZXJjZW50KSB7CiAgICAgICAgICAgICAgICAvLyBkb2VzIG5vdCBtYXR0ZXIgaWYgaXQgd291bGQgYmUgZ3JlYXRlciB0aGFuIHdlaVJhaXNlZAogICAgICAgICAgICAgICAgcHJveHlWb3RpbmdDb250cmFjdC5wcm94eUVuYWJsZVJlZnVuZHMoKTsKICAgICAgICAgICAgICAgIEZpbmlzaEJhbGxvdChub3cpOwogICAgICAgICAgICAgICAgaXNWb3RpbmdBY3RpdmUgPSBmYWxzZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIGRvIG5vdGhpbmcsIGp1c3QgZGVhY3RpdmF0ZSB2b3RpbmcKICAgICAgICAgICAgICAgIGlzVm90aW5nQWN0aXZlID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldFF1b3J1bVBlcmNlbnQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQyNTYgaXNNb250aFBhc3NlZCA9IGdldFRpbWUoKS5zdWIoYmFsbG90U3RhcnRlZCkuZGl2KDUgd2Vla3MpOwogICAgICAgIGlmKGlzTW9udGhQYXNzZWQgPT0gMSl7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaW5pdGlhbFF1b3J1bVBlcmNlbnQ7CiAgICB9CiAgICAKfQoKY29udHJhY3QgVHJlYXN1cnkgaXMgTXVsdGlPd25hYmxlIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAgIC8vIFRvdGFsIGFtb3VudCBvZiBldGhlciB3aXRoZHJhd2VkCiAgICB1aW50MjU2IHB1YmxpYyB3ZWlXaXRoZHJhd2VkID0gMDsKCiAgICAvLyBUb3RhbCBhbW91bnQgb2YgdGhlciB1bmxvY2tlZAogICAgdWludDI1NiBwdWJsaWMgd2VpVW5sb2NrZWQgPSAwOwoKICAgIC8vIFdhbGxldCB3aXRoZHJhdyBpcyBsb2NrZWQgdGlsbCBlbmQgb2YgY3Jvd2RzYWxlCiAgICBib29sIHB1YmxpYyBpc0Nyb3dkc2FsZUZpbmlzaGVkID0gZmFsc2U7CgogICAgLy8gV2l0aGRyYXdlZCB0ZWFtIGZ1bmRzIGdvIHRvIHRoaXMgd2FsbGV0CiAgICBhZGRyZXNzIHRlYW1XYWxsZXQgPSAweDA7CgogICAgLy8gQ3Jvd2RzYWxlIGNvbnRyYWN0IGFkZHJlc3MKICAgIEV0aGVhcm5hbFJlcFRva2VuQ3Jvd2RzYWxlIHB1YmxpYyBjcm93ZHNhbGVDb250cmFjdDsKICAgIEV0aGVhcm5hbFJlcFRva2VuIHB1YmxpYyB0b2tlbkNvbnRyYWN0OwogICAgYm9vbCBwdWJsaWMgaXNSZWZ1bmRzRW5hYmxlZCA9IGZhbHNlOwoKICAgIC8vIEFtb3VudCBvZiBldGhlciB0aGF0IGNvdWxkIGJlIHdpdGhkcmF3ZWQgZWFjaCB3aXRoZHJhdyBpdGVyYXRpb24KICAgIHVpbnQyNTYgcHVibGljIHdpdGhkcmF3Q2h1bmsgPSAwOwogICAgVm90aW5nUHJveHkgcHVibGljIHZvdGluZ1Byb3h5Q29udHJhY3Q7CiAgICB1aW50MjU2IHB1YmxpYyByZWZ1bmRzSXNzdWVkID0gMDsKICAgIHVpbnQyNTYgcHVibGljIHBlcmNlbnRMZWZ0ID0gMDsKCgogICAgZXZlbnQgRGVwb3NpdCh1aW50MjU2IGFtb3VudCk7CiAgICBldmVudCBXaXRoZHJhdyh1aW50MjU2IGFtb3VudCk7CiAgICBldmVudCBVbmxvY2tXZWkodWludDI1NiBhbW91bnQpOwogICAgZXZlbnQgUmVmdW5kZWRJbnZlc3RvcihhZGRyZXNzIGluZGV4ZWQgaW52ZXN0b3IsIHVpbnQyNTYgYW1vdW50UmVmdW5kZWQsIHVpbnQyNTYgdG9rZW5zQnVybik7CgogICAgZnVuY3Rpb24gVHJlYXN1cnkoYWRkcmVzcyBfdGVhbVdhbGxldCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKF90ZWFtV2FsbGV0ICE9IDB4MCk7CiAgICAgICAgLy8gVE9ETzogY2hlY2sgYWRkcmVzcyBpbnRlZ3JpdHkKICAgICAgICB0ZWFtV2FsbGV0ID0gX3RlYW1XYWxsZXQ7CiAgICB9CgogICAgLy8gVEVTVEVECiAgICBmdW5jdGlvbigpIHB1YmxpYyBwYXlhYmxlIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhjcm93ZHNhbGVDb250cmFjdCkpOwogICAgICAgIERlcG9zaXQobXNnLnZhbHVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRWb3RpbmdQcm94eShhZGRyZXNzIF92b3RpbmdQcm94eUNvbnRyYWN0KSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKHZvdGluZ1Byb3h5Q29udHJhY3QgPT0gYWRkcmVzcygweDApKTsKICAgICAgICB2b3RpbmdQcm94eUNvbnRyYWN0ID0gVm90aW5nUHJveHkoX3ZvdGluZ1Byb3h5Q29udHJhY3QpOwogICAgfQoKICAgIC8vIFRFU1RFRAogICAgZnVuY3Rpb24gc2V0Q3Jvd2RzYWxlQ29udHJhY3QoYWRkcmVzcyBfYWRkcmVzcykgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgLy8gQ291bGQgYmUgc2V0IG9ubHkgb25jZQogICAgICAgIHJlcXVpcmUoY3Jvd2RzYWxlQ29udHJhY3QgPT0gYWRkcmVzcygweDApKTsKICAgICAgICByZXF1aXJlKF9hZGRyZXNzICE9IDB4MCk7CiAgICAgICAgY3Jvd2RzYWxlQ29udHJhY3QgPSBFdGhlYXJuYWxSZXBUb2tlbkNyb3dkc2FsZShfYWRkcmVzcyk7IAogICAgfQoKICAgIGZ1bmN0aW9uIHNldFRva2VuQ29udHJhY3QoYWRkcmVzcyBfYWRkcmVzcykgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgLy8gQ291bGQgYmUgc2V0IG9ubHkgb25jZQogICAgICAgIHJlcXVpcmUodG9rZW5Db250cmFjdCA9PSBhZGRyZXNzKDB4MCkpOwogICAgICAgIHJlcXVpcmUoX2FkZHJlc3MgIT0gMHgwKTsKICAgICAgICB0b2tlbkNvbnRyYWN0ID0gRXRoZWFybmFsUmVwVG9rZW4oX2FkZHJlc3MpOwogICAgfQoKICAgIC8vIFRFU1RFRAogICAgZnVuY3Rpb24gc2V0Q3Jvd2RzYWxlRmluaXNoZWQoKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoY3Jvd2RzYWxlQ29udHJhY3QgIT0gYWRkcmVzcygweDApKTsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhjcm93ZHNhbGVDb250cmFjdCkpOwogICAgICAgIHdpdGhkcmF3Q2h1bmsgPSBnZXRXZWlSYWlzZWQoKS5kaXYoMTApOwogICAgICAgIHdlaVVubG9ja2VkID0gd2l0aGRyYXdDaHVuazsKICAgICAgICBpc0Nyb3dkc2FsZUZpbmlzaGVkID0gdHJ1ZTsKICAgIH0KCiAgICAvLyBURVNURUQKICAgIGZ1bmN0aW9uIHdpdGhkcmF3VGVhbUZ1bmRzKCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShpc0Nyb3dkc2FsZUZpbmlzaGVkKTsKICAgICAgICByZXF1aXJlKHdlaVVubG9ja2VkID4gd2VpV2l0aGRyYXdlZCk7CiAgICAgICAgdWludDI1NiB0b1dpdGhkcmF3ID0gd2VpVW5sb2NrZWQuc3ViKHdlaVdpdGhkcmF3ZWQpOwogICAgICAgIHdlaVdpdGhkcmF3ZWQgPSB3ZWlVbmxvY2tlZDsKICAgICAgICB0ZWFtV2FsbGV0LnRyYW5zZmVyKHRvV2l0aGRyYXcpOwogICAgICAgIFdpdGhkcmF3KHRvV2l0aGRyYXcpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFdlaVJhaXNlZCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgIHJldHVybiBjcm93ZHNhbGVDb250cmFjdC53ZWlSYWlzZWQoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBpbmNyZWFzZVdpdGhkcmF3YWxDaHVuaygpIHsKICAgICAgICByZXF1aXJlKGlzQ3Jvd2RzYWxlRmluaXNoZWQpOwogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhZGRyZXNzKHZvdGluZ1Byb3h5Q29udHJhY3QpKTsKICAgICAgICB3ZWlVbmxvY2tlZCA9IHdlaVVubG9ja2VkLmFkZCh3aXRoZHJhd0NodW5rKTsKICAgICAgICBVbmxvY2tXZWkod2VpVW5sb2NrZWQpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFRpbWUoKSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgLy8gSnVzdCByZXR1cm5zIGBub3dgIHZhbHVlCiAgICAgICAgLy8gVGhpcyBmdW5jdGlvbiBpcyByZWRlZmluZWQgaW4gRXRoZWFybmFsUmVwVG9rZW5Dcm93ZHNhbGVNb2NrIGNvbnRyYWN0CiAgICAgICAgLy8gdG8gYWxsb3cgdGVzdGluZyBjb250cmFjdCBiZWhhdmlvdXIgYXQgZGlmZmVyZW50IHRpbWUgbW9tZW50cwogICAgICAgIHJldHVybiBub3c7CiAgICB9CgogICAgZnVuY3Rpb24gZW5hYmxlUmVmdW5kcygpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkZHJlc3Modm90aW5nUHJveHlDb250cmFjdCkpOwogICAgICAgIGlzUmVmdW5kc0VuYWJsZWQgPSB0cnVlOwogICAgfQogICAgCiAgICBmdW5jdGlvbiByZWZ1bmRJbnZlc3Rvcih1aW50MjU2IF90b2tlbnNUb0J1cm4pIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShpc1JlZnVuZHNFbmFibGVkKTsKICAgICAgICByZXF1aXJlKGFkZHJlc3ModG9rZW5Db250cmFjdCkgIT0gYWRkcmVzcygweDApKTsKICAgICAgICBpZiAocmVmdW5kc0lzc3VlZCA9PSAwKSB7CiAgICAgICAgICAgIHBlcmNlbnRMZWZ0ID0gcGVyY2VudExlZnRGcm9tVG90YWxSYWlzZWQoKS5tdWwoMTAwKjEwMDApLmRpdigxIGV0aGVyKTsKICAgICAgICB9CiAgICAgICAgdWludDI1NiB0b2tlblJhdGUgPSBjcm93ZHNhbGVDb250cmFjdC5nZXRUb2tlblJhdGVFdGhlcigpOwogICAgICAgIHVpbnQyNTYgdG9SZWZ1bmQgPSB0b2tlblJhdGUubXVsKF90b2tlbnNUb0J1cm4pLmRpdigxIGV0aGVyKTsKICAgICAgICAKICAgICAgICB0b1JlZnVuZCA9IHRvUmVmdW5kLm11bChwZXJjZW50TGVmdCkuZGl2KDEwMCoxMDAwKTsKICAgICAgICByZXF1aXJlKHRvUmVmdW5kID4gMCk7CiAgICAgICAgdG9rZW5Db250cmFjdC5idXJuRnJvbShtc2cuc2VuZGVyLCBfdG9rZW5zVG9CdXJuKTsKICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKHRvUmVmdW5kKTsKICAgICAgICByZWZ1bmRzSXNzdWVkID0gcmVmdW5kc0lzc3VlZC5hZGQoMSk7CiAgICAgICAgUmVmdW5kZWRJbnZlc3Rvcihtc2cuc2VuZGVyLCB0b1JlZnVuZCwgX3Rva2Vuc1RvQnVybik7CiAgICB9CgogICAgZnVuY3Rpb24gcGVyY2VudExlZnRGcm9tVG90YWxSYWlzZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHBlcmNlbnQodGhpcy5iYWxhbmNlLCBnZXRXZWlSYWlzZWQoKSwgMTgpOwogICAgfQoKICAgIGZ1bmN0aW9uIHBlcmNlbnQodWludCBudW1lcmF0b3IsIHVpbnQgZGVub21pbmF0b3IsIHVpbnQgcHJlY2lzaW9uKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zKHVpbnQgcXVvdGllbnQpIHsKICAgICAgICAvLyBjYXV0aW9uLCBjaGVjayBzYWZlLXRvLW11bHRpcGx5IGhlcmUKICAgICAgICB1aW50IF9udW1lcmF0b3IgID0gbnVtZXJhdG9yICogMTAgKiogKHByZWNpc2lvbisxKTsKICAgICAgICAvLyB3aXRoIHJvdW5kaW5nIG9mIGxhc3QgZGlnaXQKICAgICAgICB1aW50IF9xdW90aWVudCA9ICAoKF9udW1lcmF0b3IgLyBkZW5vbWluYXRvcikgKyA1KSAvIDEwOwogICAgICAgIHJldHVybiAoIF9xdW90aWVudCk7CiAgICB9CgogICAgZnVuY3Rpb24gY2xhaW1Ub2tlbnMoYWRkcmVzcyBfdG9rZW4sIGFkZHJlc3MgX3RvKSBwdWJsaWMgb25seU93bmVyIHsgICAgCiAgICAgICAgRVJDMjBCYXNpYyB0b2tlbiA9IEVSQzIwQmFzaWMoX3Rva2VuKTsKICAgICAgICB1aW50MjU2IGJhbGFuY2UgPSB0b2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgICAgICAgdG9rZW4udHJhbnNmZXIoX3RvLCBiYWxhbmNlKTsKICAgIH0KfQoKY29udHJhY3QgVm90aW5nUHJveHkgaXMgT3duYWJsZSB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsgICAgCiAgICBUcmVhc3VyeSBwdWJsaWMgdHJlYXN1cnlDb250cmFjdDsKICAgIEV0aGVhcm5hbFJlcFRva2VuIHB1YmxpYyB0b2tlbkNvbnRyYWN0OwogICAgQmFsbG90IHB1YmxpYyBjdXJyZW50SW5jcmVhc2VXaXRoZHJhd2FsVGVhbUJhbGxvdDsKICAgIFJlZnVuZEludmVzdG9yc0JhbGxvdCBwdWJsaWMgY3VycmVudFJlZnVuZEludmVzdG9yc0JhbGxvdDsKCiAgICBmdW5jdGlvbiAgVm90aW5nUHJveHkoYWRkcmVzcyBfdHJlYXN1cnlDb250cmFjdCwgYWRkcmVzcyBfdG9rZW5Db250cmFjdCkgewogICAgICAgIHRyZWFzdXJ5Q29udHJhY3QgPSBUcmVhc3VyeShfdHJlYXN1cnlDb250cmFjdCk7CiAgICAgICAgdG9rZW5Db250cmFjdCA9IEV0aGVhcm5hbFJlcFRva2VuKF90b2tlbkNvbnRyYWN0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdGFydGluY3JlYXNlV2l0aGRyYXdhbFRlYW0oKSBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUodHJlYXN1cnlDb250cmFjdC5pc0Nyb3dkc2FsZUZpbmlzaGVkKCkpOwogICAgICAgIHJlcXVpcmUoYWRkcmVzcyhjdXJyZW50UmVmdW5kSW52ZXN0b3JzQmFsbG90KSA9PSAweDAgfHwgY3VycmVudFJlZnVuZEludmVzdG9yc0JhbGxvdC5pc1ZvdGluZ0FjdGl2ZSgpID09IGZhbHNlKTsKICAgICAgICBpZihhZGRyZXNzKGN1cnJlbnRJbmNyZWFzZVdpdGhkcmF3YWxUZWFtQmFsbG90KSA9PSAweDApIHsKICAgICAgICAgICAgY3VycmVudEluY3JlYXNlV2l0aGRyYXdhbFRlYW1CYWxsb3QgPSAgbmV3IEJhbGxvdCh0b2tlbkNvbnRyYWN0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXF1aXJlKGdldERheXNQYXNzZWRTaW5jZUxhc3RUZWFtRnVuZHNCYWxsb3QoKSA+IDIpOwogICAgICAgICAgICBjdXJyZW50SW5jcmVhc2VXaXRoZHJhd2FsVGVhbUJhbGxvdCA9ICBuZXcgQmFsbG90KHRva2VuQ29udHJhY3QpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBzdGFydFJlZnVuZEludmVzdG9yc0JhbGxvdCgpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZSh0cmVhc3VyeUNvbnRyYWN0LmlzQ3Jvd2RzYWxlRmluaXNoZWQoKSk7CiAgICAgICAgcmVxdWlyZShhZGRyZXNzKGN1cnJlbnRJbmNyZWFzZVdpdGhkcmF3YWxUZWFtQmFsbG90KSA9PSAweDAgfHwgY3VycmVudEluY3JlYXNlV2l0aGRyYXdhbFRlYW1CYWxsb3QuaXNWb3RpbmdBY3RpdmUoKSA9PSBmYWxzZSk7CiAgICAgICAgaWYoYWRkcmVzcyhjdXJyZW50UmVmdW5kSW52ZXN0b3JzQmFsbG90KSA9PSAweDApIHsKICAgICAgICAgICAgY3VycmVudFJlZnVuZEludmVzdG9yc0JhbGxvdCA9ICBuZXcgUmVmdW5kSW52ZXN0b3JzQmFsbG90KHRva2VuQ29udHJhY3QpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlcXVpcmUoZ2V0RGF5c1Bhc3NlZFNpbmNlTGFzdFJlZnVuZEJhbGxvdCgpID4gMik7CiAgICAgICAgICAgIGN1cnJlbnRSZWZ1bmRJbnZlc3RvcnNCYWxsb3QgPSAgbmV3IFJlZnVuZEludmVzdG9yc0JhbGxvdCh0b2tlbkNvbnRyYWN0KTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0RGF5c1Bhc3NlZFNpbmNlTGFzdFJlZnVuZEJhbGxvdCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gZ2V0VGltZSgpLnN1YihjdXJyZW50UmVmdW5kSW52ZXN0b3JzQmFsbG90LmJhbGxvdFN0YXJ0ZWQoKSkuZGl2KDEgZGF5cyk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0RGF5c1Bhc3NlZFNpbmNlTGFzdFRlYW1GdW5kc0JhbGxvdCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gZ2V0VGltZSgpLnN1YihjdXJyZW50SW5jcmVhc2VXaXRoZHJhd2FsVGVhbUJhbGxvdC5iYWxsb3RTdGFydGVkKCkpLmRpdigxIGRheXMpOwogICAgfQoKICAgIGZ1bmN0aW9uIHByb3h5SW5jcmVhc2VXaXRoZHJhd2FsQ2h1bmsoKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhZGRyZXNzKGN1cnJlbnRJbmNyZWFzZVdpdGhkcmF3YWxUZWFtQmFsbG90KSk7CiAgICAgICAgdHJlYXN1cnlDb250cmFjdC5pbmNyZWFzZVdpdGhkcmF3YWxDaHVuaygpOwogICAgfQoKICAgIGZ1bmN0aW9uIHByb3h5RW5hYmxlUmVmdW5kcygpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkZHJlc3MoY3VycmVudFJlZnVuZEludmVzdG9yc0JhbGxvdCkpOwogICAgICAgIHRyZWFzdXJ5Q29udHJhY3QuZW5hYmxlUmVmdW5kcygpOwogICAgfQoKICAgIGZ1bmN0aW9uKCkgewogICAgICAgIHJldmVydCgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFRpbWUoKSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgLy8gSnVzdCByZXR1cm5zIGBub3dgIHZhbHVlCiAgICAgICAgLy8gVGhpcyBmdW5jdGlvbiBpcyByZWRlZmluZWQgaW4gRXRoZWFybmFsUmVwVG9rZW5Dcm93ZHNhbGVNb2NrIGNvbnRyYWN0CiAgICAgICAgLy8gdG8gYWxsb3cgdGVzdGluZyBjb250cmFjdCBiZWhhdmlvdXIgYXQgZGlmZmVyZW50IHRpbWUgbW9tZW50cwogICAgICAgIHJldHVybiBub3c7CiAgICB9CgogICAgZnVuY3Rpb24gY2xhaW1Ub2tlbnMoYWRkcmVzcyBfdG9rZW4pIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIGlmIChfdG9rZW4gPT0gMHgwKSB7CiAgICAgICAgICAgIG93bmVyLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAKICAgICAgICBFUkMyMEJhc2ljIHRva2VuID0gRVJDMjBCYXNpYyhfdG9rZW4pOwogICAgICAgIHVpbnQyNTYgYmFsYW5jZSA9IHRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgICAgICB0b2tlbi50cmFuc2Zlcihvd25lciwgYmFsYW5jZSk7CiAgICB9Cgp9'.
	

]
