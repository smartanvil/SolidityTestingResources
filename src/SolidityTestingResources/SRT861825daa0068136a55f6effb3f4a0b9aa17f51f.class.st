Class {
	#name : #SRT861825daa0068136a55f6effb3f4a0b9aa17f51f,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT861825daa0068136a55f6effb3f4a0b9aa17f51f >> base64 [
	^ 'Ly8gIENvcHlyaWdodCAoYykgMjAxNywgMjAxOCBFdGhlckphY2suaW8uIEFsbCByaWdodHMgcmVzZXJ2ZWQuCi8vICBUaGlzIGNvZGUgaXMgZGlzY2xvc2VkIG9ubHkgdG8gYmUgdXNlZCBmb3IgaW5zcGVjdGlvbiBhbmQgYXVkaXQgcHVycG9zZXMuCi8vICBDb2RlIG1vZGlmaWNhdGlvbiBhbmQgdXNlIGZvciBhbnkgcHVycG9zZSBvdGhlciB0aGFuIHNlY3VyaXR5IGF1ZGl0Ci8vICBpcyBwcm9oaWJpdGVkLiBDcmVhdGlvbiBvZiBkZXJpdmVkIHdvcmtzIG9yIHVuYXV0aG9yaXplZCBkZXBsb3ltZW50Ci8vICBvZiB0aGUgY29kZSBvciBhbnkgaXRzIHBvcnRpb24gdG8gYSBibG9ja2NoYWluIGlzIHByb2hpYml0ZWQuCgpwcmFnbWEgc29saWRpdHkgXjAuNC4xOTsKCgpjb250cmFjdCBIb3VzZU93bmVkIHsKICAgIGFkZHJlc3MgaG91c2U7CgogICAgbW9kaWZpZXIgb25seUhvdXNlIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gaG91c2UpOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgQ29udHJhY3QgY29uc3RydWN0b3IKICAgIGZ1bmN0aW9uIEhvdXNlT3duZWQoKSBwdWJsaWMgewogICAgICAgIGhvdXNlID0gbXNnLnNlbmRlcjsKICAgIH0KfQoKCi8vIFNhZmVNYXRoIGlzIGEgcGFydCBvZiBaZXBwZWxpbiBTb2xpZGl0eSBsaWJyYXJ5Ci8vIGxpY2Vuc2VkIHVuZGVyIE1JVCBMaWNlbnNlCi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9PcGVuWmVwcGVsaW4vemVwcGVsaW4tc29saWRpdHkvYmxvYi9tYXN0ZXIvTElDRU5TRQoKLyoqCiAqIEB0aXRsZSBTYWZlTWF0aAogKiBAZGV2IE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MgdGhhdCB0aHJvdyBvbiBlcnJvcgogKi8KbGlicmFyeSBTYWZlTWF0aCB7CiAgICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIGlmIChhID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgICAgIGFzc2VydChjIC8gYSA9PSBiKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICAgICAgcmV0dXJuIGM7CiAgICB9CgogICAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICBhc3NlcnQoYiA8PSBhKTsKICAgICAgICByZXR1cm4gYSAtIGI7CiAgICB9CgogICAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgICAgICBhc3NlcnQoYyA+PSBhKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KfQoKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBFUkMgVG9rZW4gU3RhbmRhcmQgIzIwIEludGVyZmFjZQovLyBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9ibG9iL21hc3Rlci9FSVBTL2VpcC0yMC10b2tlbi1zdGFuZGFyZC5tZAovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmNvbnRyYWN0IEVSQzIwSW50ZXJmYWNlIHsKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCBiYWxhbmNlKTsKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVtYWluaW5nKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQgdmFsdWUpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIHRva2VuT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50IHZhbHVlKTsKfQoKY29udHJhY3QgVG9rZW4gaXMgSG91c2VPd25lZCwgRVJDMjBJbnRlcmZhY2UgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7CgogICAgLy8gUHVibGljIHZhcmlhYmxlcyBvZiB0aGUgdG9rZW4KICAgIHN0cmluZyBwdWJsaWMgbmFtZTsKICAgIHN0cmluZyBwdWJsaWMgc3ltYm9sOwogICAgdWludDggcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gMDsKICAgIHVpbnQyNTYgcHVibGljIHN1cHBseTsKCiAgICAvLyBUcnVzdGVkIGFkZHJlc3NlcwogICAgSmFja3BvdCBwdWJsaWMgamFja3BvdDsKICAgIGFkZHJlc3MgcHVibGljIGNyb3VwaWVyOwoKICAgIC8vIEFsbCB1c2VycycgYmFsYW5jZXMKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgaW50ZXJuYWwgYmFsYW5jZXM7CiAgICAvLyBVc2VycycgZGVwb3NpdHMgd2l0aCBDcm91cGllcgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgZGVwb3NpdE9mOwogICAgLy8gVG90YWwgYW1vdW50IG9mIGRlcG9zaXRzCiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbERlcG9zaXQ7CiAgICAvLyBUb3RhbCBhbW91bnQgb2YgIkZyb3plbiBEZXBvc2l0IFBvb2wiIC0tIHRoZSB0b2tlbnMgZm9yIHNhbGUgYXQgQ3JvdXBpZXIKICAgIHVpbnQyNTYgcHVibGljIGZyb3plblBvb2w7CiAgICAvLyBBbGxvd2FuY2UgbWFwcGluZwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBpbnRlcm5hbCBhbGxvd2VkOwoKICAgIC8vLy8vLwogICAgLy8vIEB0aXRsZSBNb2RpZmllcnMKICAgIC8vCgogICAgLy8vIEBkZXYgT25seSBDcm91cGllcgogICAgbW9kaWZpZXIgb25seUNyb3VwaWVyIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY3JvdXBpZXIpOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgT25seSBKYWNrcG90CiAgICBtb2RpZmllciBvbmx5SmFja3BvdCB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkZHJlc3MoamFja3BvdCkpOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgUHJvdGVjdGlvbiBmcm9tIHNob3J0IGFkZHJlc3MgYXR0YWNrCiAgICBtb2RpZmllciBvbmx5UGF5bG9hZFNpemUodWludCBzaXplKSB7CiAgICAgICAgYXNzZXJ0KG1zZy5kYXRhLmxlbmd0aCA9PSBzaXplICsgNCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8vLy8KICAgIC8vLyBAdGl0bGUgRXZlbnRzCiAgICAvLwoKICAgIC8vLyBAZGV2IEZpcmVkIHdoZW4gYSB0b2tlbiBpcyBidXJuZWQgKGJldCBtYWRlKQogICAgZXZlbnQgQnVybihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgdWludDI1NiB2YWx1ZSk7CgogICAgLy8vIEBkZXYgRmlyZWQgd2hlbiBhIGRlcG9zaXQgaXMgbWFkZSBvciB3aXRoZHJhd24KICAgIC8vLyAgICAgICBkaXJlY3Rpb24gPT0gMDogZGVwb3NpdAogICAgLy8vICAgICAgIGRpcmVjdGlvbiA9PSAxOiB3aXRoZHJhd2FsCiAgICBldmVudCBEZXBvc2l0KGFkZHJlc3MgaW5kZXhlZCBmcm9tLCB1aW50MjU2IHZhbHVlLCB1aW50OCBkaXJlY3Rpb24sIHVpbnQyNTYgbmV3RGVwb3NpdCk7CgogICAgLy8vIEBkZXYgRmlyZWQgd2hlbiBhIGRlcG9zaXQgd2l0aCBDcm91cGllciBpcyBmcm96ZW4gKHNldCBmb3Igc2FsZSkKICAgIGV2ZW50IERlcG9zaXRGcm96ZW4oYWRkcmVzcyBpbmRleGVkIGZyb20sIHVpbnQyNTYgdmFsdWUpOwoKICAgIC8vLyBAZGV2IEZpcmVkIHdoZW4gYSBkZXBvc2l0IHdpdGggQ3JvdXBpZXIgaXMgdW5mcm96ZW4gKHJlbW92ZWQgZnJvbSBzYWxlKQogICAgLy8gICAgICAgVmFsdWUgaXMgdGhlIHJlc3VsdGluZyBkZXBvc2l0LCBOT1QgdGhlIHVuZnJvemVuIGFtb3VudAogICAgZXZlbnQgRGVwb3NpdFVuZnJvemVuKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCB1aW50MjU2IHZhbHVlKTsKCiAgICAvLy8vLy8KICAgIC8vLyBAdGl0bGUgQ29uc3RydWN0b3IgYW5kIEluaXRpYWxpemF0aW9uCiAgICAvLwoKICAgIC8vLyBAZGV2IEluaXRpYWxpemVzIGNvbnRyYWN0IHdpdGggaW5pdGlhbCBzdXBwbHkgdG9rZW5zIHRvIHRoZSBjcmVhdG9yIG9mIHRoZSBjb250cmFjdAogICAgZnVuY3Rpb24gVG9rZW4oKSBIb3VzZU93bmVkKCkgcHVibGljIHsKICAgICAgICBuYW1lID0gIkpBQ0sgVG9rZW4iOwogICAgICAgIHN5bWJvbCA9ICJKQUNLIjsKICAgICAgICBzdXBwbHkgPSAxMDAwMDAwOwogICAgfQoKICAgIC8vLyBAZGV2IEZ1bmN0aW9uIHRvIHNldCBhZGRyZXNzIG9mIEphY2twb3QgY29udHJhY3Qgb25jZSBhZnRlciBjcmVhdGlvbgogICAgLy8vIEBwYXJhbSBfamFja3BvdCBBZGRyZXNzIG9mIHRoZSBKYWNrcG90IGNvbnRyYWN0CiAgICBmdW5jdGlvbiBzZXRKYWNrcG90KGFkZHJlc3MgX2phY2twb3QpIG9ubHlIb3VzZSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoYWRkcmVzcyhqYWNrcG90KSA9PSAweDApOwogICAgICAgIHJlcXVpcmUoX2phY2twb3QgIT0gYWRkcmVzcyh0aGlzKSk7IC8vIFByb3RlY3Rpb24gZnJvbSBhZG1pbidzIG1pc3Rha2UKCiAgICAgICAgamFja3BvdCA9IEphY2twb3QoX2phY2twb3QpOwoKICAgICAgICB1aW50MjU2IGJvdW50eVBvcnRpb24gPSBzdXBwbHkgLyA0MDsgICAgICAgICAgIC8vIDIuNSUgaXMgdGhlIGJvdW50eSBwb3J0aW9uIGZvciBtYXJrZXRpbmcgZXhwZW5zZXMKICAgICAgICBiYWxhbmNlc1tob3VzZV0gPSBib3VudHlQb3J0aW9uOyAgICAgICAgICAgICAgIC8vIEhvdXNlIHJlY2VpdmVzIHRoZSBib3VudHkgdG9rZW5zCiAgICAgICAgYmFsYW5jZXNbamFja3BvdF0gPSBzdXBwbHkgLSBib3VudHlQb3J0aW9uOyAgICAvLyBKYWNrcG90IGdldHMgdGhlIHJlc3QKCiAgICAgICAgY3JvdXBpZXIgPSBqYWNrcG90LmNyb3VwaWVyKCk7CiAgICB9CgogICAgLy8vLy8vCiAgICAvLy8gQHRpdGxlIFB1YmxpYyBNZXRob2RzCiAgICAvLwoKCiAgICAvLy8gQGRldiBDcm91cGllciBpbnZva2VzIHRoaXMgbWV0aG9kIHRvIHJldHVybiBkZXBvc2l0cyB0byBwbGF5ZXJzCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAvLy8gQHBhcmFtIF9leHRyYSBBZGRpdGlvbmFsIG9mZi1jaGFpbiBjcmVkaXQgKEFpckRyb3Agc3VwcG9ydCksIHNvIHRoYXQgY3JvdXBpZXIgY2FuIHJldHVybiBtb3JlIHRoYW4gdGhlIHVzZXIgaGFzIGFjdHVhbGx5IGRlcG9zaXRlZAogICAgZnVuY3Rpb24gcmV0dXJuRGVwb3NpdChhZGRyZXNzIF90bywgdWludDI1NiBfZXh0cmEpIG9ubHlDcm91cGllciBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoZGVwb3NpdE9mW190b10gPiAwIHx8IF9leHRyYSA+IDApOwogICAgICAgIHVpbnQyNTYgYW1vdW50ID0gZGVwb3NpdE9mW190b107CiAgICAgICAgZGVwb3NpdE9mW190b10gPSAwOwogICAgICAgIHRvdGFsRGVwb3NpdCA9IHRvdGFsRGVwb3NpdC5zdWIoYW1vdW50KTsKCiAgICAgICAgX3RyYW5zZmVyKGNyb3VwaWVyLCBfdG8sIGFtb3VudC5hZGQoX2V4dHJhKSk7CgogICAgICAgIERlcG9zaXQoX3RvLCBhbW91bnQsIDEsIDApOwogICAgfQoKICAgIC8vLyBAZGV2IEdldHMgdGhlIGJhbGFuY2Ugb2YgdGhlIHNwZWNpZmllZCBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBzdXBwbHk7CiAgICB9CgogICAgLy8vIEBkZXYgU2VuZCBgX3ZhbHVlYCB0b2tlbnMgdG8gYF90b2AKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIHRoZSBhbW91bnQgdG8gc2VuZAogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBvbmx5UGF5bG9hZFNpemUoMiAqIDMyKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoYWRkcmVzcyhqYWNrcG90KSAhPSAweDApOwogICAgICAgIHJlcXVpcmUoY3JvdXBpZXIgIT0gMHgwKTsKCiAgICAgICAgaWYgKF90byA9PSBhZGRyZXNzKGphY2twb3QpKSB7CiAgICAgICAgICAgIC8vIEl0IGlzIGEgdG9rZW4gYmV0LiBJZ25vcmluZyBfdmFsdWUsIG9ubHkgdXNpbmcgMSB0b2tlbgogICAgICAgICAgICBfYnVybkZyb21BY2NvdW50KG1zZy5zZW5kZXIsIDEpOwogICAgICAgICAgICBqYWNrcG90LmJldFRva2VuKG1zZy5zZW5kZXIpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGlmIChfdG8gPT0gY3JvdXBpZXIgJiYgbXNnLnNlbmRlciAhPSBob3VzZSkgewogICAgICAgICAgICAvLyBJdCdzIGEgZGVwb3NpdCB0byBDcm91cGllci4gSW4gYWRkaXRpb24gdG8gdHJhbnNmZXJyaW5nIHRoZSB0b2tlbiwKICAgICAgICAgICAgLy8gbWFyayBpdCBpbiB0aGUgZGVwb3NpdHMgdGFibGUKCiAgICAgICAgICAgIC8vIEhvdXNlIGNhbid0IG1ha2UgZGVwb3NpdHMuIElmIEhvdXNlIGlzIHRyYW5zZmVycmluZyBzb21ldGhpbmcgdG8KICAgICAgICAgICAgLy8gQ3JvdXBpZXIsIGl0J3MganVzdCBhIHRyYW5zZmVyLCBub3RoaW5nIG1vcmUKCiAgICAgICAgICAgIGRlcG9zaXRPZlttc2cuc2VuZGVyXSArPSBfdmFsdWU7CiAgICAgICAgICAgIHRvdGFsRGVwb3NpdCA9IHRvdGFsRGVwb3NpdC5hZGQoX3ZhbHVlKTsKCiAgICAgICAgICAgIERlcG9zaXQobXNnLnNlbmRlciwgX3ZhbHVlLCAwLCBkZXBvc2l0T2ZbbXNnLnNlbmRlcl0pOwogICAgICAgIH0KCiAgICAgICAgLy8gSW4gYWxsIGNhc2VzIGJ1dCBKYWNrcG90IHRyYW5zZmVyICh3aGljaCBpcyB0ZXJtaW5hdGVkIGJ5IGEgcmV0dXJuKSwgYWN0dWFsbHkKICAgICAgICAvLyBkbyBwZXJmb3JtIHRoZSB0cmFuc2ZlcgogICAgICAgIHJldHVybiBfdHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgfQoKICAgIC8vLyBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIKICAgIC8vLyBAcGFyYW0gX2Zyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tCiAgICAvLy8gQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHRyYW5zZmVyIHRvCiAgICAvLy8gQHBhcmFtIF92YWx1ZSB1aW50MjU2IHRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGJhbGFuY2VzW19mcm9tXSk7CiAgICAgICAgcmVxdWlyZShfdmFsdWUgPD0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0pOwoKICAgICAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAZGV2IEFwcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWhhbGYgb2YgbXNnLnNlbmRlci4KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgIC8vLyBAcGFyYW0gX293bmVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICAvLy8gQHJldHVybiBBIHVpbnQyNTYgc3BlY2lmeWluZyB0aGUgYW1vdW50IG9mIHRva2VucyBzdGlsbCBhdmFpbGFibGUgZm9yIHRoZSBzcGVuZGVyLgogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgICB9CgogICAgLy8vIEBkZXYgSW5jcmVhc2UgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICAvLy8gQHBhcmFtIF9hZGRlZFZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGluY3JlYXNlIHRoZSBhbGxvd2FuY2UgYnkuCiAgICBmdW5jdGlvbiBpbmNyZWFzZUFwcHJvdmFsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2FkZGVkVmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXS5hZGQoX2FkZGVkVmFsdWUpOwogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgRGVjcmVhc2UgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICAvLy8gQHBhcmFtIF9zdWJ0cmFjdGVkVmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gZGVjcmVhc2UgdGhlIGFsbG93YW5jZSBieS4KICAgIGZ1bmN0aW9uIGRlY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfc3VidHJhY3RlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHVpbnQgb2xkVmFsdWUgPSBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXTsKICAgICAgICBpZiAoX3N1YnRyYWN0ZWRWYWx1ZSA+IG9sZFZhbHVlKSB7CiAgICAgICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IG9sZFZhbHVlLnN1Yihfc3VidHJhY3RlZFZhbHVlKTsKICAgICAgICB9CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBDcm91cGllciB1c2VzIHRoaXMgbWV0aG9kIHRvIHNldCBkZXBvc2l0ZWQgY3JlZGl0cyBvZiBhIHBsYXllciBmb3Igc2FsZQogICAgLy8vIEBwYXJhbSBfdXNlciBUaGUgYWRkcmVzcyBvZiB0aGUgdXNlcgogICAgLy8vIEBwYXJhbSBfZXh0cmEgQWRkaXRpb25hbCBvZmYtY2hhaW4gY3JlZGl0IChBaXJEcm9wIHN1cHBvcnQpLCBzbyB0aGF0IGNyb3VwaWVyIGNvdWxkIGhhdmUgZnJvemVuIG1vcmUgdGhhbiB0aGUgdXNlciBoYWQgaW52ZXN0ZWQKICAgIGZ1bmN0aW9uIGZyZWV6ZURlcG9zaXQoYWRkcmVzcyBfdXNlciwgdWludDI1NiBfZXh0cmEpIG9ubHlDcm91cGllciBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoZGVwb3NpdE9mW191c2VyXSA+IDAgfHwgX2V4dHJhID4gMCk7CgogICAgICAgIHVpbnQyNTYgZGVwb3NpdCA9IGRlcG9zaXRPZltfdXNlcl07CiAgICAgICAgZGVwb3NpdE9mW191c2VyXSA9IGRlcG9zaXRPZltfdXNlcl0uc3ViKGRlcG9zaXQpOwogICAgICAgIHRvdGFsRGVwb3NpdCA9IHRvdGFsRGVwb3NpdC5zdWIoZGVwb3NpdCk7CgogICAgICAgIHVpbnQyNTYgZGVwb3NpdFdpdGhFeHRyYSA9IGRlcG9zaXQuYWRkKF9leHRyYSk7CgogICAgICAgIGZyb3plblBvb2wgPSBmcm96ZW5Qb29sLmFkZChkZXBvc2l0V2l0aEV4dHJhKTsKCiAgICAgICAgRGVwb3NpdEZyb3plbihfdXNlciwgZGVwb3NpdFdpdGhFeHRyYSk7CiAgICB9CgogICAgLy8vIEBkZXYgQ3JvdXBpZXIgdXNlcyB0aGlzIG1ldGhvZCBzdG9wIHNlbGxpbmcgdXNlcidzIHRva2VucyBhbmQgcmV0dXJuIHRoZW0gdG8gbm9ybWFsIGRlcG9zaXQKICAgIC8vLyBAcGFyYW0gX3VzZXIgVGhlIHVzZXIgd2hvc2UgZGVwb3NpdCBpcyBiZWluZyB1bmZyb3plbgogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIHZhbHVlIHRvIHVuZnJlZXplIGFjY29yZGluZyB0byBDcm91cGllcidzIHJlY29yZHMgKG9mZi1jaGFpbiBzYWxlIGRhdGEpCiAgICBmdW5jdGlvbiB1bmZyZWV6ZURlcG9zaXQoYWRkcmVzcyBfdXNlciwgdWludDI1NiBfdmFsdWUpIG9ubHlDcm91cGllciBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoX3ZhbHVlID4gMCk7CiAgICAgICAgcmVxdWlyZShmcm96ZW5Qb29sID49IF92YWx1ZSk7CgogICAgICAgIGRlcG9zaXRPZltfdXNlcl0gPSBkZXBvc2l0T2ZbX3VzZXJdLmFkZChfdmFsdWUpOwogICAgICAgIHRvdGFsRGVwb3NpdCA9IHRvdGFsRGVwb3NpdC5hZGQoX3ZhbHVlKTsKCiAgICAgICAgZnJvemVuUG9vbCA9IGZyb3plblBvb2wuc3ViKF92YWx1ZSk7CgogICAgICAgIERlcG9zaXRVbmZyb3plbihfdXNlciwgZGVwb3NpdE9mW191c2VyXSk7CiAgICB9CgogICAgLy8vIEBkZXYgVGhlIEphY2twb3QgY29udHJhY3QgaW52b2tlcyB0aGlzIG1ldGhvZCB3aGVuIHNlbGxpbmcgdG9rZW5zIGZyb20gQ3JvdXBpZXIKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSByZWNpcGllbnQgb2YgdGhlIHRva2VucwogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudAogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tQ3JvdXBpZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBvbmx5SmFja3BvdCBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoX3ZhbHVlID4gMCk7CiAgICAgICAgcmVxdWlyZShmcm96ZW5Qb29sID49IF92YWx1ZSk7CgogICAgICAgIGZyb3plblBvb2wgPSBmcm96ZW5Qb29sLnN1YihfdmFsdWUpOwoKICAgICAgICBfdHJhbnNmZXIoY3JvdXBpZXIsIF90bywgX3ZhbHVlKTsKICAgIH0KCiAgICAvLy8vLy8KICAgIC8vLyBAdGl0bGUgSW50ZXJuYWwgTWV0aG9kcwogICAgLy8KCiAgICAvLy8gQGRldiBJbnRlcm5hbCB0cmFuc2ZlciBmdW5jdGlvbgogICAgLy8vIEBwYXJhbSBfZnJvbSBGcm9tIGFkZHJlc3MKICAgIC8vLyBAcGFyYW0gX3RvIFRvIGFkZHJlc3MKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSB2YWx1ZSB0byB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gc3VjY2VzcwogICAgZnVuY3Rpb24gX3RyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOyAgICAgICAgICAgICAgICAgICAgICAgICAvLyBQcmV2ZW50IHRyYW5zZmVyIHRvIDB4MCBhZGRyZXNzCiAgICAgICAgcmVxdWlyZShiYWxhbmNlc1tfZnJvbV0gPj0gX3ZhbHVlKTsgICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBzZW5kZXIgaGFzIGVub3VnaAogICAgICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX3ZhbHVlKTsgICAgICAvLyBTdWJ0cmFjdCBmcm9tIHRoZSBzZW5kZXIKICAgICAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsgICAgICAgICAgLy8gQWRkIHRoZSBzYW1lIHRvIHRoZSByZWNpcGllbnQKICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAZGV2IEludGVybmFsIGZ1bmN0aW9uIGZvciBidXJuaW5nIHRva2VucwogICAgLy8vIEBwYXJhbSBfc2VuZGVyIFRoZSB0b2tlbiBzZW5kZXIgKHdob3NlIHRva2VucyBhcmUgYmVpbmcgYnVybmVkKQogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYnVybgogICAgZnVuY3Rpb24gX2J1cm5Gcm9tQWNjb3VudChhZGRyZXNzIF9zZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBpbnRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShiYWxhbmNlc1tfc2VuZGVyXSA+PSBfdmFsdWUpOyAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBzZW5kZXIgaGFzIGVub3VnaAogICAgICAgIGJhbGFuY2VzW19zZW5kZXJdID0gYmFsYW5jZXNbX3NlbmRlcl0uc3ViKF92YWx1ZSk7ICAvLyBTdWJ0cmFjdCBmcm9tIHRoZSBzZW5kZXIKICAgICAgICBzdXBwbHkgPSBzdXBwbHkuc3ViKF92YWx1ZSk7ICAgICAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlcyB0b3RhbFN1cHBseQogICAgICAgIEJ1cm4oX3NlbmRlciwgX3ZhbHVlKTsKICAgIH0KCn0KCmNvbnRyYWN0IEphY2twb3QgaXMgSG91c2VPd25lZCB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgICBlbnVtIFN0YWdlcyB7CiAgICAgICAgSW5pdGlhbE9mZmVyLCAgIC8vIElDTyBzdGFnZTogZm9ybWluZyB0aGUgamFja3BvdCBmdW5kCiAgICAgICAgR2FtZU9uLCAgICAgICAgIC8vIFRoZSBnYW1lIGlzIHJ1bm5pbmcKICAgICAgICBHYW1lT3ZlciwgICAgICAgLy8gVGhlIGphY2twb3QgaXMgd29uLCBwYXlpbmcgb3V0IHRoZSBqYWNrcG90CiAgICAgICAgQWJvcnRlZCAgICAgICAgIC8vIElDTyBhYm9ydGVkLCByZWZ1bmRpbmcgaW52ZXN0bWVudHMKICAgIH0KCiAgICB1aW50MjU2IGNvbnN0YW50IGluaXRpYWxJY29Ub2tlblByaWNlID0gNCBmaW5uZXk7CiAgICB1aW50MjU2IGNvbnN0YW50IGluaXRpYWxCZXRBbW91bnQgPSAxMCBmaW5uZXk7CiAgICB1aW50IGNvbnN0YW50IGdhbWVTdGFydEphY2twb3RUaHJlc2hvbGQgPSAzMzMgZXRoZXI7CiAgICB1aW50IGNvbnN0YW50IGljb1Rlcm1pbmF0aW9uVGltZW91dCA9IDQ4IGhvdXJzOwoKICAgIC8vIFRoZXNlIHZhcmlhYmxlcyBob2xkIHRoZSB2YWx1ZXMgbmVlZGVkIGZvciBtaW5vciBwcml6ZSBjaGVja2luZzoKICAgIC8vICAtIHdoZW4gdGhleSB3ZXJlIGxhc3Qgd29uIChvbmNlIHRoZSBudW1iZXIgcmVhY2hlcyB0aGUgY29ycmVzcG9uZGluZyBhbW91bnQsIHRoZQogICAgLy8gICAgbWlub3IgcHJpemUgaXMgd29uLCBhbmQgaXQgc2hvdWxkIGJlIHJlc2V0KQogICAgLy8gIC0gaG93IG11Y2ggZXRoZXIgd2FzIGJldCBzaW5jZSBpdCB3YXMgbGFzdCB3b24KICAgIC8vIGBldGhlclNpbmNlKmAgdmFyaWFibGVzIHN0YXJ0IHdpdGggdmFsdWUgb2YgMSBhbmQgYWx3YXlzIGhhdmUgKzEgaW4gdGhlaXIgdmFsdWUKICAgIC8vIHNvIHRoYXQgdGhlIHZhcmlhYmxlcyBuZXZlciBnbyAwLCBmb3IgZ2FzIGNvbnN1bXB0aW9uIGNvbnNpc3RlbmN5CiAgICB1aW50MzIgcHVibGljIHRvdGFsQmV0cyA9IDA7CiAgICB1aW50MjU2IHB1YmxpYyBldGhlclNpbmNlMjAgPSAxOwogICAgdWludDI1NiBwdWJsaWMgZXRoZXJTaW5jZTUwID0gMTsKICAgIHVpbnQyNTYgcHVibGljIGV0aGVyU2luY2UxMDAgPSAxOwogICAgdWludDI1NiBwdWJsaWMgcGVuZGluZ0V0aGVyRm9yQ3JvdXBpZXIgPSAwOwoKICAgIC8vIElDTyBzdGF0dXMKICAgIHVpbnQzMiBwdWJsaWMgaWNvU29sZFRva2VuczsKICAgIHVpbnQyNTYgcHVibGljIGljb0VuZFRpbWU7CgogICAgLy8gSmFja3BvdCBzdGF0dXMKICAgIGFkZHJlc3MgcHVibGljIGxhc3RCZXRVc2VyOwogICAgdWludDI1NiBwdWJsaWMgdGVybWluYXRpb25UaW1lOwogICAgYWRkcmVzcyBwdWJsaWMgd2lubmVyOwogICAgdWludDI1NiBwdWJsaWMgcGVuZGluZ0phY2twb3RGb3JIb3VzZTsKICAgIHVpbnQyNTYgcHVibGljIHBlbmRpbmdKYWNrcG90Rm9yV2lubmVyOwoKICAgIC8vIEdlbmVyYWwgY29uZmlndXJhdGlvbiBhbmQgc3RhZ2UKICAgIGFkZHJlc3MgcHVibGljIGNyb3VwaWVyOwogICAgVG9rZW4gcHVibGljIHRva2VuOwogICAgU3RhZ2VzIHB1YmxpYyBzdGFnZSA9IFN0YWdlcy5Jbml0aWFsT2ZmZXI7CgogICAgLy8gUHJpY2Ugc3RhdGUKICAgIHVpbnQyNTYgcHVibGljIGN1cnJlbnRJY29Ub2tlblByaWNlID0gaW5pdGlhbEljb1Rva2VuUHJpY2U7CiAgICB1aW50MjU2IHB1YmxpYyBjdXJyZW50QmV0QW1vdW50ID0gaW5pdGlhbEJldEFtb3VudDsKCiAgICAvLyBJbnZlc3RtZW50IHRyYWNraW5nIGZvciBlbWVyZ2VuY3kgSUNPIHRlcm1pbmF0aW9uCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBpbnZlc3RtZW50T2Y7CiAgICB1aW50MjU2IHB1YmxpYyBhYm9ydFRpbWU7CgogICAgLy8vLy8vCiAgICAvLy8gQHRpdGxlIE1vZGlmaWVycwogICAgLy8KCiAgICAvLy8gQGRldiBPbmx5IFRva2VuCiAgICBtb2RpZmllciBvbmx5VG9rZW4gewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhZGRyZXNzKHRva2VuKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQGRldiBPbmx5IENyb3VwaWVyCiAgICBtb2RpZmllciBvbmx5Q3JvdXBpZXIgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhZGRyZXNzKGNyb3VwaWVyKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8vLy8KICAgIC8vLyBAdGl0bGUgRXZlbnRzCiAgICAvLwoKICAgIC8vLyBAZGV2IEZpcmVkIHdoZW4gdG9rZW5zIGFyZSBzb2xkIGZvciBFdGhlciBpbiBJQ08KICAgIGV2ZW50IEV0aGVySWNvKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCB1aW50MjU2IHZhbHVlLCB1aW50MjU2IHRva2Vucyk7CgogICAgLy8vIEBkZXYgRmlyZWQgd2hlbiBhIGJpZCB3aXRoIEV0aGVyIGlzIG1hZGUKICAgIGV2ZW50IEV0aGVyQmV0KGFkZHJlc3MgaW5kZXhlZCBmcm9tLCB1aW50MjU2IHZhbHVlLCB1aW50MjU2IGRpdmlkZW5kcyk7CgogICAgLy8vIEBkZXYgRmlyZWQgd2hlbiBhIGJpZCB3aXRoIGEgVG9rZW4gaXMgbWFkZQogICAgZXZlbnQgVG9rZW5CZXQoYWRkcmVzcyBpbmRleGVkIGZyb20pOwoKICAgIC8vLyBAZGV2IEZpcmVkIHdoZW4gYSBiaWRkZXIgd2lucyBhIG1pbm9yIHByaXplCiAgICAvLy8gICAgICBUeXBlOiAxOiAyMCwgMjogNTAsIDM6IDEwMAogICAgZXZlbnQgTWlub3JQcml6ZVBheW91dChhZGRyZXNzIGluZGV4ZWQgZnJvbSwgdWludDI1NiB2YWx1ZSwgdWludDggcHJpemVUeXBlKTsKCiAgICAvLy8gQGRldiBGaXJlZCB3aGVuIGFzIGEgcmVzdWx0IG9mIGV0aGVyIGJpZCwgdG9rZW5zIGFyZSBzb2xkIGZyb20gdGhlIENyb3VwaWVyJ3MgcG9vbAogICAgLy8vICAgICAgVGhlIHBhcmFtZXRlcnMgYXJlIHdobyBib3VnaHQgdGhlbSwgaG93IG1hbnkgdG9rZW5zLCBhbmQgZm9yIGhvdyBtdWNoIEV0aGVyIHRoZXkgd2VyZSBzb2xkCiAgICBldmVudCBTb2xkVG9rZW5zRnJvbUNyb3VwaWVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCB1aW50MjU2IHZhbHVlLCB1aW50MjU2IHRva2Vucyk7CgogICAgLy8vIEBkZXYgRmlyZWQgd2hlbiB0aGUgamFja3BvdCBpcyB3b24KICAgIGV2ZW50IEphY2twb3RXb24oYWRkcmVzcyBpbmRleGVkIGZyb20sIHVpbnQyNTYgdmFsdWUpOwoKCiAgICAvLy8vLy8KICAgIC8vLyBAdGl0bGUgQ29uc3RydWN0b3IgYW5kIEluaXRpYWxpemF0aW9uCiAgICAvLwoKICAgIC8vLyBAZGV2IFRoZSBjb250cmFjdCBjb25zdHJ1Y3RvcgogICAgLy8vIEBwYXJhbSBfY3JvdXBpZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIHRydXN0ZWQgQ3JvdXBpZXIgYm90J3MgYWNjb3VudAogICAgZnVuY3Rpb24gSmFja3BvdChhZGRyZXNzIF9jcm91cGllcikKICAgICAgICBIb3VzZU93bmVkKCkKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICByZXF1aXJlKF9jcm91cGllciAhPSAweDApOwogICAgICAgIGNyb3VwaWVyID0gX2Nyb3VwaWVyOwoKICAgICAgICAvLyBUaGVyZSBhcmUgbm8gYmV0cyAoaXQgZXZlbiBzdGFydHMgaW4gSUNPIHN0YWdlKSwgc28gaW5pdGlhbGl6ZQogICAgICAgIC8vIGxhc3RCZXRVc2VyLCBqdXN0IHNvIHRoYXQgdmFsdWUgaXMgbm90IHplcm8gYW5kIGlzIG1lYW5pbmdmdWwKICAgICAgICAvLyBUaGUgZ2FtZSBjYW4ndCBlbmQgdW50aWwgYXQgbGVhc3Qgb25lIGJpZCBpcyBtYWRlLCBhbmQgb25jZQogICAgICAgIC8vIGEgYmlkIGlzIG1hZGUsIHRoaXMgdmFsdWUgaXMgcGVybWFuZW50bHkgb3ZlcndyaXR0ZW4uCiAgICAgICAgbGFzdEJldFVzZXIgPSBfY3JvdXBpZXI7CiAgICB9CgogICAgLy8vIEBkZXYgRnVuY3Rpb24gdG8gc2V0IGFkZHJlc3Mgb2YgVG9rZW4gY29udHJhY3Qgb25jZSBhZnRlciBjcmVhdGlvbgogICAgLy8vIEBwYXJhbSBfdG9rZW4gQWRkcmVzcyBvZiB0aGUgVG9rZW4gY29udHJhY3QgKEpBQ0sgVG9rZW4pCiAgICBmdW5jdGlvbiBzZXRUb2tlbihhZGRyZXNzIF90b2tlbikgb25seUhvdXNlIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShhZGRyZXNzKHRva2VuKSA9PSAweDApOwogICAgICAgIHJlcXVpcmUoX3Rva2VuICE9IGFkZHJlc3ModGhpcykpOyAvLyBQcm90ZWN0aW9uIGZyb20gYWRtaW4ncyBtaXN0YWtlCgogICAgICAgIHRva2VuID0gVG9rZW4oX3Rva2VuKTsKICAgIH0KCgogICAgLy8vLy8vCiAgICAvLy8gQHRpdGxlIERlZmF1bHQgRnVuY3Rpb24KICAgIC8vCgogICAgLy8vIEBkZXYgVGhlIGZhbGxiYWNrIGZ1bmN0aW9uIGZvciByZWNlaXZpbmcgZXRoZXIgKGJldHMpCiAgICAvLy8gICAgICBBY3Rpb24gZGVwZW5kcyBvbiBzdGFnZXM6CiAgICAvLy8gICAgICAgLSBJQ086IGp1c3Qgc2VsbCB0aGUgdG9rZW5zCiAgICAvLy8gICAgICAgLSBHYW1lOiBhY2NlcHQgYmV0cywgYXdhcmQgdG9rZW5zLCBhd2FyZCBtaW5vciAoMjAsIDUwLCAxMDApIHByaXplcwogICAgLy8vICAgICAgIC0gR2FtZSBPdmVyOiBwYXkgb3V0IGphY2twb3QKICAgIC8vLyAgICAgICAtIEFib3J0ZWQ6IGZhaWwKICAgIGZ1bmN0aW9uKCkgcGF5YWJsZSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoY3JvdXBpZXIgIT0gMHgwKTsKICAgICAgICByZXF1aXJlKGFkZHJlc3ModG9rZW4pICE9IDB4MCk7CiAgICAgICAgcmVxdWlyZShzdGFnZSAhPSBTdGFnZXMuQWJvcnRlZCk7CgogICAgICAgIHVpbnQyNTYgdG9rZW5zOwoKICAgICAgICBpZiAoc3RhZ2UgPT0gU3RhZ2VzLkluaXRpYWxPZmZlcikgewoKICAgICAgICAgICAgLy8gRmlyc3QsIGNoZWNrIGlmIHRoZSBJQ08gaXMgb3Zlci4gSWYgaXQgaXMsIHRyaWdnZXIgdGhlIGV2ZW50cyBhbmQKICAgICAgICAgICAgLy8gcmVmdW5kIHNlbnQgZXRoZXIKICAgICAgICAgICAgYm9vbCBzdGFydGVkID0gY2hlY2tHYW1lU3RhcnQoKTsKICAgICAgICAgICAgaWYgKHN0YXJ0ZWQpIHsKICAgICAgICAgICAgICAgIC8vIFJlZnVuZCBldGhlciB3aXRob3V0IGZhaWxpbmcgdGhlIHRyYW5zYWN0aW9uCiAgICAgICAgICAgICAgICAvLyAoYmVjYXVzZSBzaWRlLWVmZmVjdCBpcyBuZWVkZWQpCiAgICAgICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKG1zZy52YWx1ZSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID49IGN1cnJlbnRJY29Ub2tlblByaWNlKTsKICAgICAgICAKICAgICAgICAgICAgLy8gVEhFIFBMQU4KICAgICAgICAgICAgLy8gMS4gW0NIRUNLICsgRUZGRUNUXSBDYWxjdWxhdGUgaG93IG11Y2ggdGltZXMgcHJpY2UsIHRoZSBpbnZlc3RtZW50IGFtb3VudCBpcywKICAgICAgICAgICAgLy8gICAgY2FsY3VsYXRlIGhvdyBtYW55IHRva2VucyB0aGUgaW52ZXN0b3IgaXMgZ29pbmcgdG8gZ2V0CiAgICAgICAgICAgIC8vIDIuIFtFRkZFQ1RdIExvZyBhbmQgY291bnQKICAgICAgICAgICAgLy8gMy4gW0VGRkVDVF0gQ2hlY2sgZ2FtZSBzdGFydCBjb25kaXRpb25zIGFuZCBtYXliZSBzdGFydCB0aGUgZ2FtZQogICAgICAgICAgICAvLyA0LiBbSU5UXSBBd2FyZCB0aGUgdG9rZW5zCiAgICAgICAgICAgIC8vIDUuIFtJTlRdIFRyYW5zZmVyIDIwJSB0byBob3VzZQoKICAgICAgICAgICAgLy8gMS4gW0NIRUNLICsgRUZGRUNUXSBDaGVja2luZyB0aGUgYW1vdW50CiAgICAgICAgICAgIHRva2VucyA9IF9pY29Ub2tlbnNGb3JFdGhlcihtc2cudmFsdWUpOwoKICAgICAgICAgICAgLy8gMi4gW0VGRkVDVF0gTG9nCiAgICAgICAgICAgIC8vIExvZyB0aGUgSUNPIGV2ZW50IGFuZCBjb3VudCBpbnZlc3RtZW50CiAgICAgICAgICAgIEV0aGVySWNvKG1zZy5zZW5kZXIsIG1zZy52YWx1ZSwgdG9rZW5zKTsKCiAgICAgICAgICAgIGludmVzdG1lbnRPZlttc2cuc2VuZGVyXSA9IGludmVzdG1lbnRPZlttc2cuc2VuZGVyXS5hZGQoCiAgICAgICAgICAgICAgICBtc2cudmFsdWUuc3ViKG1zZy52YWx1ZSAvIDUpCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAvLyAzLiBbRUZGRUNUXSBHYW1lIHN0YXJ0CiAgICAgICAgICAgIC8vIENoZWNrIGlmIHdlIGhhdmUgYWNjdW11bGF0ZWQgdGhlIGphY2twb3QgYW1vdW50IHJlcXVpcmVkIGZvciBnYW1lIHN0YXJ0CiAgICAgICAgICAgIGlmIChpY29FbmRUaW1lID09IDAgJiYgdGhpcy5iYWxhbmNlID49IGdhbWVTdGFydEphY2twb3RUaHJlc2hvbGQpIHsKICAgICAgICAgICAgICAgIGljb0VuZFRpbWUgPSBub3cgKyBpY29UZXJtaW5hdGlvblRpbWVvdXQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIDQuIFtJTlRdIEF3YXJkaW5nIHRva2VucwogICAgICAgICAgICAvLyBBd2FyZCB0aGUgZGVzZXJ2ZWQgdG9rZW5zIChpZiBhbnkpCiAgICAgICAgICAgIGlmICh0b2tlbnMgPiAwKSB7CiAgICAgICAgICAgICAgICB0b2tlbi50cmFuc2Zlcihtc2cuc2VuZGVyLCB0b2tlbnMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyA1LiBbSU5UXSBIb3VzZQogICAgICAgICAgICAvLyBIb3VzZSBnZXRzIDIwJSBvZiBJQ08gYWNjb3JkaW5nIHRvIHRoZSBydWxlcwogICAgICAgICAgICBob3VzZS50cmFuc2Zlcihtc2cudmFsdWUgLyA1KTsKCiAgICAgICAgfSBlbHNlIGlmIChzdGFnZSA9PSBTdGFnZXMuR2FtZU9uKSB7CgogICAgICAgICAgICAvLyBGaXJzdCwgY2hlY2sgaWYgdGhlIGdhbWUgaXMgb3Zlci4gSWYgaXQgaXMsIHRyaWdnZXIgdGhlIGV2ZW50cyBhbmQKICAgICAgICAgICAgLy8gcmVmdW5kIHNlbnQgZXRoZXIKICAgICAgICAgICAgYm9vbCB0ZXJtaW5hdGVkID0gY2hlY2tUZXJtaW5hdGlvbigpOwogICAgICAgICAgICBpZiAodGVybWluYXRlZCkgewogICAgICAgICAgICAgICAgLy8gUmVmdW5kIGV0aGVyIHdpdGhvdXQgZmFpbGluZyB0aGUgdHJhbnNhY3Rpb24KICAgICAgICAgICAgICAgIC8vIChiZWNhdXNlIHNpZGUtZWZmZWN0IGlzIG5lZWRlZCkKICAgICAgICAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIobXNnLnZhbHVlKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gTm93IHByb2Nlc3NpbmcgYW4gRXRoZXIgYmlkCiAgICAgICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID49IGN1cnJlbnRCZXRBbW91bnQpOwoKICAgICAgICAgICAgLy8gVEhFIFBMQU4KICAgICAgICAgICAgLy8gMS4gW0NIRUNLXSBDYWxjdWxhdGUgaG93IG11Y2ggdGltZXMgbWluLWJldCwgdGhlIGJldCBhbW91bnQgaXMsCiAgICAgICAgICAgIC8vICAgIGNhbGN1bGF0ZSBob3cgbWFueSB0b2tlbnMgdGhlIHBsYXllciBpcyBnb2luZyB0byBnZXQKICAgICAgICAgICAgLy8gMi4gW0NIRUNLXSBDaGVjayBob3cgbXVjaCBpcyBzb2xkIGZyb20gdGhlIENyb3VwaWVyJ3MgcG9vbCwgYW5kIGhvdyBtdWNoIGZyb20gSmFja3BvdAogICAgICAgICAgICAvLyAzLiBbRUZGRUNUXSBEZXBvc2l0IDI1JSB0byB0aGUgQ3JvdXBpZXIgKGZvciBkaXZpZGVuZHMgYW5kIGhvdXNlJ3MgYmVuZWZpdCkKICAgICAgICAgICAgLy8gNC4gW0VGRkVDVF0gTG9nIGFuZCBtYXJrIGJpZAogICAgICAgICAgICAvLyA2LiBbSU5UXSBDaGVjayBhbmQgcmV3YXJkIChpZiB3b24pIG1pbm9yICgyMCwgMTAwLCAxMDAwKSBwcml6ZXMKICAgICAgICAgICAgLy8gNy4gW0VGRkVDVF0gVXBkYXRlIGJldCBhbW91bnQKICAgICAgICAgICAgLy8gOC4gW0lOVF0gQXdhcmQgdGhlIHRva2VucwoKCiAgICAgICAgICAgIC8vIDEuIFtDSEVDSyArIEVGRkVDVF0gQ2hlY2tpbmcgdGhlIGJldCBhbW91bnQgYW5kIHRva2VuIHJld2FyZAogICAgICAgICAgICB0b2tlbnMgPSBfYmV0VG9rZW5zRm9yRXRoZXIobXNnLnZhbHVlKTsKCiAgICAgICAgICAgIC8vIDIuIFtDSEVDS10gQ2hlY2sgaG93IG11Y2ggaXMgc29sZCBmcm9tIHRoZSBDcm91cGllcidzIHBvb2wsIGFuZCBob3cgbXVjaCBmcm9tIEphY2twb3QKICAgICAgICAgICAgLy8gICAgVGhlIHByaW9yaXR5IGlzICgxKSBDcm91cGllciwgKDIpIEphY2twb3QKICAgICAgICAgICAgdWludDI1NiBzZWxsaW5nRnJvbUphY2twb3QgPSAwOwogICAgICAgICAgICB1aW50MjU2IHNlbGxpbmdGcm9tQ3JvdXBpZXIgPSAwOwogICAgICAgICAgICBpZiAodG9rZW5zID4gMCkgewogICAgICAgICAgICAgICAgdWludDI1NiBjcm91cGllclBvb2wgPSB0b2tlbi5mcm96ZW5Qb29sKCk7CiAgICAgICAgICAgICAgICB1aW50MjU2IGphY2twb3RQb29sID0gdG9rZW4uYmFsYW5jZU9mKHRoaXMpOwoKICAgICAgICAgICAgICAgIGlmIChjcm91cGllclBvb2wgPT0gMCkgewogICAgICAgICAgICAgICAgICAgIC8vIFNpbXBsZSBjYXNlOiBvbmx5IEphY2twb3QgaXMgc2VsbGluZwogICAgICAgICAgICAgICAgICAgIHNlbGxpbmdGcm9tSmFja3BvdCA9IHRva2VuczsKICAgICAgICAgICAgICAgICAgICBpZiAoc2VsbGluZ0Zyb21KYWNrcG90ID4gamFja3BvdFBvb2wpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VsbGluZ0Zyb21KYWNrcG90ID0gamFja3BvdFBvb2w7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChqYWNrcG90UG9vbCA9PSAwIHx8IHRva2VucyA8PSBjcm91cGllclBvb2wpIHsKICAgICAgICAgICAgICAgICAgICAvLyBTaW1wbGUgY2FzZTogb25seSBDcm91cGllciBpcyBzZWxsaW5nCiAgICAgICAgICAgICAgICAgICAgLy8gZWl0aGVyIGJlY2F1c2UgSmFja3BvdCBoYXMgMCwgb3IgYmVjYXVzZSBDcm91cGllciB0YWtlcyBvdmVyCiAgICAgICAgICAgICAgICAgICAgLy8gYnkgcHJpb3JpdHkgYW5kIGhhcyBlbm91Z2ggdG9rZW5zIGluIGl0cyBwb29sCiAgICAgICAgICAgICAgICAgICAgc2VsbGluZ0Zyb21Dcm91cGllciA9IHRva2VuczsKICAgICAgICAgICAgICAgICAgICBpZiAoc2VsbGluZ0Zyb21Dcm91cGllciA+IGNyb3VwaWVyUG9vbCkgewogICAgICAgICAgICAgICAgICAgICAgICBzZWxsaW5nRnJvbUNyb3VwaWVyID0gY3JvdXBpZXJQb29sOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gQ29tcGxleCBjYXNlOiBib3RoIGFyZSBzZWxsaW5nIG5vdwogICAgICAgICAgICAgICAgICAgIHNlbGxpbmdGcm9tQ3JvdXBpZXIgPSBjcm91cGllclBvb2w7ICAvLyAodG9rZW5zID4gY3JvdXBpZXJQb29sKSBpcyBndWFyYW50ZWVkIGF0IHRoaXMgcG9pbnQKICAgICAgICAgICAgICAgICAgICBzZWxsaW5nRnJvbUphY2twb3QgPSB0b2tlbnMuc3ViKHNlbGxpbmdGcm9tQ3JvdXBpZXIpOwogICAgICAgICAgICAgICAgICAgIGlmIChzZWxsaW5nRnJvbUphY2twb3QgPiBqYWNrcG90UG9vbCkgewogICAgICAgICAgICAgICAgICAgICAgICBzZWxsaW5nRnJvbUphY2twb3QgPSBqYWNrcG90UG9vbDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIDMuIFtFRkZFQ1RdIENyb3VwaWVyIGRlcG9zaXQKICAgICAgICAgICAgLy8gVHJhbnNmZXIgYSBwb3J0aW9uIHRvIHRoZSBDcm91cGllciBmb3IgZGl2aWRlbmQgcGF5b3V0IGFuZCBob3VzZSBiZW5lZml0CiAgICAgICAgICAgIC8vIERpdmlkZW5kcyBhcmUgYSBzdW0gb2Y6CiAgICAgICAgICAgIC8vICAgKyAyNSUgb2YgYmV0CiAgICAgICAgICAgIC8vICAgKyA1MCUgb2YgcHJpY2Ugb2YgdG9rZW5zIHNvbGQgZnJvbSBKYWNrcG90IChvciBqdXN0IGFueXRoaW5nIG90aGVyIHRoYW4gdGhlIGJldCBhbmQgQ3JvdXBpZXIgcGF5bWVudCkKICAgICAgICAgICAgLy8gICArIDAlICBvZiBwcmljZSBvZiB0b2tlbnMgc29sZCBmcm9tIENyb3VwaWVyCiAgICAgICAgICAgIC8vICAgICAgICAgICh0aGF0IGdvZXMgaW4gU29sZFRva2Vuc0Zyb21Dcm91cGllciBpbnN0ZWFkKQogICAgICAgICAgICB1aW50MjU2IHRva2VuVmFsdWUgPSBtc2cudmFsdWUuc3ViKGN1cnJlbnRCZXRBbW91bnQpOwoKICAgICAgICAgICAgdWludDI1NiBjcm91cGllclNhbGVSZXZlbnVlID0gMDsKICAgICAgICAgICAgaWYgKHNlbGxpbmdGcm9tQ3JvdXBpZXIgPiAwKSB7CiAgICAgICAgICAgICAgICBjcm91cGllclNhbGVSZXZlbnVlID0gdG9rZW5WYWx1ZS5kaXYoCiAgICAgICAgICAgICAgICAgICAgc2VsbGluZ0Zyb21KYWNrcG90LmFkZChzZWxsaW5nRnJvbUNyb3VwaWVyKQogICAgICAgICAgICAgICAgKS5tdWwoc2VsbGluZ0Zyb21Dcm91cGllcik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdWludDI1NiBqYWNrcG90U2FsZVJldmVudWUgPSB0b2tlblZhbHVlLnN1Yihjcm91cGllclNhbGVSZXZlbnVlKTsKCiAgICAgICAgICAgIHVpbnQyNTYgZGl2aWRlbmRzID0gKGN1cnJlbnRCZXRBbW91bnQuZGl2KDQpKS5hZGQoamFja3BvdFNhbGVSZXZlbnVlLmRpdigyKSk7CgogICAgICAgICAgICAvLyAxMDAlIG9mIG1vbmV5IGZvciBzZWxsaW5nIGZyb20gQ3JvdXBpZXIgc3RpbGwgZ29lcyB0byBDcm91cGllcgogICAgICAgICAgICAvLyBzbyB0aGF0IGl0J3MgbGF0ZXIgcGFpZCBvdXQgdG8gdGhlIHNlbGxpbmcgdXNlcgogICAgICAgICAgICBwZW5kaW5nRXRoZXJGb3JDcm91cGllciA9IHBlbmRpbmdFdGhlckZvckNyb3VwaWVyLmFkZChkaXZpZGVuZHMuYWRkKGNyb3VwaWVyU2FsZVJldmVudWUpKTsKCiAgICAgICAgICAgIC8vIDQuIFtFRkZFQ1RdIExvZyBhbmQgbWFyayBiaWQKICAgICAgICAgICAgLy8gTG9nIHRoZSBiZXQgd2l0aCBhY3R1YWwgYW1vdW50IGNoYXJnZWQgKHZhbHVlIGxlc3MgY2hhbmdlKQogICAgICAgICAgICBFdGhlckJldChtc2cuc2VuZGVyLCBtc2cudmFsdWUsIGRpdmlkZW5kcyk7CiAgICAgICAgICAgIGxhc3RCZXRVc2VyID0gbXNnLnNlbmRlcjsKICAgICAgICAgICAgdGVybWluYXRpb25UaW1lID0gbm93ICsgX3Rlcm1pbmF0aW9uRHVyYXRpb24oKTsKCiAgICAgICAgICAgIC8vIElmIGFueXRoaW5nIHdhcyBzb2xkIGZyb20gQ3JvdXBpZXIsIGxvZyBpdCBhcHByb3ByaWF0ZWx5CiAgICAgICAgICAgIGlmIChjcm91cGllclNhbGVSZXZlbnVlID4gMCkgewogICAgICAgICAgICAgICAgU29sZFRva2Vuc0Zyb21Dcm91cGllcihtc2cuc2VuZGVyLCBjcm91cGllclNhbGVSZXZlbnVlLCBzZWxsaW5nRnJvbUNyb3VwaWVyKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gNS4gW0lOVF0gTWlub3IgcHJpemVzCiAgICAgICAgICAgIC8vIENoZWNrIGZvciB3aW5uaW5nIG1pbm9yIHByaXplcwogICAgICAgICAgICBfY2hlY2tNaW5vclByaXplcyhtc2cuc2VuZGVyLCBjdXJyZW50QmV0QW1vdW50KTsKCiAgICAgICAgICAgIC8vIDYuIFtFRkZFQ1RdIFVwZGF0ZSBiZXQgYW1vdW50CiAgICAgICAgICAgIF91cGRhdGVCZXRBbW91bnQoKTsKCiAgICAgICAgICAgIC8vIDcuIFtJTlRdIEF3YXJkaW5nIHRva2VucwogICAgICAgICAgICBpZiAoc2VsbGluZ0Zyb21KYWNrcG90ID4gMCkgewogICAgICAgICAgICAgICAgdG9rZW4udHJhbnNmZXIobXNnLnNlbmRlciwgc2VsbGluZ0Zyb21KYWNrcG90KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc2VsbGluZ0Zyb21Dcm91cGllciA+IDApIHsKICAgICAgICAgICAgICAgIHRva2VuLnRyYW5zZmVyRnJvbUNyb3VwaWVyKG1zZy5zZW5kZXIsIHNlbGxpbmdGcm9tQ3JvdXBpZXIpOwogICAgICAgICAgICB9CgogICAgICAgIH0gZWxzZSBpZiAoc3RhZ2UgPT0gU3RhZ2VzLkdhbWVPdmVyKSB7CgogICAgICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gd2lubmVyIHx8IG1zZy5zZW5kZXIgPT0gaG91c2UpOwoKICAgICAgICAgICAgaWYgKG1zZy5zZW5kZXIgPT0gd2lubmVyKSB7CiAgICAgICAgICAgICAgICByZXF1aXJlKHBlbmRpbmdKYWNrcG90Rm9yV2lubmVyID4gMCk7CgogICAgICAgICAgICAgICAgdWludDI1NiB3aW5uZXJzUGF5ID0gcGVuZGluZ0phY2twb3RGb3JXaW5uZXI7CiAgICAgICAgICAgICAgICBwZW5kaW5nSmFja3BvdEZvcldpbm5lciA9IDA7CgogICAgICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2Zlcih3aW5uZXJzUGF5KTsKICAgICAgICAgICAgfSBlbHNlIGlmIChtc2cuc2VuZGVyID09IGhvdXNlKSB7CiAgICAgICAgICAgICAgICByZXF1aXJlKHBlbmRpbmdKYWNrcG90Rm9ySG91c2UgPiAwKTsKCiAgICAgICAgICAgICAgICB1aW50MjU2IGhvdXNlUGF5ID0gcGVuZGluZ0phY2twb3RGb3JIb3VzZTsKICAgICAgICAgICAgICAgIHBlbmRpbmdKYWNrcG90Rm9ySG91c2UgPSAwOwoKICAgICAgICAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoaG91c2VQYXkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8vIENyb3VwaWVyIHdpbGwgY2FsbCB0aGlzIGZ1bmN0aW9uIHdoZW4gdGhlIGphY2twb3QgaXMgd29uCiAgICAvLyBJZiBDcm91cGllciBmYWlscyB0byBjYWxsIHRoZSBmdW5jdGlvbiBmb3IgYW55IHJlYXNvbiwgaG91c2UgYW5kIHdpbm5lcgogICAgLy8gc3RpbGwgY2FuIGNsYWltIHRoZWlyIGphY2twb3QgcG9ydGlvbiBieSBzZW5kaW5nIGV0aGVyIHRvIEphY2twb3QKICAgIGZ1bmN0aW9uIHBheU91dEphY2twb3QoKSBvbmx5Q3JvdXBpZXIgcHVibGljIHsKICAgICAgICByZXF1aXJlKHdpbm5lciAhPSAweDApOwogICAgCiAgICAgICAgaWYgKHBlbmRpbmdKYWNrcG90Rm9ySG91c2UgPiAwKSB7CiAgICAgICAgICAgIHVpbnQyNTYgaG91c2VQYXkgPSBwZW5kaW5nSmFja3BvdEZvckhvdXNlOwogICAgICAgICAgICBwZW5kaW5nSmFja3BvdEZvckhvdXNlID0gMDsKCiAgICAgICAgICAgIGhvdXNlLnRyYW5zZmVyKGhvdXNlUGF5KTsKICAgICAgICB9CgogICAgICAgIGlmIChwZW5kaW5nSmFja3BvdEZvcldpbm5lciA+IDApIHsKICAgICAgICAgICAgdWludDI1NiB3aW5uZXJzUGF5ID0gcGVuZGluZ0phY2twb3RGb3JXaW5uZXI7CiAgICAgICAgICAgIHBlbmRpbmdKYWNrcG90Rm9yV2lubmVyID0gMDsKCiAgICAgICAgICAgIHdpbm5lci50cmFuc2Zlcih3aW5uZXJzUGF5KTsKICAgICAgICB9CgogICAgfQoKICAgIC8vLy8vLwogICAgLy8vIEB0aXRsZSBQdWJsaWMgRnVuY3Rpb25zCiAgICAvLwoKICAgIC8vLyBAZGV2IFZpZXcgZnVuY3Rpb24gdG8gY2hlY2sgd2hldGhlciB0aGUgZ2FtZSBzaG91bGQgYmUgdGVybWluYXRlZAogICAgLy8vICAgICAgVXNlZCBhcyBpbnRlcm5hbCBmdW5jdGlvbiBieSBjaGVja1Rlcm1pbmF0aW9uLCBhcyB3ZWxsIGFzIGJ5IHRoZQogICAgLy8vICAgICAgQ3JvdXBpZXIgYm90LCB0byBjaGVjayB3aGV0aGVyIGl0IHNob3VsZCBjYWxsIGNoZWNrVGVybWluYXRpb24KICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIGdhbWUgc2hvdWxkIGJlIHRlcm1pbmF0ZWQgYnkgdGltZW91dAogICAgZnVuY3Rpb24gc2hvdWxkQmVUZXJtaW5hdGVkKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCBzaG91bGQpIHsKICAgICAgICByZXR1cm4gc3RhZ2UgPT0gU3RhZ2VzLkdhbWVPbiAmJiB0ZXJtaW5hdGlvblRpbWUgIT0gMCAmJiBub3cgPiB0ZXJtaW5hdGlvblRpbWU7CiAgICB9CgogICAgLy8vIEBkZXYgQ2hlY2sgd2hldGhlciB0aGUgZ2FtZSBzaG91bGQgYmUgdGVybWluYXRlZCwgYW5kIGlmIGl0IHNob3VsZCwgdGVybWluYXRlIGl0CiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSBnYW1lIHdhcyB0ZXJtaW5hdGVkIGFzIHRoZSByZXN1bHQKICAgIGZ1bmN0aW9uIGNoZWNrVGVybWluYXRpb24oKSBwdWJsaWMgcmV0dXJucyAoYm9vbCB0ZXJtaW5hdGVkKSB7CiAgICAgICAgaWYgKHNob3VsZEJlVGVybWluYXRlZCgpKSB7CiAgICAgICAgICAgIHN0YWdlID0gU3RhZ2VzLkdhbWVPdmVyOwoKICAgICAgICAgICAgd2lubmVyID0gbGFzdEJldFVzZXI7CgogICAgICAgICAgICAvLyBGbHVzaCBhbW91bnQgZHVlIGZvciBDcm91cGllciBpbW1lZGlhdGVseQogICAgICAgICAgICBfZmx1c2hFdGhlclRvQ3JvdXBpZXIoKTsKCiAgICAgICAgICAgIC8vIFRoZSByZXN0IHNob3VsZCBiZSBjbGFpbWVkIGJ5IHRoZSB3aW5uZXIgKGV4Y2VwdCB3aGF0IGhvdXNlIGdldHMpCiAgICAgICAgICAgIEphY2twb3RXb24od2lubmVyLCB0aGlzLmJhbGFuY2UpOwoKCiAgICAgICAgICAgIHVpbnQyNTYgamFja3BvdCA9IHRoaXMuYmFsYW5jZTsKICAgICAgICAgICAgcGVuZGluZ0phY2twb3RGb3JIb3VzZSA9IGphY2twb3QuZGl2KDUpOwogICAgICAgICAgICBwZW5kaW5nSmFja3BvdEZvcldpbm5lciA9IGphY2twb3Quc3ViKHBlbmRpbmdKYWNrcG90Rm9ySG91c2UpOwoKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLy8vIEBkZXYgVmlldyBmdW5jdGlvbiB0byBjaGVjayB3aGV0aGVyIHRoZSBnYW1lIHNob3VsZCBiZSBzdGFydGVkCiAgICAvLy8gICAgICBVc2VkIGFzIGludGVybmFsIGZ1bmN0aW9uIGJ5IGBjaGVja0dhbWVTdGFydGAsIGFzIHdlbGwgYXMgYnkgdGhlCiAgICAvLy8gICAgICBDcm91cGllciBib3QsIHRvIGNoZWNrIHdoZXRoZXIgaXQgc2hvdWxkIGNhbGwgYGNoZWNrR2FtZVN0YXJ0YAogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgZ2FtZSBzaG91bGQgYmUgc3RhcnRlZAogICAgZnVuY3Rpb24gc2hvdWxkQmVTdGFydGVkKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCBzaG91bGQpIHsKICAgICAgICByZXR1cm4gc3RhZ2UgPT0gU3RhZ2VzLkluaXRpYWxPZmZlciAmJiBpY29FbmRUaW1lICE9IDAgJiYgbm93ID4gaWNvRW5kVGltZTsKICAgIH0KCiAgICAvLy8gQGRldiBDaGVjayB3aGV0aGVyIHRoZSBnYW1lIHNob3VsZCBiZSBzdGFydGVkLCBhbmQgaWYgaXQgc2hvdWxkLCBzdGFydCBpdAogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgZ2FtZSB3YXMgc3RhcnRlZCBhcyB0aGUgcmVzdWx0CiAgICBmdW5jdGlvbiBjaGVja0dhbWVTdGFydCgpIHB1YmxpYyByZXR1cm5zIChib29sIHN0YXJ0ZWQpIHsKICAgICAgICBpZiAoc2hvdWxkQmVTdGFydGVkKCkpIHsKICAgICAgICAgICAgc3RhZ2UgPSBTdGFnZXMuR2FtZU9uOwoKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLy8vIEBkZXYgQmV0IDEgdG9rZW4gaW4gdGhlIGdhbWUKICAgIC8vLyAgICAgIFRoZSB0b2tlbiBoYXMgYWxyZWFkeSBiZWVuIGJ1cm5lZCBoYXZpbmcgcGFzc2VkIGFsbCBjaGVja3MsIHNvCiAgICAvLy8gICAgICBqdXN0IHByb2Nlc3MgdGhlIGJldCBvZiAxIHRva2VuCiAgICBmdW5jdGlvbiBiZXRUb2tlbihhZGRyZXNzIF91c2VyKSBvbmx5VG9rZW4gcHVibGljIHsKICAgICAgICAvLyBUb2tlbiBiZXRzIGNhbiBvbmx5IGJlIGFjY2VwdGVkIGluIHRoZSBnYW1lIHN0YWdlCiAgICAgICAgcmVxdWlyZShzdGFnZSA9PSBTdGFnZXMuR2FtZU9uKTsKCiAgICAgICAgYm9vbCB0ZXJtaW5hdGVkID0gY2hlY2tUZXJtaW5hdGlvbigpOwogICAgICAgIGlmICh0ZXJtaW5hdGVkKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIFRva2VuQmV0KF91c2VyKTsKICAgICAgICBsYXN0QmV0VXNlciA9IF91c2VyOwogICAgICAgIHRlcm1pbmF0aW9uVGltZSA9IG5vdyArIF90ZXJtaW5hdGlvbkR1cmF0aW9uKCk7CgogICAgICAgIC8vIENoZWNrIGZvciB3aW5uaW5nIG1pbm9yIHByaXplcwogICAgICAgIF9jaGVja01pbm9yUHJpemVzKF91c2VyLCAwKTsKICAgIH0KCiAgICAvLy8gQGRldiBBbGxvd3MgSG91c2UgdG8gdGVybWluYXRlIElDTyBhcyBhbiBlbWVyZ2VuY3kgbWVhc3VyZQogICAgZnVuY3Rpb24gYWJvcnQoKSBvbmx5SG91c2UgcHVibGljIHsKICAgICAgICByZXF1aXJlKHN0YWdlID09IFN0YWdlcy5Jbml0aWFsT2ZmZXIpOwoKICAgICAgICBzdGFnZSA9IFN0YWdlcy5BYm9ydGVkOwogICAgICAgIGFib3J0VGltZSA9IG5vdzsKICAgIH0KCiAgICAvLy8gQGRldiBJbiBjYXNlIHRoZSBJQ08gaXMgZW1lcmdlbmN5LXRlcm1pbmF0ZWQgYnkgSG91c2UsIGFsbG93cyBpbnZlc3RvcnMKICAgIC8vLyAgICAgIHRvIHB1bGwgYmFjayB0aGUgaW52ZXN0bWVudHMKICAgIGZ1bmN0aW9uIGNsYWltUmVmdW5kKCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKHN0YWdlID09IFN0YWdlcy5BYm9ydGVkKTsKICAgICAgICByZXF1aXJlKGludmVzdG1lbnRPZlttc2cuc2VuZGVyXSA+IDApOwoKICAgICAgICB1aW50MjU2IHBheW1lbnQgPSBpbnZlc3RtZW50T2ZbbXNnLnNlbmRlcl07CiAgICAgICAgaW52ZXN0bWVudE9mW21zZy5zZW5kZXJdID0gMDsKCiAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihwYXltZW50KTsKICAgIH0KCiAgICAvLy8gQGRldiBJbiBjYXNlIHRoZSBJQ08gd2FzIHRlcm1pbmF0ZWQsIGFsbG93cyBIb3VzZSB0byBraWxsIHRoZSBjb250cmFjdCBpbiAyIG1vbnRocwogICAgLy8vICAgICAgYWZ0ZXIgdGhlIHRlcm1pbmF0aW9uIGRhdGUKICAgIGZ1bmN0aW9uIGtpbGxBYm9ydGVkKCkgb25seUhvdXNlIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShzdGFnZSA9PSBTdGFnZXMuQWJvcnRlZCk7CiAgICAgICAgcmVxdWlyZShub3cgPiBhYm9ydFRpbWUgKyA2MCBkYXlzKTsKCiAgICAgICAgc2VsZmRlc3RydWN0KGhvdXNlKTsKICAgIH0KCgoKICAgIC8vLy8vLwogICAgLy8vIEB0aXRsZSBJbnRlcm5hbCBGdW5jdGlvbnMKICAgIC8vCgogICAgLy8vIEBkZXYgR2V0IGN1cnJlbnQgYmlkIHRpbWVyIGR1cmF0aW9uCiAgICAvLy8gQHJldHVybiBkdXJhdGlvbiBUaGUgZHVyYXRpb24KICAgIGZ1bmN0aW9uIF90ZXJtaW5hdGlvbkR1cmF0aW9uKCkgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2IGR1cmF0aW9uKSB7CiAgICAgICAgcmV0dXJuICg1ICsgMTkyMDAgLyAoMTAwICsgdG90YWxCZXRzKSkgKiAxIG1pbnV0ZXM7CiAgICB9CgogICAgLy8vIEBkZXYgVXBkYXRlcyB0aGUgY3VycmVudCBJQ08gcHJpY2UgYWNjb3JkaW5nIHRvIHRoZSBydWxlcwogICAgZnVuY3Rpb24gX3VwZGF0ZUljb1ByaWNlKCkgaW50ZXJuYWwgewogICAgICAgIHVpbnQyNTYgbmV3SWNvVG9rZW5QcmljZSA9IGN1cnJlbnRJY29Ub2tlblByaWNlOwoKICAgICAgICBpZiAoaWNvU29sZFRva2VucyA8IDEwMDAwKSB7CiAgICAgICAgICAgIG5ld0ljb1Rva2VuUHJpY2UgPSA0IGZpbm5leTsKICAgICAgICB9IGVsc2UgaWYgKGljb1NvbGRUb2tlbnMgPCAyMDAwMCkgewogICAgICAgICAgICBuZXdJY29Ub2tlblByaWNlID0gNSBmaW5uZXk7CiAgICAgICAgfSBlbHNlIGlmIChpY29Tb2xkVG9rZW5zIDwgMzAwMDApIHsKICAgICAgICAgICAgbmV3SWNvVG9rZW5QcmljZSA9IDUuMyBmaW5uZXk7CiAgICAgICAgfSBlbHNlIGlmIChpY29Tb2xkVG9rZW5zIDwgNDAwMDApIHsKICAgICAgICAgICAgbmV3SWNvVG9rZW5QcmljZSA9IDUuNyBmaW5uZXk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbmV3SWNvVG9rZW5QcmljZSA9IDYgZmlubmV5OwogICAgICAgIH0KCiAgICAgICAgaWYgKG5ld0ljb1Rva2VuUHJpY2UgIT0gY3VycmVudEljb1Rva2VuUHJpY2UpIHsKICAgICAgICAgICAgY3VycmVudEljb1Rva2VuUHJpY2UgPSBuZXdJY29Ub2tlblByaWNlOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQGRldiBVcGRhdGVzIHRoZSBjdXJyZW50IGJpZCBwcmljZSBhY2NvcmRpbmcgdG8gdGhlIHJ1bGVzCiAgICBmdW5jdGlvbiBfdXBkYXRlQmV0QW1vdW50KCkgaW50ZXJuYWwgewogICAgICAgIHVpbnQyNTYgbmV3QmV0QW1vdW50ID0gMTAgZmlubmV5ICsgKHRvdGFsQmV0cyAvIDEwMCkgKiA2IGZpbm5leTsKCiAgICAgICAgaWYgKG5ld0JldEFtb3VudCAhPSBjdXJyZW50QmV0QW1vdW50KSB7CiAgICAgICAgICAgIGN1cnJlbnRCZXRBbW91bnQgPSBuZXdCZXRBbW91bnQ7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IENhbGN1bGF0ZXMgaG93IG1hbnkgdG9rZW5zIGEgdXNlciBzaG91bGQgZ2V0IHdpdGggYSBnaXZlbiBFdGhlciBiaWQKICAgIC8vLyBAcGFyYW0gdmFsdWUgVGhlIGJpZCBhbW91bnQKICAgIC8vLyBAcmV0dXJuIHRva2VucyBUaGUgbnVtYmVyIG9mIHRva2VucwogICAgZnVuY3Rpb24gX2JldFRva2Vuc0ZvckV0aGVyKHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NiB0b2tlbnMpIHsKICAgICAgICAvLyBPbmUgYmV0IGFtb3VudCBpcyBmb3IgdGhlIGJldCBpdHNlbGYsIGZvciB0aGUgcmVzdCB3ZSB3aWxsIHNlbGwKICAgICAgICAvLyB0b2tlbnMKICAgICAgICB0b2tlbnMgPSAodmFsdWUgLyBjdXJyZW50QmV0QW1vdW50KSAtIDE7CgogICAgICAgIGlmICh0b2tlbnMgPj0gMTAwMCkgewogICAgICAgICAgICB0b2tlbnMgPSB0b2tlbnMgKyB0b2tlbnMgLyA0OyAvLyArMjUlCiAgICAgICAgfSBlbHNlIGlmICh0b2tlbnMgPj0gMzAwKSB7CiAgICAgICAgICAgIHRva2VucyA9IHRva2VucyArIHRva2VucyAvIDU7IC8vICsyMCUKICAgICAgICB9IGVsc2UgaWYgKHRva2VucyA+PSAxMDApIHsKICAgICAgICAgICAgdG9rZW5zID0gdG9rZW5zICsgdG9rZW5zIC8gNzsgLy8gfiArMTQuMyUKICAgICAgICB9IGVsc2UgaWYgKHRva2VucyA+PSA1MCkgewogICAgICAgICAgICB0b2tlbnMgPSB0b2tlbnMgKyB0b2tlbnMgLyAxMDsgLy8gKzEwJQogICAgICAgIH0gZWxzZSBpZiAodG9rZW5zID49IDIwKSB7CiAgICAgICAgICAgIHRva2VucyA9IHRva2VucyArIHRva2VucyAvIDIwOyAvLyArNSUKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgQ2FsY3VsYXRlcyBob3cgbWFueSB0b2tlbnMgYSB1c2VyIHNob3VsZCBnZXQgd2l0aCBhIGdpdmVuIElDTyB0cmFuc2ZlcgogICAgLy8vIEBwYXJhbSB2YWx1ZSBUaGUgdHJhbnNmZXIgYW1vdW50CiAgICAvLy8gQHJldHVybiB0b2tlbnMgVGhlIG51bWJlciBvZiB0b2tlbnMKICAgIGZ1bmN0aW9uIF9pY29Ub2tlbnNGb3JFdGhlcih1aW50MjU2IHZhbHVlKSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2IHRva2VucykgewogICAgICAgIC8vIEhvdyBtYW55IHRpbWVzIHRoZSBpbnB1dCBpcyBncmVhdGVyIHRoYW4gY3VycmVudCB0b2tlbiBwcmljZQogICAgICAgIHRva2VucyA9IHZhbHVlIC8gY3VycmVudEljb1Rva2VuUHJpY2U7CgogICAgICAgIGlmICh0b2tlbnMgPj0gMTAwMDApIHsKICAgICAgICAgICAgdG9rZW5zID0gdG9rZW5zICsgdG9rZW5zIC8gNDsgLy8gKzI1JQogICAgICAgIH0gZWxzZSBpZiAodG9rZW5zID49IDUwMDApIHsKICAgICAgICAgICAgdG9rZW5zID0gdG9rZW5zICsgdG9rZW5zIC8gNTsgLy8gKzIwJQogICAgICAgIH0gZWxzZSBpZiAodG9rZW5zID49IDEwMDApIHsKICAgICAgICAgICAgdG9rZW5zID0gdG9rZW5zICsgdG9rZW5zIC8gNzsgLy8gfiArMTQuMyUKICAgICAgICB9IGVsc2UgaWYgKHRva2VucyA+PSA1MDApIHsKICAgICAgICAgICAgdG9rZW5zID0gdG9rZW5zICsgdG9rZW5zIC8gMTA7IC8vICsxMCUKICAgICAgICB9IGVsc2UgaWYgKHRva2VucyA+PSAyMDApIHsKICAgICAgICAgICAgdG9rZW5zID0gdG9rZW5zICsgdG9rZW5zIC8gMjA7IC8vICs1JQogICAgICAgIH0KCiAgICAgICAgLy8gQ2hlY2tpbmcgaWYgSmFja3BvdCBoYXMgdGhlIHRva2VucyBpbiByZXNlcnZlCiAgICAgICAgaWYgKHRva2VucyA+IHRva2VuLmJhbGFuY2VPZih0aGlzKSkgewogICAgICAgICAgICB0b2tlbnMgPSB0b2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgICAgICAgfQoKICAgICAgICBpY29Tb2xkVG9rZW5zICs9ICh1aW50MzIpKHRva2Vucyk7CgogICAgICAgIF91cGRhdGVJY29QcmljZSgpOwogICAgfQoKICAgIC8vLyBAZGV2IEZsdXNoIHRoZSBjdXJyZW50bHkgcGVuZGluZyBFdGhlciB0byBDcm91cGllcgogICAgZnVuY3Rpb24gX2ZsdXNoRXRoZXJUb0Nyb3VwaWVyKCkgaW50ZXJuYWwgewogICAgICAgIGlmIChwZW5kaW5nRXRoZXJGb3JDcm91cGllciA+IDApIHsKICAgICAgICAgICAgdWludDI1NiB3aWxsVHJhbnNmZXIgPSBwZW5kaW5nRXRoZXJGb3JDcm91cGllcjsKICAgICAgICAgICAgcGVuZGluZ0V0aGVyRm9yQ3JvdXBpZXIgPSAwOwogICAgICAgICAgICAKICAgICAgICAgICAgY3JvdXBpZXIudHJhbnNmZXIod2lsbFRyYW5zZmVyKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgQ291bnQgdGhlIGJpZCB0b3dhcmRzIG1pbm9yIHByaXplIGZ1bmQsIGNoZWNrIGlmIHRoZSB1c2VyCiAgICAvLy8gICAgICB3aW5zIGEgbWlub3IgcHJpemUsIGFuZCBpZiB0aGV5IGRpZCwgdHJhbnNmZXIgdGhlIHByaXplIHRvIHRoZW0KICAgIC8vLyBAcGFyYW0gdXNlciBUaGUgdXNlciBpbiBxdWVzdGlvbgogICAgLy8vIEBwYXJhbSB2YWx1ZSBUaGUgYmlkIHZhbHVlCiAgICBmdW5jdGlvbiBfY2hlY2tNaW5vclByaXplcyhhZGRyZXNzIHVzZXIsIHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHsKICAgICAgICAvLyBGaXJzdCBhbmQgZm9yZW1vc3QsIGluY3JlbWVudCB0aGUgY291bnRlcnMgYW5kIGV0aGVyIGNvdW50ZXJzCiAgICAgICAgdG90YWxCZXRzICsrOwogICAgICAgIGlmICh2YWx1ZSA+IDApIHsKICAgICAgICAgICAgZXRoZXJTaW5jZTIwID0gZXRoZXJTaW5jZTIwLmFkZCh2YWx1ZSk7CiAgICAgICAgICAgIGV0aGVyU2luY2U1MCA9IGV0aGVyU2luY2U1MC5hZGQodmFsdWUpOwogICAgICAgICAgICBldGhlclNpbmNlMTAwID0gZXRoZXJTaW5jZTEwMC5hZGQodmFsdWUpOwogICAgICAgIH0KCiAgICAgICAgLy8gTm93IGFjdHVhbGx5IGNoZWNrIGlmIHRoZSBiZXRzIHdvbgoKICAgICAgICB1aW50MjU2IGV0aGVyUGF5b3V0OwoKICAgICAgICBpZiAoKHRvdGFsQmV0cyArIDMwKSAlIDEwMCA9PSAwKSB7CiAgICAgICAgICAgIC8vIFdvbiAxMDB0aAogICAgICAgICAgICBldGhlclBheW91dCA9IChldGhlclNpbmNlMTAwIC0gMSkgLyAxMDsKICAgICAgICAgICAgZXRoZXJTaW5jZTEwMCA9IDE7CgogICAgICAgICAgICBNaW5vclByaXplUGF5b3V0KHVzZXIsIGV0aGVyUGF5b3V0LCAzKTsKCiAgICAgICAgICAgIHVzZXIudHJhbnNmZXIoZXRoZXJQYXlvdXQpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoKHRvdGFsQmV0cyArIDUpICUgNTAgPT0gMCkgewogICAgICAgICAgICAvLyBXb24gMTAwdGgKICAgICAgICAgICAgZXRoZXJQYXlvdXQgPSAoZXRoZXJTaW5jZTUwIC0gMSkgLyAxMDsKICAgICAgICAgICAgZXRoZXJTaW5jZTUwID0gMTsKCiAgICAgICAgICAgIE1pbm9yUHJpemVQYXlvdXQodXNlciwgZXRoZXJQYXlvdXQsIDIpOwoKICAgICAgICAgICAgdXNlci50cmFuc2ZlcihldGhlclBheW91dCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmICh0b3RhbEJldHMgJSAyMCA9PSAwKSB7CiAgICAgICAgICAgIC8vIFdvbiAyMHRoCiAgICAgICAgICAgIGV0aGVyUGF5b3V0ID0gKGV0aGVyU2luY2UyMCAtIDEpIC8gMTA7CiAgICAgICAgICAgIGV0aGVyU2luY2UyMCA9IDE7CgogICAgICAgICAgICBfZmx1c2hFdGhlclRvQ3JvdXBpZXIoKTsKCiAgICAgICAgICAgIE1pbm9yUHJpemVQYXlvdXQodXNlciwgZXRoZXJQYXlvdXQsIDEpOwoKICAgICAgICAgICAgdXNlci50cmFuc2ZlcihldGhlclBheW91dCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHJldHVybjsKICAgIH0KCn0='.
	

]
