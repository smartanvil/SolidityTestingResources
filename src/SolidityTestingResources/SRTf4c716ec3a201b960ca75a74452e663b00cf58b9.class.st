Class {
	#name : #SRTf4c716ec3a201b960ca75a74452e663b00cf58b9,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTf4c716ec3a201b960ca75a74452e663b00cf58b9 >> base64 [
	^ 'Ly8gPE9SQUNMSVpFX0FQST4KLyoKQ29weXJpZ2h0IChjKSAyMDE1LTIwMTYgT3JhY2xpemUgU1JMCkNvcHlyaWdodCAoYykgMjAxNiBPcmFjbGl6ZSBMVEQKCgoKUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weQpvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbAppbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzCnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwKY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzCmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CgoKClRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluCmFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgoKCgpUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgpJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gIElOIE5PIEVWRU5UIFNIQUxMIFRIRQpBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSCkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sCk9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4KVEhFIFNPRlRXQVJFLgoqLwoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTY7Ly9wbGVhc2UgaW1wb3J0IG9yYWNsaXplQVBJX3ByZTAuNC5zb2wgd2hlbiBzb2xpZGl0eSA8IDAuNC4wCgpjb250cmFjdCBPcmFjbGl6ZUkgewogICAgYWRkcmVzcyBwdWJsaWMgY2JBZGRyZXNzOwogICAgZnVuY3Rpb24gcXVlcnkodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnKSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5X3dpdGhHYXNMaW1pdCh1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcsIHVpbnQgX2dhc2xpbWl0KSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5Mih1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcxLCBzdHJpbmcgX2FyZzIpIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOwogICAgZnVuY3Rpb24gcXVlcnkyX3dpdGhHYXNMaW1pdCh1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcxLCBzdHJpbmcgX2FyZzIsIHVpbnQgX2dhc2xpbWl0KSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5Tih1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgYnl0ZXMgX2FyZ04pIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOwogICAgZnVuY3Rpb24gcXVlcnlOX3dpdGhHYXNMaW1pdCh1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgYnl0ZXMgX2FyZ04sIHVpbnQgX2dhc2xpbWl0KSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIGdldFByaWNlKHN0cmluZyBfZGF0YXNvdXJjZSkgcmV0dXJucyAodWludCBfZHNwcmljZSk7CiAgICBmdW5jdGlvbiBnZXRQcmljZShzdHJpbmcgX2RhdGFzb3VyY2UsIHVpbnQgZ2FzbGltaXQpIHJldHVybnMgKHVpbnQgX2RzcHJpY2UpOwogICAgZnVuY3Rpb24gdXNlQ291cG9uKHN0cmluZyBfY291cG9uKTsKICAgIGZ1bmN0aW9uIHNldFByb29mVHlwZShieXRlIF9wcm9vZlR5cGUpOwogICAgZnVuY3Rpb24gc2V0Q29uZmlnKGJ5dGVzMzIgX2NvbmZpZyk7CiAgICBmdW5jdGlvbiBzZXRDdXN0b21HYXNQcmljZSh1aW50IF9nYXNQcmljZSk7CiAgICBmdW5jdGlvbiByYW5kb21EU19nZXRTZXNzaW9uUHViS2V5SGFzaCgpIHJldHVybnMoYnl0ZXMzMik7Cn0KY29udHJhY3QgT3JhY2xpemVBZGRyUmVzb2x2ZXJJIHsKICAgIGZ1bmN0aW9uIGdldEFkZHJlc3MoKSByZXR1cm5zIChhZGRyZXNzIF9hZGRyKTsKfQpjb250cmFjdCB1c2luZ09yYWNsaXplIHsKICAgIE9yYWNsaXplQWRkclJlc29sdmVySSBPQVI7CgogICAgT3JhY2xpemVJIG9yYWNsaXplOwogICAgbW9kaWZpZXIgb3JhY2xpemVBUEkgewogICAgICAgIGlmKChhZGRyZXNzKE9BUik9PTApfHwoZ2V0Q29kZVNpemUoYWRkcmVzcyhPQVIpKT09MCkpIG9yYWNsaXplX3NldE5ldHdvcmsoKTsKICAgICAgICBvcmFjbGl6ZSA9IE9yYWNsaXplSShPQVIuZ2V0QWRkcmVzcygpKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldE5ldHdvcmsoKSBpbnRlcm5hbCByZXR1cm5zKGJvb2wpewogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDFkM0IyNjM4YTdjQzlmMkNCM0QyOThBM0RBN2E5MEI2N0U1NTA2ZWQpPjApeyAvL21haW5uZXQKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4MWQzQjI2MzhhN2NDOWYyQ0IzRDI5OEEzREE3YTkwQjY3RTU1MDZlZCk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHhjMDNBMjYxNUQ1ZWZhZjVGNDlGNjBCN0JCNjU4M2VhZWMyMTJmZGYxKT4wKXsgLy9yb3BzdGVuIHRlc3RuZXQKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4YzAzQTI2MTVENWVmYWY1RjQ5RjYwQjdCQjY1ODNlYWVjMjEyZmRmMSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHhCN0EwN0JjRjJCYTJmMjcwM2IyNEMwNjkxYjUyNzg5OTlDNTlBQzdlKT4wKXsgLy9rb3ZhbiB0ZXN0bmV0CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweEI3QTA3QmNGMkJhMmYyNzAzYjI0QzA2OTFiNTI3ODk5OUM1OUFDN2UpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4MTQ2NTAwY2ZkMzVCMjJFNEEzOTJGZTBhRGMwNkRlMWExMzY4RWQ0OCk+MCl7IC8vcmlua2VieSB0ZXN0bmV0CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDE0NjUwMGNmZDM1QjIyRTRBMzkyRmUwYURjMDZEZTFhMTM2OEVkNDgpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4NmY0ODVDOEJGNmZjNDNlQTIxMkU5M0JCRjhjZTA0NkM3ZjFjYjQ3NSk+MCl7IC8vZXRoZXJldW0tYnJpZGdlCiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDZmNDg1QzhCRjZmYzQzZUEyMTJFOTNCQkY4Y2UwNDZDN2YxY2I0NzUpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4MjBlMTJBMUY4NTlCM0ZlYUU1RmIyQTBBMzJDMThGNWE2NTU1NWJCRik+MCl7IC8vZXRoZXIuY2FtcCBpZGUKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4MjBlMTJBMUY4NTlCM0ZlYUU1RmIyQTBBMzJDMThGNWE2NTU1NWJCRik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHg1MWVmYUY0YzhCM0M5QWZCRDVhQjlGNGJiQzgyNzg0QWI2ZWY4ZkFBKT4wKXsgLy9icm93c2VyLXNvbGlkaXR5CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDUxZWZhRjRjOEIzQzlBZkJENWFCOUY0YmJDODI3ODRBYjZlZjhmQUEpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIF9fY2FsbGJhY2soYnl0ZXMzMiBteWlkLCBzdHJpbmcgcmVzdWx0KSB7CiAgICAgICAgX19jYWxsYmFjayhteWlkLCByZXN1bHQsIG5ldyBieXRlcygwKSk7CiAgICB9CgogICAgZnVuY3Rpb24gX19jYWxsYmFjayhieXRlczMyIG15aWQsIHN0cmluZyByZXN1bHQsIGJ5dGVzIHByb29mKTsKCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9nZXRQcmljZShzdHJpbmcgZGF0YXNvdXJjZSkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAodWludCl7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX2dldFByaWNlKHN0cmluZyBkYXRhc291cmNlLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zICh1aW50KXsKICAgICAgICByZXR1cm4gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmcpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfY2JBZGRyZXNzKCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYWRkcmVzcyl7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLmNiQWRkcmVzcygpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0Q3VzdG9tR2FzUHJpY2UodWludCBnYXNQcmljZSkgb3JhY2xpemVBUEkgaW50ZXJuYWwgewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5zZXRDdXN0b21HYXNQcmljZShnYXNQcmljZSk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXRDb25maWcoYnl0ZXMzMiBjb25maWcpIG9yYWNsaXplQVBJIGludGVybmFsIHsKICAgICAgICByZXR1cm4gb3JhY2xpemUuc2V0Q29uZmlnKGNvbmZpZyk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0Q29kZVNpemUoYWRkcmVzcyBfYWRkcikgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyh1aW50IF9zaXplKSB7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBfc2l6ZSA6PSBleHRjb2Rlc2l6ZShfYWRkcikKICAgICAgICB9CiAgICB9CgogICAgLy8gcGFyc2VJbnQKICAgIGZ1bmN0aW9uIHBhcnNlSW50KHN0cmluZyBfYSkgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBwYXJzZUludChfYSwgMCk7CiAgICB9CgogICAgLy8gcGFyc2VJbnQocGFyc2VGbG9hdCoxMF5fYikKICAgIGZ1bmN0aW9uIHBhcnNlSW50KHN0cmluZyBfYSwgdWludCBfYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIGJ5dGVzIG1lbW9yeSBicmVzdWx0ID0gYnl0ZXMoX2EpOwogICAgICAgIHVpbnQgbWludCA9IDA7CiAgICAgICAgYm9vbCBkZWNpbWFscyA9IGZhbHNlOwogICAgICAgIGZvciAodWludCBpPTA7IGk8YnJlc3VsdC5sZW5ndGg7IGkrKyl7CiAgICAgICAgICAgIGlmICgoYnJlc3VsdFtpXSA+PSA0OCkmJihicmVzdWx0W2ldIDw9IDU3KSl7CiAgICAgICAgICAgICAgICBpZiAoZGVjaW1hbHMpewogICAgICAgICAgICAgICAgICAgaWYgKF9iID09IDApIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGVsc2UgX2ItLTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG1pbnQgKj0gMTA7CiAgICAgICAgICAgICAgICBtaW50ICs9IHVpbnQoYnJlc3VsdFtpXSkgLSA0ODsKICAgICAgICAgICAgfSBlbHNlIGlmIChicmVzdWx0W2ldID09IDQ2KSBkZWNpbWFscyA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChfYiA+IDApIG1pbnQgKj0gMTAqKl9iOwogICAgICAgIHJldHVybiBtaW50OwogICAgfQoKICAgIGZ1bmN0aW9uIHVpbnQyc3RyKHVpbnQgaSkgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKXsKICAgICAgICBpZiAoaSA9PSAwKSByZXR1cm4gIjAiOwogICAgICAgIHVpbnQgaiA9IGk7CiAgICAgICAgdWludCBsZW47CiAgICAgICAgd2hpbGUgKGogIT0gMCl7CiAgICAgICAgICAgIGxlbisrOwogICAgICAgICAgICBqIC89IDEwOwogICAgICAgIH0KICAgICAgICBieXRlcyBtZW1vcnkgYnN0ciA9IG5ldyBieXRlcyhsZW4pOwogICAgICAgIHVpbnQgayA9IGxlbiAtIDE7CiAgICAgICAgd2hpbGUgKGkgIT0gMCl7CiAgICAgICAgICAgIGJzdHJbay0tXSA9IGJ5dGUoNDggKyBpICUgMTApOwogICAgICAgICAgICBpIC89IDEwOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc3RyaW5nKGJzdHIpOwogICAgfQp9Ci8vIDwvT1JBQ0xJWkVfQVBJPgoKLyoKICogQHRpdGxlIFN0cmluZyAmIHNsaWNlIHV0aWxpdHkgbGlicmFyeSBmb3IgU29saWRpdHkgY29udHJhY3RzLgogKiBAYXV0aG9yIE5pY2sgSm9obnNvbiA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjZiMGExOTBhMDgwMzA1MDIwZjJiMDUwNDFmMGYwNDFmNDUwNTBlMWYiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+PgogKgogKiBAZGV2IEZ1bmN0aW9uYWxpdHkgaW4gdGhpcyBsaWJyYXJ5IGlzIGxhcmdlbHkgaW1wbGVtZW50ZWQgdXNpbmcgYW4KICogICAgICBhYnN0cmFjdGlvbiBjYWxsZWQgYSAnc2xpY2UnLiBBIHNsaWNlIHJlcHJlc2VudHMgYSBwYXJ0IG9mIGEgc3RyaW5nIC0KICogICAgICBhbnl0aGluZyBmcm9tIHRoZSBlbnRpcmUgc3RyaW5nIHRvIGEgc2luZ2xlIGNoYXJhY3Rlciwgb3IgZXZlbiBubwogKiAgICAgIGNoYXJhY3RlcnMgYXQgYWxsIChhIDAtbGVuZ3RoIHNsaWNlKS4gU2luY2UgYSBzbGljZSBvbmx5IGhhcyB0byBzcGVjaWZ5CiAqICAgICAgYW4gb2Zmc2V0IGFuZCBhIGxlbmd0aCwgY29weWluZyBhbmQgbWFuaXB1bGF0aW5nIHNsaWNlcyBpcyBhIGxvdCBsZXNzCiAqICAgICAgZXhwZW5zaXZlIHRoYW4gY29weWluZyBhbmQgbWFuaXB1bGF0aW5nIHRoZSBzdHJpbmdzIHRoZXkgcmVmZXJlbmNlLgogKgogKiAgICAgIFRvIGZ1cnRoZXIgcmVkdWNlIGdhcyBjb3N0cywgbW9zdCBmdW5jdGlvbnMgb24gc2xpY2UgdGhhdCBuZWVkIHRvIHJldHVybgogKiAgICAgIGEgc2xpY2UgbW9kaWZ5IHRoZSBvcmlnaW5hbCBvbmUgaW5zdGVhZCBvZiBhbGxvY2F0aW5nIGEgbmV3IG9uZTsgZm9yCiAqICAgICAgaW5zdGFuY2UsIGBzLnNwbGl0KCIuIilgIHdpbGwgcmV0dXJuIHRoZSB0ZXh0IHVwIHRvIHRoZSBmaXJzdCAnLicsCiAqICAgICAgbW9kaWZ5aW5nIHMgdG8gb25seSBjb250YWluIHRoZSByZW1haW5kZXIgb2YgdGhlIHN0cmluZyBhZnRlciB0aGUgJy4nLgogKiAgICAgIEluIHNpdHVhdGlvbnMgd2hlcmUgeW91IGRvIG5vdCB3YW50IHRvIG1vZGlmeSB0aGUgb3JpZ2luYWwgc2xpY2UsIHlvdQogKiAgICAgIGNhbiBtYWtlIGEgY29weSBmaXJzdCB3aXRoIGAuY29weSgpYCwgZm9yIGV4YW1wbGU6CiAqICAgICAgYHMuY29weSgpLnNwbGl0KCIuIilgLiBUcnkgYW5kIGF2b2lkIHVzaW5nIHRoaXMgaWRpb20gaW4gbG9vcHM7IHNpbmNlCiAqICAgICAgU29saWRpdHkgaGFzIG5vIG1lbW9yeSBtYW5hZ2VtZW50LCBpdCB3aWxsIHJlc3VsdCBpbiBhbGxvY2F0aW5nIG1hbnkKICogICAgICBzaG9ydC1saXZlZCBzbGljZXMgdGhhdCBhcmUgbGF0ZXIgZGlzY2FyZGVkLgogKgogKiAgICAgIEZ1bmN0aW9ucyB0aGF0IHJldHVybiB0d28gc2xpY2VzIGNvbWUgaW4gdHdvIHZlcnNpb25zOiBhIG5vbi1hbGxvY2F0aW5nCiAqICAgICAgdmVyc2lvbiB0aGF0IHRha2VzIHRoZSBzZWNvbmQgc2xpY2UgYXMgYW4gYXJndW1lbnQsIG1vZGlmeWluZyBpdCBpbgogKiAgICAgIHBsYWNlLCBhbmQgYW4gYWxsb2NhdGluZyB2ZXJzaW9uIHRoYXQgYWxsb2NhdGVzIGFuZCByZXR1cm5zIHRoZSBzZWNvbmQKICogICAgICBzbGljZTsgc2VlIGBuZXh0UnVuZWAgZm9yIGV4YW1wbGUuCiAqCiAqICAgICAgRnVuY3Rpb25zIHRoYXQgaGF2ZSB0byBjb3B5IHN0cmluZyBkYXRhIHdpbGwgcmV0dXJuIHN0cmluZ3MgcmF0aGVyIHRoYW4KICogICAgICBzbGljZXM7IHRoZXNlIGNhbiBiZSBjYXN0IGJhY2sgdG8gc2xpY2VzIGZvciBmdXJ0aGVyIHByb2Nlc3NpbmcgaWYKICogICAgICByZXF1aXJlZC4KICoKICogICAgICBGb3IgY29udmVuaWVuY2UsIHNvbWUgZnVuY3Rpb25zIGFyZSBwcm92aWRlZCB3aXRoIG5vbi1tb2RpZnlpbmcKICogICAgICB2YXJpYW50cyB0aGF0IGNyZWF0ZSBhIG5ldyBzbGljZSBhbmQgcmV0dXJuIGJvdGg7IGZvciBpbnN0YW5jZSwKICogICAgICBgcy5zcGxpdE5ldygnLicpYCBsZWF2ZXMgcyB1bm1vZGlmaWVkLCBhbmQgcmV0dXJucyB0d28gdmFsdWVzCiAqICAgICAgY29ycmVzcG9uZGluZyB0byB0aGUgbGVmdCBhbmQgcmlnaHQgcGFydHMgb2YgdGhlIHN0cmluZy4KICovCnByYWdtYSBzb2xpZGl0eSBeMC40LjE2OwoKbGlicmFyeSBzdHJpbmdzIHsKICAgIHN0cnVjdCBzbGljZSB7CiAgICAgICAgdWludCBfbGVuOwogICAgICAgIHVpbnQgX3B0cjsKICAgIH0KCiAgICBmdW5jdGlvbiBtZW1jcHkodWludCBkZXN0LCB1aW50IHNyYywgdWludCBsZW4pIHByaXZhdGUgewogICAgICAgIC8vIENvcHkgd29yZC1sZW5ndGggY2h1bmtzIHdoaWxlIHBvc3NpYmxlCiAgICAgICAgZm9yKDsgbGVuID49IDMyOyBsZW4gLT0gMzIpIHsKICAgICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgICAgbXN0b3JlKGRlc3QsIG1sb2FkKHNyYykpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGVzdCArPSAzMjsKICAgICAgICAgICAgc3JjICs9IDMyOwogICAgICAgIH0KCiAgICAgICAgLy8gQ29weSByZW1haW5pbmcgYnl0ZXMKICAgICAgICB1aW50IG1hc2sgPSAyNTYgKiogKDMyIC0gbGVuKSAtIDE7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBsZXQgc3JjcGFydCA6PSBhbmQobWxvYWQoc3JjKSwgbm90KG1hc2spKQogICAgICAgICAgICBsZXQgZGVzdHBhcnQgOj0gYW5kKG1sb2FkKGRlc3QpLCBtYXNrKQogICAgICAgICAgICBtc3RvcmUoZGVzdCwgb3IoZGVzdHBhcnQsIHNyY3BhcnQpKQogICAgICAgIH0KICAgIH0KCiAgICAvKgogICAgICogQGRldiBSZXR1cm5zIGEgc2xpY2UgY29udGFpbmluZyB0aGUgZW50aXJlIHN0cmluZy4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzdHJpbmcgdG8gbWFrZSBhIHNsaWNlIGZyb20uCiAgICAgKiBAcmV0dXJuIEEgbmV3bHkgYWxsb2NhdGVkIHNsaWNlIGNvbnRhaW5pbmcgdGhlIGVudGlyZSBzdHJpbmcuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRvU2xpY2Uoc3RyaW5nIHNlbGYpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7CiAgICAgICAgdWludCBwdHI7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBwdHIgOj0gYWRkKHNlbGYsIDB4MjApCiAgICAgICAgfQogICAgICAgIHJldHVybiBzbGljZShieXRlcyhzZWxmKS5sZW5ndGgsIHB0cik7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyB0aGUgbGVuZ3RoIG9mIGEgbnVsbC10ZXJtaW5hdGVkIGJ5dGVzMzIgc3RyaW5nLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHZhbHVlIHRvIGZpbmQgdGhlIGxlbmd0aCBvZi4KICAgICAqIEByZXR1cm4gVGhlIGxlbmd0aCBvZiB0aGUgc3RyaW5nLCBmcm9tIDAgdG8gMzIuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGxlbihieXRlczMyIHNlbGYpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICB1aW50IHJldDsKICAgICAgICBpZiAoc2VsZiA9PSAwKQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICBpZiAoc2VsZiAmIDB4ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmYgPT0gMCkgewogICAgICAgICAgICByZXQgKz0gMTY7CiAgICAgICAgICAgIHNlbGYgPSBieXRlczMyKHVpbnQoc2VsZikgLyAweDEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCk7CiAgICAgICAgfQogICAgICAgIGlmIChzZWxmICYgMHhmZmZmZmZmZmZmZmZmZmZmID09IDApIHsKICAgICAgICAgICAgcmV0ICs9IDg7CiAgICAgICAgICAgIHNlbGYgPSBieXRlczMyKHVpbnQoc2VsZikgLyAweDEwMDAwMDAwMDAwMDAwMDAwKTsKICAgICAgICB9CiAgICAgICAgaWYgKHNlbGYgJiAweGZmZmZmZmZmID09IDApIHsKICAgICAgICAgICAgcmV0ICs9IDQ7CiAgICAgICAgICAgIHNlbGYgPSBieXRlczMyKHVpbnQoc2VsZikgLyAweDEwMDAwMDAwMCk7CiAgICAgICAgfQogICAgICAgIGlmIChzZWxmICYgMHhmZmZmID09IDApIHsKICAgICAgICAgICAgcmV0ICs9IDI7CiAgICAgICAgICAgIHNlbGYgPSBieXRlczMyKHVpbnQoc2VsZikgLyAweDEwMDAwKTsKICAgICAgICB9CiAgICAgICAgaWYgKHNlbGYgJiAweGZmID09IDApIHsKICAgICAgICAgICAgcmV0ICs9IDE7CiAgICAgICAgfQogICAgICAgIHJldHVybiAzMiAtIHJldDsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBSZXR1cm5zIGEgc2xpY2UgY29udGFpbmluZyB0aGUgZW50aXJlIGJ5dGVzMzIsIGludGVycHJldGVkIGFzIGEKICAgICAqICAgICAgbnVsbC10ZXJtaW50YWVkIHV0Zi04IHN0cmluZy4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBieXRlczMyIHZhbHVlIHRvIGNvbnZlcnQgdG8gYSBzbGljZS4KICAgICAqIEByZXR1cm4gQSBuZXcgc2xpY2UgY29udGFpbmluZyB0aGUgdmFsdWUgb2YgdGhlIGlucHV0IGFyZ3VtZW50IHVwIHRvIHRoZQogICAgICogICAgICAgICBmaXJzdCBudWxsLgogICAgICovCiAgICBmdW5jdGlvbiB0b1NsaWNlQjMyKGJ5dGVzMzIgc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UgcmV0KSB7CiAgICAgICAgLy8gQWxsb2NhdGUgc3BhY2UgZm9yIGBzZWxmYCBpbiBtZW1vcnksIGNvcHkgaXQgdGhlcmUsIGFuZCBwb2ludCByZXQgYXQgaXQKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIGxldCBwdHIgOj0gbWxvYWQoMHg0MCkKICAgICAgICAgICAgbXN0b3JlKDB4NDAsIGFkZChwdHIsIDB4MjApKQogICAgICAgICAgICBtc3RvcmUocHRyLCBzZWxmKQogICAgICAgICAgICBtc3RvcmUoYWRkKHJldCwgMHgyMCksIHB0cikKICAgICAgICB9CiAgICAgICAgcmV0Ll9sZW4gPSBsZW4oc2VsZik7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyBhIG5ldyBzbGljZSBjb250YWluaW5nIHRoZSBzYW1lIGRhdGEgYXMgdGhlIGN1cnJlbnQgc2xpY2UuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gY29weS4KICAgICAqIEByZXR1cm4gQSBuZXcgc2xpY2UgY29udGFpbmluZyB0aGUgc2FtZSBkYXRhIGFzIGBzZWxmYC4KICAgICAqLwogICAgZnVuY3Rpb24gY29weShzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgewogICAgICAgIHJldHVybiBzbGljZShzZWxmLl9sZW4sIHNlbGYuX3B0cik7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgQ29waWVzIGEgc2xpY2UgdG8gYSBuZXcgc3RyaW5nLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIGNvcHkuCiAgICAgKiBAcmV0dXJuIEEgbmV3bHkgYWxsb2NhdGVkIHN0cmluZyBjb250YWluaW5nIHRoZSBzbGljZSdzIHRleHQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRvU3RyaW5nKHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIHZhciByZXQgPSBuZXcgc3RyaW5nKHNlbGYuX2xlbik7CiAgICAgICAgdWludCByZXRwdHI7CiAgICAgICAgYXNzZW1ibHkgeyByZXRwdHIgOj0gYWRkKHJldCwgMzIpIH0KCiAgICAgICAgbWVtY3B5KHJldHB0ciwgc2VsZi5fcHRyLCBzZWxmLl9sZW4pOwogICAgICAgIHJldHVybiByZXQ7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyB0aGUgbGVuZ3RoIGluIHJ1bmVzIG9mIHRoZSBzbGljZS4gTm90ZSB0aGF0IHRoaXMgb3BlcmF0aW9uCiAgICAgKiAgICAgIHRha2VzIHRpbWUgcHJvcG9ydGlvbmFsIHRvIHRoZSBsZW5ndGggb2YgdGhlIHNsaWNlOyBhdm9pZCB1c2luZyBpdAogICAgICogICAgICBpbiBsb29wcywgYW5kIGNhbGwgYHNsaWNlLmVtcHR5KClgIGlmIHlvdSBvbmx5IG5lZWQgdG8ga25vdyB3aGV0aGVyCiAgICAgKiAgICAgIHRoZSBzbGljZSBpcyBlbXB0eSBvciBub3QuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4KICAgICAqIEByZXR1cm4gVGhlIGxlbmd0aCBvZiB0aGUgc2xpY2UgaW4gcnVuZXMuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGxlbihzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgLy8gU3RhcnRpbmcgYXQgcHRyLTMxIG1lYW5zIHRoZSBMU0Igd2lsbCBiZSB0aGUgYnl0ZSB3ZSBjYXJlIGFib3V0CiAgICAgICAgdmFyIHB0ciA9IHNlbGYuX3B0ciAtIDMxOwogICAgICAgIHZhciBlbmQgPSBwdHIgKyBzZWxmLl9sZW47CiAgICAgICAgZm9yICh1aW50IGxlbiA9IDA7IHB0ciA8IGVuZDsgbGVuKyspIHsKICAgICAgICAgICAgdWludDggYjsKICAgICAgICAgICAgYXNzZW1ibHkgeyBiIDo9IGFuZChtbG9hZChwdHIpLCAweEZGKSB9CiAgICAgICAgICAgIGlmIChiIDwgMHg4MCkgewogICAgICAgICAgICAgICAgcHRyICs9IDE7CiAgICAgICAgICAgIH0gZWxzZSBpZihiIDwgMHhFMCkgewogICAgICAgICAgICAgICAgcHRyICs9IDI7CiAgICAgICAgICAgIH0gZWxzZSBpZihiIDwgMHhGMCkgewogICAgICAgICAgICAgICAgcHRyICs9IDM7CiAgICAgICAgICAgIH0gZWxzZSBpZihiIDwgMHhGOCkgewogICAgICAgICAgICAgICAgcHRyICs9IDQ7CiAgICAgICAgICAgIH0gZWxzZSBpZihiIDwgMHhGQykgewogICAgICAgICAgICAgICAgcHRyICs9IDU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBwdHIgKz0gNjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbGVuOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFJldHVybnMgdHJ1ZSBpZiB0aGUgc2xpY2UgaXMgZW1wdHkgKGhhcyBhIGxlbmd0aCBvZiAwKS4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBzbGljZSBpcyBlbXB0eSwgRmFsc2Ugb3RoZXJ3aXNlLgogICAgICovCiAgICBmdW5jdGlvbiBlbXB0eShzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHNlbGYuX2xlbiA9PSAwOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFJldHVybnMgYSBwb3NpdGl2ZSBudW1iZXIgaWYgYG90aGVyYCBjb21lcyBsZXhpY29ncmFwaGljYWxseSBhZnRlcgogICAgICogICAgICBgc2VsZmAsIGEgbmVnYXRpdmUgbnVtYmVyIGlmIGl0IGNvbWVzIGJlZm9yZSwgb3IgemVybyBpZiB0aGUKICAgICAqICAgICAgY29udGVudHMgb2YgdGhlIHR3byBzbGljZXMgYXJlIGVxdWFsLiBDb21wYXJpc29uIGlzIGRvbmUgcGVyLXJ1bmUsCiAgICAgKiAgICAgIG9uIHVuaWNvZGUgY29kZXBvaW50cy4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBmaXJzdCBzbGljZSB0byBjb21wYXJlLgogICAgICogQHBhcmFtIG90aGVyIFRoZSBzZWNvbmQgc2xpY2UgdG8gY29tcGFyZS4KICAgICAqIEByZXR1cm4gVGhlIHJlc3VsdCBvZiB0aGUgY29tcGFyaXNvbi4KICAgICAqLwogICAgZnVuY3Rpb24gY29tcGFyZShzbGljZSBzZWxmLCBzbGljZSBvdGhlcikgaW50ZXJuYWwgcmV0dXJucyAoaW50KSB7CiAgICAgICAgdWludCBzaG9ydGVzdCA9IHNlbGYuX2xlbjsKICAgICAgICBpZiAob3RoZXIuX2xlbiA8IHNlbGYuX2xlbikKICAgICAgICAgICAgc2hvcnRlc3QgPSBvdGhlci5fbGVuOwoKICAgICAgICB2YXIgc2VsZnB0ciA9IHNlbGYuX3B0cjsKICAgICAgICB2YXIgb3RoZXJwdHIgPSBvdGhlci5fcHRyOwogICAgICAgIGZvciAodWludCBpZHggPSAwOyBpZHggPCBzaG9ydGVzdDsgaWR4ICs9IDMyKSB7CiAgICAgICAgICAgIHVpbnQgYTsKICAgICAgICAgICAgdWludCBiOwogICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICBhIDo9IG1sb2FkKHNlbGZwdHIpCiAgICAgICAgICAgICAgICBiIDo9IG1sb2FkKG90aGVycHRyKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChhICE9IGIpIHsKICAgICAgICAgICAgICAgIC8vIE1hc2sgb3V0IGlycmVsZXZhbnQgYnl0ZXMgYW5kIGNoZWNrIGFnYWluCiAgICAgICAgICAgICAgICB1aW50IG1hc2sgPSB+KDIgKiogKDggKiAoMzIgLSBzaG9ydGVzdCArIGlkeCkpIC0gMSk7CiAgICAgICAgICAgICAgICB2YXIgZGlmZiA9IChhICYgbWFzaykgLSAoYiAmIG1hc2spOwogICAgICAgICAgICAgICAgaWYgKGRpZmYgIT0gMCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW50KGRpZmYpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNlbGZwdHIgKz0gMzI7CiAgICAgICAgICAgIG90aGVycHRyICs9IDMyOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaW50KHNlbGYuX2xlbikgLSBpbnQob3RoZXIuX2xlbik7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyB0cnVlIGlmIHRoZSB0d28gc2xpY2VzIGNvbnRhaW4gdGhlIHNhbWUgdGV4dC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBmaXJzdCBzbGljZSB0byBjb21wYXJlLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNlY29uZCBzbGljZSB0byBjb21wYXJlLgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBzbGljZXMgYXJlIGVxdWFsLCBmYWxzZSBvdGhlcndpc2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGVxdWFscyhzbGljZSBzZWxmLCBzbGljZSBvdGhlcikgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBjb21wYXJlKHNlbGYsIG90aGVyKSA9PSAwOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IEV4dHJhY3RzIHRoZSBmaXJzdCBydW5lIGluIHRoZSBzbGljZSBpbnRvIGBydW5lYCwgYWR2YW5jaW5nIHRoZQogICAgICogICAgICBzbGljZSB0byBwb2ludCB0byB0aGUgbmV4dCBydW5lIGFuZCByZXR1cm5pbmcgYHNlbGZgLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uCiAgICAgKiBAcGFyYW0gcnVuZSBUaGUgc2xpY2UgdGhhdCB3aWxsIGNvbnRhaW4gdGhlIGZpcnN0IHJ1bmUuCiAgICAgKiBAcmV0dXJuIGBydW5lYC4KICAgICAqLwogICAgZnVuY3Rpb24gbmV4dFJ1bmUoc2xpY2Ugc2VsZiwgc2xpY2UgcnVuZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsKICAgICAgICBydW5lLl9wdHIgPSBzZWxmLl9wdHI7CgogICAgICAgIGlmIChzZWxmLl9sZW4gPT0gMCkgewogICAgICAgICAgICBydW5lLl9sZW4gPSAwOwogICAgICAgICAgICByZXR1cm4gcnVuZTsKICAgICAgICB9CgogICAgICAgIHVpbnQgbGVuOwogICAgICAgIHVpbnQgYjsKICAgICAgICAvLyBMb2FkIHRoZSBmaXJzdCBieXRlIG9mIHRoZSBydW5lIGludG8gdGhlIExTQnMgb2YgYgogICAgICAgIGFzc2VtYmx5IHsgYiA6PSBhbmQobWxvYWQoc3ViKG1sb2FkKGFkZChzZWxmLCAzMikpLCAzMSkpLCAweEZGKSB9CiAgICAgICAgaWYgKGIgPCAweDgwKSB7CiAgICAgICAgICAgIGxlbiA9IDE7CiAgICAgICAgfSBlbHNlIGlmKGIgPCAweEUwKSB7CiAgICAgICAgICAgIGxlbiA9IDI7CiAgICAgICAgfSBlbHNlIGlmKGIgPCAweEYwKSB7CiAgICAgICAgICAgIGxlbiA9IDM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbGVuID0gNDsKICAgICAgICB9CgogICAgICAgIC8vIENoZWNrIGZvciB0cnVuY2F0ZWQgY29kZXBvaW50cwogICAgICAgIGlmIChsZW4gPiBzZWxmLl9sZW4pIHsKICAgICAgICAgICAgcnVuZS5fbGVuID0gc2VsZi5fbGVuOwogICAgICAgICAgICBzZWxmLl9wdHIgKz0gc2VsZi5fbGVuOwogICAgICAgICAgICBzZWxmLl9sZW4gPSAwOwogICAgICAgICAgICByZXR1cm4gcnVuZTsKICAgICAgICB9CgogICAgICAgIHNlbGYuX3B0ciArPSBsZW47CiAgICAgICAgc2VsZi5fbGVuIC09IGxlbjsKICAgICAgICBydW5lLl9sZW4gPSBsZW47CiAgICAgICAgcmV0dXJuIHJ1bmU7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyB0aGUgZmlyc3QgcnVuZSBpbiB0aGUgc2xpY2UsIGFkdmFuY2luZyB0aGUgc2xpY2UgdG8gcG9pbnQKICAgICAqICAgICAgdG8gdGhlIG5leHQgcnVuZS4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLgogICAgICogQHJldHVybiBBIHNsaWNlIGNvbnRhaW5pbmcgb25seSB0aGUgZmlyc3QgcnVuZSBmcm9tIGBzZWxmYC4KICAgICAqLwogICAgZnVuY3Rpb24gbmV4dFJ1bmUoc2xpY2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UgcmV0KSB7CiAgICAgICAgbmV4dFJ1bmUoc2VsZiwgcmV0KTsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgdGhlIGZpcnN0IGNvZGVwb2ludCBpbiB0aGUgc2xpY2UuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4KICAgICAqIEByZXR1cm4gVGhlIG51bWJlciBvZiB0aGUgZmlyc3QgY29kZXBvaW50IGluIHRoZSBzbGljZS4KICAgICAqLwogICAgZnVuY3Rpb24gb3JkKHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKHVpbnQgcmV0KSB7CiAgICAgICAgaWYgKHNlbGYuX2xlbiA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgdWludCB3b3JkOwogICAgICAgIHVpbnQgbGVuOwogICAgICAgIHVpbnQgZGl2ID0gMiAqKiAyNDg7CgogICAgICAgIC8vIExvYWQgdGhlIHJ1bmUgaW50byB0aGUgTVNCcyBvZiBiCiAgICAgICAgYXNzZW1ibHkgeyB3b3JkOj0gbWxvYWQobWxvYWQoYWRkKHNlbGYsIDMyKSkpIH0KICAgICAgICB2YXIgYiA9IHdvcmQgLyBkaXY7CiAgICAgICAgaWYgKGIgPCAweDgwKSB7CiAgICAgICAgICAgIHJldCA9IGI7CiAgICAgICAgICAgIGxlbiA9IDE7CiAgICAgICAgfSBlbHNlIGlmKGIgPCAweEUwKSB7CiAgICAgICAgICAgIHJldCA9IGIgJiAweDFGOwogICAgICAgICAgICBsZW4gPSAyOwogICAgICAgIH0gZWxzZSBpZihiIDwgMHhGMCkgewogICAgICAgICAgICByZXQgPSBiICYgMHgwRjsKICAgICAgICAgICAgbGVuID0gMzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXQgPSBiICYgMHgwNzsKICAgICAgICAgICAgbGVuID0gNDsKICAgICAgICB9CgogICAgICAgIC8vIENoZWNrIGZvciB0cnVuY2F0ZWQgY29kZXBvaW50cwogICAgICAgIGlmIChsZW4gPiBzZWxmLl9sZW4pIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICBmb3IgKHVpbnQgaSA9IDE7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICBkaXYgPSBkaXYgLyAyNTY7CiAgICAgICAgICAgIGIgPSAod29yZCAvIGRpdikgJiAweEZGOwogICAgICAgICAgICBpZiAoYiAmIDB4QzAgIT0gMHg4MCkgewogICAgICAgICAgICAgICAgLy8gSW52YWxpZCBVVEYtOCBzZXF1ZW5jZQogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0ID0gKHJldCAqIDY0KSB8IChiICYgMHgzRik7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmV0OwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFJldHVybnMgdGhlIGtlY2Nhay0yNTYgaGFzaCBvZiB0aGUgc2xpY2UuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gaGFzaC4KICAgICAqIEByZXR1cm4gVGhlIGhhc2ggb2YgdGhlIHNsaWNlLgogICAgICovCiAgICBmdW5jdGlvbiBrZWNjYWsoc2xpY2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiByZXQpIHsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHJldCA6PSBzaGEzKG1sb2FkKGFkZChzZWxmLCAzMikpLCBtbG9hZChzZWxmKSkKICAgICAgICB9CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyB0cnVlIGlmIGBzZWxmYCBzdGFydHMgd2l0aCBgbmVlZGxlYC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLgogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgc2xpY2UgdG8gc2VhcmNoIGZvci4KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgc2xpY2Ugc3RhcnRzIHdpdGggdGhlIHByb3ZpZGVkIHRleHQsIGZhbHNlIG90aGVyd2lzZS4KICAgICAqLwogICAgZnVuY3Rpb24gc3RhcnRzV2l0aChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBpZiAoc2VsZi5fbGVuIDwgbmVlZGxlLl9sZW4pIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgaWYgKHNlbGYuX3B0ciA9PSBuZWVkbGUuX3B0cikgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGJvb2wgZXF1YWw7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBsZXQgbGVuIDo9IG1sb2FkKG5lZWRsZSkKICAgICAgICAgICAgbGV0IHNlbGZwdHIgOj0gbWxvYWQoYWRkKHNlbGYsIDB4MjApKQogICAgICAgICAgICBsZXQgbmVlZGxlcHRyIDo9IG1sb2FkKGFkZChuZWVkbGUsIDB4MjApKQogICAgICAgICAgICBlcXVhbCA6PSBlcShzaGEzKHNlbGZwdHIsIGxlbiksIHNoYTMobmVlZGxlcHRyLCBsZW4pKQogICAgICAgIH0KICAgICAgICByZXR1cm4gZXF1YWw7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgSWYgYHNlbGZgIHN0YXJ0cyB3aXRoIGBuZWVkbGVgLCBgbmVlZGxlYCBpcyByZW1vdmVkIGZyb20gdGhlCiAgICAgKiAgICAgIGJlZ2lubmluZyBvZiBgc2VsZmAuIE90aGVyd2lzZSwgYHNlbGZgIGlzIHVubW9kaWZpZWQuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHNsaWNlIHRvIHNlYXJjaCBmb3IuCiAgICAgKiBAcmV0dXJuIGBzZWxmYAogICAgICovCiAgICBmdW5jdGlvbiBiZXlvbmQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgewogICAgICAgIGlmIChzZWxmLl9sZW4gPCBuZWVkbGUuX2xlbikgewogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICB9CgogICAgICAgIGJvb2wgZXF1YWwgPSB0cnVlOwogICAgICAgIGlmIChzZWxmLl9wdHIgIT0gbmVlZGxlLl9wdHIpIHsKICAgICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgICAgbGV0IGxlbiA6PSBtbG9hZChuZWVkbGUpCiAgICAgICAgICAgICAgICBsZXQgc2VsZnB0ciA6PSBtbG9hZChhZGQoc2VsZiwgMHgyMCkpCiAgICAgICAgICAgICAgICBsZXQgbmVlZGxlcHRyIDo9IG1sb2FkKGFkZChuZWVkbGUsIDB4MjApKQogICAgICAgICAgICAgICAgZXF1YWwgOj0gZXEoc2hhMyhzZWxmcHRyLCBsZW4pLCBzaGEzKG5lZWRsZXB0ciwgbGVuKSkKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGVxdWFsKSB7CiAgICAgICAgICAgIHNlbGYuX2xlbiAtPSBuZWVkbGUuX2xlbjsKICAgICAgICAgICAgc2VsZi5fcHRyICs9IG5lZWRsZS5fbGVuOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHNlbGY7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyB0cnVlIGlmIHRoZSBzbGljZSBlbmRzIHdpdGggYG5lZWRsZWAuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHNsaWNlIHRvIHNlYXJjaCBmb3IuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIHNsaWNlIHN0YXJ0cyB3aXRoIHRoZSBwcm92aWRlZCB0ZXh0LCBmYWxzZSBvdGhlcndpc2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGVuZHNXaXRoKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGlmIChzZWxmLl9sZW4gPCBuZWVkbGUuX2xlbikgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICB2YXIgc2VsZnB0ciA9IHNlbGYuX3B0ciArIHNlbGYuX2xlbiAtIG5lZWRsZS5fbGVuOwoKICAgICAgICBpZiAoc2VsZnB0ciA9PSBuZWVkbGUuX3B0cikgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGJvb2wgZXF1YWw7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBsZXQgbGVuIDo9IG1sb2FkKG5lZWRsZSkKICAgICAgICAgICAgbGV0IG5lZWRsZXB0ciA6PSBtbG9hZChhZGQobmVlZGxlLCAweDIwKSkKICAgICAgICAgICAgZXF1YWwgOj0gZXEoc2hhMyhzZWxmcHRyLCBsZW4pLCBzaGEzKG5lZWRsZXB0ciwgbGVuKSkKICAgICAgICB9CgogICAgICAgIHJldHVybiBlcXVhbDsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBJZiBgc2VsZmAgZW5kcyB3aXRoIGBuZWVkbGVgLCBgbmVlZGxlYCBpcyByZW1vdmVkIGZyb20gdGhlCiAgICAgKiAgICAgIGVuZCBvZiBgc2VsZmAuIE90aGVyd2lzZSwgYHNlbGZgIGlzIHVubW9kaWZpZWQuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHNsaWNlIHRvIHNlYXJjaCBmb3IuCiAgICAgKiBAcmV0dXJuIGBzZWxmYAogICAgICovCiAgICBmdW5jdGlvbiB1bnRpbChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7CiAgICAgICAgaWYgKHNlbGYuX2xlbiA8IG5lZWRsZS5fbGVuKSB7CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIH0KCiAgICAgICAgdmFyIHNlbGZwdHIgPSBzZWxmLl9wdHIgKyBzZWxmLl9sZW4gLSBuZWVkbGUuX2xlbjsKICAgICAgICBib29sIGVxdWFsID0gdHJ1ZTsKICAgICAgICBpZiAoc2VsZnB0ciAhPSBuZWVkbGUuX3B0cikgewogICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICBsZXQgbGVuIDo9IG1sb2FkKG5lZWRsZSkKICAgICAgICAgICAgICAgIGxldCBuZWVkbGVwdHIgOj0gbWxvYWQoYWRkKG5lZWRsZSwgMHgyMCkpCiAgICAgICAgICAgICAgICBlcXVhbCA6PSBlcShzaGEzKHNlbGZwdHIsIGxlbiksIHNoYTMobmVlZGxlcHRyLCBsZW4pKQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZXF1YWwpIHsKICAgICAgICAgICAgc2VsZi5fbGVuIC09IG5lZWRsZS5fbGVuOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHNlbGY7CiAgICB9CgogICAgLy8gUmV0dXJucyB0aGUgbWVtb3J5IGFkZHJlc3Mgb2YgdGhlIGZpcnN0IGJ5dGUgb2YgdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YKICAgIC8vIGBuZWVkbGVgIGluIGBzZWxmYCwgb3IgdGhlIGZpcnN0IGJ5dGUgYWZ0ZXIgYHNlbGZgIGlmIG5vdCBmb3VuZC4KICAgIGZ1bmN0aW9uIGZpbmRQdHIodWludCBzZWxmbGVuLCB1aW50IHNlbGZwdHIsIHVpbnQgbmVlZGxlbGVuLCB1aW50IG5lZWRsZXB0cikgcHJpdmF0ZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCBwdHI7CiAgICAgICAgdWludCBpZHg7CgogICAgICAgIGlmIChuZWVkbGVsZW4gPD0gc2VsZmxlbikgewogICAgICAgICAgICBpZiAobmVlZGxlbGVuIDw9IDMyKSB7CiAgICAgICAgICAgICAgICAvLyBPcHRpbWl6ZWQgYXNzZW1ibHkgZm9yIDY4IGdhcyBwZXIgYnl0ZSBvbiBzaG9ydCBzdHJpbmdzCiAgICAgICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICAgICAgbGV0IG1hc2sgOj0gbm90KHN1YihleHAoMiwgbXVsKDgsIHN1YigzMiwgbmVlZGxlbGVuKSkpLCAxKSkKICAgICAgICAgICAgICAgICAgICBsZXQgbmVlZGxlZGF0YSA6PSBhbmQobWxvYWQobmVlZGxlcHRyKSwgbWFzaykKICAgICAgICAgICAgICAgICAgICBsZXQgZW5kIDo9IGFkZChzZWxmcHRyLCBzdWIoc2VsZmxlbiwgbmVlZGxlbGVuKSkKICAgICAgICAgICAgICAgICAgICBwdHIgOj0gc2VsZnB0cgogICAgICAgICAgICAgICAgICAgIGxvb3A6CiAgICAgICAgICAgICAgICAgICAganVtcGkoZXhpdCwgZXEoYW5kKG1sb2FkKHB0ciksIG1hc2spLCBuZWVkbGVkYXRhKSkKICAgICAgICAgICAgICAgICAgICBwdHIgOj0gYWRkKHB0ciwgMSkKICAgICAgICAgICAgICAgICAgICBqdW1waShsb29wLCBsdChzdWIocHRyLCAxKSwgZW5kKSkKICAgICAgICAgICAgICAgICAgICBwdHIgOj0gYWRkKHNlbGZwdHIsIHNlbGZsZW4pCiAgICAgICAgICAgICAgICAgICAgZXhpdDoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBwdHI7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBGb3IgbG9uZyBuZWVkbGVzLCB1c2UgaGFzaGluZwogICAgICAgICAgICAgICAgYnl0ZXMzMiBoYXNoOwogICAgICAgICAgICAgICAgYXNzZW1ibHkgeyBoYXNoIDo9IHNoYTMobmVlZGxlcHRyLCBuZWVkbGVsZW4pIH0KICAgICAgICAgICAgICAgIHB0ciA9IHNlbGZwdHI7CiAgICAgICAgICAgICAgICBmb3IgKGlkeCA9IDA7IGlkeCA8PSBzZWxmbGVuIC0gbmVlZGxlbGVuOyBpZHgrKykgewogICAgICAgICAgICAgICAgICAgIGJ5dGVzMzIgdGVzdEhhc2g7CiAgICAgICAgICAgICAgICAgICAgYXNzZW1ibHkgeyB0ZXN0SGFzaCA6PSBzaGEzKHB0ciwgbmVlZGxlbGVuKSB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGhhc2ggPT0gdGVzdEhhc2gpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwdHI7CiAgICAgICAgICAgICAgICAgICAgcHRyICs9IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNlbGZwdHIgKyBzZWxmbGVuOwogICAgfQoKICAgIC8vIFJldHVybnMgdGhlIG1lbW9yeSBhZGRyZXNzIG9mIHRoZSBmaXJzdCBieXRlIGFmdGVyIHRoZSBsYXN0IG9jY3VycmVuY2Ugb2YKICAgIC8vIGBuZWVkbGVgIGluIGBzZWxmYCwgb3IgdGhlIGFkZHJlc3Mgb2YgYHNlbGZgIGlmIG5vdCBmb3VuZC4KICAgIGZ1bmN0aW9uIHJmaW5kUHRyKHVpbnQgc2VsZmxlbiwgdWludCBzZWxmcHRyLCB1aW50IG5lZWRsZWxlbiwgdWludCBuZWVkbGVwdHIpIHByaXZhdGUgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgcHRyOwoKICAgICAgICBpZiAobmVlZGxlbGVuIDw9IHNlbGZsZW4pIHsKICAgICAgICAgICAgaWYgKG5lZWRsZWxlbiA8PSAzMikgewogICAgICAgICAgICAgICAgLy8gT3B0aW1pemVkIGFzc2VtYmx5IGZvciA2OSBnYXMgcGVyIGJ5dGUgb24gc2hvcnQgc3RyaW5ncwogICAgICAgICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgICAgICAgIGxldCBtYXNrIDo9IG5vdChzdWIoZXhwKDIsIG11bCg4LCBzdWIoMzIsIG5lZWRsZWxlbikpKSwgMSkpCiAgICAgICAgICAgICAgICAgICAgbGV0IG5lZWRsZWRhdGEgOj0gYW5kKG1sb2FkKG5lZWRsZXB0ciksIG1hc2spCiAgICAgICAgICAgICAgICAgICAgcHRyIDo9IGFkZChzZWxmcHRyLCBzdWIoc2VsZmxlbiwgbmVlZGxlbGVuKSkKICAgICAgICAgICAgICAgICAgICBsb29wOgogICAgICAgICAgICAgICAgICAgIGp1bXBpKHJldCwgZXEoYW5kKG1sb2FkKHB0ciksIG1hc2spLCBuZWVkbGVkYXRhKSkKICAgICAgICAgICAgICAgICAgICBwdHIgOj0gc3ViKHB0ciwgMSkKICAgICAgICAgICAgICAgICAgICBqdW1waShsb29wLCBndChhZGQocHRyLCAxKSwgc2VsZnB0cikpCiAgICAgICAgICAgICAgICAgICAgcHRyIDo9IHNlbGZwdHIKICAgICAgICAgICAgICAgICAgICBqdW1wKGV4aXQpCiAgICAgICAgICAgICAgICAgICAgcmV0OgogICAgICAgICAgICAgICAgICAgIHB0ciA6PSBhZGQocHRyLCBuZWVkbGVsZW4pCiAgICAgICAgICAgICAgICAgICAgZXhpdDoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBwdHI7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBGb3IgbG9uZyBuZWVkbGVzLCB1c2UgaGFzaGluZwogICAgICAgICAgICAgICAgYnl0ZXMzMiBoYXNoOwogICAgICAgICAgICAgICAgYXNzZW1ibHkgeyBoYXNoIDo9IHNoYTMobmVlZGxlcHRyLCBuZWVkbGVsZW4pIH0KICAgICAgICAgICAgICAgIHB0ciA9IHNlbGZwdHIgKyAoc2VsZmxlbiAtIG5lZWRsZWxlbik7CiAgICAgICAgICAgICAgICB3aGlsZSAocHRyID49IHNlbGZwdHIpIHsKICAgICAgICAgICAgICAgICAgICBieXRlczMyIHRlc3RIYXNoOwogICAgICAgICAgICAgICAgICAgIGFzc2VtYmx5IHsgdGVzdEhhc2ggOj0gc2hhMyhwdHIsIG5lZWRsZWxlbikgfQogICAgICAgICAgICAgICAgICAgIGlmIChoYXNoID09IHRlc3RIYXNoKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHRyICsgbmVlZGxlbGVuOwogICAgICAgICAgICAgICAgICAgIHB0ciAtPSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBzZWxmcHRyOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IE1vZGlmaWVzIGBzZWxmYCB0byBjb250YWluIGV2ZXJ5dGhpbmcgZnJvbSB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZgogICAgICogICAgICBgbmVlZGxlYCB0byB0aGUgZW5kIG9mIHRoZSBzbGljZS4gYHNlbGZgIGlzIHNldCB0byB0aGUgZW1wdHkgc2xpY2UKICAgICAqICAgICAgaWYgYG5lZWRsZWAgaXMgbm90IGZvdW5kLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNlYXJjaCBhbmQgbW9kaWZ5LgogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yLgogICAgICogQHJldHVybiBgc2VsZmAuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGZpbmQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgewogICAgICAgIHVpbnQgcHRyID0gZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKTsKICAgICAgICBzZWxmLl9sZW4gLT0gcHRyIC0gc2VsZi5fcHRyOwogICAgICAgIHNlbGYuX3B0ciA9IHB0cjsKICAgICAgICByZXR1cm4gc2VsZjsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBNb2RpZmllcyBgc2VsZmAgdG8gY29udGFpbiB0aGUgcGFydCBvZiB0aGUgc3RyaW5nIGZyb20gdGhlIHN0YXJ0IG9mCiAgICAgKiAgICAgIGBzZWxmYCB0byB0aGUgZW5kIG9mIHRoZSBmaXJzdCBvY2N1cnJlbmNlIG9mIGBuZWVkbGVgLiBJZiBgbmVlZGxlYAogICAgICogICAgICBpcyBub3QgZm91bmQsIGBzZWxmYCBpcyBzZXQgdG8gdGhlIGVtcHR5IHNsaWNlLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNlYXJjaCBhbmQgbW9kaWZ5LgogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yLgogICAgICogQHJldHVybiBgc2VsZmAuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJmaW5kKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsKICAgICAgICB1aW50IHB0ciA9IHJmaW5kUHRyKHNlbGYuX2xlbiwgc2VsZi5fcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpOwogICAgICAgIHNlbGYuX2xlbiA9IHB0ciAtIHNlbGYuX3B0cjsKICAgICAgICByZXR1cm4gc2VsZjsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBTcGxpdHMgdGhlIHNsaWNlLCBzZXR0aW5nIGBzZWxmYCB0byBldmVyeXRoaW5nIGFmdGVyIHRoZSBmaXJzdAogICAgICogICAgICBvY2N1cnJlbmNlIG9mIGBuZWVkbGVgLCBhbmQgYHRva2VuYCB0byBldmVyeXRoaW5nIGJlZm9yZSBpdC4gSWYKICAgICAqICAgICAgYG5lZWRsZWAgZG9lcyBub3Qgb2NjdXIgaW4gYHNlbGZgLCBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZSwKICAgICAqICAgICAgYW5kIGB0b2tlbmAgaXMgc2V0IHRvIHRoZSBlbnRpcmV0eSBvZiBgc2VsZmAuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc3BsaXQuCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLgogICAgICogQHBhcmFtIHRva2VuIEFuIG91dHB1dCBwYXJhbWV0ZXIgdG8gd2hpY2ggdGhlIGZpcnN0IHRva2VuIGlzIHdyaXR0ZW4uCiAgICAgKiBAcmV0dXJuIGB0b2tlbmAuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNwbGl0KHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSwgc2xpY2UgdG9rZW4pIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7CiAgICAgICAgdWludCBwdHIgPSBmaW5kUHRyKHNlbGYuX2xlbiwgc2VsZi5fcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpOwogICAgICAgIHRva2VuLl9wdHIgPSBzZWxmLl9wdHI7CiAgICAgICAgdG9rZW4uX2xlbiA9IHB0ciAtIHNlbGYuX3B0cjsKICAgICAgICBpZiAocHRyID09IHNlbGYuX3B0ciArIHNlbGYuX2xlbikgewogICAgICAgICAgICAvLyBOb3QgZm91bmQKICAgICAgICAgICAgc2VsZi5fbGVuID0gMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzZWxmLl9sZW4gLT0gdG9rZW4uX2xlbiArIG5lZWRsZS5fbGVuOwogICAgICAgICAgICBzZWxmLl9wdHIgPSBwdHIgKyBuZWVkbGUuX2xlbjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRva2VuOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFNwbGl0cyB0aGUgc2xpY2UsIHNldHRpbmcgYHNlbGZgIHRvIGV2ZXJ5dGhpbmcgYWZ0ZXIgdGhlIGZpcnN0CiAgICAgKiAgICAgIG9jY3VycmVuY2Ugb2YgYG5lZWRsZWAsIGFuZCByZXR1cm5pbmcgZXZlcnl0aGluZyBiZWZvcmUgaXQuIElmCiAgICAgKiAgICAgIGBuZWVkbGVgIGRvZXMgbm90IG9jY3VyIGluIGBzZWxmYCwgYHNlbGZgIGlzIHNldCB0byB0aGUgZW1wdHkgc2xpY2UsCiAgICAgKiAgICAgIGFuZCB0aGUgZW50aXJldHkgb2YgYHNlbGZgIGlzIHJldHVybmVkLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNwbGl0LgogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yIGluIGBzZWxmYC4KICAgICAqIEByZXR1cm4gVGhlIHBhcnQgb2YgYHNlbGZgIHVwIHRvIHRoZSBmaXJzdCBvY2N1cnJlbmNlIG9mIGBkZWxpbWAuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNwbGl0KHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UgdG9rZW4pIHsKICAgICAgICBzcGxpdChzZWxmLCBuZWVkbGUsIHRva2VuKTsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBTcGxpdHMgdGhlIHNsaWNlLCBzZXR0aW5nIGBzZWxmYCB0byBldmVyeXRoaW5nIGJlZm9yZSB0aGUgbGFzdAogICAgICogICAgICBvY2N1cnJlbmNlIG9mIGBuZWVkbGVgLCBhbmQgYHRva2VuYCB0byBldmVyeXRoaW5nIGFmdGVyIGl0LiBJZgogICAgICogICAgICBgbmVlZGxlYCBkb2VzIG5vdCBvY2N1ciBpbiBgc2VsZmAsIGBzZWxmYCBpcyBzZXQgdG8gdGhlIGVtcHR5IHNsaWNlLAogICAgICogICAgICBhbmQgYHRva2VuYCBpcyBzZXQgdG8gdGhlIGVudGlyZXR5IG9mIGBzZWxmYC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzcGxpdC4KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuCiAgICAgKiBAcGFyYW0gdG9rZW4gQW4gb3V0cHV0IHBhcmFtZXRlciB0byB3aGljaCB0aGUgZmlyc3QgdG9rZW4gaXMgd3JpdHRlbi4KICAgICAqIEByZXR1cm4gYHRva2VuYC4KICAgICAqLwogICAgZnVuY3Rpb24gcnNwbGl0KHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSwgc2xpY2UgdG9rZW4pIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7CiAgICAgICAgdWludCBwdHIgPSByZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKTsKICAgICAgICB0b2tlbi5fcHRyID0gcHRyOwogICAgICAgIHRva2VuLl9sZW4gPSBzZWxmLl9sZW4gLSAocHRyIC0gc2VsZi5fcHRyKTsKICAgICAgICBpZiAocHRyID09IHNlbGYuX3B0cikgewogICAgICAgICAgICAvLyBOb3QgZm91bmQKICAgICAgICAgICAgc2VsZi5fbGVuID0gMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzZWxmLl9sZW4gLT0gdG9rZW4uX2xlbiArIG5lZWRsZS5fbGVuOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdG9rZW47CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgU3BsaXRzIHRoZSBzbGljZSwgc2V0dGluZyBgc2VsZmAgdG8gZXZlcnl0aGluZyBiZWZvcmUgdGhlIGxhc3QKICAgICAqICAgICAgb2NjdXJyZW5jZSBvZiBgbmVlZGxlYCwgYW5kIHJldHVybmluZyBldmVyeXRoaW5nIGFmdGVyIGl0LiBJZgogICAgICogICAgICBgbmVlZGxlYCBkb2VzIG5vdCBvY2N1ciBpbiBgc2VsZmAsIGBzZWxmYCBpcyBzZXQgdG8gdGhlIGVtcHR5IHNsaWNlLAogICAgICogICAgICBhbmQgdGhlIGVudGlyZXR5IG9mIGBzZWxmYCBpcyByZXR1cm5lZC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzcGxpdC4KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuCiAgICAgKiBAcmV0dXJuIFRoZSBwYXJ0IG9mIGBzZWxmYCBhZnRlciB0aGUgbGFzdCBvY2N1cnJlbmNlIG9mIGBkZWxpbWAuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJzcGxpdChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKHNsaWNlIHRva2VuKSB7CiAgICAgICAgcnNwbGl0KHNlbGYsIG5lZWRsZSwgdG9rZW4pOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IENvdW50cyB0aGUgbnVtYmVyIG9mIG5vbm92ZXJsYXBwaW5nIG9jY3VycmVuY2VzIG9mIGBuZWVkbGVgIGluIGBzZWxmYC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzZWFyY2guCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLgogICAgICogQHJldHVybiBUaGUgbnVtYmVyIG9mIG9jY3VycmVuY2VzIG9mIGBuZWVkbGVgIGZvdW5kIGluIGBzZWxmYC4KICAgICAqLwogICAgZnVuY3Rpb24gY291bnQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zICh1aW50IGNvdW50KSB7CiAgICAgICAgdWludCBwdHIgPSBmaW5kUHRyKHNlbGYuX2xlbiwgc2VsZi5fcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpICsgbmVlZGxlLl9sZW47CiAgICAgICAgd2hpbGUgKHB0ciA8PSBzZWxmLl9wdHIgKyBzZWxmLl9sZW4pIHsKICAgICAgICAgICAgY291bnQrKzsKICAgICAgICAgICAgcHRyID0gZmluZFB0cihzZWxmLl9sZW4gLSAocHRyIC0gc2VsZi5fcHRyKSwgcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpICsgbmVlZGxlLl9sZW47CiAgICAgICAgfQogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFJldHVybnMgVHJ1ZSBpZiBgc2VsZmAgY29udGFpbnMgYG5lZWRsZWAuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc2VhcmNoLgogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yIGluIGBzZWxmYC4KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiBgbmVlZGxlYCBpcyBmb3VuZCBpbiBgc2VsZmAsIGZhbHNlIG90aGVyd2lzZS4KICAgICAqLwogICAgZnVuY3Rpb24gY29udGFpbnMoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHJmaW5kUHRyKHNlbGYuX2xlbiwgc2VsZi5fcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpICE9IHNlbGYuX3B0cjsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBSZXR1cm5zIGEgbmV3bHkgYWxsb2NhdGVkIHN0cmluZyBjb250YWluaW5nIHRoZSBjb25jYXRlbmF0aW9uIG9mCiAgICAgKiAgICAgIGBzZWxmYCBhbmQgYG90aGVyYC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBmaXJzdCBzbGljZSB0byBjb25jYXRlbmF0ZS4KICAgICAqIEBwYXJhbSBvdGhlciBUaGUgc2Vjb25kIHNsaWNlIHRvIGNvbmNhdGVuYXRlLgogICAgICogQHJldHVybiBUaGUgY29uY2F0ZW5hdGlvbiBvZiB0aGUgdHdvIHN0cmluZ3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNvbmNhdChzbGljZSBzZWxmLCBzbGljZSBvdGhlcikgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgdmFyIHJldCA9IG5ldyBzdHJpbmcoc2VsZi5fbGVuICsgb3RoZXIuX2xlbik7CiAgICAgICAgdWludCByZXRwdHI7CiAgICAgICAgYXNzZW1ibHkgeyByZXRwdHIgOj0gYWRkKHJldCwgMzIpIH0KICAgICAgICBtZW1jcHkocmV0cHRyLCBzZWxmLl9wdHIsIHNlbGYuX2xlbik7CiAgICAgICAgbWVtY3B5KHJldHB0ciArIHNlbGYuX2xlbiwgb3RoZXIuX3B0ciwgb3RoZXIuX2xlbik7CiAgICAgICAgcmV0dXJuIHJldDsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBKb2lucyBhbiBhcnJheSBvZiBzbGljZXMsIHVzaW5nIGBzZWxmYCBhcyBhIGRlbGltaXRlciwgcmV0dXJuaW5nIGEKICAgICAqICAgICAgbmV3bHkgYWxsb2NhdGVkIHN0cmluZy4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBkZWxpbWl0ZXIgdG8gdXNlLgogICAgICogQHBhcmFtIHBhcnRzIEEgbGlzdCBvZiBzbGljZXMgdG8gam9pbi4KICAgICAqIEByZXR1cm4gQSBuZXdseSBhbGxvY2F0ZWQgc3RyaW5nIGNvbnRhaW5pbmcgYWxsIHRoZSBzbGljZXMgaW4gYHBhcnRzYCwKICAgICAqICAgICAgICAgam9pbmVkIHdpdGggYHNlbGZgLgogICAgICovCiAgICBmdW5jdGlvbiBqb2luKHNsaWNlIHNlbGYsIHNsaWNlW10gcGFydHMpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgcmV0dXJuICIiOwoKICAgICAgICB1aW50IGxlbiA9IHNlbGYuX2xlbiAqIChwYXJ0cy5sZW5ndGggLSAxKTsKICAgICAgICBmb3IodWludCBpID0gMDsgaSA8IHBhcnRzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBsZW4gKz0gcGFydHNbaV0uX2xlbjsKCiAgICAgICAgdmFyIHJldCA9IG5ldyBzdHJpbmcobGVuKTsKICAgICAgICB1aW50IHJldHB0cjsKICAgICAgICBhc3NlbWJseSB7IHJldHB0ciA6PSBhZGQocmV0LCAzMikgfQoKICAgICAgICBmb3IoaSA9IDA7IGkgPCBwYXJ0cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBtZW1jcHkocmV0cHRyLCBwYXJ0c1tpXS5fcHRyLCBwYXJ0c1tpXS5fbGVuKTsKICAgICAgICAgICAgcmV0cHRyICs9IHBhcnRzW2ldLl9sZW47CiAgICAgICAgICAgIGlmIChpIDwgcGFydHMubGVuZ3RoIC0gMSkgewogICAgICAgICAgICAgICAgbWVtY3B5KHJldHB0ciwgc2VsZi5fcHRyLCBzZWxmLl9sZW4pOwogICAgICAgICAgICAgICAgcmV0cHRyICs9IHNlbGYuX2xlbjsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJldDsKICAgIH0KfQoKLyoqCiAqIE9yYWNsaXplIHNlcnZpY2UgcHJveHkgaW50ZXJmYWNlLgogKi8KY29udHJhY3QgTGFzdFdpbGxPcmFjbGl6ZVByb3h5SSB7CiAgICAvKioKICAgICAqIEdldCByZXF1cmVkIGFtb3VudCBvZiBtb25leSBmb3IgdGhlIG5leHQgcXVlcnkgY2FsbC4KICAgICAqIEByZXR1cm4gd2VpCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldFByaWNlKCkgcHVibGljIHJldHVybnMgKHVpbnQpOwoKICAgIC8qKgogICAgICogRG8gY2hlY2sgcXVlcnkuCiAgICAgKiBAcGFyYW0gdGFyZ2V0IFVzZXIgYWRkcmVzcyB0byBjaGVjay4KICAgICAqIEBwYXJhbSBzdGFydEJsb2NrIFN0YXJ0cyBjaGVjayBmb3IgdGhpcyBibG9jay4KICAgICAqIEBwYXJhbSBlbmRCbG9jayBMYXRlc3QgYmxvY2suCiAgICAgKiBAcGFyYW0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gKGJvb2wgd2FzVHJhbnNhY3Rpb25zKSwKICAgICAqICAgICAgICAgICAgICAgICB3aGljaCB3aWxsIGJlIGNhbGxlZCBvbiBxdWVyeSByZXN1bHQuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgcXVlcnkgd2FzIHJlZ2lzdGVyZWQsIG90aGVyd2lzZSBmYWxzZS4KICAgICAqLwogICAgZnVuY3Rpb24gcXVlcnkoCiAgICAgICAgYWRkcmVzcyB0YXJnZXQsCiAgICAgICAgdWludCBzdGFydEJsb2NrLAogICAgICAgIHVpbnQgZW5kQmxvY2ssCiAgICAgICAgZnVuY3Rpb24gKGJvb2wpIGV4dGVybmFsIGNhbGxiYWNrCiAgICApIHB1YmxpYyBwYXlhYmxlIHJldHVybnMgKGJvb2wpOwp9Cgpjb250cmFjdCBMYXN0V2lsbE9yYWNsaXplUHJveHkgaXMgdXNpbmdPcmFjbGl6ZSwgTGFzdFdpbGxPcmFjbGl6ZVByb3h5SSB7CiAgICB1c2luZyBzdHJpbmdzIGZvciAqOwoKICAgIC8qKgogICAgICogT3JhY2xpemUgcXVlcnkgaWRzLgogICAgICovCiAgICBtYXBwaW5nKGJ5dGVzMzIgPT4gZnVuY3Rpb24gKGJvb2wpIGV4dGVybmFsKSBwcml2YXRlIHZhbGlkSWRzOwoKICAgIC8qKgogICAgICogVG8gaW5mb3JtIExhc3RXaWxsIHN5c3RlbSBhYm91dCBsYXRlc3Qgb3JhY2xpemUgcHJpY2UgaW4gd2VpLgogICAgICovCiAgICBldmVudCBQcmljZSh1aW50KTsKCiAgICBmdW5jdGlvbiBnZXRQcmljZSgpIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gb3JhY2xpemVfZ2V0UHJpY2UoIlVSTCIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHF1ZXJ5KAogICAgICAgIGFkZHJlc3MgdGFyZ2V0LAogICAgICAgIHVpbnQgc3RhcnRCbG9jaywKICAgICAgICB1aW50IGVuZEJsb2NrLAogICAgICAgIGZ1bmN0aW9uIChib29sKSBleHRlcm5hbCBjYWxsYmFjawogICAgKSBwdWJsaWMgcGF5YWJsZSByZXR1cm5zIChib29sKSB7CiAgICAgICAgc3RyaW5nIG1lbW9yeSB1cmwgPSBidWlsZFVybCh0YXJnZXQsIHN0YXJ0QmxvY2ssIGVuZEJsb2NrKTsKICAgICAgICBieXRlczMyIHF1ZXJ5SWQgPSBvcmFjbGl6ZV9xdWVyeSgiVVJMIiwgdXJsKTsKICAgICAgICBpZiAocXVlcnlJZCA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgdmFsaWRJZHNbcXVlcnlJZF0gPSBjYWxsYmFjazsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSByZXN1bHQgbG9vayBsaWtlICdbIjE0Njk2MjQ4NjciLCAiMTQ2OTYyNDU4NCIsLi4uJwogICAgICovCiAgICBmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgcXVlcnlJZCwgc3RyaW5nIHJlc3VsdCwgYnl0ZXMpIHsKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBvcmFjbGl6ZV9jYkFkZHJlc3MoKSkgcmV2ZXJ0KCk7CiAgICAgICAgZnVuY3Rpb24gKGJvb2wgd2FzVHJhbnNhY3Rpb25zKSBleHRlcm5hbCBjYWxsYmFjayA9IHZhbGlkSWRzW3F1ZXJ5SWRdOwogICAgICAgIGRlbGV0ZSB2YWxpZElkc1txdWVyeUlkXTsKICAgICAgICAvLyBlbXB0eSBzdHJpbmcgbWVhbnMgbm90IHRyYW5zYWN0aW9uIHRpbWVzdGFtcHMgKG5vIG91dHB1dCB0cmFuc2FjdGlvbikKICAgICAgICBjYWxsYmFjayhieXRlcyhyZXN1bHQpLmxlbmd0aCAhPSAwKTsKICAgIH0KCiAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKiogSW50ZXJuYWwgKioqKioqKioqKioqKioqKioqKioqKioqKiovCgogICAgLy8ganNvbihodHRwczovL2FwaS5ldGhlcnNjYW4uaW8vYXBpP21vZHVsZT1hY2NvdW50JmFjdGlvbj10eGxpc3QmYWRkcmVzcz0weGRkYmQyYjkzMmM3NjNiYTViMWI3YWUzYjM2MmVhYzNlOGQ0MDEyMWEmc3RhcnRibG9jaz0wJmVuZGJsb2NrPTk5OTk5OTk5JnBhZ2U9MCZvZmZzZXQ9MCZzb3J0PWRlc2MmYXBpa2V5PUZKMzlQMkRJVThJWDhVOU4yNzM1U1VLUVdHM0hQUEdQWDgpLnJlc3VsdFs/KEAuZnJvbT09JzxhZGRyZXNzPicpXS50aW1lU3RhbXAKICAgIGZ1bmN0aW9uIGJ1aWxkVXJsKGFkZHJlc3MgdGFyZ2V0LCB1aW50IHN0YXJ0QmxvY2ssIHVpbnQgZW5kQmxvY2spIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHN0cmluZykgewogICAgICAgIHN0cmluZ3Muc2xpY2UgbWVtb3J5IHN0ckFkZHJlc3MgPSB0b0hleCh0YXJnZXQpLnRvU2xpY2UoKTsKICAgICAgICB1aW50OCBpID0gMDsgLy8gY291bnQgb2YgdGhlIHN0cmluZ3MgYmVsb3cKICAgICAgICB2YXIgcGFydHMgPSBuZXcgc3RyaW5ncy5zbGljZVtdKDkpOwogICAgICAgIHBhcnRzW2krK10gPSAianNvbihodHRwczovL2FwaS5ldGhlcnNjYW4uaW8vYXBpP21vZHVsZT1hY2NvdW50JmFjdGlvbj10eGxpc3QmYWRkcmVzcz0weCIudG9TbGljZSgpOwogICAgICAgIHBhcnRzW2krK10gPSBzdHJBZGRyZXNzOwogICAgICAgIC8vICAgICAvLyAmcGFnZT0wJm9mZnNldD0wIC0gbWVhbnMgbm90IHBhZ2luYXRpb24sIGJ1dCBpdCBtaWdodCBiZSBhIHByb2JsZW0gaWYgdGhlcmUgd2lsbCBiZSBwYWdlIGxpbWl0CiAgICAgICAgcGFydHNbaSsrXSA9ICImc3RhcnRibG9jaz0iLnRvU2xpY2UoKTsKICAgICAgICBwYXJ0c1tpKytdID0gdWludDJzdHIoc3RhcnRCbG9jaykudG9TbGljZSgpOwogICAgICAgIHBhcnRzW2krK10gPSAiJmVuZGJsb2NrPSIudG9TbGljZSgpOwogICAgICAgIHBhcnRzW2krK10gPSB1aW50MnN0cihlbmRCbG9jaykudG9TbGljZSgpOwogICAgICAgIHBhcnRzW2krK10gPSAiJnNvcnQ9ZGVzYyZhcGlrZXk9RkozOVAyRElVOElYOFU5TjI3MzVTVUtRV0czSFBQR1BYOCkucmVzdWx0Wz8oQC5mcm9tPT0nMHgiLnRvU2xpY2UoKTsKICAgICAgICBwYXJ0c1tpKytdID0gc3RyQWRkcmVzczsKICAgICAgICBwYXJ0c1tpKytdID0gIicpXS50aW1lU3RhbXAiLnRvU2xpY2UoKTsKICAgICAgICByZXR1cm4gIiIudG9TbGljZSgpCiAgICAgICAgICAgICAgICAgLmpvaW4ocGFydHMpOwogICAgfQoKICAgIC8qKgogICAgICogVGhpcyBtZXRob2QgaXMgdXNlZnVsIHdoZW4gd2UgbmVlZCB0byBrbm93IGxhc3QgdHJhbnNhY3Rpb24gdHMKICAgICAqLwogICAgZnVuY3Rpb24gcGFyc2VKc29uQXJyYXlBbmRHZXRGaXJzdEVsZW1lbnRBc051bWJlcihzdHJpbmcganNvbikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHZhciBqc29uU2xpY2UgPSBqc29uLnRvU2xpY2UoKTsKICAgICAgICBzdHJpbmdzLnNsaWNlIG1lbW9yeSBmaXJzdFJlc3VsdDsKICAgICAgICBqc29uU2xpY2Uuc3BsaXQoIiwgIi50b1NsaWNlKCksIGZpcnN0UmVzdWx0KTsKICAgICAgICB2YXIgdHMgPSBmaXJzdFJlc3VsdC5iZXlvbmQoIltcIiIudG9TbGljZSgpKS50b1N0cmluZygpOwogICAgICAgIHJldHVybiBwYXJzZUludCh0cyk7CiAgICB9CgogICAgZnVuY3Rpb24gdG9IZXgoYWRkcmVzcyBhZHIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHN0cmluZykgewogICAgICAgIHZhciBzcyA9IG5ldyBieXRlcyg0MCk7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgNDA7IGkgKyspIHsKICAgICAgICAgICAgdWludCBjOwogICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICBjIDo9IGFuZChhZHIsIDB4ZikKICAgICAgICAgICAgICAgIGFkciA6PSBkaXYoYWRyLCAweDEwKQogICAgICAgICAgICAgICAgYyA6PSBhZGQoYWRkKGMsIDB4MzApLCBtdWwoMHgyNywgZ3QoYywgOSkpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNzWzM5LWldID0gYnl0ZShjKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN0cmluZyhzcyk7CiAgICB9Cn0='.
	

]
