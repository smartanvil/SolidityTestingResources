Class {
	#name : #SRTb5e5585d0057501c91c48094029a6f4fb10b5a01,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTb5e5585d0057501c91c48094029a6f4fb10b5a01 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTc7CgovLy8gQHRpdGxlIEVSQzIyM1JlY2VpdmluZ0NvbnRyYWN0IC0gU3RhbmRhcmQgY29udHJhY3QgaW1wbGVtZW50YXRpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBFUkMyMjMgdG9rZW5zLgpjb250cmFjdCBFUkMyMjNSZWNlaXZpbmdDb250cmFjdCB7CgogICAgLy8vIEBkZXYgRnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgd2hlbiBhIHVzZXIgb3IgYW5vdGhlciBjb250cmFjdCB3YW50cyB0byB0cmFuc2ZlciBmdW5kcy4KICAgIC8vLyBAcGFyYW0gX2Zyb20gVHJhbnNhY3Rpb24gaW5pdGlhdG9yLCBhbmFsb2d1ZSBvZiBtc2cuc2VuZGVyCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBOdW1iZXIgb2YgdG9rZW5zIHRvIHRyYW5zZmVyLgogICAgLy8vIEBwYXJhbSBfZGF0YSBEYXRhIGNvbnRhaW5pZyBhIGZ1bmN0aW9uIHNpZ25hdHVyZSBhbmQvb3IgcGFyYW1ldGVycwogICAgZnVuY3Rpb24gdG9rZW5GYWxsYmFjayhhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF92YWx1ZSwgYnl0ZXMgX2RhdGEpIHB1YmxpYzsKfQoKY29udHJhY3QgVG9rZW4gewogICAgLyoKICAgICAqIEltcGxlbWVudHMgRVJDIDIwIHN0YW5kYXJkLgogICAgICogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvYmxvYi9mOTA4NjRhM2QyYjJiNDVjNGRlY2Y5NWVmZDI2YjNmMGMyNzYwNTFhL0VJUFMvZWlwLTIwLXRva2VuLXN0YW5kYXJkLm1kCiAgICAgKiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICAgICAqCiAgICAgKiAgQWRkZWQgc3VwcG9ydCBmb3IgdGhlIEVSQyAyMjMgInRva2VuRmFsbGJhY2siIG1ldGhvZCBpbiBhICJ0cmFuc2ZlciIgZnVuY3Rpb24gd2l0aCBhIHBheWxvYWQuCiAgICAgKiAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIyMwogICAgICovCgogICAgLyoKICAgICAqIFRoaXMgaXMgYSBzbGlnaHQgY2hhbmdlIHRvIHRoZSBFUkMyMCBiYXNlIHN0YW5kYXJkLgogICAgICogZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHN1cHBseSk7CiAgICAgKiBpcyByZXBsYWNlZCB3aXRoOgogICAgICogdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgICAgKiBUaGlzIGF1dG9tYXRpY2FsbHkgY3JlYXRlcyBhIGdldHRlciBmdW5jdGlvbiBmb3IgdGhlIHRvdGFsU3VwcGx5LgogICAgICogVGhpcyBpcyBtb3ZlZCB0byB0aGUgYmFzZSBjb250cmFjdCBzaW5jZSBwdWJsaWMgZ2V0dGVyIGZ1bmN0aW9ucyBhcmUgbm90CiAgICAgKiBjdXJyZW50bHkgcmVjb2duaXNlZCBhcyBhbiBpbXBsZW1lbnRhdGlvbiBvZiB0aGUgbWF0Y2hpbmcgYWJzdHJhY3QKICAgICAqIGZ1bmN0aW9uIGJ5IHRoZSBjb21waWxlci4KICAgICAqLwogICAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CgogICAgLyoKICAgICAqIEVSQyAyMAogICAgICovCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZyk7CgogICAgLyoKICAgICAqIEVSQyAyMjMKICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlLCBieXRlcyBfZGF0YSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLyoKICAgICAqIEV2ZW50cwogICAgICovCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpOwoKICAgIC8vIFRoZXJlIGlzIG5vIEVSQzIyMyBjb21wYXRpYmxlIFRyYW5zZmVyIGV2ZW50LCB3aXRoIGBfZGF0YWAgaW5jbHVkZWQuCn0KCgovLy8gQHRpdGxlIFN0YW5kYXJkIHRva2VuIGNvbnRyYWN0IC0gU3RhbmRhcmQgdG9rZW4gaW1wbGVtZW50YXRpb24uCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgVG9rZW4gewoKICAgIC8qCiAgICAgKiBEYXRhIHN0cnVjdHVyZXMKICAgICAqLwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKCiAgICAvKgogICAgICogUHVibGljIGZ1bmN0aW9ucwogICAgICovCiAgICAvLy8gQG5vdGljZSBTZW5kIGBfdmFsdWVgIHRva2VucyB0byBgX3RvYCBmcm9tIGBtc2cuc2VuZGVyYC4KICAgIC8vLyBAZGV2IFRyYW5zZmVycyBzZW5kZXIncyB0b2tlbnMgdG8gYSBnaXZlbiBhZGRyZXNzLiBSZXR1cm5zIHN1Y2Nlc3MuCiAgICAvLy8gQHBhcmFtIF90byBBZGRyZXNzIG9mIHRva2VuIHJlY2VpdmVyLgogICAgLy8vIEBwYXJhbSBfdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byB0cmFuc2Zlci4KICAgIC8vLyBAcmV0dXJuIFJldHVybnMgc3VjY2VzcyBvZiBmdW5jdGlvbiBjYWxsLgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoX3RvICE9IDB4MCk7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgcmVxdWlyZShiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSBfdmFsdWUpOwogICAgICAgIHJlcXVpcmUoYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA+PSBiYWxhbmNlc1tfdG9dKTsKCiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gLT0gX3ZhbHVlOwogICAgICAgIGJhbGFuY2VzW190b10gKz0gX3ZhbHVlOwoKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFNlbmQgYF92YWx1ZWAgdG9rZW5zIHRvIGBfdG9gIGZyb20gYG1zZy5zZW5kZXJgIGFuZCB0cmlnZ2VyCiAgICAvLy8gdG9rZW5GYWxsYmFjayBpZiBzZW5kZXIgaXMgYSBjb250cmFjdC4KICAgIC8vLyBAZGV2IEZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHdoZW4gYSB1c2VyIG9yIGFub3RoZXIgY29udHJhY3Qgd2FudHMgdG8gdHJhbnNmZXIgZnVuZHMuCiAgICAvLy8gQHBhcmFtIF90byBBZGRyZXNzIG9mIHRva2VuIHJlY2VpdmVyLgogICAgLy8vIEBwYXJhbSBfdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byB0cmFuc2Zlci4KICAgIC8vLyBAcGFyYW0gX2RhdGEgRGF0YSB0byBiZSBzZW50IHRvIHRva2VuRmFsbGJhY2sKICAgIC8vLyBAcmV0dXJuIFJldHVybnMgc3VjY2VzcyBvZiBmdW5jdGlvbiBjYWxsLgogICAgZnVuY3Rpb24gdHJhbnNmZXIoCiAgICAgICAgYWRkcmVzcyBfdG8sCiAgICAgICAgdWludDI1NiBfdmFsdWUsCiAgICAgICAgYnl0ZXMgX2RhdGEpCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXF1aXJlKHRyYW5zZmVyKF90bywgX3ZhbHVlKSk7CgogICAgICAgIHVpbnQgY29kZUxlbmd0aDsKCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAvLyBSZXRyaWV2ZSB0aGUgc2l6ZSBvZiB0aGUgY29kZSBvbiB0YXJnZXQgYWRkcmVzcywgdGhpcyBuZWVkcyBhc3NlbWJseS4KICAgICAgICAgICAgY29kZUxlbmd0aCA6PSBleHRjb2Rlc2l6ZShfdG8pCiAgICAgICAgfQoKICAgICAgICBpZiAoY29kZUxlbmd0aCA+IDApIHsKICAgICAgICAgICAgRVJDMjIzUmVjZWl2aW5nQ29udHJhY3QgcmVjZWl2ZXIgPSBFUkMyMjNSZWNlaXZpbmdDb250cmFjdChfdG8pOwogICAgICAgICAgICByZWNlaXZlci50b2tlbkZhbGxiYWNrKG1zZy5zZW5kZXIsIF92YWx1ZSwgX2RhdGEpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBub3RpY2UgVHJhbnNmZXIgYF92YWx1ZWAgdG9rZW5zIGZyb20gYF9mcm9tYCB0byBgX3RvYCBpZiBgbXNnLnNlbmRlcmAgaXMgYWxsb3dlZC4KICAgIC8vLyBAZGV2IEFsbG93cyBmb3IgYW4gYXBwcm92ZWQgdGhpcmQgcGFydHkgdG8gdHJhbnNmZXIgdG9rZW5zIGZyb20gb25lCiAgICAvLy8gYWRkcmVzcyB0byBhbm90aGVyLiBSZXR1cm5zIHN1Y2Nlc3MuCiAgICAvLy8gQHBhcmFtIF9mcm9tIEFkZHJlc3MgZnJvbSB3aGVyZSB0b2tlbnMgYXJlIHdpdGhkcmF3bi4KICAgIC8vLyBAcGFyYW0gX3RvIEFkZHJlc3MgdG8gd2hlcmUgdG9rZW5zIGFyZSBzZW50LgogICAgLy8vIEBwYXJhbSBfdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byB0cmFuc2Zlci4KICAgIC8vLyBAcmV0dXJuIFJldHVybnMgc3VjY2VzcyBvZiBmdW5jdGlvbiBjYWxsLgogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkKICAgICAgICBwdWJsaWMKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJlcXVpcmUoX2Zyb20gIT0gMHgwKTsKICAgICAgICByZXF1aXJlKF90byAhPSAweDApOwogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3ModGhpcykpOwogICAgICAgIHJlcXVpcmUoYmFsYW5jZXNbX2Zyb21dID49IF92YWx1ZSk7CiAgICAgICAgcmVxdWlyZShhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA+PSBfdmFsdWUpOwogICAgICAgIHJlcXVpcmUoYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA+PSBiYWxhbmNlc1tfdG9dKTsKCiAgICAgICAgYmFsYW5jZXNbX3RvXSArPSBfdmFsdWU7CiAgICAgICAgYmFsYW5jZXNbX2Zyb21dIC09IF92YWx1ZTsKICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSAtPSBfdmFsdWU7CgogICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEFsbG93cyBgX3NwZW5kZXJgIHRvIHRyYW5zZmVyIGBfdmFsdWVgIHRva2VucyBmcm9tIGBtc2cuc2VuZGVyYCB0byBhbnkgYWRkcmVzcy4KICAgIC8vLyBAZGV2IFNldHMgYXBwcm92ZWQgYW1vdW50IG9mIHRva2VucyBmb3Igc3BlbmRlci4gUmV0dXJucyBzdWNjZXNzLgogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBBZGRyZXNzIG9mIGFsbG93ZWQgYWNjb3VudC4KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIE51bWJlciBvZiBhcHByb3ZlZCB0b2tlbnMuCiAgICAvLy8gQHJldHVybiBSZXR1cm5zIHN1Y2Nlc3Mgb2YgZnVuY3Rpb24gY2FsbC4KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfc3BlbmRlciAhPSAweDApOwoKICAgICAgICAvLyBUbyBjaGFuZ2UgdGhlIGFwcHJvdmUgYW1vdW50IHlvdSBmaXJzdCBoYXZlIHRvIHJlZHVjZSB0aGUgYWRkcmVzc2VzYAogICAgICAgIC8vIGFsbG93YW5jZSB0byB6ZXJvIGJ5IGNhbGxpbmcgYGFwcHJvdmUoX3NwZW5kZXIsIDApYCBpZiBpdCBpcyBub3QKICAgICAgICAvLyBhbHJlYWR5IDAgdG8gbWl0aWdhdGUgdGhlIHJhY2UgY29uZGl0aW9uIGRlc2NyaWJlZCBoZXJlOgogICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICAgICAgcmVxdWlyZShfdmFsdWUgPT0gMCB8fCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9PSAwKTsKCiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoKICAgICAqIFJlYWQgZnVuY3Rpb25zCiAgICAgKi8KICAgIC8vLyBAZGV2IFJldHVybnMgbnVtYmVyIG9mIGFsbG93ZWQgdG9rZW5zIHRoYXQgYSBzcGVuZGVyIGNhbiB0cmFuc2ZlciBvbgogICAgLy8vIGJlaGFsZiBvZiBhIHRva2VuIG93bmVyLgogICAgLy8vIEBwYXJhbSBfb3duZXIgQWRkcmVzcyBvZiB0b2tlbiBvd25lci4KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgQWRkcmVzcyBvZiB0b2tlbiBzcGVuZGVyLgogICAgLy8vIEByZXR1cm4gUmV0dXJucyByZW1haW5pbmcgYWxsb3dhbmNlIGZvciBzcGVuZGVyLgogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKQogICAgICAgIGNvbnN0YW50CiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIG51bWJlciBvZiB0b2tlbnMgb3duZWQgYnkgdGhlIGdpdmVuIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIF9vd25lciBBZGRyZXNzIG9mIHRva2VuIG93bmVyLgogICAgLy8vIEByZXR1cm4gUmV0dXJucyBiYWxhbmNlIG9mIG93bmVyLgogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogICAgfQp9CgoKLy8vIEB0aXRsZSBSYWlkZW4gVG9rZW4KY29udHJhY3QgUmFpZGVuVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiB7CgogICAgLyoKICAgICAqICBUZXJtaW5vbG9neToKICAgICAqICAxIHRva2VuIHVuaXQgPSBSZWkKICAgICAqICAxIHRva2VuID0gUkROID0gUmVpICogbXVsdGlwbGllcgogICAgICogIG11bHRpcGxpZXIgc2V0IGZyb20gdG9rZW4ncyBudW1iZXIgb2YgZGVjaW1hbHMgKGkuZS4gMTAgKiogZGVjaW1hbHMpCiAgICAgKi8KCiAgICAvKgogICAgICogIFRva2VuIG1ldGFkYXRhCiAgICAgKi8KICAgIHN0cmluZyBjb25zdGFudCBwdWJsaWMgbmFtZSA9ICJSYWlkZW4gVG9rZW4iOwogICAgc3RyaW5nIGNvbnN0YW50IHB1YmxpYyBzeW1ib2wgPSAiUkROIjsKICAgIHVpbnQ4IGNvbnN0YW50IHB1YmxpYyBkZWNpbWFscyA9IDE4OwogICAgdWludCBjb25zdGFudCBtdWx0aXBsaWVyID0gMTAgKiogdWludChkZWNpbWFscyk7CgogICAgZXZlbnQgRGVwbG95ZWQodWludCBpbmRleGVkIF90b3RhbF9zdXBwbHkpOwogICAgZXZlbnQgQnVybnQoCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIF9yZWNlaXZlciwKICAgICAgICB1aW50IGluZGV4ZWQgX251bSwKICAgICAgICB1aW50IGluZGV4ZWQgX3RvdGFsX3N1cHBseQogICAgKTsKCiAgICAvKgogICAgICogIFB1YmxpYyBmdW5jdGlvbnMKICAgICAqLwogICAgLy8vIEBkZXYgQ29udHJhY3QgY29uc3RydWN0b3IgZnVuY3Rpb24gc2V0cyBkdXRjaCBhdWN0aW9uIGNvbnRyYWN0IGFkZHJlc3MKICAgIC8vLyBhbmQgYXNzaWducyBhbGwgdG9rZW5zIHRvIGR1dGNoIGF1Y3Rpb24uCiAgICAvLy8gQHBhcmFtIGF1Y3Rpb25fYWRkcmVzcyBBZGRyZXNzIG9mIGR1dGNoIGF1Y3Rpb24gY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIHdhbGxldF9hZGRyZXNzIEFkZHJlc3Mgb2Ygd2FsbGV0LgogICAgLy8vIEBwYXJhbSBpbml0aWFsX3N1cHBseSBOdW1iZXIgb2YgaW5pdGlhbGx5IHByb3ZpZGVkIHRva2VuIHVuaXRzIChSZWkpLgogICAgZnVuY3Rpb24gUmFpZGVuVG9rZW4oCiAgICAgICAgYWRkcmVzcyBhdWN0aW9uX2FkZHJlc3MsCiAgICAgICAgYWRkcmVzcyB3YWxsZXRfYWRkcmVzcywKICAgICAgICB1aW50IGluaXRpYWxfc3VwcGx5KQogICAgICAgIHB1YmxpYwogICAgewogICAgICAgIC8vIEF1Y3Rpb24gYWRkcmVzcyBzaG91bGQgbm90IGJlIG51bGwuCiAgICAgICAgcmVxdWlyZShhdWN0aW9uX2FkZHJlc3MgIT0gMHgwKTsKICAgICAgICByZXF1aXJlKHdhbGxldF9hZGRyZXNzICE9IDB4MCk7CgogICAgICAgIC8vIEluaXRpYWwgc3VwcGx5IGlzIGluIFJlaQogICAgICAgIHJlcXVpcmUoaW5pdGlhbF9zdXBwbHkgPiBtdWx0aXBsaWVyKTsKCiAgICAgICAgLy8gVG90YWwgc3VwcGx5IG9mIFJlaSBhdCBkZXBsb3ltZW50CiAgICAgICAgdG90YWxTdXBwbHkgPSBpbml0aWFsX3N1cHBseTsKCiAgICAgICAgYmFsYW5jZXNbYXVjdGlvbl9hZGRyZXNzXSA9IGluaXRpYWxfc3VwcGx5IC8gMjsKICAgICAgICBiYWxhbmNlc1t3YWxsZXRfYWRkcmVzc10gPSBpbml0aWFsX3N1cHBseSAvIDI7CgogICAgICAgIFRyYW5zZmVyKDB4MCwgYXVjdGlvbl9hZGRyZXNzLCBiYWxhbmNlc1thdWN0aW9uX2FkZHJlc3NdKTsKICAgICAgICBUcmFuc2ZlcigweDAsIHdhbGxldF9hZGRyZXNzLCBiYWxhbmNlc1t3YWxsZXRfYWRkcmVzc10pOwoKICAgICAgICBEZXBsb3llZCh0b3RhbFN1cHBseSk7CgogICAgICAgIGFzc2VydCh0b3RhbFN1cHBseSA9PSBiYWxhbmNlc1thdWN0aW9uX2FkZHJlc3NdICsgYmFsYW5jZXNbd2FsbGV0X2FkZHJlc3NdKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBBbGxvd3MgYG1zZy5zZW5kZXJgIHRvIHNpbXBseSBkZXN0cm95IGBudW1gIHRva2VuIHVuaXRzIChSZWkpLiBUaGlzIG1lYW5zIHRoZSB0b3RhbAogICAgLy8vIHRva2VuIHN1cHBseSB3aWxsIGRlY3JlYXNlLgogICAgLy8vIEBkZXYgQWxsb3dzIHRvIGRlc3Ryb3kgdG9rZW4gdW5pdHMgKFJlaSkuCiAgICAvLy8gQHBhcmFtIG51bSBOdW1iZXIgb2YgdG9rZW4gdW5pdHMgKFJlaSkgdG8gYnVybi4KICAgIGZ1bmN0aW9uIGJ1cm4odWludCBudW0pIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShudW0gPiAwKTsKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW21zZy5zZW5kZXJdID49IG51bSk7CiAgICAgICAgcmVxdWlyZSh0b3RhbFN1cHBseSA+PSBudW0pOwoKICAgICAgICB1aW50IHByZV9iYWxhbmNlID0gYmFsYW5jZXNbbXNnLnNlbmRlcl07CgogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdIC09IG51bTsKICAgICAgICB0b3RhbFN1cHBseSAtPSBudW07CiAgICAgICAgQnVybnQobXNnLnNlbmRlciwgbnVtLCB0b3RhbFN1cHBseSk7CiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgMHgwLCBudW0pOwoKICAgICAgICBhc3NlcnQoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPT0gcHJlX2JhbGFuY2UgLSBudW0pOwogICAgfQoKfQoKCi8vLyBAdGl0bGUgRHV0Y2ggYXVjdGlvbiBjb250cmFjdCAtIGRpc3RyaWJ1dGlvbiBvZiBhIGZpeGVkIG51bWJlciBvZiB0b2tlbnMgdXNpbmcgYW4gYXVjdGlvbi4KLy8vIFRoZSBjb250cmFjdCBjb2RlIGlzIGluc3BpcmVkIGJ5IHRoZSBHbm9zaXMgYXVjdGlvbiBjb250cmFjdC4gTWFpbiBkaWZmZXJlbmNlIGlzIHRoYXQgdGhlCi8vLyBhdWN0aW9uIGVuZHMgaWYgYSBmaXhlZCBudW1iZXIgb2YgdG9rZW5zIHdhcyBzb2xkLgpjb250cmFjdCBEdXRjaEF1Y3Rpb24gewogICAgLyoKICAgICAqIEF1Y3Rpb24gZm9yIHRoZSBSRE4gVG9rZW4uCiAgICAgKgogICAgICogVGVybWlub2xvZ3k6CiAgICAgKiAxIHRva2VuIHVuaXQgPSBSZWkKICAgICAqIDEgdG9rZW4gPSBSRE4gPSBSZWkgKiB0b2tlbl9tdWx0aXBsaWVyCiAgICAgKiB0b2tlbl9tdWx0aXBsaWVyIHNldCBmcm9tIHRva2VuJ3MgbnVtYmVyIG9mIGRlY2ltYWxzIChpLmUuIDEwICoqIGRlY2ltYWxzKQogICAgICovCgogICAgLy8gV2FpdCA3IGRheXMgYWZ0ZXIgdGhlIGVuZCBvZiB0aGUgYXVjdGlvbiwgYmVmb3JlIGFueW9uZSBjYW4gY2xhaW0gdG9rZW5zCiAgICB1aW50IGNvbnN0YW50IHB1YmxpYyB0b2tlbl9jbGFpbV93YWl0aW5nX3BlcmlvZCA9IDcgZGF5czsKCiAgICAvLyBCaWQgdmFsdWUgb3ZlciB3aGljaCB0aGUgYWRkcmVzcyBoYXMgdG8gYmUgd2hpdGVsaXN0ZWQKICAgIC8vIEF0IGRlcGxveW1lbnQgbW9tZW50LCBsZXNzIHRoYW4gMWskCiAgICB1aW50IGNvbnN0YW50IHB1YmxpYyBiaWRfdGhyZXNob2xkID0gMi41IGV0aGVyOwoKICAgIC8qCiAgICAgKiBTdG9yYWdlCiAgICAgKi8KCiAgICBSYWlkZW5Ub2tlbiBwdWJsaWMgdG9rZW47CiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcl9hZGRyZXNzOwogICAgYWRkcmVzcyBwdWJsaWMgd2FsbGV0X2FkZHJlc3M7CiAgICBhZGRyZXNzIHB1YmxpYyB3aGl0ZWxpc3Rlcl9hZGRyZXNzOwoKICAgIC8vIFByaWNlIGRlY2F5IGZ1bmN0aW9uIHBhcmFtZXRlcnMgdG8gYmUgY2hhbmdlZCBkZXBlbmRpbmcgb24gdGhlIGRlc2lyZWQgb3V0Y29tZQoKICAgIC8vIFN0YXJ0aW5nIHByaWNlIGluIFdFSTsgZS5nLiAyICogMTAgKiogMTgKICAgIHVpbnQgcHVibGljIHByaWNlX3N0YXJ0OwoKICAgIC8vIERpdmlzb3IgY29uc3RhbnQ7IGUuZy4gNTI0ODgwMDAwCiAgICB1aW50IHB1YmxpYyBwcmljZV9jb25zdGFudDsKCiAgICAvLyBEaXZpc29yIGV4cG9uZW50OyBlLmcuIDMKICAgIHVpbnQzMiBwdWJsaWMgcHJpY2VfZXhwb25lbnQ7CgogICAgLy8gRm9yIGNhbGN1bGF0aW5nIGVsYXBzZWQgdGltZSBmb3IgcHJpY2UKICAgIHVpbnQgcHVibGljIHN0YXJ0X3RpbWU7CiAgICB1aW50IHB1YmxpYyBlbmRfdGltZTsKICAgIHVpbnQgcHVibGljIHN0YXJ0X2Jsb2NrOwoKICAgIC8vIEtlZXAgdHJhY2sgb2YgYWxsIEVUSCByZWNlaXZlZCBpbiB0aGUgYmlkcwogICAgdWludCBwdWJsaWMgcmVjZWl2ZWRfd2VpOwoKICAgIC8vIEtlZXAgdHJhY2sgb2YgY3VtdWxhdGl2ZSBFVEggZnVuZHMgZm9yIHdoaWNoIHRoZSB0b2tlbnMgaGF2ZSBiZWVuIGNsYWltZWQKICAgIHVpbnQgcHVibGljIGZ1bmRzX2NsYWltZWQ7CgogICAgdWludCBwdWJsaWMgdG9rZW5fbXVsdGlwbGllcjsKCiAgICAvLyBUb3RhbCBudW1iZXIgb2YgUmVpIChSRE4gKiB0b2tlbl9tdWx0aXBsaWVyKSB0aGF0IHdpbGwgYmUgYXVjdGlvbmVkCiAgICB1aW50IHB1YmxpYyBudW1fdG9rZW5zX2F1Y3Rpb25lZDsKCiAgICAvLyBXZWkgcGVyIFJETiAoUmVpICogdG9rZW5fbXVsdGlwbGllcikKICAgIHVpbnQgcHVibGljIGZpbmFsX3ByaWNlOwoKICAgIC8vIEJpZGRlciBhZGRyZXNzID0+IGJpZCB2YWx1ZQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgYmlkczsKCiAgICAvLyBXaGl0ZWxpc3QgZm9yIGFkZHJlc3NlcyB0aGF0IHdhbnQgdG8gYmlkIG1vcmUgdGhhbiBiaWRfdGhyZXNob2xkCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyB3aGl0ZWxpc3Q7CgogICAgU3RhZ2VzIHB1YmxpYyBzdGFnZTsKCiAgICAvKgogICAgICogRW51bXMKICAgICAqLwogICAgZW51bSBTdGFnZXMgewogICAgICAgIEF1Y3Rpb25EZXBsb3llZCwKICAgICAgICBBdWN0aW9uU2V0VXAsCiAgICAgICAgQXVjdGlvblN0YXJ0ZWQsCiAgICAgICAgQXVjdGlvbkVuZGVkLAogICAgICAgIFRva2Vuc0Rpc3RyaWJ1dGVkCiAgICB9CgogICAgLyoKICAgICAqIE1vZGlmaWVycwogICAgICovCiAgICBtb2RpZmllciBhdFN0YWdlKFN0YWdlcyBfc3RhZ2UpIHsKICAgICAgICByZXF1aXJlKHN0YWdlID09IF9zdGFnZSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBpc093bmVyKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcl9hZGRyZXNzKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGlzV2hpdGVsaXN0ZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHdoaXRlbGlzdGVyX2FkZHJlc3MpOwogICAgICAgIF87CiAgICB9CgogICAgLyoKICAgICAqIEV2ZW50cwogICAgICovCgogICAgZXZlbnQgRGVwbG95ZWQoCiAgICAgICAgdWludCBpbmRleGVkIF9wcmljZV9zdGFydCwKICAgICAgICB1aW50IGluZGV4ZWQgX3ByaWNlX2NvbnN0YW50LAogICAgICAgIHVpbnQzMiBpbmRleGVkIF9wcmljZV9leHBvbmVudAogICAgKTsKICAgIGV2ZW50IFNldHVwKCk7CiAgICBldmVudCBBdWN0aW9uU3RhcnRlZCh1aW50IGluZGV4ZWQgX3N0YXJ0X3RpbWUsIHVpbnQgaW5kZXhlZCBfYmxvY2tfbnVtYmVyKTsKICAgIGV2ZW50IEJpZFN1Ym1pc3Npb24oCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIF9zZW5kZXIsCiAgICAgICAgdWludCBfYW1vdW50LAogICAgICAgIHVpbnQgX21pc3NpbmdfZnVuZHMKICAgICk7CiAgICBldmVudCBDbGFpbWVkVG9rZW5zKGFkZHJlc3MgaW5kZXhlZCBfcmVjaXBpZW50LCB1aW50IF9zZW50X2Ftb3VudCk7CiAgICBldmVudCBBdWN0aW9uRW5kZWQodWludCBfZmluYWxfcHJpY2UpOwogICAgZXZlbnQgVG9rZW5zRGlzdHJpYnV0ZWQoKTsKCiAgICAvKgogICAgICogUHVibGljIGZ1bmN0aW9ucwogICAgICovCgogICAgLy8vIEBkZXYgQ29udHJhY3QgY29uc3RydWN0b3IgZnVuY3Rpb24gc2V0cyB0aGUgc3RhcnRpbmcgcHJpY2UsIGRpdmlzb3IgY29uc3RhbnQgYW5kCiAgICAvLy8gZGl2aXNvciBleHBvbmVudCBmb3IgY2FsY3VsYXRpbmcgdGhlIER1dGNoIEF1Y3Rpb24gcHJpY2UuCiAgICAvLy8gQHBhcmFtIF93YWxsZXRfYWRkcmVzcyBXYWxsZXQgYWRkcmVzcyB0byB3aGljaCBhbGwgY29udHJpYnV0ZWQgRVRIIHdpbGwgYmUgZm9yd2FyZGVkLgogICAgLy8vIEBwYXJhbSBfcHJpY2Vfc3RhcnQgSGlnaCBwcmljZSBpbiBXRUkgYXQgd2hpY2ggdGhlIGF1Y3Rpb24gc3RhcnRzLgogICAgLy8vIEBwYXJhbSBfcHJpY2VfY29uc3RhbnQgQXVjdGlvbiBwcmljZSBkaXZpc29yIGNvbnN0YW50LgogICAgLy8vIEBwYXJhbSBfcHJpY2VfZXhwb25lbnQgQXVjdGlvbiBwcmljZSBkaXZpc29yIGV4cG9uZW50LgogICAgZnVuY3Rpb24gRHV0Y2hBdWN0aW9uKAogICAgICAgIGFkZHJlc3MgX3dhbGxldF9hZGRyZXNzLAogICAgICAgIGFkZHJlc3MgX3doaXRlbGlzdGVyX2FkZHJlc3MsCiAgICAgICAgdWludCBfcHJpY2Vfc3RhcnQsCiAgICAgICAgdWludCBfcHJpY2VfY29uc3RhbnQsCiAgICAgICAgdWludDMyIF9wcmljZV9leHBvbmVudCkKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICByZXF1aXJlKF93YWxsZXRfYWRkcmVzcyAhPSAweDApOwogICAgICAgIHJlcXVpcmUoX3doaXRlbGlzdGVyX2FkZHJlc3MgIT0gMHgwKTsKICAgICAgICB3YWxsZXRfYWRkcmVzcyA9IF93YWxsZXRfYWRkcmVzczsKICAgICAgICB3aGl0ZWxpc3Rlcl9hZGRyZXNzID0gX3doaXRlbGlzdGVyX2FkZHJlc3M7CgogICAgICAgIG93bmVyX2FkZHJlc3MgPSBtc2cuc2VuZGVyOwogICAgICAgIHN0YWdlID0gU3RhZ2VzLkF1Y3Rpb25EZXBsb3llZDsKICAgICAgICBjaGFuZ2VTZXR0aW5ncyhfcHJpY2Vfc3RhcnQsIF9wcmljZV9jb25zdGFudCwgX3ByaWNlX2V4cG9uZW50KTsKICAgICAgICBEZXBsb3llZChfcHJpY2Vfc3RhcnQsIF9wcmljZV9jb25zdGFudCwgX3ByaWNlX2V4cG9uZW50KTsKICAgIH0KCiAgICAvLy8gQGRldiBGYWxsYmFjayBmdW5jdGlvbiBmb3IgdGhlIGNvbnRyYWN0LCB3aGljaCBjYWxscyBiaWQoKSBpZiB0aGUgYXVjdGlvbiBoYXMgc3RhcnRlZC4KICAgIGZ1bmN0aW9uICgpIHB1YmxpYyBwYXlhYmxlIGF0U3RhZ2UoU3RhZ2VzLkF1Y3Rpb25TdGFydGVkKSB7CiAgICAgICAgYmlkKCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgU2V0IGBfdG9rZW5fYWRkcmVzc2AgYXMgdGhlIHRva2VuIGFkZHJlc3MgdG8gYmUgdXNlZCBpbiB0aGUgYXVjdGlvbi4KICAgIC8vLyBAZGV2IFNldHVwIGZ1bmN0aW9uIHNldHMgZXh0ZXJuYWwgY29udHJhY3RzIGFkZHJlc3Nlcy4KICAgIC8vLyBAcGFyYW0gX3Rva2VuX2FkZHJlc3MgVG9rZW4gYWRkcmVzcy4KICAgIGZ1bmN0aW9uIHNldHVwKGFkZHJlc3MgX3Rva2VuX2FkZHJlc3MpIHB1YmxpYyBpc093bmVyIGF0U3RhZ2UoU3RhZ2VzLkF1Y3Rpb25EZXBsb3llZCkgewogICAgICAgIHJlcXVpcmUoX3Rva2VuX2FkZHJlc3MgIT0gMHgwKTsKICAgICAgICB0b2tlbiA9IFJhaWRlblRva2VuKF90b2tlbl9hZGRyZXNzKTsKCiAgICAgICAgLy8gR2V0IG51bWJlciBvZiBSZWkgKFJETiAqIHRva2VuX211bHRpcGxpZXIpIHRvIGJlIGF1Y3Rpb25lZCBmcm9tIHRva2VuIGF1Y3Rpb24gYmFsYW5jZQogICAgICAgIG51bV90b2tlbnNfYXVjdGlvbmVkID0gdG9rZW4uYmFsYW5jZU9mKGFkZHJlc3ModGhpcykpOwoKICAgICAgICAvLyBTZXQgdGhlIG51bWJlciBvZiB0aGUgdG9rZW4gbXVsdGlwbGllciBmb3IgaXRzIGRlY2ltYWxzCiAgICAgICAgdG9rZW5fbXVsdGlwbGllciA9IDEwICoqIHVpbnQodG9rZW4uZGVjaW1hbHMoKSk7CgogICAgICAgIHN0YWdlID0gU3RhZ2VzLkF1Y3Rpb25TZXRVcDsKICAgICAgICBTZXR1cCgpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFNldCBgX3ByaWNlX3N0YXJ0YCwgYF9wcmljZV9jb25zdGFudGAgYW5kIGBfcHJpY2VfZXhwb25lbnRgIGFzCiAgICAvLy8gdGhlIG5ldyBzdGFydGluZyBwcmljZSwgcHJpY2UgZGl2aXNvciBjb25zdGFudCBhbmQgcHJpY2UgZGl2aXNvciBleHBvbmVudC4KICAgIC8vLyBAZGV2IENoYW5nZXMgYXVjdGlvbiBwcmljZSBmdW5jdGlvbiBwYXJhbWV0ZXJzIGJlZm9yZSBhdWN0aW9uIGlzIHN0YXJ0ZWQuCiAgICAvLy8gQHBhcmFtIF9wcmljZV9zdGFydCBVcGRhdGVkIHN0YXJ0IHByaWNlLgogICAgLy8vIEBwYXJhbSBfcHJpY2VfY29uc3RhbnQgVXBkYXRlZCBwcmljZSBkaXZpc29yIGNvbnN0YW50LgogICAgLy8vIEBwYXJhbSBfcHJpY2VfZXhwb25lbnQgVXBkYXRlZCBwcmljZSBkaXZpc29yIGV4cG9uZW50LgogICAgZnVuY3Rpb24gY2hhbmdlU2V0dGluZ3MoCiAgICAgICAgdWludCBfcHJpY2Vfc3RhcnQsCiAgICAgICAgdWludCBfcHJpY2VfY29uc3RhbnQsCiAgICAgICAgdWludDMyIF9wcmljZV9leHBvbmVudCkKICAgICAgICBpbnRlcm5hbAogICAgewogICAgICAgIHJlcXVpcmUoc3RhZ2UgPT0gU3RhZ2VzLkF1Y3Rpb25EZXBsb3llZCB8fCBzdGFnZSA9PSBTdGFnZXMuQXVjdGlvblNldFVwKTsKICAgICAgICByZXF1aXJlKF9wcmljZV9zdGFydCA+IDApOwogICAgICAgIHJlcXVpcmUoX3ByaWNlX2NvbnN0YW50ID4gMCk7CgogICAgICAgIHByaWNlX3N0YXJ0ID0gX3ByaWNlX3N0YXJ0OwogICAgICAgIHByaWNlX2NvbnN0YW50ID0gX3ByaWNlX2NvbnN0YW50OwogICAgICAgIHByaWNlX2V4cG9uZW50ID0gX3ByaWNlX2V4cG9uZW50OwogICAgfQoKICAgIC8vLyBAbm90aWNlIEFkZHMgYWNjb3VudCBhZGRyZXNzZXMgdG8gd2hpdGVsaXN0LgogICAgLy8vIEBkZXYgQWRkcyBhY2NvdW50IGFkZHJlc3NlcyB0byB3aGl0ZWxpc3QuCiAgICAvLy8gQHBhcmFtIF9iaWRkZXJfYWRkcmVzc2VzIEFycmF5IG9mIGFkZHJlc3Nlcy4KICAgIGZ1bmN0aW9uIGFkZFRvV2hpdGVsaXN0KGFkZHJlc3NbXSBfYmlkZGVyX2FkZHJlc3NlcykgcHVibGljIGlzV2hpdGVsaXN0ZXIgewogICAgICAgIGZvciAodWludDMyIGkgPSAwOyBpIDwgX2JpZGRlcl9hZGRyZXNzZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgd2hpdGVsaXN0W19iaWRkZXJfYWRkcmVzc2VzW2ldXSA9IHRydWU7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAbm90aWNlIFJlbW92ZXMgYWNjb3VudCBhZGRyZXNzZXMgZnJvbSB3aGl0ZWxpc3QuCiAgICAvLy8gQGRldiBSZW1vdmVzIGFjY291bnQgYWRkcmVzc2VzIGZyb20gd2hpdGVsaXN0LgogICAgLy8vIEBwYXJhbSBfYmlkZGVyX2FkZHJlc3NlcyBBcnJheSBvZiBhZGRyZXNzZXMuCiAgICBmdW5jdGlvbiByZW1vdmVGcm9tV2hpdGVsaXN0KGFkZHJlc3NbXSBfYmlkZGVyX2FkZHJlc3NlcykgcHVibGljIGlzV2hpdGVsaXN0ZXIgewogICAgICAgIGZvciAodWludDMyIGkgPSAwOyBpIDwgX2JpZGRlcl9hZGRyZXNzZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgd2hpdGVsaXN0W19iaWRkZXJfYWRkcmVzc2VzW2ldXSA9IGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQG5vdGljZSBTdGFydCB0aGUgYXVjdGlvbi4KICAgIC8vLyBAZGV2IFN0YXJ0cyBhdWN0aW9uIGFuZCBzZXRzIHN0YXJ0X3RpbWUuCiAgICBmdW5jdGlvbiBzdGFydEF1Y3Rpb24oKSBwdWJsaWMgaXNPd25lciBhdFN0YWdlKFN0YWdlcy5BdWN0aW9uU2V0VXApIHsKICAgICAgICBzdGFnZSA9IFN0YWdlcy5BdWN0aW9uU3RhcnRlZDsKICAgICAgICBzdGFydF90aW1lID0gbm93OwogICAgICAgIHN0YXJ0X2Jsb2NrID0gYmxvY2subnVtYmVyOwogICAgICAgIEF1Y3Rpb25TdGFydGVkKHN0YXJ0X3RpbWUsIHN0YXJ0X2Jsb2NrKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBGaW5hbGl6ZSB0aGUgYXVjdGlvbiAtIHNldHMgdGhlIGZpbmFsIFJETiB0b2tlbiBwcmljZSBhbmQgY2hhbmdlcyB0aGUgYXVjdGlvbgogICAgLy8vIHN0YWdlIGFmdGVyIG5vIGJpZHMgYXJlIGFsbG93ZWQgYW55bW9yZS4KICAgIC8vLyBAZGV2IEZpbmFsaXplIGF1Y3Rpb24gYW5kIHNldCB0aGUgZmluYWwgUkROIHRva2VuIHByaWNlLgogICAgZnVuY3Rpb24gZmluYWxpemVBdWN0aW9uKCkgcHVibGljIGF0U3RhZ2UoU3RhZ2VzLkF1Y3Rpb25TdGFydGVkKQogICAgewogICAgICAgIC8vIE1pc3NpbmcgZnVuZHMgc2hvdWxkIGJlIDAgYXQgdGhpcyBwb2ludAogICAgICAgIHVpbnQgbWlzc2luZ19mdW5kcyA9IG1pc3NpbmdGdW5kc1RvRW5kQXVjdGlvbigpOwogICAgICAgIHJlcXVpcmUobWlzc2luZ19mdW5kcyA9PSAwKTsKCiAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSBmaW5hbCBwcmljZSA9IFdFSSAvIFJETiA9IFdFSSAvIChSZWkgLyB0b2tlbl9tdWx0aXBsaWVyKQogICAgICAgIC8vIFJlbWluZGVyOiBudW1fdG9rZW5zX2F1Y3Rpb25lZCBpcyB0aGUgbnVtYmVyIG9mIFJlaSAoUkROICogdG9rZW5fbXVsdGlwbGllcikgdGhhdCBhcmUgYXVjdGlvbmVkCiAgICAgICAgZmluYWxfcHJpY2UgPSB0b2tlbl9tdWx0aXBsaWVyICogcmVjZWl2ZWRfd2VpIC8gbnVtX3Rva2Vuc19hdWN0aW9uZWQ7CgogICAgICAgIGVuZF90aW1lID0gbm93OwogICAgICAgIHN0YWdlID0gU3RhZ2VzLkF1Y3Rpb25FbmRlZDsKICAgICAgICBBdWN0aW9uRW5kZWQoZmluYWxfcHJpY2UpOwoKICAgICAgICBhc3NlcnQoZmluYWxfcHJpY2UgPiAwKTsKICAgIH0KCiAgICAvLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIEF1Y3Rpb24gRnVuY3Rpb25zIC0tLS0tLS0tLS0tLS0tLS0tLQoKCiAgICAvLy8gQG5vdGljZSBTZW5kIGBtc2cudmFsdWVgIFdFSSB0byB0aGUgYXVjdGlvbiBmcm9tIHRoZSBgbXNnLnNlbmRlcmAgYWNjb3VudC4KICAgIC8vLyBAZGV2IEFsbG93cyB0byBzZW5kIGEgYmlkIHRvIHRoZSBhdWN0aW9uLgogICAgZnVuY3Rpb24gYmlkKCkKICAgICAgICBwdWJsaWMKICAgICAgICBwYXlhYmxlCiAgICAgICAgYXRTdGFnZShTdGFnZXMuQXVjdGlvblN0YXJ0ZWQpCiAgICB7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPiAwKTsKICAgICAgICByZXF1aXJlKGJpZHNbbXNnLnNlbmRlcl0gKyBtc2cudmFsdWUgPD0gYmlkX3RocmVzaG9sZCB8fCB3aGl0ZWxpc3RbbXNnLnNlbmRlcl0pOwogICAgICAgIGFzc2VydChiaWRzW21zZy5zZW5kZXJdICsgbXNnLnZhbHVlID49IG1zZy52YWx1ZSk7CgogICAgICAgIC8vIE1pc3NpbmcgZnVuZHMgd2l0aG91dCB0aGUgY3VycmVudCBiaWQgdmFsdWUKICAgICAgICB1aW50IG1pc3NpbmdfZnVuZHMgPSBtaXNzaW5nRnVuZHNUb0VuZEF1Y3Rpb24oKTsKCiAgICAgICAgLy8gV2UgcmVxdWlyZSBiaWQgdmFsdWVzIHRvIGJlIGxlc3MgdGhhbiB0aGUgZnVuZHMgbWlzc2luZyB0byBlbmQgdGhlIGF1Y3Rpb24KICAgICAgICAvLyBhdCB0aGUgY3VycmVudCBwcmljZS4KICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA8PSBtaXNzaW5nX2Z1bmRzKTsKCiAgICAgICAgYmlkc1ttc2cuc2VuZGVyXSArPSBtc2cudmFsdWU7CiAgICAgICAgcmVjZWl2ZWRfd2VpICs9IG1zZy52YWx1ZTsKCiAgICAgICAgLy8gU2VuZCBiaWQgYW1vdW50IHRvIHdhbGxldAogICAgICAgIHdhbGxldF9hZGRyZXNzLnRyYW5zZmVyKG1zZy52YWx1ZSk7CgogICAgICAgIEJpZFN1Ym1pc3Npb24obXNnLnNlbmRlciwgbXNnLnZhbHVlLCBtaXNzaW5nX2Z1bmRzKTsKCiAgICAgICAgYXNzZXJ0KHJlY2VpdmVkX3dlaSA+PSBtc2cudmFsdWUpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIENsYWltIGF1Y3Rpb24gdG9rZW5zIGZvciBgbXNnLnNlbmRlcmAgYWZ0ZXIgdGhlIGF1Y3Rpb24gaGFzIGVuZGVkLgogICAgLy8vIEBkZXYgQ2xhaW1zIHRva2VucyBmb3IgYG1zZy5zZW5kZXJgIGFmdGVyIGF1Y3Rpb24uIFRvIGJlIHVzZWQgaWYgdG9rZW5zIGNhbgogICAgLy8vIGJlIGNsYWltZWQgYnkgYmVuZWZpY2lhcmllcywgaW5kaXZpZHVhbGx5LgogICAgZnVuY3Rpb24gY2xhaW1Ub2tlbnMoKSBwdWJsaWMgYXRTdGFnZShTdGFnZXMuQXVjdGlvbkVuZGVkKSByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHByb3h5Q2xhaW1Ub2tlbnMobXNnLnNlbmRlcik7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQ2xhaW0gYXVjdGlvbiB0b2tlbnMgZm9yIGByZWNlaXZlcl9hZGRyZXNzYCBhZnRlciB0aGUgYXVjdGlvbiBoYXMgZW5kZWQuCiAgICAvLy8gQGRldiBDbGFpbXMgdG9rZW5zIGZvciBgcmVjZWl2ZXJfYWRkcmVzc2AgYWZ0ZXIgYXVjdGlvbiBoYXMgZW5kZWQuCiAgICAvLy8gQHBhcmFtIHJlY2VpdmVyX2FkZHJlc3MgVG9rZW5zIHdpbGwgYmUgYXNzaWduZWQgdG8gdGhpcyBhZGRyZXNzIGlmIGVsaWdpYmxlLgogICAgZnVuY3Rpb24gcHJveHlDbGFpbVRva2VucyhhZGRyZXNzIHJlY2VpdmVyX2FkZHJlc3MpCiAgICAgICAgcHVibGljCiAgICAgICAgYXRTdGFnZShTdGFnZXMuQXVjdGlvbkVuZGVkKQogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgLy8gV2FpdGluZyBwZXJpb2QgYWZ0ZXIgdGhlIGVuZCBvZiB0aGUgYXVjdGlvbiwgYmVmb3JlIGFueW9uZSBjYW4gY2xhaW0gdG9rZW5zCiAgICAgICAgLy8gRW5zdXJlcyBlbm91Z2ggdGltZSB0byBjaGVjayBpZiBhdWN0aW9uIHdhcyBmaW5hbGl6ZWQgY29ycmVjdGx5CiAgICAgICAgLy8gYmVmb3JlIHVzZXJzIHN0YXJ0IHRyYW5zYWN0aW5nIHRva2VucwogICAgICAgIHJlcXVpcmUobm93ID4gZW5kX3RpbWUgKyB0b2tlbl9jbGFpbV93YWl0aW5nX3BlcmlvZCk7CiAgICAgICAgcmVxdWlyZShyZWNlaXZlcl9hZGRyZXNzICE9IDB4MCk7CgogICAgICAgIGlmIChiaWRzW3JlY2VpdmVyX2FkZHJlc3NdID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgLy8gTnVtYmVyIG9mIFJlaSA9IGJpZF93ZWkgLyBSZWkgPSBiaWRfd2VpIC8gKHdlaV9wZXJfUkROICogdG9rZW5fbXVsdGlwbGllcikKICAgICAgICB1aW50IG51bSA9ICh0b2tlbl9tdWx0aXBsaWVyICogYmlkc1tyZWNlaXZlcl9hZGRyZXNzXSkgLyBmaW5hbF9wcmljZTsKCiAgICAgICAgLy8gRHVlIHRvIGZpbmFsX3ByaWNlIGZsb29yIHJvdW5kaW5nLCB0aGUgbnVtYmVyIG9mIGFzc2lnbmVkIHRva2VucyBtYXkgYmUgaGlnaGVyCiAgICAgICAgLy8gdGhhbiBleHBlY3RlZC4gVGhlcmVmb3JlLCB0aGUgbnVtYmVyIG9mIHJlbWFpbmluZyB1bmFzc2lnbmVkIGF1Y3Rpb24gdG9rZW5zCiAgICAgICAgLy8gbWF5IGJlIHNtYWxsZXIgdGhhbiB0aGUgbnVtYmVyIG9mIHRva2VucyBuZWVkZWQgZm9yIHRoZSBsYXN0IGNsYWltVG9rZW5zIGNhbGwKICAgICAgICB1aW50IGF1Y3Rpb25fdG9rZW5zX2JhbGFuY2UgPSB0b2tlbi5iYWxhbmNlT2YoYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgaWYgKG51bSA+IGF1Y3Rpb25fdG9rZW5zX2JhbGFuY2UpIHsKICAgICAgICAgICAgbnVtID0gYXVjdGlvbl90b2tlbnNfYmFsYW5jZTsKICAgICAgICB9CgogICAgICAgIC8vIFVwZGF0ZSB0aGUgdG90YWwgYW1vdW50IG9mIGZ1bmRzIGZvciB3aGljaCB0b2tlbnMgaGF2ZSBiZWVuIGNsYWltZWQKICAgICAgICBmdW5kc19jbGFpbWVkICs9IGJpZHNbcmVjZWl2ZXJfYWRkcmVzc107CgogICAgICAgIC8vIFNldCByZWNlaXZlciBiaWQgdG8gMCBiZWZvcmUgYXNzaWduaW5nIHRva2VucwogICAgICAgIGJpZHNbcmVjZWl2ZXJfYWRkcmVzc10gPSAwOwoKICAgICAgICByZXF1aXJlKHRva2VuLnRyYW5zZmVyKHJlY2VpdmVyX2FkZHJlc3MsIG51bSkpOwoKICAgICAgICBDbGFpbWVkVG9rZW5zKHJlY2VpdmVyX2FkZHJlc3MsIG51bSk7CgogICAgICAgIC8vIEFmdGVyIHRoZSBsYXN0IHRva2VucyBhcmUgY2xhaW1lZCwgd2UgY2hhbmdlIHRoZSBhdWN0aW9uIHN0YWdlCiAgICAgICAgLy8gRHVlIHRvIHRoZSBhYm92ZSBsb2dpYywgcm91bmRpbmcgZXJyb3JzIHdpbGwgbm90IGJlIGFuIGlzc3VlCiAgICAgICAgaWYgKGZ1bmRzX2NsYWltZWQgPT0gcmVjZWl2ZWRfd2VpKSB7CiAgICAgICAgICAgIHN0YWdlID0gU3RhZ2VzLlRva2Vuc0Rpc3RyaWJ1dGVkOwogICAgICAgICAgICBUb2tlbnNEaXN0cmlidXRlZCgpOwogICAgICAgIH0KCiAgICAgICAgYXNzZXJ0KHRva2VuLmJhbGFuY2VPZihyZWNlaXZlcl9hZGRyZXNzKSA+PSBudW0pOwogICAgICAgIGFzc2VydChiaWRzW3JlY2VpdmVyX2FkZHJlc3NdID09IDApOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEdldCB0aGUgUkROIHByaWNlIGluIFdFSSBkdXJpbmcgdGhlIGF1Y3Rpb24sIGF0IHRoZSB0aW1lIG9mCiAgICAvLy8gY2FsbGluZyB0aGlzIGZ1bmN0aW9uLiBSZXR1cm5zIGAwYCBpZiBhdWN0aW9uIGhhcyBlbmRlZC4KICAgIC8vLyBSZXR1cm5zIGBwcmljZV9zdGFydGAgYmVmb3JlIGF1Y3Rpb24gaGFzIHN0YXJ0ZWQuCiAgICAvLy8gQGRldiBDYWxjdWxhdGVzIHRoZSBjdXJyZW50IFJETiB0b2tlbiBwcmljZSBpbiBXRUkuCiAgICAvLy8gQHJldHVybiBSZXR1cm5zIFdFSSBwZXIgUkROICh0b2tlbl9tdWx0aXBsaWVyICogUmVpKS4KICAgIGZ1bmN0aW9uIHByaWNlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICBpZiAoc3RhZ2UgPT0gU3RhZ2VzLkF1Y3Rpb25FbmRlZCB8fAogICAgICAgICAgICBzdGFnZSA9PSBTdGFnZXMuVG9rZW5zRGlzdHJpYnV0ZWQpIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIHJldHVybiBjYWxjVG9rZW5QcmljZSgpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEdldCB0aGUgbWlzc2luZyBmdW5kcyBuZWVkZWQgdG8gZW5kIHRoZSBhdWN0aW9uLAogICAgLy8vIGNhbGN1bGF0ZWQgYXQgdGhlIGN1cnJlbnQgUkROIHByaWNlIGluIFdFSS4KICAgIC8vLyBAZGV2IFRoZSBtaXNzaW5nIGZ1bmRzIGFtb3VudCBuZWNlc3NhcnkgdG8gZW5kIHRoZSBhdWN0aW9uIGF0IHRoZSBjdXJyZW50IFJETiBwcmljZSBpbiBXRUkuCiAgICAvLy8gQHJldHVybiBSZXR1cm5zIHRoZSBtaXNzaW5nIGZ1bmRzIGFtb3VudCBpbiBXRUkuCiAgICBmdW5jdGlvbiBtaXNzaW5nRnVuZHNUb0VuZEF1Y3Rpb24oKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludCkgewoKICAgICAgICAvLyBudW1fdG9rZW5zX2F1Y3Rpb25lZCA9IHRvdGFsIG51bWJlciBvZiBSZWkgKFJETiAqIHRva2VuX211bHRpcGxpZXIpIHRoYXQgaXMgYXVjdGlvbmVkCiAgICAgICAgdWludCByZXF1aXJlZF93ZWlfYXRfcHJpY2UgPSBudW1fdG9rZW5zX2F1Y3Rpb25lZCAqIHByaWNlKCkgLyB0b2tlbl9tdWx0aXBsaWVyOwogICAgICAgIGlmIChyZXF1aXJlZF93ZWlfYXRfcHJpY2UgPD0gcmVjZWl2ZWRfd2VpKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgLy8gYXNzZXJ0KHJlcXVpcmVkX3dlaV9hdF9wcmljZSAtIHJlY2VpdmVkX3dlaSA+IDApOwogICAgICAgIHJldHVybiByZXF1aXJlZF93ZWlfYXRfcHJpY2UgLSByZWNlaXZlZF93ZWk7CiAgICB9CgogICAgLyoKICAgICAqICBQcml2YXRlIGZ1bmN0aW9ucwogICAgICovCgogICAgLy8vIEBkZXYgQ2FsY3VsYXRlcyB0aGUgdG9rZW4gcHJpY2UgKFdFSSAvIFJETikgYXQgdGhlIGN1cnJlbnQgdGltZXN0YW1wCiAgICAvLy8gZHVyaW5nIHRoZSBhdWN0aW9uOyBlbGFwc2VkIHRpbWUgPSAwIGJlZm9yZSBhdWN0aW9uIHN0YXJ0cy4KICAgIC8vLyBCYXNlZCBvbiB0aGUgcHJvdmlkZWQgcGFyYW1ldGVycywgdGhlIHByaWNlIGRvZXMgbm90IGNoYW5nZSBpbiB0aGUgZmlyc3QKICAgIC8vLyBgcHJpY2VfY29uc3RhbnReKDEvcHJpY2VfZXhwb25lbnQpYCBzZWNvbmRzIGR1ZSB0byByb3VuZGluZy4KICAgIC8vLyBSb3VuZGluZyBpbiBgZGVjYXlfcmF0ZWAgYWxzbyBwcm9kdWNlcyB2YWx1ZXMgdGhhdCBpbmNyZWFzZSBpbnN0ZWFkIG9mIGRlY3JlYXNlCiAgICAvLy8gaW4gdGhlIGJlZ2lubmluZzsgdGhlc2Ugc3Bpa2VzIGRlY3JlYXNlIG92ZXIgdGltZSBhbmQgYXJlIG5vdGljZWFibGUKICAgIC8vLyBvbmx5IGluIGZpcnN0IGhvdXJzLiBUaGlzIHNob3VsZCBiZSBjYWxjdWxhdGVkIGJlZm9yZSB1c2FnZS4KICAgIC8vLyBAcmV0dXJuIFJldHVybnMgdGhlIHRva2VuIHByaWNlIC0gV2VpIHBlciBSRE4uCiAgICBmdW5jdGlvbiBjYWxjVG9rZW5QcmljZSgpIGNvbnN0YW50IHByaXZhdGUgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgZWxhcHNlZDsKICAgICAgICBpZiAoc3RhZ2UgPT0gU3RhZ2VzLkF1Y3Rpb25TdGFydGVkKSB7CiAgICAgICAgICAgIGVsYXBzZWQgPSBub3cgLSBzdGFydF90aW1lOwogICAgICAgIH0KCiAgICAgICAgdWludCBkZWNheV9yYXRlID0gZWxhcHNlZCAqKiBwcmljZV9leHBvbmVudCAvIHByaWNlX2NvbnN0YW50OwogICAgICAgIHJldHVybiBwcmljZV9zdGFydCAqICgxICsgZWxhcHNlZCkgLyAoMSArIGVsYXBzZWQgKyBkZWNheV9yYXRlKTsKICAgIH0KfQ=='.
	

]
