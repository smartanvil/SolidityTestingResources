Class {
	#name : #SRT6f6deb5db0c4994a8283a01d6cfeeb27fc3bbe9c,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT6f6deb5db0c4994a8283a01d6cfeeb27fc3bbe9c >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTc7CgpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBzdWIodWludCBhLCB1aW50IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCkgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQogIGZ1bmN0aW9uIGFkZCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQp9Cgpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50IHB1YmxpYyB0b3RhbFN1cHBseTsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsgLy9vd25lcgogIGFkZHJlc3MgcHVibGljIGFuaW1hdG9yOyAvL2FuaW1hdG9yCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludCk7CiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcHVibGljOwogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQgdmFsdWUpOwogIGZ1bmN0aW9uIGNvbW1pdERpdmlkZW5kKGFkZHJlc3Mgd2hvKSBpbnRlcm5hbDsgLy8gcGF5cyByZW1haW5pbmcgZGl2aWRlbmQKfQoKY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQpOwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHB1YmxpYzsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludCB2YWx1ZSkgcHVibGljOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdmFsdWUpOwp9Cgpjb250cmFjdCBCYXNpY1Rva2VuIGlzIEVSQzIwQmFzaWMgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50OwogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBiYWxhbmNlczsKCiAgbW9kaWZpZXIgb25seVBheWxvYWRTaXplKHVpbnQgc2l6ZSkgewogICAgIGFzc2VydChtc2cuZGF0YS5sZW5ndGggPj0gc2l6ZSArIDQpOwogICAgIF87CiAgfQogIC8qKgogICogQGRldiB0cmFuc2ZlciB0b2tlbiBmb3IgYSBzcGVjaWZpZWQgYWRkcmVzcwogICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0by4KICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCB0byBiZSB0cmFuc2ZlcnJlZC4KICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcHVibGljIG9ubHlQYXlsb2FkU2l6ZSgyICogMzIpIHsKICAgIGNvbW1pdERpdmlkZW5kKG1zZy5zZW5kZXIpOwogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgIGlmKF90byA9PSBhZGRyZXNzKHRoaXMpKSB7CiAgICAgICAgY29tbWl0RGl2aWRlbmQob3duZXIpOwogICAgICAgIGJhbGFuY2VzW293bmVyXSA9IGJhbGFuY2VzW293bmVyXS5hZGQoX3ZhbHVlKTsKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBvd25lciwgX3ZhbHVlKTsKICAgIH0KICAgIGVsc2UgewogICAgICAgIGNvbW1pdERpdmlkZW5kKF90byk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgfQogIH0KICAvKioKICAqIEBkZXYgR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuCiAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSB0aGUgYmFsYW5jZSBvZi4gCiAgKiBAcmV0dXJuIEFuIHVpbnQgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb3duZWQgYnkgdGhlIHBhc3NlZCBhZGRyZXNzLgogICovCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludCBiYWxhbmNlKSB7CiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICB9Cn0KCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgQmFzaWNUb2tlbiwgRVJDMjAgewogIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSkgYWxsb3dlZDsKCiAgLyoqCiAgICogQGRldiBUcmFuc2ZlciB0b2tlbnMgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyCiAgICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gc2VuZCB0b2tlbnMgZnJvbQogICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAqIEBwYXJhbSBfdmFsdWUgdWludCB0aGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcmVkCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcHVibGljIG9ubHlQYXlsb2FkU2l6ZSgzICogMzIpIHsKICAgIHZhciBfYWxsb3dhbmNlID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl07CiAgICBjb21taXREaXZpZGVuZChfZnJvbSk7CiAgICBjb21taXREaXZpZGVuZChfdG8pOwogICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBfYWxsb3dhbmNlLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogIH0KICAvKioKICAgKiBAZGV2IEFwcm92ZSB0aGUgcGFzc2VkIGFkZHJlc3MgdG8gc3BlbmQgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIG9uIGJlYWhsZiBvZiBtc2cuc2VuZGVyLgogICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHNwZW50LgogICAqLwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfdmFsdWUpIHB1YmxpYyB7CiAgICAvLyAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgIGFzc2VydCghKChfdmFsdWUgIT0gMCkgJiYgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdICE9IDApKSk7CiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogIH0KICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIGNoZWNrIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYW4gYW4gb3duZXIgYWxsb3dlZCB0byBhIHNwZW5kZXIuCiAgICogQHBhcmFtIF9vd25lciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIG93bnMgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfc3BlbmRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEByZXR1cm4gQSB1aW50IHNwZWNpZmluZyB0aGUgYW1vdW50IG9mIHRva2VucyBzdGlsbCBhdmFpYmxlIGZvciB0aGUgc3BlbmRlci4KICAgKi8KICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50IHJlbWFpbmluZykgewogICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgfQp9CgovKioKICogQHRpdGxlIFNtYXJ0QmlsbGlvbnMgY29udHJhY3QKICovCmNvbnRyYWN0IFNtYXJ0QmlsbGlvbnMgaXMgU3RhbmRhcmRUb2tlbiB7CgogICAgLy8gbWV0YWRhdGEKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJTbWFydEJpbGxpb25zIFRva2VuIjsKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gIlNtYXJ0IjsgLy8gY2hhbmdlZCBkdWUgdG8gY29uZmxpY3RzCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBkZWNpbWFscyA9IDA7CgogICAgLy8gY29udHJhY3Qgc3RhdGUKICAgIHN0cnVjdCBXYWxsZXQgewogICAgICAgIHVpbnQyMDggYmFsYW5jZTsgLy8gY3VycmVudCBiYWxhbmNlIG9mIHVzZXIKICAgIAl1aW50MTYgbGFzdERpdmlkZW5kUGVyaW9kOyAvLyBsYXN0IHByb2Nlc3NlZCBkaXZpZGVuZCBwZXJpb2Qgb2YgdXNlcidzIHRva2VucwogICAgCXVpbnQzMiBuZXh0V2l0aGRyYXdUaW1lOyAvLyBuZXh0IHdpdGhkcmF3YWwgcG9zc2libGUgYWZ0ZXIgdGhpcyB0aW1lc3RhbXAKICAgIH0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gV2FsbGV0KSB3YWxsZXRzOwogICAgc3RydWN0IEJldCB7CiAgICAgICAgdWludDE5MiB2YWx1ZTsgLy8gYmV0IHNpemUKICAgICAgICB1aW50MzIgYmV0SGFzaDsgLy8gc2VsZWN0ZWQgbnVtYmVycwogICAgICAgIHVpbnQzMiBibG9ja051bTsgLy8gYmxvY2tudW1iZXIgd2hlbiBsb3R0ZXJ5IHJ1bnMKICAgIH0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gQmV0KSBiZXRzOwoKICAgIHVpbnQgcHVibGljIHdhbGxldEJhbGFuY2UgPSAwOyAvLyBzdW0gb2YgZnVuZHMgaW4gd2FsbGV0cwoKICAgIC8vIGludmVzdG1lbnQgcGFyYW1ldGVycwogICAgdWludCBwdWJsaWMgaW52ZXN0U3RhcnQgPSAxOyAvLyBpbnZlc3RtZW50IHN0YXJ0IGJsb2NrLCAwOiBjbG9zZWQsIDE6IHByZXBhcmF0aW9uCiAgICB1aW50IHB1YmxpYyBpbnZlc3RCYWxhbmNlID0gMDsgLy8gZnVuZGluZyBmcm9tIGludmVzdG9ycwogICAgdWludCBwdWJsaWMgaW52ZXN0QmFsYW5jZUdvdCA9IDA7IC8vIGZ1bmRpbmcgY29sbGVjdGVkCiAgICB1aW50IHB1YmxpYyBpbnZlc3RCYWxhbmNlTWF4ID0gMjAwMDAwIGV0aGVyOyAvLyBtYXhpbXVtIGZ1bmRpbmcKICAgIHVpbnQgcHVibGljIGRpdmlkZW5kUGVyaW9kID0gMTsKICAgIHVpbnRbXSBwdWJsaWMgZGl2aWRlbmRzOyAvLyBkaXZpZGVucyBjb2xsZWN0ZWQgcGVyIHBlcmlvZCwgZ3Jvd2luZyBhcnJheQoKICAgIC8vIGJldHRpbmcgcGFyYW1ldGVycwogICAgdWludCBwdWJsaWMgbWF4V2luID0gMDsgLy8gbWF4aW11bSBwcml6ZSB3b24KICAgIHVpbnQgcHVibGljIGhhc2hGaXJzdCA9IDA7IC8vIHN0YXJ0IHRpbWUgb2YgYnVpbGRpbmcgaGFzaGVzIGRhdGFiYXNlCiAgICB1aW50IHB1YmxpYyBoYXNoTGFzdCA9IDA7IC8vIGxhc3Qgc2F2ZWQgYmxvY2sgb2YgaGFzaGVzCiAgICB1aW50IHB1YmxpYyBoYXNoTmV4dCA9IDA7IC8vIG5leHQgYXZhaWxhYmxlIGJldCBibG9jay5udW1iZXIKICAgIHVpbnQgcHVibGljIGhhc2hCZXRTdW0gPSAwOyAvLyB1c2VkIGJldCB2b2x1bWUgb2YgbmV4dCBibG9jawogICAgdWludCBwdWJsaWMgaGFzaEJldE1heCA9IDUgZXRoZXI7IC8vIG1heGltdW0gYmV0IHNpemUgcGVyIGJsb2NrCiAgICB1aW50W10gcHVibGljIGhhc2hlczsgLy8gc3BhY2UgZm9yIHN0b3JpbmcgbG90dGVyeSByZXN1bHRzCgogICAgLy8gY29uc3RhbnRzCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBoYXNoZXNTaXplID0gMTYzODQgOyAvLyAzMCBkYXlzIG9mIGJsb2NrcwogICAgdWludCBwdWJsaWMgY29sZFN0b3JlTGFzdCA9IDAgOyAvLyB0aW1lc3RhbXAgb2YgbGFzdCBjb2xkIHN0b3JlIHRyYW5zZmVyCgogICAgLy8gZXZlbnRzCiAgICBldmVudCBMb2dCZXQoYWRkcmVzcyBpbmRleGVkIHBsYXllciwgdWludCBiZXRoYXNoLCB1aW50IGJsb2NrbnVtYmVyLCB1aW50IGJldHNpemUpOwogICAgZXZlbnQgTG9nTG9zcyhhZGRyZXNzIGluZGV4ZWQgcGxheWVyLCB1aW50IGJldGhhc2gsIHVpbnQgaGFzaCk7CiAgICBldmVudCBMb2dXaW4oYWRkcmVzcyBpbmRleGVkIHBsYXllciwgdWludCBiZXRoYXNoLCB1aW50IGhhc2gsIHVpbnQgcHJpemUpOwogICAgZXZlbnQgTG9nSW52ZXN0bWVudChhZGRyZXNzIGluZGV4ZWQgaW52ZXN0b3IsIGFkZHJlc3MgaW5kZXhlZCBwYXJ0bmVyLCB1aW50IGFtb3VudCk7CiAgICBldmVudCBMb2dSZWNvcmRXaW4oYWRkcmVzcyBpbmRleGVkIHBsYXllciwgdWludCBhbW91bnQpOwogICAgZXZlbnQgTG9nTGF0ZShhZGRyZXNzIGluZGV4ZWQgcGxheWVyLHVpbnQgcGxheWVyQmxvY2tOdW1iZXIsdWludCBjdXJyZW50QmxvY2tOdW1iZXIpOwogICAgZXZlbnQgTG9nRGl2aWRlbmQoYWRkcmVzcyBpbmRleGVkIGludmVzdG9yLCB1aW50IGFtb3VudCwgdWludCBwZXJpb2QpOwoKICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgICAgICBhc3NlcnQobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5QW5pbWF0b3IoKSB7CiAgICAgICAgYXNzZXJ0KG1zZy5zZW5kZXIgPT0gYW5pbWF0b3IpOwogICAgICAgIF87CiAgICB9CgogICAgLy8gY29uc3RydWN0b3IKICAgIGZ1bmN0aW9uIFNtYXJ0QmlsbGlvbnMoKSBwdWJsaWMgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgICAgICBhbmltYXRvciA9IG1zZy5zZW5kZXI7CiAgICAgICAgd2FsbGV0c1tvd25lcl0ubGFzdERpdmlkZW5kUGVyaW9kID0gdWludDE2KGRpdmlkZW5kUGVyaW9kKTsKICAgICAgICBkaXZpZGVuZHMucHVzaCgwKTsgLy8gbm90IHVzZWQKICAgICAgICBkaXZpZGVuZHMucHVzaCgwKTsgLy8gY3VycmVudCBkaXZpZGVuZAogICAgfQoKLyogZ2V0dGVycyAqLwogICAgCiAgICAvKioKICAgICAqIEBkZXYgU2hvdyBsZW5ndGggb2YgYWxsb2NhdGVkIHN3YXAgc3BhY2UKICAgICAqLwogICAgZnVuY3Rpb24gaGFzaGVzTGVuZ3RoKCkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiB1aW50KGhhc2hlcy5sZW5ndGgpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEBkZXYgU2hvdyBiYWxhbmNlIG9mIHdhbGxldAogICAgICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudC4KICAgICAqLwogICAgZnVuY3Rpb24gd2FsbGV0QmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHVpbnQod2FsbGV0c1tfb3duZXJdLmJhbGFuY2UpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEBkZXYgU2hvdyBsYXN0IGRpdmlkZW5kIHBlcmlvZCBwcm9jZXNzZWQKICAgICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHdhbGxldFBlcmlvZE9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHVpbnQod2FsbGV0c1tfb3duZXJdLmxhc3REaXZpZGVuZFBlcmlvZCk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQGRldiBTaG93IGJsb2NrIG51bWJlciB3aGVuIHdpdGhkcmF3IGNhbiBjb250aW51ZQogICAgICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudC4KICAgICAqLwogICAgZnVuY3Rpb24gd2FsbGV0VGltZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHVpbnQod2FsbGV0c1tfb3duZXJdLm5leHRXaXRoZHJhd1RpbWUpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEBkZXYgU2hvdyBiZXQgc2l6ZS4KICAgICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIHBsYXllci4KICAgICAqLwogICAgZnVuY3Rpb24gYmV0VmFsdWVPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiB1aW50KGJldHNbX293bmVyXS52YWx1ZSk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQGRldiBTaG93IGJsb2NrIG51bWJlciBvZiBsb3R0ZXJ5IHJ1biBmb3IgdGhlIGJldC4KICAgICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIHBsYXllci4KICAgICAqLwogICAgZnVuY3Rpb24gYmV0SGFzaE9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHVpbnQoYmV0c1tfb3duZXJdLmJldEhhc2gpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEBkZXYgU2hvdyBibG9jayBudW1iZXIgb2YgbG90dGVyeSBydW4gZm9yIHRoZSBiZXQuCiAgICAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBwbGF5ZXIuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGJldEJsb2NrTnVtYmVyT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gdWludChiZXRzW19vd25lcl0uYmxvY2tOdW0pOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEBkZXYgUHJpbnQgbnVtYmVyIG9mIGJsb2NrIHRpbGwgbmV4dCBleHBlY3RlZCBkaXZpZGVuZCBwYXltZW50CiAgICAgKi8KICAgIGZ1bmN0aW9uIGRpdmlkZW5kc0Jsb2NrcygpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICBpZihpbnZlc3RTdGFydCA+IDApIHsKICAgICAgICAgICAgcmV0dXJuKDApOwogICAgICAgIH0KICAgICAgICB1aW50IHBlcmlvZCA9IChibG9jay5udW1iZXIgLSBoYXNoRmlyc3QpIC8gKDEwICogaGFzaGVzU2l6ZSk7CiAgICAgICAgaWYocGVyaW9kID4gZGl2aWRlbmRQZXJpb2QpIHsKICAgICAgICAgICAgcmV0dXJuKDApOwogICAgICAgIH0KICAgICAgICByZXR1cm4oKDEwICogaGFzaGVzU2l6ZSkgLSAoKGJsb2NrLm51bWJlciAtIGhhc2hGaXJzdCkgJSAoMTAgKiBoYXNoZXNTaXplKSkpOwogICAgfQoKLyogYWRtaW5pc3RyYXRpdmUgZnVuY3Rpb25zICovCgogICAgLyoqCiAgICAgKiBAZGV2IENoYW5nZSBvd25lci4KICAgICAqIEBwYXJhbSBfd2hvIFRoZSBhZGRyZXNzIG9mIG5ldyBvd25lci4KICAgICAqLwogICAgZnVuY3Rpb24gY2hhbmdlT3duZXIoYWRkcmVzcyBfd2hvKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIGFzc2VydChfd2hvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIGNvbW1pdERpdmlkZW5kKG1zZy5zZW5kZXIpOwogICAgICAgIGNvbW1pdERpdmlkZW5kKF93aG8pOwogICAgICAgIG93bmVyID0gX3dobzsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQ2hhbmdlIGFuaW1hdG9yLgogICAgICogQHBhcmFtIF93aG8gVGhlIGFkZHJlc3Mgb2YgbmV3IGFuaW1hdG9yLgogICAgICovCiAgICBmdW5jdGlvbiBjaGFuZ2VBbmltYXRvcihhZGRyZXNzIF93aG8pIGV4dGVybmFsIG9ubHlBbmltYXRvciB7CiAgICAgICAgYXNzZXJ0KF93aG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgY29tbWl0RGl2aWRlbmQobXNnLnNlbmRlcik7CiAgICAgICAgY29tbWl0RGl2aWRlbmQoX3dobyk7CiAgICAgICAgYW5pbWF0b3IgPSBfd2hvOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBTZXQgSUNPIFN0YXJ0IGJsb2NrLgogICAgICogQHBhcmFtIF93aGVuIFRoZSBibG9jayBudW1iZXIgb2YgdGhlIElDTy4KICAgICAqLwogICAgZnVuY3Rpb24gc2V0SW52ZXN0U3RhcnQodWludCBfd2hlbikgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKGludmVzdFN0YXJ0ID09IDEgJiYgaGFzaEZpcnN0ID4gMCAmJiBibG9jay5udW1iZXIgPCBfd2hlbik7CiAgICAgICAgaW52ZXN0U3RhcnQgPSBfd2hlbjsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgU2V0IG1heGltdW0gYmV0IHNpemUgcGVyIGJsb2NrCiAgICAgKiBAcGFyYW0gX21heHN1bSBUaGUgbWF4aW11bSBiZXQgc2l6ZSBpbiB3ZWkuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldEJldE1heCh1aW50IF9tYXhzdW0pIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgaGFzaEJldE1heCA9IF9tYXhzdW07CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFJlc2V0IGJldCBzaXplIGFjY291bnRpbmcsIHRvIGluY3JlYXNlIGJldCB2b2x1bWUgYWJvdmUgc2FmZSBsaW1pdHMKICAgICAqLwogICAgZnVuY3Rpb24gcmVzZXRCZXQoKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIGhhc2hOZXh0ID0gYmxvY2subnVtYmVyICsgMzsKICAgICAgICBoYXNoQmV0U3VtID0gMDsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgTW92ZSBmdW5kcyB0byBjb2xkIHN0b3JhZ2UKICAgICAqIEBkZXYgaW52ZXN0QmFsYW5jZSBhbmQgd2FsbGV0QmFsYW5jZSBpcyBwcm90ZWN0ZWQgZnJvbSB3aXRoZHJhdyBieSBvd25lcgogICAgICogQGRldiBpZiBmdW5kaW5nIGlzID4gNTAlIGFkbWluIGNhbiB3aXRoZHJhdyBvbmx5IDAuMjUlIG9mIGJhbGFuY2Ugd2Vla2x5CiAgICAgKiBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHdlaSB0byBtb3ZlIHRvIGNvbGQgc3RvcmFnZQogICAgICovCiAgICBmdW5jdGlvbiBjb2xkU3RvcmUodWludCBfYW1vdW50KSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIGhvdXNlS2VlcGluZygpOwogICAgICAgIHJlcXVpcmUoX2Ftb3VudCA+IDAgJiYgdGhpcy5iYWxhbmNlID49IChpbnZlc3RCYWxhbmNlICogOSAvIDEwKSArIHdhbGxldEJhbGFuY2UgKyBfYW1vdW50KTsKICAgICAgICBpZihpbnZlc3RCYWxhbmNlID49IGludmVzdEJhbGFuY2VHb3QgLyAyKXsgLy8gYWRkaXRpb25hbCBqYWNrcG90IHByb3RlY3Rpb24KICAgICAgICAgICAgcmVxdWlyZSgoX2Ftb3VudCA8PSB0aGlzLmJhbGFuY2UgLyA0MDApICYmIGNvbGRTdG9yZUxhc3QgKyA2MCAqIDYwICogMjQgKiA3IDw9IGJsb2NrLnRpbWVzdGFtcCk7CiAgICAgICAgfQogICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoX2Ftb3VudCk7CiAgICAgICAgY29sZFN0b3JlTGFzdCA9IGJsb2NrLnRpbWVzdGFtcDsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgTW92ZSBmdW5kcyB0byBjb250cmFjdCBqYWNrcG90CiAgICAgKi8KICAgIGZ1bmN0aW9uIGhvdFN0b3JlKCkgcGF5YWJsZSBleHRlcm5hbCB7CiAgICAgICAgd2FsbGV0QmFsYW5jZSArPSBtc2cudmFsdWU7CiAgICAgICAgd2FsbGV0c1ttc2cuc2VuZGVyXS5iYWxhbmNlICs9IHVpbnQyMDgobXNnLnZhbHVlKTsKICAgICAgICBob3VzZUtlZXBpbmcoKTsKICAgIH0KCi8qIGhvdXNla2VlcGluZyBmdW5jdGlvbnMgKi8KCiAgICAvKioKICAgICAqIEBkZXYgVXBkYXRlIGFjY291bnRpbmcKICAgICAqLwogICAgZnVuY3Rpb24gaG91c2VLZWVwaW5nKCkgcHVibGljIHsKICAgICAgICBpZihpbnZlc3RTdGFydCA+IDEgJiYgYmxvY2subnVtYmVyID49IGludmVzdFN0YXJ0ICsgKGhhc2hlc1NpemUgKiA1KSl7IC8vIGNhLiAxNCBkYXlzCiAgICAgICAgICAgIGludmVzdFN0YXJ0ID0gMDsgLy8gc3RhcnQgZGl2aWRlbmQgcGF5bWVudHMKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmKGhhc2hGaXJzdCA+IDApewoJCSAgICAgICAgdWludCBwZXJpb2QgPSAoYmxvY2subnVtYmVyIC0gaGFzaEZpcnN0KSAvICgxMCAqIGhhc2hlc1NpemUgKTsKICAgICAgICAgICAgICAgIGlmKHBlcmlvZCA+IGRpdmlkZW5kcy5sZW5ndGggLSAyKSB7CiAgICAgICAgICAgICAgICAgICAgZGl2aWRlbmRzLnB1c2goMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZihwZXJpb2QgPiBkaXZpZGVuZFBlcmlvZCAmJiBpbnZlc3RTdGFydCA9PSAwICYmIGRpdmlkZW5kUGVyaW9kIDwgZGl2aWRlbmRzLmxlbmd0aCAtIDEpIHsKICAgICAgICAgICAgICAgICAgICBkaXZpZGVuZFBlcmlvZCsrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKLyogcGF5bWVudHMgKi8KCiAgICAvKioKICAgICAqIEBkZXYgUGF5IGJhbGFuY2UgZnJvbSB3YWxsZXQKICAgICAqLwogICAgZnVuY3Rpb24gcGF5V2FsbGV0KCkgcHVibGljIHsKICAgICAgICBpZih3YWxsZXRzW21zZy5zZW5kZXJdLmJhbGFuY2UgPiAwICYmIHdhbGxldHNbbXNnLnNlbmRlcl0ubmV4dFdpdGhkcmF3VGltZSA8PSBibG9jay50aW1lc3RhbXApewogICAgICAgICAgICB1aW50IGJhbGFuY2UgPSB3YWxsZXRzW21zZy5zZW5kZXJdLmJhbGFuY2U7CiAgICAgICAgICAgIHdhbGxldHNbbXNnLnNlbmRlcl0uYmFsYW5jZSA9IDA7CiAgICAgICAgICAgIHdhbGxldEJhbGFuY2UgLT0gYmFsYW5jZTsKICAgICAgICAgICAgcGF5KGJhbGFuY2UpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBwYXkodWludCBfYW1vdW50KSBwcml2YXRlIHsKICAgICAgICB1aW50IG1heHBheSA9IHRoaXMuYmFsYW5jZSAvIDI7CiAgICAgICAgaWYobWF4cGF5ID49IF9hbW91bnQpIHsKICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihfYW1vdW50KTsKICAgICAgICAgICAgaWYoX2Ftb3VudCA+IDEgZmlubmV5KSB7CiAgICAgICAgICAgICAgICBob3VzZUtlZXBpbmcoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgdWludCBrZWVwYmFsYW5jZSA9IF9hbW91bnQgLSBtYXhwYXk7CiAgICAgICAgICAgIHdhbGxldEJhbGFuY2UgKz0ga2VlcGJhbGFuY2U7CiAgICAgICAgICAgIHdhbGxldHNbbXNnLnNlbmRlcl0uYmFsYW5jZSArPSB1aW50MjA4KGtlZXBiYWxhbmNlKTsKICAgICAgICAgICAgd2FsbGV0c1ttc2cuc2VuZGVyXS5uZXh0V2l0aGRyYXdUaW1lID0gdWludDMyKGJsb2NrLnRpbWVzdGFtcCArIDYwICogNjAgKiAyNCAqIDMwKTsgLy8gd2FpdCAxIG1vbnRoIGZvciBtb3JlIGZ1bmRzCiAgICAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIobWF4cGF5KTsKICAgICAgICB9CiAgICB9CgovKiBpbnZlc3RtZW50IGZ1bmN0aW9ucyAqLwoKICAgIC8qKgogICAgICogQGRldiBCdXkgdG9rZW5zCiAgICAgKi8KICAgIGZ1bmN0aW9uIGludmVzdERpcmVjdCgpIHBheWFibGUgZXh0ZXJuYWwgewogICAgICAgIGludmVzdChvd25lcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEJ1eSB0b2tlbnMgd2l0aCBhZmZpbGlhdGUgcGFydG5lcgogICAgICogQHBhcmFtIF9wYXJ0bmVyIEFmZmlsaWF0ZSBwYXJ0bmVyCiAgICAgKi8KICAgIGZ1bmN0aW9uIGludmVzdChhZGRyZXNzIF9wYXJ0bmVyKSBwYXlhYmxlIHB1YmxpYyB7CiAgICAgICAgLy9yZXF1aXJlKGZyb21VU0EoKT09ZmFsc2UpOyAvLyBmcm9tVVNBKCkgbm90IHlldCBpbXBsZW1lbnRlZCA6LSgKICAgICAgICByZXF1aXJlKGludmVzdFN0YXJ0ID4gMSAmJiBibG9jay5udW1iZXIgPCBpbnZlc3RTdGFydCArIChoYXNoZXNTaXplICogNSkgJiYgaW52ZXN0QmFsYW5jZSA8IGludmVzdEJhbGFuY2VNYXgpOwogICAgICAgIHVpbnQgaW52ZXN0aW5nID0gbXNnLnZhbHVlOwogICAgICAgIGlmKGludmVzdGluZyA+IGludmVzdEJhbGFuY2VNYXggLSBpbnZlc3RCYWxhbmNlKSB7CiAgICAgICAgICAgIGludmVzdGluZyA9IGludmVzdEJhbGFuY2VNYXggLSBpbnZlc3RCYWxhbmNlOwogICAgICAgICAgICBpbnZlc3RCYWxhbmNlID0gaW52ZXN0QmFsYW5jZU1heDsKICAgICAgICAgICAgaW52ZXN0QmFsYW5jZUdvdCA9IGludmVzdEJhbGFuY2VNYXg7CiAgICAgICAgICAgIGludmVzdFN0YXJ0ID0gMDsgLy8gY2xvc2UgaW52ZXN0bWVudCByb3VuZAogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKG1zZy52YWx1ZS5zdWIoaW52ZXN0aW5nKSk7IC8vIHNlbmQgYmFjayBmdW5kcyBpbW1lZGlhdGVseQogICAgICAgIH0KICAgICAgICBlbHNlewogICAgICAgICAgICBpbnZlc3RCYWxhbmNlICs9IGludmVzdGluZzsKICAgICAgICAgICAgaW52ZXN0QmFsYW5jZUdvdCArPSBpbnZlc3Rpbmc7CiAgICAgICAgfQogICAgICAgIGlmKF9wYXJ0bmVyID09IGFkZHJlc3MoMCkgfHwgX3BhcnRuZXIgPT0gb3duZXIpewogICAgICAgICAgICB3YWxsZXRCYWxhbmNlICs9IGludmVzdGluZyAvIDEwOwogICAgICAgICAgICB3YWxsZXRzW293bmVyXS5iYWxhbmNlICs9IHVpbnQyMDgoaW52ZXN0aW5nIC8gMTApO30gLy8gMTAlIGZvciBtYXJrZXRpbmcgaWYgbm8gYWZmaWxpYXRlcwogICAgICAgIGVsc2V7CiAgICAgICAgICAgIHdhbGxldEJhbGFuY2UgKz0gKGludmVzdGluZyAqIDUgLyAxMDApICogMjsKICAgICAgICAgICAgd2FsbGV0c1tvd25lcl0uYmFsYW5jZSArPSB1aW50MjA4KGludmVzdGluZyAqIDUgLyAxMDApOyAvLyA1JSBpbml0aWFsIG1hcmtldGluZyBmdW5kcwogICAgICAgICAgICB3YWxsZXRzW19wYXJ0bmVyXS5iYWxhbmNlICs9IHVpbnQyMDgoaW52ZXN0aW5nICogNSAvIDEwMCk7fSAvLyA1JSBmb3IgYWZmaWxpYXRlcwogICAgICAgIHdhbGxldHNbbXNnLnNlbmRlcl0ubGFzdERpdmlkZW5kUGVyaW9kID0gdWludDE2KGRpdmlkZW5kUGVyaW9kKTsgLy8gYXNzZXJ0KGRpdmlkZW5kUGVyaW9kID09IDEpOwogICAgICAgIHVpbnQgc2VuZGVyQmFsYW5jZSA9IGludmVzdGluZyAvIDEwKioxNTsKICAgICAgICB1aW50IG93bmVyQmFsYW5jZSA9IGludmVzdGluZyAqIDE2IC8gMTAqKjE3ICA7CiAgICAgICAgdWludCBhbmltYXRvckJhbGFuY2UgPSBpbnZlc3RpbmcgKiAxMCAvIDEwKioxNyAgOwogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdICs9IHNlbmRlckJhbGFuY2U7CiAgICAgICAgYmFsYW5jZXNbb3duZXJdICs9IG93bmVyQmFsYW5jZSA7IC8vIDEzJSBvZiBzaGFyZXMgZ28gdG8gZGV2ZWxvcGVycwogICAgICAgIGJhbGFuY2VzW2FuaW1hdG9yXSArPSBhbmltYXRvckJhbGFuY2UgOyAvLyA4JSBvZiBzaGFyZXMgZ28gdG8gYW5pbWF0b3IKICAgICAgICB0b3RhbFN1cHBseSArPSBzZW5kZXJCYWxhbmNlICsgb3duZXJCYWxhbmNlICsgYW5pbWF0b3JCYWxhbmNlOwogICAgICAgIFRyYW5zZmVyKGFkZHJlc3MoMCksbXNnLnNlbmRlcixzZW5kZXJCYWxhbmNlKTsgLy8gZm9yIGV0aGVyc2NhbgogICAgICAgIFRyYW5zZmVyKGFkZHJlc3MoMCksb3duZXIsb3duZXJCYWxhbmNlKTsgLy8gZm9yIGV0aGVyc2NhbgogICAgICAgIFRyYW5zZmVyKGFkZHJlc3MoMCksYW5pbWF0b3IsYW5pbWF0b3JCYWxhbmNlKTsgLy8gZm9yIGV0aGVyc2NhbgogICAgICAgIExvZ0ludmVzdG1lbnQobXNnLnNlbmRlcixfcGFydG5lcixpbnZlc3RpbmcpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBEZWxldGUgYWxsIHRva2VucyBvd25lZCBieSBzZW5kZXIgYW5kIHJldHVybiB1bnBhaWQgZGl2aWRlbmRzIGFuZCA5MCUgb2YgaW5pdGlhbCBpbnZlc3RtZW50CiAgICAgKi8KICAgIGZ1bmN0aW9uIGRpc2ludmVzdCgpIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKGludmVzdFN0YXJ0ID09IDApOwogICAgICAgIGNvbW1pdERpdmlkZW5kKG1zZy5zZW5kZXIpOwogICAgICAgIHVpbnQgaW5pdGlhbEludmVzdG1lbnQgPSBiYWxhbmNlc1ttc2cuc2VuZGVyXSAqIDEwKioxNTsKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLGFkZHJlc3MoMCksYmFsYW5jZXNbbXNnLnNlbmRlcl0pOyAvLyBmb3IgZXRoZXJzY2FuCiAgICAgICAgZGVsZXRlIGJhbGFuY2VzW21zZy5zZW5kZXJdOyAvLyB0b3RhbFN1cHBseSBzdGF5cyB0aGUgc2FtZSwgaW52ZXN0QmFsYW5jZSBpcyByZWR1Y2VkCiAgICAgICAgaW52ZXN0QmFsYW5jZSAtPSBpbml0aWFsSW52ZXN0bWVudDsKICAgICAgICB3YWxsZXRzW21zZy5zZW5kZXJdLmJhbGFuY2UgKz0gdWludDIwOChpbml0aWFsSW52ZXN0bWVudCAqIDkgLyAxMCk7CiAgICAgICAgcGF5V2FsbGV0KCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFBheSB1bnBhaWQgZGl2aWRlbmRzCiAgICAgKi8KICAgIGZ1bmN0aW9uIHBheURpdmlkZW5kcygpIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKGludmVzdFN0YXJ0ID09IDApOwogICAgICAgIGNvbW1pdERpdmlkZW5kKG1zZy5zZW5kZXIpOwogICAgICAgIHBheVdhbGxldCgpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBDb21taXQgcmVtYWluaW5nIGRpdmlkZW5kcyBiZWZvcmUgdHJhbnNmZXIgb2YgdG9rZW5zCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNvbW1pdERpdmlkZW5kKGFkZHJlc3MgX3dobykgaW50ZXJuYWwgewogICAgICAgIHVpbnQgbGFzdCA9IHdhbGxldHNbX3dob10ubGFzdERpdmlkZW5kUGVyaW9kOwogICAgICAgIGlmKChiYWxhbmNlc1tfd2hvXT09MCkgfHwgKGxhc3Q9PTApKXsKICAgICAgICAgICAgd2FsbGV0c1tfd2hvXS5sYXN0RGl2aWRlbmRQZXJpb2Q9dWludDE2KGRpdmlkZW5kUGVyaW9kKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZihsYXN0PT1kaXZpZGVuZFBlcmlvZCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHVpbnQgc2hhcmUgPSBiYWxhbmNlc1tfd2hvXSAqIDB4ZmZmZmZmZmYgLyB0b3RhbFN1cHBseTsKICAgICAgICB1aW50IGJhbGFuY2UgPSAwOwogICAgICAgIGZvcig7bGFzdDxkaXZpZGVuZFBlcmlvZDtsYXN0KyspIHsKICAgICAgICAgICAgYmFsYW5jZSArPSBzaGFyZSAqIGRpdmlkZW5kc1tsYXN0XTsKICAgICAgICB9CiAgICAgICAgYmFsYW5jZSA9IChiYWxhbmNlIC8gMHhmZmZmZmZmZik7CiAgICAgICAgd2FsbGV0QmFsYW5jZSArPSBiYWxhbmNlOwogICAgICAgIHdhbGxldHNbX3dob10uYmFsYW5jZSArPSB1aW50MjA4KGJhbGFuY2UpOwogICAgICAgIHdhbGxldHNbX3dob10ubGFzdERpdmlkZW5kUGVyaW9kID0gdWludDE2KGxhc3QpOwogICAgICAgIExvZ0RpdmlkZW5kKF93aG8sYmFsYW5jZSxsYXN0KTsKICAgIH0KCi8qIGxvdHRlcnkgZnVuY3Rpb25zICovCgogICAgZnVuY3Rpb24gYmV0UHJpemUoQmV0IF9wbGF5ZXIsIHVpbnQyNCBfaGFzaCkgY29uc3RhbnQgcHJpdmF0ZSByZXR1cm5zICh1aW50KSB7IC8vIGhvdXNlIGZlZSAxMy44NSUKICAgICAgICB1aW50MjQgYmV0aGFzaCA9IHVpbnQyNChfcGxheWVyLmJldEhhc2gpOwogICAgICAgIHVpbnQyNCBoaXQgPSBiZXRoYXNoIF4gX2hhc2g7CiAgICAgICAgdWludDI0IG1hdGNoZXMgPQogICAgICAgICAgICAoKGhpdCAmIDB4RikgPT0gMCA/IDEgOiAwICkgKwogICAgICAgICAgICAoKGhpdCAmIDB4RjApID09IDAgPyAxIDogMCApICsKICAgICAgICAgICAgKChoaXQgJiAweEYwMCkgPT0gMCA/IDEgOiAwICkgKwogICAgICAgICAgICAoKGhpdCAmIDB4RjAwMCkgPT0gMCA/IDEgOiAwICkgKwogICAgICAgICAgICAoKGhpdCAmIDB4RjAwMDApID09IDAgPyAxIDogMCApICsKICAgICAgICAgICAgKChoaXQgJiAweEYwMDAwMCkgPT0gMCA/IDEgOiAwICk7CiAgICAgICAgaWYobWF0Y2hlcyA9PSA2KXsKICAgICAgICAgICAgcmV0dXJuKHVpbnQoX3BsYXllci52YWx1ZSkgKiA3MDAwMDAwKTsKICAgICAgICB9CiAgICAgICAgaWYobWF0Y2hlcyA9PSA1KXsKICAgICAgICAgICAgcmV0dXJuKHVpbnQoX3BsYXllci52YWx1ZSkgKiAyMDAwMCk7CiAgICAgICAgfQogICAgICAgIGlmKG1hdGNoZXMgPT0gNCl7CiAgICAgICAgICAgIHJldHVybih1aW50KF9wbGF5ZXIudmFsdWUpICogNTAwKTsKICAgICAgICB9CiAgICAgICAgaWYobWF0Y2hlcyA9PSAzKXsKICAgICAgICAgICAgcmV0dXJuKHVpbnQoX3BsYXllci52YWx1ZSkgKiAyNSk7CiAgICAgICAgfQogICAgICAgIGlmKG1hdGNoZXMgPT0gMil7CiAgICAgICAgICAgIHJldHVybih1aW50KF9wbGF5ZXIudmFsdWUpICogMyk7CiAgICAgICAgfQogICAgICAgIHJldHVybigwKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBAZGV2IENoZWNrIGlmIHdvbiBpbiBsb3R0ZXJ5CiAgICAgKi8KICAgIGZ1bmN0aW9uIGJldE9mKGFkZHJlc3MgX3dobykgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludCkgIHsKICAgICAgICBCZXQgbWVtb3J5IHBsYXllciA9IGJldHNbX3dob107CiAgICAgICAgaWYoIChwbGF5ZXIudmFsdWU9PTApIHx8CiAgICAgICAgICAgIChwbGF5ZXIuYmxvY2tOdW08PTEpIHx8CiAgICAgICAgICAgIChibG9jay5udW1iZXI8cGxheWVyLmJsb2NrTnVtKSB8fAogICAgICAgICAgICAoYmxvY2subnVtYmVyPj1wbGF5ZXIuYmxvY2tOdW0gKyAoMTAgKiBoYXNoZXNTaXplKSkpewogICAgICAgICAgICByZXR1cm4oMCk7CiAgICAgICAgfQogICAgICAgIGlmKGJsb2NrLm51bWJlcjxwbGF5ZXIuYmxvY2tOdW0rMjU2KXsKICAgICAgICAgICAgcmV0dXJuKGJldFByaXplKHBsYXllcix1aW50MjQoYmxvY2suYmxvY2toYXNoKHBsYXllci5ibG9ja051bSkpKSk7CiAgICAgICAgfQogICAgICAgIGlmKGhhc2hGaXJzdD4wKXsKICAgICAgICAgICAgdWludDMyIGhhc2ggPSBnZXRIYXNoKHBsYXllci5ibG9ja051bSk7CiAgICAgICAgICAgIGlmKGhhc2ggPT0gMHgxMDAwMDAwKSB7IC8vIGxvYWQgaGFzaCBmYWlsZWQgOi0oLCByZXR1cm4gZnVuZHMKICAgICAgICAgICAgICAgIHJldHVybih1aW50KHBsYXllci52YWx1ZSkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2V7CiAgICAgICAgICAgICAgICByZXR1cm4oYmV0UHJpemUocGxheWVyLHVpbnQyNChoYXNoKSkpOwogICAgICAgICAgICB9Cgl9CiAgICAgICAgcmV0dXJuKDApOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBDaGVjayBpZiB3b24gaW4gbG90dGVyeQogICAgICovCiAgICBmdW5jdGlvbiB3b24oKSBwdWJsaWMgewogICAgICAgIEJldCBtZW1vcnkgcGxheWVyID0gYmV0c1ttc2cuc2VuZGVyXTsKICAgICAgICBpZihwbGF5ZXIuYmxvY2tOdW09PTApeyAvLyBjcmVhdGUgYSBuZXcgcGxheWVyCiAgICAgICAgICAgIGJldHNbbXNnLnNlbmRlcl0gPSBCZXQoe3ZhbHVlOiAwLCBiZXRIYXNoOiAwLCBibG9ja051bTogMX0pOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmKChwbGF5ZXIudmFsdWU9PTApIHx8IChwbGF5ZXIuYmxvY2tOdW09PTEpKXsKICAgICAgICAgICAgcGF5V2FsbGV0KCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgcmVxdWlyZShibG9jay5udW1iZXI+cGxheWVyLmJsb2NrTnVtKTsgLy8gaWYgdGhlcmUgaXMgYW4gYWN0aXZlIGJldCwgdGhyb3coKQogICAgICAgIGlmKHBsYXllci5ibG9ja051bSArICgxMCAqIGhhc2hlc1NpemUpIDw9IGJsb2NrLm51bWJlcil7IC8vIGxhc3QgYmV0IHRvbyBsb25nIGFnbywgbG9zdCAhCiAgICAgICAgICAgIExvZ0xhdGUobXNnLnNlbmRlcixwbGF5ZXIuYmxvY2tOdW0sYmxvY2subnVtYmVyKTsKICAgICAgICAgICAgYmV0c1ttc2cuc2VuZGVyXSA9IEJldCh7dmFsdWU6IDAsIGJldEhhc2g6IDAsIGJsb2NrTnVtOiAxfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdWludCBwcml6ZSA9IDA7CiAgICAgICAgdWludDMyIGhhc2ggPSAwOwogICAgICAgIGlmKGJsb2NrLm51bWJlcjxwbGF5ZXIuYmxvY2tOdW0rMjU2KXsKICAgICAgICAgICAgaGFzaCA9IHVpbnQyNChibG9jay5ibG9ja2hhc2gocGxheWVyLmJsb2NrTnVtKSk7CiAgICAgICAgICAgIHByaXplID0gYmV0UHJpemUocGxheWVyLHVpbnQyNChoYXNoKSk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBpZihoYXNoRmlyc3Q+MCl7IC8vIGxvdHRlcnkgaXMgb3BlbiBldmVuIGJlZm9yZSBzd2FwIHNwYWNlIChoYXNoZXMpIGlzIHJlYWR5LCBidXQgcGxheWVyIG11c3QgY29sbGVjdCByZXN1bHRzIHdpdGhpbiAyNTYgYmxvY2tzIGFmdGVyIHJ1bgogICAgICAgICAgICAgICAgaGFzaCA9IGdldEhhc2gocGxheWVyLmJsb2NrTnVtKTsKICAgICAgICAgICAgICAgIGlmKGhhc2ggPT0gMHgxMDAwMDAwKSB7IC8vIGxvYWQgaGFzaCBmYWlsZWQgOi0oCiAgICAgICAgICAgICAgICAgICAgLy9wcml6ZSA9IHVpbnQocGxheWVyLnZhbHVlKTsgbm8gcmVmdW5kcyBhbnltb3JlCiAgICAgICAgICAgICAgICAgICAgTG9nTGF0ZShtc2cuc2VuZGVyLHBsYXllci5ibG9ja051bSxibG9jay5udW1iZXIpOwogICAgICAgICAgICAgICAgICAgIGJldHNbbXNnLnNlbmRlcl0gPSBCZXQoe3ZhbHVlOiAwLCBiZXRIYXNoOiAwLCBibG9ja051bTogMX0pOwogICAgICAgICAgICAgICAgICAgIHJldHVybigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICAgICAgICBwcml6ZSA9IGJldFByaXplKHBsYXllcix1aW50MjQoaGFzaCkpOwogICAgICAgICAgICAgICAgfQoJICAgIH0KICAgICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICAgIExvZ0xhdGUobXNnLnNlbmRlcixwbGF5ZXIuYmxvY2tOdW0sYmxvY2subnVtYmVyKTsKICAgICAgICAgICAgICAgIGJldHNbbXNnLnNlbmRlcl0gPSBCZXQoe3ZhbHVlOiAwLCBiZXRIYXNoOiAwLCBibG9ja051bTogMX0pOwogICAgICAgICAgICAgICAgcmV0dXJuKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgYmV0c1ttc2cuc2VuZGVyXSA9IEJldCh7dmFsdWU6IDAsIGJldEhhc2g6IDAsIGJsb2NrTnVtOiAxfSk7CiAgICAgICAgaWYocHJpemU+MCkgewogICAgICAgICAgICBMb2dXaW4obXNnLnNlbmRlcix1aW50KHBsYXllci5iZXRIYXNoKSx1aW50KGhhc2gpLHByaXplKTsKICAgICAgICAgICAgaWYocHJpemUgPiBtYXhXaW4pewogICAgICAgICAgICAgICAgbWF4V2luID0gcHJpemU7CiAgICAgICAgICAgICAgICBMb2dSZWNvcmRXaW4obXNnLnNlbmRlcixwcml6ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcGF5KHByaXplKTsKICAgICAgICB9CiAgICAgICAgZWxzZXsKICAgICAgICAgICAgTG9nTG9zcyhtc2cuc2VuZGVyLHVpbnQocGxheWVyLmJldEhhc2gpLHVpbnQoaGFzaCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgU2VuZCBldGhlciB0byBidXkgdG9rZW5zIGR1cmluZyBJQ08KICAgICAqIEBkZXYgb3Igc2VuZCBsZXNzIHRoYW4gMSBldGhlciB0byBjb250cmFjdCB0byBwbGF5CiAgICAgKiBAZGV2IG9yIHNlbmQgMCB0byBjb2xsZWN0IHByaXplCiAgICAgKi8KICAgIGZ1bmN0aW9uICgpIHBheWFibGUgZXh0ZXJuYWwgewogICAgICAgIGlmKG1zZy52YWx1ZSA+IDApewogICAgICAgICAgICBpZihpbnZlc3RTdGFydD4xKXsgLy8gZHVyaW5nIElDTyBwYXltZW50IHRvIHRoZSBjb250cmFjdCBpcyB0cmVhdGVkIGFzIGludmVzdG1lbnQKICAgICAgICAgICAgICAgIGludmVzdChvd25lcik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZXsgLy8gaWYgbm90IElDTyBydW5uaW5nIHBheW1lbnQgdG8gY29udHJhY3QgaXMgdHJlYXRlZCBhcyBwbGF5CiAgICAgICAgICAgICAgICBwbGF5KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICAvL2NoZWNrIGZvciBkaXZpZGVuZHMgYW5kIG90aGVyIGFzc2V0cwogICAgICAgIGlmKGludmVzdFN0YXJ0ID09IDAgJiYgYmFsYW5jZXNbbXNnLnNlbmRlcl0+MCl7CiAgICAgICAgICAgIGNvbW1pdERpdmlkZW5kKG1zZy5zZW5kZXIpO30KICAgICAgICB3b24oKTsgLy8gd2lsbCBydW4gcGF5V2FsbGV0KCkgaWYgbm90aGluZyBlbHNlIGF2YWlsYWJsZQogICAgfQoKICAgIC8qKgogICAgICogQGRldiBQbGF5IGluIGxvdHRlcnkKICAgICAqLwogICAgZnVuY3Rpb24gcGxheSgpIHBheWFibGUgcHVibGljIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gcGxheVN5c3RlbSh1aW50KGtlY2NhazI1Nihtc2cuc2VuZGVyLGJsb2NrLm51bWJlcikpLCBhZGRyZXNzKDApKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUGxheSBpbiBsb3R0ZXJ5IHdpdGggcmFuZG9tIG51bWJlcnMKICAgICAqIEBwYXJhbSBfcGFydG5lciBBZmZpbGlhdGUgcGFydG5lcgogICAgICovCiAgICBmdW5jdGlvbiBwbGF5UmFuZG9tKGFkZHJlc3MgX3BhcnRuZXIpIHBheWFibGUgcHVibGljIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gcGxheVN5c3RlbSh1aW50KGtlY2NhazI1Nihtc2cuc2VuZGVyLGJsb2NrLm51bWJlcikpLCBfcGFydG5lcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFBsYXkgaW4gbG90dGVyeSB3aXRoIG93biBudW1iZXJzCiAgICAgKiBAcGFyYW0gX3BhcnRuZXIgQWZmaWxpYXRlIHBhcnRuZXIKICAgICAqLwogICAgZnVuY3Rpb24gcGxheVN5c3RlbSh1aW50IF9oYXNoLCBhZGRyZXNzIF9wYXJ0bmVyKSBwYXlhYmxlIHB1YmxpYyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgd29uKCk7IC8vIGNoZWNrIGlmIHBsYXllciBkaWQgbm90IHdpbiAKICAgICAgICB1aW50MjQgYmV0aGFzaCA9IHVpbnQyNChfaGFzaCk7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPD0gMSBldGhlciAmJiBtc2cudmFsdWUgPCBoYXNoQmV0TWF4KTsKICAgICAgICBpZihtc2cudmFsdWUgPiAwKXsKICAgICAgICAgICAgaWYoaW52ZXN0U3RhcnQ9PTApIHsgLy8gZGl2aWRlbmRzIG9ubHkgYWZ0ZXIgaW52ZXN0bWVudCBmaW5pc2hlZAogICAgICAgICAgICAgICAgZGl2aWRlbmRzW2RpdmlkZW5kUGVyaW9kXSArPSBtc2cudmFsdWUgLyAyMDsgLy8gNSUgZGl2aWRlbmQKICAgICAgICAgICAgfQogICAgICAgICAgICBpZihfcGFydG5lciAhPSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgICAgICB1aW50IGZlZSA9IG1zZy52YWx1ZSAvIDEwMDsKICAgICAgICAgICAgICAgIHdhbGxldEJhbGFuY2UgKz0gZmVlOwogICAgICAgICAgICAgICAgd2FsbGV0c1tfcGFydG5lcl0uYmFsYW5jZSArPSB1aW50MjA4KGZlZSk7IC8vIDElIGZvciBhZmZpbGlhdGVzCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoaGFzaE5leHQgPCBibG9jay5udW1iZXIgKyAzKSB7CiAgICAgICAgICAgICAgICBoYXNoTmV4dCA9IGJsb2NrLm51bWJlciArIDM7CiAgICAgICAgICAgICAgICBoYXNoQmV0U3VtID0gbXNnLnZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2V7CiAgICAgICAgICAgICAgICBpZihoYXNoQmV0U3VtID4gaGFzaEJldE1heCkgewogICAgICAgICAgICAgICAgICAgIGhhc2hOZXh0Kys7CiAgICAgICAgICAgICAgICAgICAgaGFzaEJldFN1bSA9IG1zZy52YWx1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2V7CiAgICAgICAgICAgICAgICAgICAgaGFzaEJldFN1bSArPSBtc2cudmFsdWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYmV0c1ttc2cuc2VuZGVyXSA9IEJldCh7dmFsdWU6IHVpbnQxOTIobXNnLnZhbHVlKSwgYmV0SGFzaDogdWludDMyKGJldGhhc2gpLCBibG9ja051bTogdWludDMyKGhhc2hOZXh0KX0pOwogICAgICAgICAgICBMb2dCZXQobXNnLnNlbmRlcix1aW50KGJldGhhc2gpLGhhc2hOZXh0LG1zZy52YWx1ZSk7CiAgICAgICAgfQogICAgICAgIHB1dEhhc2hlcygyNSk7IC8vIHBsYXllcnMgaGVscCBjb2xsZWNpbmcgZGF0YSwgbm93IG11Y2ggbW9yZSB0aGFuIGluIGxhc3QgY29udHJhY3QKICAgICAgICByZXR1cm4oaGFzaE5leHQpOwogICAgfQoKLyogZGF0YWJhc2UgZnVuY3Rpb25zICovCgogICAgLyoqCiAgICAgKiBAZGV2IENyZWF0ZSBoYXNoIGRhdGEgc3dhcCBzcGFjZQogICAgICogQHBhcmFtIF9zYWRkIE51bWJlciBvZiBoYXNoZXMgdG8gYWRkICg8PTI1NikKICAgICAqLwogICAgZnVuY3Rpb24gYWRkSGFzaGVzKHVpbnQgX3NhZGQpIHB1YmxpYyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmVxdWlyZShoYXNoRmlyc3QgPT0gMCAmJiBfc2FkZCA+IDAgJiYgX3NhZGQgPD0gaGFzaGVzU2l6ZSk7CiAgICAgICAgdWludCBuID0gaGFzaGVzLmxlbmd0aDsKICAgICAgICBpZihuICsgX3NhZGQgPiBoYXNoZXNTaXplKXsKICAgICAgICAgICAgaGFzaGVzLmxlbmd0aCA9IGhhc2hlc1NpemU7CiAgICAgICAgfQogICAgICAgIGVsc2V7CiAgICAgICAgICAgIGhhc2hlcy5sZW5ndGggKz0gX3NhZGQ7CiAgICAgICAgfQogICAgICAgIGZvcig7bjxoYXNoZXMubGVuZ3RoO24rKyl7IC8vIG1ha2Ugc3VyZSB0byBidXJuIGdhcwogICAgICAgICAgICBoYXNoZXNbbl0gPSAweEZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY7CiAgICAgICAgfQogICAgICAgIGlmKGhhc2hlcy5sZW5ndGg+PWhhc2hlc1NpemUpIHsgLy8gYXNzdW1lIGJsb2NrLm51bWJlciA+IDEwCiAgICAgICAgICAgIGhhc2hGaXJzdCA9IGJsb2NrLm51bWJlciAtICggYmxvY2subnVtYmVyICUgMTApOwogICAgICAgICAgICBoYXNoTGFzdCA9IGhhc2hGaXJzdDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuKGhhc2hlcy5sZW5ndGgpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBDcmVhdGUgaGFzaCBkYXRhIHN3YXAgc3BhY2UsIGFkZCAxMjggaGFzaGVzCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFkZEhhc2hlczEyOCgpIGV4dGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4oYWRkSGFzaGVzKDEyOCkpOwogICAgfQoKICAgIGZ1bmN0aW9uIGNhbGNIYXNoZXModWludDMyIF9sYXN0YiwgdWludDMyIF9kZWx0YSkgY29uc3RhbnQgcHJpdmF0ZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgLy8gYXNzZXJ0KCEoX2xhc3RiICUgMTApKTsgdGhpcyBpcyByZXF1aXJlZAogICAgICAgIHJldHVybiggKCB1aW50KGJsb2NrLmJsb2NraGFzaChfbGFzdGIgICkpICYgMHhGRkZGRkYgKQogICAgICAgICAgICB8ICggKCB1aW50KGJsb2NrLmJsb2NraGFzaChfbGFzdGIrMSkpICYgMHhGRkZGRkYgKSA8PCAyNCApCiAgICAgICAgICAgIHwgKCAoIHVpbnQoYmxvY2suYmxvY2toYXNoKF9sYXN0YisyKSkgJiAweEZGRkZGRiApIDw8IDQ4ICkKICAgICAgICAgICAgfCAoICggdWludChibG9jay5ibG9ja2hhc2goX2xhc3RiKzMpKSAmIDB4RkZGRkZGICkgPDwgNzIgKQogICAgICAgICAgICB8ICggKCB1aW50KGJsb2NrLmJsb2NraGFzaChfbGFzdGIrNCkpICYgMHhGRkZGRkYgKSA8PCA5NiApCiAgICAgICAgICAgIHwgKCAoIHVpbnQoYmxvY2suYmxvY2toYXNoKF9sYXN0Yis1KSkgJiAweEZGRkZGRiApIDw8IDEyMCApCiAgICAgICAgICAgIHwgKCAoIHVpbnQoYmxvY2suYmxvY2toYXNoKF9sYXN0Yis2KSkgJiAweEZGRkZGRiApIDw8IDE0NCApCiAgICAgICAgICAgIHwgKCAoIHVpbnQoYmxvY2suYmxvY2toYXNoKF9sYXN0Yis3KSkgJiAweEZGRkZGRiApIDw8IDE2OCApCiAgICAgICAgICAgIHwgKCAoIHVpbnQoYmxvY2suYmxvY2toYXNoKF9sYXN0Yis4KSkgJiAweEZGRkZGRiApIDw8IDE5MiApCiAgICAgICAgICAgIHwgKCAoIHVpbnQoYmxvY2suYmxvY2toYXNoKF9sYXN0Yis5KSkgJiAweEZGRkZGRiApIDw8IDIxNiApCiAgICAgICAgICAgIHwgKCAoIHVpbnQoX2RlbHRhKSAvIGhhc2hlc1NpemUpIDw8IDI0MCkpOyAKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRIYXNoKHVpbnQgX2Jsb2NrKSBjb25zdGFudCBwcml2YXRlIHJldHVybnMgKHVpbnQzMikgewogICAgICAgIHVpbnQgZGVsdGEgPSAoX2Jsb2NrIC0gaGFzaEZpcnN0KSAvIDEwOwogICAgICAgIHVpbnQgaGFzaCA9IGhhc2hlc1tkZWx0YSAlIGhhc2hlc1NpemVdOwogICAgICAgIGlmKGRlbHRhIC8gaGFzaGVzU2l6ZSAhPSBoYXNoID4+IDI0MCkgewogICAgICAgICAgICByZXR1cm4oMHgxMDAwMDAwKTsgLy8gbG9hZCBmYWlsZWQsIGluY29ycmVjdCBkYXRhIGluIGhhc2hlcwogICAgICAgIH0KICAgICAgICB1aW50IHNsb3RwID0gKF9ibG9jayAtIGhhc2hGaXJzdCkgJSAxMDsgCiAgICAgICAgcmV0dXJuKHVpbnQzMigoaGFzaCA+PiAoMjQgKiBzbG90cCkpICYgMHhGRkZGRkYpKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBAZGV2IEZpbGwgaGFzaCBkYXRhCiAgICAgKi8KICAgIGZ1bmN0aW9uIHB1dEhhc2goKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHVpbnQgbGFzdGIgPSBoYXNoTGFzdDsKICAgICAgICBpZihsYXN0YiA9PSAwIHx8IGJsb2NrLm51bWJlciA8PSBsYXN0YiArIDEwKSB7CiAgICAgICAgICAgIHJldHVybihmYWxzZSk7CiAgICAgICAgfQogICAgICAgIGlmKGxhc3RiIDwgYmxvY2subnVtYmVyIC0gMjQ1KSB7CiAgICAgICAgICAgIHVpbnQgbnVtID0gYmxvY2subnVtYmVyIC0gMjQ1OwogICAgICAgICAgICBsYXN0YiA9IG51bSAtIChudW0gJSAxMCk7CiAgICAgICAgfQogICAgICAgIHVpbnQgZGVsdGEgPSAobGFzdGIgLSBoYXNoRmlyc3QpIC8gMTA7CiAgICAgICAgaGFzaGVzW2RlbHRhICUgaGFzaGVzU2l6ZV0gPSBjYWxjSGFzaGVzKHVpbnQzMihsYXN0YiksdWludDMyKGRlbHRhKSk7CiAgICAgICAgaGFzaExhc3QgPSBsYXN0YiArIDEwOwogICAgICAgIHJldHVybih0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgRmlsbCBoYXNoIGRhdGEgbWFueSB0aW1lcwogICAgICogQHBhcmFtIF9udW0gTnVtYmVyIG9mIGl0ZXJhdGlvbnMKICAgICAqLwogICAgZnVuY3Rpb24gcHV0SGFzaGVzKHVpbnQgX251bSkgcHVibGljIHsKICAgICAgICB1aW50IG49MDsKICAgICAgICBmb3IoO248X251bTtuKyspewogICAgICAgICAgICBpZighcHV0SGFzaCgpKXsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIAp9'.
	

]
