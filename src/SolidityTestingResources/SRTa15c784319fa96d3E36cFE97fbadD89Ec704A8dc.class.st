Class {
	#name : #SRTa15c784319fa96d3E36cFE97fbadD89Ec704A8dc,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTa15c784319fa96d3E36cFE97fbadD89Ec704A8dc >> base64 [
	^ 'LyoKZmlsZTogICBCYXNlLnNvbAp2ZXI6ICAgIDAuMi4xCnVwZGF0ZWQ6MTgtTm92LTIwMTYKYXV0aG9yOiBEYXJyeWwgTW9ycmlzIChvMHJhZ21hbjBvKQplbWFpbDogIG8wcmFnbWFuMG8gQVQgZ21haWwuY29tCgpBbiBiYXNpYyBjb250cmFjdCBmdXJuaXNoaW5nIGluaGVyaXRpbmcgY29udHJhY3RzIHdpdGggb3duZXJzaGlwLCByZWVudHJ5CnByb3RlY3Rpb24gYW5kIHNhZmUgc2VuZGluZyBmdW5jdGlvbnMuCgpUaGlzIHNvZnR3YXJlIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCmJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCk1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUKR05VIGxlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCjxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KKi8KCnByYWdtYSBzb2xpZGl0eSBeMC40LjA7Cgpjb250cmFjdCBCYXNlCnsKLyogQ29uc3RhbnRzICovCgogICAgc3RyaW5nIGNvbnN0YW50IFZFUlNJT04gPSAiQmFzZSAwLjEuMSBcbiI7CgovKiBTdGF0ZSBWYXJpYWJsZXMgKi8KCiAgICBib29sIG11dGV4OwogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgovKiBFdmVudHMgKi8KCiAgICBldmVudCBMb2coc3RyaW5nIG1lc3NhZ2UpOwogICAgZXZlbnQgQ2hhbmdlZE93bmVyKGFkZHJlc3MgaW5kZXhlZCBvbGRPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCi8qIE1vZGlmaWVycyAqLwoKICAgIC8vIFRvIHRocm93IGNhbGwgbm90IG1hZGUgYnkgb3duZXIKICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBvd25lcikgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyBUaGlzIG1vZGlmaWVyIGNhbiBiZSB1c2VkIG9uIGZ1bmN0aW9ucyB3aXRoIGV4dGVybmFsIGNhbGxzIHRvCiAgICAvLyBwcmV2ZW50IHJlZW50cnkgYXR0YWNrcy4KICAgIC8vIENvbnN0cmFpbnRzOgogICAgLy8gICBQcm90ZWN0ZWQgZnVuY3Rpb25zIG11c3QgaGF2ZSBvbmx5IG9uZSBwb2ludCBvZiBleGl0LgogICAgLy8gICBQcm90ZWN0ZWQgZnVuY3Rpb25zIGNhbm5vdCB1c2UgdGhlIGByZXR1cm5gIGtleXdvcmQKICAgIC8vICAgUHJvdGVjdGVkIGZ1bmN0aW9ucyByZXR1cm4gdmFsdWVzIG11c3QgYmUgdGhyb3VnaCByZXR1cm4gcGFyYW1ldGVycy4KICAgIG1vZGlmaWVyIHByZXZlbnRSZWVudHJ5KCkgewogICAgICAgIGlmIChtdXRleCkgdGhyb3c7CiAgICAgICAgZWxzZSBtdXRleCA9IHRydWU7CiAgICAgICAgXzsKICAgICAgICBkZWxldGUgbXV0ZXg7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIFRoaXMgbW9kaWZpZXIgY2FuIGJlIGFwcGxpZWQgdG8gcHVsaWMgYWNjZXNzIHN0YXRlIG11dGF0aW9uIGZ1bmN0aW9ucwogICAgLy8gdG8gcHJvdGVjdCBhZ2FpbnN0IHJlZW50cnkgaWYgYSBgbXV0ZXh0UHJvdGVjdGAgZnVuY3Rpb24gaXMgYWxyZWFkeQogICAgLy8gb24gdGhlIGNhbGwgc3RhY2suCiAgICBtb2RpZmllciBub1JlZW50cnkoKSB7CiAgICAgICAgaWYgKG11dGV4KSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIC8vIFNhbWUgYXMgbm9SZWVudHJ5KCkgYnV0IGludGVuZGVkIHRvIGJlIG92ZXJsb2FkZWQKICAgIG1vZGlmaWVyIGNhbkVudGVyKCkgewogICAgICAgIGlmIChtdXRleCkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KICAgIAovKiBGdW5jdGlvbnMgKi8KCiAgICBmdW5jdGlvbiBCYXNlKCkgeyBvd25lciA9IG1zZy5zZW5kZXI7IH0KCiAgICBmdW5jdGlvbiB2ZXJzaW9uKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBWRVJTSU9OOwogICAgfQoKICAgIGZ1bmN0aW9uIGNvbnRyYWN0QmFsYW5jZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXR1cm4gdGhpcy5iYWxhbmNlOwogICAgfQoKICAgIC8vIENoYW5nZSB0aGUgb3duZXIgb2YgYSBjb250cmFjdAogICAgZnVuY3Rpb24gY2hhbmdlT3duZXIoYWRkcmVzcyBfbmV3T3duZXIpCiAgICAgICAgcHVibGljIG9ubHlPd25lciByZXR1cm5zIChib29sKQogICAgewogICAgICAgIG93bmVyID0gX25ld093bmVyOwogICAgICAgIENoYW5nZWRPd25lcihtc2cuc2VuZGVyLCBvd25lcik7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHNhZmVTZW5kKGFkZHJlc3MgX3JlY2lwaWVudCwgdWludCBfZXRoZXIpCiAgICAgICAgaW50ZXJuYWwKICAgICAgICBwcmV2ZW50UmVlbnRyeSgpCiAgICAgICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzXykKICAgIHsKICAgICAgICBpZighX3JlY2lwaWVudC5jYWxsLnZhbHVlKF9ldGhlcikoKSkgdGhyb3c7CiAgICAgICAgc3VjY2Vzc18gPSB0cnVlOwogICAgfQp9CgovKiBFbmQgb2YgQmFzZSAqLwoKLyoKZmlsZTogICBNYXRoLnNvbAp2ZXI6ICAgIDAuMi4wCnVwZGF0ZWQ6MTgtTm92LTIwMTYKYXV0aG9yOiBEYXJyeWwgTW9ycmlzCmVtYWlsOiAgbzByYWdtYW4wbyBBVCBnbWFpbC5jb20KCkFuIGluaGVyaXRhYmxlIGNvbnRyYWN0IGNvbnRhaW5pbmcgbWF0aCBmdW5jdGlvbnMgYW5kIGNvbXBhcml0b3JzLgoKVGhpcyBzb2Z0d2FyZSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLApidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgpNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCkdOVSBsZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgo8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uCiovCgpwcmFnbWEgc29saWRpdHkgXjAuNC4wOwoKY29udHJhY3QgTWF0aAp7CgovKiBDb25zdGFudHMgKi8KCiAgICBzdHJpbmcgY29uc3RhbnQgVkVSU0lPTiA9ICJNYXRoIDAuMC4xIFxuIjsKICAgIHVpbnQgY29uc3RhbnQgTlVMTCA9IDA7CiAgICBib29sIGNvbnN0YW50IExUID0gZmFsc2U7CiAgICBib29sIGNvbnN0YW50IEdUID0gdHJ1ZTsKICAgIC8vIE5vIHR5cGUgYm9vbCA8LT4gaW50IHR5cGUgY29udmVyc3Rpb24gaW4gc29saWRpdHkgOn4oCiAgICB1aW50IGNvbnN0YW50IGlUUlVFID0gMTsKICAgIHVpbnQgY29uc3RhbnQgaUZBTFNFID0gMDsKICAgIHVpbnQgY29uc3RhbnQgaVBPUyA9IDE7CiAgICB1aW50IGNvbnN0YW50IGlaRVJPID0gMDsKICAgIHVpbnQgY29uc3RhbnQgaU5FRyA9IHVpbnQoLTEpOwoKCi8qIE1vZGlmaWVycyAqLwoKLyogRnVuY3Rpb25zICovCiAgICBmdW5jdGlvbiB2ZXJzaW9uKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHN0cmluZykKICAgIHsKICAgICAgICByZXR1cm4gVkVSU0lPTjsKICAgIH0KCiAgICBmdW5jdGlvbiBhc3NlcnQoYm9vbCBhc3NlcnRpb24pIGludGVybmFsIGNvbnN0YW50CiAgICB7CiAgICAgIGlmICghYXNzZXJ0aW9uKSB0aHJvdzsKICAgIH0KICAgIAogICAgLy8gQGRldiBQYXJhbWV0cmljIGNvbXBhcml0b3IgZm9yID4gb3IgPAogICAgLy8gIV9zeW0gcmV0dXJucyBhIDwgYgogICAgLy8gX3N5bSAgcmV0dXJucyBhID4gYgogICAgZnVuY3Rpb24gY21wICh1aW50IGEsIHVpbnQgYiwgYm9vbCBfc3ltKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJldHVybiAoYSE9YikgJiYgKChhIDwgYikgIT0gX3N5bSk7CiAgICB9CgogICAgLy8vIEBkZXYgUGFyYW1ldHJpYyBjb21wYXJpdG9yIGZvciA+PSBvciA8PQogICAgLy8vICFfc3ltIHJldHVybnMgYSA8PSBiCiAgICAvLy8gX3N5bSAgcmV0dXJucyBhID49IGIKICAgIGZ1bmN0aW9uIGNtcEVxICh1aW50IGEsIHVpbnQgYiwgYm9vbCBfc3ltKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJldHVybiAoYT09YikgfHwgKChhIDwgYikgIT0gX3N5bSk7CiAgICB9CiAgICAKICAgIC8vLyBUcmljaG90b21vdXMgY29tcGFyaXRvcgogICAgLy8vIGEgPCBiIHJldHVybnMgLTEKICAgIC8vLyBhID09IGIgcmV0dXJucyAwCiAgICAvLy8gYSA+IGIgcmV0dXJucyAxCi8qICAgIGZ1bmN0aW9uIHRyaUNtcCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICB1aW50IGMgPSBhIC0gYjsKICAgICAgICByZXR1cm4gYyAmIGMgJiAoMCAtIDEpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBuU2lnbih1aW50IGEpIGludGVybmFsIHJldHVybnMgKHVpbnQpCiAgICB7CiAgICAgICAgcmV0dXJuIGEgJiAyXjI1NTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gbmVnKHVpbnQgYSkgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiAwIC0gYTsKICAgIH0KKi8gICAgCiAgICBmdW5jdGlvbiBzYWZlTXVsKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50KQogICAgewogICAgICB1aW50IGMgPSBhICogYjsKICAgICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgICAgcmV0dXJuIGM7CiAgICB9CgogICAgZnVuY3Rpb24gc2FmZVN1Yih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludCkKICAgIHsKICAgICAgYXNzZXJ0KGIgPD0gYSk7CiAgICAgIHJldHVybiBhIC0gYjsKICAgIH0KCiAgICBmdW5jdGlvbiBzYWZlQWRkKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50KQogICAgewogICAgICB1aW50IGMgPSBhICsgYjsKICAgICAgYXNzZXJ0KGM+PWEgJiYgYz49Yik7CiAgICAgIHJldHVybiBjOwogICAgfQp9CgovKiBFbmQgb2YgTWF0aCAqLwoKCi8qCmZpbGU6ICAgRVJDMjAuc29sCnZlcjogICAgMC4yLjMKdXBkYXRlZDoxOC1Ob3YtMjAxNgphdXRob3I6IERhcnJ5bCBNb3JyaXMKZW1haWw6ICBvMHJhZ21hbjBvIEFUIGdtYWlsLmNvbQoKQW4gRVJDMjAgY29tcGxpYW50IHRva2VuLgoKVGhpcyBzb2Z0d2FyZSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLApidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgpNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCkdOVSBsZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgo8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uCiovCgovL3ByYWdtYSBzb2xpZGl0eSBeMC40LjA7CgovL2ltcG9ydCAiTWF0aC5zb2wiOwovL2ltcG9ydCAiQmFzZS5zb2wiOwoKLy8gRVJDMjAgU3RhbmRhcmQgVG9rZW4gSW50ZXJmYWNlIHdpdGggc2FmZSBtYXRocyBhbmQgcmVlbnRyeSBwcm90ZWN0aW9uCmNvbnRyYWN0IEVSQzIwSW50ZXJmYWNlCnsKLyogU3RydWN0cyAqLwoKLyogQ29uc3RhbnRzICovCiAgICBzdHJpbmcgY29uc3RhbnQgVkVSU0lPTiA9ICJFUkMyMCAwLjIuMy1vMHJhZ21hbjBvXG5NYXRoIDAuMC4xXG5CYXNlIDAuMS4xXG4iOwoKLyogU3RhdGUgVmFsaWFibGVzICovCiAgICB1aW50IHB1YmxpYyB0b3RhbFN1cHBseTsKICAgIHVpbnQ4IHB1YmxpYyBkZWNpbWFsUGxhY2VzOwogICAgc3RyaW5nIHB1YmxpYyBuYW1lOwogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7CiAgICAKICAgIC8vIFRva2VuIG93bmVyc2hpcCBtYXBwaW5nCiAgICAvLyBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyBiYWxhbmNlT2Y7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIGJhbGFuY2U7CiAgICAKICAgIC8vIFRyYW5zZmVyIGFsbG93YW5jZXMgbWFwcGluZwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpKSBwdWJsaWMgYWxsb3dhbmNlOwoKLyogRXZlbnRzICovCiAgICAvLyBUcmlnZ2VyZWQgd2hlbiB0b2tlbnMgYXJlIHRyYW5zZmVycmVkLgogICAgZXZlbnQgVHJhbnNmZXIoCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIF9mcm9tLAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBfdG8sCiAgICAgICAgdWludDI1NiBfdmFsdWUpOwoKICAgIC8vIFRyaWdnZXJlZCB3aGVuZXZlciBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBpcyBjYWxsZWQuCiAgICBldmVudCBBcHByb3ZhbCgKICAgICAgICBhZGRyZXNzIGluZGV4ZWQgX293bmVyLAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwKICAgICAgICB1aW50MjU2IF92YWx1ZSk7CgovKiBNb2RpZmllcnMgKi8KCi8qIEZ1bmN0aW9uIEFic3RyYWN0cyAqLwoKICAgIC8qIFN0YXRlIHZhcmlhYmxlIEFjY2Vzc29yIEZ1bmN0aW9ucyAoZm9yIHJlZmVyZW5jZSAtIGxlYXZlIGNvbW1lbnRlZCkgKi8KCiAgICAvLyBSZXR1cm5zIHRoZSBhbGxvd2FibGUgdHJhbnNmZXIgb2YgdG9rZW5zIGJ5IGEgcHJveHkKICAgIC8vIGZ1bmN0aW9uIGFsbG93YW5jZSAoYWRkcmVzcyB0b2tlbkhvbGRlcnMsIGFkZHJlc3MgcHJveHksIHVpbnQgYWxsb3dhbmNlKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCk7CgogICAgLy8gR2V0IHRoZSB0b3RhbCB0b2tlbiBzdXBwbHkKICAgIC8vIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwoKICAgIC8vIFJldHVybnMgdG9rZW4gc3ltYm9sCiAgICAvLyBmdW5jdGlvbiBzeW1ib2woKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhzdHJpbmcpOwoKICAgIC8vIFJldHVybnMgdG9rZW4gc3ltYm9sCiAgICAvLyBmdW5jdGlvbiBuYW1lKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoc3RyaW5nKTsKCiAgICAvLyBSZXR1cm5zIGRlY2ltYWwgcGxhY2VzIGRlc2lnbmF0ZWQgZm9yIHVuaXQgb2YgdG9rZW4uCiAgICAvLyBmdW5jdGlvbiBkZWNpbWFsUGxhY2VzKCkgcHVibGljIHJldHVybnModWludCk7CgogICAgLy8gU2VuZCBfdmFsdWUgYW1vdW50IG9mIHRva2VucyB0byBhZGRyZXNzIF90bwogICAgLy8gZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvLyBTZW5kIF92YWx1ZSBhbW91bnQgb2YgdG9rZW5zIGZyb20gYWRkcmVzcyBfZnJvbSB0byBhZGRyZXNzIF90bwogICAgLy8gZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLy8gQWxsb3cgX3NwZW5kZXIgdG8gd2l0aGRyYXcgZnJvbSB5b3VyIGFjY291bnQsIG11bHRpcGxlIHRpbWVzLCB1cCB0byB0aGUKICAgIC8vIF92YWx1ZSBhbW91bnQuCiAgICAvLyBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKfQoKY29udHJhY3QgRVJDMjBUb2tlbiBpcyBCYXNlLCBNYXRoLCBFUkMyMEludGVyZmFjZQp7CgovKiBFdmVudHMgKi8KCi8qIFN0cnVjdHMgKi8KCi8qIENvbnN0YW50cyAqLwoKLyogU3RhdGUgVmFsaWFibGVzICovCgovKiBNb2RpZmllcnMgKi8KCiAgICBtb2RpZmllciBpc0F2YWlsYWJsZSh1aW50IF9hbW91bnQpIHsKICAgICAgICBpZiAoX2Ftb3VudCA+IGJhbGFuY2VbbXNnLnNlbmRlcl0pIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgaXNBbGxvd2VkKGFkZHJlc3MgX2Zyb20sIHVpbnQgX2Ftb3VudCkgewogICAgICAgIGlmIChfYW1vdW50ID4gYWxsb3dhbmNlW19mcm9tXVttc2cuc2VuZGVyXSB8fAogICAgICAgICAgIF9hbW91bnQgPiBiYWxhbmNlW19mcm9tXSkgdGhyb3c7CiAgICAgICAgXzsgICAgICAgIAogICAgfQoKLyogRnVudGlvbnMgUHVibGljICovCgogICAgZnVuY3Rpb24gRVJDMjBUb2tlbigKICAgICAgICB1aW50IF9zdXBwbHksCiAgICAgICAgdWludDggX2RlY2ltYWxQbGFjZXMsCiAgICAgICAgc3RyaW5nIF9zeW1ib2wsCiAgICAgICAgc3RyaW5nIF9uYW1lKQogICAgewogICAgICAgIHRvdGFsU3VwcGx5ID0gX3N1cHBseTsKICAgICAgICBkZWNpbWFsUGxhY2VzID0gX2RlY2ltYWxQbGFjZXM7CiAgICAgICAgc3ltYm9sID0gX3N5bWJvbDsKICAgICAgICBuYW1lID0gX25hbWU7CiAgICAgICAgYmFsYW5jZVttc2cuc2VuZGVyXSA9IHRvdGFsU3VwcGx5OwogICAgfQogICAgCiAgICBmdW5jdGlvbiB2ZXJzaW9uKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIFZFUlNJT047CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9hZGRyKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCkKICAgIHsKICAgICAgICByZXR1cm4gYmFsYW5jZVtfYWRkcl07CiAgICB9CgogICAgLy8gU2VuZCBfdmFsdWUgYW1vdW50IG9mIHRva2VucyB0byBhZGRyZXNzIF90bwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgY2FuRW50ZXIKICAgICAgICBpc0F2YWlsYWJsZShfdmFsdWUpCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBiYWxhbmNlW21zZy5zZW5kZXJdID0gc2FmZVN1YihiYWxhbmNlW21zZy5zZW5kZXJdLCBfdmFsdWUpOwogICAgICAgIGJhbGFuY2VbX3RvXSA9IHNhZmVBZGQoYmFsYW5jZVtfdG9dLCBfdmFsdWUpOwogICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLyBTZW5kIF92YWx1ZSBhbW91bnQgb2YgdG9rZW5zIGZyb20gYWRkcmVzcyBfZnJvbSB0byBhZGRyZXNzIF90bwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkKICAgICAgICBleHRlcm5hbAogICAgICAgIGNhbkVudGVyCiAgICAgICAgaXNBbGxvd2VkKF9mcm9tLCBfdmFsdWUpCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBiYWxhbmNlW19mcm9tXSA9IHNhZmVTdWIoYmFsYW5jZVtfZnJvbV0sIF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZVtfdG9dID0gc2FmZUFkZChiYWxhbmNlW190b10sIF92YWx1ZSk7CiAgICAgICAgYWxsb3dhbmNlW19mcm9tXVttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYWxsb3dhbmNlW19mcm9tXVttc2cuc2VuZGVyXSwgX3ZhbHVlKTsKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gQWxsb3cgX3NwZW5kZXIgdG8gd2l0aGRyYXcgZnJvbSB5b3VyIGFjY291bnQsIG11bHRpcGxlIHRpbWVzLCB1cCB0byB0aGUKICAgIC8vIF92YWx1ZSBhbW91bnQuIElmIHRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIGFnYWluIGl0IG92ZXJ3cml0ZXMgdGhlIGN1cnJlbnQKICAgIC8vIGFsbG93YW5jZSB3aXRoIF92YWx1ZS4KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBjYW5FbnRlcgogICAgICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykKICAgIHsKICAgICAgICBpZiAoYmFsYW5jZVttc2cuc2VuZGVyXSA9PSAwKSB0aHJvdzsKICAgICAgICBhbGxvd2FuY2VbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQp9CgovKiBFbmQgb2YgRVJDMjAgKi8KCgovKgpmaWxlOiAgIExpYkNMTC5zb2wKdmVyOiAgICAwLjMuMQp1cGRhdGVkOjIxLVNlcC0yMDE2CmF1dGhvcjogRGFycnlsIE1vcnJpcwplbWFpbDogIG8wcmFnbWFuMG8gQVQgZ21haWwuY29tCgpBIFNvbGlkaXR5IGxpYnJhcnkgZm9yIGltcGxlbWVudGluZyBhIGRhdGEgaW5kZXhpbmcgcmVnaW1lIHVzaW5nCmEgY2lyY3VsYXIgbGlua2VkIGxpc3QuCgpUaGlzIGxpYnJhcnkgcHJvdmlzaW9ucyBsb29rdXAsIG5hdmlnYXRpb24gYW5kIGtleS9pbmRleCBzdG9yYWdlCmZ1bmN0aW9uYWxpdHkgd2hpY2ggY2FuIGJlIHVzZWQgaW4gY29uanVuY3Rpb24gd2l0aCBhbiBhcnJheSBvciBtYXBwaW5nLgoKTk9USUNFOiBUaGlzIGxpYnJhcnkgdXNlcyBpbnRlcm5hbCBmdW5jdGlvbnMgb25seSBhbmQgc28gY2Fubm90IGJlIGNvbXBpbGVkCmFuZCBkZXBsb3llZCBpbmRlcGVuZGVudGx5IGZyb20gaXRzIGNhbGxpbmcgY29udHJhY3QuCgpUaGlzIGxpYnJhcnkgaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQpHTlUgbGVzc2VyIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LgoqLwoKLy9wcmFnbWEgc29saWRpdHkgXjAuNC4wOwoKLy8gTGliQ0xMIHVzaW5nIGB1aW50YCBrZXlzCmxpYnJhcnkgTGliQ0xMdSB7CgogICAgc3RyaW5nIGNvbnN0YW50IFZFUlNJT04gPSAiTGliQ0xMdSAwLjMuMSI7CiAgICB1aW50IGNvbnN0YW50IE5VTEwgPSAwOwogICAgdWludCBjb25zdGFudCBIRUFEID0gTlVMTDsKICAgIGJvb2wgY29uc3RhbnQgUFJFViA9IGZhbHNlOwogICAgYm9vbCBjb25zdGFudCBORVhUID0gdHJ1ZTsKICAgIAogICAgc3RydWN0IENMTHsKICAgICAgICBtYXBwaW5nICh1aW50ID0+IG1hcHBpbmcgKGJvb2wgPT4gdWludCkpIGNsbDsKICAgIH0KCiAgICAvLyBuOiBub2RlIGlkICBkOiBkaXJlY3Rpb24gIHI6IHJldHVybiBub2RlIGlkCgogICAgZnVuY3Rpb24gdmVyc2lvbigpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBWRVJTSU9OOwogICAgfQoKICAgIC8vIFJldHVybiBleGlzdGVudGlhbCBzdGF0ZSBvZiBhIGxpc3QuCiAgICBmdW5jdGlvbiBleGlzdHMoQ0xMIHN0b3JhZ2Ugc2VsZikKICAgICAgICBpbnRlcm5hbAogICAgICAgIGNvbnN0YW50IHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgaWYgKHNlbGYuY2xsW0hFQURdW1BSRVZdICE9IEhFQUQgfHwgc2VsZi5jbGxbSEVBRF1bTkVYVF0gIT0gSEVBRCkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAKICAgIC8vIFJldHVybnMgdGhlIG51bWJlciBvZiBlbGVtZW50cyBpbiB0aGUgbGlzdAogICAgZnVuY3Rpb24gc2l6ZU9mKENMTCBzdG9yYWdlIHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcikgewogICAgICAgIHVpbnQgaSA9IHN0ZXAoc2VsZiwgSEVBRCwgTkVYVCk7CiAgICAgICAgd2hpbGUgKGkgIT0gSEVBRCkgewogICAgICAgICAgICBpID0gc3RlcChzZWxmLCBpLCBORVhUKTsKICAgICAgICAgICAgcisrOwogICAgICAgIH0KICAgICAgICByZXR1cm47CiAgICB9CgogICAgLy8gUmV0dXJucyB0aGUgbGlua3Mgb2YgYSBub2RlIGFzIGFuZCBhcnJheQogICAgZnVuY3Rpb24gZ2V0Tm9kZShDTEwgc3RvcmFnZSBzZWxmLCB1aW50IG4pCiAgICAgICAgaW50ZXJuYWwgIGNvbnN0YW50IHJldHVybnMgKHVpbnRbMl0pCiAgICB7CiAgICAgICAgcmV0dXJuIFtzZWxmLmNsbFtuXVtQUkVWXSwgc2VsZi5jbGxbbl1bTkVYVF1dOwogICAgfQoKICAgIC8vIFJldHVybnMgdGhlIGxpbmsgb2YgYSBub2RlIGBuYCBpbiBkaXJlY3Rpb24gYGRgLgogICAgZnVuY3Rpb24gc3RlcChDTEwgc3RvcmFnZSBzZWxmLCB1aW50IG4sIGJvb2wgZCkKICAgICAgICBpbnRlcm5hbCAgY29uc3RhbnQgcmV0dXJucyAodWludCkKICAgIHsKICAgICAgICByZXR1cm4gc2VsZi5jbGxbbl1bZF07CiAgICB9CgogICAgLy8gQ2FuIGJlIHVzZWQgYmVmb3JlIGBpbnNlcnRgIHRvIGJ1aWxkIGFuIG9yZGVyZWQgbGlzdAogICAgLy8gYGFgIGFuIGV4aXN0aW5nIG5vZGUgdG8gc2VhcmNoIGZyb20sIGUuZy4gSEVBRC4KICAgIC8vIGBiYCB2YWx1ZSB0byBzZWVrCiAgICAvLyBgcmAgZmlyc3Qgbm9kZSBiZXlvbmQgYGJgIGluIGRpcmVjdGlvbiBgZGAKICAgIGZ1bmN0aW9uIHNlZWsoQ0xMIHN0b3JhZ2Ugc2VsZiwgdWludCBhLCB1aW50IGIsIGJvb2wgZCkKICAgICAgICBpbnRlcm5hbCAgY29uc3RhbnQgcmV0dXJucyAodWludCByKQogICAgewogICAgICAgIHIgPSBzdGVwKHNlbGYsIGEsIGQpOwogICAgICAgIHdoaWxlICAoKGIhPXIpICYmICgoYiA8IHIpICE9IGQpKSByID0gc2VsZi5jbGxbcl1bZF07CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIENyZWF0ZXMgYSBiaWRpcmVjdGlvbmFsIGxpbmsgYmV0d2VlbiB0d28gbm9kZXMgb24gZGlyZWN0aW9uIGBkYAogICAgZnVuY3Rpb24gc3RpdGNoKENMTCBzdG9yYWdlIHNlbGYsIHVpbnQgYSwgdWludCBiLCBib29sIGQpIGludGVybmFsICB7CiAgICAgICAgc2VsZi5jbGxbYl1bIWRdID0gYTsKICAgICAgICBzZWxmLmNsbFthXVtkXSA9IGI7CiAgICB9CgogICAgLy8gSW5zZXJ0IG5vZGUgYGJgIGJlc2lkZSBhbmQgZXhpc3Rpbmcgbm9kZSBgYWAgaW4gZGlyZWN0aW9uIGBkYC4KICAgIGZ1bmN0aW9uIGluc2VydCAoQ0xMIHN0b3JhZ2Ugc2VsZiwgdWludCBhLCB1aW50IGIsIGJvb2wgZCkgaW50ZXJuYWwgIHsKICAgICAgICB1aW50IGMgPSBzZWxmLmNsbFthXVtkXTsKICAgICAgICBzdGl0Y2ggKHNlbGYsIGEsIGIsIGQpOwogICAgICAgIHN0aXRjaCAoc2VsZiwgYiwgYywgZCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHJlbW92ZShDTEwgc3RvcmFnZSBzZWxmLCB1aW50IG4pIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICBpZiAobiA9PSBOVUxMKSByZXR1cm47CiAgICAgICAgc3RpdGNoKHNlbGYsIHNlbGYuY2xsW25dW1BSRVZdLCBzZWxmLmNsbFtuXVtORVhUXSwgTkVYVCk7CiAgICAgICAgZGVsZXRlIHNlbGYuY2xsW25dW1BSRVZdOwogICAgICAgIGRlbGV0ZSBzZWxmLmNsbFtuXVtORVhUXTsKICAgICAgICByZXR1cm4gbjsKICAgIH0KCiAgICBmdW5jdGlvbiBwdXNoKENMTCBzdG9yYWdlIHNlbGYsIHVpbnQgbiwgYm9vbCBkKSBpbnRlcm5hbCAgewogICAgICAgIGluc2VydChzZWxmLCBIRUFELCBuLCBkKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gcG9wKENMTCBzdG9yYWdlIHNlbGYsIGJvb2wgZCkgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiByZW1vdmUoc2VsZiwgc3RlcChzZWxmLCBIRUFELCBkKSk7CiAgICB9Cn0KCi8vIExpYkNMTCB1c2luZyBgaW50YCBrZXlzCmxpYnJhcnkgTGliQ0xMaSB7CgogICAgc3RyaW5nIGNvbnN0YW50IFZFUlNJT04gPSAiTGliQ0xMaSAwLjMuMSI7CiAgICBpbnQgY29uc3RhbnQgTlVMTCA9IDA7CiAgICBpbnQgY29uc3RhbnQgSEVBRCA9IE5VTEw7CiAgICBib29sIGNvbnN0YW50IFBSRVYgPSBmYWxzZTsKICAgIGJvb2wgY29uc3RhbnQgTkVYVCA9IHRydWU7CiAgICAKICAgIHN0cnVjdCBDTEx7CiAgICAgICAgbWFwcGluZyAoaW50ID0+IG1hcHBpbmcgKGJvb2wgPT4gaW50KSkgY2xsOwogICAgfQoKICAgIC8vIG46IG5vZGUgaWQgIGQ6IGRpcmVjdGlvbiAgcjogcmV0dXJuIG5vZGUgaWQKCiAgICBmdW5jdGlvbiB2ZXJzaW9uKCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIFZFUlNJT047CiAgICB9CgogICAgLy8gUmV0dXJuIGV4aXN0ZW50aWFsIHN0YXRlIG9mIGEgbm9kZS4gbiA9PSBIRUFEIHJldHVybnMgbGlzdCBleGlzdGVuY2UuCiAgICBmdW5jdGlvbiBleGlzdHMoQ0xMIHN0b3JhZ2Ugc2VsZiwgaW50IG4pIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICBpZiAoc2VsZi5jbGxbSEVBRF1bUFJFVl0gIT0gSEVBRCB8fCBzZWxmLmNsbFtIRUFEXVtORVhUXSAhPSBIRUFEKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8vIFJldHVybnMgdGhlIG51bWJlciBvZiBlbGVtZW50cyBpbiB0aGUgbGlzdAogICAgZnVuY3Rpb24gc2l6ZU9mKENMTCBzdG9yYWdlIHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcikgewogICAgICAgIGludCBpID0gc3RlcChzZWxmLCBIRUFELCBORVhUKTsKICAgICAgICB3aGlsZSAoaSAhPSBIRUFEKSB7CiAgICAgICAgICAgIGkgPSBzdGVwKHNlbGYsIGksIE5FWFQpOwogICAgICAgICAgICByKys7CiAgICAgICAgfQogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBSZXR1cm5zIHRoZSBsaW5rcyBvZiBhIG5vZGUgYXMgYW5kIGFycmF5CiAgICBmdW5jdGlvbiBnZXROb2RlKENMTCBzdG9yYWdlIHNlbGYsIGludCBuKQogICAgICAgIGludGVybmFsICBjb25zdGFudCByZXR1cm5zIChpbnRbMl0pCiAgICB7CiAgICAgICAgcmV0dXJuIFtzZWxmLmNsbFtuXVtQUkVWXSwgc2VsZi5jbGxbbl1bTkVYVF1dOwogICAgfQoKICAgIC8vIFJldHVybnMgdGhlIGxpbmsgb2YgYSBub2RlIGBuYCBpbiBkaXJlY3Rpb24gYGRgLgogICAgZnVuY3Rpb24gc3RlcChDTEwgc3RvcmFnZSBzZWxmLCBpbnQgbiwgYm9vbCBkKQogICAgICAgIGludGVybmFsICBjb25zdGFudCByZXR1cm5zIChpbnQpCiAgICB7CiAgICAgICAgcmV0dXJuIHNlbGYuY2xsW25dW2RdOwogICAgfQoKICAgIC8vIENhbiBiZSB1c2VkIGJlZm9yZSBgaW5zZXJ0YCB0byBidWlsZCBhbiBvcmRlcmVkIGxpc3QKICAgIC8vIGBhYCBhbiBleGlzdGluZyBub2RlIHRvIHNlYXJjaCBmcm9tLCBlLmcuIEhFQUQuCiAgICAvLyBgYmAgdmFsdWUgdG8gc2VlawogICAgLy8gYHJgIGZpcnN0IG5vZGUgYmV5b25kIGBiYCBpbiBkaXJlY3Rpb24gYGRgCiAgICBmdW5jdGlvbiBzZWVrKENMTCBzdG9yYWdlIHNlbGYsIGludCBhLCBpbnQgYiwgYm9vbCBkKQogICAgICAgIGludGVybmFsICBjb25zdGFudCByZXR1cm5zIChpbnQgcikKICAgIHsKICAgICAgICByID0gc3RlcChzZWxmLCBhLCBkKTsKICAgICAgICB3aGlsZSAgKChiIT1yKSAmJiAoKGIgPCByKSAhPSBkKSkgciA9IHNlbGYuY2xsW3JdW2RdOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBDcmVhdGVzIGEgYmlkaXJlY3Rpb25hbCBsaW5rIGJldHdlZW4gdHdvIG5vZGVzIG9uIGRpcmVjdGlvbiBgZGAKICAgIGZ1bmN0aW9uIHN0aXRjaChDTEwgc3RvcmFnZSBzZWxmLCBpbnQgYSwgaW50IGIsIGJvb2wgZCkgaW50ZXJuYWwgIHsKICAgICAgICBzZWxmLmNsbFtiXVshZF0gPSBhOwogICAgICAgIHNlbGYuY2xsW2FdW2RdID0gYjsKICAgIH0KCiAgICAvLyBJbnNlcnQgbm9kZSBgYmAgYmVzaWRlIGV4aXN0aW5nIG5vZGUgYGFgIGluIGRpcmVjdGlvbiBgZGAuCiAgICBmdW5jdGlvbiBpbnNlcnQgKENMTCBzdG9yYWdlIHNlbGYsIGludCBhLCBpbnQgYiwgYm9vbCBkKSBpbnRlcm5hbCAgewogICAgICAgIGludCBjID0gc2VsZi5jbGxbYV1bZF07CiAgICAgICAgc3RpdGNoIChzZWxmLCBhLCBiLCBkKTsKICAgICAgICBzdGl0Y2ggKHNlbGYsIGIsIGMsIGQpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiByZW1vdmUoQ0xMIHN0b3JhZ2Ugc2VsZiwgaW50IG4pIGludGVybmFsIHJldHVybnMgKGludCkgewogICAgICAgIGlmIChuID09IE5VTEwpIHJldHVybjsKICAgICAgICBzdGl0Y2goc2VsZiwgc2VsZi5jbGxbbl1bUFJFVl0sIHNlbGYuY2xsW25dW05FWFRdLCBORVhUKTsKICAgICAgICBkZWxldGUgc2VsZi5jbGxbbl1bUFJFVl07CiAgICAgICAgZGVsZXRlIHNlbGYuY2xsW25dW05FWFRdOwogICAgICAgIHJldHVybiBuOwogICAgfQoKICAgIGZ1bmN0aW9uIHB1c2goQ0xMIHN0b3JhZ2Ugc2VsZiwgaW50IG4sIGJvb2wgZCkgaW50ZXJuYWwgIHsKICAgICAgICBpbnNlcnQoc2VsZiwgSEVBRCwgbiwgZCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHBvcChDTEwgc3RvcmFnZSBzZWxmLCBib29sIGQpIGludGVybmFsIHJldHVybnMgKGludCkgewogICAgICAgIHJldHVybiByZW1vdmUoc2VsZiwgc3RlcChzZWxmLCBIRUFELCBkKSk7CiAgICB9Cn0KCgovKiBFbmQgb2YgTGliQ0xMaSAqLwoKLyoKZmlsZTogICBJVFQuc29sCnZlcjogICAgMC4zLjYKdXBkYXRlZDoxOC1Ob3YtMjAxNgphdXRob3I6IERhcnJ5bCBNb3JyaXMgKG8wcmFnbWFuMG8pCmVtYWlsOiAgbzByYWdtYW4wbyBBVCBnbWFpbC5jb20KCkFuIEVSQzIwIGNvbXBsaWFudCB0b2tlbiB3aXRoIGN1cnJlbmN5CmV4Y2hhbmdlIGZ1bmN0aW9uYWxpdHkgaGVyZSBjYWxsZWQgYW4gJ0ludHJpbnNpY2FsbHkgVHJhZGFibGUKVG9rZW4nIChJVFQpLgoKVGhpcyBzb2Z0d2FyZSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLApidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgpNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCkdOVSBsZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgo8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uCiovCgovL3ByYWdtYSBzb2xpZGl0eSBeMC40LjA7CgovL2ltcG9ydCAiQmFzZS5zb2wiOwovL2ltcG9ydCAiTWF0aC5zb2wiOwovL2ltcG9ydCAiRVJDMjAuc29sIjsKLy9pbXBvcnQgIkxpYkNMTC5zb2wiOwoKY29udHJhY3QgSVRUSW50ZXJmYWNlCnsKCiAgICB1c2luZyBMaWJDTEx1IGZvciBMaWJDTEx1LkNMTDsKCi8qIENvbnN0YW50cyAqLwoKICAgIHN0cmluZyBjb25zdGFudCBWRVJTSU9OID0gIklUVCAwLjMuNlxuRVJDMjAgMC4yLjMtbzByYWdtYW4wb1xuTWF0aCAwLjAuMVxuQmFzZSAwLjEuMVxuIjsKICAgIHVpbnQgY29uc3RhbnQgSEVBRCA9IDA7CiAgICB1aW50IGNvbnN0YW50IE1JTk5VTSA9IHVpbnQoMSk7CiAgICAvLyB1c2Ugb25seSAxMjggYml0cyBvZiB1aW50IHRvIHByZXZlbnQgbXVsIG92ZXJmbG93cy4KICAgIHVpbnQgY29uc3RhbnQgTUFYTlVNID0gMioqMTI4OwogICAgdWludCBjb25zdGFudCBNSU5QUklDRSA9IHVpbnQoMSk7CiAgICB1aW50IGNvbnN0YW50IE5FRyA9IHVpbnQoLTEpOyAvLzIqKjI1NiAtIDEKICAgIGJvb2wgY29uc3RhbnQgUFJFViA9IGZhbHNlOwogICAgYm9vbCBjb25zdGFudCBORVhUID0gdHJ1ZTsKICAgIGJvb2wgY29uc3RhbnQgQklEID0gZmFsc2U7CiAgICBib29sIGNvbnN0YW50IEFTSyA9IHRydWU7CgogICAgLy8gbWluaW11bSBnYXMgcmVxdWlyZWQgdG8gcHJldmVudCBvdXQgb2YgZ2FzIG9uICd0YWtlJyBsb29wCiAgICB1aW50IGNvbnN0YW50IE1JTkdBUyA9IDEwMDAwMDsKCiAgICAvLyBGb3Igc3RhZ2luZyBhbmQgY29tbWl0aW5nIHRyYWRlIGRldGFpbHMuICBUaGlzIHNhdmVzIHVubmVjY2Vzc2FyeSBzdGF0ZQogICAgLy8gY2hhbmdlIGdhcyB1c2FnZSBkdXJpbmcgbXVsdGkgb3JkZXIgdGFrZXMgYnV0IGRvZXMgaW5jcmVhc2UgbG9naWMKICAgIC8vIGNvbXBsZXhpdHkgd2hlbiBlbmNvdW50ZXJpbmcgJ3RyYWRlIHdpdGggc2VsZicgb3JkZXJzCiAgICBzdHJ1Y3QgVHJhZGVNZXNzYWdlIHsKICAgICAgICBib29sIG1ha2U7CiAgICAgICAgYm9vbCBzaWRlOwogICAgICAgIHVpbnQgcHJpY2U7CiAgICAgICAgdWludCB0cmFkZUFtb3VudDsKICAgICAgICB1aW50IGJhbGFuY2U7CiAgICAgICAgdWludCBldGhlckJhbGFuY2U7CiAgICB9CgovKiBTdGF0ZSBWYWxpYWJsZXMgKi8KCiAgICAvLyBUbyBhbGxvdyBmb3IgdHJhZGUgaGFsdGluZyBieSBvd25lci4KICAgIGJvb2wgcHVibGljIHRyYWRpbmc7CgogICAgLy8gTWFwcGluZyBmb3IgZXRoZXIgb3duZXJzaGlwIG9mIGFjY3VtdWxhdGVkIGRlcG9zaXRzLCBzYWxlcyBhbmQgcmVmdW5kcy4KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkgZXRoZXJCYWxhbmNlOwoKICAgIC8vIE9yZGVycyBhcmUgc3RvcmVkIGluIGNpcmN1bGFyIGxpbmtlZCBsaXN0IEZJRk8ncyB3aGljaCBhcmUgbWFwcGluZ3Mgd2l0aAogICAgLy8gcHJpY2UgYXMga2V5IGFuZCB2YWx1ZSBhcyB0cmFkZXIgYWRkcmVzcy4gIEEgdHJhZGVyIGNhbiBoYXZlIG9ubHkgb25lCiAgICAvLyBvcmRlciBvcGVuIGF0IGVhY2ggcHJpY2UuIFJlb3JkZXJpbmcgYXQgdGhhdCBwcmljZSB3aWxsIGNhbmNlbCB0aGUgZmlyc3QKICAgIC8vIG9yZGVyIGFuZCBwdXNoIHRoZSBuZXcgb25lIG9udG8gdGhlIGJhY2sgb2YgdGhlIHF1ZXVlLgogICAgbWFwcGluZyAodWludCA9PiBMaWJDTEx1LkNMTCkgb3JkZXJGSUZPczsKICAgIAogICAgLy8gT3JkZXIgYW1vdW50cyBhcmUgc3RvcmVkIGluIGEgc2VwZXJhdGUgbG9va3VwLiBUaGUga2V5cyBvZiB0aGlzIG1hcHBpbmcKICAgIC8vIGFyZSBgc2hhM2AgaGFzaGVzIG9mIHRoZSBwcmljZSBhbmQgdHJhZGVyIGFkZHJlc3MuCiAgICAvLyBUaGlzIG1hcHBpbmcgcHJldmVudHMgbW9yZSB0aGFuIG9uZSBvcmRlciBhdCBhIHBhcnRpY3VsYXIgcHJpY2UuCiAgICBtYXBwaW5nIChieXRlczMyID0+IHVpbnQpIGFtb3VudHM7CgogICAgLy8gVGhlIHByaWNlYm9vayBpcyBhIGxpbmtlZCBsaXN0IGhvbGRpbmcga2V5cyB0byBsb29rdXAgdGhlIHByaWNlIEZJRk8ncwogICAgTGliQ0xMdS5DTEwgcHJpY2VCb29rID0gb3JkZXJGSUZPc1swXTsKCgovKiBFdmVudHMgKi8KCiAgICAvLyBUcmlnZ2VyZWQgb24gYSBtYWtlIHNlbGwgb3JkZXIKICAgIGV2ZW50IEFzayAodWludCBpbmRleGVkIHByaWNlLCB1aW50IGFtb3VudCwgYWRkcmVzcyBpbmRleGVkIHRyYWRlcik7CgogICAgLy8gVHJpZ2dlcmVkIG9uIGEgbWFrZSBidXkgb3JkZXIKICAgIGV2ZW50IEJpZCAodWludCBpbmRleGVkIHByaWNlLCB1aW50IGFtb3VudCwgYWRkcmVzcyBpbmRleGVkIHRyYWRlcik7CgogICAgLy8gVHJpZ2dlcmVkIG9uIGEgZmlsbGVkIG9yZGVyCiAgICBldmVudCBTYWxlICh1aW50IGluZGV4ZWQgcHJpY2UsIHVpbnQgYW1vdW50LCBhZGRyZXNzIGluZGV4ZWQgYnV5ZXIsIGFkZHJlc3MgaW5kZXhlZCBzZWxsZXIpOwoKICAgIC8vIFRyaWdnZXJlZCB3aGVuIHRyYWRpbmcgaXMgc3RhcnRlZCBvciBoYWx0ZWQKICAgIGV2ZW50IFRyYWRpbmcoYm9vbCB0cmFkaW5nKTsKCi8qIEZ1bmN0aW9ucyBQdWJsaWMgY29uc3RhbnQgKi8KCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIGJlc3QgYmlkIG9yIGFzayBwcmljZS4gCiAgICBmdW5jdGlvbiBzcHJlYWQoYm9vbCBfc2lkZSkgcHVibGljIGNvbnN0YW50IHJldHVybnModWludCk7CiAgICAKICAgIC8vLyBAbm90aWNlIFJldHVybnMgdGhlIG9yZGVyIGFtb3VudCBmb3IgdHJhZGVyIGBfdHJhZGVyYCBhdCAnX3ByaWNlJwogICAgLy8vIEBwYXJhbSBfdHJhZGVyIEFkZHJlc3Mgb2YgdHJhZGVyCiAgICAvLy8gQHBhcmFtIF9wcmljZSBQcmljZSBvZiBvcmRlcgogICAgZnVuY3Rpb24gZ2V0QW1vdW50KHVpbnQgX3ByaWNlLCBhZGRyZXNzIF90cmFkZXIpIAogICAgICAgIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQpOwoKICAgIC8vLyBAbm90aWNlIFJldHVybnMgdGhlIGNvbGxlY3RpdmUgb3JkZXIgdm9sdW1lIGF0IGEgYF9wcmljZWAuCiAgICAvLy8gQHBhcmFtIF9wcmljZSBGSUZPIGZvciBwcmljZS4KICAgIGZ1bmN0aW9uIGdldFByaWNlVm9sdW1lKHVpbnQgX3ByaWNlKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCk7CgogICAgLy8vIEBub3RpY2UgUmV0dXJucyBhbiBhcnJheSBvZiBhbGwgcHJpY2VzIGFuZCB0aGVpciB2b2x1bWVzLgogICAgLy8vIEBkZXYgW2V2ZW5dIGluZGVjaWVzIGFyZSB0aGUgcHJpY2UuIFtvZGRdIGFyZSB0aGUgdm9sdW1lLiBbMF0gaXMgdGhlCiAgICAvLy8gaW5kZXggb2YgdGhlIHNwcmVhZC4KICAgIGZ1bmN0aW9uIGdldEJvb2soKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludFtdKTsKCi8qIEZ1bmN0aW9ucyBQdWJsaWMgbm9uLWNvbnN0YW50Ki8KCiAgICAvLy8gQG5vdGljZSBXaWxsIGJ1eSBgX2Ftb3VudGAgdG9rZW5zIGF0IG9yIGJlbG93IGBfcHJpY2VgIGVhY2guCiAgICAvLy8gQHBhcmFtIF9iaWRQcmljZSBIaWdoZXN0IHByaWNlIHRvIGJpZC4KICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgcmVxdWVzdGVkIGFtb3VudCBvZiB0b2tlbnMgdG8gYnV5LgogICAgLy8vIEBwYXJhbSBfbWFrZSBWYWx1ZSBvZiB0cnVlIHdpbGwgbWFrZSBvcmRlciBpZiBub3QgZmlsbGVkLgogICAgZnVuY3Rpb24gYnV5ICh1aW50IF9iaWRQcmljZSwgdWludCBfYW1vdW50LCBib29sIF9tYWtlKQogICAgICAgIHBheWFibGUgcmV0dXJucyAoYm9vbCk7CgogICAgLy8vIEBub3RpY2UgV2lsbCBzZWxsIGBfYW1vdW50YCB0b2tlbnMgYXQgb3IgYWJvdmUgYF9wcmljZWAgZWFjaC4KICAgIC8vLyBAcGFyYW0gX2Fza1ByaWNlIExvd2VzdCBwcmljZSB0byBhc2suCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIHJlcXVlc3RlZCBhbW91bnQgb2YgdG9rZW5zIHRvIGJ1eS4KICAgIC8vLyBAcGFyYW0gX21ha2UgQSB2YWx1ZSBvZiB0cnVlIHdpbGwgbWFrZSBhbiBvcmRlciBpZiBub3QgbWFya2V0IGZpbGxlZC4KICAgIGZ1bmN0aW9uIHNlbGwgKHVpbnQgX2Fza1ByaWNlLCB1aW50IF9hbW91bnQsIGJvb2wgX21ha2UpCiAgICAgICAgZXh0ZXJuYWwgcmV0dXJucyAoYm9vbCk7CgogICAgLy8vIEBub3RpY2UgV2lsbCB3aXRoZHJhdyBgX2V0aGVyYCB0byB5b3VyIGFjY291bnQuCiAgICAvLy8gQHBhcmFtIF9ldGhlciBUaGUgYW1vdW50IHRvIHdpdGhkcmF3CiAgICBmdW5jdGlvbiB3aXRoZHJhdyh1aW50IF9ldGhlcikKICAgICAgICBleHRlcm5hbCByZXR1cm5zIChib29sIHN1Y2Nlc3NfKTsKCiAgICAvLy8gQG5vdGljZSBDYW5jZWwgb3JkZXIgYXQgYF9wcmljZWAKICAgIC8vLyBAcGFyYW0gX3ByaWNlIFRoZSBwcmljZSBhdCB3aGljaCB0aGUgb3JkZXIgd2FzIHBsYWNlZC4KICAgIGZ1bmN0aW9uIGNhbmNlbCh1aW50IF9wcmljZSkgCiAgICAgICAgZXh0ZXJuYWwgcmV0dXJucyAoYm9vbCk7CgogICAgLy8vIEBub3RpY2UgV2lsbCBzZXQgdHJhZGluZyBzdGF0ZSB0byBgX3RyYWRpbmdgCiAgICAvLy8gQHBhcmFtIF90cmFkaW5nIFN0YXRlIHRvIHNldCB0cmFkaW5nIHRvLgogICAgZnVuY3Rpb24gc2V0VHJhZGluZyhib29sIF90cmFkaW5nKSAKICAgICAgICBleHRlcm5hbCByZXR1cm5zIChib29sKTsKfQoKCi8qIEludHJpbnNpY2FsbHkgVHJhZGFibGUgVG9rZW4gY29kZSAqLyAKCmNvbnRyYWN0IElUVCBpcyBFUkMyMFRva2VuLCBJVFRJbnRlcmZhY2UKewoKLyogU3RydWN0cyAqLwoKLyogTW9kaWZpZXJzICovCgogICAgLy8vIEBkZXYgUGFzc2VzIGlmIHRva2VuIGlzIGN1cnJlbnRseSB0cmFkaW5nCiAgICBtb2RpZmllciBpc1RyYWRpbmcoKSB7CiAgICAgICAgaWYgKCF0cmFkaW5nKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAZGV2IFZhbGlkYXRlIGJ1eSBwYXJhbWV0ZXJzCiAgICBtb2RpZmllciBpc1ZhbGlkQnV5KHVpbnQgX2JpZFByaWNlLCB1aW50IF9hbW91bnQpIHsKICAgICAgICBpZiAoKGV0aGVyQmFsYW5jZVttc2cuc2VuZGVyXSArIG1zZy52YWx1ZSkgPCAoX2Ftb3VudCAqIF9iaWRQcmljZSkgfHwKICAgICAgICAgICAgX2Ftb3VudCA9PSAwIHx8IF9hbW91bnQgPiB0b3RhbFN1cHBseSB8fAogICAgICAgICAgICBfYmlkUHJpY2UgPD0gTUlOUFJJQ0UgfHwgX2JpZFByaWNlID49IE1BWE5VTSkgdGhyb3c7IC8vIGhhcyBpbnN1ZmZpY2llbnQgZXRoZXIuCiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQGRldiBWYWxpZGF0ZXMgc2VsbCBwYXJhbWV0ZXJzLiBQcmljZSBtdXN0IGJlIGxhcmdlciB0aGFuIDEuCiAgICBtb2RpZmllciBpc1ZhbGlkU2VsbCh1aW50IF9hc2tQcmljZSwgdWludCBfYW1vdW50KSB7CiAgICAgICAgaWYgKF9hbW91bnQgPiBiYWxhbmNlW21zZy5zZW5kZXJdIHx8IF9hbW91bnQgPT0gMCB8fAogICAgICAgICAgICBfYXNrUHJpY2UgPCBNSU5QUklDRSB8fCBfYXNrUHJpY2UgPiBNQVhOVU0pIHRocm93OwogICAgICAgIF87CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IFZhbGlkYXRlcyBldGhlciBiYWxhbmNlCiAgICBtb2RpZmllciBoYXNFdGhlcihhZGRyZXNzIF9tZW1iZXIsIHVpbnQgX2V0aGVyKSB7CiAgICAgICAgaWYgKGV0aGVyQmFsYW5jZVtfbWVtYmVyXSA8IF9ldGhlcikgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQGRldiBWYWxpZGF0ZXMgdG9rZW4gYmFsYW5jZQogICAgbW9kaWZpZXIgaGFzQmFsYW5jZShhZGRyZXNzIF9tZW1iZXIsIHVpbnQgX2Ftb3VudCkgewogICAgICAgIGlmIChiYWxhbmNlW19tZW1iZXJdIDwgX2Ftb3VudCkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCi8qIEZ1bmN0aW9ucyAqLwoKICAgIGZ1bmN0aW9uIElUVCgKICAgICAgICB1aW50IF90b3RhbFN1cHBseSwKICAgICAgICB1aW50OCBfZGVjaW1hbFBsYWNlcywKICAgICAgICBzdHJpbmcgX3N5bWJvbCwKICAgICAgICBzdHJpbmcgX25hbWUKICAgICAgICApCiAgICAgICAgICAgIEVSQzIwVG9rZW4oCiAgICAgICAgICAgICAgICBfdG90YWxTdXBwbHksCiAgICAgICAgICAgICAgICBfZGVjaW1hbFBsYWNlcywKICAgICAgICAgICAgICAgIF9zeW1ib2wsCiAgICAgICAgICAgICAgICBfbmFtZQogICAgICAgICAgICAgICAgKQogICAgewogICAgICAgIC8vIHNldHVwIHByaWNlYm9vayBhbmQgbWF4aW11bSBzcHJlYWQuCiAgICAgICAgcHJpY2VCb29rLmNsbFtIRUFEXVtQUkVWXSA9IE1JTlBSSUNFOwogICAgICAgIHByaWNlQm9vay5jbGxbTUlOUFJJQ0VdW1BSRVZdID0gTUFYTlVNOwogICAgICAgIHByaWNlQm9vay5jbGxbSEVBRF1bTkVYVF0gPSBNQVhOVU07CiAgICAgICAgcHJpY2VCb29rLmNsbFtNQVhOVU1dW05FWFRdID0gTUlOUFJJQ0U7CiAgICAgICAgdHJhZGluZyA9IHRydWU7CiAgICAgICAgYmFsYW5jZVtvd25lcl0gPSB0b3RhbFN1cHBseTsKICAgIH0KCi8qIEZ1bmN0aW9ucyBHZXR0ZXJzICovCgogICAgZnVuY3Rpb24gdmVyc2lvbigpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHN0cmluZykgewogICAgICAgIHJldHVybiBWRVJTSU9OOwogICAgfQoKICAgIGZ1bmN0aW9uIGV0aGVyQmFsYW5jZU9mKGFkZHJlc3MgX2FkZHIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGV0aGVyQmFsYW5jZVtfYWRkcl07CiAgICB9CgogICAgZnVuY3Rpb24gc3ByZWFkKGJvb2wgX3NpZGUpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXR1cm4gcHJpY2VCb29rLnN0ZXAoSEVBRCwgX3NpZGUpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEFtb3VudCh1aW50IF9wcmljZSwgYWRkcmVzcyBfdHJhZGVyKSAKICAgICAgICBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmV0dXJuIGFtb3VudHNbc2hhMyhfcHJpY2UsIF90cmFkZXIpXTsKICAgIH0KCiAgICBmdW5jdGlvbiBzaXplT2YodWludCBsKSBjb25zdGFudCByZXR1cm5zICh1aW50IHMpIHsKICAgICAgICBpZihsID09IDApIHJldHVybiBwcmljZUJvb2suc2l6ZU9mKCk7CiAgICAgICAgcmV0dXJuIG9yZGVyRklGT3NbbF0uc2l6ZU9mKCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldFByaWNlVm9sdW1lKHVpbnQgX3ByaWNlKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCB2XykKICAgIHsKICAgICAgICB1aW50IG4gPSBvcmRlckZJRk9zW19wcmljZV0uc3RlcChIRUFELE5FWFQpOwogICAgICAgIHdoaWxlIChuICE9IEhFQUQpIHsgCiAgICAgICAgICAgIHZfICs9IGFtb3VudHNbc2hhMyhfcHJpY2UsIGFkZHJlc3MobikpXTsKICAgICAgICAgICAgbiA9IG9yZGVyRklGT3NbX3ByaWNlXS5zdGVwKG4sIE5FWFQpOwogICAgICAgIH0KICAgICAgICByZXR1cm47CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0Qm9vaygpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50W10pCiAgICB7CiAgICAgICAgdWludCBpOyAKICAgICAgICB1aW50IHAgPSBwcmljZUJvb2suc3RlcChNSU5OVU0sIE5FWFQpOwogICAgICAgIHVpbnRbXSBtZW1vcnkgdm9sdW1lcyA9IG5ldyB1aW50W10ocHJpY2VCb29rLnNpemVPZigpICogMiAtIDIpOwogICAgICAgIHdoaWxlIChwIDwgTUFYTlVNKSB7CiAgICAgICAgICAgIHZvbHVtZXNbaSsrXSA9IHA7CiAgICAgICAgICAgIHZvbHVtZXNbaSsrXSA9IGdldFByaWNlVm9sdW1lKHApOwogICAgICAgICAgICBwID0gcHJpY2VCb29rLnN0ZXAocCwgTkVYVCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB2b2x1bWVzOyAKICAgIH0KICAgIAogICAgZnVuY3Rpb24gbnVtT3JkZXJzT2YoYWRkcmVzcyBfYWRkcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpCiAgICB7CiAgICAgICAgdWludCBjOwogICAgICAgIHVpbnQgcCA9IE1JTk5VTTsKICAgICAgICB3aGlsZSAocCA8IE1BWE5VTSkgewogICAgICAgICAgICBpZiAoYW1vdW50c1tzaGEzKHAsIF9hZGRyKV0gPiAwKSBjKys7CiAgICAgICAgICAgIHAgPSBwcmljZUJvb2suc3RlcChwLCBORVhUKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGM7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldE9wZW5PcmRlcnNPZihhZGRyZXNzIF9hZGRyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludFtdKQogICAgewogICAgICAgIHVpbnQgaTsKICAgICAgICB1aW50IGM7CiAgICAgICAgdWludCBwID0gTUlOTlVNOwogICAgICAgIHVpbnRbXSBtZW1vcnkgb3BlbiA9IG5ldyB1aW50W10obnVtT3JkZXJzT2YoX2FkZHIpKjIpOwogICAgICAgIHAgPSBNSU5OVU07CiAgICAgICAgd2hpbGUgKHAgPCBNQVhOVU0pIHsKICAgICAgICAgICAgaWYgKGFtb3VudHNbc2hhMyhwLCBfYWRkcildID4gMCkgewogICAgICAgICAgICAgICAgb3BlbltpKytdID0gcDsKICAgICAgICAgICAgICAgIG9wZW5baSsrXSA9IGFtb3VudHNbc2hhMyhwLCBfYWRkcildOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHAgPSBwcmljZUJvb2suc3RlcChwLCBORVhUKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG9wZW47CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0Tm9kZSh1aW50IF9saXN0LCB1aW50IF9ub2RlKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyh1aW50WzJdKQogICAgewogICAgICAgIHJldHVybiBbb3JkZXJGSUZPc1tfbGlzdF0uY2xsW19ub2RlXVtQUkVWXSwgCiAgICAgICAgICAgIG9yZGVyRklGT3NbX2xpc3RdLmNsbFtfbm9kZV1bTkVYVF1dOwogICAgfQogICAgCi8qIEZ1bmN0aW9ucyBQdWJsaWMgKi8KCi8vIEhlcmUgbm9uLWNvbnN0YW50IHB1YmxpYyBmdW5jdGlvbnMgYWN0IGFzIGEgc2VjdXJpdHkgbGF5ZXIuIFRoZXkgYXJlIHJlLWVudHJ5Ci8vIHByb3RlY3RlZCBzbyBjYW5ub3QgY2FsbCBlYWNoIG90aGVyLiBGb3IgdGhpcyByZWFzb24sIHRoZXkKLy8gYXJlIGJlaW5nIHVzZWQgZm9yIHBhcmFtZXRlciBhbmQgZW50ZXJhbmNlIHZhbGlkYXRpb24sIHdoaWxlIGludGVybmFsCi8vIGZ1bmN0aW9ucyBtYW5hZ2UgdGhlIGxvZ2ljLiBUaGlzIGFsc28gYWxsb3dzIGZvciBkZXJpdmluZyBjb250cmFjdHMgdG8KLy8gb3ZlcmxvYWQgdGhlIHB1YmxpYyBmdW5jdGlvbiB3aXRoIGN1c3RvbWlzZWQgdmFsaWRhdGlvbnMgYW5kIG5vdCBoYXZlIHRvCi8vIHdvcnJ5IGFib3V0IHJld3JpdHRpbmcgdGhlIGxvZ2ljLgoKICAgIGZ1bmN0aW9uIGJ1eSAodWludCBfYmlkUHJpY2UsIHVpbnQgX2Ftb3VudCwgYm9vbCBfbWFrZSkKICAgICAgICBwYXlhYmxlCiAgICAgICAgY2FuRW50ZXIKICAgICAgICBpc1RyYWRpbmcKICAgICAgICBpc1ZhbGlkQnV5KF9iaWRQcmljZSwgX2Ftb3VudCkKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHRyYWRlKF9iaWRQcmljZSwgX2Ftb3VudCwgQklELCBfbWFrZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gc2VsbCAodWludCBfYXNrUHJpY2UsIHVpbnQgX2Ftb3VudCwgYm9vbCBfbWFrZSkKICAgICAgICBleHRlcm5hbAogICAgICAgIGNhbkVudGVyCiAgICAgICAgaXNUcmFkaW5nCiAgICAgICAgaXNWYWxpZFNlbGwoX2Fza1ByaWNlLCBfYW1vdW50KQogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgdHJhZGUoX2Fza1ByaWNlLCBfYW1vdW50LCBBU0ssIF9tYWtlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiB3aXRoZHJhdyh1aW50IF9ldGhlcikKICAgICAgICBleHRlcm5hbAogICAgICAgIGNhbkVudGVyCiAgICAgICAgaGFzRXRoZXIobXNnLnNlbmRlciwgX2V0aGVyKQogICAgICAgIHJldHVybnMgKGJvb2wgc3VjY2Vzc18pCiAgICB7CiAgICAgICAgZXRoZXJCYWxhbmNlW21zZy5zZW5kZXJdIC09IF9ldGhlcjsKICAgICAgICBzYWZlU2VuZChtc2cuc2VuZGVyLCBfZXRoZXIpOwogICAgICAgIHN1Y2Nlc3NfID0gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBjYW5jZWwodWludCBfcHJpY2UpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBjYW5FbnRlcgogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgVHJhZGVNZXNzYWdlIG1lbW9yeSB0bXNnOwogICAgICAgIHRtc2cucHJpY2UgPSBfcHJpY2U7CiAgICAgICAgdG1zZy5iYWxhbmNlID0gYmFsYW5jZVttc2cuc2VuZGVyXTsKICAgICAgICB0bXNnLmV0aGVyQmFsYW5jZSA9IGV0aGVyQmFsYW5jZVttc2cuc2VuZGVyXTsKICAgICAgICBjYW5jZWxJbnRsKHRtc2cpOwogICAgICAgIGJhbGFuY2VbbXNnLnNlbmRlcl0gPSB0bXNnLmJhbGFuY2U7CiAgICAgICAgZXRoZXJCYWxhbmNlW21zZy5zZW5kZXJdID0gdG1zZy5ldGhlckJhbGFuY2U7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHNldFRyYWRpbmcoYm9vbCBfdHJhZGluZykKICAgICAgICBleHRlcm5hbAogICAgICAgIG9ubHlPd25lcgogICAgICAgIGNhbkVudGVyCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICB0cmFkaW5nID0gX3RyYWRpbmc7CiAgICAgICAgVHJhZGluZyh0cnVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCi8qIEZ1bmN0aW9ucyBJbnRlcm5hbCAqLwoKLy8gSW50ZXJuYWwgZnVuY3Rpb25zIGhhbmRsZSB0aGlzIGNvbnRyYWN0J3MgbG9naWMuCgogICAgZnVuY3Rpb24gdHJhZGUgKHVpbnQgX3ByaWNlLCB1aW50IF9hbW91bnQsIGJvb2wgX3NpZGUsIGJvb2wgX21ha2UpIGludGVybmFsIHsKICAgICAgICBUcmFkZU1lc3NhZ2UgbWVtb3J5IHRtc2c7CiAgICAgICAgdG1zZy5wcmljZSA9IF9wcmljZTsKICAgICAgICB0bXNnLnRyYWRlQW1vdW50ID0gX2Ftb3VudDsKICAgICAgICB0bXNnLnNpZGUgPSBfc2lkZTsKICAgICAgICB0bXNnLm1ha2UgPSBfbWFrZTsKICAgICAgICAKICAgICAgICAvLyBDYWNoZSBzdGF0ZSBiYWxhbmNlcyB0byBtZW1vcnkgYW5kIGNvbW1pdCB0byBzdG9yYWdlIG9ubHkgb25jZSBhZnRlciB0cmFkZS4KICAgICAgICB0bXNnLmJhbGFuY2UgID0gYmFsYW5jZVttc2cuc2VuZGVyXTsKICAgICAgICB0bXNnLmV0aGVyQmFsYW5jZSA9IGV0aGVyQmFsYW5jZVttc2cuc2VuZGVyXSArIG1zZy52YWx1ZTsKCiAgICAgICAgdGFrZSh0bXNnKTsKICAgICAgICBtYWtlKHRtc2cpOwogICAgICAgIAogICAgICAgIGJhbGFuY2VbbXNnLnNlbmRlcl0gPSB0bXNnLmJhbGFuY2U7CiAgICAgICAgZXRoZXJCYWxhbmNlW21zZy5zZW5kZXJdID0gdG1zZy5ldGhlckJhbGFuY2U7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHRha2UgKFRyYWRlTWVzc2FnZSB0bXNnKQogICAgICAgIGludGVybmFsCiAgICB7CiAgICAgICAgYWRkcmVzcyBtYWtlcjsKICAgICAgICBieXRlczMyIG9yZGVySGFzaDsKICAgICAgICB1aW50IHRha2VBbW91bnQ7CiAgICAgICAgdWludCB0YWtlRXRoZXI7CiAgICAgICAgLy8gdXNlIG9mIHNpZ25lZCBtYXRoIG9uIHVuc2lnbmVkIGludHMgaXMgaW50ZW50aW9uYWwKICAgICAgICB1aW50IHNpZ24gPSB0bXNnLnNpZGUgPyB1aW50KDEpIDogdWludCgtMSk7CiAgICAgICAgdWludCBiZXN0UHJpY2UgPSBzcHJlYWQoIXRtc2cuc2lkZSk7CgogICAgICAgIC8vIExvb3Agd2l0aCBhdmFpbGFibGUgZ2FzIHRvIHRha2Ugb3JkZXJzCiAgICAgICAgd2hpbGUgKAogICAgICAgICAgICB0bXNnLnRyYWRlQW1vdW50ID4gMCAmJgogICAgICAgICAgICBjbXBFcSh0bXNnLnByaWNlLCBiZXN0UHJpY2UsICF0bXNnLnNpZGUpICYmIAogICAgICAgICAgICBtc2cuZ2FzID4gTUlOR0FTCiAgICAgICAgKQogICAgICAgIHsKICAgICAgICAgICAgbWFrZXIgPSBhZGRyZXNzKG9yZGVyRklGT3NbYmVzdFByaWNlXS5zdGVwKEhFQUQsIE5FWFQpKTsKICAgICAgICAgICAgb3JkZXJIYXNoID0gc2hhMyhiZXN0UHJpY2UsIG1ha2VyKTsKICAgICAgICAgICAgaWYgKHRtc2cudHJhZGVBbW91bnQgPCBhbW91bnRzW29yZGVySGFzaF0pIHsKICAgICAgICAgICAgICAgIC8vIFByZXBhcmUgdG8gdGFrZSBwYXJ0aWFsIG9yZGVyCiAgICAgICAgICAgICAgICBhbW91bnRzW29yZGVySGFzaF0gPSBzYWZlU3ViKGFtb3VudHNbb3JkZXJIYXNoXSwgdG1zZy50cmFkZUFtb3VudCk7CiAgICAgICAgICAgICAgICB0YWtlQW1vdW50ID0gdG1zZy50cmFkZUFtb3VudDsKICAgICAgICAgICAgICAgIHRtc2cudHJhZGVBbW91bnQgPSAwOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gUHJlcGFyZSB0byB0YWtlIGZ1bGwgb3JkZXIKICAgICAgICAgICAgICAgIHRha2VBbW91bnQgPSBhbW91bnRzW29yZGVySGFzaF07CiAgICAgICAgICAgICAgICB0bXNnLnRyYWRlQW1vdW50ID0gc2FmZVN1Yih0bXNnLnRyYWRlQW1vdW50LCB0YWtlQW1vdW50KTsKICAgICAgICAgICAgICAgIGNsb3NlT3JkZXIoYmVzdFByaWNlLCBtYWtlcik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGFrZUV0aGVyID0gc2FmZU11bChiZXN0UHJpY2UsIHRha2VBbW91bnQpOwogICAgICAgICAgICAvLyBzaWduZWQgbXVsdGlwbHkgb24gdWludHMgaXMgaW50ZW50aW9uYWwgYW5kIHNvIHNhZmVNYXRocyB3aWxsIAogICAgICAgICAgICAvLyBicmVhayBoZXJlLiBWYWxpZCByYW5nZSBmb3IgZXhpdCBiYWxhbmNlcyBhcmUgMC4uMioqMTI4IAogICAgICAgICAgICB0bXNnLmV0aGVyQmFsYW5jZSArPSB0YWtlRXRoZXIgKiBzaWduOwogICAgICAgICAgICB0bXNnLmJhbGFuY2UgLT0gdGFrZUFtb3VudCAqIHNpZ247CiAgICAgICAgICAgIGlmICh0bXNnLnNpZGUpIHsKICAgICAgICAgICAgICAgIC8vIFNlbGwgdG8gYmlkZGVyCiAgICAgICAgICAgICAgICBpZiAobXNnLnNlbmRlciA9PSBtYWtlcikgewogICAgICAgICAgICAgICAgICAgIC8vIGJpZGRlciBpcyBzZWxmCiAgICAgICAgICAgICAgICAgICAgdG1zZy5iYWxhbmNlICs9IHRha2VBbW91bnQ7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGJhbGFuY2VbbWFrZXJdICs9IHRha2VBbW91bnQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBCdXkgZnJvbSBhc2tlcjsKICAgICAgICAgICAgICAgIGlmIChtc2cuc2VuZGVyID09IG1ha2VyKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gYXNrZXIgaXMgc2VsZgogICAgICAgICAgICAgICAgICAgIHRtc2cuZXRoZXJCYWxhbmNlICs9IHRha2VFdGhlcjsKICAgICAgICAgICAgICAgIH0gZWxzZSB7ICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGV0aGVyQmFsYW5jZVttYWtlcl0gKz0gdGFrZUV0aGVyOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIHByZXAgZm9yIG5leHQgb3JkZXIKICAgICAgICAgICAgYmVzdFByaWNlID0gc3ByZWFkKCF0bXNnLnNpZGUpOwogICAgICAgICAgICBTYWxlIChiZXN0UHJpY2UsIHRha2VBbW91bnQsIG1zZy5zZW5kZXIsIG1ha2VyKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gbWFrZShUcmFkZU1lc3NhZ2UgdG1zZykKICAgICAgICBpbnRlcm5hbAogICAgewogICAgICAgIGJ5dGVzMzIgb3JkZXJIYXNoOwogICAgICAgIGlmICh0bXNnLnRyYWRlQW1vdW50ID09IDAgfHwgIXRtc2cubWFrZSB8fCBtc2cuZ2FzIDwgTUlOR0FTKSByZXR1cm47CiAgICAgICAgb3JkZXJIYXNoID0gc2hhMyh0bXNnLnByaWNlLCBtc2cuc2VuZGVyKTsKICAgICAgICBpZiAoYW1vdW50c1tvcmRlckhhc2hdICE9IDApIHsKICAgICAgICAgICAgLy8gQ2FuY2VsIGFueSBwcmUtZXhpc3Rpbmcgb3duZWQgb3JkZXIgYXQgdGhpcyBwcmljZQogICAgICAgICAgICBjYW5jZWxJbnRsKHRtc2cpOwogICAgICAgIH0KICAgICAgICBpZiAoIW9yZGVyRklGT3NbdG1zZy5wcmljZV0uZXhpc3RzKCkpIHsKICAgICAgICAgICAgLy8gUmVnaXN0ZXIgcHJpY2UgaW4gcHJpY2Vib29rCiAgICAgICAgICAgIHByaWNlQm9vay5pbnNlcnQoCiAgICAgICAgICAgICAgICBwcmljZUJvb2suc2VlayhIRUFELCB0bXNnLnByaWNlLCB0bXNnLnNpZGUpLAogICAgICAgICAgICAgICAgdG1zZy5wcmljZSwgIXRtc2cuc2lkZSk7CiAgICAgICAgfQoKICAgICAgICBhbW91bnRzW29yZGVySGFzaF0gPSB0bXNnLnRyYWRlQW1vdW50OwogICAgICAgIG9yZGVyRklGT3NbdG1zZy5wcmljZV0ucHVzaCh1aW50KG1zZy5zZW5kZXIpLCBQUkVWKTsgCgogICAgICAgIGlmICh0bXNnLnNpZGUpIHsKICAgICAgICAgICAgdG1zZy5iYWxhbmNlIC09IHRtc2cudHJhZGVBbW91bnQ7CiAgICAgICAgICAgIEFzayAodG1zZy5wcmljZSwgdG1zZy50cmFkZUFtb3VudCwgbXNnLnNlbmRlcik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdG1zZy5ldGhlckJhbGFuY2UgLT0gdG1zZy50cmFkZUFtb3VudCAqIHRtc2cucHJpY2U7CiAgICAgICAgICAgIEJpZCAodG1zZy5wcmljZSwgdG1zZy50cmFkZUFtb3VudCwgbXNnLnNlbmRlcik7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGNhbmNlbEludGwoVHJhZGVNZXNzYWdlIHRtc2cpIGludGVybmFsIHsKICAgICAgICB1aW50IGFtb3VudCA9IGFtb3VudHNbc2hhMyh0bXNnLnByaWNlLCBtc2cuc2VuZGVyKV07CiAgICAgICAgaWYgKGFtb3VudCA9PSAwKSByZXR1cm47CiAgICAgICAgaWYgKHRtc2cucHJpY2UgPiBzcHJlYWQoQklEKSkgdG1zZy5iYWxhbmNlICs9IGFtb3VudDsgLy8gd2FzIGFzawogICAgICAgIGVsc2UgdG1zZy5ldGhlckJhbGFuY2UgKz0gdG1zZy5wcmljZSAqIGFtb3VudDsgLy8gd2FzIGJpZAogICAgICAgIGNsb3NlT3JkZXIodG1zZy5wcmljZSwgbXNnLnNlbmRlcik7CiAgICB9CgogICAgZnVuY3Rpb24gY2xvc2VPcmRlcih1aW50IF9wcmljZSwgYWRkcmVzcyBfdHJhZGVyKSBpbnRlcm5hbCB7CiAgICAgICAgb3JkZXJGSUZPc1tfcHJpY2VdLnJlbW92ZSh1aW50KF90cmFkZXIpKTsKICAgICAgICBpZiAoIW9yZGVyRklGT3NbX3ByaWNlXS5leGlzdHMoKSkgIHsKICAgICAgICAgICAgcHJpY2VCb29rLnJlbW92ZShfcHJpY2UpOwogICAgICAgIH0KICAgICAgICBkZWxldGUgYW1vdW50c1tzaGEzKF9wcmljZSwgX3RyYWRlcildOwogICAgfQp9'.
	

]
