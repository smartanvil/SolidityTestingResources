Class {
	#name : #SRT53a2fd0d693c79efd2fe1fd628bfcce3f0a89314,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT53a2fd0d693c79efd2fe1fd628bfcce3f0a89314 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgovKioKICogQHRpdGxlIE11bHRpU2lnU3R1YiAgCiAqIEBhdXRob3IgUmljYXJkbyBHdWlsaGVybWUgU2NobWlkdCAoU3RhdHVzIFJlc2VhcmNoICYgRGV2ZWxvcG1lbnQgR21iSCkKICogQGRldiBDb250cmFjdCB0aGF0IGRlbGVnYXRlcyBjYWxscyB0byBhIGxpYnJhcnkgdG8gYnVpbGQgYSBmdWxsIE11bHRpU2lnV2FsbGV0IHRoYXQgaXMgY2hlYXAgdG8gY3JlYXRlLiAKICovCmNvbnRyYWN0IE11bHRpU2lnU3R1YiB7CgogICAgYWRkcmVzc1tdIHB1YmxpYyBvd25lcnM7CiAgICBhZGRyZXNzW10gcHVibGljIHRva2VuczsKICAgIG1hcHBpbmcgKHVpbnQgPT4gVHJhbnNhY3Rpb24pIHB1YmxpYyB0cmFuc2FjdGlvbnM7CiAgICBtYXBwaW5nICh1aW50ID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkpIHB1YmxpYyBjb25maXJtYXRpb25zOwogICAgdWludCBwdWJsaWMgdHJhbnNhY3Rpb25Db3VudDsKCiAgICBzdHJ1Y3QgVHJhbnNhY3Rpb24gewogICAgICAgIGFkZHJlc3MgZGVzdGluYXRpb247CiAgICAgICAgdWludCB2YWx1ZTsKICAgICAgICBieXRlcyBkYXRhOwogICAgICAgIGJvb2wgZXhlY3V0ZWQ7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIE11bHRpU2lnU3R1YihhZGRyZXNzW10gX293bmVycywgdWludDI1NiBfcmVxdWlyZWQpIHsKICAgICAgICAvL2J5dGVzNCBzaWcgPSBieXRlczQoc2hhMygiY29uc3RydWN0b3IoYWRkcmVzc1tdLHVpbnQyNTYpIikpOwogICAgICAgIGJ5dGVzNCBzaWcgPSAweDM2NzU2YTIzOwogICAgICAgIHVpbnQgYXJnYXJyYXlzaXplID0gKDIgKyBfb3duZXJzLmxlbmd0aCk7CiAgICAgICAgdWludCBhcmdzaXplID0gKDEgKyBhcmdhcnJheXNpemUpICogMzI7CiAgICAgICAgdWludCBzaXplID0gNCArIGFyZ3NpemU7CiAgICAgICAgYnl0ZXMzMiBtRGF0YSA9IF9tYWxsb2Moc2l6ZSk7CgogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgbXN0b3JlKG1EYXRhLCBzaWcpCiAgICAgICAgICAgIGNvZGVjb3B5KGFkZChtRGF0YSwgMHg0KSwgc3ViKGNvZGVzaXplLCBhcmdzaXplKSwgYXJnc2l6ZSkKICAgICAgICB9CiAgICAgICAgX2RlbGVnYXRlY2FsbChtRGF0YSwgc2l6ZSk7CiAgICB9CiAgICAKICAgIG1vZGlmaWVyIGRlbGVnYXRlZCB7CiAgICAgICAgdWludCBzaXplID0gbXNnLmRhdGEubGVuZ3RoOwogICAgICAgIGJ5dGVzMzIgbURhdGEgPSBfbWFsbG9jKHNpemUpOwoKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIGNhbGxkYXRhY29weShtRGF0YSwgMHgwLCBzaXplKQogICAgICAgIH0KCiAgICAgICAgYnl0ZXMzMiBtUmVzdWx0ID0gX2RlbGVnYXRlY2FsbChtRGF0YSwgc2l6ZSk7CiAgICAgICAgXzsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHJldHVybihtUmVzdWx0LCAweDIwKQogICAgICAgIH0KICAgIH0KICAgIAogICAgZnVuY3Rpb24oKQogICAgICAgIHBheWFibGUKICAgICAgICBkZWxlZ2F0ZWQKICAgIHsKCiAgICB9CgogICAgZnVuY3Rpb24gc3VibWl0VHJhbnNhY3Rpb24oYWRkcmVzcyBkZXN0aW5hdGlvbiwgdWludCB2YWx1ZSwgYnl0ZXMgZGF0YSkKICAgICAgICBwdWJsaWMKICAgICAgICBkZWxlZ2F0ZWQKICAgICAgICByZXR1cm5zICh1aW50KQogICAgewogICAgICAgIAogICAgfQogICAgCiAgICBmdW5jdGlvbiBjb25maXJtVHJhbnNhY3Rpb24odWludCB0cmFuc2FjdGlvbklkKQogICAgICAgIHB1YmxpYwogICAgICAgIGRlbGVnYXRlZAogICAgewogICAgICAgIAogICAgfQogICAgCiAgICBmdW5jdGlvbiB3YXRjaChhZGRyZXNzIF90b2tlbkFkZHIpCiAgICAgICAgcHVibGljCiAgICAgICAgZGVsZWdhdGVkCiAgICB7CiAgICAgICAgCiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHNldE15VG9rZW5MaXN0KGFkZHJlc3NbXSBfdG9rZW5MaXN0KSAgCiAgICAgICAgcHVibGljCiAgICAgICAgZGVsZWdhdGVkCiAgICB7CgogICAgfQogICAgLy8vIEBkZXYgUmV0dXJucyB0aGUgY29uZmlybWF0aW9uIHN0YXR1cyBvZiBhIHRyYW5zYWN0aW9uLgogICAgLy8vIEBwYXJhbSB0cmFuc2FjdGlvbklkIFRyYW5zYWN0aW9uIElELgogICAgLy8vIEByZXR1cm4gQ29uZmlybWF0aW9uIHN0YXR1cy4KICAgIGZ1bmN0aW9uIGlzQ29uZmlybWVkKHVpbnQgdHJhbnNhY3Rpb25JZCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIGRlbGVnYXRlZAogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CgogICAgfQogICAgCiAgICAvKgogICAgKiBXZWIzIGNhbGwgZnVuY3Rpb25zCiAgICAqLwogICAgZnVuY3Rpb24gdG9rZW5CYWxhbmNlcyhhZGRyZXNzIHRva2VuQWRkcmVzcykgCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQgCiAgICAgICAgZGVsZWdhdGVkIAogICAgICAgIHJldHVybnMgKHVpbnQpCiAgICB7CgogICAgfQoKCiAgICAvLy8gQGRldiBSZXR1cm5zIG51bWJlciBvZiBjb25maXJtYXRpb25zIG9mIGEgdHJhbnNhY3Rpb24uCiAgICAvLy8gQHBhcmFtIHRyYW5zYWN0aW9uSWQgVHJhbnNhY3Rpb24gSUQuCiAgICAvLy8gQHJldHVybiBOdW1iZXIgb2YgY29uZmlybWF0aW9ucy4KICAgIGZ1bmN0aW9uIGdldENvbmZpcm1hdGlvbkNvdW50KHVpbnQgdHJhbnNhY3Rpb25JZCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIGRlbGVnYXRlZAogICAgICAgIHJldHVybnMgKHVpbnQpCiAgICB7CgogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgdG90YWwgbnVtYmVyIG9mIHRyYW5zYWN0aW9ucyBhZnRlciBmaWx0ZXJzIGFyZSBhcHBsaWVkLgogICAgLy8vIEBwYXJhbSBwZW5kaW5nIEluY2x1ZGUgcGVuZGluZyB0cmFuc2FjdGlvbnMuCiAgICAvLy8gQHBhcmFtIGV4ZWN1dGVkIEluY2x1ZGUgZXhlY3V0ZWQgdHJhbnNhY3Rpb25zLgogICAgLy8vIEByZXR1cm4gVG90YWwgbnVtYmVyIG9mIHRyYW5zYWN0aW9ucyBhZnRlciBmaWx0ZXJzIGFyZSBhcHBsaWVkLgogICAgZnVuY3Rpb24gZ2V0VHJhbnNhY3Rpb25Db3VudChib29sIHBlbmRpbmcsIGJvb2wgZXhlY3V0ZWQpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICBkZWxlZ2F0ZWQKICAgICAgICByZXR1cm5zICh1aW50KQogICAgewoKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIGxpc3Qgb2Ygb3duZXJzLgogICAgLy8vIEByZXR1cm4gTGlzdCBvZiBvd25lciBhZGRyZXNzZXMuCiAgICBmdW5jdGlvbiBnZXRPd25lcnMoKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoYWRkcmVzc1tdKQogICAgewogICAgICAgIHJldHVybiBvd25lcnM7CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyBsaXN0IG9mIHRva2Vucy4KICAgIC8vLyBAcmV0dXJuIExpc3Qgb2YgdG9rZW4gYWRkcmVzc2VzLgogICAgZnVuY3Rpb24gZ2V0VG9rZW5MaXN0KCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKGFkZHJlc3NbXSkKICAgIHsKICAgICAgICByZXR1cm4gdG9rZW5zOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgYXJyYXkgd2l0aCBvd25lciBhZGRyZXNzZXMsIHdoaWNoIGNvbmZpcm1lZCB0cmFuc2FjdGlvbi4KICAgIC8vLyBAcGFyYW0gdHJhbnNhY3Rpb25JZCBUcmFuc2FjdGlvbiBJRC4KICAgIC8vLyBAcmV0dXJuIFJldHVybnMgYXJyYXkgb2Ygb3duZXIgYWRkcmVzc2VzLgogICAgZnVuY3Rpb24gZ2V0Q29uZmlybWF0aW9ucyh1aW50IHRyYW5zYWN0aW9uSWQpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zIChhZGRyZXNzW10gX2NvbmZpcm1hdGlvbnMpCiAgICB7CiAgICAgICAgYWRkcmVzc1tdIG1lbW9yeSBjb25maXJtYXRpb25zVGVtcCA9IG5ldyBhZGRyZXNzW10ob3duZXJzLmxlbmd0aCk7CiAgICAgICAgdWludCBjb3VudCA9IDA7CiAgICAgICAgdWludCBpOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBvd25lcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGNvbmZpcm1hdGlvbnNbdHJhbnNhY3Rpb25JZF1bb3duZXJzW2ldXSkgewogICAgICAgICAgICAgICAgY29uZmlybWF0aW9uc1RlbXBbY291bnRdID0gb3duZXJzW2ldOwogICAgICAgICAgICAgICAgY291bnQgKz0gMTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfY29uZmlybWF0aW9ucyA9IG5ldyBhZGRyZXNzW10oY291bnQpOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CiAgICAgICAgICAgIF9jb25maXJtYXRpb25zW2ldID0gY29uZmlybWF0aW9uc1RlbXBbaV07CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgbGlzdCBvZiB0cmFuc2FjdGlvbiBJRHMgaW4gZGVmaW5lZCByYW5nZS4KICAgIC8vLyBAcGFyYW0gZnJvbSBJbmRleCBzdGFydCBwb3NpdGlvbiBvZiB0cmFuc2FjdGlvbiBhcnJheS4KICAgIC8vLyBAcGFyYW0gdG8gSW5kZXggZW5kIHBvc2l0aW9uIG9mIHRyYW5zYWN0aW9uIGFycmF5LgogICAgLy8vIEBwYXJhbSBwZW5kaW5nIEluY2x1ZGUgcGVuZGluZyB0cmFuc2FjdGlvbnMuCiAgICAvLy8gQHBhcmFtIGV4ZWN1dGVkIEluY2x1ZGUgZXhlY3V0ZWQgdHJhbnNhY3Rpb25zLgogICAgLy8vIEByZXR1cm4gUmV0dXJucyBhcnJheSBvZiB0cmFuc2FjdGlvbiBJRHMuCiAgICBmdW5jdGlvbiBnZXRUcmFuc2FjdGlvbklkcyh1aW50IGZyb20sIHVpbnQgdG8sIGJvb2wgcGVuZGluZywgYm9vbCBleGVjdXRlZCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnRbXSBfdHJhbnNhY3Rpb25JZHMpCiAgICB7CiAgICAgICAgdWludFtdIG1lbW9yeSB0cmFuc2FjdGlvbklkc1RlbXAgPSBuZXcgdWludFtdKHRyYW5zYWN0aW9uQ291bnQpOwogICAgICAgIHVpbnQgY291bnQgPSAwOwogICAgICAgIHVpbnQgaTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdHJhbnNhY3Rpb25Db3VudDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChwZW5kaW5nICYmICF0cmFuc2FjdGlvbnNbaV0uZXhlY3V0ZWQgfHwgZXhlY3V0ZWQgJiYgdHJhbnNhY3Rpb25zW2ldLmV4ZWN1dGVkKSB7CiAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbklkc1RlbXBbY291bnRdID0gaTsKICAgICAgICAgICAgICAgIGNvdW50ICs9IDE7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX3RyYW5zYWN0aW9uSWRzID0gbmV3IHVpbnRbXSh0byAtIGZyb20pOwogICAgICAgIGZvciAoaSA9IGZyb207IGkgPCB0bzsgaSsrKSB7CiAgICAgICAgICAgIF90cmFuc2FjdGlvbklkc1tpIC0gZnJvbV0gPSB0cmFuc2FjdGlvbklkc1RlbXBbaV07CiAgICAgICAgfQogICAgfQoKCiAgICBmdW5jdGlvbiBfbWFsbG9jKHVpbnQgc2l6ZSkgCiAgICAgICAgcHJpdmF0ZSAKICAgICAgICByZXR1cm5zKGJ5dGVzMzIgbURhdGEpIAogICAgewogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgbURhdGEgOj0gbWxvYWQoMHg0MCkKICAgICAgICAgICAgbXN0b3JlKDB4NDAsIGFkZChtRGF0YSwgc2l6ZSkpCiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIF9kZWxlZ2F0ZWNhbGwoYnl0ZXMzMiBtRGF0YSwgdWludCBzaXplKSAKICAgICAgICBwcml2YXRlIAogICAgICAgIHJldHVybnMoYnl0ZXMzMiBtUmVzdWx0KSAKICAgIHsKICAgICAgICBhZGRyZXNzIHRhcmdldCA9IDB4YzBGRmVFRTYxOTQ4ZDg5OTM4NjRhNzNhMDk5YzBFMzhEODg3ZDNGNDsgLy9NdWx0aW5ldHdvcmsKICAgICAgICBtUmVzdWx0ID0gX21hbGxvYygzMik7CiAgICAgICAgYm9vbCBmYWlsZWQ7CgogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgZmFpbGVkIDo9IGlzemVybyhkZWxlZ2F0ZWNhbGwoc3ViKGdhcywgMTAwMDApLCB0YXJnZXQsIG1EYXRhLCBzaXplLCBtUmVzdWx0LCAweDIwKSkKICAgICAgICB9CgogICAgICAgIGFzc2VydCghZmFpbGVkKTsKICAgIH0KICAgIAp9Cgpjb250cmFjdCBNdWx0aVNpZ0ZhY3RvcnkgewogICAgCiAgICBldmVudCBDcmVhdGUoYWRkcmVzcyBpbmRleGVkIGNhbGxlciwgYWRkcmVzcyBjcmVhdGVkQ29udHJhY3QpOwoKICAgIGZ1bmN0aW9uIGNyZWF0ZShhZGRyZXNzW10gb3duZXJzLCB1aW50MjU2IHJlcXVpcmVkKSByZXR1cm5zIChhZGRyZXNzIHdhbGxldCl7CiAgICAgICAgd2FsbGV0ID0gbmV3IE11bHRpU2lnU3R1Yihvd25lcnMsIHJlcXVpcmVkKTsgCiAgICAgICAgQ3JlYXRlKG1zZy5zZW5kZXIsIHdhbGxldCk7CiAgICB9CiAgICAKfQoKLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwovLyBNdWx0aVNpZ1Rva2VuV2FsbGV0IGFzIGluIDB4YzBGRmVFRTYxOTQ4ZDg5OTM4NjRhNzNhMDk5YzBFMzhEODg3ZDNGNAovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgpwcmFnbWEgc29saWRpdHkgXjAuNC4xNTsKCmNvbnRyYWN0IEVSQzIwIHsKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpOwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvayk7IAogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvayk7CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvayk7CiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwp9Cgpjb250cmFjdCBNdWx0aVNpZ1Rva2VuV2FsbGV0IHsKCiAgICBhZGRyZXNzW10gcHVibGljIG93bmVyczsKICAgIGFkZHJlc3NbXSBwdWJsaWMgdG9rZW5zOwogICAgbWFwcGluZyAodWludCA9PiBUcmFuc2FjdGlvbikgcHVibGljIHRyYW5zYWN0aW9uczsKICAgIG1hcHBpbmcgKHVpbnQgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSkgcHVibGljIGNvbmZpcm1hdGlvbnM7CiAgICB1aW50IHB1YmxpYyB0cmFuc2FjdGlvbkNvdW50OwogICAgCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyB0b2tlbkJhbGFuY2VzOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgaXNPd25lcjsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYWRkcmVzc1tdKSBwdWJsaWMgdXNlckxpc3Q7CiAgICB1aW50IHB1YmxpYyByZXF1aXJlZDsKICAgIHVpbnQgcHVibGljIG5vbmNlOwoKICAgIHN0cnVjdCBUcmFuc2FjdGlvbiB7CiAgICAgICAgYWRkcmVzcyBkZXN0aW5hdGlvbjsKICAgICAgICB1aW50IHZhbHVlOwogICAgICAgIGJ5dGVzIGRhdGE7CiAgICAgICAgYm9vbCBleGVjdXRlZDsKICAgIH0KCiAgICB1aW50IGNvbnN0YW50IHB1YmxpYyBNQVhfT1dORVJfQ09VTlQgPSA1MDsKCiAgICBldmVudCBDb25maXJtYXRpb24oYWRkcmVzcyBpbmRleGVkIF9zZW5kZXIsIHVpbnQgaW5kZXhlZCBfdHJhbnNhY3Rpb25JZCk7CiAgICBldmVudCBSZXZvY2F0aW9uKGFkZHJlc3MgaW5kZXhlZCBfc2VuZGVyLCB1aW50IGluZGV4ZWQgX3RyYW5zYWN0aW9uSWQpOwogICAgZXZlbnQgU3VibWlzc2lvbih1aW50IGluZGV4ZWQgX3RyYW5zYWN0aW9uSWQpOwogICAgZXZlbnQgRXhlY3V0aW9uKHVpbnQgaW5kZXhlZCBfdHJhbnNhY3Rpb25JZCk7CiAgICBldmVudCBFeGVjdXRpb25GYWlsdXJlKHVpbnQgaW5kZXhlZCBfdHJhbnNhY3Rpb25JZCk7CiAgICBldmVudCBEZXBvc2l0KGFkZHJlc3MgaW5kZXhlZCBfc2VuZGVyLCB1aW50IF92YWx1ZSk7CiAgICBldmVudCBUb2tlbkRlcG9zaXQoYWRkcmVzcyBfdG9rZW4sIGFkZHJlc3MgaW5kZXhlZCBfc2VuZGVyLCB1aW50IF92YWx1ZSk7CiAgICBldmVudCBPd25lckFkZGl0aW9uKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIpOwogICAgZXZlbnQgT3duZXJSZW1vdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIpOwogICAgZXZlbnQgUmVxdWlyZW1lbnRDaGFuZ2UodWludCBfcmVxdWlyZWQpOwogICAgCiAgICBtb2RpZmllciBvbmx5V2FsbGV0KCkgewogICAgICAgIHJlcXVpcmUgKG1zZy5zZW5kZXIgPT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvd25lckRvZXNOb3RFeGlzdChhZGRyZXNzIG93bmVyKSB7CiAgICAgICAgcmVxdWlyZSAoIWlzT3duZXJbb3duZXJdKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG93bmVyRXhpc3RzKGFkZHJlc3Mgb3duZXIpIHsKICAgICAgICByZXF1aXJlIChpc093bmVyW293bmVyXSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciB0cmFuc2FjdGlvbkV4aXN0cyh1aW50IHRyYW5zYWN0aW9uSWQpIHsKICAgICAgICByZXF1aXJlICh0cmFuc2FjdGlvbnNbdHJhbnNhY3Rpb25JZF0uZGVzdGluYXRpb24gIT0gMCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBjb25maXJtZWQodWludCB0cmFuc2FjdGlvbklkLCBhZGRyZXNzIG93bmVyKSB7CiAgICAgICAgcmVxdWlyZSAoY29uZmlybWF0aW9uc1t0cmFuc2FjdGlvbklkXVtvd25lcl0pOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgbm90Q29uZmlybWVkKHVpbnQgdHJhbnNhY3Rpb25JZCwgYWRkcmVzcyBvd25lcikgewogICAgICAgIHJlcXVpcmUoIWNvbmZpcm1hdGlvbnNbdHJhbnNhY3Rpb25JZF1bb3duZXJdKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG5vdEV4ZWN1dGVkKHVpbnQgdHJhbnNhY3Rpb25JZCkgewogICAgICAgIHJlcXVpcmUgKCF0cmFuc2FjdGlvbnNbdHJhbnNhY3Rpb25JZF0uZXhlY3V0ZWQpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgbm90TnVsbChhZGRyZXNzIF9hZGRyZXNzKSB7CiAgICAgICAgcmVxdWlyZSAoX2FkZHJlc3MgIT0gMCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciB2YWxpZFJlcXVpcmVtZW50KHVpbnQgb3duZXJDb3VudCwgdWludCBfcmVxdWlyZWQpIHsKICAgICAgICByZXF1aXJlIChvd25lckNvdW50IDw9IE1BWF9PV05FUl9DT1VOVCAmJiBfcmVxdWlyZWQgPD0gb3duZXJDb3VudCAmJiBfcmVxdWlyZWQgIT0gMCAmJiBvd25lckNvdW50ICE9IDApOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgRmFsbGJhY2sgZnVuY3Rpb24gYWxsb3dzIHRvIGRlcG9zaXQgZXRoZXIuCiAgICBmdW5jdGlvbigpCiAgICAgICAgcGF5YWJsZQogICAgewogICAgICAgIGlmIChtc2cudmFsdWUgPiAwKQogICAgICAgICAgICBEZXBvc2l0KG1zZy5zZW5kZXIsIG1zZy52YWx1ZSk7CiAgICB9CgogICAgLyoqCiAgICAqIFB1YmxpYyBmdW5jdGlvbnMKICAgICogCiAgICAqKi8KICAgIC8vLyBAZGV2IENvbnRyYWN0IGNvbnN0cnVjdG9yIHNldHMgaW5pdGlhbCBvd25lcnMgYW5kIHJlcXVpcmVkIG51bWJlciBvZiBjb25maXJtYXRpb25zLgogICAgLy8vIEBwYXJhbSBfb3duZXJzIExpc3Qgb2YgaW5pdGlhbCBvd25lcnMuCiAgICAvLy8gQHBhcmFtIF9yZXF1aXJlZCBOdW1iZXIgb2YgcmVxdWlyZWQgY29uZmlybWF0aW9ucy4KICAgIGZ1bmN0aW9uIGNvbnN0cnVjdG9yKGFkZHJlc3NbXSBfb3duZXJzLCB1aW50IF9yZXF1aXJlZCkKICAgICAgICBwdWJsaWMKICAgICAgICB2YWxpZFJlcXVpcmVtZW50KF9vd25lcnMubGVuZ3RoLCBfcmVxdWlyZWQpCiAgICB7CiAgICAgICAgcmVxdWlyZShvd25lcnMubGVuZ3RoID09IDAgJiYgcmVxdWlyZWQgPT0gMCk7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX293bmVycy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICByZXF1aXJlKCFpc093bmVyW19vd25lcnNbaV1dICYmIF9vd25lcnNbaV0gIT0gMCk7CiAgICAgICAgICAgIGlzT3duZXJbX293bmVyc1tpXV0gPSB0cnVlOwogICAgICAgIH0KICAgICAgICBvd25lcnMgPSBfb3duZXJzOwogICAgICAgIHJlcXVpcmVkID0gX3JlcXVpcmVkOwogICAgfQoKICAgIC8qKgogICAgKiBAbm90aWNlIGRlcG9zaXQgYSBFUkMyMCB0b2tlbi4gVGhlIGFtb3VudCBvZiBkZXBvc2l0IGlzIHRoZSBhbGxvd2FuY2Ugc2V0IHRvIHRoaXMgY29udHJhY3QuCiAgICAqIEBwYXJhbSBfdG9rZW4gdGhlIHRva2VuIGNvbnRyYWN0IGFkZHJlc3MKICAgICogQHBhcmFtIF9kYXRhIG1pZ2h0IGJlIHVzZWQgYnkgY2hpbGQgaW1wbGVtZW50YXRpb25zCiAgICAqKi8gCiAgICBmdW5jdGlvbiBkZXBvc2l0VG9rZW4oYWRkcmVzcyBfdG9rZW4sIGJ5dGVzIF9kYXRhKSAKICAgICAgICBwdWJsaWMgCiAgICB7CiAgICAgICAgYWRkcmVzcyBzZW5kZXIgPSBtc2cuc2VuZGVyOwogICAgICAgIHVpbnQgYW1vdW50ID0gRVJDMjAoX3Rva2VuKS5hbGxvd2FuY2Uoc2VuZGVyLCB0aGlzKTsKICAgICAgICBkZXBvc2l0KHNlbmRlciwgYW1vdW50LCBfdG9rZW4sIF9kYXRhKTsKICAgIH0KICAgICAgICAKICAgIC8qKgogICAgKiBAbm90aWNlIGRlcG9zaXQgYSBFUkMyMCB0b2tlbi4gVGhlIGFtb3VudCBvZiBkZXBvc2l0IGlzIHRoZSBhbGxvd2FuY2Ugc2V0IHRvIHRoaXMgY29udHJhY3QuCiAgICAqIEBwYXJhbSBfdG9rZW4gdGhlIHRva2VuIGNvbnRyYWN0IGFkZHJlc3MKICAgICogQHBhcmFtIF9kYXRhIG1pZ2h0IGJlIHVzZWQgYnkgY2hpbGQgaW1wbGVtZW50YXRpb25zCiAgICAqKi8gCiAgICBmdW5jdGlvbiBkZXBvc2l0KGFkZHJlc3MgX2Zyb20sIHVpbnQyNTYgX2Ftb3VudCwgYWRkcmVzcyBfdG9rZW4sIGJ5dGVzIF9kYXRhKSAKICAgICAgICBwdWJsaWMgCiAgICB7CiAgICAgICAgaWYgKF9mcm9tID09IGFkZHJlc3ModGhpcykpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB1aW50IF9ub25jZSA9IG5vbmNlOwogICAgICAgIGJvb2wgcmVzdWx0ID0gRVJDMjAoX3Rva2VuKS50cmFuc2ZlckZyb20oX2Zyb20sIHRoaXMsIF9hbW91bnQpOwogICAgICAgIGFzc2VydChyZXN1bHQpOwogICAgICAgIC8vRVJDMjMgbm90IGV4ZWN1dGVkIF9kZXBvc2l0ZWQgdG9rZW5GYWxsYmFjayBieQogICAgICAgIGlmIChub25jZSA9PSBfbm9uY2UpIHsKICAgICAgICAgICAgX2RlcG9zaXRlZChfZnJvbSwgX2Ftb3VudCwgX3Rva2VuLCBfZGF0YSk7CiAgICAgICAgfQogICAgfQogICAgLyoqCiAgICAqIEBub3RpY2Ugd2F0Y2hlcyBmb3IgYmFsYW5jZSBpbiBhIHRva2VuIGNvbnRyYWN0CiAgICAqIEBwYXJhbSBfdG9rZW5BZGRyIHRoZSB0b2tlbiBjb250cmFjdCBhZGRyZXNzCiAgICAqKi8gICAKICAgIGZ1bmN0aW9uIHdhdGNoKGFkZHJlc3MgX3Rva2VuQWRkcikgCiAgICAgICAgb3duZXJFeGlzdHMobXNnLnNlbmRlcikgCiAgICB7CiAgICAgICAgdWludCBvbGRCYWwgPSB0b2tlbkJhbGFuY2VzW190b2tlbkFkZHJdOwogICAgICAgIHVpbnQgbmV3QmFsID0gRVJDMjAoX3Rva2VuQWRkcikuYmFsYW5jZU9mKHRoaXMpOwogICAgICAgIGlmIChuZXdCYWwgPiBvbGRCYWwpIHsKICAgICAgICAgICAgX2RlcG9zaXRlZCgweDAsIG5ld0JhbC1vbGRCYWwsIF90b2tlbkFkZHIsIG5ldyBieXRlcygwKSk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHNldE15VG9rZW5MaXN0KGFkZHJlc3NbXSBfdG9rZW5MaXN0KSAKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICB1c2VyTGlzdFttc2cuc2VuZGVyXSA9IF90b2tlbkxpc3Q7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0VG9rZW5MaXN0KGFkZHJlc3NbXSBfdG9rZW5MaXN0KSAKICAgICAgICBvbmx5V2FsbGV0CiAgICB7CiAgICAgICAgdG9rZW5zID0gX3Rva2VuTGlzdDsKICAgIH0KICAgIAogICAgLyoqCiAgICAqIEBub3RpY2UgRVJDMjMgVG9rZW4gZmFsbGJhY2sKICAgICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgaW5jb21pbmcgdG9rZW4KICAgICogQHBhcmFtIF9hbW91bnQgaW5jb21pbmcgYW1vdW50CiAgICAqKi8gICAgCiAgICBmdW5jdGlvbiB0b2tlbkZhbGxiYWNrKGFkZHJlc3MgX2Zyb20sIHVpbnQgX2Ftb3VudCwgYnl0ZXMgX2RhdGEpIAogICAgICAgIHB1YmxpYyAKICAgIHsKICAgICAgICBfZGVwb3NpdGVkKF9mcm9tLCBfYW1vdW50LCBtc2cuc2VuZGVyLCBfZGF0YSk7CiAgICB9CiAgICAgICAgCiAgICAvKiogCiAgICAqIEBub3RpY2UgQ2FsbGVkIE1pbmlNZVRva2VuIGFwcHJvdmVzQW5kQ2FsbCB0byB0aGlzIGNvbnRyYWN0LCBjYWxscyBkZXBvc2l0LgogICAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyBpbmNvbWluZyB0b2tlbgogICAgKiBAcGFyYW0gX2Ftb3VudCBpbmNvbWluZyBhbW91bnQKICAgICogQHBhcmFtIF90b2tlbiB0aGUgdG9rZW4gY29udHJhY3QgYWRkcmVzcwogICAgKiBAcGFyYW0gX2RhdGEgKG1pZ2h0IGJlIHVzZWQgYnkgY2hpbGQgY2xhc3NlcykKICAgICovIAogICAgZnVuY3Rpb24gcmVjZWl2ZUFwcHJvdmFsKGFkZHJlc3MgX2Zyb20sIHVpbnQyNTYgX2Ftb3VudCwgYWRkcmVzcyBfdG9rZW4sIGJ5dGVzIF9kYXRhKSB7CiAgICAgICAgZGVwb3NpdChfZnJvbSwgX2Ftb3VudCwgX3Rva2VuLCBfZGF0YSk7CiAgICB9CiAgICAKCiAgICAvLy8gQGRldiBBbGxvd3MgdG8gYWRkIGEgbmV3IG93bmVyLiBUcmFuc2FjdGlvbiBoYXMgdG8gYmUgc2VudCBieSB3YWxsZXQuCiAgICAvLy8gQHBhcmFtIG93bmVyIEFkZHJlc3Mgb2YgbmV3IG93bmVyLgogICAgZnVuY3Rpb24gYWRkT3duZXIoYWRkcmVzcyBvd25lcikKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5V2FsbGV0CiAgICAgICAgb3duZXJEb2VzTm90RXhpc3Qob3duZXIpCiAgICAgICAgbm90TnVsbChvd25lcikKICAgICAgICB2YWxpZFJlcXVpcmVtZW50KG93bmVycy5sZW5ndGggKyAxLCByZXF1aXJlZCkKICAgIHsKICAgICAgICBpc093bmVyW293bmVyXSA9IHRydWU7CiAgICAgICAgb3duZXJzLnB1c2gob3duZXIpOwogICAgICAgIE93bmVyQWRkaXRpb24ob3duZXIpOwogICAgfQoKICAgIC8vLyBAZGV2IEFsbG93cyB0byByZW1vdmUgYW4gb3duZXIuIFRyYW5zYWN0aW9uIGhhcyB0byBiZSBzZW50IGJ5IHdhbGxldC4KICAgIC8vLyBAcGFyYW0gb3duZXIgQWRkcmVzcyBvZiBvd25lci4KICAgIGZ1bmN0aW9uIHJlbW92ZU93bmVyKGFkZHJlc3Mgb3duZXIpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seVdhbGxldAogICAgICAgIG93bmVyRXhpc3RzKG93bmVyKQogICAgewogICAgICAgIGlzT3duZXJbb3duZXJdID0gZmFsc2U7CiAgICAgICAgdWludCBfbGVuID0gb3duZXJzLmxlbmd0aCAtIDE7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX2xlbjsgaSsrKSB7CiAgICAgICAgICAgIGlmIChvd25lcnNbaV0gPT0gb3duZXIpIHsKICAgICAgICAgICAgICAgIG93bmVyc1tpXSA9IG93bmVyc1tvd25lcnMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBvd25lcnMubGVuZ3RoIC09IDE7CiAgICAgICAgaWYgKHJlcXVpcmVkID4gb3duZXJzLmxlbmd0aCkKICAgICAgICAgICAgY2hhbmdlUmVxdWlyZW1lbnQob3duZXJzLmxlbmd0aCk7CiAgICAgICAgT3duZXJSZW1vdmFsKG93bmVyKTsKICAgIH0KCiAgICAvLy8gQGRldiBBbGxvd3MgdG8gcmVwbGFjZSBhbiBvd25lciB3aXRoIGEgbmV3IG93bmVyLiBUcmFuc2FjdGlvbiBoYXMgdG8gYmUgc2VudCBieSB3YWxsZXQuCiAgICAvLy8gQHBhcmFtIG93bmVyIEFkZHJlc3Mgb2Ygb3duZXIgdG8gYmUgcmVwbGFjZWQuCiAgICAvLy8gQHBhcmFtIG93bmVyIEFkZHJlc3Mgb2YgbmV3IG93bmVyLgogICAgZnVuY3Rpb24gcmVwbGFjZU93bmVyKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3MgbmV3T3duZXIpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seVdhbGxldAogICAgICAgIG93bmVyRXhpc3RzKG93bmVyKQogICAgICAgIG93bmVyRG9lc05vdEV4aXN0KG5ld093bmVyKQogICAgewogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IG93bmVycy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAob3duZXJzW2ldID09IG93bmVyKSB7CiAgICAgICAgICAgICAgICBvd25lcnNbaV0gPSBuZXdPd25lcjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlzT3duZXJbb3duZXJdID0gZmFsc2U7CiAgICAgICAgaXNPd25lcltuZXdPd25lcl0gPSB0cnVlOwogICAgICAgIE93bmVyUmVtb3ZhbChvd25lcik7CiAgICAgICAgT3duZXJBZGRpdGlvbihuZXdPd25lcik7CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgZ2l2ZXMgZnVsbCBvd25lcnNoaXAgb2YgdGhpcyB3YWxsZXQgdG8gYF9kZXN0YCByZW1vdmluZyBvbGRlciBvd25lcnMgZnJvbSB3YWxsZXQKICAgICogQHBhcmFtIF9kZXN0IHRoZSBhZGRyZXNzIG9mIG5ldyBjb250cm9sbGVyCiAgICAqKi8gICAgCiAgICBmdW5jdGlvbiByZWxlYXNlV2FsbGV0KGFkZHJlc3MgX2Rlc3QpCiAgICAgICAgcHVibGljCiAgICAgICAgbm90TnVsbChfZGVzdCkKICAgICAgICBvd25lckRvZXNOb3RFeGlzdChfZGVzdCkKICAgICAgICBvbmx5V2FsbGV0CiAgICB7CiAgICAgICAgYWRkcmVzc1tdIG1lbW9yeSBfb3duZXJzID0gb3duZXJzOwogICAgICAgIHVpbnQgbnVtT3duZXJzID0gX293bmVycy5sZW5ndGg7CiAgICAgICAgYWRkT3duZXIoX2Rlc3QpOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IG51bU93bmVyczsgaSsrKSB7CiAgICAgICAgICAgIHJlbW92ZU93bmVyKF9vd25lcnNbaV0pOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQGRldiBBbGxvd3MgdG8gY2hhbmdlIHRoZSBudW1iZXIgb2YgcmVxdWlyZWQgY29uZmlybWF0aW9ucy4gVHJhbnNhY3Rpb24gaGFzIHRvIGJlIHNlbnQgYnkgd2FsbGV0LgogICAgLy8vIEBwYXJhbSBfcmVxdWlyZWQgTnVtYmVyIG9mIHJlcXVpcmVkIGNvbmZpcm1hdGlvbnMuCiAgICBmdW5jdGlvbiBjaGFuZ2VSZXF1aXJlbWVudCh1aW50IF9yZXF1aXJlZCkKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5V2FsbGV0CiAgICAgICAgdmFsaWRSZXF1aXJlbWVudChvd25lcnMubGVuZ3RoLCBfcmVxdWlyZWQpCiAgICB7CiAgICAgICAgcmVxdWlyZWQgPSBfcmVxdWlyZWQ7CiAgICAgICAgUmVxdWlyZW1lbnRDaGFuZ2UoX3JlcXVpcmVkKTsKICAgIH0KCiAgICAvLy8gQGRldiBBbGxvd3MgYW4gb3duZXIgdG8gc3VibWl0IGFuZCBjb25maXJtIGEgdHJhbnNhY3Rpb24uCiAgICAvLy8gQHBhcmFtIGRlc3RpbmF0aW9uIFRyYW5zYWN0aW9uIHRhcmdldCBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSB2YWx1ZSBUcmFuc2FjdGlvbiBldGhlciB2YWx1ZS4KICAgIC8vLyBAcGFyYW0gZGF0YSBUcmFuc2FjdGlvbiBkYXRhIHBheWxvYWQuCiAgICAvLy8gQHJldHVybiBSZXR1cm5zIHRyYW5zYWN0aW9uIElELgogICAgZnVuY3Rpb24gc3VibWl0VHJhbnNhY3Rpb24oYWRkcmVzcyBkZXN0aW5hdGlvbiwgdWludCB2YWx1ZSwgYnl0ZXMgZGF0YSkKICAgICAgICBwdWJsaWMKICAgICAgICByZXR1cm5zICh1aW50IHRyYW5zYWN0aW9uSWQpCiAgICB7CiAgICAgICAgdHJhbnNhY3Rpb25JZCA9IGFkZFRyYW5zYWN0aW9uKGRlc3RpbmF0aW9uLCB2YWx1ZSwgZGF0YSk7CiAgICAgICAgY29uZmlybVRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uSWQpOwogICAgfQoKICAgIC8vLyBAZGV2IEFsbG93cyBhbiBvd25lciB0byBjb25maXJtIGEgdHJhbnNhY3Rpb24uCiAgICAvLy8gQHBhcmFtIHRyYW5zYWN0aW9uSWQgVHJhbnNhY3Rpb24gSUQuCiAgICBmdW5jdGlvbiBjb25maXJtVHJhbnNhY3Rpb24odWludCB0cmFuc2FjdGlvbklkKQogICAgICAgIHB1YmxpYwogICAgICAgIG93bmVyRXhpc3RzKG1zZy5zZW5kZXIpCiAgICAgICAgdHJhbnNhY3Rpb25FeGlzdHModHJhbnNhY3Rpb25JZCkKICAgICAgICBub3RDb25maXJtZWQodHJhbnNhY3Rpb25JZCwgbXNnLnNlbmRlcikKICAgIHsKICAgICAgICBjb25maXJtYXRpb25zW3RyYW5zYWN0aW9uSWRdW21zZy5zZW5kZXJdID0gdHJ1ZTsKICAgICAgICBDb25maXJtYXRpb24obXNnLnNlbmRlciwgdHJhbnNhY3Rpb25JZCk7CiAgICAgICAgZXhlY3V0ZVRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uSWQpOwogICAgfQoKICAgIC8vLyBAZGV2IEFsbG93cyBhbiBvd25lciB0byByZXZva2UgYSBjb25maXJtYXRpb24gZm9yIGEgdHJhbnNhY3Rpb24uCiAgICAvLy8gQHBhcmFtIHRyYW5zYWN0aW9uSWQgVHJhbnNhY3Rpb24gSUQuCiAgICBmdW5jdGlvbiByZXZva2VDb25maXJtYXRpb24odWludCB0cmFuc2FjdGlvbklkKQogICAgICAgIHB1YmxpYwogICAgICAgIG93bmVyRXhpc3RzKG1zZy5zZW5kZXIpCiAgICAgICAgY29uZmlybWVkKHRyYW5zYWN0aW9uSWQsIG1zZy5zZW5kZXIpCiAgICAgICAgbm90RXhlY3V0ZWQodHJhbnNhY3Rpb25JZCkKICAgIHsKICAgICAgICBjb25maXJtYXRpb25zW3RyYW5zYWN0aW9uSWRdW21zZy5zZW5kZXJdID0gZmFsc2U7CiAgICAgICAgUmV2b2NhdGlvbihtc2cuc2VuZGVyLCB0cmFuc2FjdGlvbklkKTsKICAgIH0KCiAgICAvLy8gQGRldiBBbGxvd3MgYW55b25lIHRvIGV4ZWN1dGUgYSBjb25maXJtZWQgdHJhbnNhY3Rpb24uCiAgICAvLy8gQHBhcmFtIHRyYW5zYWN0aW9uSWQgVHJhbnNhY3Rpb24gSUQuCiAgICBmdW5jdGlvbiBleGVjdXRlVHJhbnNhY3Rpb24odWludCB0cmFuc2FjdGlvbklkKQogICAgICAgIHB1YmxpYwogICAgICAgIG5vdEV4ZWN1dGVkKHRyYW5zYWN0aW9uSWQpCiAgICB7CiAgICAgICAgaWYgKGlzQ29uZmlybWVkKHRyYW5zYWN0aW9uSWQpKSB7CiAgICAgICAgICAgIFRyYW5zYWN0aW9uIHN0b3JhZ2UgdHh4ID0gdHJhbnNhY3Rpb25zW3RyYW5zYWN0aW9uSWRdOwogICAgICAgICAgICB0eHguZXhlY3V0ZWQgPSB0cnVlOwogICAgICAgICAgICBpZiAodHh4LmRlc3RpbmF0aW9uLmNhbGwudmFsdWUodHh4LnZhbHVlKSh0eHguZGF0YSkpIHsKICAgICAgICAgICAgICAgIEV4ZWN1dGlvbih0cmFuc2FjdGlvbklkKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIEV4ZWN1dGlvbkZhaWx1cmUodHJhbnNhY3Rpb25JZCk7CiAgICAgICAgICAgICAgICB0eHguZXhlY3V0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICogQGRldiB3aXRoZHJhdyBhbGwgcmVjb2duaXplZCB0b2tlbnMgYmFsYW5jZXMgYW5kIGV0aGVyIHRvIGBfZGVzdGAKICAgICogQHBhcmFtIF9kZXN0IHRoZSBhZGRyZXNzIG9mIHJlY2VpdmVyCiAgICAqKi8gICAgCiAgICBmdW5jdGlvbiB3aXRoZHJhd0V2ZXJ5dGhpbmcoYWRkcmVzcyBfZGVzdCkgCiAgICAgICAgcHVibGljCiAgICAgICAgbm90TnVsbChfZGVzdCkKICAgICAgICBvbmx5V2FsbGV0CiAgICB7CiAgICAgICAgd2l0aGRyYXdBbGxUb2tlbnMoX2Rlc3QpOwogICAgICAgIF9kZXN0LnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgd2l0aGRyYXcgYWxsIHJlY29nbml6ZWQgdG9rZW5zIGJhbGFuY2VzIHRvIGBfZGVzdGAKICAgICogQHBhcmFtIF9kZXN0IHRoZSBhZGRyZXNzIG9mIHJlY2VpdmVyCiAgICAqKi8gICAgCiAgICBmdW5jdGlvbiB3aXRoZHJhd0FsbFRva2VucyhhZGRyZXNzIF9kZXN0KSAKICAgICAgICBwdWJsaWMgCiAgICAgICAgbm90TnVsbChfZGVzdCkKICAgICAgICBvbmx5V2FsbGV0CiAgICB7CiAgICAgICAgYWRkcmVzc1tdIG1lbW9yeSBfdG9rZW5MaXN0OwogICAgICAgIGlmICh1c2VyTGlzdFtfZGVzdF0ubGVuZ3RoID4gMCkgewogICAgICAgICAgICBfdG9rZW5MaXN0ID0gdXNlckxpc3RbX2Rlc3RdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF90b2tlbkxpc3QgPSB0b2tlbnM7CiAgICAgICAgfQogICAgICAgIHVpbnQgbGVuID0gX3Rva2VuTGlzdC5sZW5ndGg7CiAgICAgICAgZm9yICh1aW50IGkgPSAwO2kgPCBsZW47IGkrKykgewogICAgICAgICAgICBhZGRyZXNzIF90b2tlbkFkZHIgPSBfdG9rZW5MaXN0W2ldOwogICAgICAgICAgICB1aW50IF9hbW91bnQgPSB0b2tlbkJhbGFuY2VzW190b2tlbkFkZHJdOwogICAgICAgICAgICBpZiAoX2Ftb3VudCA+IDApIHsKICAgICAgICAgICAgICAgIGRlbGV0ZSB0b2tlbkJhbGFuY2VzW190b2tlbkFkZHJdOwogICAgICAgICAgICAgICAgRVJDMjAoX3Rva2VuQWRkcikudHJhbnNmZXIoX2Rlc3QsIF9hbW91bnQpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IHdpdGhkcmF3IGBfdG9rZW5BZGRyYCBgX2Ftb3VudGAgdG8gYF9kZXN0YAogICAgKiBAcGFyYW0gX3Rva2VuQWRkciB0aGUgYWRkcmVzcyBvZiB0aGUgdG9rZW4KICAgICogQHBhcmFtIF9kZXN0IHRoZSBhZGRyZXNzIG9mIHJlY2VpdmVyCiAgICAqIEBwYXJhbSBfYW1vdW50IHRoZSBudW1iZXIgb2YgdG9rZW5zIHRvIHNlbmQKICAgICoqLwogICAgZnVuY3Rpb24gd2l0aGRyYXdUb2tlbihhZGRyZXNzIF90b2tlbkFkZHIsIGFkZHJlc3MgX2Rlc3QsIHVpbnQgX2Ftb3VudCkKICAgICAgICBwdWJsaWMKICAgICAgICBub3ROdWxsKF9kZXN0KQogICAgICAgIG9ubHlXYWxsZXQgCiAgICB7CiAgICAgICAgcmVxdWlyZShfYW1vdW50ID4gMCk7CiAgICAgICAgdWludCBfYmFsYW5jZSA9IHRva2VuQmFsYW5jZXNbX3Rva2VuQWRkcl07CiAgICAgICAgcmVxdWlyZShfYW1vdW50IDw9IF9iYWxhbmNlKTsKICAgICAgICB0b2tlbkJhbGFuY2VzW190b2tlbkFkZHJdID0gX2JhbGFuY2UgLSBfYW1vdW50OwogICAgICAgIGJvb2wgcmVzdWx0ID0gRVJDMjAoX3Rva2VuQWRkcikudHJhbnNmZXIoX2Rlc3QsIF9hbW91bnQpOwogICAgICAgIGFzc2VydChyZXN1bHQpOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgdGhlIGNvbmZpcm1hdGlvbiBzdGF0dXMgb2YgYSB0cmFuc2FjdGlvbi4KICAgIC8vLyBAcGFyYW0gdHJhbnNhY3Rpb25JZCBUcmFuc2FjdGlvbiBJRC4KICAgIC8vLyBAcmV0dXJuIENvbmZpcm1hdGlvbiBzdGF0dXMuCiAgICBmdW5jdGlvbiBpc0NvbmZpcm1lZCh1aW50IHRyYW5zYWN0aW9uSWQpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHVpbnQgY291bnQgPSAwOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IG93bmVycy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoY29uZmlybWF0aW9uc1t0cmFuc2FjdGlvbklkXVtvd25lcnNbaV1dKQogICAgICAgICAgICAgICAgY291bnQgKz0gMTsKICAgICAgICAgICAgaWYgKGNvdW50ID09IHJlcXVpcmVkKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgfQoKICAgIC8qCiAgICAqIEludGVybmFsIGZ1bmN0aW9ucwogICAgKi8KICAgIC8vLyBAZGV2IEFkZHMgYSBuZXcgdHJhbnNhY3Rpb24gdG8gdGhlIHRyYW5zYWN0aW9uIG1hcHBpbmcsIGlmIHRyYW5zYWN0aW9uIGRvZXMgbm90IGV4aXN0IHlldC4KICAgIC8vLyBAcGFyYW0gZGVzdGluYXRpb24gVHJhbnNhY3Rpb24gdGFyZ2V0IGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIHZhbHVlIFRyYW5zYWN0aW9uIGV0aGVyIHZhbHVlLgogICAgLy8vIEBwYXJhbSBkYXRhIFRyYW5zYWN0aW9uIGRhdGEgcGF5bG9hZC4KICAgIC8vLyBAcmV0dXJuIFJldHVybnMgdHJhbnNhY3Rpb24gSUQuCiAgICBmdW5jdGlvbiBhZGRUcmFuc2FjdGlvbihhZGRyZXNzIGRlc3RpbmF0aW9uLCB1aW50IHZhbHVlLCBieXRlcyBkYXRhKQogICAgICAgIGludGVybmFsCiAgICAgICAgbm90TnVsbChkZXN0aW5hdGlvbikKICAgICAgICByZXR1cm5zICh1aW50IHRyYW5zYWN0aW9uSWQpCiAgICB7CiAgICAgICAgdHJhbnNhY3Rpb25JZCA9IHRyYW5zYWN0aW9uQ291bnQ7CiAgICAgICAgdHJhbnNhY3Rpb25zW3RyYW5zYWN0aW9uSWRdID0gVHJhbnNhY3Rpb24oewogICAgICAgICAgICBkZXN0aW5hdGlvbjogZGVzdGluYXRpb24sCiAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICAgICAgZGF0YTogZGF0YSwKICAgICAgICAgICAgZXhlY3V0ZWQ6IGZhbHNlCiAgICAgICAgfSk7CiAgICAgICAgdHJhbnNhY3Rpb25Db3VudCArPSAxOwogICAgICAgIFN1Ym1pc3Npb24odHJhbnNhY3Rpb25JZCk7CiAgICB9CiAgICAKICAgIC8qKgogICAgKiBAZGV2IHJlZ2lzdGVyIHRoZSBkZXBvc2l0CiAgICAqKi8KICAgIGZ1bmN0aW9uIF9kZXBvc2l0ZWQoYWRkcmVzcyBfZnJvbSwgIHVpbnQgX2Ftb3VudCwgYWRkcmVzcyBfdG9rZW5BZGRyLCBieXRlcykgCiAgICAgICAgaW50ZXJuYWwgCiAgICB7CiAgICAgICAgVG9rZW5EZXBvc2l0KF90b2tlbkFkZHIsX2Zyb20sX2Ftb3VudCk7CiAgICAgICAgbm9uY2UrKzsKICAgICAgICBpZiAodG9rZW5CYWxhbmNlc1tfdG9rZW5BZGRyXSA9PSAwKSB7CiAgICAgICAgICAgIHRva2Vucy5wdXNoKF90b2tlbkFkZHIpOyAgCiAgICAgICAgICAgIHRva2VuQmFsYW5jZXNbX3Rva2VuQWRkcl0gPSBFUkMyMChfdG9rZW5BZGRyKS5iYWxhbmNlT2YodGhpcyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdG9rZW5CYWxhbmNlc1tfdG9rZW5BZGRyXSArPSBfYW1vdW50OwogICAgICAgIH0KICAgIH0KICAgIAogICAgLyoKICAgICogV2ViMyBjYWxsIGZ1bmN0aW9ucwogICAgKi8KICAgIC8vLyBAZGV2IFJldHVybnMgbnVtYmVyIG9mIGNvbmZpcm1hdGlvbnMgb2YgYSB0cmFuc2FjdGlvbi4KICAgIC8vLyBAcGFyYW0gdHJhbnNhY3Rpb25JZCBUcmFuc2FjdGlvbiBJRC4KICAgIC8vLyBAcmV0dXJuIE51bWJlciBvZiBjb25maXJtYXRpb25zLgogICAgZnVuY3Rpb24gZ2V0Q29uZmlybWF0aW9uQ291bnQodWludCB0cmFuc2FjdGlvbklkKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCBjb3VudCkKICAgIHsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBvd25lcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGNvbmZpcm1hdGlvbnNbdHJhbnNhY3Rpb25JZF1bb3duZXJzW2ldXSkKICAgICAgICAgICAgICAgIGNvdW50ICs9IDE7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgdG90YWwgbnVtYmVyIG9mIHRyYW5zYWN0aW9ucyBhZnRlciBmaWx0ZXJzIGFyZSBhcHBsaWVkLgogICAgLy8vIEBwYXJhbSBwZW5kaW5nIEluY2x1ZGUgcGVuZGluZyB0cmFuc2FjdGlvbnMuCiAgICAvLy8gQHBhcmFtIGV4ZWN1dGVkIEluY2x1ZGUgZXhlY3V0ZWQgdHJhbnNhY3Rpb25zLgogICAgLy8vIEByZXR1cm4gVG90YWwgbnVtYmVyIG9mIHRyYW5zYWN0aW9ucyBhZnRlciBmaWx0ZXJzIGFyZSBhcHBsaWVkLgogICAgZnVuY3Rpb24gZ2V0VHJhbnNhY3Rpb25Db3VudChib29sIHBlbmRpbmcsIGJvb2wgZXhlY3V0ZWQpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50IGNvdW50KQogICAgewogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHRyYW5zYWN0aW9uQ291bnQ7IGkrKykgewogICAgICAgICAgICBpZiAocGVuZGluZyAmJiAhdHJhbnNhY3Rpb25zW2ldLmV4ZWN1dGVkIHx8IGV4ZWN1dGVkICYmIHRyYW5zYWN0aW9uc1tpXS5leGVjdXRlZCkKICAgICAgICAgICAgICAgIGNvdW50ICs9IDE7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgbGlzdCBvZiBvd25lcnMuCiAgICAvLy8gQHJldHVybiBMaXN0IG9mIG93bmVyIGFkZHJlc3Nlcy4KICAgIGZ1bmN0aW9uIGdldE93bmVycygpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zIChhZGRyZXNzW10pCiAgICB7CiAgICAgICAgcmV0dXJuIG93bmVyczsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIGxpc3Qgb2YgdG9rZW5zLgogICAgLy8vIEByZXR1cm4gTGlzdCBvZiB0b2tlbiBhZGRyZXNzZXMuCiAgICBmdW5jdGlvbiBnZXRUb2tlbkxpc3QoKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoYWRkcmVzc1tdKQogICAgewogICAgICAgIHJldHVybiB0b2tlbnM7CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyBhcnJheSB3aXRoIG93bmVyIGFkZHJlc3Nlcywgd2hpY2ggY29uZmlybWVkIHRyYW5zYWN0aW9uLgogICAgLy8vIEBwYXJhbSB0cmFuc2FjdGlvbklkIFRyYW5zYWN0aW9uIElELgogICAgLy8vIEByZXR1cm4gUmV0dXJucyBhcnJheSBvZiBvd25lciBhZGRyZXNzZXMuCiAgICBmdW5jdGlvbiBnZXRDb25maXJtYXRpb25zKHVpbnQgdHJhbnNhY3Rpb25JZCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKGFkZHJlc3NbXSBfY29uZmlybWF0aW9ucykKICAgIHsKICAgICAgICBhZGRyZXNzW10gbWVtb3J5IGNvbmZpcm1hdGlvbnNUZW1wID0gbmV3IGFkZHJlc3NbXShvd25lcnMubGVuZ3RoKTsKICAgICAgICB1aW50IGNvdW50ID0gMDsKICAgICAgICB1aW50IGk7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IG93bmVycy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoY29uZmlybWF0aW9uc1t0cmFuc2FjdGlvbklkXVtvd25lcnNbaV1dKSB7CiAgICAgICAgICAgICAgICBjb25maXJtYXRpb25zVGVtcFtjb3VudF0gPSBvd25lcnNbaV07CiAgICAgICAgICAgICAgICBjb3VudCArPSAxOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9jb25maXJtYXRpb25zID0gbmV3IGFkZHJlc3NbXShjb3VudCk7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgICAgICAgICAgX2NvbmZpcm1hdGlvbnNbaV0gPSBjb25maXJtYXRpb25zVGVtcFtpXTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyBsaXN0IG9mIHRyYW5zYWN0aW9uIElEcyBpbiBkZWZpbmVkIHJhbmdlLgogICAgLy8vIEBwYXJhbSBmcm9tIEluZGV4IHN0YXJ0IHBvc2l0aW9uIG9mIHRyYW5zYWN0aW9uIGFycmF5LgogICAgLy8vIEBwYXJhbSB0byBJbmRleCBlbmQgcG9zaXRpb24gb2YgdHJhbnNhY3Rpb24gYXJyYXkuCiAgICAvLy8gQHBhcmFtIHBlbmRpbmcgSW5jbHVkZSBwZW5kaW5nIHRyYW5zYWN0aW9ucy4KICAgIC8vLyBAcGFyYW0gZXhlY3V0ZWQgSW5jbHVkZSBleGVjdXRlZCB0cmFuc2FjdGlvbnMuCiAgICAvLy8gQHJldHVybiBSZXR1cm5zIGFycmF5IG9mIHRyYW5zYWN0aW9uIElEcy4KICAgIGZ1bmN0aW9uIGdldFRyYW5zYWN0aW9uSWRzKHVpbnQgZnJvbSwgdWludCB0bywgYm9vbCBwZW5kaW5nLCBib29sIGV4ZWN1dGVkKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludFtdIF90cmFuc2FjdGlvbklkcykKICAgIHsKICAgICAgICB1aW50W10gbWVtb3J5IHRyYW5zYWN0aW9uSWRzVGVtcCA9IG5ldyB1aW50W10odHJhbnNhY3Rpb25Db3VudCk7CiAgICAgICAgdWludCBjb3VudCA9IDA7CiAgICAgICAgdWludCBpOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCB0cmFuc2FjdGlvbkNvdW50OyBpKyspIHsKICAgICAgICAgICAgaWYgKHBlbmRpbmcgJiYgIXRyYW5zYWN0aW9uc1tpXS5leGVjdXRlZCB8fCBleGVjdXRlZCAmJiB0cmFuc2FjdGlvbnNbaV0uZXhlY3V0ZWQpIHsKICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uSWRzVGVtcFtjb3VudF0gPSBpOwogICAgICAgICAgICAgICAgY291bnQgKz0gMTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfdHJhbnNhY3Rpb25JZHMgPSBuZXcgdWludFtdKHRvIC0gZnJvbSk7CiAgICAgICAgZm9yIChpID0gZnJvbTsgaSA8IHRvOyBpKyspIHsKICAgICAgICAgICAgX3RyYW5zYWN0aW9uSWRzW2kgLSBmcm9tXSA9IHRyYW5zYWN0aW9uSWRzVGVtcFtpXTsKICAgICAgICB9CiAgICB9Cgp9'.
	

]
