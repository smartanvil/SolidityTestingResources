Class {
	#name : #SRT120a290590e51d7a020ffe039b1f03ff8447a19c,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT120a290590e51d7a020ffe039b1f03ff8447a19c >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbCAKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4gCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogIC8qKiAKICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgKiBhY2NvdW50LgogICAqLwogIGZ1bmN0aW9uIE93bmFibGUoKSBpbnRlcm5hbCB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLiAKICAgKi8KICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CgoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uIAogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciBwdWJsaWMgewogICAgcmVxdWlyZShuZXdPd25lciAhPSBhZGRyZXNzKDApKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKLyoqCiAqIEFic3RyYWN0IGNvbnRyYWN0IHRoYXQgYWxsb3dzIGNoaWxkcmVuIHRvIGltcGxlbWVudCBhbgogKiBlbWVyZ2VuY3kgc3RvcCBtZWNoYW5pc20uIERpZmZlcnMgZnJvbSBQYXVzYWJsZSBieSBjYXVzaW5nIGEgdGhyb3cgd2hlbiBpbiBoYWx0IG1vZGUuCiAqCiAqLwpjb250cmFjdCBIYWx0YWJsZSBpcyBPd25hYmxlIHsKICBib29sIHB1YmxpYyBoYWx0ZWQ7CgogIGV2ZW50IEhhbHRlZChib29sIGhhbHRlZCk7CgogIG1vZGlmaWVyIHN0b3BJbkVtZXJnZW5jeSB7CiAgICByZXF1aXJlKCFoYWx0ZWQpOwogICAgXzsKICB9CgogIG1vZGlmaWVyIG9ubHlJbkVtZXJnZW5jeSB7CiAgICByZXF1aXJlKGhhbHRlZCk7CiAgICBfOwogIH0KCiAgLy8gY2FsbGVkIGJ5IHRoZSBvd25lciBvbiBlbWVyZ2VuY3ksIHRyaWdnZXJzIHN0b3BwZWQgc3RhdGUKICBmdW5jdGlvbiBoYWx0KCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgIGhhbHRlZCA9IHRydWU7CiAgICBIYWx0ZWQodHJ1ZSk7CiAgfQoKICAvLyBjYWxsZWQgYnkgdGhlIG93bmVyIG9uIGVuZCBvZiBlbWVyZ2VuY3ksIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgZnVuY3Rpb24gdW5oYWx0KCkgZXh0ZXJuYWwgb25seU93bmVyIG9ubHlJbkVtZXJnZW5jeSB7CiAgICBoYWx0ZWQgPSBmYWxzZTsKICAgIEhhbHRlZChmYWxzZSk7CiAgfQoKfQoKLyoqCiAqIE9yaWdpbmFsbHkgZnJvbSAgaHR0cHM6Ly9naXRodWIuY29tL09wZW5aZXBwZWxpbi96ZXBwZWxpbi1zb2xpZGl0eQogKiBNb2RpZmllZCBieSBodHRwczovL3d3dy5jb2luZmFicmlrLmNvbS8KICovCgovKioKICogTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcwogKi8KbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludCBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzdWIodWludCBhLCB1aW50IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCkgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCkgewogICAgdWludCBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gbWF4NjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQ2NCkgewogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWluNjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQ2NCkgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtYXgyNTYodWludCBhLCB1aW50IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWluMjU2KHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogIH0KfQoKLyoqCiAqIEludGVyZmFjZSBmb3IgdGhlIHN0YW5kYXJkIHRva2VuLgogKiBCYXNlZCBvbiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9ibG9iL21hc3Rlci9FSVBTL2VpcC0yMC10b2tlbi1zdGFuZGFyZC5tZAogKi8KaW50ZXJmYWNlIEVJUDIwVG9rZW4gewoKICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKCiAgLyoqCiAgKiogT3B0aW9uYWwgZnVuY3Rpb25zCiAgKgogIGZ1bmN0aW9uIG5hbWUoKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgbmFtZSk7CiAgZnVuY3Rpb24gc3ltYm9sKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nIHN5bWJvbCk7CiAgZnVuY3Rpb24gZGVjaW1hbHMoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50OCBkZWNpbWFscyk7CiAgKgogICoqLwoKfQoKLy8gSW50ZXJmYWNlIGZvciBidXJuaW5nIHRva2Vucwpjb250cmFjdCBCdXJuYWJsZSB7CiAgLy8gQGRldiBEZXN0cm95cyB0b2tlbnMgZm9yIGFuIGFjY291bnQKICAvLyBAcGFyYW0gYWNjb3VudCBBY2NvdW50IHdob3NlIHRva2VucyBhcmUgZGVzdHJveWVkCiAgLy8gQHBhcmFtIHZhbHVlIEFtb3VudCBvZiB0b2tlbnMgdG8gZGVzdHJveQogIGZ1bmN0aW9uIGJ1cm5Ub2tlbnMoYWRkcmVzcyBhY2NvdW50LCB1aW50IHZhbHVlKSBpbnRlcm5hbDsKICBldmVudCBCdXJuZWQoYWRkcmVzcyBhY2NvdW50LCB1aW50IHZhbHVlKTsKfQoKLyoqCiAqIEF1dGhvcmVkIGJ5IGh0dHBzOi8vd3d3LmNvaW5mYWJyaWsuY29tLwogKi8KCgovKioKICogSW50ZXJuYWwgaW50ZXJmYWNlIGZvciB0aGUgbWludGluZyBvZiB0b2tlbnMuCiAqLwpjb250cmFjdCBNaW50YWJsZSB7CgogIC8qKgogICAqIEBkZXYgTWludHMgdG9rZW5zIGZvciBhbiBhY2NvdW50CiAgICogVGhpcyBmdW5jdGlvbiBzaG91bGQgZW1pdCB0aGUgTWludGVkIGV2ZW50LgogICAqLwogIGZ1bmN0aW9uIG1pbnRJbnRlcm5hbChhZGRyZXNzIHJlY2VpdmVyLCB1aW50IGFtb3VudCkgaW50ZXJuYWw7CgogIC8qKiBUb2tlbiBzdXBwbHkgZ290IGluY3JlYXNlZCBhbmQgYSBuZXcgb3duZXIgcmVjZWl2ZWQgdGhlc2UgdG9rZW5zICovCiAgZXZlbnQgTWludGVkKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgYW1vdW50KTsKfQoKLyoqCiAqIEB0aXRsZSBTdGFuZGFyZCB0b2tlbgogKiBAZGV2IEJhc2ljIGltcGxlbWVudGF0aW9uIG9mIHRoZSBFSVAyMCBzdGFuZGFyZCB0b2tlbiAoYWxzbyBrbm93biBhcyBFUkMyMCB0b2tlbikuCiAqLwpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEVJUDIwVG9rZW4sIEJ1cm5hYmxlLCBNaW50YWJsZSB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7CgogIHVpbnQgcHJpdmF0ZSB0b3RhbF9zdXBwbHk7CiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIHByaXZhdGUgYmFsYW5jZXM7CiAgbWFwcGluZyhhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkpIHByaXZhdGUgYWxsb3dlZDsKCgogIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIHRvdGFsX3N1cHBseTsKICB9CgogIC8qKgogICAqIEBkZXYgdHJhbnNmZXIgdG9rZW4gZm9yIGEgc3BlY2lmaWVkIGFkZHJlc3MKICAgKiBAcGFyYW0gdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8uCiAgICogQHBhcmFtIHZhbHVlIFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJyZWQuCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIodmFsdWUpOwogICAgYmFsYW5jZXNbdG9dID0gYmFsYW5jZXNbdG9dLmFkZCh2YWx1ZSk7CiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCB0bywgdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEdldHMgdGhlIGJhbGFuY2Ugb2YgdGhlIHNwZWNpZmllZCBhZGRyZXNzLgogICAqIEBwYXJhbSBhY2NvdW50IFRoZSBhZGRyZXNzIHdob3NlIGJhbGFuY2UgaXMgdG8gYmUgcXVlcmllZC4KICAgKiBAcmV0dXJuIEFuIHVpbnQgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb3duZWQgYnkgdGhlIHBhc3NlZCBhZGRyZXNzLgogICAqLwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIGFjY291bnQpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQgYmFsYW5jZSkgewogICAgcmV0dXJuIGJhbGFuY2VzW2FjY291bnRdOwogIH0KCiAgLyoqCiAgICogQGRldiBUcmFuc2ZlciB0b2tlbnMgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyCiAgICogQHBhcmFtIGZyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tCiAgICogQHBhcmFtIHRvIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gdHJhbnNmZXIgdG8KICAgKiBAcGFyYW0gdmFsdWUgdWludCB0aGUgYW1vdXQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVyZWQKICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICB1aW50IGFsbG93YW5jZSA9IGFsbG93ZWRbZnJvbV1bbXNnLnNlbmRlcl07CgogICAgLy8gQ2hlY2sgaXMgbm90IG5lZWRlZCBiZWNhdXNlIHN1YihhbGxvd2FuY2UsIHZhbHVlKSB3aWxsIGFscmVhZHkgdGhyb3cgaWYgdGhpcyBjb25kaXRpb24gaXMgbm90IG1ldAogICAgLy8gcmVxdWlyZSh2YWx1ZSA8PSBhbGxvd2FuY2UpOwogICAgLy8gU2FmZU1hdGggdXNlcyBhc3NlcnQgaW5zdGVhZCBvZiByZXF1aXJlIHRob3VnaCwgYmV3YXJlIHdoZW4gdXNpbmcgYW4gYW5hbHlzaXMgdG9vbAoKICAgIGJhbGFuY2VzW2Zyb21dID0gYmFsYW5jZXNbZnJvbV0uc3ViKHZhbHVlKTsKICAgIGJhbGFuY2VzW3RvXSA9IGJhbGFuY2VzW3RvXS5hZGQodmFsdWUpOwogICAgYWxsb3dlZFtmcm9tXVttc2cuc2VuZGVyXSA9IGFsbG93YW5jZS5zdWIodmFsdWUpOwogICAgVHJhbnNmZXIoZnJvbSwgdG8sIHZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBBcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWhhbGYgb2YgbXNnLnNlbmRlci4KICAgKiBAcGFyYW0gc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICovCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKCiAgICAvLyBUbyBjaGFuZ2UgdGhlIGFwcHJvdmUgYW1vdW50IHlvdSBmaXJzdCBoYXZlIHRvIHJlZHVjZSB0aGUgYWRkcmVzc2VzJwogICAgLy8gIGFsbG93YW5jZSB0byB6ZXJvIGJ5IGNhbGxpbmcgYGFwcHJvdmUoc3BlbmRlciwgMClgIGlmIGl0IGlzIG5vdAogICAgLy8gIGFscmVhZHkgMCB0byBtaXRpZ2F0ZSB0aGUgcmFjZSBjb25kaXRpb24gZGVzY3JpYmVkIGhlcmU6CiAgICAvLyAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgIHJlcXVpcmUgKHZhbHVlID09IDAgfHwgYWxsb3dlZFttc2cuc2VuZGVyXVtzcGVuZGVyXSA9PSAwKTsKCiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdID0gdmFsdWU7CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBzcGVuZGVyLCB2YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhbiBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKiBAcGFyYW0gYWNjb3VudCBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIG93bnMgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBzcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHJldHVybiBBIHVpbnQgc3BlY2lmaW5nIHRoZSBhbW91bnQgb2YgdG9rZW5zIHN0aWxsIGF2YWlibGUgZm9yIHRoZSBzcGVuZGVyLgogICAqLwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIGFjY291bnQsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludCByZW1haW5pbmcpIHsKICAgIHJldHVybiBhbGxvd2VkW2FjY291bnRdW3NwZW5kZXJdOwogIH0KCiAgLyoqCiAgICogQXRvbWljIGluY3JlbWVudCBvZiBhcHByb3ZlZCBzcGVuZGluZwogICAqCiAgICogV29ya3MgYXJvdW5kIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICoKICAgKi8KICBmdW5jdGlvbiBhZGRBcHByb3ZhbChhZGRyZXNzIHNwZW5kZXIsIHVpbnQgYWRkZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICB1aW50IG9sZFZhbHVlID0gYWxsb3dlZFttc2cuc2VuZGVyXVtzcGVuZGVyXTsKICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtzcGVuZGVyXSA9IG9sZFZhbHVlLmFkZChhZGRlZFZhbHVlKTsKICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtzcGVuZGVyXSk7CiAgICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQXRvbWljIGRlY3JlbWVudCBvZiBhcHByb3ZlZCBzcGVuZGluZy4KICAgKgogICAqIFdvcmtzIGFyb3VuZCBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAqLwogIGZ1bmN0aW9uIHN1YkFwcHJvdmFsKGFkZHJlc3Mgc3BlbmRlciwgdWludCBzdWJ0cmFjdGVkVmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKCiAgICAgIHVpbnQgb2xkVmFsID0gYWxsb3dlZFttc2cuc2VuZGVyXVtzcGVuZGVyXTsKCiAgICAgIGlmIChzdWJ0cmFjdGVkVmFsdWUgPiBvbGRWYWwpIHsKICAgICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bc3BlbmRlcl0gPSAwOwogICAgICB9IGVsc2UgewogICAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtzcGVuZGVyXSA9IG9sZFZhbC5zdWIoc3VidHJhY3RlZFZhbHVlKTsKICAgICAgfQogICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBzcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdKTsKICAgICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IFByb3ZpZGVzIGFuIGludGVybmFsIGZ1bmN0aW9uIGZvciBkZXN0cm95aW5nIHRva2Vucy4gVXNlZnVsIGZvciB1cGdyYWRlcy4KICAgKi8KICBmdW5jdGlvbiBidXJuVG9rZW5zKGFkZHJlc3MgYWNjb3VudCwgdWludCB2YWx1ZSkgaW50ZXJuYWwgewogICAgYmFsYW5jZXNbYWNjb3VudF0gPSBiYWxhbmNlc1thY2NvdW50XS5zdWIodmFsdWUpOwogICAgdG90YWxfc3VwcGx5ID0gdG90YWxfc3VwcGx5LnN1Yih2YWx1ZSk7CiAgICBUcmFuc2ZlcihhY2NvdW50LCAwLCB2YWx1ZSk7CiAgICBCdXJuZWQoYWNjb3VudCwgdmFsdWUpOwogIH0KCiAgLyoqCiAgICogQGRldiBQcm92aWRlcyBhbiBpbnRlcm5hbCBtaW50aW5nIGZ1bmN0aW9uLgogICAqLwogIGZ1bmN0aW9uIG1pbnRJbnRlcm5hbChhZGRyZXNzIHJlY2VpdmVyLCB1aW50IGFtb3VudCkgaW50ZXJuYWwgewogICAgdG90YWxfc3VwcGx5ID0gdG90YWxfc3VwcGx5LmFkZChhbW91bnQpOwogICAgYmFsYW5jZXNbcmVjZWl2ZXJdID0gYmFsYW5jZXNbcmVjZWl2ZXJdLmFkZChhbW91bnQpOwogICAgTWludGVkKHJlY2VpdmVyLCBhbW91bnQpOwoKICAgIC8vIEJld2FyZTogQWRkcmVzcyB6ZXJvIG1heSBiZSB1c2VkIGZvciBzcGVjaWFsIHRyYW5zYWN0aW9ucyBpbiBhIGZ1dHVyZSBmb3JrLgogICAgLy8gVGhpcyB3aWxsIG1ha2UgdGhlIG1pbnQgdHJhbnNhY3Rpb24gYXBwZWFyIGluIEV0aGVyU2Nhbi5pbwogICAgLy8gV2UgY2FuIHJlbW92ZSB0aGlzIGFmdGVyIHRoZXJlIGlzIGEgc3RhbmRhcmRpemVkIG1pbnRpbmcgZXZlbnQKICAgIFRyYW5zZmVyKDAsIHJlY2VpdmVyLCBhbW91bnQpOwogIH0KICAKfQoKLyoqCiAqIERlZmluZSBpbnRlcmZhY2UgZm9yIHJlbGVhc2luZyB0aGUgdG9rZW4gdHJhbnNmZXIgYWZ0ZXIgYSBzdWNjZXNzZnVsIGNyb3dkc2FsZS4KICovCmNvbnRyYWN0IFJlbGVhc2FibGVUb2tlbiBpcyBTdGFuZGFyZFRva2VuLCBPd25hYmxlIHsKCiAgLyogVGhlIGZpbmFsaXplciBjb250cmFjdCB0aGF0IGFsbG93cyBsaWZ0aW5nIHRoZSB0cmFuc2ZlciBsaW1pdHMgb24gdGhpcyB0b2tlbiAqLwogIGFkZHJlc3MgcHVibGljIHJlbGVhc2VBZ2VudDsKCiAgLyoqIEEgY3Jvd2RzYWxlIGNvbnRyYWN0IGNhbiByZWxlYXNlIHVzIHRvIHRoZSB3aWxkIGlmIElDTyBzdWNjZXNzLiBJZiBmYWxzZSB3ZSBhcmUgYXJlIGluIHRyYW5zZmVyIGxvY2sgdXAgcGVyaW9kLiovCiAgYm9vbCBwdWJsaWMgcmVsZWFzZWQgPSBmYWxzZTsKCiAgLyoqIE1hcCBvZiBhZ2VudHMgdGhhdCBhcmUgYWxsb3dlZCB0byB0cmFuc2ZlciB0b2tlbnMgcmVnYXJkbGVzcyBvZiB0aGUgbG9jayBkb3duIHBlcmlvZC4gVGhlc2UgYXJlIGNyb3dkc2FsZSBjb250cmFjdHMgYW5kIHBvc3NpYmxlIHRoZSB0ZWFtIG11bHRpc2lnIGl0c2VsZi4gKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyB0cmFuc2ZlckFnZW50czsKCiAgLyoqCiAgICogU2V0IHRoZSBjb250cmFjdCB0aGF0IGNhbiBjYWxsIHJlbGVhc2UgYW5kIG1ha2UgdGhlIHRva2VuIHRyYW5zZmVyYWJsZS4KICAgKgogICAqIFNpbmNlIHRoZSBvd25lciBvZiB0aGlzIGNvbnRyYWN0IGlzIChvciBzaG91bGQgYmUpIHRoZSBjcm93ZHNhbGUsCiAgICogaXQgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IGEgY29ycmVzcG9uZGluZyBleHBvc2VkIEFQSSBpbiB0aGUgY3Jvd2RzYWxlIGNvbnRyYWN0IGluIGNhc2Ugb2YgaW5wdXQgZXJyb3IuCiAgICovCiAgZnVuY3Rpb24gc2V0UmVsZWFzZUFnZW50KGFkZHJlc3MgYWRkcikgb25seU93bmVyIGluUmVsZWFzZVN0YXRlKGZhbHNlKSBwdWJsaWMgewogICAgLy8gV2UgZG9uJ3QgZG8gaW50ZXJmYWNlIGNoZWNrIGhlcmUgYXMgd2UgbWlnaHQgd2FudCB0byBoYXZlIGEgbm9ybWFsIHdhbGxldCBhZGRyZXNzIHRvIGFjdCBhcyBhIHJlbGVhc2UgYWdlbnQuCiAgICByZWxlYXNlQWdlbnQgPSBhZGRyOwogIH0KCiAgLyoqCiAgICogT3duZXIgY2FuIGFsbG93IGEgcGFydGljdWxhciBhZGRyZXNzIChlLmcuIGEgY3Jvd2RzYWxlIGNvbnRyYWN0KSB0byB0cmFuc2ZlciB0b2tlbnMgZGVzcGl0ZSB0aGUgbG9jayB1cCBwZXJpb2QuCiAgICovCiAgZnVuY3Rpb24gc2V0VHJhbnNmZXJBZ2VudChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdGUpIG9ubHlPd25lciBpblJlbGVhc2VTdGF0ZShmYWxzZSkgcHVibGljIHsKICAgIHRyYW5zZmVyQWdlbnRzW2FkZHJdID0gc3RhdGU7CiAgfQoKICAvKioKICAgKiBPbmUgd2F5IGZ1bmN0aW9uIHRvIHJlbGVhc2UgdGhlIHRva2VucyBpbnRvIHRoZSB3aWxkLgogICAqCiAgICogQ2FuIGJlIGNhbGxlZCBvbmx5IGZyb20gdGhlIHJlbGVhc2UgYWdlbnQgdGhhdCBzaG91bGQgdHlwaWNhbGx5IGJlIHRoZSBmaW5hbGl6ZSBhZ2VudCBJQ08gY29udHJhY3QuCiAgICogSW4gdGhlIHNjb3BlIG9mIHRoZSBjcm93ZHNhbGUsIGl0IGlzIG9ubHkgY2FsbGVkIGlmIHRoZSBjcm93ZHNhbGUgaGFzIGJlZW4gYSBzdWNjZXNzIChmaXJzdCBtaWxlc3RvbmUgcmVhY2hlZCkuCiAgICovCiAgZnVuY3Rpb24gcmVsZWFzZVRva2VuVHJhbnNmZXIoKSBwdWJsaWMgb25seVJlbGVhc2VBZ2VudCB7CiAgICByZWxlYXNlZCA9IHRydWU7CiAgfQoKICAvKioKICAgKiBMaW1pdCB0b2tlbiB0cmFuc2ZlciB1bnRpbCB0aGUgY3Jvd2RzYWxlIGlzIG92ZXIuCiAgICovCiAgbW9kaWZpZXIgY2FuVHJhbnNmZXIoYWRkcmVzcyBzZW5kZXIpIHsKICAgIHJlcXVpcmUocmVsZWFzZWQgfHwgdHJhbnNmZXJBZ2VudHNbc2VuZGVyXSk7CiAgICBfOwogIH0KCiAgLyoqIFRoZSBmdW5jdGlvbiBjYW4gYmUgY2FsbGVkIG9ubHkgYmVmb3JlIG9yIGFmdGVyIHRoZSB0b2tlbnMgaGF2ZSBiZWVuIHJlbGVhc2VkICovCiAgbW9kaWZpZXIgaW5SZWxlYXNlU3RhdGUoYm9vbCByZWxlYXNlU3RhdGUpIHsKICAgIHJlcXVpcmUocmVsZWFzZVN0YXRlID09IHJlbGVhc2VkKTsKICAgIF87CiAgfQoKICAvKiogVGhlIGZ1bmN0aW9uIGNhbiBiZSBjYWxsZWQgb25seSBieSBhIHdoaXRlbGlzdGVkIHJlbGVhc2UgYWdlbnQuICovCiAgbW9kaWZpZXIgb25seVJlbGVhc2VBZ2VudCgpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSByZWxlYXNlQWdlbnQpOwogICAgXzsKICB9CgogIC8qKiBXZSByZXN0cmljdCB0cmFuc2ZlciBieSBvdmVycmlkaW5nIGl0ICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcHVibGljIGNhblRyYW5zZmVyKG1zZy5zZW5kZXIpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgLy8gQ2FsbCBTdGFuZGFyZFRva2VuLnRyYW5zZmVyKCkKICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyKHRvLCB2YWx1ZSk7CiAgfQoKICAvKiogV2UgcmVzdHJpY3QgdHJhbnNmZXJGcm9tIGJ5IG92ZXJyaWRpbmcgaXQgKi8KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSBwdWJsaWMgY2FuVHJhbnNmZXIoZnJvbSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAvLyBDYWxsIFN0YW5kYXJkVG9rZW4udHJhbnNmZXJGb3JtKCkKICAgIHJldHVybiBzdXBlci50cmFuc2ZlckZyb20oZnJvbSwgdG8sIHZhbHVlKTsKICB9Cgp9CgovKioKICogSW5zcGlyZWQgYnkgTHVueXIuCiAqIE9yaWdpbmFsbHkgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vVG9rZW5NYXJrZXROZXQvaWNvCiAqLwoKLyoqCiAqIFVwZ3JhZGUgYWdlbnQgdHJhbnNmZXJzIHRva2VucyB0byBhIG5ldyBjb250cmFjdC4KICogVXBncmFkZSBhZ2VudCBpdHNlbGYgY2FuIGJlIHRoZSB0b2tlbiBjb250cmFjdCwgb3IganVzdCBhIG1pZGRsZSBtYW4gY29udHJhY3QgZG9pbmcgdGhlIGhlYXZ5IGxpZnRpbmcuCiAqCiAqIFRoZSBVcGdyYWRlIGFnZW50IGlzIHRoZSBpbnRlcmZhY2UgdXNlZCB0byBpbXBsZW1lbnQgYSB0b2tlbgogKiBtaWdyYXRpb24gaW4gdGhlIGNhc2Ugb2YgYW4gZW1lcmdlbmN5LgogKiBUaGUgZnVuY3Rpb24gdXBncmFkZUZyb20gaGFzIHRvIGltcGxlbWVudCB0aGUgcGFydCBvZiB0aGUgY3JlYXRpb24KICogb2YgbmV3IHRva2VucyBvbiBiZWhhbGYgb2YgdGhlIHVzZXIgZG9pbmcgdGhlIHVwZ3JhZGUuCiAqCiAqIFRoZSBuZXcgdG9rZW4gY2FuIGltcGxlbWVudCB0aGlzIGludGVyZmFjZSBkaXJlY3RseSwgb3IgdXNlLgogKi8KY29udHJhY3QgVXBncmFkZUFnZW50IHsKCiAgLyoqIFRoaXMgdmFsdWUgc2hvdWxkIGJlIHRoZSBzYW1lIGFzIHRoZSBvcmlnaW5hbCB0b2tlbidzIHRvdGFsIHN1cHBseSAqLwogIHVpbnQgcHVibGljIG9yaWdpbmFsU3VwcGx5OwoKICAvKiogSW50ZXJmYWNlIHRvIGVuc3VyZSB0aGUgY29udHJhY3QgaXMgY29ycmVjdGx5IGNvbmZpZ3VyZWQgKi8KICBmdW5jdGlvbiBpc1VwZ3JhZGVBZ2VudCgpIHB1YmxpYyBwdXJlIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgVXBncmFkZSBhbiBhY2NvdW50CgogIFdoZW4gdGhlIHRva2VuIGNvbnRyYWN0IGlzIGluIHRoZSB1cGdyYWRlIHN0YXR1cyB0aGUgZWFjaCB1c2VyIHdpbGwKICBoYXZlIHRvIGNhbGwgYHVwZ3JhZGUodmFsdWUpYCBmdW5jdGlvbiBmcm9tIFVwZ3JhZGVhYmxlVG9rZW4uCgogIFRoZSB1cGdyYWRlIGZ1bmN0aW9uIGFkanVzdCB0aGUgYmFsYW5jZSBvZiB0aGUgdXNlciBhbmQgdGhlIHN1cHBseQogIG9mIHRoZSBwcmV2aW91cyB0b2tlbiBhbmQgdGhlbiBjYWxsIGB1cGdyYWRlRnJvbSh2YWx1ZSlgLgoKICBUaGUgVXBncmFkZUFnZW50IGlzIHRoZSByZXNwb25zaWJsZSB0byBjcmVhdGUgdGhlIHRva2VucyBmb3IgdGhlIHVzZXIKICBpbiB0aGUgbmV3IGNvbnRyYWN0LgoKICAqIEBwYXJhbSBmcm9tIEFjY291bnQgdG8gdXBncmFkZS4KICAqIEBwYXJhbSB2YWx1ZSBUb2tlbnMgdG8gdXBncmFkZS4KCiAgKi8KICBmdW5jdGlvbiB1cGdyYWRlRnJvbShhZGRyZXNzIGZyb20sIHVpbnQgdmFsdWUpIHB1YmxpYzsKCn0KCgovKioKICogQSB0b2tlbiB1cGdyYWRlIG1lY2hhbmlzbSB3aGVyZSB1c2VycyBjYW4gb3B0LWluIGFtb3VudCBvZiB0b2tlbnMgdG8gdGhlIG5leHQgc21hcnQgY29udHJhY3QgcmV2aXNpb24uCiAqCiAqLwpjb250cmFjdCBVcGdyYWRlYWJsZVRva2VuIGlzIEVJUDIwVG9rZW4sIEJ1cm5hYmxlIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgLyoqIENvbnRyYWN0IC8gcGVyc29uIHdobyBjYW4gc2V0IHRoZSB1cGdyYWRlIHBhdGguIFRoaXMgY2FuIGJlIHRoZSBzYW1lIGFzIHRlYW0gbXVsdGlzaWcgd2FsbGV0LCBhcyB3aGF0IGl0IGlzIHdpdGggaXRzIGRlZmF1bHQgdmFsdWUuICovCiAgYWRkcmVzcyBwdWJsaWMgdXBncmFkZU1hc3RlcjsKCiAgLyoqIFRoZSBuZXh0IGNvbnRyYWN0IHdoZXJlIHRoZSB0b2tlbnMgd2lsbCBiZSBtaWdyYXRlZC4gKi8KICBVcGdyYWRlQWdlbnQgcHVibGljIHVwZ3JhZGVBZ2VudDsKCiAgLyoqIEhvdyBtYW55IHRva2VucyB3ZSBoYXZlIHVwZ3JhZGVkIGJ5IG5vdy4gKi8KICB1aW50IHB1YmxpYyB0b3RhbFVwZ3JhZGVkID0gMDsKCiAgLyoqCiAgICogVXBncmFkZSBzdGF0ZXMuCiAgICoKICAgKiAtIE5vdEFsbG93ZWQ6IFRoZSBjaGlsZCBjb250cmFjdCBoYXMgbm90IHJlYWNoZWQgYSBjb25kaXRpb24gd2hlcmUgdGhlIHVwZ3JhZGUgY2FuIGJndW4KICAgKiAtIFdhaXRpbmdGb3JBZ2VudDogVG9rZW4gYWxsb3dzIHVwZ3JhZGUsIGJ1dCB3ZSBkb24ndCBoYXZlIGEgbmV3IGFnZW50IHlldAogICAqIC0gUmVhZHlUb1VwZ3JhZGU6IFRoZSBhZ2VudCBpcyBzZXQsIGJ1dCBub3QgYSBzaW5nbGUgdG9rZW4gaGFzIGJlZW4gdXBncmFkZWQgeWV0LiBUaGlzIGFsbG93cyBjaGFuZ2luZyB0aGUgdXBncmFkZSBhZ2VudCB3aGlsZSB0aGVyZSBpcyB0aW1lLgogICAqIC0gVXBncmFkaW5nOiBVcGdyYWRlIGFnZW50IGlzIHNldCBhbmQgdGhlIGJhbGFuY2UgaG9sZGVycyBjYW4gdXBncmFkZSB0aGVpciB0b2tlbnMKICAgKgogICAqLwogIGVudW0gVXBncmFkZVN0YXRlIHtVbmtub3duLCBOb3RBbGxvd2VkLCBXYWl0aW5nRm9yQWdlbnQsIFJlYWR5VG9VcGdyYWRlLCBVcGdyYWRpbmd9CgogIC8qKgogICAqIFNvbWVib2R5IGhhcyB1cGdyYWRlZCBzb21lIG9mIGhpcyB0b2tlbnMuCiAgICovCiAgZXZlbnQgVXBncmFkZShhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyB0bywgdWludCB2YWx1ZSk7CgogIC8qKgogICAqIE5ldyB1cGdyYWRlIGFnZW50IGF2YWlsYWJsZS4KICAgKi8KICBldmVudCBVcGdyYWRlQWdlbnRTZXQoYWRkcmVzcyBhZ2VudCk7CgogIC8qKgogICAqIERvIG5vdCBhbGxvdyBjb25zdHJ1Y3Rpb24gd2l0aG91dCB1cGdyYWRlIG1hc3RlciBzZXQuCiAgICovCiAgZnVuY3Rpb24gVXBncmFkZWFibGVUb2tlbihhZGRyZXNzIG1hc3RlcikgaW50ZXJuYWwgewogICAgc2V0VXBncmFkZU1hc3RlcihtYXN0ZXIpOwogIH0KCiAgLyoqCiAgICogQWxsb3cgdGhlIHRva2VuIGhvbGRlciB0byB1cGdyYWRlIHNvbWUgb2YgdGhlaXIgdG9rZW5zIHRvIGEgbmV3IGNvbnRyYWN0LgogICAqLwogIGZ1bmN0aW9uIHVwZ3JhZGUodWludCB2YWx1ZSkgcHVibGljIHsKICAgIFVwZ3JhZGVTdGF0ZSBzdGF0ZSA9IGdldFVwZ3JhZGVTdGF0ZSgpOwogICAgLy8gRW5zdXJlIGl0J3Mgbm90IGNhbGxlZCBpbiBhIGJhZCBzdGF0ZQogICAgcmVxdWlyZShzdGF0ZSA9PSBVcGdyYWRlU3RhdGUuUmVhZHlUb1VwZ3JhZGUgfHwgc3RhdGUgPT0gVXBncmFkZVN0YXRlLlVwZ3JhZGluZyk7CgogICAgLy8gVmFsaWRhdGUgaW5wdXQgdmFsdWUuCiAgICByZXF1aXJlKHZhbHVlICE9IDApOwoKICAgIC8vIFVwZ3JhZGUgYWdlbnQgcmVpc3N1ZXMgdGhlIHRva2VucwogICAgdXBncmFkZUFnZW50LnVwZ3JhZGVGcm9tKG1zZy5zZW5kZXIsIHZhbHVlKTsKICAgIAogICAgLy8gVGFrZSB0b2tlbnMgb3V0IGZyb20gY2lyY3VsYXRpb24KICAgIGJ1cm5Ub2tlbnMobXNnLnNlbmRlciwgdmFsdWUpOwogICAgdG90YWxVcGdyYWRlZCA9IHRvdGFsVXBncmFkZWQuYWRkKHZhbHVlKTsKCiAgICBVcGdyYWRlKG1zZy5zZW5kZXIsIHVwZ3JhZGVBZ2VudCwgdmFsdWUpOwogIH0KCiAgLyoqCiAgICogU2V0IGFuIHVwZ3JhZGUgYWdlbnQgdGhhdCBoYW5kbGVzIHRoZSB1cGdyYWRlIHByb2Nlc3MKICAgKi8KICBmdW5jdGlvbiBzZXRVcGdyYWRlQWdlbnQoYWRkcmVzcyBhZ2VudCkgb25seU1hc3RlciBleHRlcm5hbCB7CiAgICAvLyBDaGVjayB3aGV0aGVyIHRoZSB0b2tlbiBpcyBpbiBhIHN0YXRlIHRoYXQgd2UgY291bGQgdGhpbmsgb2YgdXBncmFkaW5nCiAgICByZXF1aXJlKGNhblVwZ3JhZGUoKSk7CgogICAgcmVxdWlyZShhZ2VudCAhPSAweDApOwogICAgLy8gVXBncmFkZSBoYXMgYWxyZWFkeSBiZWd1biBmb3IgYW4gYWdlbnQKICAgIHJlcXVpcmUoZ2V0VXBncmFkZVN0YXRlKCkgIT0gVXBncmFkZVN0YXRlLlVwZ3JhZGluZyk7CgogICAgdXBncmFkZUFnZW50ID0gVXBncmFkZUFnZW50KGFnZW50KTsKCiAgICAvLyBCYWQgaW50ZXJmYWNlCiAgICByZXF1aXJlKHVwZ3JhZGVBZ2VudC5pc1VwZ3JhZGVBZ2VudCgpKTsKICAgIC8vIE1ha2Ugc3VyZSB0aGF0IHRva2VuIHN1cHBsaWVzIG1hdGNoIGluIHNvdXJjZSBhbmQgdGFyZ2V0CiAgICByZXF1aXJlKHVwZ3JhZGVBZ2VudC5vcmlnaW5hbFN1cHBseSgpID09IHRvdGFsU3VwcGx5KCkpOwoKICAgIFVwZ3JhZGVBZ2VudFNldCh1cGdyYWRlQWdlbnQpOwogIH0KCiAgLyoqCiAgICogR2V0IHRoZSBzdGF0ZSBvZiB0aGUgdG9rZW4gdXBncmFkZS4KICAgKi8KICBmdW5jdGlvbiBnZXRVcGdyYWRlU3RhdGUoKSBwdWJsaWMgdmlldyByZXR1cm5zKFVwZ3JhZGVTdGF0ZSkgewogICAgaWYgKCFjYW5VcGdyYWRlKCkpIHJldHVybiBVcGdyYWRlU3RhdGUuTm90QWxsb3dlZDsKICAgIGVsc2UgaWYgKGFkZHJlc3ModXBncmFkZUFnZW50KSA9PSAweDAwKSByZXR1cm4gVXBncmFkZVN0YXRlLldhaXRpbmdGb3JBZ2VudDsKICAgIGVsc2UgaWYgKHRvdGFsVXBncmFkZWQgPT0gMCkgcmV0dXJuIFVwZ3JhZGVTdGF0ZS5SZWFkeVRvVXBncmFkZTsKICAgIGVsc2UgcmV0dXJuIFVwZ3JhZGVTdGF0ZS5VcGdyYWRpbmc7CiAgfQoKICAvKioKICAgKiBDaGFuZ2UgdGhlIHVwZ3JhZGUgbWFzdGVyLgogICAqCiAgICogVGhpcyBhbGxvd3MgdXMgdG8gc2V0IGEgbmV3IG93bmVyIGZvciB0aGUgdXBncmFkZSBtZWNoYW5pc20uCiAgICovCiAgZnVuY3Rpb24gY2hhbmdlVXBncmFkZU1hc3RlcihhZGRyZXNzIG5ld19tYXN0ZXIpIG9ubHlNYXN0ZXIgcHVibGljIHsKICAgIHNldFVwZ3JhZGVNYXN0ZXIobmV3X21hc3Rlcik7CiAgfQoKICAvKioKICAgKiBJbnRlcm5hbCB1cGdyYWRlIG1hc3RlciBzZXR0ZXIuCiAgICovCiAgZnVuY3Rpb24gc2V0VXBncmFkZU1hc3RlcihhZGRyZXNzIG5ld19tYXN0ZXIpIHByaXZhdGUgewogICAgcmVxdWlyZShuZXdfbWFzdGVyICE9IDB4MCk7CiAgICB1cGdyYWRlTWFzdGVyID0gbmV3X21hc3RlcjsKICB9CgogIC8qKgogICAqIENoaWxkIGNvbnRyYWN0IGNhbiBvdmVycmlkZSB0byBwcm92aWRlIHRoZSBjb25kaXRpb24gaW4gd2hpY2ggdGhlIHVwZ3JhZGUgY2FuIGJlZ2luLgogICAqLwogIGZ1bmN0aW9uIGNhblVwZ3JhZGUoKSBwdWJsaWMgdmlldyByZXR1cm5zKGJvb2wpIHsKICAgICByZXR1cm4gdHJ1ZTsKICB9CgoKICBtb2RpZmllciBvbmx5TWFzdGVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHVwZ3JhZGVNYXN0ZXIpOwogICAgXzsKICB9Cn0KCi8vIFRoaXMgY29udHJhY3QgYWltcyB0byBwcm92aWRlIGFuIGluaGVyaXRhYmxlIHdheSB0byByZWNvdmVyIHRva2VucyBmcm9tIGEgY29udHJhY3Qgbm90IG1lYW50IHRvIGhvbGQgdG9rZW5zCi8vIFRvIHVzZSB0aGlzIGNvbnRyYWN0LCBoYXZlIHlvdXIgdG9rZW4taWdub3JpbmcgY29udHJhY3QgaW5oZXJpdCB0aGlzIG9uZSBhbmQgaW1wbGVtZW50IGdldExvc3RBbmRGb3VuZE1hc3RlciB0byBkZWNpZGUgd2hvIGNhbiBtb3ZlIGxvc3QgdG9rZW5zLgovLyBPZiBjb3Vyc2UsIHRoaXMgY29udHJhY3QgaW1wb3NlcyBzdXBwb3J0IGNvc3RzIHVwb24gd2hvZXZlciBpcyB0aGUgbG9zdCBhbmQgZm91bmQgbWFzdGVyLgpjb250cmFjdCBMb3N0QW5kRm91bmRUb2tlbiB7CiAgLyoqCiAgICogQHJldHVybiBBZGRyZXNzIG9mIHRoZSBhY2NvdW50IHRoYXQgaGFuZGxlcyBtb3ZlbWVudHMuCiAgICovCiAgZnVuY3Rpb24gZ2V0TG9zdEFuZEZvdW5kTWFzdGVyKCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChhZGRyZXNzKTsKCiAgLyoqCiAgICogQHBhcmFtIGFnZW50IEFkZHJlc3MgdGhhdCB3aWxsIGJlIGFibGUgdG8gbW92ZSB0b2tlbnMgd2l0aCB0cmFuc2ZlckZyb20KICAgKiBAcGFyYW0gdG9rZW5zIEFtb3VudCBvZiB0b2tlbnMgYXBwcm92ZWQgZm9yIHRyYW5zZmVyCiAgICogQHBhcmFtIHRva2VuX2NvbnRyYWN0IENvbnRyYWN0IG9mIHRoZSB0b2tlbgogICAqLwogIGZ1bmN0aW9uIGVuYWJsZUxvc3RBbmRGb3VuZChhZGRyZXNzIGFnZW50LCB1aW50IHRva2VucywgRUlQMjBUb2tlbiB0b2tlbl9jb250cmFjdCkgcHVibGljIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBnZXRMb3N0QW5kRm91bmRNYXN0ZXIoKSk7CiAgICAvLyBXZSB1c2UgYXBwcm92ZSBpbnN0ZWFkIG9mIHRyYW5zZmVyIHRvIG1pbmltaXplIHRoZSBwb3NzaWJpbGl0eSBvZiB0aGUgbG9zdCBhbmQgZm91bmQgbWFzdGVyCiAgICAvLyAgZ2V0dGluZyB0aGVtIHN0dWNrIGluIGFub3RoZXIgYWRkcmVzcyBieSBhY2NpZGVudC4KICAgIHRva2VuX2NvbnRyYWN0LmFwcHJvdmUoYWdlbnQsIHRva2Vucyk7CiAgfQp9CgoKCi8qKgogKiBBIHB1YmxpYyBpbnRlcmZhY2UgdG8gaW5jcmVhc2UgdGhlIHN1cHBseSBvZiBhIHRva2VuLgogKgogKiBUaGlzIGFsbG93cyB1bmNhcHBlZCBjcm93ZHNhbGUgYnkgZHluYW1pY2FsbHkgaW5jcmVhc2luZyB0aGUgc3VwcGx5IHdoZW4gbW9uZXkgcG91cnMgaW4uCiAqIE9ubHkgbWludCBhZ2VudHMsIHVzdWFsbHkgY29udHJhY3RzIHdoaXRlbGlzdGVkIGJ5IHRoZSBvd25lciwgY2FuIG1pbnQgbmV3IHRva2Vucy4KICoKICovCmNvbnRyYWN0IE1pbnRhYmxlVG9rZW4gaXMgTWludGFibGUsIE93bmFibGUgewoKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgYm9vbCBwdWJsaWMgbWludGluZ0ZpbmlzaGVkID0gZmFsc2U7CgogIC8qKiBMaXN0IG9mIGFnZW50cyB0aGF0IGFyZSBhbGxvd2VkIHRvIGNyZWF0ZSBuZXcgdG9rZW5zICovCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgbWludEFnZW50czsKCiAgZXZlbnQgTWludGluZ0FnZW50Q2hhbmdlZChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdGUpOwoKCiAgZnVuY3Rpb24gTWludGFibGVUb2tlbih1aW50IGluaXRpYWxTdXBwbHksIGFkZHJlc3MgbXVsdGlzaWcsIGJvb2wgbWludGFibGUpIGludGVybmFsIHsKICAgIHJlcXVpcmUobXVsdGlzaWcgIT0gYWRkcmVzcygwKSk7CiAgICAvLyBDYW5ub3QgY3JlYXRlIGEgdG9rZW4gd2l0aG91dCBzdXBwbHkgYW5kIG5vIG1pbnRpbmcKICAgIHJlcXVpcmUobWludGFibGUgfHwgaW5pdGlhbFN1cHBseSAhPSAwKTsKICAgIC8vIENyZWF0ZSBpbml0aWFsbHkgYWxsIGJhbGFuY2Ugb24gdGhlIHRlYW0gbXVsdGlzaWcKICAgIGlmIChpbml0aWFsU3VwcGx5ID4gMCkKICAgICAgbWludEludGVybmFsKG11bHRpc2lnLCBpbml0aWFsU3VwcGx5KTsKICAgIC8vIE5vIG1vcmUgbmV3IHN1cHBseSBhbGxvd2VkIGFmdGVyIHRoZSB0b2tlbiBjcmVhdGlvbgogICAgbWludGluZ0ZpbmlzaGVkID0gIW1pbnRhYmxlOwogIH0KCiAgLyoqCiAgICogQ3JlYXRlIG5ldyB0b2tlbnMgYW5kIGFsbG9jYXRlIHRoZW0gdG8gYW4gYWRkcmVzcy4KICAgKgogICAqIE9ubHkgY2FsbGFibGUgYnkgYSBtaW50IGFnZW50IChlLmcuIGNyb3dkc2FsZSBjb250cmFjdCkuCiAgICovCiAgZnVuY3Rpb24gbWludChhZGRyZXNzIHJlY2VpdmVyLCB1aW50IGFtb3VudCkgb25seU1pbnRBZ2VudCBjYW5NaW50IHB1YmxpYyB7CiAgICBtaW50SW50ZXJuYWwocmVjZWl2ZXIsIGFtb3VudCk7CiAgfQoKICAvKioKICAgKiBPd25lciBjYW4gYWxsb3cgYSBjcm93ZHNhbGUgY29udHJhY3QgdG8gbWludCBuZXcgdG9rZW5zLgogICAqLwogIGZ1bmN0aW9uIHNldE1pbnRBZ2VudChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdGUpIG9ubHlPd25lciBjYW5NaW50IHB1YmxpYyB7CiAgICBtaW50QWdlbnRzW2FkZHJdID0gc3RhdGU7CiAgICBNaW50aW5nQWdlbnRDaGFuZ2VkKGFkZHIsIHN0YXRlKTsKICB9CgogIG1vZGlmaWVyIG9ubHlNaW50QWdlbnQoKSB7CiAgICAvLyBPbmx5IG1pbnQgYWdlbnRzIGFyZSBhbGxvd2VkIHRvIG1pbnQgbmV3IHRva2VucwogICAgcmVxdWlyZShtaW50QWdlbnRzW21zZy5zZW5kZXJdKTsKICAgIF87CiAgfQoKICAvKiogTWFrZSBzdXJlIHdlIGFyZSBub3QgZG9uZSB5ZXQuICovCiAgbW9kaWZpZXIgY2FuTWludCgpIHsKICAgIHJlcXVpcmUoIW1pbnRpbmdGaW5pc2hlZCk7CiAgICBfOwogIH0KfQoKCi8qKgogKiBBIGNyb3dkc2FsZSB0b2tlbi4KICoKICogQW4gRVJDLTIwIHRva2VuIGRlc2lnbmVkIHNwZWNpZmljYWxseSBmb3IgY3Jvd2RzYWxlcyB3aXRoIGludmVzdG9yIHByb3RlY3Rpb24gYW5kIGZ1cnRoZXIgZGV2ZWxvcG1lbnQgcGF0aC4KICoKICogLSBUaGUgdG9rZW4gdHJhbnNmZXIoKSBpcyBkaXNhYmxlZCB1bnRpbCB0aGUgY3Jvd2RzYWxlIGlzIG92ZXIKICogLSBUaGUgdG9rZW4gY29udHJhY3QgZ2l2ZXMgYW4gb3B0LWluIHVwZ3JhZGUgcGF0aCB0byBhIG5ldyBjb250cmFjdAogKiAtIFRoZSBzYW1lIHRva2VuIGNhbiBiZSBwYXJ0IG9mIHNldmVyYWwgY3Jvd2RzYWxlcyB0aHJvdWdoIHRoZSBhcHByb3ZlKCkgbWVjaGFuaXNtCiAqIC0gVGhlIHRva2VuIGNhbiBiZSBjYXBwZWQgKHN1cHBseSBzZXQgaW4gdGhlIGNvbnN0cnVjdG9yKSBvciB1bmNhcHBlZCAoY3Jvd2RzYWxlIGNvbnRyYWN0IGNhbiBtaW50IG5ldyB0b2tlbnMpCiAqIC0gRVJDMjAgdG9rZW5zIHRyYW5zZmVycmVkIHRvIHRoaXMgY29udHJhY3QgY2FuIGJlIHJlY292ZXJlZCBieSBhIGxvc3QgYW5kIGZvdW5kIG1hc3RlcgogKgogKi8KY29udHJhY3QgQ3Jvd2RzYWxlVG9rZW4gaXMgUmVsZWFzYWJsZVRva2VuLCBNaW50YWJsZVRva2VuLCBVcGdyYWRlYWJsZVRva2VuLCBMb3N0QW5kRm91bmRUb2tlbiB7CgogIHN0cmluZyBwdWJsaWMgbmFtZSA9ICJUb2tlbkhvbWUiOwoKICBzdHJpbmcgcHVibGljIHN5bWJvbCA9ICJUSCI7CgogIHVpbnQ4IHB1YmxpYyBkZWNpbWFsczsKCiAgYWRkcmVzcyBwdWJsaWMgbG9zdF9hbmRfZm91bmRfbWFzdGVyOwoKICAvKioKICAgKiBDb25zdHJ1Y3QgdGhlIHRva2VuLgogICAqCiAgICogVGhpcyB0b2tlbiBtdXN0IGJlIGNyZWF0ZWQgdGhyb3VnaCBhIHRlYW0gbXVsdGlzaWcgd2FsbGV0LCBzbyB0aGF0IGl0IGlzIG93bmVkIGJ5IHRoYXQgd2FsbGV0LgogICAqCiAgICogQHBhcmFtIGluaXRpYWxfc3VwcGx5IEhvdyBtYW55IHRva2VucyB3ZSBzdGFydCB3aXRoLgogICAqIEBwYXJhbSB0b2tlbl9kZWNpbWFscyBOdW1iZXIgb2YgZGVjaW1hbCBwbGFjZXMuCiAgICogQHBhcmFtIHRlYW1fbXVsdGlzaWcgQWRkcmVzcyBvZiB0aGUgbXVsdGlzaWcgdGhhdCByZWNlaXZlcyB0aGUgaW5pdGlhbCBzdXBwbHkgYW5kIGlzIHNldCBhcyB0aGUgdXBncmFkZSBtYXN0ZXIuCiAgICogQHBhcmFtIG1pbnRhYmxlIEFyZSBuZXcgdG9rZW5zIGNyZWF0ZWQgb3ZlciB0aGUgY3Jvd2RzYWxlIG9yIGRvIHdlIGRpc3RyaWJ1dGUgb25seSB0aGUgaW5pdGlhbCBzdXBwbHk/IE5vdGUgdGhhdCB3aGVuIHRoZSB0b2tlbiBiZWNvbWVzIHRyYW5zZmVyYWJsZSB0aGUgbWludGluZyBhbHdheXMgZW5kcy4KICAgKiBAcGFyYW0gdG9rZW5fcmV0cmlldmVyIEFkZHJlc3Mgb2YgdGhlIGFjY291bnQgdGhhdCBoYW5kbGVzIEVSQzIwIHRva2VucyB0aGF0IHdlcmUgYWNjaWRlbnRhbGx5IHNlbnQgdG8gdGhpcyBjb250cmFjdC4KICAgKi8KICBmdW5jdGlvbiBDcm93ZHNhbGVUb2tlbih1aW50IGluaXRpYWxfc3VwcGx5LCB1aW50OCB0b2tlbl9kZWNpbWFscywgYWRkcmVzcyB0ZWFtX211bHRpc2lnLCBib29sIG1pbnRhYmxlLCBhZGRyZXNzIHRva2VuX3JldHJpZXZlcikgcHVibGljCiAgVXBncmFkZWFibGVUb2tlbih0ZWFtX211bHRpc2lnKSBNaW50YWJsZVRva2VuKGluaXRpYWxfc3VwcGx5LCB0ZWFtX211bHRpc2lnLCBtaW50YWJsZSkgewogICAgcmVxdWlyZSh0b2tlbl9yZXRyaWV2ZXIgIT0gYWRkcmVzcygwKSk7CiAgICBkZWNpbWFscyA9IHRva2VuX2RlY2ltYWxzOwogICAgbG9zdF9hbmRfZm91bmRfbWFzdGVyID0gdG9rZW5fcmV0cmlldmVyOwogIH0KCiAgLyoqCiAgICogV2hlbiB0b2tlbiBpcyByZWxlYXNlZCB0byBiZSB0cmFuc2ZlcmFibGUsIHByb2hpYml0IG5ldyB0b2tlbiBjcmVhdGlvbi4KICAgKi8KICBmdW5jdGlvbiByZWxlYXNlVG9rZW5UcmFuc2ZlcigpIHB1YmxpYyBvbmx5UmVsZWFzZUFnZW50IHsKICAgIG1pbnRpbmdGaW5pc2hlZCA9IHRydWU7CiAgICBzdXBlci5yZWxlYXNlVG9rZW5UcmFuc2ZlcigpOwogIH0KCiAgZnVuY3Rpb24gYnVybiggdWludCB2YWx1ZSkgcHVibGljIHsKICAgIGJ1cm5Ub2tlbnMobXNnLnNlbmRlciwgdmFsdWUpOwogIH0KCiAgLyoqCiAgICogQWxsb3cgdXBncmFkZSBhZ2VudCBmdW5jdGlvbmFsaXR5IHRvIGtpY2sgaW4gb25seSBpZiB0aGUgY3Jvd2RzYWxlIHdhcyBhIHN1Y2Nlc3MuCiAgICovCiAgZnVuY3Rpb24gY2FuVXBncmFkZSgpIHB1YmxpYyB2aWV3IHJldHVybnMoYm9vbCkgewogICAgcmV0dXJuIHJlbGVhc2VkICYmIHN1cGVyLmNhblVwZ3JhZGUoKTsKICB9CgogIGZ1bmN0aW9uIGdldExvc3RBbmRGb3VuZE1hc3RlcigpIGludGVybmFsIHZpZXcgcmV0dXJucyhhZGRyZXNzKSB7CiAgICByZXR1cm4gbG9zdF9hbmRfZm91bmRfbWFzdGVyOwogIH0KCn0KLyoqCiAqIEFic3RyYWN0IGJhc2UgY29udHJhY3QgZm9yIHRva2VuIHNhbGVzLgogKgogKiBIYW5kbGVzCiAqIC0gc3RhcnQgYW5kIGVuZCBkYXRlcwogKiAtIGFjY2VwdGluZyBpbnZlc3RtZW50cwogKiAtIHZhcmlvdXMgc3RhdGlzdGljcyBkdXJpbmcgdGhlIGNyb3dkZnVuZAogKiAtIGRpZmZlcmVudCBpbnZlc3RtZW50IHBvbGljaWVzIChyZXF1aXJlIHNlcnZlciBzaWRlIGN1c3RvbWVyIGlkLCBhbGxvdyBvbmx5IHdoaXRlbGlzdGVkIGFkZHJlc3NlcykKICoKICovCmNvbnRyYWN0IEdlbmVyaWNDcm93ZHNhbGUgaXMgSGFsdGFibGUgewoKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgLyogVGhlIHRva2VuIHdlIGFyZSBzZWxsaW5nICovCiAgQ3Jvd2RzYWxlVG9rZW4gcHVibGljIHRva2VuOwoKICAvKiBldGhlciB3aWxsIGJlIHRyYW5zZmVycmVkIHRvIHRoaXMgYWRkcmVzcyAqLwogIGFkZHJlc3MgcHVibGljIG11bHRpc2lnV2FsbGV0OwoKICAvKiB0aGUgc3RhcnRpbmcgYmxvY2sgbnVtYmVyIG9mIHRoZSBjcm93ZHNhbGUgKi8KICB1aW50IHB1YmxpYyBzdGFydHNBdDsKCiAgLyogdGhlIGVuZGluZyBibG9jayBudW1iZXIgb2YgdGhlIGNyb3dkc2FsZSAqLwogIHVpbnQgcHVibGljIGVuZHNBdDsKCiAgLyogdGhlIG51bWJlciBvZiB0b2tlbnMgYWxyZWFkeSBzb2xkIHRocm91Z2ggdGhpcyBjb250cmFjdCovCiAgdWludCBwdWJsaWMgdG9rZW5zU29sZCA9IDA7CgogIC8qIEhvdyBtYW55IHdlaSBvZiBmdW5kaW5nIHdlIGhhdmUgcmFpc2VkICovCiAgdWludCBwdWJsaWMgd2VpUmFpc2VkID0gMDsKCiAgLyogSG93IG1hbnkgZGlzdGluY3QgYWRkcmVzc2VzIGhhdmUgaW52ZXN0ZWQgKi8KICB1aW50IHB1YmxpYyBpbnZlc3RvckNvdW50ID0gMDsKCiAgLyogSGFzIHRoaXMgY3Jvd2RzYWxlIGJlZW4gZmluYWxpemVkICovCiAgYm9vbCBwdWJsaWMgZmluYWxpemVkID0gZmFsc2U7CgogIC8qIERvIHdlIG5lZWQgdG8gaGF2ZSBhIHVuaXF1ZSBjb250cmlidXRvciBpZCBmb3IgZWFjaCBjdXN0b21lciAqLwogIGJvb2wgcHVibGljIHJlcXVpcmVDdXN0b21lcklkID0gZmFsc2U7CgogIC8qKgogICAqIERvIHdlIHZlcmlmeSB0aGF0IGNvbnRyaWJ1dG9yIGhhcyBiZWVuIGNsZWFyZWQgb24gdGhlIHNlcnZlciBzaWRlIChhY2NyZWRpdGVkIGludmVzdG9ycyBvbmx5KS4KICAgKiBUaGlzIG1ldGhvZCB3YXMgZmlyc3QgdXNlZCBpbiB0aGUgRmlyc3RCbG9vZCBjcm93ZHNhbGUgdG8gZW5zdXJlIGFsbCBjb250cmlidXRvcnMgaGFkIGFjY2VwdGVkIHRlcm1zIG9mIHNhbGUgKG9uIHRoZSB3ZWIpLgogICAqLwogIGJvb2wgcHVibGljIHJlcXVpcmVkU2lnbmVkQWRkcmVzcyA9IHRydWU7CgogIC8qKiBTZXJ2ZXIgc2lkZSBhZGRyZXNzIHRoYXQgc2lnbmVkIGFsbG93ZWQgY29udHJpYnV0b3JzIChFdGhlcmV1bSBhZGRyZXNzZXMpIHRoYXQgY2FuIHBhcnRpY2lwYXRlIHRoZSBjcm93ZHNhbGUgKi8KICBhZGRyZXNzIHB1YmxpYyBzaWduZXJBZGRyZXNzOwoKICAvKiogSG93IG1hbnkgRVRIIGVhY2ggYWRkcmVzcyBoYXMgaW52ZXN0ZWQgaW4gdGhpcyBjcm93ZHNhbGUgKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyBpbnZlc3RlZEFtb3VudE9mOwoKICAvKiogSG93IG1hbnkgdG9rZW5zIHRoaXMgY3Jvd2RzYWxlIGhhcyBjcmVkaXRlZCBmb3IgZWFjaCBpbnZlc3RvciBhZGRyZXNzICovCiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgdG9rZW5BbW91bnRPZjsKCiAgLyoqIEFkZHJlc3NlcyB0aGF0IGFyZSBhbGxvd2VkIHRvIGludmVzdCBldmVuIGJlZm9yZSBJQ08gb2ZmaWNpYWxseSBvcGVucy4gRm9yIHRlc3RpbmcsIGZvciBJQ08gcGFydG5lcnMsIGV0Yy4gKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBlYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0OwoKICAvKiogU3RhdGUgbWFjaGluZQogICAqCiAgICogLSBQcmVmdW5kaW5nOiBXZSBoYXZlIG5vdCByZWFjaGVkIHRoZSBzdGFydGluZyBibG9jayB5ZXQKICAgKiAtIEZ1bmRpbmc6IEFjdGl2ZSBjcm93ZHNhbGUKICAgKiAtIFN1Y2Nlc3M6IENyb3dkc2FsZSBlbmRlZAogICAqIC0gRmluYWxpemVkOiBUaGUgZmluYWxpemUgZnVuY3Rpb24gaGFzIGJlZW4gY2FsbGVkIGFuZCBzdWNjZXNmdWxseSBleGVjdXRlZAogICAqLwogIGVudW0gU3RhdGV7VW5rbm93biwgUHJlRnVuZGluZywgRnVuZGluZywgU3VjY2VzcywgRmluYWxpemVkfQoKCiAgLy8gQSBuZXcgaW52ZXN0bWVudCB3YXMgbWFkZQogIGV2ZW50IEludmVzdGVkKGFkZHJlc3MgaW52ZXN0b3IsIHVpbnQgd2VpQW1vdW50LCB1aW50IHRva2VuQW1vdW50LCB1aW50MTI4IGN1c3RvbWVySWQpOwoKICAvLyBUaGUgcnVsZXMgYWJvdXQgd2hhdCBraW5kIG9mIGludmVzdG1lbnRzIHdlIGFjY2VwdCB3ZXJlIGNoYW5nZWQKICBldmVudCBJbnZlc3RtZW50UG9saWN5Q2hhbmdlZChib29sIHJlcXVpcmVDSWQsIGJvb2wgcmVxdWlyZVNpZ25lZEFkZHJlc3MsIGFkZHJlc3Mgc2lnbmVyKTsKCiAgLy8gQWRkcmVzcyBlYXJseSBwYXJ0aWNpcGF0aW9uIHdoaXRlbGlzdCBzdGF0dXMgY2hhbmdlZAogIGV2ZW50IFdoaXRlbGlzdGVkKGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0dXMpOwoKICAvLyBDcm93ZHNhbGUncyBmaW5hbGl6ZSBmdW5jdGlvbiBoYXMgYmVlbiBjYWxsZWQKICBldmVudCBGaW5hbGl6ZWQoKTsKCgogIC8qKgogICAqIEJhc2ljIGNvbnN0cnVjdG9yIGZvciB0aGUgY3Jvd2RzYWxlLgogICAqIEBwYXJhbSB0ZWFtX211bHRpc2lnIEFkZHJlc3Mgb2YgdGhlIG11bHRpc2lnbmF0dXJlIHdhbGxldCBvZiB0aGUgdGVhbSB0aGF0IHdpbGwgcmVjZWl2ZSBhbGwgdGhlIGZ1bmRzIGNvbnRyaWJ1dGVkIGluIHRoZSBjcm93ZHNhbGUuCiAgICogQHBhcmFtIHN0YXJ0IEJsb2NrIG51bWJlciB3aGVyZSB0aGUgY3Jvd2RzYWxlIHdpbGwgYmUgb2ZmaWNpYWxseSBzdGFydGVkLiBJdCBzaG91bGQgYmUgZ3JlYXRlciB0aGFuIHRoZSBibG9jayBudW1iZXIgaW4gd2hpY2ggdGhlIGNvbnRyYWN0IGlzIGRlcGxveWVkLgogICAqIEBwYXJhbSBlbmQgQmxvY2sgbnVtYmVyIHdoZXJlIHRoZSBjcm93ZHNhbGUgZmluaXNoZXMuIE5vIHRva2VucyBjYW4gYmUgc29sZCB0aHJvdWdoIHRoaXMgY29udHJhY3QgYWZ0ZXIgdGhpcyBibG9jay4KICAgKi8KICBmdW5jdGlvbiBHZW5lcmljQ3Jvd2RzYWxlKGFkZHJlc3MgdGVhbV9tdWx0aXNpZywgdWludCBzdGFydCwgdWludCBlbmQpIGludGVybmFsIHsKICAgIHNldE11bHRpc2lnKHRlYW1fbXVsdGlzaWcpOwoKICAgIC8vIERvbid0IG1lc3MgdGhlIGRhdGVzCiAgICByZXF1aXJlKHN0YXJ0ICE9IDAgJiYgZW5kICE9IDApOwogICAgcmVxdWlyZShibG9jay50aW1lc3RhbXAgPCBzdGFydCAmJiBzdGFydCA8IGVuZCk7CiAgICBzdGFydHNBdCA9IHN0YXJ0OwogICAgZW5kc0F0ID0gZW5kOwogIH0KCiAgLyoqCiAgICogRGVmYXVsdCBmYWxsYmFjayBiZWhhdmlvdXIgaXMgdG8gY2FsbCBidXkuCiAgICogSWRlYWxseSwgbm8gY29udHJhY3QgY2FsbHMgdGhpcyBjcm93ZHNhbGUgd2l0aG91dCBzdXBwb3J0aW5nIEVSQzIwLgogICAqIEhvd2V2ZXIsIHNvbWUgc29ydCBvZiByZWZ1bmRpbmcgZnVuY3Rpb24gbWF5IGJlIGRlc2lyZWQgdG8gY292ZXIgc3VjaCBzaXR1YXRpb25zLgogICAqLwogIGZ1bmN0aW9uKCkgcGF5YWJsZSBwdWJsaWMgewogICAgYnV5KCk7CiAgfQoKICAvKioKICAgKiBNYWtlIGFuIGludmVzdG1lbnQuCiAgICoKICAgKiBUaGUgY3Jvd2RzYWxlIG11c3QgYmUgcnVubmluZyBmb3Igb25lIHRvIGludmVzdC4KICAgKiBXZSBtdXN0IGhhdmUgbm90IHByZXNzZWQgdGhlIGVtZXJnZW5jeSBicmFrZS4KICAgKgogICAqIEBwYXJhbSByZWNlaXZlciBUaGUgRXRoZXJldW0gYWRkcmVzcyB3aG8gcmVjZWl2ZXMgdGhlIHRva2VucwogICAqIEBwYXJhbSBjdXN0b21lcklkIChvcHRpb25hbCkgVVVJRCB2NCB0byB0cmFjayB0aGUgc3VjY2Vzc2Z1bCBwYXltZW50cyBvbiB0aGUgc2VydmVyIHNpZGUKICAgKgogICAqLwogIGZ1bmN0aW9uIGludmVzdEludGVybmFsKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQxMjggY3VzdG9tZXJJZCkgc3RvcEluRW1lcmdlbmN5IG5vdEZpbmlzaGVkIHByaXZhdGUgewogICAgLy8gRGV0ZXJtaW5lIGlmIGl0J3MgYSBnb29kIHRpbWUgdG8gYWNjZXB0IGludmVzdG1lbnQgZnJvbSB0aGlzIHBhcnRpY2lwYW50CiAgICBpZiAoZ2V0U3RhdGUoKSA9PSBTdGF0ZS5QcmVGdW5kaW5nKSB7CiAgICAgIC8vIEFyZSB3ZSB3aGl0ZWxpc3RlZCBmb3IgZWFybHkgZGVwb3NpdAogICAgICByZXF1aXJlKGVhcmx5UGFydGljaXBhbnRXaGl0ZWxpc3RbbXNnLnNlbmRlcl0pOwogICAgfQoKICAgIHVpbnQgd2VpQW1vdW50OwogICAgdWludCB0b2tlbkFtb3VudDsKICAgICh3ZWlBbW91bnQsIHRva2VuQW1vdW50KSA9IGNhbGN1bGF0ZVRva2VuQW1vdW50KG1zZy52YWx1ZSwgcmVjZWl2ZXIpOwogICAgLy8gU2FuaXR5IGNoZWNrIGFnYWluc3QgYmFkIGltcGxlbWVudGF0aW9uLgogICAgYXNzZXJ0KHdlaUFtb3VudCA8PSBtc2cudmFsdWUpOwogICAgCiAgICAvLyBEdXN0IHRyYW5zYWN0aW9uIGlmIG5vIHRva2VucyBjYW4gYmUgZ2l2ZW4KICAgIHJlcXVpcmUodG9rZW5BbW91bnQgIT0gMCk7CgogICAgaWYgKGludmVzdGVkQW1vdW50T2ZbcmVjZWl2ZXJdID09IDApIHsKICAgICAgLy8gQSBuZXcgaW52ZXN0b3IKICAgICAgaW52ZXN0b3JDb3VudCsrOwogICAgfQogICAgdXBkYXRlSW52ZXN0b3JGdW5kcyh0b2tlbkFtb3VudCwgd2VpQW1vdW50LCByZWNlaXZlciwgY3VzdG9tZXJJZCk7CgogICAgLy8gUG9ja2V0IHRoZSBtb25leQogICAgbXVsdGlzaWdXYWxsZXQudHJhbnNmZXIod2VpQW1vdW50KTsKCiAgICAvLyBSZXR1cm4gZXhjZXNzIG9mIG1vbmV5CiAgICByZXR1cm5FeGNlZGVudChtc2cudmFsdWUuc3ViKHdlaUFtb3VudCksIG1zZy5zZW5kZXIpOwogIH0KCiAgLyoqCiAgICogUHJlYWxsb2NhdGUgdG9rZW5zIGZvciB0aGUgZWFybHkgaW52ZXN0b3JzLgogICAqCiAgICogUHJlYWxsb2NhdGVkIHRva2VucyBoYXZlIGJlZW4gc29sZCBiZWZvcmUgdGhlIGFjdHVhbCBjcm93ZHNhbGUgb3BlbnMuCiAgICogVGhpcyBmdW5jdGlvbiBtaW50cyB0aGUgdG9rZW5zIGFuZCBtb3ZlcyB0aGUgY3Jvd2RzYWxlIG5lZWRsZS4KICAgKgogICAqIE5vIG1vbmV5IGlzIGV4Y2hhbmdlZCwgYXMgdGhlIGNyb3dkc2FsZSB0ZWFtIGFscmVhZHkgaGF2ZSByZWNlaXZlZCB0aGUgcGF5bWVudC4KICAgKgogICAqIEBwYXJhbSByZWNlaXZlciBBY2NvdW50IHRoYXQgcmVjZWl2ZXMgdGhlIHRva2Vucy4KICAgKiBAcGFyYW0gZnVsbFRva2VucyB0b2tlbnMgYXMgZnVsbCB0b2tlbnMgLSBkZWNpbWFsIHBsYWNlcyBhcmUgYWRkZWQgaW50ZXJuYWxseS4KICAgKiBAcGFyYW0gd2VpUHJpY2UgUHJpY2Ugb2YgYSBzaW5nbGUgaW5kaXZpc2libGUgdG9rZW4gaW4gd2VpLgogICAqCiAgICovCiAgZnVuY3Rpb24gcHJlYWxsb2NhdGUoYWRkcmVzcyByZWNlaXZlciwgdWludCBmdWxsVG9rZW5zLCB1aW50IHdlaVByaWNlKSBwdWJsaWMgb25seU93bmVyIG5vdEZpbmlzaGVkIHsKICAgIHJlcXVpcmUocmVjZWl2ZXIgIT0gYWRkcmVzcygwKSk7CiAgICB1aW50IHRva2VuQW1vdW50ID0gZnVsbFRva2Vucy5tdWwoMTAqKnVpbnQodG9rZW4uZGVjaW1hbHMoKSkpOwogICAgcmVxdWlyZSh0b2tlbkFtb3VudCAhPSAwKTsKICAgIHVpbnQgd2VpQW1vdW50ID0gd2VpUHJpY2UubXVsKHRva2VuQW1vdW50KTsgLy8gVGhpcyBjYW4gYWxzbyBiZSAwLCBpbiB3aGljaCBjYXNlIHdlIGdpdmUgb3V0IHRva2VucyBmb3IgZnJlZQogICAgdXBkYXRlSW52ZXN0b3JGdW5kcyh0b2tlbkFtb3VudCwgd2VpQW1vdW50LCByZWNlaXZlciAsIDApOwogIH0KCiAgLyoqCiAgICogUHJpdmF0ZSBmdW5jdGlvbiB0byB1cGRhdGUgYWNjb3VudGluZyBpbiB0aGUgY3Jvd2RzYWxlLgogICAqLwogIGZ1bmN0aW9uIHVwZGF0ZUludmVzdG9yRnVuZHModWludCB0b2tlbkFtb3VudCwgdWludCB3ZWlBbW91bnQsIGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQxMjggY3VzdG9tZXJJZCkgcHJpdmF0ZSB7CiAgICAvLyBVcGRhdGUgaW52ZXN0b3IKICAgIGludmVzdGVkQW1vdW50T2ZbcmVjZWl2ZXJdID0gaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0uYWRkKHdlaUFtb3VudCk7CiAgICB0b2tlbkFtb3VudE9mW3JlY2VpdmVyXSA9IHRva2VuQW1vdW50T2ZbcmVjZWl2ZXJdLmFkZCh0b2tlbkFtb3VudCk7CgogICAgLy8gVXBkYXRlIHRvdGFscwogICAgd2VpUmFpc2VkID0gd2VpUmFpc2VkLmFkZCh3ZWlBbW91bnQpOwogICAgdG9rZW5zU29sZCA9IHRva2Vuc1NvbGQuYWRkKHRva2VuQW1vdW50KTsKCiAgICBhc3NpZ25Ub2tlbnMocmVjZWl2ZXIsIHRva2VuQW1vdW50KTsKICAgIC8vIFRlbGwgdXMgdGhhdCB0aGUgaW52ZXN0bWVudCB3YXMgY29tcGxldGVkIHN1Y2Nlc3NmdWxseQogICAgSW52ZXN0ZWQocmVjZWl2ZXIsIHdlaUFtb3VudCwgdG9rZW5BbW91bnQsIGN1c3RvbWVySWQpOwogIH0KCiAgLyoqCiAgICogSW52ZXN0aW5nIGZ1bmN0aW9uIHRoYXQgcmVjb2duaXplcyB0aGUgcmVjZWl2ZXIgYW5kIHZlcmlmaWVzIGhlIGlzIGFsbG93ZWQgdG8gaW52ZXN0LgogICAqCiAgICogQHBhcmFtIGN1c3RvbWVySWQgVVVJRHY0IHRoYXQgaWRlbnRpZmllcyB0aGlzIGNvbnRyaWJ1dG9yCiAgICovCiAgZnVuY3Rpb24gYnV5T25CZWhhbGZXaXRoU2lnbmVkQWRkcmVzcyhhZGRyZXNzIHJlY2VpdmVyLCB1aW50MTI4IGN1c3RvbWVySWQsIHVpbnQ4IHYsIGJ5dGVzMzIgciwgYnl0ZXMzMiBzKSBwdWJsaWMgcGF5YWJsZSB2YWxpZEN1c3RvbWVySWQoY3VzdG9tZXJJZCkgewogICAgYnl0ZXMzMiBoYXNoID0gc2hhMjU2KHJlY2VpdmVyKTsKICAgIHJlcXVpcmUoZWNyZWNvdmVyKGhhc2gsIHYsIHIsIHMpID09IHNpZ25lckFkZHJlc3MpOwogICAgaW52ZXN0SW50ZXJuYWwocmVjZWl2ZXIsIGN1c3RvbWVySWQpOwogIH0KCiAgLyoqCiAgICogSW52ZXN0aW5nIGZ1bmN0aW9uIHRoYXQgcmVjb2duaXplcyB0aGUgcmVjZWl2ZXIuCiAgICogCiAgICogQHBhcmFtIGN1c3RvbWVySWQgVVVJRHY0IHRoYXQgaWRlbnRpZmllcyB0aGlzIGNvbnRyaWJ1dG9yCiAgICovCiAgZnVuY3Rpb24gYnV5T25CZWhhbGZXaXRoQ3VzdG9tZXJJZChhZGRyZXNzIHJlY2VpdmVyLCB1aW50MTI4IGN1c3RvbWVySWQpIHB1YmxpYyBwYXlhYmxlIHZhbGlkQ3VzdG9tZXJJZChjdXN0b21lcklkKSB1bnNpZ25lZEJ1eUFsbG93ZWQgewogICAgaW52ZXN0SW50ZXJuYWwocmVjZWl2ZXIsIGN1c3RvbWVySWQpOwogIH0KCiAgLyoqCiAgICogQnV5cyB0b2tlbnMgb24gYmVoYWxmIG9mIGFuIGFkZHJlc3MuCiAgICoKICAgKiBQYXkgZm9yIGZ1bmRpbmcsIGdldCBpbnZlc3RlZCB0b2tlbnMgYmFjayBpbiB0aGUgcmVjZWl2ZXIgYWRkcmVzcy4KICAgKi8KICBmdW5jdGlvbiBidXlPbkJlaGFsZihhZGRyZXNzIHJlY2VpdmVyKSBwdWJsaWMgcGF5YWJsZSB1bnNpZ25lZEJ1eUFsbG93ZWQgewogICAgcmVxdWlyZSghcmVxdWlyZUN1c3RvbWVySWQpOyAvLyBDcm93ZHNhbGUgbmVlZHMgdG8gdHJhY2sgcGFydGljaXBhbnRzIGZvciB0aGFuayB5b3UgZW1haWwKICAgIGludmVzdEludGVybmFsKHJlY2VpdmVyLCAwKTsKICB9CgogIC8qKgogICAqIEludmVzdGluZyBmdW5jdGlvbiB0aGF0IHJlY29nbml6ZXMgdGhlIHBheWVyIGFuZCB2ZXJpZmllcyBoZSBpcyBhbGxvd2VkIHRvIGludmVzdC4KICAgKgogICAqIEBwYXJhbSBjdXN0b21lcklkIFVVSUR2NCB0aGF0IGlkZW50aWZpZXMgdGhpcyBjb250cmlidXRvcgogICAqLwogIGZ1bmN0aW9uIGJ1eVdpdGhTaWduZWRBZGRyZXNzKHVpbnQxMjggY3VzdG9tZXJJZCwgdWludDggdiwgYnl0ZXMzMiByLCBieXRlczMyIHMpIHB1YmxpYyBwYXlhYmxlIHsKICAgIGJ1eU9uQmVoYWxmV2l0aFNpZ25lZEFkZHJlc3MobXNnLnNlbmRlciwgY3VzdG9tZXJJZCwgdiwgciwgcyk7CiAgfQoKCiAgLyoqCiAgICogSW52ZXN0aW5nIGZ1bmN0aW9uIHRoYXQgcmVjb2duaXplcyB0aGUgcGF5ZXIuCiAgICogCiAgICogQHBhcmFtIGN1c3RvbWVySWQgVVVJRHY0IHRoYXQgaWRlbnRpZmllcyB0aGlzIGNvbnRyaWJ1dG9yCiAgICovCiAgZnVuY3Rpb24gYnV5V2l0aEN1c3RvbWVySWQodWludDEyOCBjdXN0b21lcklkKSBwdWJsaWMgcGF5YWJsZSB7CiAgICBidXlPbkJlaGFsZldpdGhDdXN0b21lcklkKG1zZy5zZW5kZXIsIGN1c3RvbWVySWQpOwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2ljIGVudHJ5IHBvaW50IHRvIHBhcnRpY2lwYXRlIGluIHRoZSBjcm93ZHNhbGUgcHJvY2Vzcy4KICAgKgogICAqIFBheSBmb3IgZnVuZGluZywgZ2V0IGludmVzdGVkIHRva2VucyBiYWNrIGluIHRoZSBzZW5kZXIgYWRkcmVzcy4KICAgKi8KICBmdW5jdGlvbiBidXkoKSBwdWJsaWMgcGF5YWJsZSB7CiAgICBidXlPbkJlaGFsZihtc2cuc2VuZGVyKTsKICB9CgogIC8qKgogICAqIEZpbmFsaXplIGEgc3VjY2Nlc2Z1bCBjcm93ZHNhbGUuCiAgICoKICAgKiBUaGUgb3duZXIgY2FuIHRyaWdnZXIgcG9zdC1jcm93ZHNhbGUgYWN0aW9ucywgbGlrZSByZWxlYXNpbmcgdGhlIHRva2Vucy4KICAgKiBOb3RlIHRoYXQgYnkgZGVmYXVsdCB0b2tlbnMgYXJlIG5vdCBpbiBhIHJlbGVhc2VkIHN0YXRlLgogICAqLwogIGZ1bmN0aW9uIGZpbmFsaXplKCkgcHVibGljIGluU3RhdGUoU3RhdGUuU3VjY2Vzcykgb25seU93bmVyIHN0b3BJbkVtZXJnZW5jeSB7CiAgICBmaW5hbGl6ZWQgPSB0cnVlOwogICAgRmluYWxpemVkKCk7CiAgfQoKICAvKioKICAgKiBTZXQgcG9saWN5IGRvIHdlIG5lZWQgdG8gaGF2ZSBzZXJ2ZXItc2lkZSBjdXN0b21lciBpZHMgZm9yIHRoZSBpbnZlc3RtZW50cy4KICAgKgogICAqLwogIGZ1bmN0aW9uIHNldFJlcXVpcmVDdXN0b21lcklkKGJvb2wgdmFsdWUpIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZUN1c3RvbWVySWQgPSB2YWx1ZTsKICAgIEludmVzdG1lbnRQb2xpY3lDaGFuZ2VkKHJlcXVpcmVDdXN0b21lcklkLCByZXF1aXJlZFNpZ25lZEFkZHJlc3MsIHNpZ25lckFkZHJlc3MpOwogIH0KCiAgLyoqCiAgICogU2V0IHBvbGljeSBpZiBhbGwgaW52ZXN0b3JzIG11c3QgYmUgY2xlYXJlZCBvbiB0aGUgc2VydmVyIHNpZGUgZmlyc3QuCiAgICoKICAgKiBUaGlzIGlzIGUuZy4gZm9yIHRoZSBhY2NyZWRpdGVkIGludmVzdG9yIGNsZWFyaW5nLgogICAqCiAgICovCiAgZnVuY3Rpb24gc2V0UmVxdWlyZVNpZ25lZEFkZHJlc3MoYm9vbCB2YWx1ZSwgYWRkcmVzcyBzaWduZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZWRTaWduZWRBZGRyZXNzID0gdmFsdWU7CiAgICBzaWduZXJBZGRyZXNzID0gc2lnbmVyOwogICAgSW52ZXN0bWVudFBvbGljeUNoYW5nZWQocmVxdWlyZUN1c3RvbWVySWQsIHJlcXVpcmVkU2lnbmVkQWRkcmVzcywgc2lnbmVyQWRkcmVzcyk7CiAgfQoKICAvKioKICAgKiBBbGxvdyBhZGRyZXNzZXMgdG8gZG8gZWFybHkgcGFydGljaXBhdGlvbi4KICAgKi8KICBmdW5jdGlvbiBzZXRFYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0KGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0dXMpIHB1YmxpYyBvbmx5T3duZXIgbm90RmluaXNoZWQgc3RvcEluRW1lcmdlbmN5IHsKICAgIGVhcmx5UGFydGljaXBhbnRXaGl0ZWxpc3RbYWRkcl0gPSBzdGF0dXM7CiAgICBXaGl0ZWxpc3RlZChhZGRyLCBzdGF0dXMpOwogIH0KCiAgLyoqCiAgICogSW50ZXJuYWwgc2V0dGVyIGZvciB0aGUgbXVsdGlzaWcgd2FsbGV0CiAgICovCiAgZnVuY3Rpb24gc2V0TXVsdGlzaWcoYWRkcmVzcyBhZGRyKSBpbnRlcm5hbCB7CiAgICByZXF1aXJlKGFkZHIgIT0gMCk7CiAgICBtdWx0aXNpZ1dhbGxldCA9IGFkZHI7CiAgfQoKICAvKioKICAgKiBDcm93ZGZ1bmQgc3RhdGUgbWFjaGluZSBtYW5hZ2VtZW50LgogICAqCiAgICogVGhpcyBmdW5jdGlvbiBoYXMgdGhlIHRpbWVkIHRyYW5zaXRpb24gYnVpbHRpbi4KICAgKiBTbyB0aGVyZSBpcyBubyBjaGFuY2Ugb2YgdGhlIHZhcmlhYmxlIGJlaW5nIHN0YWxlLgogICAqLwogIGZ1bmN0aW9uIGdldFN0YXRlKCkgcHVibGljIHZpZXcgcmV0dXJucyAoU3RhdGUpIHsKICAgIGlmIChmaW5hbGl6ZWQpIHJldHVybiBTdGF0ZS5GaW5hbGl6ZWQ7CiAgICBlbHNlIGlmIChibG9jay50aW1lc3RhbXAgPCBzdGFydHNBdCkgcmV0dXJuIFN0YXRlLlByZUZ1bmRpbmc7CiAgICBlbHNlIGlmIChibG9jay50aW1lc3RhbXAgPD0gZW5kc0F0ICYmICFpc0Nyb3dkc2FsZUZ1bGwoKSkgcmV0dXJuIFN0YXRlLkZ1bmRpbmc7CiAgICBlbHNlIHJldHVybiBTdGF0ZS5TdWNjZXNzOwogIH0KCiAgLyoqIEludGVybmFsIGZ1bmN0aW9ucyB0aGF0IGV4aXN0IHRvIHByb3ZpZGUgaW52ZXJzaW9uIG9mIGNvbnRyb2wgc2hvdWxkIHRoZXkgYmUgb3ZlcnJpZGVuICovCgogIC8qKiBJbnRlcmZhY2UgZm9yIHRoZSBjb25jcmV0ZSBpbnN0YW5jZSB0byBpbnRlcmFjdCB3aXRoIHRoZSB0b2tlbiBjb250cmFjdCBpbiBhIGN1c3RvbWl6YWJsZSB3YXkgKi8KICBmdW5jdGlvbiBhc3NpZ25Ub2tlbnMoYWRkcmVzcyByZWNlaXZlciwgdWludCB0b2tlbkFtb3VudCkgaW50ZXJuYWw7CgogIC8qKgogICAqICBEZXRlcm1pbmUgaWYgdGhlIGdvYWwgd2FzIGFscmVhZHkgcmVhY2hlZCBpbiB0aGUgY3VycmVudCBjcm93ZHNhbGUKICAgKi8KICBmdW5jdGlvbiBpc0Nyb3dkc2FsZUZ1bGwoKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wgZnVsbCk7CgogIC8qKgogICAqIFJldHVybnMgYW55IGV4Y2VzcyB3ZWkgcmVjZWl2ZWQKICAgKiAKICAgKiBUaGlzIGZ1bmN0aW9uIGNhbiBiZSBvdmVycmlkZW4gdG8gcHJvdmlkZSBhIGRpZmZlcmVudCByZWZ1bmRpbmcgbWV0aG9kLgogICAqLwogIGZ1bmN0aW9uIHJldHVybkV4Y2VkZW50KHVpbnQgZXhjZWRlbnQsIGFkZHJlc3MgcmVjZWl2ZXIpIGludGVybmFsIHsKICAgIGlmIChleGNlZGVudCA+IDApIHsKICAgICAgcmVjZWl2ZXIudHJhbnNmZXIoZXhjZWRlbnQpOwogICAgfQogIH0KCiAgLyoqIAogICAqICBDYWxjdWxhdGUgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBjb3JyZXNwb25kcyB0byB0aGUgcmVjZWl2ZWQgYW1vdW50LgogICAqICBUaGUgd2VpIGFtb3VudCBpcyByZXR1cm5lZCB0b28gaW4gY2FzZSBub3QgYWxsIG9mIGl0IGNhbiBiZSBpbnZlc3RlZC4KICAgKgogICAqICBOb3RlOiBXaGVuIHRoZXJlJ3MgYW4gZXhjZWRlbnQgZHVlIHRvIHJvdW5kaW5nIGVycm9yLCBpdCBzaG91bGQgYmUgcmV0dXJuZWQgdG8gYWxsb3cgcmVmdW5kaW5nLgogICAqICBUaGlzIGlzIHdvcmtlZCBhcm91bmQgaW4gdGhlIGN1cnJlbnQgZGVzaWduIHVzaW5nIGFuIGFwcHJvcHJpYXRlIGFtb3VudCBvZiBkZWNpbWFscyBpbiB0aGUgRnJhY3Rpb25hbEVSQzIwIHN0YW5kYXJkLgogICAqICBUaGUgd29ya2Fyb3VuZCBpcyBnb29kIGVub3VnaCBmb3IgbW9zdCB1c2UgY2FzZXMsIGhlbmNlIHRoZSBzaW1wbGlmaWVkIGZ1bmN0aW9uIHNpZ25hdHVyZS4KICAgKiAgQHJldHVybiB3ZWlBbGxvd2VkIFRoZSBhbW91bnQgb2Ygd2VpIGFjY2VwdGVkIGluIHRoaXMgdHJhbnNhY3Rpb24uCiAgICogIEByZXR1cm4gdG9rZW5BbW91bnQgVGhlIHRva2VucyB0aGF0IGFyZSBhc3NpZ25lZCB0byB0aGUgcmVjZWl2ZXIgaW4gdGhpcyB0cmFuc2FjdGlvbi4KICAgKi8KICBmdW5jdGlvbiBjYWxjdWxhdGVUb2tlbkFtb3VudCh1aW50IHdlaUFtb3VudCwgYWRkcmVzcyByZWNlaXZlcikgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50IHdlaUFsbG93ZWQsIHVpbnQgdG9rZW5BbW91bnQpOwoKICAvLwogIC8vIE1vZGlmaWVycwogIC8vCgogIG1vZGlmaWVyIGluU3RhdGUoU3RhdGUgc3RhdGUpIHsKICAgIHJlcXVpcmUoZ2V0U3RhdGUoKSA9PSBzdGF0ZSk7CiAgICBfOwogIH0KCiAgbW9kaWZpZXIgdW5zaWduZWRCdXlBbGxvd2VkKCkgewogICAgcmVxdWlyZSghcmVxdWlyZWRTaWduZWRBZGRyZXNzKTsKICAgIF87CiAgfQoKICAvKiogTW9kaWZpZXIgYWxsb3dpbmcgZXhlY3V0aW9uIG9ubHkgaWYgdGhlIGNyb3dkc2FsZSBpcyBjdXJyZW50bHkgcnVubmluZy4gICovCiAgbW9kaWZpZXIgbm90RmluaXNoZWQoKSB7CiAgICBTdGF0ZSBjdXJyZW50X3N0YXRlID0gZ2V0U3RhdGUoKTsKICAgIHJlcXVpcmUoY3VycmVudF9zdGF0ZSA9PSBTdGF0ZS5QcmVGdW5kaW5nIHx8IGN1cnJlbnRfc3RhdGUgPT0gU3RhdGUuRnVuZGluZyk7CiAgICBfOwogIH0KCiAgbW9kaWZpZXIgdmFsaWRDdXN0b21lcklkKHVpbnQxMjggY3VzdG9tZXJJZCkgewogICAgcmVxdWlyZShjdXN0b21lcklkICE9IDApOyAgLy8gVVVJRHY0IHNhbml0eSBjaGVjawogICAgXzsKICB9Cgp9CgoKCgoKLy8gU2ltcGxlIGRlcGxveW1lbnQgaW5mb3JtYXRpb24gc3RvcmUgaW5zaWRlIGNvbnRyYWN0IHN0b3JhZ2UuCmNvbnRyYWN0IERlcGxveW1lbnRJbmZvIHsKICB1aW50IHByaXZhdGUgZGVwbG95ZWRfb247CgogIGZ1bmN0aW9uIERlcGxveW1lbnRJbmZvKCkgcHVibGljIHsKICAgIGRlcGxveWVkX29uID0gYmxvY2subnVtYmVyOwogIH0KCgogIGZ1bmN0aW9uIGdldERlcGxveW1lbnRCbG9jaygpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiBkZXBsb3llZF9vbjsKICB9Cn0KCgovLy8gQGRldiBUcmFuY2hlIGJhc2VkIHByaWNpbmcuCi8vLyAgICAgIEltcGxlbWVudGluZyAiZmlyc3QgcHJpY2UiIHRyYW5jaGVzLCBtZWFuaW5nLCB0aGF0IGlmIGEgYnV5ZXIncyBvcmRlciBpcwovLy8gICAgICBjb3ZlcmluZyBtb3JlIHRoYW4gb25lIHRyYW5jaGUsIHRoZSBwcmljZSBvZiB0aGUgbG93ZXN0IHRyYW5jaGUgd2lsbCBhcHBseQovLy8gICAgICB0byB0aGUgd2hvbGUgb3JkZXIuCmNvbnRyYWN0IFRva2VuVHJhbmNoZVByaWNpbmcgewoKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgLyoqCiAgICogRGVmaW5lIHByaWNpbmcgc2NoZWR1bGUgdXNpbmcgdHJhbmNoZXMuCiAgICovCiAgc3RydWN0IFRyYW5jaGUgewogICAgICAvLyBBbW91bnQgaW4gdG9rZW5zIHdoZW4gdGhpcyB0cmFuY2hlIGJlY29tZXMgaW5hY3RpdmUKICAgICAgdWludCBhbW91bnQ7CiAgICAgIC8vIEJsb2NrIGludGVydmFsIFtzdGFydCwgZW5kKQogICAgICAvLyBTdGFydGluZyBibG9jayAoaW5jbHVkZWQgaW4gdGhlIGludGVydmFsKQogICAgICB1aW50IHN0YXJ0OwogICAgICAvLyBFbmRpbmcgYmxvY2sgKGV4Y2x1ZGVkIGZyb20gdGhlIGludGVydmFsKQogICAgICB1aW50IGVuZDsKICAgICAgLy8gSG93IG1hbnkgdG9rZW5zIHBlciB3ZWkgeW91IHdpbGwgZ2V0IHdoaWxlIHRoaXMgdHJhbmNoZSBpcyBhY3RpdmUKICAgICAgdWludCBwcmljZTsKICB9CiAgLy8gV2UgZGVmaW5lIG9mZnNldHMgYW5kIHNpemUgZm9yIHRoZSBkZXNlcmlhbGl6YXRpb24gb2Ygb3JkZXJlZCB0dXBsZXMgaW4gcmF3IGFycmF5cwogIHVpbnQgcHJpdmF0ZSBjb25zdGFudCBhbW91bnRfb2Zmc2V0ID0gMDsKICB1aW50IHByaXZhdGUgY29uc3RhbnQgc3RhcnRfb2Zmc2V0ID0gMTsKICB1aW50IHByaXZhdGUgY29uc3RhbnQgZW5kX29mZnNldCA9IDI7CiAgdWludCBwcml2YXRlIGNvbnN0YW50IHByaWNlX29mZnNldCA9IDM7CiAgdWludCBwcml2YXRlIGNvbnN0YW50IHRyYW5jaGVfc2l6ZSA9IDQ7CgogIFRyYW5jaGVbXSBwdWJsaWMgdHJhbmNoZXM7CgogIGZ1bmN0aW9uIGdldFRyYW5jaGVzTGVuZ3RoKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIHRyYW5jaGVzLmxlbmd0aDsKICB9CgogIC8vLyBAZGV2IENvbnN0cnVjdGlvbiwgY3JlYXRpbmcgYSBsaXN0IG9mIHRyYW5jaGVzCiAgLy8vIEBwYXJhbSBpbml0X3RyYW5jaGVzIFJhdyBhcnJheSBvZiBvcmRlcmVkIHR1cGxlczogKHN0YXJ0IGFtb3VudCwgc3RhcnQgYmxvY2ssIGVuZCBibG9jaywgcHJpY2UpCiAgZnVuY3Rpb24gVG9rZW5UcmFuY2hlUHJpY2luZyh1aW50W10gaW5pdF90cmFuY2hlcykgcHVibGljIHsKICAgIC8vIE5lZWQgdG8gaGF2ZSB0dXBsZXMsIGxlbmd0aCBjaGVjawogICAgcmVxdWlyZShpbml0X3RyYW5jaGVzLmxlbmd0aCAlIHRyYW5jaGVfc2l6ZSA9PSAwKTsKICAgIC8vIEEgdHJhbmNoZSB3aXRoIGFtb3VudCB6ZXJvIGNhbiBuZXZlciBiZSBzZWxlY3RlZCBhbmQgaXMgdGhlcmVmb3JlIHVzZWxlc3MuCiAgICAvLyBUaGlzIGNoZWNrIGFuZCB0aGUgb25lIGluc2lkZSB0aGUgbG9vcCBlbnN1cmUgbm8gdHJhbmNoZSBjYW4gaGF2ZSBhbiBhbW91bnQgZXF1YWwgdG8gemVyby4KICAgIHJlcXVpcmUoaW5pdF90cmFuY2hlc1thbW91bnRfb2Zmc2V0XSA+IDApOwoKICAgIHVpbnQgaW5wdXRfdHJhbmNoZXNfbGVuZ3RoID0gaW5pdF90cmFuY2hlcy5sZW5ndGguZGl2KHRyYW5jaGVfc2l6ZSk7CiAgICBUcmFuY2hlIG1lbW9yeSBsYXN0X3RyYW5jaGU7CiAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBpbnB1dF90cmFuY2hlc19sZW5ndGg7IGkrKykgewogICAgICB1aW50IHRyYW5jaGVfb2Zmc2V0ID0gaS5tdWwodHJhbmNoZV9zaXplKTsKICAgICAgdWludCBhbW91bnQgPSBpbml0X3RyYW5jaGVzW3RyYW5jaGVfb2Zmc2V0LmFkZChhbW91bnRfb2Zmc2V0KV07CiAgICAgIHVpbnQgc3RhcnQgPSBpbml0X3RyYW5jaGVzW3RyYW5jaGVfb2Zmc2V0LmFkZChzdGFydF9vZmZzZXQpXTsKICAgICAgdWludCBlbmQgPSBpbml0X3RyYW5jaGVzW3RyYW5jaGVfb2Zmc2V0LmFkZChlbmRfb2Zmc2V0KV07CiAgICAgIHVpbnQgcHJpY2UgPSBpbml0X3RyYW5jaGVzW3RyYW5jaGVfb2Zmc2V0LmFkZChwcmljZV9vZmZzZXQpXTsKICAgICAgLy8gTm8gaW52YWxpZCBzdGVwcwogICAgICByZXF1aXJlKGJsb2NrLnRpbWVzdGFtcCA8IHN0YXJ0ICYmIHN0YXJ0IDwgZW5kKTsKICAgICAgLy8gQmFpbCBvdXQgd2hlbiBlbnRlcmluZyB1bm5lY2Vzc2FyeSB0cmFuY2hlcwogICAgICAvLyBUaGlzIGlzIHByZWZlcmFibHkgY2hlY2tlZCBiZWZvcmUgZGVwbG95aW5nIGNvbnRyYWN0IGludG8gYW55IGJsb2NrY2hhaW4uCiAgICAgIHJlcXVpcmUoaSA9PSAwIHx8IChlbmQgPj0gbGFzdF90cmFuY2hlLmVuZCAmJiBhbW91bnQgPiBsYXN0X3RyYW5jaGUuYW1vdW50KSB8fAogICAgICAgICAgICAgIChlbmQgPiBsYXN0X3RyYW5jaGUuZW5kICYmIGFtb3VudCA+PSBsYXN0X3RyYW5jaGUuYW1vdW50KSk7CgogICAgICBsYXN0X3RyYW5jaGUgPSBUcmFuY2hlKGFtb3VudCwgc3RhcnQsIGVuZCwgcHJpY2UpOwogICAgICB0cmFuY2hlcy5wdXNoKGxhc3RfdHJhbmNoZSk7CiAgICB9CiAgfQoKICAvLy8gQGRldiBHZXQgdGhlIGN1cnJlbnQgdHJhbmNoZSBvciBiYWlsIG91dCBpZiB0aGVyZSBpcyBubyB0cmFuY2hlIGRlZmluZWQgZm9yIHRoZSBjdXJyZW50IGJsb2NrLgogIC8vLyBAcGFyYW0gdG9rZW5zU29sZCB0b3RhbCBhbW91bnQgb2YgdG9rZW5zIHNvbGQsIGZvciBjYWxjdWxhdGluZyB0aGUgY3VycmVudCB0cmFuY2hlCiAgLy8vIEByZXR1cm4gUmV0dXJucyB0aGUgc3RydWN0IHJlcHJlc2VudGluZyB0aGUgY3VycmVudCB0cmFuY2hlCiAgZnVuY3Rpb24gZ2V0Q3VycmVudFRyYW5jaGUodWludCB0b2tlbnNTb2xkKSBwcml2YXRlIHZpZXcgcmV0dXJucyAoVHJhbmNoZSBzdG9yYWdlKSB7CiAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCB0cmFuY2hlcy5sZW5ndGg7IGkrKykgewogICAgICBpZiAodHJhbmNoZXNbaV0uc3RhcnQgPD0gYmxvY2sudGltZXN0YW1wICYmIGJsb2NrLnRpbWVzdGFtcCA8IHRyYW5jaGVzW2ldLmVuZCAmJiB0b2tlbnNTb2xkIDwgdHJhbmNoZXNbaV0uYW1vdW50KSB7CiAgICAgICAgcmV0dXJuIHRyYW5jaGVzW2ldOwogICAgICB9CiAgICB9CiAgICAvLyBObyB0cmFuY2hlIGlzIGN1cnJlbnRseSBhY3RpdmUKICAgIHJldmVydCgpOwogIH0KCiAgLy8vIEBkZXYgR2V0IHRoZSBjdXJyZW50IHByaWNlLiBNYXkgcmV2ZXJ0IGlmIHRoZXJlIGlzIG5vIHRyYW5jaGUgY3VycmVudGx5IGFjdGl2ZS4KICAvLy8gQHBhcmFtIHRva2Vuc1NvbGQgdG90YWwgYW1vdW50IG9mIHRva2VucyBzb2xkLCBmb3IgY2FsY3VsYXRpbmcgdGhlIGN1cnJlbnQgdHJhbmNoZQogIC8vLyBAcmV0dXJuIFRoZSBjdXJyZW50IHByaWNlCiAgZnVuY3Rpb24gZ2V0Q3VycmVudFByaWNlKHVpbnQgdG9rZW5zU29sZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50IHJlc3VsdCkgewogICAgcmV0dXJuIGdldEN1cnJlbnRUcmFuY2hlKHRva2Vuc1NvbGQpLnByaWNlOwogIH0KCn0KLy8gVGhpcyBjb250cmFjdCBoYXMgdGhlIHNvbGUgb2JqZWN0aXZlIG9mIHByb3ZpZGluZyBhIHNhbmUgY29uY3JldGUgaW5zdGFuY2Ugb2YgdGhlIENyb3dkc2FsZSBjb250cmFjdC4KY29udHJhY3QgQ3Jvd2RzYWxlIGlzIEdlbmVyaWNDcm93ZHNhbGUsIExvc3RBbmRGb3VuZFRva2VuLCBEZXBsb3ltZW50SW5mbywgVG9rZW5UcmFuY2hlUHJpY2luZ3sKICAvLwogIHVpbnQgcHJpdmF0ZSBjb25zdGFudCB0b2tlbl9pbml0aWFsX3N1cHBseSA9IDgwNSAqICgxMCAqKiA1KSAqICgxMCAqKiB1aW50KHRva2VuX2RlY2ltYWxzKSk7CiAgdWludDggcHJpdmF0ZSBjb25zdGFudCB0b2tlbl9kZWNpbWFscyA9IDE4OwogIGJvb2wgcHJpdmF0ZSBjb25zdGFudCB0b2tlbl9taW50YWJsZSA9IHRydWU7CiAgdWludCBwcml2YXRlIGNvbnN0YW50IHNlbGxhYmxlX3Rva2VucyA9IDMyMiAqICgxMCAqKiA2KSAqICgxMCAqKiB1aW50KHRva2VuX2RlY2ltYWxzKSk7CiAgdWludCBwdWJsaWMgbWlsaWV1cnNfcGVyX2V0aDsKICAvKioKICAgKiBDb25zdHJ1Y3RvciBmb3IgdGhlIGNyb3dkc2FsZS4KICAgKiBOb3JtYWxseSwgdGhlIHRva2VuIGNvbnRyYWN0IGlzIGNyZWF0ZWQgaGVyZS4gVGhhdCB3YXksIHRoZSBtaW50aW5nLCByZWxlYXNlIGFuZCB0cmFuc2ZlciBhZ2VudHMgY2FuIGJlIHNldCBoZXJlIHRvby4KICAgKgogICAqIEBwYXJhbSB0ZWFtX211bHRpc2lnIEFkZHJlc3Mgb2YgdGhlIG11bHRpc2lnbmF0dXJlIHdhbGxldCBvZiB0aGUgdGVhbSB0aGF0IHdpbGwgcmVjZWl2ZSBhbGwgdGhlIGZ1bmRzIGNvbnRyaWJ1dGVkIGluIHRoZSBjcm93ZHNhbGUuCiAgICogQHBhcmFtIHN0YXJ0IEJsb2NrIG51bWJlciB3aGVyZSB0aGUgY3Jvd2RzYWxlIHdpbGwgYmUgb2ZmaWNpYWxseSBzdGFydGVkLiBJdCBzaG91bGQgYmUgZ3JlYXRlciB0aGFuIHRoZSBibG9jayBudW1iZXIgaW4gd2hpY2ggdGhlIGNvbnRyYWN0IGlzIGRlcGxveWVkLgogICAqIEBwYXJhbSBlbmQgQmxvY2sgbnVtYmVyIHdoZXJlIHRoZSBjcm93ZHNhbGUgZmluaXNoZXMuIE5vIHRva2VucyBjYW4gYmUgc29sZCB0aHJvdWdoIHRoaXMgY29udHJhY3QgYWZ0ZXIgdGhpcyBibG9jay4KICAgKiBAcGFyYW0gdG9rZW5fcmV0cmlldmVyIEFkZHJlc3MgdGhhdCB3aWxsIGhhbmRsZSB0b2tlbnMgYWNjaWRlbnRhbGx5IHNlbnQgdG8gdGhlIHRva2VuIGNvbnRyYWN0LiBTZWUgdGhlIExvc3RBbmRGb3VuZFRva2VuIGFuZCBDcm93ZHNhbGVUb2tlbiBjb250cmFjdHMgZm9yIGZ1cnRoZXIgZGV0YWlscy4KICAgKi8KICBmdW5jdGlvbiBDcm93ZHNhbGUoYWRkcmVzcyB0ZWFtX211bHRpc2lnLCB1aW50IHN0YXJ0LCB1aW50IGVuZCwgYWRkcmVzcyB0b2tlbl9yZXRyaWV2ZXIsIHVpbnRbXSBpbml0X3RyYW5jaGVzLCB1aW50IG1pbGlfZXVyc19wZXJfZXRoKSBHZW5lcmljQ3Jvd2RzYWxlKHRlYW1fbXVsdGlzaWcsIHN0YXJ0LCBlbmQpIFRva2VuVHJhbmNoZVByaWNpbmcoaW5pdF90cmFuY2hlcykgcHVibGljIHsKCiAgICByZXF1aXJlKGVuZCA9PSB0cmFuY2hlc1t0cmFuY2hlcy5sZW5ndGguc3ViKDEpXS5lbmQpOwogICAgLy8gVGVzdGluZyB2YWx1ZXMKICAgIHRva2VuID0gbmV3IENyb3dkc2FsZVRva2VuKHRva2VuX2luaXRpYWxfc3VwcGx5LCB0b2tlbl9kZWNpbWFscywgdGVhbV9tdWx0aXNpZywgdG9rZW5fbWludGFibGUsIHRva2VuX3JldHJpZXZlcik7CiAgICAKICAgIC8vIFNldCBwZXJtaXNzaW9ucyB0byBtaW50LCB0cmFuc2ZlciBhbmQgcmVsZWFzZQogICAgdG9rZW4uc2V0TWludEFnZW50KGFkZHJlc3ModGhpcyksIHRydWUpOwogICAgdG9rZW4uc2V0VHJhbnNmZXJBZ2VudChhZGRyZXNzKHRoaXMpLCB0cnVlKTsKICAgIHRva2VuLnNldFJlbGVhc2VBZ2VudChhZGRyZXNzKHRoaXMpKTsKICAgIAogICAgLy8gVG9rZW5zIHRvIGJlIHNvbGQgdGhyb3VnaCB0aGlzIGNvbnRyYWN0CiAgICB0b2tlbi5taW50KGFkZHJlc3ModGhpcyksIHNlbGxhYmxlX3Rva2Vucyk7CiAgICAKICAgIC8vIFdlIGRvbid0IG5lZWQgdG8gbWludCBhbnltb3JlIGR1cmluZyB0aGUgbGlmZXRpbWUgb2YgdGhlIGNvbnRyYWN0LgogICAgdG9rZW4uc2V0TWludEFnZW50KGFkZHJlc3ModGhpcyksIGZhbHNlKTsKICAgIAogICAgLy9HaXZlIG11bHRpc2lnIHBlcm1pc2lvbiB0byBzZW5kIHRva2VucyB0byBwYXJ0bmVycwogICAgdG9rZW4uc2V0VHJhbnNmZXJBZ2VudCh0ZWFtX211bHRpc2lnLCB0cnVlKTsKCiAgICB1cGRhdGVFdXJzUGVyRXRoKG1pbGlfZXVyc19wZXJfZXRoKTsKICB9CgogIC8vVG9rZW4gYXNzaWduYXRpb24gdGhyb3VnaCB0cmFuc2ZlcgogIGZ1bmN0aW9uIGFzc2lnblRva2VucyhhZGRyZXNzIHJlY2VpdmVyLCB1aW50IHRva2VuQW1vdW50KSBpbnRlcm5hbHsKICAgIHRva2VuLnRyYW5zZmVyKHJlY2VpdmVyLCB0b2tlbkFtb3VudCk7CiAgfQoKICAvL1Rva2VuIGFtb3VudCBjYWxjdWxhdGlvbgogIGZ1bmN0aW9uIGNhbGN1bGF0ZVRva2VuQW1vdW50KHVpbnQgd2VpQW1vdW50LCBhZGRyZXNzKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQgd2VpQWxsb3dlZCwgdWludCB0b2tlbkFtb3VudCl7CiAgICB1aW50IHRva2Vuc1BlckV0aCA9IGdldEN1cnJlbnRQcmljZSh0b2tlbnNTb2xkKS5tdWwobWlsaWV1cnNfcGVyX2V0aCkuZGl2KDEwMDApOwogICAgdWludCBtYXhXZWlBbGxvd2VkID0gc2VsbGFibGVfdG9rZW5zLnN1Yih0b2tlbnNTb2xkKS5tdWwoMSBldGhlcikuZGl2KHRva2Vuc1BlckV0aCk7CiAgICB3ZWlBbGxvd2VkID0gbWF4V2VpQWxsb3dlZC5taW4yNTYod2VpQW1vdW50KTsKCiAgICBpZiAod2VpQW1vdW50IDwgbWF4V2VpQWxsb3dlZCkgewogICAgICAvL0RpdmlkZWQgYnkgMTAwMCBiZWNhdXNlIGV0aCBldGhfcHJpY2VfaW5fZXVycyBpcyBtdWx0aXBsaWVkIGJ5IDEwMDAKICAgICAgdG9rZW5BbW91bnQgPSB0b2tlbnNQZXJFdGgubXVsKHdlaUFtb3VudCkuZGl2KDEgZXRoZXIpOwogICAgfQogICAgLy8gV2l0aCB0aGlzIGNhc2Ugd2UgbGV0IHRoZSBjcm93ZHNhbGUgZW5kIGV2ZW4gd2hlbiB0aGVyZSBhcmUgcm91bmRpbmcgZXJyb3JzIGR1ZSB0byB0aGUgdG9rZW5zIHRvIHdlaSByYXRpbwogICAgZWxzZSB7CiAgICAgIHRva2VuQW1vdW50ID0gc2VsbGFibGVfdG9rZW5zLnN1Yih0b2tlbnNTb2xkKTsKICAgIH0KICB9CgogIC8vIENyb3dkc2FsZSBpcyBmdWxsIG9uY2UgYWxsIHNlbGxhYmxlX3Rva2VucyBhcmUgc29sZC4KICBmdW5jdGlvbiBpc0Nyb3dkc2FsZUZ1bGwoKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wgZnVsbCkgewogICAgcmV0dXJuIHRva2Vuc1NvbGQgPj0gc2VsbGFibGVfdG9rZW5zOwogIH0KCiAgLyoqCiAgICogRmluYWxpemUgYSBzdWNjY2VzZnVsIGNyb3dkc2FsZS4KICAgKgogICAqIFRoZSBvd25lciBjYW4gdHJpZ2dlciBwb3N0LWNyb3dkc2FsZSBhY3Rpb25zLCBsaWtlIHJlbGVhc2luZyB0aGUgdG9rZW5zLgogICAqIE5vdGUgdGhhdCBieSBkZWZhdWx0IHRva2VucyBhcmUgbm90IGluIGEgcmVsZWFzZWQgc3RhdGUuCiAgICovCiAgZnVuY3Rpb24gZmluYWxpemUoKSBwdWJsaWMgaW5TdGF0ZShTdGF0ZS5TdWNjZXNzKSBvbmx5T3duZXIgc3RvcEluRW1lcmdlbmN5IHsKICAgIHRva2VuLnJlbGVhc2VUb2tlblRyYW5zZmVyKCk7CiAgICB1aW50IHVuc29sZFRva2VucyA9IHRva2VuLmJhbGFuY2VPZihhZGRyZXNzKHRoaXMpKTsKICAgIHRva2VuLmJ1cm4odW5zb2xkVG9rZW5zKTsKICAgIHN1cGVyLmZpbmFsaXplKCk7CiAgfQoKCiAgLy9DaGFuZ2UgdGhlIHRoZSBzdGFydGluZyB0aW1lIGluIG9yZGVyIHRvIGVuZCB0aGUgcHJlc2FsZSBwZXJpb2QgZWFybHkgaWYgbmVlZGVkLgogIGZ1bmN0aW9uIHNldFN0YXJ0aW5nVGltZSh1aW50IHN0YXJ0aW5nVGltZSkgcHVibGljIG9ubHlPd25lciBpblN0YXRlKFN0YXRlLlByZUZ1bmRpbmcpIHsKICAgIHJlcXVpcmUoc3RhcnRpbmdUaW1lID4gYmxvY2sudGltZXN0YW1wICYmIHN0YXJ0aW5nVGltZSA8IGVuZHNBdCk7CiAgICBzdGFydHNBdCA9IHN0YXJ0aW5nVGltZTsKICB9CgogIC8vQ2hhbmdlIHRoZSB0aGUgZW5kaW5nIHRpbWUgaW4gb3JkZXIgdG8gYmUgYWJsZSB0byBmaW5hbGl6ZSB0aGUgY3Jvd2RzYWxlIGlmIG5lZWRlZC4KICBmdW5jdGlvbiBzZXRFbmRpbmdUaW1lKHVpbnQgZW5kaW5nVGltZSkgcHVibGljIG9ubHlPd25lciBub3RGaW5pc2hlZCB7CiAgICByZXF1aXJlKGVuZGluZ1RpbWUgPiBibG9jay50aW1lc3RhbXAgJiYgZW5kaW5nVGltZSA+IHN0YXJ0c0F0KTsKICAgIGVuZHNBdCA9IGVuZGluZ1RpbWU7CiAgfQoKICAvKioKICAgKiBUaGlzIGZ1bmN0aW9uIGRlY2lkZXMgd2hvIGhhbmRsZXMgbG9zdCB0b2tlbnMuCiAgICogRG8gbm90ZSB0aGF0IHRoaXMgZnVuY3Rpb24gaXMgTk9UIG1lYW50IHRvIGJlIHVzZWQgaW4gYSB0b2tlbiByZWZ1bmQgbWVjYWhuaXNtLgogICAqIEl0cyBzb2xlIHB1cnBvc2UgaXMgZGV0ZXJtaW5pbmcgd2hvIGNhbiBtb3ZlIGFyb3VuZCBFUkMyMCB0b2tlbnMgYWNjaWRlbnRhbGx5IHNlbnQgdG8gdGhpcyBjb250cmFjdC4KICAgKi8KICBmdW5jdGlvbiBnZXRMb3N0QW5kRm91bmRNYXN0ZXIoKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGFkZHJlc3MpIHsKICAgIHJldHVybiBvd25lcjsKICB9CiAgCiAgLy9VcGRhdGUgRVRIIHZhbHVlIGluIG1pbGlldXJzCiAgZnVuY3Rpb24gdXBkYXRlRXVyc1BlckV0aCAodWludCBtaWxpZXVyc19hbW91bnQpIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZShtaWxpZXVyc19hbW91bnQgPj0gMTAwKTsKICAgIG1pbGlldXJzX3Blcl9ldGggPSBtaWxpZXVyc19hbW91bnQ7CiAgfQogIC8qKgogICAqIE92ZXJyaWRlIHRvIHJlamVjdCBjYWxscyB1bmxlc3MgdGhlIGNyb3dkc2FsZSBpcyBmaW5hbGl6ZWQgb3IKICAgKiAgdGhlIHRva2VuIGNvbnRyYWN0IGlzIG5vdCB0aGUgb25lIGNvcnJlc3BvbmRpbmcgdG8gdGhpcyBjcm93ZHNhbGUKICAgKi8KICBmdW5jdGlvbiBlbmFibGVMb3N0QW5kRm91bmQoYWRkcmVzcyBhZ2VudCwgdWludCB0b2tlbnMsIEVJUDIwVG9rZW4gdG9rZW5fY29udHJhY3QpIHB1YmxpYyB7CiAgICAvLyBFaXRoZXIgdGhlIHN0YXRlIGlzIGZpbmFsaXplZCBvciB0aGUgdG9rZW5fY29udHJhY3QgaXMgbm90IHRoaXMgY3Jvd2RzYWxlIHRva2VuCiAgICByZXF1aXJlKGFkZHJlc3ModG9rZW5fY29udHJhY3QpICE9IGFkZHJlc3ModG9rZW4pIHx8IGdldFN0YXRlKCkgPT0gU3RhdGUuRmluYWxpemVkKTsKICAgIHN1cGVyLmVuYWJsZUxvc3RBbmRGb3VuZChhZ2VudCwgdG9rZW5zLCB0b2tlbl9jb250cmFjdCk7CiAgfQp9'.
	

]
