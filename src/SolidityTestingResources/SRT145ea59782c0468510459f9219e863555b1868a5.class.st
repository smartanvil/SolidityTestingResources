Class {
	#name : #SRT145ea59782c0468510459f9219e863555b1868a5,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT145ea59782c0468510459f9219e863555b1868a5 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7Cgpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBwcmV2aW91c093bmVyLCBhZGRyZXNzIGluZGV4ZWQgbmV3T3duZXIpOwoKCiAgLyoqCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCgogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgKi8KICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CgoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHB1YmxpYyB7CiAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCmNvbnRyYWN0IFJlZnVuZFZhdWx0IGlzIE93bmFibGUgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICBlbnVtIFN0YXRlIHsgQWN0aXZlLCBSZWZ1bmRpbmcsIENsb3NlZCB9CgogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGRlcG9zaXRlZDsKICBhZGRyZXNzIHB1YmxpYyB3YWxsZXQ7CiAgU3RhdGUgcHVibGljIHN0YXRlOwoKICBldmVudCBDbG9zZWQoKTsKICBldmVudCBSZWZ1bmRzRW5hYmxlZCgpOwogIGV2ZW50IFJlZnVuZGVkKGFkZHJlc3MgaW5kZXhlZCBiZW5lZmljaWFyeSwgdWludDI1NiB3ZWlBbW91bnQpOwoKICBmdW5jdGlvbiBSZWZ1bmRWYXVsdChhZGRyZXNzIF93YWxsZXQpIHsKICAgIHJlcXVpcmUoX3dhbGxldCAhPSAweDApOwogICAgd2FsbGV0ID0gX3dhbGxldDsKICAgIHN0YXRlID0gU3RhdGUuQWN0aXZlOwogIH0KCiAgZnVuY3Rpb24gZGVwb3NpdChhZGRyZXNzIGludmVzdG9yKSBvbmx5T3duZXIgcHVibGljIHBheWFibGUgewogICAgcmVxdWlyZShzdGF0ZSA9PSBTdGF0ZS5BY3RpdmUpOwogICAgZGVwb3NpdGVkW2ludmVzdG9yXSA9IGRlcG9zaXRlZFtpbnZlc3Rvcl0uYWRkKG1zZy52YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiBjbG9zZSgpIG9ubHlPd25lciBwdWJsaWMgewogICAgcmVxdWlyZShzdGF0ZSA9PSBTdGF0ZS5BY3RpdmUpOwogICAgc3RhdGUgPSBTdGF0ZS5DbG9zZWQ7CiAgICBDbG9zZWQoKTsKICAgIHdhbGxldC50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwogIH0KCiAgZnVuY3Rpb24gZW5hYmxlUmVmdW5kcygpIG9ubHlPd25lciBwdWJsaWMgewogICAgcmVxdWlyZShzdGF0ZSA9PSBTdGF0ZS5BY3RpdmUpOwogICAgc3RhdGUgPSBTdGF0ZS5SZWZ1bmRpbmc7CiAgICBSZWZ1bmRzRW5hYmxlZCgpOwogIH0KCiAgZnVuY3Rpb24gcmVmdW5kKGFkZHJlc3MgaW52ZXN0b3IpIHB1YmxpYyB7CiAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLlJlZnVuZGluZyk7CiAgICB1aW50MjU2IGRlcG9zaXRlZFZhbHVlID0gZGVwb3NpdGVkW2ludmVzdG9yXTsKICAgIGRlcG9zaXRlZFtpbnZlc3Rvcl0gPSAwOwogICAgaW52ZXN0b3IudHJhbnNmZXIoZGVwb3NpdGVkVmFsdWUpOwogICAgUmVmdW5kZWQoaW52ZXN0b3IsIGRlcG9zaXRlZFZhbHVlKTsKICB9Cn0KCmNvbnRyYWN0IENyb3dkc2FsZSB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIC8vIFRoZSB0b2tlbiBiZWluZyBzb2xkCiAgTWludGFibGVUb2tlbiBwdWJsaWMgdG9rZW47CgogIC8vIHN0YXJ0IGFuZCBlbmQgdGltZXN0YW1wcyB3aGVyZSBpbnZlc3RtZW50cyBhcmUgYWxsb3dlZCAoYm90aCBpbmNsdXNpdmUpCiAgdWludDI1NiBwdWJsaWMgc3RhcnRUaW1lOwogIHVpbnQyNTYgcHVibGljIGVuZFRpbWU7CgogIC8vIGFkZHJlc3Mgd2hlcmUgZnVuZHMgYXJlIGNvbGxlY3RlZAogIGFkZHJlc3MgcHVibGljIHdhbGxldDsKCiAgLy8gaG93IG1hbnkgdG9rZW4gdW5pdHMgYSBidXllciBnZXRzIHBlciB3ZWkKICB1aW50MjU2IHB1YmxpYyByYXRlOwoKICAvLyBhbW91bnQgb2YgcmFpc2VkIG1vbmV5IGluIHdlaQogIHVpbnQyNTYgcHVibGljIHdlaVJhaXNlZDsKCiAgLyoqCiAgICogZXZlbnQgZm9yIHRva2VuIHB1cmNoYXNlIGxvZ2dpbmcKICAgKiBAcGFyYW0gcHVyY2hhc2VyIHdobyBwYWlkIGZvciB0aGUgdG9rZW5zCiAgICogQHBhcmFtIGJlbmVmaWNpYXJ5IHdobyBnb3QgdGhlIHRva2VucwogICAqIEBwYXJhbSB2YWx1ZSB3ZWlzIHBhaWQgZm9yIHB1cmNoYXNlCiAgICogQHBhcmFtIGFtb3VudCBhbW91bnQgb2YgdG9rZW5zIHB1cmNoYXNlZAogICAqLwogIGV2ZW50IFRva2VuUHVyY2hhc2UoYWRkcmVzcyBpbmRleGVkIHB1cmNoYXNlciwgYWRkcmVzcyBpbmRleGVkIGJlbmVmaWNpYXJ5LCB1aW50MjU2IHZhbHVlLCB1aW50MjU2IGFtb3VudCk7CgoKICBmdW5jdGlvbiBDcm93ZHNhbGUodWludDI1NiBfc3RhcnRUaW1lLCB1aW50MjU2IF9lbmRUaW1lLCB1aW50MjU2IF9yYXRlLCBhZGRyZXNzIF93YWxsZXQpIHsKICAgIHJlcXVpcmUoX3N0YXJ0VGltZSA+PSBub3cpOwogICAgcmVxdWlyZShfZW5kVGltZSA+PSBfc3RhcnRUaW1lKTsKICAgIHJlcXVpcmUoX3JhdGUgPiAwKTsKICAgIHJlcXVpcmUoX3dhbGxldCAhPSAweDApOwoKICAgIHRva2VuID0gY3JlYXRlVG9rZW5Db250cmFjdCgpOwogICAgc3RhcnRUaW1lID0gX3N0YXJ0VGltZTsKICAgIGVuZFRpbWUgPSBfZW5kVGltZTsKICAgIHJhdGUgPSBfcmF0ZTsKICAgIHdhbGxldCA9IF93YWxsZXQ7CiAgfQoKICAvLyBjcmVhdGVzIHRoZSB0b2tlbiB0byBiZSBzb2xkLgogIC8vIG92ZXJyaWRlIHRoaXMgbWV0aG9kIHRvIGhhdmUgY3Jvd2RzYWxlIG9mIGEgc3BlY2lmaWMgbWludGFibGUgdG9rZW4uCiAgZnVuY3Rpb24gY3JlYXRlVG9rZW5Db250cmFjdCgpIGludGVybmFsIHJldHVybnMgKE1pbnRhYmxlVG9rZW4pIHsKICAgIHJldHVybiBuZXcgTWludGFibGVUb2tlbigpOwogIH0KCgogIC8vIGZhbGxiYWNrIGZ1bmN0aW9uIGNhbiBiZSB1c2VkIHRvIGJ1eSB0b2tlbnMKICBmdW5jdGlvbiAoKSBwYXlhYmxlIHsKICAgIGJ1eVRva2Vucyhtc2cuc2VuZGVyKTsKICB9CgogIC8vIGxvdyBsZXZlbCB0b2tlbiBwdXJjaGFzZSBmdW5jdGlvbgogIGZ1bmN0aW9uIGJ1eVRva2VucyhhZGRyZXNzIGJlbmVmaWNpYXJ5KSBwdWJsaWMgcGF5YWJsZSB7CiAgICByZXF1aXJlKGJlbmVmaWNpYXJ5ICE9IDB4MCk7CiAgICByZXF1aXJlKHZhbGlkUHVyY2hhc2UoKSk7CgogICAgdWludDI1NiB3ZWlBbW91bnQgPSBtc2cudmFsdWU7CgogICAgLy8gY2FsY3VsYXRlIHRva2VuIGFtb3VudCB0byBiZSBjcmVhdGVkCiAgICB1aW50MjU2IHRva2VucyA9IHdlaUFtb3VudC5tdWwocmF0ZSk7CgogICAgLy8gdXBkYXRlIHN0YXRlCiAgICB3ZWlSYWlzZWQgPSB3ZWlSYWlzZWQuYWRkKHdlaUFtb3VudCk7CgogICAgdG9rZW4ubWludChiZW5lZmljaWFyeSwgdG9rZW5zKTsKICAgIFRva2VuUHVyY2hhc2UobXNnLnNlbmRlciwgYmVuZWZpY2lhcnksIHdlaUFtb3VudCwgdG9rZW5zKTsKCiAgICBmb3J3YXJkRnVuZHMoKTsKICB9CgogIC8vIHNlbmQgZXRoZXIgdG8gdGhlIGZ1bmQgY29sbGVjdGlvbiB3YWxsZXQKICAvLyBvdmVycmlkZSB0byBjcmVhdGUgY3VzdG9tIGZ1bmQgZm9yd2FyZGluZyBtZWNoYW5pc21zCiAgZnVuY3Rpb24gZm9yd2FyZEZ1bmRzKCkgaW50ZXJuYWwgewogICAgd2FsbGV0LnRyYW5zZmVyKG1zZy52YWx1ZSk7CiAgfQoKICAvLyBAcmV0dXJuIHRydWUgaWYgdGhlIHRyYW5zYWN0aW9uIGNhbiBidXkgdG9rZW5zCiAgZnVuY3Rpb24gdmFsaWRQdXJjaGFzZSgpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIGJvb2wgd2l0aGluUGVyaW9kID0gbm93ID49IHN0YXJ0VGltZSAmJiBub3cgPD0gZW5kVGltZTsKICAgIGJvb2wgbm9uWmVyb1B1cmNoYXNlID0gbXNnLnZhbHVlICE9IDA7CiAgICByZXR1cm4gd2l0aGluUGVyaW9kICYmIG5vblplcm9QdXJjaGFzZTsKICB9CgogIC8vIEByZXR1cm4gdHJ1ZSBpZiBjcm93ZHNhbGUgZXZlbnQgaGFzIGVuZGVkCiAgZnVuY3Rpb24gaGFzRW5kZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIG5vdyA+IGVuZFRpbWU7CiAgfQoKCn0KCmNvbnRyYWN0IFBhdXNhYmxlIGlzIE93bmFibGUgewogIGV2ZW50IFBhdXNlKCk7CiAgZXZlbnQgVW5wYXVzZSgpOwoKICBib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKCgogIC8qKgogICAqIEBkZXYgTW9kaWZpZXIgdG8gbWFrZSBhIGZ1bmN0aW9uIGNhbGxhYmxlIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgaXMgbm90IHBhdXNlZC4KICAgKi8KICBtb2RpZmllciB3aGVuTm90UGF1c2VkKCkgewogICAgcmVxdWlyZSghcGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIHBhdXNlZC4KICAgKi8KICBtb2RpZmllciB3aGVuUGF1c2VkKCkgewogICAgcmVxdWlyZShwYXVzZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byBwYXVzZSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHBhdXNlKCkgb25seU93bmVyIHdoZW5Ob3RQYXVzZWQgcHVibGljIHsKICAgIHBhdXNlZCA9IHRydWU7CiAgICBQYXVzZSgpOwogIH0KCiAgLyoqCiAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHVucGF1c2UsIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgICovCiAgZnVuY3Rpb24gdW5wYXVzZSgpIG9ubHlPd25lciB3aGVuUGF1c2VkIHB1YmxpYyB7CiAgICBwYXVzZWQgPSBmYWxzZTsKICAgIFVucGF1c2UoKTsKICB9Cn0KCmNvbnRyYWN0IENhcHBlZENyb3dkc2FsZSBpcyBDcm93ZHNhbGUgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICB1aW50MjU2IHB1YmxpYyBjYXA7CgogIGZ1bmN0aW9uIENhcHBlZENyb3dkc2FsZSh1aW50MjU2IF9jYXApIHsKICAgIHJlcXVpcmUoX2NhcCA+IDApOwogICAgY2FwID0gX2NhcDsKICB9CgogIC8vIG92ZXJyaWRpbmcgQ3Jvd2RzYWxlI3ZhbGlkUHVyY2hhc2UgdG8gYWRkIGV4dHJhIGNhcCBsb2dpYwogIC8vIEByZXR1cm4gdHJ1ZSBpZiBpbnZlc3RvcnMgY2FuIGJ1eSBhdCB0aGUgbW9tZW50CiAgZnVuY3Rpb24gdmFsaWRQdXJjaGFzZSgpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIGJvb2wgd2l0aGluQ2FwID0gd2VpUmFpc2VkLmFkZChtc2cudmFsdWUpIDw9IGNhcDsKICAgIHJldHVybiBzdXBlci52YWxpZFB1cmNoYXNlKCkgJiYgd2l0aGluQ2FwOwogIH0KCiAgLy8gb3ZlcnJpZGluZyBDcm93ZHNhbGUjaGFzRW5kZWQgdG8gYWRkIGNhcCBsb2dpYwogIC8vIEByZXR1cm4gdHJ1ZSBpZiBjcm93ZHNhbGUgZXZlbnQgaGFzIGVuZGVkCiAgZnVuY3Rpb24gaGFzRW5kZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgYm9vbCBjYXBSZWFjaGVkID0gd2VpUmFpc2VkID49IGNhcDsKICAgIHJldHVybiBzdXBlci5oYXNFbmRlZCgpIHx8IGNhcFJlYWNoZWQ7CiAgfQoKfQoKY29udHJhY3QgRmluYWxpemFibGVDcm93ZHNhbGUgaXMgQ3Jvd2RzYWxlLCBPd25hYmxlIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgYm9vbCBwdWJsaWMgaXNGaW5hbGl6ZWQgPSBmYWxzZTsKCiAgZXZlbnQgRmluYWxpemVkKCk7CgogIC8qKgogICAqIEBkZXYgTXVzdCBiZSBjYWxsZWQgYWZ0ZXIgY3Jvd2RzYWxlIGVuZHMsIHRvIGRvIHNvbWUgZXh0cmEgZmluYWxpemF0aW9uCiAgICogd29yay4gQ2FsbHMgdGhlIGNvbnRyYWN0J3MgZmluYWxpemF0aW9uIGZ1bmN0aW9uLgogICAqLwogIGZ1bmN0aW9uIGZpbmFsaXplKCkgb25seU93bmVyIHB1YmxpYyB7CiAgICByZXF1aXJlKCFpc0ZpbmFsaXplZCk7CiAgICByZXF1aXJlKGhhc0VuZGVkKCkpOwoKICAgIGZpbmFsaXphdGlvbigpOwogICAgRmluYWxpemVkKCk7CgogICAgaXNGaW5hbGl6ZWQgPSB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBDYW4gYmUgb3ZlcnJpZGRlbiB0byBhZGQgZmluYWxpemF0aW9uIGxvZ2ljLiBUaGUgb3ZlcnJpZGluZyBmdW5jdGlvbgogICAqIHNob3VsZCBjYWxsIHN1cGVyLmZpbmFsaXphdGlvbigpIHRvIGVuc3VyZSB0aGUgY2hhaW4gb2YgZmluYWxpemF0aW9uIGlzCiAgICogZXhlY3V0ZWQgZW50aXJlbHkuCiAgICovCiAgZnVuY3Rpb24gZmluYWxpemF0aW9uKCkgaW50ZXJuYWwgewogIH0KfQoKY29udHJhY3QgRVJDMjBCYXNpYyB7CiAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwp9Cgpjb250cmFjdCBCYXNpY1Rva2VuIGlzIEVSQzIwQmFzaWMgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CgogIC8qKgogICogQGRldiB0cmFuc2ZlciB0b2tlbiBmb3IgYSBzcGVjaWZpZWQgYWRkcmVzcwogICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0by4KICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCB0byBiZSB0cmFuc2ZlcnJlZC4KICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwoKICAgIC8vIFNhZmVNYXRoLnN1YiB3aWxsIHRocm93IGlmIHRoZXJlIGlzIG5vdCBlbm91Z2ggYmFsYW5jZS4KICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgKiBAZGV2IEdldHMgdGhlIGJhbGFuY2Ugb2YgdGhlIHNwZWNpZmllZCBhZGRyZXNzLgogICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0byBxdWVyeSB0aGUgdGhlIGJhbGFuY2Ugb2YuCiAgKiBAcmV0dXJuIEFuIHVpbnQyNTYgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb3duZWQgYnkgdGhlIHBhc3NlZCBhZGRyZXNzLgogICovCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICB9Cgp9Cgpjb250cmFjdCBFUkMyMCBpcyBFUkMyMEJhc2ljIHsKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7Cn0KCmNvbnRyYWN0IFJlZnVuZGFibGVDcm93ZHNhbGUgaXMgRmluYWxpemFibGVDcm93ZHNhbGUgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAvLyBtaW5pbXVtIGFtb3VudCBvZiBmdW5kcyB0byBiZSByYWlzZWQgaW4gd2VpcwogIHVpbnQyNTYgcHVibGljIGdvYWw7CgogIC8vIHJlZnVuZCB2YXVsdCB1c2VkIHRvIGhvbGQgZnVuZHMgd2hpbGUgY3Jvd2RzYWxlIGlzIHJ1bm5pbmcKICBSZWZ1bmRWYXVsdCBwdWJsaWMgdmF1bHQ7CgogIGZ1bmN0aW9uIFJlZnVuZGFibGVDcm93ZHNhbGUodWludDI1NiBfZ29hbCkgewogICAgcmVxdWlyZShfZ29hbCA+IDApOwogICAgdmF1bHQgPSBuZXcgUmVmdW5kVmF1bHQod2FsbGV0KTsKICAgIGdvYWwgPSBfZ29hbDsKICB9CgogIC8vIFdlJ3JlIG92ZXJyaWRpbmcgdGhlIGZ1bmQgZm9yd2FyZGluZyBmcm9tIENyb3dkc2FsZS4KICAvLyBJbiBhZGRpdGlvbiB0byBzZW5kaW5nIHRoZSBmdW5kcywgd2Ugd2FudCB0byBjYWxsCiAgLy8gdGhlIFJlZnVuZFZhdWx0IGRlcG9zaXQgZnVuY3Rpb24KICBmdW5jdGlvbiBmb3J3YXJkRnVuZHMoKSBpbnRlcm5hbCB7CiAgICB2YXVsdC5kZXBvc2l0LnZhbHVlKG1zZy52YWx1ZSkobXNnLnNlbmRlcik7CiAgfQoKICAvLyBpZiBjcm93ZHNhbGUgaXMgdW5zdWNjZXNzZnVsLCBpbnZlc3RvcnMgY2FuIGNsYWltIHJlZnVuZHMgaGVyZQogIGZ1bmN0aW9uIGNsYWltUmVmdW5kKCkgcHVibGljIHsKICAgIHJlcXVpcmUoaXNGaW5hbGl6ZWQpOwogICAgcmVxdWlyZSghZ29hbFJlYWNoZWQoKSk7CgogICAgdmF1bHQucmVmdW5kKG1zZy5zZW5kZXIpOwogIH0KCiAgLy8gdmF1bHQgZmluYWxpemF0aW9uIHRhc2ssIGNhbGxlZCB3aGVuIG93bmVyIGNhbGxzIGZpbmFsaXplKCkKICBmdW5jdGlvbiBmaW5hbGl6YXRpb24oKSBpbnRlcm5hbCB7CiAgICBpZiAoZ29hbFJlYWNoZWQoKSkgewogICAgICB2YXVsdC5jbG9zZSgpOwogICAgfSBlbHNlIHsKICAgICAgdmF1bHQuZW5hYmxlUmVmdW5kcygpOwogICAgfQoKICAgIHN1cGVyLmZpbmFsaXphdGlvbigpOwogIH0KCiAgZnVuY3Rpb24gZ29hbFJlYWNoZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHdlaVJhaXNlZCA+PSBnb2FsOwogIH0KCn0KCmNvbnRyYWN0IFpha2VtRmFuc0Nyb3dkc2FsZSBpcyBQYXVzYWJsZSwgUmVmdW5kYWJsZUNyb3dkc2FsZSwgQ2FwcGVkQ3Jvd2RzYWxlIHsKICAgICAgICAvKioKICAgICAgICAgICBBZGRyZXNzIG9mIHRoZSB3YWxsZXQgb2YgdGhlIGZvdW5kZXJzLgogICAgICAgICAgIEluIHRoaXMgd2FsbGV0LCBwYXJ0IG9mIHRoZSBmYWNpbGl0YXRpbmcgdG9rZW5zIHdpbGwgYmUgc3RvcmVkLCBhbmQgdGhleSB3aWxsIGJlIGxvY2tlZCBmb3IgMjQgbW9udGhzLgogICAgICAgICAqLwogICAgICAgIGFkZHJlc3MgcHVibGljIGZvdW5kZXJzV2FsbGV0OwoKICAgICAgICAvKioKICAgICAgICAgICBBZGRyZXNzIG9mIHRoZSB3YWxsZXQgdXNlZCB0byBwYXkgb3V0IGJvdW50aWVzLgogICAgICAgICAgIEluIHRoaXMgd2FsbGV0LCBwYXJ0IG9mIHRoZSBmYWNpbGl0YXRpbmcgdG9rZW5zIHdpbGwgYmUgc3RvcmVkLgogICAgICAgICAqLwogICAgICAgIGFkZHJlc3MgcHVibGljIGJvdW50aWVzV2FsbGV0OwoKICAgICAgICAvKioKICAgICAgICAgICBLZWVwcyB0cmFjayBvZiBob3cgbWFueSB0b2tlbnMgaGF2ZSBiZWVuIHJhaXNlZCBzbyBmYXIuCiAgICAgICAgICAgVXNlZCB0byBrbm93IHdoZW4gYGdvYWxgIGFuZCBgY2FwYCBoYXZlIGJlZW4gcmVhY2hlZC4KICAgICAgICAgKi8KICAgICAgICB1aW50MjU2IHB1YmxpYyBwdXJjaGFzZWRUb2tlbnNSYWlzZWQ7CgogICAgICAgIC8qKgogICAgICAgICAgIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgd2VyZSBzb2xkIGluIHRoZSBQcmVzYWxlIGJlZm9yZSB0aGUgQ3Jvd2RzYWxlLgogICAgICAgICAgIEdpdmVuIGR1cmluZyBjb25zdHJ1Y3Rpb24gb2YgdGhpcyBjb250cmFjdC4KICAgICAgICAgKi8KICAgICAgICB1aW50MjU2IHB1YmxpYyBwdXJjaGFzZWRUb2tlbnNSYWlzZWREdXJpbmdQcmVzYWxlOwoKICAgICAgICAvKioKICAgICAgICAgICBIZWxwZXIgcHJvcGVydHkgdG8gZW5zdXJlIHRoYXQgMS8xMiBvZiBgY2FwYCBkb2VzIG5vdCBuZWVkIHRvIGJlIHJlLWNhbGN1bGF0ZWQgZXZlcnkgdGltZS4KICAgICAgICAgKi8KICAgICAgICB1aW50MjU2IG9uZVR3ZWxmdGhPZkNhcDsKCiAgICAgICAgLyoqCiAgICAgICAgICAgQGRldiBDb25zdHJ1Y3RvciBvZiB0aGUgWmFrZW1GYW5zQ3Jvd2RzYWxlIGNvbnRyYWN0CgogICAgICAgICAgIEBwYXJhbSBfc3RhcnRUaW1lIHRpbWUgKFNvbGlkaXR5IFVOSVggdGltZXN0YW1wKSBmcm9tIHdoZW4gaXQgaXMgYWxsb3dlZCB0byBidXkgRklOQy4KICAgICAgICAgICBAcGFyYW0gX2VuZFRpbWUgdGltZSAoU29saWRpdHkgVU5JWCB0aW1lc3RhbXApIHVudGlsIHdoaWNoIGl0IGlzIGFsbG93ZWQgdG8gYnV5IEZJTkMuIChTaG91bGQgYmUgbGFyZ2VyIHRoYW4gc3RhcnRUaW1lKQogICAgICAgICAgIEBwYXJhbSBfcmF0ZSBOdW1iZXIgb2YgdG9rZW5zIGNyZWF0ZWQgcGVyIGV0aGVyLiAoU2luY2UgRXRoZXIgYW5kIFpha2VtQ29pbiB1c2UgdGhlIHNhbWUgbnVtYmVyIG9mIGRlY2ltYWwgcGxhY2VzLCB0aGlzIGNhbiBiZSByZWFkIGFzIGRpcmVjdCBjb252ZXJzaW9uIHJhdGUgb2YgRXRoZXIgLT4gWmFrZW1Db2luLikKICAgICAgICAgICBAcGFyYW0gX3dhbGxldCBUaGUgd2FsbGV0IG9mIFpha2VtRmFucyBpdHNlbGYsIHRvIHdoaWNoIHNvbWUgb2YgdGhlIGZhY2lsaXRhdGluZyB0b2tlbnMgd2lsbCBiZSBzZW50LgogICAgICAgICAgIEBwYXJhbSBfYm91bnRpZXNXYWxsZXQgVGhlIHdhbGxldCB1c2VkIHRvIHBheSBvdXQgYm91bnRpZXMsIHRvIHdoaWNoIHNvbWUgb2YgdGhlIGZhY2lsaXRhdGluZyB0b2tlbnMgd2lsbCBiZSBzZW50LgogICAgICAgICAgIEBwYXJhbSBfZm91bmRlcnNXYWxsZXQgVGhlIHdhbGxldCB1c2VkIGZvciB0aGUgZm91bmRlcnMsIHRvIHdoaWNoIHNvbWUgb2YgdGhlIGZhY2lsaXRhdGluZyB0b2tlbnMgd2lsbCBiZSBzZW50LgogICAgICAgICAgIEBwYXJhbSBfZ29hbCBUaGUgbWluaW11bSBnb2FsIChpbiAxICogMTBeKC0xOCkgdG9rZW5zKSB0aGF0IHRoZSBDcm93ZHNhbGUgbmVlZHMgdG8gcmVhY2guCiAgICAgICAgICAgQHBhcmFtIF9jYXAgVGhlIG1heGltdW0gY2FwIChpbiAxICogMTBeKC0xOCkgdG9rZW5zKSB0aGF0IHRoZSBDcm93ZHNhbGUgY2FuIHJlYWNoLgogICAgICAgICAgIEBwYXJhbSBfdG9rZW4gVGhlIGFkZHJlc3Mgd2hlcmUgdGhlIFpha2VtQ29pbiBjb250cmFjdCB3YXMgZGVwbG95ZWQgcHJpb3IgdG8gY3JlYXRpbmcgdGhpcyBjb250cmFjdC4KICAgICAgICAgICBAcGFyYW0gX3B1cmNoYXNlZFRva2Vuc1JhaXNlZER1cmluZ1ByZXNhbGUgVGhlIGFtb3VudCAoaW4gMSAqIDE4XjE4IHRva2VucykgdGhhdCB3YXMgcHVyY2hhc2VkIGR1cmluZyB0aGUgcHJlc2FsZS4KICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBaYWtlbUZhbnNDcm93ZHNhbGUgKAogICAgICAgICAgICAgICAgdWludDI1NiBfc3RhcnRUaW1lLAogICAgICAgICAgICAgICAgdWludDI1NiBfZW5kVGltZSwKICAgICAgICAgICAgICAgIHVpbnQyNTYgX3JhdGUsCiAgICAgICAgICAgICAgICBhZGRyZXNzIF93YWxsZXQsCiAgICAgICAgICAgICAgICBhZGRyZXNzIF9ib3VudGllc1dhbGxldCwKICAgICAgICAgICAgICAgIGFkZHJlc3MgX2ZvdW5kZXJzV2FsbGV0LAogICAgICAgICAgICAgICAgdWludDI1NiBfZ29hbCwKICAgICAgICAgICAgICAgIHVpbnQyNTYgX2NhcCwKICAgICAgICAgICAgICAgIGFkZHJlc3MgX3Rva2VuLAogICAgICAgICAgICAgICAgdWludDI1NiBfcHVyY2hhc2VkVG9rZW5zUmFpc2VkRHVyaW5nUHJlc2FsZQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgQ3Jvd2RzYWxlKF9zdGFydFRpbWUsIF9lbmRUaW1lLCBfcmF0ZSwgX3dhbGxldCkKICAgICAgICAgICAgICAgIFJlZnVuZGFibGVDcm93ZHNhbGUoX2dvYWwpCiAgICAgICAgICAgICAgICBDYXBwZWRDcm93ZHNhbGUoX2NhcCkKICAgICAgICB7CiAgICAgICAgICAgICAgICByZXF1aXJlKF9nb2FsIDwgX2NhcCk7CgogICAgICAgICAgICAgICAgYm91bnRpZXNXYWxsZXQgPSBfYm91bnRpZXNXYWxsZXQ7CiAgICAgICAgICAgICAgICBmb3VuZGVyc1dhbGxldCA9IF9mb3VuZGVyc1dhbGxldDsKICAgICAgICAgICAgICAgIHRva2VuID0gWmFrZW1Db2luKF90b2tlbik7CiAgICAgICAgICAgICAgICB3ZWlSYWlzZWQgPSAwOwoKICAgICAgICAgICAgICAgIHB1cmNoYXNlZFRva2Vuc1JhaXNlZER1cmluZ1ByZXNhbGUgPSBfcHVyY2hhc2VkVG9rZW5zUmFpc2VkRHVyaW5nUHJlc2FsZTsKICAgICAgICAgICAgICAgIHB1cmNoYXNlZFRva2Vuc1JhaXNlZCA9IHB1cmNoYXNlZFRva2Vuc1JhaXNlZER1cmluZ1ByZXNhbGU7CgogICAgICAgICAgICAgICAgb25lVHdlbGZ0aE9mQ2FwID0gX2NhcCAvIDEyOwogICAgICAgIH0KCiAgICAgICAgLyoKICAgICAgICAgIE92ZXJyaWRlcyBDcm93ZHNhbGUuY3JlYXRlVG9rZW5Db250cmFjdCwKICAgICAgICAgIGJlY2F1c2UgdGhlIFpha2VtRmFuc0Nyb3dkc2FsZSB1c2VzIGFuIGFscmVhZHktZGVwbG95ZWQKICAgICAgICAgIHRva2VuLCBzbyB0aGVyZSBpcyBubyBuZWVkIHRvIGludGVybmFsbHkgZGVwbG95IGEgY29udHJhY3QuCiAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBjcmVhdGVUb2tlbkNvbnRyYWN0KCkgaW50ZXJuYWwgcmV0dXJucyAoTWludGFibGVUb2tlbikgewogICAgICAgICAgICAgICAgcmV0dXJuIE1pbnRhYmxlVG9rZW4oMHgwKTsKICAgICAgICB9CgogICAgICAgIC8qCiAgICAgICAgICogT3ZlcnJpZGVzIHZlcnNpb24gb2YgQ3Jvd2RzYWxlLmJ1eVRva2VucyBiZWNhdXNlOgogICAgICAgICAqIC0gVGhlIFdlaS0+RkZDIHJhdGUgZGVwZW5kcyBvbiBob3cgbWFueSB0b2tlbnMgaGF2ZSBhbHJlYWR5IGJlZW4gc29sZCAoc2VlIGBjdXJyZW50Qm9udXNSYXRlKClgKS4KICAgICAgICAgKiAtIEFsc28gbWludCB0b2tlbnMgc2VudCB0byBaYWtlbUZhbnMgYW5kIHRoZSBGb3VuZGVycyBhdCB0aGUgc2FtZSB0aW1lLgogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIGJ1eVRva2VucyhhZGRyZXNzIGJlbmVmaWNpYXJ5KSBwdWJsaWMgcGF5YWJsZSB3aGVuTm90UGF1c2VkIHsKICAgICAgICAgICAgICAgIHJlcXVpcmUoYmVuZWZpY2lhcnkgIT0gMHgwKTsKCiAgICAgICAgICAgICAgICB1aW50MjU2IHdlaUFtb3VudCA9IG1zZy52YWx1ZTsKCiAgICAgICAgICAgICAgICAvLyBjYWxjdWxhdGUgdG9rZW4gYW1vdW50IHRvIGJlIGNyZWF0ZWQKICAgICAgICAgICAgICAgIHVpbnQyNTYgcHVyY2hhc2VkVG9rZW5zID0gd2VpQW1vdW50LmRpdihyYXRlKTsKICAgICAgICAgICAgICAgIHJlcXVpcmUodmFsaWRQdXJjaGFzZShwdXJjaGFzZWRUb2tlbnMpKTsKICAgICAgICAgICAgICAgIHB1cmNoYXNlZFRva2VucyA9IHB1cmNoYXNlZFRva2Vucy5tdWwoY3VycmVudEJvbnVzUmF0ZSgpKS5kaXYoMTAwKTsKICAgICAgICAgICAgICAgIHJlcXVpcmUocHVyY2hhc2VkVG9rZW5zICE9IDApOwoKICAgICAgICAgICAgICAgIC8vIHVwZGF0ZSBzdGF0ZQogICAgICAgICAgICAgICAgd2VpUmFpc2VkID0gd2VpUmFpc2VkLmFkZCh3ZWlBbW91bnQpOwogICAgICAgICAgICAgICAgcHVyY2hhc2VkVG9rZW5zUmFpc2VkID0gcHVyY2hhc2VkVG9rZW5zUmFpc2VkLmFkZChwdXJjaGFzZWRUb2tlbnMpOwoKICAgICAgICAgICAgICAgIC8vIE1pbnQgdG9rZW5zIGZvciBiZW5lZmljaWFyeQogICAgICAgICAgICAgICAgdG9rZW4ubWludChiZW5lZmljaWFyeSwgcHVyY2hhc2VkVG9rZW5zKTsKICAgICAgICAgICAgICAgIFRva2VuUHVyY2hhc2UobXNnLnNlbmRlciwgYmVuZWZpY2lhcnksIHdlaUFtb3VudCwgcHVyY2hhc2VkVG9rZW5zKTsKCiAgICAgICAgICAgICAgICBtaW50VG9rZW5zRm9yRmFjaWxpdGF0b3JzKHB1cmNoYXNlZFRva2Vucyk7CgogICAgICAgICAgICAgICAgZm9yd2FyZEZ1bmRzKCk7CiAgICAgICAgfQoKICAgICAgICAvKiBPdmVycmlkZXMgUmVmdW5kYWJsZUNyb3dkc2FsZSNnb2FsUmVhY2hlZAogICAgICAgICAgIHNpbmNlIHdlIGNvdW50IHRoZSBnb2FsIGluIHB1cmNoYXNlZCB0b2tlbnMsIGluc3RlYWQgb2YgaW4gV2VpLgogICAgICAgICAgIEByZXR1cm4gdHJ1ZSBpZiBjcm93ZHNhbGUgaGFzIHJlYWNoZWQgbW9yZSBmdW5kcyB0aGFuIHRoZSBtaW5pbXVtIGdvYWwuCiAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBnb2FsUmVhY2hlZCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcHVyY2hhc2VkVG9rZW5zUmFpc2VkID49IGdvYWw7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgICBPdmVycmlkZXMgQ2FwcGVkQ3Jvd2RzYWxlI2hhc0VuZGVkIHRvIGFkZCBjYXAgbG9naWMgaW4gdG9rZW5zCiAgICAgICAgICAgQHJldHVybiB0cnVlIGlmIGNyb3dkc2FsZSBldmVudCBoYXMgZW5kZWQKICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIGhhc0VuZGVkKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICAgICAgICAgIGJvb2wgY2FwUmVhY2hlZCA9IHB1cmNoYXNlZFRva2Vuc1JhaXNlZCA+PSBjYXA7CiAgICAgICAgICAgICAgICByZXR1cm4gQ3Jvd2RzYWxlLmhhc0VuZGVkKCkgfHwgY2FwUmVhY2hlZDsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAgIHJlcGxhY2VzIENhcHBlZENyb3dkc2FsZSN2YWxpZFB1cmNoYXNlIHRvIGFkZCBleHRyYSBjYXAgbG9naWMgaW4gdG9rZW5zCiAgICAgICAgICAgQHBhcmFtIHB1cmNoYXNlZFRva2VucyBBbW91bnQgb2YgdG9rZW5zIHRoYXQgd2VyZSBwdXJjaGFzZWQgKGluIHRoZSBzbWFsbGVzdCwgMSAqIDEwXigtMTgpIGRlbm9taW5hdGlvbikKICAgICAgICAgICBAcmV0dXJuIHRydWUgaWYgaW52ZXN0b3JzIGFyZSBhbGxvd2VkIHRvIHB1cmNoYXNlIHRva2VucyBhdCB0aGUgbW9tZW50LgogICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gdmFsaWRQdXJjaGFzZSh1aW50MjU2IHB1cmNoYXNlZFRva2VucykgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgICAgICAgICAgLyogYm9vbCB3aXRoaW5DYXAgPSBwdXJjaGFzZWRUb2tlbnNSYWlzZWQuYWRkKHB1cmNoYXNlZFRva2VucykgPD0gY2FwOyAqLwogICAgICAgICAgICAgICAgLyogcmV0dXJuIENyb3dkc2FsZS52YWxpZFB1cmNoYXNlKCkgJiYgd2l0aGluQ2FwOyAqLwogICAgICAgICAgICAgICAgYm9vbCB3aXRoaW5DYXAgPSBwdXJjaGFzZWRUb2tlbnNSYWlzZWQuYWRkKHB1cmNoYXNlZFRva2VucykgPD0gY2FwOwogICAgICAgICAgICAgICAgcmV0dXJuIENyb3dkc2FsZS52YWxpZFB1cmNoYXNlKCkgJiYgd2l0aGluQ2FwOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICAgQGRldiBNaW50cyB0aGUgdG9rZW5zIGZvciB0aGUgZmFjaWxpdGF0aW5nIHBhcnRpZXMuCgogICAgICAgICAgIEBkZXYgSW4gdG90YWwsICgyMC8xMykgKiBgcHVyY2hhc2VkVG9rZW5zYCB0b2tlbnMgYXJlIGNyZWF0ZWQuCiAgICAgICAgICAgQGRldiAxMy8xM3RoIG9mIHRoZXNlIGFyZSBmb3IgdGhlIEJlbmVmaWNpYXJ5LgogICAgICAgICAgIEBkZXYgNy8xM3RoIG9mIHRoZXNlIGFyZSBtaW50ZWQgZm9yIHRoZSBGYWNpbGl0YXRvcnMgYXMgZm9sbG93czoKICAgICAgICAgICBAZGV2ICAgMS8xM3RoIC0+IEZvdW5kZXJzCiAgICAgICAgICAgQGRldiAgIDIvMTN0aCAtPiBCb3VudGllcwogICAgICAgICAgIEBkZXYgICA0LzEzdGggLT4gWmFrZW1GYW5zCgogICAgICAgICAgIEBkZXYgTm90ZSB0aGF0IGFsbCByZXN1bHQgcmF0aW9uYWwgYW1vdW50cyBhcmUgZmxvb3JlZCBzaW5jZSB0aGUgRVZNIG9ubHkgd29ya3Mgd2l0aCBpbnRlZ2VyIGFyaXRobWV0aWMuCiAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBtaW50VG9rZW5zRm9yRmFjaWxpdGF0b3JzKHVpbnQyNTYgcHVyY2hhc2VkVG9rZW5zKSBpbnRlcm5hbCB7CiAgICAgICAgICAgICAgICAvLyBNaW50IHRva2VucyBmb3IgWmFrZW1GYW5zIGFuZCBGb3VuZGVycwogICAgICAgICAgICAgICAgdWludDI1NiBmaW50ZWNoZmFuc190b2tlbnMgPSBwdXJjaGFzZWRUb2tlbnMubXVsKDQpLmRpdigxMyk7CiAgICAgICAgICAgICAgICB1aW50MjU2IGJvdW50aWVzX3Rva2VucyA9IHB1cmNoYXNlZFRva2Vucy5tdWwoMikuZGl2KDEzKTsKICAgICAgICAgICAgICAgIHVpbnQyNTYgZm91bmRlcnNfdG9rZW5zID0gcHVyY2hhc2VkVG9rZW5zLm11bCgxKS5kaXYoMTMpOwogICAgICAgICAgICAgICAgdG9rZW4ubWludCh3YWxsZXQsIGZpbnRlY2hmYW5zX3Rva2Vucyk7CiAgICAgICAgICAgICAgICB0b2tlbi5taW50KGJvdW50aWVzV2FsbGV0LCBib3VudGllc190b2tlbnMpOwogICAgICAgICAgICAgICAgdG9rZW4ubWludChmb3VuZGVyc1dhbGxldCwgZm91bmRlcnNfdG9rZW5zKTsvKiBUT0RPIExvY2tlZCB2YXVsdD8gKi8KICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAgIEBkZXYgcmV0dXJucyB0aGUgY3VycmVudCBib251cyByYXRlLiBUaGlzIGlzIGEgY2FsbCB0aGF0IGNhbiBiZSBkb25lIGF0IGFueSB0aW1lLgoKICAgICAgICAgICBAcmV0dXJuIGEgZml4ZWQtc2l6ZSBudW1iZXIgdGhhdCBpcyB0aGUgdG90YWwgcGVyY2VudGFnZSBvZiB0b2tlbnMgdGhhdCB3aWxsIGJlIGNyZWF0ZWQuICgxMDAgKiB0aGUgYm9udXMgcmF0aW8pCgogICAgICAgICAgIEBkZXYgV2hlbiA8IDIgbWlsbGlvbiB0b2tlbnMgcHVyY2hhc2VkLCB0aGlzIHdpbGwgYmUgMTI1JSwgd2hpY2ggaXMgZXF1aXZhbGVudCB0byBhIDIwJSBkaXNjb3VudAogICAgICAgICAgIEBkZXYgV2hlbiA8IDQgbWlsbGlvbiB0b2tlbnMgcHVyY2hhc2VkLCAxMTglLCB3aGljaCBpcyBlcXVpdmFsZW50IHRvIGEgMTUlIGRpc2NvdW50LgogICAgICAgICAgIEBkZXYgV2hlbiA8IDYgbWlsbGlvbiB0b2tlbnMgcHVyY2hhc2VkLCAxMTElLCB3aGljaCBpcyBlcXVpdmFsZW50IHRvIGEgMTAlIGRpc2NvdW50LgogICAgICAgICAgIEBkZXYgV2hlbiA8IDkgbWlsbGlvbiB0b2tlbnMgcHVyY2hhc2VkLCAxMDUlLCB3aGljaCBpcyBlcXVpdmFsZW50IHRvIGEgNSUgZGlzY291bnQuCiAgICAgICAgICAgQGRldiBPdGhlcndpc2UsIHRoZXJlIGlzIG5vIGJvbnVzIGFuZCB0aGUgZnVuY3Rpb24gcmV0dXJucyAxMDAlLgogICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gY3VycmVudEJvbnVzUmF0ZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgICAgICAgICBpZihwdXJjaGFzZWRUb2tlbnNSYWlzZWQgPCAoMiAqIG9uZVR3ZWxmdGhPZkNhcCkpIHJldHVybiAxMjUvKi4yNSovOyAvLyAyMCUgZGlzY291bnQKICAgICAgICAgICAgICAgIGlmKHB1cmNoYXNlZFRva2Vuc1JhaXNlZCA8ICg0ICogb25lVHdlbGZ0aE9mQ2FwKSkgcmV0dXJuIDExOC8qLjE3NjQ3MDU4ODIzNTI5NDIqLzsgLy8gMTUlIGRpc2NvdW50CiAgICAgICAgICAgICAgICBpZihwdXJjaGFzZWRUb2tlbnNSYWlzZWQgPCAoNiAqIG9uZVR3ZWxmdGhPZkNhcCkpIHJldHVybiAxMTEvKi4xMTExMTExMTExMTExMTEyKi87IC8vIDEwJSBkaXNjb3VudAogICAgICAgICAgICAgICAgaWYocHVyY2hhc2VkVG9rZW5zUmFpc2VkIDwgKDkgKiBvbmVUd2VsZnRoT2ZDYXApKSByZXR1cm4gMTA1LyouMDUyNjMxNTc4OTQ3MzY4NCovOyAvLyA1JSBkaXNjb3VudAogICAgICAgICAgICAgICAgcmV0dXJuIDEwMDsKICAgICAgICB9Cn0KCmNvbnRyYWN0IFRoZVpha2VtRmFuc0Nyb3dkc2FsZSBpcyBaYWtlbUZhbnNDcm93ZHNhbGUgewogICAgZnVuY3Rpb24gVGhlWmFrZW1GYW5zQ3Jvd2RzYWxlKCkKICAgICAgICBaYWtlbUZhbnNDcm93ZHNhbGUoCiAgICAgICAgICAgIDE1MTEzODAyMDAsIC8vIF9zdGFydFRpbWUgdGltZSAoU29saWRpdHkgVU5JWCB0aW1lc3RhbXApIGZyb20gd2hlbiBpdCBpcyBhbGxvd2VkIHRvIGJ1eSBGSU5DLgogICAgICAgICAgICAxNTExMzg0NDAwLCAvLyBfZW5kVGltZSB0aW1lIChTb2xpZGl0eSBVTklYIHRpbWVzdGFtcCkgdW50aWwgd2hpY2ggaXQgaXMgYWxsb3dlZCB0byBidXkgRklOQy4gKFNob3VsZCBiZSBsYXJnZXIgdGhhbiBzdGFydFRpbWUpCiAgICAgICAgICAgIDIsIC8vIF9yYXRlIE51bWJlciBvZiB0b2tlbnMgY3JlYXRlZCBwZXIgZXRoZXIuIChTaW5jZSBFdGhlciBhbmQgWmFrZW1Db2luIHVzZSB0aGUgc2FtZSBudW1iZXIgb2YgZGVjaW1hbCBwbGFjZXMsIHRoaXMgY2FuIGJlIHJlYWQgYXMgZGlyZWN0IGNvbnZlcnNpb24gcmF0ZSBvZiBFdGhlciAtPiBaYWtlbUNvaW4uKQogICAgICAgICAgICAweGQ1RDI5ZjE4QjhDMkM3MTU3QjZCRjM4MTExQzkzMThiOTYwNEJkRUQsIC8vIF93YWxsZXQgVGhlIHdhbGxldCBvZiBaYWtlbUZhbnMgaXRzZWxmLCB0byB3aGljaCBzb21lIG9mIHRoZSBmYWNpbGl0YXRpbmcgdG9rZW5zIHdpbGwgYmUgc2VudC4KICAgICAgICAgICAgMHg2QjE5NjQxMTk4NDFmM2Y1MzYzRDdFQTA4MTIwNjQyRkU0ODc0MTBFLCAvLyBfYm91bnRpZXNXYWxsZXQgVGhlIHdhbGxldCB1c2VkIHRvIHBheSBvdXQgYm91bnRpZXMsIHRvIHdoaWNoIHNvbWUgb2YgdGhlIGZhY2lsaXRhdGluZyB0b2tlbnMgd2lsbCBiZSBzZW50LgogICAgICAgICAgICAweDlhMTIzZkRkNzA4ZUQwOTMxRmI0OTM4QzViMkUyNDYyQjZEMjMzOTAsIC8vIF9mb3VuZGVyc1dhbGxldCBUaGUgd2FsbGV0IHVzZWQgZm9yIHRoZSBmb3VuZGVycywgdG8gd2hpY2ggc29tZSBvZiB0aGUgZmFjaWxpdGF0aW5nIHRva2VucyB3aWxsIGJlIHNlbnQuCiAgICAgICAgICAgIDFlMTYsIC8vIF9nb2FsIFRoZSBtaW5pbXVtIGdvYWwgKGluIDEgKiAxMF4oLTE4KSB0b2tlbnMpIHRoYXQgdGhlIENyb3dkc2FsZSBuZWVkcyB0byByZWFjaC4KICAgICAgICAgICAgMTJlMTYsIC8vIF9jYXAgVGhlIG1heGltdW0gY2FwIChpbiAxICogMTBeKC0xOCkgdG9rZW5zKSB0aGF0IHRoZSBDcm93ZHNhbGUgY2FuIHJlYWNoLgogICAgICAgICAgICAweGFhQzViNzA0ODExNGQ3MGI3NTlFOUVBMTdBRkE0RmY5Njk5MzFhNGEsIC8vIF90b2tlbiBUaGUgYWRkcmVzcyB3aGVyZSB0aGUgWmFrZW1Db2luIGNvbnRyYWN0IHdhcyBkZXBsb3llZCBwcmlvciB0byBjcmVhdGluZyB0aGlzIGNvbnRyYWN0LgogICAgICAgICAgICAwICAvLyBfcHVyY2hhc2VkVG9rZW5zUmFpc2VkRHVyaW5nUHJlc2FsZSBUaGUgYW1vdW50IChpbiAxICogMTheMTggdG9rZW5zKSB0aGF0IHdhcyBwdXJjaGFzZWQgZHVyaW5nIHRoZSBwcmVzYWxlLgogICAgICAgICAgICApCiAgICB7CiAgICB9Cn0KCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgRVJDMjAsIEJhc2ljVG9rZW4gewoKICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CgoKICAvKioKICAgKiBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIKICAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tCiAgICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHRyYW5zZmVyIHRvCiAgICogQHBhcmFtIF92YWx1ZSB1aW50MjU2IHRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwoKICAgIHVpbnQyNTYgX2FsbG93YW5jZSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdOwoKICAgIC8vIENoZWNrIGlzIG5vdCBuZWVkZWQgYmVjYXVzZSBzdWIoX2FsbG93YW5jZSwgX3ZhbHVlKSB3aWxsIGFscmVhZHkgdGhyb3cgaWYgdGhpcyBjb25kaXRpb24gaXMgbm90IG1ldAogICAgLy8gcmVxdWlyZSAoX3ZhbHVlIDw9IF9hbGxvd2FuY2UpOwoKICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBfYWxsb3dhbmNlLnN1YihfdmFsdWUpOwogICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBBcHByb3ZlIHRoZSBwYXNzZWQgYWRkcmVzcyB0byBzcGVuZCB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiB0b2tlbnMgb24gYmVoYWxmIG9mIG1zZy5zZW5kZXIuCiAgICoKICAgKiBCZXdhcmUgdGhhdCBjaGFuZ2luZyBhbiBhbGxvd2FuY2Ugd2l0aCB0aGlzIG1ldGhvZCBicmluZ3MgdGhlIHJpc2sgdGhhdCBzb21lb25lIG1heSB1c2UgYm90aCB0aGUgb2xkCiAgICogYW5kIHRoZSBuZXcgYWxsb3dhbmNlIGJ5IHVuZm9ydHVuYXRlIHRyYW5zYWN0aW9uIG9yZGVyaW5nLiBPbmUgcG9zc2libGUgc29sdXRpb24gdG8gbWl0aWdhdGUgdGhpcwogICAqIHJhY2UgY29uZGl0aW9uIGlzIHRvIGZpcnN0IHJlZHVjZSB0aGUgc3BlbmRlcidzIGFsbG93YW5jZSB0byAwIGFuZCBzZXQgdGhlIGRlc2lyZWQgdmFsdWUgYWZ0ZXJ3YXJkczoKICAgKiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHNwZW50LgogICAqLwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIGNoZWNrIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgYW4gb3duZXIgYWxsb3dlZCB0byBhIHNwZW5kZXIuCiAgICogQHBhcmFtIF9vd25lciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIG93bnMgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfc3BlbmRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEByZXR1cm4gQSB1aW50MjU2IHNwZWNpZnlpbmcgdGhlIGFtb3VudCBvZiB0b2tlbnMgc3RpbGwgYXZhaWxhYmxlIGZvciB0aGUgc3BlbmRlci4KICAgKi8KICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgfQoKICAvKioKICAgKiBhcHByb3ZlIHNob3VsZCBiZSBjYWxsZWQgd2hlbiBhbGxvd2VkW19zcGVuZGVyXSA9PSAwLiBUbyBpbmNyZW1lbnQKICAgKiBhbGxvd2VkIHZhbHVlIGlzIGJldHRlciB0byB1c2UgdGhpcyBmdW5jdGlvbiB0byBhdm9pZCAyIGNhbGxzIChhbmQgd2FpdCB1bnRpbAogICAqIHRoZSBmaXJzdCB0cmFuc2FjdGlvbiBpcyBtaW5lZCkKICAgKiBGcm9tIE1vbm9saXRoREFPIFRva2VuLnNvbAogICAqLwogIGZ1bmN0aW9uIGluY3JlYXNlQXBwcm92YWwgKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2FkZGVkVmFsdWUpCiAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0uYWRkKF9hZGRlZFZhbHVlKTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIGRlY3JlYXNlQXBwcm92YWwgKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3N1YnRyYWN0ZWRWYWx1ZSkKICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgdWludCBvbGRWYWx1ZSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdOwogICAgaWYgKF9zdWJ0cmFjdGVkVmFsdWUgPiBvbGRWYWx1ZSkgewogICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IDA7CiAgICB9IGVsc2UgewogICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IG9sZFZhbHVlLnN1Yihfc3VidHJhY3RlZFZhbHVlKTsKICAgIH0KICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cgp9Cgpjb250cmFjdCBNaW50YWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIE93bmFibGUgewogIGV2ZW50IE1pbnQoYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IGFtb3VudCk7CiAgZXZlbnQgTWludEZpbmlzaGVkKCk7CgogIGJvb2wgcHVibGljIG1pbnRpbmdGaW5pc2hlZCA9IGZhbHNlOwoKCiAgbW9kaWZpZXIgY2FuTWludCgpIHsKICAgIHJlcXVpcmUoIW1pbnRpbmdGaW5pc2hlZCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBtaW50IHRva2VucwogICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHJlY2VpdmUgdGhlIG1pbnRlZCB0b2tlbnMuCiAgICogQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gbWludC4KICAgKiBAcmV0dXJuIEEgYm9vbGVhbiB0aGF0IGluZGljYXRlcyBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLgogICAqLwogIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgb25seU93bmVyIGNhbk1pbnQgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkuYWRkKF9hbW91bnQpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF9hbW91bnQpOwogICAgTWludChfdG8sIF9hbW91bnQpOwogICAgVHJhbnNmZXIoMHgwLCBfdG8sIF9hbW91bnQpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIHN0b3AgbWludGluZyBuZXcgdG9rZW5zLgogICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLgogICAqLwogIGZ1bmN0aW9uIGZpbmlzaE1pbnRpbmcoKSBvbmx5T3duZXIgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIG1pbnRpbmdGaW5pc2hlZCA9IHRydWU7CiAgICBNaW50RmluaXNoZWQoKTsKICAgIHJldHVybiB0cnVlOwogIH0KfQoKY29udHJhY3QgQnVybmFibGVUb2tlbiBpcyBTdGFuZGFyZFRva2VuIHsKCiAgICBldmVudCBCdXJuKGFkZHJlc3MgaW5kZXhlZCBidXJuZXIsIHVpbnQyNTYgdmFsdWUpOwoKICAgIC8qKgogICAgICogQGRldiBCdXJucyBhIHNwZWNpZmljIGFtb3VudCBvZiB0b2tlbnMuCiAgICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW4gdG8gYmUgYnVybmVkLgogICAgICovCiAgICBmdW5jdGlvbiBidXJuKHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoX3ZhbHVlID4gMCk7CgogICAgICAgIGFkZHJlc3MgYnVybmVyID0gbXNnLnNlbmRlcjsKICAgICAgICBiYWxhbmNlc1tidXJuZXJdID0gYmFsYW5jZXNbYnVybmVyXS5zdWIoX3ZhbHVlKTsKICAgICAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LnN1YihfdmFsdWUpOwogICAgICAgIEJ1cm4oYnVybmVyLCBfdmFsdWUpOwogICAgfQp9Cgpjb250cmFjdCBBcHByb3ZlZEJ1cm5hYmxlVG9rZW4gaXMgQnVybmFibGVUb2tlbiB7CgogICAgICAgIC8qKgogICAgICAgICAgIFNlbnQgd2hlbiBgYnVybmVyYCBidXJucyBzb21lIGB2YWx1ZWAgb2YgYG93bmVyc2AgdG9rZW5zLgogICAgICAgICovCiAgICAgICAgZXZlbnQgQnVybkZyb20oYWRkcmVzcyBpbmRleGVkIG93bmVyLCAvLyBUaGUgYWRkcmVzcyB3aG9zZSB0b2tlbnMgd2VyZSBidXJuZWQuCiAgICAgICAgICAgICAgICAgICAgICAgYWRkcmVzcyBpbmRleGVkIGJ1cm5lciwgLy8gVGhlIGFkZHJlc3MgdGhhdCBleGVjdXRlZCB0aGUgYGJ1cm5Gcm9tYCBjYWxsCiAgICAgICAgICAgICAgICAgICAgICAgdWludDI1NiB2YWx1ZSAgICAgICAgICAgLy8gVGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCB3ZXJlIGJ1cm5lZC4KICAgICAgICAgICAgICAgICk7CgogICAgICAgIC8qKgogICAgICAgICAgIEBkZXYgQnVybnMgYSBzcGVjaWZpYyBhbW91bnQgb2YgdG9rZW5zIG9mIGFub3RoZXIgYWNjb3VudCB0aGF0IGBtc2cuc2VuZGVyYAogICAgICAgICAgIHdhcyBhcHByb3ZlZCB0byBidXJuIHRva2VucyBmb3IgdXNpbmcgYGFwcHJvdmVCdXJuYCBlYXJsaWVyLgogICAgICAgICAgIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdG8gYnVybiB0b2tlbnMgZnJvbS4KICAgICAgICAgICBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW4gdG8gYmUgYnVybmVkLgogICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gYnVybkZyb20oYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgewogICAgICAgICAgICAgICAgcmVxdWlyZShfdmFsdWUgPiAwKTsKICAgICAgICAgICAgICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGJhbGFuY2VzW19vd25lcl0pOwogICAgICAgICAgICAgICAgcmVxdWlyZShfdmFsdWUgPD0gYWxsb3dlZFtfb3duZXJdW21zZy5zZW5kZXJdKTsKICAgICAgICAgICAgICAgIC8vIG5vIG5lZWQgdG8gcmVxdWlyZSB2YWx1ZSA8PSB0b3RhbFN1cHBseSwgc2luY2UgdGhhdCB3b3VsZCBpbXBseSB0aGUKICAgICAgICAgICAgICAgIC8vIHNlbmRlcidzIGJhbGFuY2UgaXMgZ3JlYXRlciB0aGFuIHRoZSB0b3RhbFN1cHBseSwgd2hpY2ggKnNob3VsZCogYmUgYW4gYXNzZXJ0aW9uIGZhaWx1cmUKCiAgICAgICAgICAgICAgICBhZGRyZXNzIGJ1cm5lciA9IG1zZy5zZW5kZXI7CiAgICAgICAgICAgICAgICBiYWxhbmNlc1tfb3duZXJdID0gYmFsYW5jZXNbX293bmVyXS5zdWIoX3ZhbHVlKTsKICAgICAgICAgICAgICAgIGFsbG93ZWRbX293bmVyXVtidXJuZXJdID0gYWxsb3dlZFtfb3duZXJdW2J1cm5lcl0uc3ViKF92YWx1ZSk7CiAgICAgICAgICAgICAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LnN1YihfdmFsdWUpOwoKICAgICAgICAgICAgICAgIEJ1cm5Gcm9tKF9vd25lciwgYnVybmVyLCBfdmFsdWUpOwogICAgICAgICAgICAgICAgQnVybihfb3duZXIsIF92YWx1ZSk7CiAgICAgICAgfQp9Cgpjb250cmFjdCBVbmxvY2tlZEFmdGVyTWludGluZ1Rva2VuIGlzIE1pbnRhYmxlVG9rZW4gewoKICAgIC8qKgogICAgICAgRW5zdXJlcyBjZXJ0YWluIGNhbGxzIGNhbiBvbmx5IGJlIG1hZGUgd2hlbiBtaW50aW5nIGlzIGZpbmlzaGVkLgoKICAgICAgIFRoZSBjYWxscyB0aGF0IGFyZSByZXN0cmljdGVkIGFyZSBhbnkgY2FsbHMgdGhhdCBhbGxvdyBkaXJlY3Qgb3IgaW5kaXJlY3QgdHJhbnNmZXJyYWwgb2YgZnVuZHMuCiAgICAgKi8KICAgIG1vZGlmaWVyIHdoZW5NaW50aW5nRmluaXNoZWQoKSB7CiAgICAgICAgcmVxdWlyZShtaW50aW5nRmluaXNoZWQpOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgd2hlbk1pbnRpbmdGaW5pc2hlZCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyKF90bywgX3ZhbHVlKTsKICAgIH0KCiAgICAvKioKICAgICAgQGRldiBUcmFuc2ZlciB0b2tlbnMgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyCiAgICAgIEBwYXJhbSBfZnJvbSBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20KICAgICAgQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHRyYW5zZmVyIHRvCiAgICAgIEBwYXJhbSBfdmFsdWUgdWludDI1NiB0aGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgd2hlbk1pbnRpbmdGaW5pc2hlZCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgfQoKICAgIC8qKgogICAgICBAZGV2IEFwcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWhhbGYgb2YgbXNnLnNlbmRlci4KICAgICAgQGRldiBOT1RFOiBUaGlzIGNhbGwgaXMgY29uc2lkZXJlZCBkZXByZWNhdGVkLCBhbmQgb25seSBpbmNsdWRlZCBmb3IgcHJvcGVyIGNvbXBsaWFuY2Ugd2l0aCBFUkMyMC4KICAgICAgQGRldiBSYXRoZXIgdGhhbiB1c2UgdGhpcyBjYWxsLCB1c2UgYGluY3JlYXNlQXBwcm92YWxgIGFuZCBgZGVjcmVhc2VBcHByb3ZhbGAgaW5zdGVhZCwgd2hlbmV2ZXIgcG9zc2libGUuCiAgICAgIEBkZXYgVGhlIHJlYXNvbiBmb3IgdGhpcywgaXMgdGhhdCB1c2luZyBgYXBwcm92ZWAgZGlyZWN0bHkgd2hlbiB5b3VyIGFsbG93YW5jZSBpcyBub256ZXJvIHJlc3VsdHMgaW4gYW4gZXhwbG9pdGFibGUgc2l0dWF0aW9uOgogICAgICBAZGV2IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CgogICAgICBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICAgIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyB3aGVuTWludGluZ0ZpbmlzaGVkIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gc3VwZXIuYXBwcm92ZShfc3BlbmRlciwgX3ZhbHVlKTsKICAgIH0KCiAgICAvKioKICAgICAgQGRldiBhcHByb3ZlIHNob3VsZCBvbmx5IGJlIGNhbGxlZCB3aGVuIGFsbG93ZWRbX3NwZW5kZXJdID09IDAuIFRvIGFsdGVyIHRoZQogICAgICBAZGV2IGFsbG93ZWQgdmFsdWUgaXQgaXMgYmV0dGVyIHRvIHVzZSB0aGlzIGZ1bmN0aW9uLCBiZWNhdXNlIGl0IGlzIHNhZmVyLgogICAgICBAZGV2IChBbmQgbWFraW5nIGBhcHByb3ZlYCBzYWZlIG1hbnVhbGx5IHdvdWxkIHJlcXVpcmUgbWFraW5nIHR3byBjYWxscyBtYWRlIGluIHNlcGFyYXRlIGJsb2Nrcy4pCgogICAgICBUaGlzIG1ldGhvZCB3YXMgYWRhcHRlZCBmcm9tIHRoZSBvbmUgaW4gdXNlIGJ5IHRoZSBNb25vbGl0aERBTyBUb2tlbi4KICAgICAqLwogICAgZnVuY3Rpb24gaW5jcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hZGRlZFZhbHVlKSBwdWJsaWMgd2hlbk1pbnRpbmdGaW5pc2hlZCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXR1cm4gc3VwZXIuaW5jcmVhc2VBcHByb3ZhbChfc3BlbmRlciwgX2FkZGVkVmFsdWUpOwogICAgfQoKICAgIC8qKgogICAgICAgQGRldiBhcHByb3ZlIHNob3VsZCBvbmx5IGJlIGNhbGxlZCB3aGVuIGFsbG93ZWRbX3NwZW5kZXJdID09IDAuIFRvIGFsdGVyIHRoZQogICAgICAgQGRldiBhbGxvd2VkIHZhbHVlIGl0IGlzIGJldHRlciB0byB1c2UgdGhpcyBmdW5jdGlvbiwgYmVjYXVzZSBpdCBpcyBzYWZlci4KICAgICAgIEBkZXYgKEFuZCBtYWtpbmcgYGFwcHJvdmVgIHNhZmUgbWFudWFsbHkgd291bGQgcmVxdWlyZSBtYWtpbmcgdHdvIGNhbGxzIG1hZGUgaW4gc2VwYXJhdGUgYmxvY2tzLikKCiAgICAgICBUaGlzIG1ldGhvZCB3YXMgYWRhcHRlZCBmcm9tIHRoZSBvbmUgaW4gdXNlIGJ5IHRoZSBNb25vbGl0aERBTyBUb2tlbi4KICAgICovCiAgICBmdW5jdGlvbiBkZWNyZWFzZUFwcHJvdmFsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3N1YnRyYWN0ZWRWYWx1ZSkgcHVibGljIHdoZW5NaW50aW5nRmluaXNoZWQgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmV0dXJuIHN1cGVyLmRlY3JlYXNlQXBwcm92YWwoX3NwZW5kZXIsIF9zdWJ0cmFjdGVkVmFsdWUpOwogICAgfQoKICAgIC8vIFRPRE8gUHJldmVudCBidXJuaW5nPwp9Cgpjb250cmFjdCBaYWtlbUNvaW4gaXMgVW5sb2NrZWRBZnRlck1pbnRpbmdUb2tlbiwgQXBwcm92ZWRCdXJuYWJsZVRva2VuIHsKICAgICAgICAvKioKICAgICAgICAgICBAZGV2IFdlIGRvIG5vdCBleHBlY3QgdGhpcyB0byBjaGFuZ2UgZXZlciBhZnRlciBkZXBsb3ltZW50LAogICAgICAgICAgIEBkZXYgYnV0IGl0IGlzIGEgd2F5IHRvIGlkZW50aWZ5IGRpZmZlcmVudCB2ZXJzaW9ucyBvZiB0aGUgWmFrZW1Db2luIGR1cmluZyBkZXZlbG9wbWVudC4KICAgICAgICAqLwogICAgICAgIHVpbnQ4IHB1YmxpYyBjb25zdGFudCBjb250cmFjdFZlcnNpb24gPSAxOwoKICAgICAgICAvKioKICAgICAgICAgICBAZGV2IFRoZSBuYW1lIG9mIHRoZSBaYWtlbUNvaW4sIHNwZWNpZmllZCBhcyBpbmRpY2F0ZWQgaW4gRVJDMjAuCiAgICAgICAgICovCiAgICAgICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBuYW1lID0gIlpha2VtQ29pbiI7CgogICAgICAgIC8qKgogICAgICAgICAgIEBkZXYgVGhlIGFiYnJldmlhdGlvbiBGSU5DLCBzcGVjaWZpZWQgYXMgaW5kaWNhdGVkIGluIEVSQzIwLgogICAgICAgICovCiAgICAgICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAiRklOQyI7CgogICAgICAgIC8qKgogICAgICAgICAgIEBkZXYgVGhlIHNtYWxsZXN0IGRlbm9taW5hdGlvbiBvZiB0aGUgWmFrZW1Db2luIGlzIDEgKiAxMF4oLTE4KSBGSU5DLiBgZGVjaW1hbHNgIGlzIHNwZWNpZmllZCBhcyBpbmRpY2F0ZWQgaW4gRVJDMjAuCiAgICAgICAgKi8KICAgICAgICB1aW50OCBwdWJsaWMgY29uc3RhbnQgZGVjaW1hbHMgPSAxODsKCiAgICAgICAgLy8gVE9ETyBleHRyYWN0VG9rZW4gZnVuY3Rpb24gdG8gYWxsb3cgcGVvcGxlIHRvIHJldHJpZXZlIHRva2VuLWZ1bmRzIHNlbnQgaGVyZSBieSBtaXN0YWtlPwoKICAgICAgICAvLyBUT0RPIEVSQzIyMy1pbnRlcmZhY2UKfQ=='.
	

]
