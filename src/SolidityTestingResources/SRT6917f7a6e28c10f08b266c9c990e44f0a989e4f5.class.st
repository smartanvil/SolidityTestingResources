Class {
	#name : #SRT6917f7a6e28c10f08b266c9c990e44f0a989e4f5,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT6917f7a6e28c10f08b266c9c990e44f0a989e4f5 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKCi8qKgogKiBAdGl0bGUgT3duYWJsZQogKiBAZGV2IFRoZSBPd25hYmxlIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgYXV0aG9yaXphdGlvbiBjb250cm9sCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciB7CiAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKCi8qKgogKiBAdGl0bGUgUGF1c2FibGUKICogQGRldiBCYXNlIGNvbnRyYWN0IHdoaWNoIGFsbG93cyBjaGlsZHJlbiB0byBpbXBsZW1lbnQgYW4gZW1lcmdlbmN5IHN0b3AgbWVjaGFuaXNtLgogKi8KY29udHJhY3QgUGF1c2FibGUgaXMgT3duYWJsZSB7CiAgZXZlbnQgUGF1c2UoKTsKICBldmVudCBVbnBhdXNlKCk7CgogIGJvb2wgcHVibGljIHBhdXNlZCA9IGZhbHNlOwoKCiAgLyoqCiAgICogQGRldiBtb2RpZmllciB0byBhbGxvdyBhY3Rpb25zIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgSVMgcGF1c2VkCiAgICovCiAgbW9kaWZpZXIgd2hlbk5vdFBhdXNlZCgpIHsKICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBtb2RpZmllciB0byBhbGxvdyBhY3Rpb25zIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgSVMgTk9UIHBhdXNlZAogICAqLwogIG1vZGlmaWVyIHdoZW5QYXVzZWQgewogICAgcmVxdWlyZShwYXVzZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byBwYXVzZSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHBhdXNlKCkgb25seU93bmVyIHdoZW5Ob3RQYXVzZWQgcmV0dXJucyAoYm9vbCkgewogICAgcGF1c2VkID0gdHJ1ZTsKICAgIFBhdXNlKCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byB1bnBhdXNlLCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHVucGF1c2UoKSBvbmx5T3duZXIgd2hlblBhdXNlZCByZXR1cm5zIChib29sKSB7CiAgICBwYXVzZWQgPSBmYWxzZTsKICAgIFVucGF1c2UoKTsKICAgIHJldHVybiB0cnVlOwogIH0KfQoKCi8qKgogKiBAdGl0bGUgRVJDMjBCYXNpYwogKiBAZGV2IFNpbXBsZXIgdmVyc2lvbiBvZiBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE3OQogKi8KY29udHJhY3QgRVJDMjBCYXNpYyB7CiAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSByZXR1cm5zIChib29sKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKfQoKCi8qKgogKiBAdGl0bGUgQmFzaWMgdG9rZW4KICogQGRldiBCYXNpYyB2ZXJzaW9uIG9mIFN0YW5kYXJkVG9rZW4sIHdpdGggbm8gYWxsb3dhbmNlcy4KICovCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCiAgLyoqCiAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sKSB7CiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdG8gcXVlcnkgdGhlIHRoZSBiYWxhbmNlIG9mLgogICogQHJldHVybiBBbiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcy4KICAqLwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICB9Cgp9CgoKLyoqCiAqIEB0aXRsZSBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqLwpjb250cmFjdCBFUkMyMCBpcyBFUkMyMEJhc2ljIHsKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSByZXR1cm5zIChib29sKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7Cn0KCgovKioKICogQHRpdGxlIFN0YW5kYXJkIEVSQzIwIHRva2VuCiAqCiAqIEBkZXYgSW1wbGVtZW50YXRpb24gb2YgdGhlIGJhc2ljIHN0YW5kYXJkIHRva2VuLgogKiBAZGV2IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKiBAZGV2IEJhc2VkIG9uIGNvZGUgYnkgRmlyc3RCbG9vZDogaHR0cHM6Ly9naXRodWIuY29tL0ZpcnN0Ymxvb2Rpby90b2tlbi9ibG9iL21hc3Rlci9zbWFydF9jb250cmFjdC9GaXJzdEJsb29kVG9rZW4uc29sCiAqLwpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEVSQzIwLCBCYXNpY1Rva2VuIHsKCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwoKCiAgLyoqCiAgICogQGRldiBUcmFuc2ZlciB0b2tlbnMgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyCiAgICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gc2VuZCB0b2tlbnMgZnJvbQogICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAqIEBwYXJhbSBfdmFsdWUgdWludDI1NiB0aGUgYW1vdXQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVyZWQKICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sKSB7CiAgICB1aW50MjU2IF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsKCiAgICAvLyBDaGVjayBpcyBub3QgbmVlZGVkIGJlY2F1c2Ugc3ViKF9hbGxvd2FuY2UsIF92YWx1ZSkgd2lsbCBhbHJlYWR5IHRocm93IGlmIHRoaXMgY29uZGl0aW9uIGlzIG5vdCBtZXQKICAgIC8vIHJlcXVpcmUgKF92YWx1ZSA8PSBfYWxsb3dhbmNlKTsKCiAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IF9hbGxvd2FuY2Uuc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgQXByb3ZlIHRoZSBwYXNzZWQgYWRkcmVzcyB0byBzcGVuZCB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiB0b2tlbnMgb24gYmVoYWxmIG9mIG1zZy5zZW5kZXIuCiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICovCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCkgewoKICAgIC8vIFRvIGNoYW5nZSB0aGUgYXBwcm92ZSBhbW91bnQgeW91IGZpcnN0IGhhdmUgdG8gcmVkdWNlIHRoZSBhZGRyZXNzZXNgCiAgICAvLyAgYWxsb3dhbmNlIHRvIHplcm8gYnkgY2FsbGluZyBgYXBwcm92ZShfc3BlbmRlciwgMClgIGlmIGl0IGlzIG5vdAogICAgLy8gIGFscmVhZHkgMCB0byBtaXRpZ2F0ZSB0aGUgcmFjZSBjb25kaXRpb24gZGVzY3JpYmVkIGhlcmU6CiAgICAvLyAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgIHJlcXVpcmUoKF92YWx1ZSA9PSAwKSB8fCAoYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPT0gMCkpOwoKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF9zcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHJldHVybiBBIHVpbnQyNTYgc3BlY2lmaW5nIHRoZSBhbW91bnQgb2YgdG9rZW5zIHN0aWxsIGF2YWlibGUgZm9yIHRoZSBzcGVuZGVyLgogICAqLwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogIH0KCn0KCgovKioKICogUGF1c2FibGUgdG9rZW4KICoKICogU2ltcGxlIEVSQzIwIFRva2VuIGV4YW1wbGUsIHdpdGggcGF1c2FibGUgdG9rZW4gY3JlYXRpb24KICoqLwpjb250cmFjdCBQYXVzYWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIFBhdXNhYmxlIHsKCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzdXBlci50cmFuc2ZlckZyb20oX2Zyb20sIF90bywgX3ZhbHVlKTsKICB9Cn0KCgovKioKICogQHRpdGxlIFJlZnVuZFZhdWx0CiAqIEBkZXYgVGhpcyBjb250cmFjdCBpcyB1c2VkIGZvciBzdG9yaW5nIGZ1bmRzIHdoaWxlIGEgY3Jvd2RzYWxlCiAqIGlzIGluIHByb2dyZXNzLiBTdXBwb3J0cyByZWZ1bmRpbmcgdGhlIG1vbmV5IGlmIGNyb3dkc2FsZSBmYWlscywKICogYW5kIGZvcndhcmRpbmcgaXQgaWYgY3Jvd2RzYWxlIGlzIHN1Y2Nlc3NmdWwuCiAqLwpjb250cmFjdCBSZWZ1bmRWYXVsdCBpcyBPd25hYmxlIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgZW51bSBTdGF0ZSB7IEFjdGl2ZSwgUmVmdW5kaW5nLCBDbG9zZWQgfQoKICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBkZXBvc2l0ZWQ7CiAgYWRkcmVzcyBwdWJsaWMgd2FsbGV0OwogIFN0YXRlIHB1YmxpYyBzdGF0ZTsKCiAgZXZlbnQgQ2xvc2VkKCk7CiAgZXZlbnQgUmVmdW5kc0VuYWJsZWQoKTsKICBldmVudCBSZWZ1bmRlZChhZGRyZXNzIGluZGV4ZWQgYmVuZWZpY2lhcnksIHVpbnQyNTYgd2VpQW1vdW50KTsKCiAgZnVuY3Rpb24gUmVmdW5kVmF1bHQoYWRkcmVzcyBfd2FsbGV0KSB7CiAgICByZXF1aXJlKF93YWxsZXQgIT0gMHgwKTsKICAgIHdhbGxldCA9IF93YWxsZXQ7CiAgICBzdGF0ZSA9IFN0YXRlLkFjdGl2ZTsKICB9CgogIGZ1bmN0aW9uIGRlcG9zaXQoYWRkcmVzcyBpbnZlc3Rvcikgb25seU93bmVyIHBheWFibGUgewogICAgcmVxdWlyZShzdGF0ZSA9PSBTdGF0ZS5BY3RpdmUpOwogICAgZGVwb3NpdGVkW2ludmVzdG9yXSA9IGRlcG9zaXRlZFtpbnZlc3Rvcl0uYWRkKG1zZy52YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiBjbG9zZSgpIG9ubHlPd25lciB7CiAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLkFjdGl2ZSk7CiAgICBzdGF0ZSA9IFN0YXRlLkNsb3NlZDsKICAgIENsb3NlZCgpOwogICAgd2FsbGV0LnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgfQoKICBmdW5jdGlvbiBlbmFibGVSZWZ1bmRzKCkgb25seU93bmVyIHsKICAgIHJlcXVpcmUoc3RhdGUgPT0gU3RhdGUuQWN0aXZlKTsKICAgIHN0YXRlID0gU3RhdGUuUmVmdW5kaW5nOwogICAgUmVmdW5kc0VuYWJsZWQoKTsKICB9CgogIGZ1bmN0aW9uIHJlZnVuZChhZGRyZXNzIGludmVzdG9yKSB7CiAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLlJlZnVuZGluZyk7CiAgICB1aW50MjU2IGRlcG9zaXRlZFZhbHVlID0gZGVwb3NpdGVkW2ludmVzdG9yXTsKICAgIGRlcG9zaXRlZFtpbnZlc3Rvcl0gPSAwOwogICAgaW52ZXN0b3IudHJhbnNmZXIoZGVwb3NpdGVkVmFsdWUpOwogICAgUmVmdW5kZWQoaW52ZXN0b3IsIGRlcG9zaXRlZFZhbHVlKTsKICB9Cn0KCi8vIEB0aXRsZSBUaGUgVGVzdFBDb2luCi8vLyBAYXV0aG9yIE1hbm9qIFBhdGlkYXIKY29udHJhY3QgVGVzdFBDb2luIGlzIFBhdXNhYmxlVG9rZW4gewogICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICdUZXN0UENvaW4nOwoKICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAnVEVTVFAnOwoKICAgdWludDggcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gMTg7CgogICB1aW50MjU2IHB1YmxpYyAgdG90YWxTdXBwbHkgPSAxMDBlMjQ7IC8vIDEwME0gdG9rZW5zIHdpdGggMTggZGVjaW1hbHMKCiAgIGJvb2wgcHVibGljIHJlbWFpbmluZ1Rva2VuQnVybnQgPSBmYWxzZTsKCiAgIC8vIFRoZSB0b2tlbnMgYWxyZWFkeSB1c2VkIGZvciB0aGUgcHJlc2FsZSBidXllcnMKICAgdWludDI1NiBwdWJsaWMgdG9rZW5zRGlzdHJpYnV0ZWRQcmVzYWxlID0gMDsKCiAgIC8vIFRoZSB0b2tlbnMgYWxyZWFkeSB1c2VkIGZvciB0aGUgSUNPIGJ1eWVycwogICB1aW50MjU2IHB1YmxpYyB0b2tlbnNEaXN0cmlidXRlZENyb3dkc2FsZSA9IDA7CgogICAvLyBUaGUgYWRkcmVzcyBvZiB0aGUgY3Jvd2RzYWxlCiAgIGFkZHJlc3MgcHVibGljIGNyb3dkc2FsZTsKCiAgIC8vIFRoZSBpbml0aWFsIHN1cHBseSB1c2VkIGZvciBwbGF0Zm9ybSBhbmQgZGV2ZWxvcG1lbnQgYXMgc3BlY2lmaWVkIGluIHRoZSB3aGl0ZXBhcGVyCiAgIHVpbnQyNTYgcHVibGljIGluaXRpYWxTdXBwbHkgPSA0MGUyNDsKCiAgIC8vIFRoZSBtYXhpbXVtIGFtb3VudCBvZiB0b2tlbnMgZm9yIHRoZSBwcmVzYWxlIGludmVzdG9ycwogICB1aW50MjU2IHB1YmxpYyBsaW1pdFByZXNhbGUgPSAxMGUyNDsKCiAgIC8vIFRoZSBtYXhpbXVtIGFtb3VudCBvZiB0b2tlbnMgc29sZCBpbiB0aGUgY3Jvd2RzYWxlCiAgIHVpbnQyNTYgcHVibGljIGxpbWl0Q3Jvd2RzYWxlID0gNTBlMjQ7CgogICAvLy8gQG5vdGljZSBPbmx5IGFsbG93cyB0aGUgZXhlY3V0aW9uIG9mIHRoZSBmdW5jdGlvbiBpZiBpdCdzIGNvbW1pbmcgZnJvbSBjcm93ZHNhbGUKICAgbW9kaWZpZXIgb25seUNyb3dkc2FsZSgpIHsKICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGNyb3dkc2FsZSk7CiAgICAgIF87CiAgIH0KCiAgIC8vIFdoZW4gc29tZW9uZSByZWZ1bmRzIHRva2VucwogICBldmVudCBSZWZ1bmRlZFRva2VucyhhZGRyZXNzIGluZGV4ZWQgdXNlciwgdWludDI1NiB0b2tlbnMpOwoKICAgLy8vIEBub3RpY2UgQ29uc3RydWN0b3IgdXNlZCB0byBzZXQgdGhlIHBsYXRmb3JtICYgZGV2ZWxvcG1lbnQgdG9rZW5zLiBUaGlzIGlzCiAgIC8vLyBUaGUgMjAlICsgMjAlIG9mIHRoZSAxMDAgTSB0b2tlbnMgdXNlZCBmb3IgcGxhdGZvcm0gYW5kIGRldmVsb3BtZW50IHRlYW0uCiAgIC8vLyBUaGUgb3duZXIsIG1zZy5zZW5kZXIsIGlzIGFibGUgdG8gZG8gYWxsb3dhbmNlIGZvciBvdGhlciBjb250cmFjdHMuIFJlbWVtYmVyCiAgIC8vLyB0byB1c2UgYHRyYW5zZmVyRnJvbSgpYCBpZiB5b3UncmUgYWxsb3dlZAogICBmdW5jdGlvbiBUZXN0UENvaW4oKSB7CiAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gaW5pdGlhbFN1cHBseTsgLy8gNDBNIHRva2VucyB3ZWkKICAgfQoKICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdG8gc2V0IHRoZSBjcm93ZHNhbGUgc21hcnQgY29udHJhY3QncyBhZGRyZXNzIG9ubHkgYnkgdGhlIG93bmVyIG9mIHRoaXMgdG9rZW4KICAgLy8vIEBwYXJhbSBfY3Jvd2RzYWxlIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBiZSB1c2VkCiAgIGZ1bmN0aW9uIHNldENyb3dkc2FsZUFkZHJlc3MoYWRkcmVzcyBfY3Jvd2RzYWxlKSBleHRlcm5hbCBvbmx5T3duZXIgd2hlbk5vdFBhdXNlZCB7CiAgICAgIHJlcXVpcmUoX2Nyb3dkc2FsZSAhPSBhZGRyZXNzKDApKTsKCiAgICAgIGNyb3dkc2FsZSA9IF9jcm93ZHNhbGU7CiAgIH0KCiAgIC8vLyBAbm90aWNlIERpc3RyaWJ1dGVzIHRoZSBwcmVzYWxlIHRva2Vucy4gT25seSB0aGUgb3duZXIgY2FuIGRvIHRoaXMKICAgLy8vIEBwYXJhbSBfYnV5ZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGJ1eWVyCiAgIC8vLyBAcGFyYW0gdG9rZW5zIFRoZSBhbW91bnQgb2YgdG9rZW5zIGNvcnJlc3BvbmRpbmcgdG8gdGhhdCBidXllcgogICBmdW5jdGlvbiBkaXN0cmlidXRlUHJlc2FsZVRva2VucyhhZGRyZXNzIF9idXllciwgdWludCB0b2tlbnMpIGV4dGVybmFsIG9ubHlPd25lciB3aGVuTm90UGF1c2VkIHsKICAgICAgcmVxdWlyZShfYnV5ZXIgIT0gYWRkcmVzcygwKSk7CiAgICAgIHJlcXVpcmUodG9rZW5zID4gMCAmJiB0b2tlbnMgPD0gbGltaXRQcmVzYWxlKTsKCiAgICAgIC8vIENoZWNrIHRoYXQgdGhlIGxpbWl0IG9mIDEwTSBwcmVzYWxlIHRva2VucyBoYXNuJ3QgYmVlbiBtZXQgeWV0CiAgICAgIHJlcXVpcmUodG9rZW5zRGlzdHJpYnV0ZWRQcmVzYWxlIDwgbGltaXRQcmVzYWxlKTsKICAgICAgcmVxdWlyZSh0b2tlbnNEaXN0cmlidXRlZFByZXNhbGUuYWRkKHRva2VucykgPCBsaW1pdFByZXNhbGUpOwoKICAgICAgdG9rZW5zRGlzdHJpYnV0ZWRQcmVzYWxlID0gdG9rZW5zRGlzdHJpYnV0ZWRQcmVzYWxlLmFkZCh0b2tlbnMpOwogICAgICBiYWxhbmNlc1tfYnV5ZXJdID0gYmFsYW5jZXNbX2J1eWVyXS5hZGQodG9rZW5zKTsKICAgfQoKICAgLy8vIEBub3RpY2UgRGlzdHJpYnV0ZXMgdGhlIElDTyB0b2tlbnMuIE9ubHkgdGhlIGNyb3dkc2FsZSBhZGRyZXNzIGNhbiBleGVjdXRlIHRoaXMKICAgLy8vIEBwYXJhbSBfYnV5ZXIgVGhlIGJ1eWVyIGFkZHJlc3MKICAgLy8vIEBwYXJhbSB0b2tlbnMgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gc2VuZCB0byB0aGF0IGFkZHJlc3MKICAgZnVuY3Rpb24gZGlzdHJpYnV0ZUlDT1Rva2VucyhhZGRyZXNzIF9idXllciwgdWludCB0b2tlbnMpIGV4dGVybmFsIG9ubHlDcm93ZHNhbGUgd2hlbk5vdFBhdXNlZCB7CiAgICAgIHJlcXVpcmUoX2J1eWVyICE9IGFkZHJlc3MoMCkpOwogICAgICByZXF1aXJlKHRva2VucyA+IDApOwoKICAgICAgLy8gQ2hlY2sgdGhhdCB0aGUgbGltaXQgb2YgNTBNIElDTyB0b2tlbnMgaGFzbid0IGJlZW4gbWV0IHlldAogICAgICByZXF1aXJlKHRva2Vuc0Rpc3RyaWJ1dGVkQ3Jvd2RzYWxlIDwgbGltaXRDcm93ZHNhbGUpOwogICAgICByZXF1aXJlKHRva2Vuc0Rpc3RyaWJ1dGVkQ3Jvd2RzYWxlLmFkZCh0b2tlbnMpIDw9IGxpbWl0Q3Jvd2RzYWxlKTsKCiAgICAgIHRva2Vuc0Rpc3RyaWJ1dGVkQ3Jvd2RzYWxlID0gdG9rZW5zRGlzdHJpYnV0ZWRDcm93ZHNhbGUuYWRkKHRva2Vucyk7CiAgICAgIGJhbGFuY2VzW19idXllcl0gPSBiYWxhbmNlc1tfYnV5ZXJdLmFkZCh0b2tlbnMpOwogICB9CgogICAvLy8gQG5vdGljZSBEZWxldGVzIHRoZSBhbW91bnQgb2YgdG9rZW5zIHJlZnVuZGVkIGZyb20gdGhhdCBidXllciBiYWxhbmNlCiAgIC8vLyBAcGFyYW0gX2J1eWVyIFRoZSBidXllciB0aGF0IHdhbnRzIHRoZSByZWZ1bmQKICAgLy8vIEBwYXJhbSB0b2tlbnMgVGhlIHRva2VucyB0byByZXR1cm4KICAgZnVuY3Rpb24gcmVmdW5kVG9rZW5zKGFkZHJlc3MgX2J1eWVyLCB1aW50MjU2IHRva2VucykgZXh0ZXJuYWwgb25seUNyb3dkc2FsZSB3aGVuTm90UGF1c2VkIHsKICAgICAgcmVxdWlyZShfYnV5ZXIgIT0gYWRkcmVzcygwKSk7CiAgICAgIHJlcXVpcmUodG9rZW5zID4gMCk7CiAgICAgIHJlcXVpcmUoYmFsYW5jZXNbX2J1eWVyXSA+PSB0b2tlbnMpOwoKICAgICAgYmFsYW5jZXNbX2J1eWVyXSA9IGJhbGFuY2VzW19idXllcl0uc3ViKHRva2Vucyk7CiAgICAgIFJlZnVuZGVkVG9rZW5zKF9idXllciwgdG9rZW5zKTsKICAgfQoKICAgLy8vIEBub3RpY2UgQnVybiB0aGUgYW1vdW50IG9mIHRva2VucyByZW1haW5pbmcgYWZ0ZXIgSUNPIGVuZHMKICAgZnVuY3Rpb24gYnVyblRva2VucygpIGV4dGVybmFsIG9ubHlDcm93ZHNhbGUgd2hlbk5vdFBhdXNlZCB7CiAgICAgIAogICAgICB1aW50MjU2IHJlbWFpbmluZ0lDT1Rva2VuID0gbGltaXRDcm93ZHNhbGUuc3ViKHRva2Vuc0Rpc3RyaWJ1dGVkQ3Jvd2RzYWxlKTsKICAgICAgaWYocmVtYWluaW5nSUNPVG9rZW4gPiAwICYmICFyZW1haW5pbmdUb2tlbkJ1cm50KSB7CiAgICAgIHJlbWFpbmluZ1Rva2VuQnVybnQgPSB0cnVlOyAgICAKICAgICAgbGltaXRDcm93ZHNhbGUgPSBsaW1pdENyb3dkc2FsZS5zdWIocmVtYWluaW5nSUNPVG9rZW4pOyAgCiAgICAgIHRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkuc3ViKHJlbWFpbmluZ0lDT1Rva2VuKTsKICAgICAgfQogICB9Cn0KLy8vIDEuIEZpcnN0IHlvdSBzZXQgdGhlIGFkZHJlc3Mgb2YgdGhlIHdhbGxldCBpbiB0aGUgUmVmdW5kVmF1bHQgY29udHJhY3QgdGhhdCB3aWxsIHN0b3JlIHRoZSBkZXBvc2l0IG9mIGV0aGVyCi8vIDIuIElmIHRoZSBnb2FsIGlzIHJlYWNoZWQsIHRoZSBzdGF0ZSBvZiB0aGUgdmF1bHQgd2lsbCBjaGFuZ2UgYW5kIHRoZSBldGhlciB3aWxsIGJlIHNlbnQgdG8gdGhlIGFkZHJlc3MKLy8gMy4gSWYgdGhlIGdvYWwgaXMgbm90IHJlYWNoZWQgLCB0aGUgc3RhdGUgb2YgdGhlIHZhdWx0IHdpbGwgY2hhbmdlIHRvIHJlZnVuZGluZyBhbmQgdGhlIHVzZXJzIHdpbGwgYmUgYWJsZSB0byBjYWxsIGNsYWltUmVmdW5kKCkgdG8gZ2V0IHRoZWlyIGV0aGVyCgovLy8gQGF1dGhvciBNYW5vaiBQYXRpZGFyIDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iZGZhZmJlYWJiNmJiYmVhZGIyYmViMWIwYjU5ZmI4YjJiZWI2YjNmMWJjYjBiMiI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+CmNvbnRyYWN0IENyb3dkc2FsZSBpcyBQYXVzYWJsZSB7CiAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAgLy8gVGhlIHRva2VuIGJlaW5nIHNvbGQKICAgVGVzdFBDb2luIHB1YmxpYyB0b2tlbjsKCiAgIC8vIFRoZSB2YXVsdCB0aGF0IHdpbGwgc3RvcmUgdGhlIGV0aGVyIHVudGlsIHRoZSBnb2FsIGlzIHJlYWNoZWQKICAgUmVmdW5kVmF1bHQgcHVibGljIHZhdWx0OwoKICAgLy8gVGhlIGJsb2NrIG51bWJlciBvZiB3aGVuIHRoZSBjcm93ZHNhbGUgc3RhcnRzCiAgIC8vIDEwLzE1LzIwMTcgQCAxMTowMGFtIChVVEMpCiAgIC8vIDEwLzE1LzIwMTcgQCAxMjowMHBtIChHTVQgKyAxKQogICB1aW50MjU2IHB1YmxpYyBzdGFydFRpbWUgPSAxNTExMDY4ODI5OwoKICAgLy8gVGhlIGJsb2NrIG51bWJlciBvZiB3aGVuIHRoZSBjcm93ZHNhbGUgZW5kcwogICAvLyAxMS8xMy8yMDE3IEAgMTE6MDBhbSAoVVRDKQogICAvLyAxMS8xMy8yMDE3IEAgMTI6MDBwbSAoR01UICsgMSkKICAgdWludDI1NiBwdWJsaWMgZW5kVGltZSA9IDE1MTIwMjEwMjk7CgogICAvLyBUaGUgd2FsbGV0IHRoYXQgaG9sZHMgdGhlIFdlaSByYWlzZWQgb24gdGhlIGNyb3dkc2FsZQogICBhZGRyZXNzIHB1YmxpYyB3YWxsZXQ7CgogICAvLyBUaGUgd2FsbGV0IHRoYXQgaG9sZHMgdGhlIFdlaSByYWlzZWQgb24gdGhlIGNyb3dkc2FsZSBhZnRlciBzb2Z0IGNhcCByZWFjaGVkCiAgIGFkZHJlc3MgcHVibGljIHdhbGxldEI7CgogICAvLyBUaGUgcmF0ZSBvZiB0b2tlbnMgcGVyIGV0aGVyLiBPbmx5IGFwcGxpZWQgZm9yIHRoZSBmaXJzdCB0aWVyLCB0aGUgZmlyc3QKICAgLy8gMTIuNSBtaWxsaW9uIHRva2VucyBzb2xkCiAgIHVpbnQyNTYgcHVibGljIHJhdGU7CgogICAvLyBUaGUgcmF0ZSBvZiB0b2tlbnMgcGVyIGV0aGVyLiBPbmx5IGFwcGxpZWQgZm9yIHRoZSBzZWNvbmQgdGllciwgYXQgYmV0d2VlbgogICAvLyAxMi41IG1pbGxpb24gdG9rZW5zIHNvbGQgYW5kIDI1IG1pbGxpb24gdG9rZW5zIHNvbGQKICAgdWludDI1NiBwdWJsaWMgcmF0ZVRpZXIyOwoKICAgLy8gVGhlIHJhdGUgb2YgdG9rZW5zIHBlciBldGhlci4gT25seSBhcHBsaWVkIGZvciB0aGUgdGhpcmQgdGllciwgYXQgYmV0d2VlbgogICAvLyAyNSBtaWxsaW9uIHRva2VucyBzb2xkIGFuZCAzNy41IG1pbGxpb24gdG9rZW5zIHNvbGQKICAgdWludDI1NiBwdWJsaWMgcmF0ZVRpZXIzOwoKICAgLy8gVGhlIHJhdGUgb2YgdG9rZW5zIHBlciBldGhlci4gT25seSBhcHBsaWVkIGZvciB0aGUgZm91cnRoIHRpZXIsIGF0IGJldHdlZW4KICAgLy8gMzcuNSBtaWxsaW9uIHRva2VucyBzb2xkIGFuZCA1MCBtaWxsaW9uIHRva2VucyBzb2xkCiAgIHVpbnQyNTYgcHVibGljIHJhdGVUaWVyNDsKCiAgIC8vIFRoZSBtYXhpbXVtIGFtb3VudCBvZiB3ZWkgZm9yIGVhY2ggdGllcgogICB1aW50MjU2IHB1YmxpYyBsaW1pdFRpZXIxID0gMTIuNWUyNDsKICAgdWludDI1NiBwdWJsaWMgbGltaXRUaWVyMiA9IDI1ZTI0OwogICB1aW50MjU2IHB1YmxpYyBsaW1pdFRpZXIzID0gMzcuNWUyNDsKCiAgIC8vIFRoZSBhbW91bnQgb2Ygd2VpIHJhaXNlZAogICB1aW50MjU2IHB1YmxpYyB3ZWlSYWlzZWQgPSAwOwoKICAgLy8gVGhlIGFtb3VudCBvZiB0b2tlbnMgcmFpc2VkCiAgIHVpbnQyNTYgcHVibGljIHRva2Vuc1JhaXNlZCA9IDA7CgogICAvLyBZb3UgY2FuIG9ubHkgYnV5IHVwIHRvIDUwIE0gdG9rZW5zIGR1cmluZyB0aGUgSUNPCiAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IG1heFRva2Vuc1JhaXNlZCA9IDUwZTI0OwoKICAgLy8gVGhlIG1pbmltdW0gYW1vdW50IG9mIFdlaSB5b3UgbXVzdCBwYXkgdG8gcGFydGljaXBhdGUgaW4gdGhlIGNyb3dkc2FsZQogICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBtaW5QdXJjaGFzZSA9IDEwIGZpbm5leTsgLy8gMC4wMSBldGhlcgoKICAgLy8gVGhlIG1heCBhbW91bnQgb2YgV2VpIHRoYXQgeW91IGNhbiBwYXkgdG8gcGFydGljaXBhdGUgaW4gdGhlIGNyb3dkc2FsZQogICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBtYXhQdXJjaGFzZSA9IDIwMDAgZXRoZXI7CgogICAvLyBNaW5pbXVtIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgcmFpc2VkLiA3LjUgbWlsbGlvbiB0b2tlbnMgd2hpY2ggaXMgdGhlIDE1JQogICAvLyBvZiB0aGUgdG90YWwgb2YgNTAgbWlsbGlvbiB0b2tlbnMgc29sZCBpbiB0aGUgY3Jvd2RzYWxlCiAgIC8vIDcuNWU2ICsgMWUxOAogICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBtaW5pbXVtR29hbCA9IDUuMzNlMTk7CgogICAvLyBJZiB0aGUgY3Jvd2RzYWxlIHdhc24ndCBzdWNjZXNzZnVsLCB0aGlzIHdpbGwgYmUgdHJ1ZSBhbmQgdXNlcnMgd2lsbCBiZSBhYmxlCiAgIC8vIHRvIGNsYWltIHRoZSByZWZ1bmQgb2YgdGhlaXIgZXRoZXIKICAgYm9vbCBwdWJsaWMgaXNSZWZ1bmRpbmcgPSBmYWxzZTsKCiAgIC8vIElmIHRoZSBjcm93ZHNhbGUgaGFzIGVuZGVkIG9yIG5vdAogICBib29sIHB1YmxpYyBpc0VuZGVkID0gZmFsc2U7CgogICAvLyBUaGUgbnVtYmVyIG9mIHRyYW5zYWN0aW9ucwogICB1aW50MjU2IHB1YmxpYyBudW1iZXJPZlRyYW5zYWN0aW9uczsKCiAgIC8vIFRoZSBnYXMgcHJpY2UgdG8gYnV5IHRva2VucyBtdXN0IGJlIDUwIGd3ZWkgb3IgYmVsb3cKICAgdWludDI1NiBwdWJsaWMgbGltaXRHYXNQcmljZSA9IDUwMDAwMDAwMDAwIHdlaTsKCiAgIC8vIEhvdyBtdWNoIGVhY2ggdXNlciBwYWlkIGZvciB0aGUgY3Jvd2RzYWxlCiAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgY3Jvd2RzYWxlQmFsYW5jZXM7CgogICAvLyBIb3cgbWFueSB0b2tlbnMgZWFjaCB1c2VyIGdvdCBmb3IgdGhlIGNyb3dkc2FsZQogICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIHRva2Vuc0JvdWdodDsKCiAgIC8vIFRvIGluZGljYXRlIHdobyBwdXJjaGFzZWQgd2hhdCBhbW91bnQgb2YgdG9rZW5zIGFuZCB3aG8gcmVjZWl2ZWQgd2hhdCBhbW91bnQgb2Ygd2VpCiAgIGV2ZW50IFRva2VuUHVyY2hhc2UoYWRkcmVzcyBpbmRleGVkIGJ1eWVyLCB1aW50MjU2IHZhbHVlLCB1aW50MjU2IGFtb3VudE9mVG9rZW5zKTsKCiAgIC8vIEluZGljYXRlcyBpZiB0aGUgY3Jvd2RzYWxlIGhhcyBlbmRlZAogICBldmVudCBGaW5hbGl6ZWQoKTsKCiAgIC8vIE9ubHkgYWxsb3cgdGhlIGV4ZWN1dGlvbiBvZiB0aGUgZnVuY3Rpb24gYmVmb3JlIHRoZSBjcm93ZHNhbGUgc3RhcnRzCiAgIG1vZGlmaWVyIGJlZm9yZVN0YXJ0aW5nKCkgewogICAgICByZXF1aXJlKG5vdyA8IHN0YXJ0VGltZSk7CiAgICAgIF87CiAgIH0KCiAgIC8vLyBAbm90aWNlIENvbnN0cnVjdG9yIG9mIHRoZSBjcm93c2FsZSB0byBzZXQgdXAgdGhlIG1haW4gdmFyaWFibGVzIGFuZCBjcmVhdGUgYSB0b2tlbgogICAvLy8gQHBhcmFtIF93YWxsZXQgVGhlIHdhbGxldCBhZGRyZXNzIHRoYXQgc3RvcmVzIHRoZSBXZWkgcmFpc2VkCiAgIC8vLyBAcGFyYW0gX3dhbGxldEIgVGhlIHdhbGxldCBhZGRyZXNzIHRoYXQgc3RvcmVzIHRoZSBXZWkgcmFpc2VkIGFmdGVyIHNvZnQgY2FwIHJlYWNoZWQKICAgLy8vIEBwYXJhbSBfdG9rZW5BZGRyZXNzIFRoZSB0b2tlbiB1c2VkIGZvciB0aGUgSUNPCiAgIGZ1bmN0aW9uIENyb3dkc2FsZSgKICAgICAgYWRkcmVzcyBfd2FsbGV0LAogICAgICBhZGRyZXNzIF93YWxsZXRCLAogICAgICBhZGRyZXNzIF90b2tlbkFkZHJlc3MsCiAgICAgIHVpbnQyNTYgX3N0YXJ0VGltZSwKICAgICAgdWludDI1NiBfZW5kVGltZQogICApIHB1YmxpYyB7CiAgICAgIHJlcXVpcmUoX3dhbGxldCAhPSBhZGRyZXNzKDApKTsKICAgICAgcmVxdWlyZShfdG9rZW5BZGRyZXNzICE9IGFkZHJlc3MoMCkpOwogICAgICByZXF1aXJlKF93YWxsZXRCICE9IGFkZHJlc3MoMCkpOwoKICAgICAgLy8gSWYgeW91IHNlbmQgdGhlIHN0YXJ0IGFuZCBlbmQgdGltZSBvbiB0aGUgY29uc3RydWN0b3IsIHRoZSBlbmQgbXVzdCBiZSBsYXJnZXIKICAgICAgaWYoX3N0YXJ0VGltZSA+IDAgJiYgX2VuZFRpbWUgPiAwKQogICAgICAgICByZXF1aXJlKF9zdGFydFRpbWUgPCBfZW5kVGltZSk7CgogICAgICB3YWxsZXQgPSBfd2FsbGV0OwogICAgICB3YWxsZXRCID0gX3dhbGxldEI7CiAgICAgIHRva2VuID0gVGVzdFBDb2luKF90b2tlbkFkZHJlc3MpOwogICAgICB2YXVsdCA9IG5ldyBSZWZ1bmRWYXVsdChfd2FsbGV0KTsKCiAgICAgIGlmKF9zdGFydFRpbWUgPiAwKQogICAgICAgICBzdGFydFRpbWUgPSBfc3RhcnRUaW1lOwoKICAgICAgaWYoX2VuZFRpbWUgPiAwKQogICAgICAgICBlbmRUaW1lID0gX2VuZFRpbWU7CiAgIH0KCiAgIC8vLyBAbm90aWNlIEZhbGxiYWNrIGZ1bmN0aW9uIHRvIGJ1eSB0b2tlbnMKICAgZnVuY3Rpb24gKCkgcGF5YWJsZSB7CiAgICAgIGJ1eVRva2VucygpOwogICB9CgogICAvLy8gQG5vdGljZSBUbyBidXkgdG9rZW5zIGdpdmVuIGFuIGFkZHJlc3MKICAgZnVuY3Rpb24gYnV5VG9rZW5zKCkgcHVibGljIHBheWFibGUgd2hlbk5vdFBhdXNlZCB7CiAgICAgIHJlcXVpcmUodmFsaWRQdXJjaGFzZSgpKTsKCiAgICAgIHVpbnQyNTYgdG9rZW5zID0gMDsKICAgICAgCiAgICAgIHVpbnQyNTYgYW1vdW50UGFpZCA9IGNhbGN1bGF0ZUV4Y2Vzc0JhbGFuY2UoKTsKCiAgICAgIGlmKHRva2Vuc1JhaXNlZCA8IGxpbWl0VGllcjEpIHsKCiAgICAgICAgIC8vIFRpZXIgMQogICAgICAgICB0b2tlbnMgPSBhbW91bnRQYWlkLm11bChyYXRlKTsKCiAgICAgICAgIC8vIElmIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgeW91IHdhbnQgdG8gYnV5IGdldHMgb3V0IG9mIHRoaXMgdGllcgogICAgICAgICBpZih0b2tlbnNSYWlzZWQuYWRkKHRva2VucykgPiBsaW1pdFRpZXIxKQogICAgICAgICAgICB0b2tlbnMgPSBjYWxjdWxhdGVFeGNlc3NUb2tlbnMoYW1vdW50UGFpZCwgbGltaXRUaWVyMSwgMSwgcmF0ZSk7CiAgICAgIH0gZWxzZSBpZih0b2tlbnNSYWlzZWQgPj0gbGltaXRUaWVyMSAmJiB0b2tlbnNSYWlzZWQgPCBsaW1pdFRpZXIyKSB7CgogICAgICAgICAvLyBUaWVyIDIKICAgICAgICAgdG9rZW5zID0gYW1vdW50UGFpZC5tdWwocmF0ZVRpZXIyKTsKCiAgICAgICAgIC8vIElmIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgeW91IHdhbnQgdG8gYnV5IGdldHMgb3V0IG9mIHRoaXMgdGllcgogICAgICAgICBpZih0b2tlbnNSYWlzZWQuYWRkKHRva2VucykgPiBsaW1pdFRpZXIyKQogICAgICAgICAgICB0b2tlbnMgPSBjYWxjdWxhdGVFeGNlc3NUb2tlbnMoYW1vdW50UGFpZCwgbGltaXRUaWVyMiwgMiwgcmF0ZVRpZXIyKTsKICAgICAgfSBlbHNlIGlmKHRva2Vuc1JhaXNlZCA+PSBsaW1pdFRpZXIyICYmIHRva2Vuc1JhaXNlZCA8IGxpbWl0VGllcjMpIHsKCiAgICAgICAgIC8vIFRpZXIgMwogICAgICAgICB0b2tlbnMgPSBhbW91bnRQYWlkLm11bChyYXRlVGllcjMpOwoKICAgICAgICAgLy8gSWYgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCB5b3Ugd2FudCB0byBidXkgZ2V0cyBvdXQgb2YgdGhpcyB0aWVyCiAgICAgICAgIGlmKHRva2Vuc1JhaXNlZC5hZGQodG9rZW5zKSA+IGxpbWl0VGllcjMpCiAgICAgICAgICAgIHRva2VucyA9IGNhbGN1bGF0ZUV4Y2Vzc1Rva2VucyhhbW91bnRQYWlkLCBsaW1pdFRpZXIzLCAzLCByYXRlVGllcjMpOwogICAgICB9IGVsc2UgaWYodG9rZW5zUmFpc2VkID49IGxpbWl0VGllcjMpIHsKCiAgICAgICAgIC8vIFRpZXIgNAogICAgICAgICB0b2tlbnMgPSBhbW91bnRQYWlkLm11bChyYXRlVGllcjQpOwogICAgICB9CgogICAgICB3ZWlSYWlzZWQgPSB3ZWlSYWlzZWQuYWRkKGFtb3VudFBhaWQpOwogICAgICB1aW50MjU2IHRva2Vuc1JhaXNlZEJlZm9yZVRoaXNUcmFuc2FjdGlvbiA9IHRva2Vuc1JhaXNlZDsKICAgICAgdG9rZW5zUmFpc2VkID0gdG9rZW5zUmFpc2VkLmFkZCh0b2tlbnMpOwogICAgICB0b2tlbi5kaXN0cmlidXRlSUNPVG9rZW5zKG1zZy5zZW5kZXIsIHRva2Vucyk7CgogICAgICAvLyBLZWVwIGEgcmVjb3JkIG9mIGhvdyBtYW55IHRva2VucyBldmVyeWJvZHkgZ2V0cyBpbiBjYXNlIHdlIG5lZWQgdG8gZG8gcmVmdW5kcwogICAgICB0b2tlbnNCb3VnaHRbbXNnLnNlbmRlcl0gPSB0b2tlbnNCb3VnaHRbbXNnLnNlbmRlcl0uYWRkKHRva2Vucyk7CiAgICAgIFRva2VuUHVyY2hhc2UobXNnLnNlbmRlciwgYW1vdW50UGFpZCwgdG9rZW5zKTsKICAgICAgbnVtYmVyT2ZUcmFuc2FjdGlvbnMgPSBudW1iZXJPZlRyYW5zYWN0aW9ucy5hZGQoMSk7CgogICAgICBpZih0b2tlbnNSYWlzZWRCZWZvcmVUaGlzVHJhbnNhY3Rpb24gPiBtaW5pbXVtR29hbCkgewoKICAgICAgICAgd2FsbGV0Qi50cmFuc2ZlcihhbW91bnRQYWlkKTsKCiAgICAgIH0gZWxzZSB7CiAgICAgICAgIHZhdWx0LmRlcG9zaXQudmFsdWUoYW1vdW50UGFpZCkobXNnLnNlbmRlcik7CiAgICAgICAgIGlmKGdvYWxSZWFjaGVkKCkpIHsKICAgICAgICAgIHZhdWx0LmNsb3NlKCk7CiAgICAgICAgIH0KICAgICAgICAgCiAgICAgIH0KCiAgICAgIC8vIElmIHRoZSBtaW5pbXVtIGdvYWwgb2YgdGhlIElDTyBoYXMgYmVlbiByZWFjaCwgY2xvc2UgdGhlIHZhdWx0IHRvIHNlbmQKICAgICAgLy8gdGhlIGV0aGVyIHRvIHRoZSB3YWxsZXQgb2YgdGhlIGNyb3dkc2FsZQogICAgICBjaGVja0NvbXBsZXRlZENyb3dkc2FsZSgpOwogICB9CgogICAvLy8gQG5vdGljZSBDYWxjdWxhdGVzIGhvdyBtYW55IGV0aGVyIHdpbGwgYmUgdXNlZCB0byBnZW5lcmF0ZSB0aGUgdG9rZW5zIGluCiAgIC8vLyBjYXNlIHRoZSBidXllciBzZW5kcyBtb3JlIHRoYW4gdGhlIG1heGltdW0gYmFsYW5jZSBidXQgaGFzIHNvbWUgYmFsYW5jZSBsZWZ0CiAgIC8vLyBhbmQgdXBkYXRlcyB0aGUgYmFsYW5jZSBvZiB0aGF0IGJ1eWVyLgogICAvLy8gRm9yIGluc3RhbmNlIGlmIGhlJ3MgNTAwIGJhbGFuY2UgYW5kIGhlIHNlbmRzIDEwMDAsIGl0IHdpbGwgcmV0dXJuIDUwMAogICAvLy8gYW5kIHJlZnVuZCB0aGUgb3RoZXIgNTAwIGV0aGVyCiAgIGZ1bmN0aW9uIGNhbGN1bGF0ZUV4Y2Vzc0JhbGFuY2UoKSBpbnRlcm5hbCB3aGVuTm90UGF1c2VkIHJldHVybnModWludDI1NikgewogICAgICB1aW50MjU2IGFtb3VudFBhaWQgPSBtc2cudmFsdWU7CiAgICAgIHVpbnQyNTYgZGlmZmVyZW5jZVdlaSA9IDA7CiAgICAgIHVpbnQyNTYgZXhjZWVkaW5nQmFsYW5jZSA9IDA7CgogICAgICAvLyBJZiB3ZSdyZSBpbiB0aGUgbGFzdCB0aWVyLCBjaGVjayB0aGF0IHRoZSBsaW1pdCBoYXNuJ3QgYmVlbiByZWFjaGVkCiAgICAgIC8vIGFuZCBpZiBzbywgcmVmdW5kIHRoZSBkaWZmZXJlbmNlIGFuZCByZXR1cm4gd2hhdCB3aWxsIGJlIHVzZWQgdG8KICAgICAgLy8gYnV5IHRoZSByZW1haW5pbmcgdG9rZW5zCiAgICAgIGlmKHRva2Vuc1JhaXNlZCA+PSBsaW1pdFRpZXIzKSB7CiAgICAgICAgIHVpbnQyNTYgYWRkZWRUb2tlbnMgPSB0b2tlbnNSYWlzZWQuYWRkKGFtb3VudFBhaWQubXVsKHJhdGVUaWVyNCkpOwoKICAgICAgICAgLy8gSWYgdG9rZW5zUmFpc2VkICsgd2hhdCB5b3UgcGFpZCBjb252ZXJ0ZWQgdG8gdG9rZW5zIGlzIGJpZ2dlciB0aGFuIHRoZSBtYXgKICAgICAgICAgaWYoYWRkZWRUb2tlbnMgPiBtYXhUb2tlbnNSYWlzZWQpIHsKCiAgICAgICAgICAgIC8vIFJlZnVuZCB0aGUgZGlmZmVyZW5jZQogICAgICAgICAgICB1aW50MjU2IGRpZmZlcmVuY2UgPSBhZGRlZFRva2Vucy5zdWIobWF4VG9rZW5zUmFpc2VkKTsKICAgICAgICAgICAgZGlmZmVyZW5jZVdlaSA9IGRpZmZlcmVuY2UuZGl2KHJhdGVUaWVyNCk7CiAgICAgICAgICAgIGFtb3VudFBhaWQgPSBhbW91bnRQYWlkLnN1YihkaWZmZXJlbmNlV2VpKTsKICAgICAgICAgfQogICAgICB9CgogICAgICB1aW50MjU2IGFkZGVkQmFsYW5jZSA9IGNyb3dkc2FsZUJhbGFuY2VzW21zZy5zZW5kZXJdLmFkZChhbW91bnRQYWlkKTsKCiAgICAgIC8vIENoZWNraW5nIHRoYXQgdGhlIGluZGl2aWR1YWwgbGltaXQgb2YgMTAwMCBFVEggcGVyIHVzZXIgaXMgbm90IHJlYWNoZWQKICAgICAgaWYoYWRkZWRCYWxhbmNlIDw9IG1heFB1cmNoYXNlKSB7CiAgICAgICAgIGNyb3dkc2FsZUJhbGFuY2VzW21zZy5zZW5kZXJdID0gY3Jvd2RzYWxlQmFsYW5jZXNbbXNnLnNlbmRlcl0uYWRkKGFtb3VudFBhaWQpOwogICAgICB9IGVsc2UgewoKICAgICAgICAgLy8gU3Vic3RyYWN0aW5nIDEwMDAgZXRoZXIgaW4gd2VpCiAgICAgICAgIGV4Y2VlZGluZ0JhbGFuY2UgPSBhZGRlZEJhbGFuY2Uuc3ViKG1heFB1cmNoYXNlKTsKICAgICAgICAgYW1vdW50UGFpZCA9IGFtb3VudFBhaWQuc3ViKGV4Y2VlZGluZ0JhbGFuY2UpOwoKICAgICAgICAgLy8gQWRkIHRoYXQgYmFsYW5jZSB0byB0aGUgYmFsYW5jZXMKICAgICAgICAgY3Jvd2RzYWxlQmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBjcm93ZHNhbGVCYWxhbmNlc1ttc2cuc2VuZGVyXS5hZGQoYW1vdW50UGFpZCk7CiAgICAgIH0KCiAgICAgIC8vIE1ha2UgdGhlIHRyYW5zZmVycyBhdCB0aGUgZW5kIG9mIHRoZSBmdW5jdGlvbiBmb3Igc2VjdXJpdHkgcHVycG9zZXMKICAgICAgaWYoZGlmZmVyZW5jZVdlaSA+IDApCiAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoZGlmZmVyZW5jZVdlaSk7CgogICAgICBpZihleGNlZWRpbmdCYWxhbmNlID4gMCkgewoKICAgICAgICAgLy8gUmV0dXJuIHRoZSBleGNlZWRpbmcgYmFsYW5jZSB0byB0aGUgYnV5ZXIKICAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihleGNlZWRpbmdCYWxhbmNlKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGFtb3VudFBhaWQ7CiAgIH0KCiAgIC8vLyBAbm90aWNlIFNldCdzIHRoZSByYXRlIG9mIHRva2VucyBwZXIgZXRoZXIgZm9yIGVhY2ggdGllci4gVXNlIGl0IGFmdGVyIHRoZQogICAvLy8gc21hcnQgY29udHJhY3QgaXMgZGVwbG95ZWQgdG8gc2V0IHRoZSBwcmljZSBhY2NvcmRpbmcgdG8gdGhlIGV0aGVyIHByaWNlCiAgIC8vLyBhdCB0aGUgc3RhcnQgb2YgdGhlIElDTwogICAvLy8gQHBhcmFtIHRpZXIxIFRoZSBhbW91bnQgb2YgdG9rZW5zIHlvdSBnZXQgaW4gdGhlIHRpZXIgb25lCiAgIC8vLyBAcGFyYW0gdGllcjIgVGhlIGFtb3VudCBvZiB0b2tlbnMgeW91IGdldCBpbiB0aGUgdGllciB0d28KICAgLy8vIEBwYXJhbSB0aWVyMyBUaGUgYW1vdW50IG9mIHRva2VucyB5b3UgZ2V0IGluIHRoZSB0aWVyIHRocmVlCiAgIC8vLyBAcGFyYW0gdGllcjQgVGhlIGFtb3VudCBvZiB0b2tlbnMgeW91IGdldCBpbiB0aGUgdGllciBmb3VyCiAgIGZ1bmN0aW9uIHNldFRpZXJSYXRlcyh1aW50MjU2IHRpZXIxLCB1aW50MjU2IHRpZXIyLCB1aW50MjU2IHRpZXIzLCB1aW50MjU2IHRpZXI0KQogICAgICBleHRlcm5hbCBvbmx5T3duZXIgd2hlbk5vdFBhdXNlZAogICB7CiAgICAgIHJlcXVpcmUodGllcjEgPiAwICYmIHRpZXIyID4gMCAmJiB0aWVyMyA+IDAgJiYgdGllcjQgPiAwKTsKICAgICAgcmVxdWlyZSh0aWVyMSA+IHRpZXIyICYmIHRpZXIyID4gdGllcjMgJiYgdGllcjMgPiB0aWVyNCk7CgogICAgICByYXRlID0gdGllcjE7CiAgICAgIHJhdGVUaWVyMiA9IHRpZXIyOwogICAgICByYXRlVGllcjMgPSB0aWVyMzsKICAgICAgcmF0ZVRpZXI0ID0gdGllcjQ7CiAgIH0KCiAgIC8vLyBAbm90aWNlIEFsbG93IHRvIGV4dGVuZCBJQ08gZW5kIGRhdGUKICAgLy8vIEBwYXJhbSBfZW5kVGltZSBFbmR0aW1lIG9mIElDTwogICBmdW5jdGlvbiBzZXRFbmREYXRlKHVpbnQyNTYgX2VuZFRpbWUpCiAgICAgIGV4dGVybmFsIG9ubHlPd25lciB3aGVuTm90UGF1c2VkCiAgIHsKICAgICAgcmVxdWlyZShub3cgPD0gX2VuZFRpbWUpOwogICAgICByZXF1aXJlKHN0YXJ0VGltZSA8IF9lbmRUaW1lKTsKICAgICAgCiAgICAgIGVuZFRpbWUgPSBfZW5kVGltZTsKICAgfQoKCiAgIC8vLyBAbm90aWNlIENoZWNrIGlmIHRoZSBjcm93ZHNhbGUgaGFzIGVuZGVkIGFuZCBlbmFibGVzIHJlZnVuZHMgb25seSBpbiBjYXNlIHRoZQogICAvLy8gZ29hbCBoYXNuJ3QgYmVlbiByZWFjaGVkCiAgIGZ1bmN0aW9uIGNoZWNrQ29tcGxldGVkQ3Jvd2RzYWxlKCkgcHVibGljIHdoZW5Ob3RQYXVzZWQgeyAgICAKICAgICAgaWYoIWlzRW5kZWQpIHsKICAgICAgICAgaWYoaGFzRW5kZWQoKSAmJiAhZ29hbFJlYWNoZWQoKSl7CiAgICAgICAgICAgIHZhdWx0LmVuYWJsZVJlZnVuZHMoKTsKCiAgICAgICAgICAgIGlzUmVmdW5kaW5nID0gdHJ1ZTsKICAgICAgICAgICAgaXNFbmRlZCA9IHRydWU7CiAgICAgICAgICAgIEZpbmFsaXplZCgpOwogICAgICAgICB9IGVsc2UgaWYoaGFzRW5kZWQoKSAgJiYgZ29hbFJlYWNoZWQoKSkgewogICAgICAgICAgICAKICAgICAgICAgICAgCiAgICAgICAgICAgIGlzRW5kZWQgPSB0cnVlOyAKCgogICAgICAgICAgICAvLyBCdXJuIHRva2VuIG9ubHkgd2hlbiBtaW5pbXVtIGdvYWwgcmVhY2hlZCBhbmQgbWF4R29hbCBub3QgcmVhY2hlZC4gCiAgICAgICAgICAgIGlmKHRva2Vuc1JhaXNlZCA8IG1heFRva2Vuc1JhaXNlZCkgewoKICAgICAgICAgICAgICAgdG9rZW4uYnVyblRva2VucygpOwoKICAgICAgICAgICAgfSAKCiAgICAgICAgICAgIEZpbmFsaXplZCgpOwogICAgICAgICB9IAogICAgICAgICAKICAgICAgICAgCiAgICAgIH0KICAgfQoKICAgLy8vIEBub3RpY2UgSWYgY3Jvd2RzYWxlIGlzIHVuc3VjY2Vzc2Z1bCwgaW52ZXN0b3JzIGNhbiBjbGFpbSByZWZ1bmRzIGhlcmUKICAgZnVuY3Rpb24gY2xhaW1SZWZ1bmQoKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCB7CiAgICAgcmVxdWlyZShoYXNFbmRlZCgpICYmICFnb2FsUmVhY2hlZCgpICYmIGlzUmVmdW5kaW5nKTsKCiAgICAgdmF1bHQucmVmdW5kKG1zZy5zZW5kZXIpOwogICAgIHRva2VuLnJlZnVuZFRva2Vucyhtc2cuc2VuZGVyLCB0b2tlbnNCb3VnaHRbbXNnLnNlbmRlcl0pOwogICB9CgogICAvLy8gQG5vdGljZSBCdXlzIHRoZSB0b2tlbnMgZm9yIHRoZSBzcGVjaWZpZWQgdGllciBhbmQgZm9yIHRoZSBuZXh0IG9uZQogICAvLy8gQHBhcmFtIGFtb3VudCBUaGUgYW1vdW50IG9mIGV0aGVyIHBhaWQgdG8gYnV5IHRoZSB0b2tlbnMKICAgLy8vIEBwYXJhbSB0b2tlbnNUaGlzVGllciBUaGUgbGltaXQgb2YgdG9rZW5zIG9mIHRoYXQgdGllcgogICAvLy8gQHBhcmFtIHRpZXJTZWxlY3RlZCBUaGUgdGllciBzZWxlY3RlZAogICAvLy8gQHBhcmFtIF9yYXRlIFRoZSByYXRlIHVzZWQgZm9yIHRoYXQgYHRpZXJTZWxlY3RlZGAKICAgLy8vIEByZXR1cm4gdWludCBUaGUgdG90YWwgYW1vdW50IG9mIHRva2VucyBib3VnaHQgY29tYmluaW5nIHRoZSB0aWVyIHByaWNlcwogICBmdW5jdGlvbiBjYWxjdWxhdGVFeGNlc3NUb2tlbnMoCiAgICAgIHVpbnQyNTYgYW1vdW50LAogICAgICB1aW50MjU2IHRva2Vuc1RoaXNUaWVyLAogICAgICB1aW50MjU2IHRpZXJTZWxlY3RlZCwKICAgICAgdWludDI1NiBfcmF0ZQogICApIHB1YmxpYyByZXR1cm5zKHVpbnQyNTYgdG90YWxUb2tlbnMpIHsKICAgICAgcmVxdWlyZShhbW91bnQgPiAwICYmIHRva2Vuc1RoaXNUaWVyID4gMCAmJiBfcmF0ZSA+IDApOwogICAgICByZXF1aXJlKHRpZXJTZWxlY3RlZCA+PSAxICYmIHRpZXJTZWxlY3RlZCA8PSA0KTsKCiAgICAgIHVpbnQgd2VpVGhpc1RpZXIgPSB0b2tlbnNUaGlzVGllci5zdWIodG9rZW5zUmFpc2VkKS5kaXYoX3JhdGUpOwogICAgICB1aW50IHdlaU5leHRUaWVyID0gYW1vdW50LnN1Yih3ZWlUaGlzVGllcik7CiAgICAgIHVpbnQgdG9rZW5zTmV4dFRpZXIgPSAwOwogICAgICBib29sIHJldHVyblRva2VucyA9IGZhbHNlOwoKICAgICAgLy8gSWYgdGhlcmUncyBleGNlc3NpdmUgd2VpIGZvciB0aGUgbGFzdCB0aWVyLCByZWZ1bmQgdGhvc2UKICAgICAgaWYodGllclNlbGVjdGVkICE9IDQpCiAgICAgICAgIHRva2Vuc05leHRUaWVyID0gY2FsY3VsYXRlVG9rZW5zVGllcih3ZWlOZXh0VGllciwgdGllclNlbGVjdGVkLmFkZCgxKSk7CiAgICAgIGVsc2UKICAgICAgICAgcmV0dXJuVG9rZW5zID0gdHJ1ZTsKCiAgICAgIHRvdGFsVG9rZW5zID0gdG9rZW5zVGhpc1RpZXIuc3ViKHRva2Vuc1JhaXNlZCkuYWRkKHRva2Vuc05leHRUaWVyKTsKCiAgICAgIC8vIERvIHRoZSB0cmFuc2ZlciBhdCB0aGUgZW5kCiAgICAgIGlmKHJldHVyblRva2VucykgbXNnLnNlbmRlci50cmFuc2Zlcih3ZWlOZXh0VGllcik7CiAgIH0KCiAgIC8vLyBAbm90aWNlIEJ1eXMgdGhlIHRva2VucyBnaXZlbiB0aGUgcHJpY2Ugb2YgdGhlIHRpZXIgb25lIGFuZCB0aGUgd2VpIHBhaWQKICAgLy8vIEBwYXJhbSB3ZWlQYWlkIFRoZSBhbW91bnQgb2Ygd2VpIHBhaWQgdGhhdCB3aWxsIGJlIHVzZWQgdG8gYnV5IHRva2VucwogICAvLy8gQHBhcmFtIHRpZXJTZWxlY3RlZCBUaGUgdGllciB0aGF0IHlvdSdsbCB1c2UgZm9yIHRoaXIgcHVyY2hhc2UKICAgLy8vIEByZXR1cm4gY2FsY3VsYXRlZFRva2VucyBSZXR1cm5zIGhvdyBtYW55IHRva2VucyB5b3UndmUgYm91Z2h0IGZvciB0aGF0IHdlaSBwYWlkCiAgIGZ1bmN0aW9uIGNhbGN1bGF0ZVRva2Vuc1RpZXIodWludDI1NiB3ZWlQYWlkLCB1aW50MjU2IHRpZXJTZWxlY3RlZCkKICAgICAgICBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zKHVpbnQyNTYgY2FsY3VsYXRlZFRva2VucykKICAgewogICAgICByZXF1aXJlKHdlaVBhaWQgPiAwKTsKICAgICAgcmVxdWlyZSh0aWVyU2VsZWN0ZWQgPj0gMSAmJiB0aWVyU2VsZWN0ZWQgPD0gNCk7CgogICAgICBpZih0aWVyU2VsZWN0ZWQgPT0gMSkKICAgICAgICAgY2FsY3VsYXRlZFRva2VucyA9IHdlaVBhaWQubXVsKHJhdGUpOwogICAgICBlbHNlIGlmKHRpZXJTZWxlY3RlZCA9PSAyKQogICAgICAgICBjYWxjdWxhdGVkVG9rZW5zID0gd2VpUGFpZC5tdWwocmF0ZVRpZXIyKTsKICAgICAgZWxzZSBpZih0aWVyU2VsZWN0ZWQgPT0gMykKICAgICAgICAgY2FsY3VsYXRlZFRva2VucyA9IHdlaVBhaWQubXVsKHJhdGVUaWVyMyk7CiAgICAgIGVsc2UKICAgICAgICAgY2FsY3VsYXRlZFRva2VucyA9IHdlaVBhaWQubXVsKHJhdGVUaWVyNCk7CiAgIH0KCgogICAvLy8gQG5vdGljZSBDaGVja3MgaWYgYSBwdXJjaGFzZSBpcyBjb25zaWRlcmVkIHZhbGlkCiAgIC8vLyBAcmV0dXJuIGJvb2wgSWYgdGhlIHB1cmNoYXNlIGlzIHZhbGlkIG9yIG5vdAogICBmdW5jdGlvbiB2YWxpZFB1cmNoYXNlKCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyhib29sKSB7CiAgICAgIGJvb2wgd2l0aGluUGVyaW9kID0gbm93ID49IHN0YXJ0VGltZSAmJiBub3cgPD0gZW5kVGltZTsKICAgICAgYm9vbCBub25aZXJvUHVyY2hhc2UgPSBtc2cudmFsdWUgPiAwOwogICAgICBib29sIHdpdGhpblRva2VuTGltaXQgPSB0b2tlbnNSYWlzZWQgPCBtYXhUb2tlbnNSYWlzZWQ7CiAgICAgIGJvb2wgbWluaW11bVB1cmNoYXNlID0gbXNnLnZhbHVlID49IG1pblB1cmNoYXNlOwogICAgICBib29sIGhhc0JhbGFuY2VBdmFpbGFibGUgPSBjcm93ZHNhbGVCYWxhbmNlc1ttc2cuc2VuZGVyXSA8IG1heFB1cmNoYXNlOwoKICAgICAgLy8gV2Ugd2FudCB0byBsaW1pdCB0aGUgZ2FzIHRvIGF2b2lkIGdpdmluZyBwcmlvcml0eSB0byB0aGUgYmlnZ2VzdCBwYXlpbmcgY29udHJpYnV0b3JzCiAgICAgIC8vYm9vbCBsaW1pdEdhcyA9IHR4Lmdhc3ByaWNlIDw9IGxpbWl0R2FzUHJpY2U7CgogICAgICByZXR1cm4gd2l0aGluUGVyaW9kICYmIG5vblplcm9QdXJjaGFzZSAmJiB3aXRoaW5Ub2tlbkxpbWl0ICYmIG1pbmltdW1QdXJjaGFzZSAmJiBoYXNCYWxhbmNlQXZhaWxhYmxlOwogICB9CgogICAvLy8gQG5vdGljZSBUbyBzZWUgaWYgdGhlIG1pbmltdW0gZ29hbCBvZiB0b2tlbnMgb2YgdGhlIElDTyBoYXMgYmVlbiByZWFjaGVkCiAgIC8vLyBAcmV0dXJuIGJvb2wgVHJ1ZSBpZiB0aGUgdG9rZW5zIHJhaXNlZCBhcmUgYmlnZ2VyIHRoYW4gdGhlIGdvYWwgb3IgZmFsc2Ugb3RoZXJ3aXNlCiAgIGZ1bmN0aW9uIGdvYWxSZWFjaGVkKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoYm9vbCkgewogICAgICByZXR1cm4gdG9rZW5zUmFpc2VkID49IG1pbmltdW1Hb2FsOwogICB9CgogICAvLy8gQG5vdGljZSBQdWJsaWMgZnVuY3Rpb24gdG8gY2hlY2sgaWYgdGhlIGNyb3dkc2FsZSBoYXMgZW5kZWQgb3Igbm90CiAgIGZ1bmN0aW9uIGhhc0VuZGVkKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoYm9vbCkgewogICAgICByZXR1cm4gbm93ID4gZW5kVGltZSB8fCB0b2tlbnNSYWlzZWQgPj0gbWF4VG9rZW5zUmFpc2VkOwogICB9Cn0='.
	

]
