Class {
	#name : #SRTb547cc51ce58293e6945ba08d664ce051563d9ac,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTb547cc51ce58293e6945ba08d664ce051563d9ac >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7CgpsaWJyYXJ5IE1hdGggewogIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtaW42NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtYXgyNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQp9CgpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciBwdWJsaWMgewogICAgcmVxdWlyZShuZXdPd25lciAhPSBhZGRyZXNzKDApKTsKICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBuZXdPd25lcik7CiAgICBvd25lciA9IG5ld093bmVyOwogIH0KCn0KCmNvbnRyYWN0IFBhdXNhYmxlIGlzIE93bmFibGUgewogIGV2ZW50IFBhdXNlKCk7CiAgZXZlbnQgVW5wYXVzZSgpOwoKICBib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKCgogIC8qKgogICAqIEBkZXYgTW9kaWZpZXIgdG8gbWFrZSBhIGZ1bmN0aW9uIGNhbGxhYmxlIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgaXMgbm90IHBhdXNlZC4KICAgKi8KICBtb2RpZmllciB3aGVuTm90UGF1c2VkKCkgewogICAgcmVxdWlyZSghcGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIHBhdXNlZC4KICAgKi8KICBtb2RpZmllciB3aGVuUGF1c2VkKCkgewogICAgcmVxdWlyZShwYXVzZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byBwYXVzZSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHBhdXNlKCkgb25seU93bmVyIHdoZW5Ob3RQYXVzZWQgcHVibGljIHsKICAgIHBhdXNlZCA9IHRydWU7CiAgICBQYXVzZSgpOwogIH0KCiAgLyoqCiAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHVucGF1c2UsIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgICovCiAgZnVuY3Rpb24gdW5wYXVzZSgpIG9ubHlPd25lciB3aGVuUGF1c2VkIHB1YmxpYyB7CiAgICBwYXVzZWQgPSBmYWxzZTsKICAgIFVucGF1c2UoKTsKICB9Cn0KCmNvbnRyYWN0IENvbmZpZ3VyYWJsZSBpcyBPd25hYmxlIHsKICAvLyBFdmVudCB0cmlnZ2VyZWQgd2hlbiB0aGUgY29udHJhY3QgaGFzIGJlZW4gY29uZmlndXJlZCBieSB0aGUgb3duZXIKICBldmVudCBDb25maWd1cmVkKCk7CgogIGJvb2wgcHVibGljIGNvbmZpZ3VyZWQgPSBmYWxzZTsKCiAgLy8gQGRldiBGaW5hbGl6ZSBjb25maWd1cmF0aW9uLCBwcm9oaWJpdGluZyBmdXJ0aGVyIGNvbmZpZ3VyYXRpb24KICBmdW5jdGlvbiBmaW5pc2hDb25maWd1cmF0aW9uKCkgcHVibGljIGNvbmZpZ3VyYXRpb24gcmV0dXJucyAoYm9vbCkgewogICAgY29uZmlndXJlZCA9IHRydWU7CiAgICBDb25maWd1cmVkKCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vIEBkZXYgRW5mb3JjZSB0aGF0IGEgZnVuY3Rpb24gaXMgYW4gb3duZXItb25seSBjb25maWd1cmF0aW9uIG1ldGhvZC4KICAvLyAgIEludGVudGlvbmFsbHkgZHVwbGljYXRlcyB0aGUgYG9ubHlPd25lcmAgY2hlY2sgc28gdGhhdCB3ZSBjYW4ndAogIC8vICAgYWNjaWRlbnRhbGx5IGNyZWF0ZSBhIGNvbmZpZ3VyYXRpb24gb3B0aW9uIHRoYXQgd2l0aG91dCB0aGUgb3duZXIgbW9kaWZpZXIuCiAgLy8gICBUaGlzIG1vZGlmaWVyIHdpbGwgbm90IGxldCBhIGZ1bmN0aW9uIGJlIGNhbGxlZCBpZiB0aGUgYGZpbmFsaXplQ29uZmlndXJhdGlvbmAKICAvLyAgIGhhcyBiZWVuIGNhbGxlZC4KICBtb2RpZmllciBjb25maWd1cmF0aW9uKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIHJlcXVpcmUoIWNvbmZpZ3VyZWQpOwogICAgXzsKICB9CgogIG1vZGlmaWVyIG9ubHlBZnRlckNvbmZpZ3VyYXRpb24oKSB7CiAgICByZXF1aXJlKGNvbmZpZ3VyZWQpOwogICAgXzsKICB9Cn0KCmNvbnRyYWN0IENyb3dkc2FsZSB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIC8vIHN0YXJ0IGFuZCBlbmQgdGltZXN0YW1wcyB3aGVyZSBpbnZlc3RtZW50cyBhcmUgYWxsb3dlZCAoYm90aCBpbmNsdXNpdmUpCiAgdWludDI1NiBwdWJsaWMgc3RhcnRUaW1lOwogIHVpbnQyNTYgcHVibGljIGVuZFRpbWU7CgogIC8vIGFkZHJlc3Mgd2hlcmUgZnVuZHMgYXJlIGNvbGxlY3RlZAogIGFkZHJlc3MgcHVibGljIHdhbGxldDsKCiAgLy8gaG93IG1hbnkgdG9rZW4gdW5pdHMgYSBidXllciBnZXRzIHBlciB3ZWkKICB1aW50MjU2IHB1YmxpYyByYXRlOwoKICAvLyBhbW91bnQgb2YgcmFpc2VkIG1vbmV5IGluIHdlaQogIHVpbnQyNTYgcHVibGljIHdlaVJhaXNlZDsKCiAgLyoqCiAgICogZXZlbnQgZm9yIHRva2VuIHB1cmNoYXNlIGxvZ2dpbmcKICAgKiBAcGFyYW0gcHVyY2hhc2VyIHdobyBwYWlkIGZvciB0aGUgdG9rZW5zCiAgICogQHBhcmFtIGJlbmVmaWNpYXJ5IHdobyBnb3QgdGhlIHRva2VucwogICAqIEBwYXJhbSB2YWx1ZSB3ZWlzIHBhaWQgZm9yIHB1cmNoYXNlCiAgICogQHBhcmFtIGFtb3VudCBhbW91bnQgb2YgdG9rZW5zIHB1cmNoYXNlZAogICAqLwogIGV2ZW50IFRva2VuUHVyY2hhc2UoYWRkcmVzcyBpbmRleGVkIHB1cmNoYXNlciwgYWRkcmVzcyBpbmRleGVkIGJlbmVmaWNpYXJ5LCB1aW50MjU2IHZhbHVlLCB1aW50MjU2IGFtb3VudCk7CgogIGZ1bmN0aW9uIENyb3dkc2FsZSh1aW50MjU2IF9zdGFydFRpbWUsIHVpbnQyNTYgX2VuZFRpbWUsIHVpbnQyNTYgX3JhdGUsIGFkZHJlc3MgX3dhbGxldCkgcHVibGljIHsKICAgIHJlcXVpcmUoX3N0YXJ0VGltZSA+PSBub3cpOyAvLyBzb2xoaW50LWRpc2FibGUgbm90LXJlbHktb24tdGltZQogICAgcmVxdWlyZShfZW5kVGltZSA+PSBfc3RhcnRUaW1lKTsKICAgIHJlcXVpcmUoX3JhdGUgPiAwKTsKICAgIHJlcXVpcmUoX3dhbGxldCAhPSAweDApOwoKICAgIHN0YXJ0VGltZSA9IF9zdGFydFRpbWU7CiAgICBlbmRUaW1lID0gX2VuZFRpbWU7CiAgICByYXRlID0gX3JhdGU7CiAgICB3YWxsZXQgPSBfd2FsbGV0OwogIH0KCiAgLy8gZmFsbGJhY2sgZnVuY3Rpb24gY2FuIGJlIHVzZWQgdG8gYnV5IHRva2VucwogIGZ1bmN0aW9uICgpIHB1YmxpYyBwYXlhYmxlIHsKICAgIHByb3h5UGF5bWVudChtc2cuc2VuZGVyKTsKICB9CgogIC8vIE1ha2UgYSBwYXltZW50IGZvciB0aGUgcHJvdmlkZWQgYWRkcmVzcwogIC8vCiAgLy8gQHBhcmFtIF9vd25lciBhZGRyZXNzIHRoYXQgd2lsbCBvd24gdGhlIHB1cmNoYXNlZCB0b2tlbnMKICBmdW5jdGlvbiBwcm94eVBheW1lbnQoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBwYXlhYmxlIHJldHVybnMoYm9vbCk7CgogIC8vIEByZXR1cm4gdHJ1ZSBpZiBjcm93ZHNhbGUgZXZlbnQgaGFzIGVuZGVkCiAgZnVuY3Rpb24gaGFzRW5kZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIG5vdyA+IGVuZFRpbWU7CiAgfQoKICAvLyBzZW5kIGV0aGVyIHRvIHRoZSBmdW5kIGNvbGxlY3Rpb24gd2FsbGV0CiAgLy8gb3ZlcnJpZGUgdG8gY3JlYXRlIGN1c3RvbSBmdW5kIGZvcndhcmRpbmcgbWVjaGFuaXNtcwogIGZ1bmN0aW9uIGZvcndhcmRGdW5kcygpIGludGVybmFsIHsKICAgIHdhbGxldC50cmFuc2Zlcihtc2cudmFsdWUpOwogIH0KCiAgLy8gQHJldHVybiB0cnVlIGlmIHRoZSB0cmFuc2FjdGlvbiBjYW4gYnV5IHRva2VucwogIGZ1bmN0aW9uIHZhbGlkUHVyY2hhc2UoKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICBib29sIHdpdGhpblBlcmlvZCA9IG5vdyA+PSBzdGFydFRpbWUgJiYgbm93IDw9IGVuZFRpbWU7CiAgICBib29sIG5vblplcm9QdXJjaGFzZSA9IG1zZy52YWx1ZSAhPSAwOwogICAgcmV0dXJuIHdpdGhpblBlcmlvZCAmJiBub25aZXJvUHVyY2hhc2U7CiAgfQp9Cgpjb250cmFjdCBDYXBwZWRDcm93ZHNhbGUgaXMgQ3Jvd2RzYWxlIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgdWludDI1NiBwdWJsaWMgY2FwOwoKICBmdW5jdGlvbiBDYXBwZWRDcm93ZHNhbGUodWludDI1NiBfY2FwKSBwdWJsaWMgewogICAgcmVxdWlyZShfY2FwID4gMCk7CiAgICBjYXAgPSBfY2FwOwogIH0KCiAgLy8gb3ZlcnJpZGluZyBDcm93ZHNhbGUjaGFzRW5kZWQgdG8gYWRkIGNhcCBsb2dpYwogIC8vIEByZXR1cm4gdHJ1ZSBpZiBjcm93ZHNhbGUgZXZlbnQgaGFzIGVuZGVkCiAgZnVuY3Rpb24gaGFzRW5kZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgYm9vbCBjYXBSZWFjaGVkID0gd2VpUmFpc2VkID49IGNhcDsKICAgIHJldHVybiBzdXBlci5oYXNFbmRlZCgpIHx8IGNhcFJlYWNoZWQ7CiAgfQoKICAvLyBvdmVycmlkaW5nIENyb3dkc2FsZSN2YWxpZFB1cmNoYXNlIHRvIGFkZCBleHRyYSBjYXAgbG9naWMKICAvLyBAcmV0dXJuIHRydWUgaWYgaW52ZXN0b3JzIGNhbiBidXkgYXQgdGhlIG1vbWVudAogIGZ1bmN0aW9uIHZhbGlkUHVyY2hhc2UoKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICBib29sIHdpdGhpbkNhcCA9IHdlaVJhaXNlZC5hZGQobXNnLnZhbHVlKSA8PSBjYXA7CiAgICByZXR1cm4gc3VwZXIudmFsaWRQdXJjaGFzZSgpICYmIHdpdGhpbkNhcDsKICB9Cgp9Cgpjb250cmFjdCBGaW5hbGl6YWJsZUNyb3dkc2FsZSBpcyBDcm93ZHNhbGUsIE93bmFibGUgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICBib29sIHB1YmxpYyBpc0ZpbmFsaXplZCA9IGZhbHNlOwoKICBldmVudCBGaW5hbGl6ZWQoKTsKCiAgLyoqCiAgICogQGRldiBNdXN0IGJlIGNhbGxlZCBhZnRlciBjcm93ZHNhbGUgZW5kcywgdG8gZG8gc29tZSBleHRyYSBmaW5hbGl6YXRpb24KICAgKiB3b3JrLiBDYWxscyB0aGUgY29udHJhY3QncyBmaW5hbGl6YXRpb24gZnVuY3Rpb24uCiAgICovCiAgZnVuY3Rpb24gZmluYWxpemUoKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmUoIWlzRmluYWxpemVkKTsKICAgIHJlcXVpcmUoaGFzRW5kZWQoKSk7CgogICAgZmluYWxpemF0aW9uKCk7CiAgICBGaW5hbGl6ZWQoKTsKCiAgICBpc0ZpbmFsaXplZCA9IHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IENhbiBiZSBvdmVycmlkZGVuIHRvIGFkZCBmaW5hbGl6YXRpb24gbG9naWMuIFRoZSBvdmVycmlkaW5nIGZ1bmN0aW9uCiAgICogc2hvdWxkIGNhbGwgc3VwZXIuZmluYWxpemF0aW9uKCkgdG8gZW5zdXJlIHRoZSBjaGFpbiBvZiBmaW5hbGl6YXRpb24gaXMKICAgKiBleGVjdXRlZCBlbnRpcmVseS4KICAgKi8KICBmdW5jdGlvbiBmaW5hbGl6YXRpb24oKSBpbnRlcm5hbCB7IH0gLy8gc29saGludC1kaXNhYmxlIG5vLWVtcHR5LWJsb2Nrcwp9Cgpjb250cmFjdCBUb2tlbkNvbnRyb2xsZXIgewogICAgLy8vIEBub3RpY2UgQ2FsbGVkIHdoZW4gYF9vd25lcmAgc2VuZHMgZXRoZXIgdG8gdGhlIE1pbmlNZSBUb2tlbiBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCBzZW50IHRoZSBldGhlciB0byBjcmVhdGUgdG9rZW5zCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSBldGhlciBpcyBhY2NlcHRlZCwgZmFsc2UgaWYgaXQgdGhyb3dzCiAgICBmdW5jdGlvbiBwcm94eVBheW1lbnQoYWRkcmVzcyBfb3duZXIpIHBheWFibGUgcmV0dXJucyhib29sKTsKCiAgICAvLy8gQG5vdGljZSBOb3RpZmllcyB0aGUgY29udHJvbGxlciBhYm91dCBhIHRva2VuIHRyYW5zZmVyIGFsbG93aW5nIHRoZQogICAgLy8vICBjb250cm9sbGVyIHRvIHJlYWN0IGlmIGRlc2lyZWQKICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIG9yaWdpbiBvZiB0aGUgdHJhbnNmZXIKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBkZXN0aW5hdGlvbiBvZiB0aGUgdHJhbnNmZXIKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRoZSB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gRmFsc2UgaWYgdGhlIGNvbnRyb2xsZXIgZG9lcyBub3QgYXV0aG9yaXplIHRoZSB0cmFuc2ZlcgogICAgZnVuY3Rpb24gb25UcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfYW1vdW50KSByZXR1cm5zKGJvb2wpOwoKICAgIC8vLyBAbm90aWNlIE5vdGlmaWVzIHRoZSBjb250cm9sbGVyIGFib3V0IGFuIGFwcHJvdmFsIGFsbG93aW5nIHRoZQogICAgLy8vICBjb250cm9sbGVyIHRvIHJlYWN0IGlmIGRlc2lyZWQKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgY2FsbHMgYGFwcHJvdmUoKWAKICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIHNwZW5kZXIgaW4gdGhlIGBhcHByb3ZlKClgIGNhbGwKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IGluIHRoZSBgYXBwcm92ZSgpYCBjYWxsCiAgICAvLy8gQHJldHVybiBGYWxzZSBpZiB0aGUgY29udHJvbGxlciBkb2VzIG5vdCBhdXRob3JpemUgdGhlIGFwcHJvdmFsCiAgICBmdW5jdGlvbiBvbkFwcHJvdmUoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2Ftb3VudCkKICAgICAgICByZXR1cm5zKGJvb2wpOwp9Cgpjb250cmFjdCBCbG9vbVRva2VuU2FsZSBpcyBDYXBwZWRDcm93ZHNhbGUsIE93bmFibGUsIFRva2VuQ29udHJvbGxlciwgUGF1c2FibGUsIENvbmZpZ3VyYWJsZSwgRmluYWxpemFibGVDcm93ZHNhbGUgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICBCTFQgcHVibGljIHRva2VuOwoKICAvLyBTb2xoaW50IGJyZWFrcyBvbiBjb21iaW5hdGlvbiBvZiBzY2llbnRpZmljIG5vdGF0aW9uIGFuZCBgZXRoZXJgIGtleXdvcmQgc28gZGlzYWJsZSBuZXh0IGxpbmUKICAvLyBzb2xoaW50LWRpc2FibGUtbmV4dC1saW5lCiAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgVE9UQUxfU1VQUExZID0gMS41ZTggZXRoZXI7IC8vIDE1MCBtaWxsaW9uIEJMVCB3aXRoIDE4IGRlY2ltYWxzCiAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBGT1VOREFUSU9OX1NVUFBMWSA9IChUT1RBTF9TVVBQTFkgKiA0KSAvIDEwOyAvLyA0MCUgc3VwcGx5CiAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBBRFZJU09SX1NVUFBMWSA9IFRPVEFMX1NVUFBMWSAvIDIwOyAvLyA1JSBzdXBwbHkKICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IFBBUlRORVJTSElQX1NVUFBMWSA9IFRPVEFMX1NVUFBMWSAvIDIwOyAvLyA1JSBzdXBwbHkKICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IENPTlRST0xMRVJfQUxMT0NBVElPTiA9CiAgICBUT1RBTF9TVVBQTFkgLSBGT1VOREFUSU9OX1NVUFBMWSAtIFBBUlRORVJTSElQX1NVUFBMWTsgLy8gNTUlCiAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBXQUxMRVRfQUxMT0NBVElPTiA9IFRPVEFMX1NVUFBMWSAtIENPTlRST0xMRVJfQUxMT0NBVElPTjsgLy8gNDUlCiAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBNQVhfUkFJU0VfSU5fVVNEID0gNWU3OyAvLyBNYXhpbXVtIHJhaXNlIG9mICQ1ME0KCiAgLy8gV2VpIGV0aGVyIHdpdGggdHdvIGV4dHJhIGRlY2ltYWwgcGxhY2VzLiBVc2VmdWwgZm9yIGNvbnZlcnNpb24gd2hlbiB3ZSBzZXQgdGhlIGV0aGVyIHByaWNlCiAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBXRUlfUEVSX0VUSEVSX1RXT19ERUNJTUFMUyA9IDFlMjA7CiAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBUT0tFTl9VTklUU19QRVJfVE9LRU4gPSAxZTE4OyAvLyBEZWNpbWFsIHVuaXRzIHBlciBCTFQKCiAgdWludDI1NiBwdWJsaWMgYWR2aXNvclBvb2wgPSBBRFZJU09SX1NVUFBMWTsKCiAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBEVVNUID0gMSBmaW5uZXk7IC8vIE1pbmltdW0gcGF5bWVudAoKICBldmVudCBOZXdQcmVzYWxlQWxsb2NhdGlvbihhZGRyZXNzIGluZGV4ZWQgaG9sZGVyLCB1aW50MjU2IGJsdEFtb3VudCk7CgogIGZ1bmN0aW9uIEJsb29tVG9rZW5TYWxlKAogICAgdWludDI1NiBfc3RhcnRUaW1lLAogICAgdWludDI1NiBfZW5kVGltZSwKICAgIHVpbnQyNTYgX3JhdGUsCiAgICBhZGRyZXNzIF93YWxsZXQsCiAgICB1aW50MjU2IF9jYXAKICApIHB1YmxpYwogICAgQ3Jvd2RzYWxlKF9zdGFydFRpbWUsIF9lbmRUaW1lLCBfcmF0ZSwgX3dhbGxldCkKICAgIENhcHBlZENyb3dkc2FsZShfY2FwKSB7IH0gLy8gc29saGludC1kaXNhYmxlLWxpbmUgbm8tZW1wdHktYmxvY2tzCgogIC8vIEBkZXYgTGluayB0aGUgdG9rZW4gdG8gdGhlIENyb3dkc2FsZQogIC8vIEBwYXJhbSBfdG9rZW4gYWRkcmVzcyBvZiB0aGUgZGVwbG95ZWQgdG9rZW4KICBmdW5jdGlvbiBzZXRUb2tlbihhZGRyZXNzIF90b2tlbikgcHVibGljIHByZXNhbGVPbmx5IHsKICAgIHRva2VuID0gQkxUKF90b2tlbik7CiAgfQoKICAvLyBAZGV2IEFsbG9jYXRlIG91ciBpbml0aWFsIHRva2VuIHN1cHBseQogIGZ1bmN0aW9uIGFsbG9jYXRlU3VwcGx5KCkgcHVibGljIHByZXNhbGVPbmx5IHsKICAgIHJlcXVpcmUodG9rZW4udG90YWxTdXBwbHkoKSA9PSAwKTsKICAgIHRva2VuLmdlbmVyYXRlVG9rZW5zKGFkZHJlc3ModGhpcyksIENPTlRST0xMRVJfQUxMT0NBVElPTik7CiAgICB0b2tlbi5nZW5lcmF0ZVRva2Vucyh3YWxsZXQsIFdBTExFVF9BTExPQ0FUSU9OKTsKICB9CgogIC8vIEBkZXYgRXhwbGljaXRseSBhbGxvY2F0ZSB0b2tlbnMgZnJvbSB0aGUgYWR2aXNvciBwb29sLCB1cGRhdGluZyBob3cgbXVjaCBpcyBsZWZ0IGluIHRoZSBwb29sLgogIC8vCiAgLy8gQHBhcmFtIF9yZWNlaXZlciBSZWNpcGllbnQgb2YgZ3JhbnQKICAvLyBAcGFyYW0gX2Ftb3VudCBUb3RhbCBCTFQgdW5pdHMgYWxsb2NhdGVkCiAgLy8gQHBhcmFtIF9jbGlmZkRhdGUgVmVzdGluZyBjbGlmZgogIC8vIEBwYXJhbSBfdmVzdGluZ0RhdGUgRGF0ZSB0aGF0IHRoZSB2ZXN0aW5nIGZpbmlzaGVzCiAgZnVuY3Rpb24gYWxsb2NhdGVBZHZpc29yVG9rZW5zKGFkZHJlc3MgX3JlY2VpdmVyLCB1aW50MjU2IF9hbW91bnQsIHVpbnQ2NCBfY2xpZmZEYXRlLCB1aW50NjQgX3Zlc3RpbmdEYXRlKQogICAgICAgICAgIHB1YmxpYwogICAgICAgICAgIHByZXNhbGVPbmx5IHsKICAgIHJlcXVpcmUoX2Ftb3VudCA8PSBhZHZpc29yUG9vbCk7CiAgICBhZHZpc29yUG9vbCA9IGFkdmlzb3JQb29sLnN1YihfYW1vdW50KTsKICAgIGFsbG9jYXRlUHJlc2FsZVRva2VucyhfcmVjZWl2ZXIsIF9hbW91bnQsIF9jbGlmZkRhdGUsIF92ZXN0aW5nRGF0ZSk7CiAgfQoKICAvLyBAZGV2IEFsbG9jYXRlIGEgbm9ybWFsIHByZXNhbGUgZ3JhbnQuIERvZXMgbm90IG5lY2Vzc2FyaWx5IGNvbWUgZnJvbSBhIGxpbWl0ZWQgcG9vbCBsaWtlIHRoZSBhZHZpc29yIHRva2Vucy4KICAvLwogIC8vIEBwYXJhbSBfcmVjZWl2ZXIgUmVjaXBpZW50IG9mIGdyYW50CiAgLy8gQHBhcmFtIF9hbW91bnQgVG90YWwgQkxUIHVuaXRzIGFsbG9jYXRlZAogIC8vIEBwYXJhbSBfY2xpZmZEYXRlIFZlc3RpbmcgY2xpZmYKICAvLyBAcGFyYW0gX3Zlc3RpbmdEYXRlIERhdGUgdGhhdCB0aGUgdmVzdGluZyBmaW5pc2hlcwogIGZ1bmN0aW9uIGFsbG9jYXRlUHJlc2FsZVRva2VucyhhZGRyZXNzIF9yZWNlaXZlciwgdWludDI1NiBfYW1vdW50LCB1aW50NjQgY2xpZmZEYXRlLCB1aW50NjQgdmVzdGluZ0RhdGUpCiAgICAgICAgICAgcHVibGljCiAgICAgICAgICAgcHJlc2FsZU9ubHkgewoKICAgIHJlcXVpcmUoX2Ftb3VudCA8PSAxMCAqKiAyNSk7IC8vIDEwIG1pbGxpb24gQkxULiBObyBwcmVzYWxlIHBhcnRuZXIgd2lsbCBoYXZlIG1vcmUgdGhhbiB0aGlzIGFsbG9jYXRlZC4gUHJldmVudCBvdmVyZmxvd3MuCgogICAgLy8gc29saGludC1kaXNhYmxlLW5leHQtbGluZSBub3QtcmVseS1vbi10aW1lCiAgICB0b2tlbi5ncmFudFZlc3RlZFRva2VucyhfcmVjZWl2ZXIsIF9hbW91bnQsIHVpbnQ2NChub3cpLCBjbGlmZkRhdGUsIHZlc3RpbmdEYXRlLCB0cnVlLCBmYWxzZSk7CgogICAgTmV3UHJlc2FsZUFsbG9jYXRpb24oX3JlY2VpdmVyLCBfYW1vdW50KTsKICB9CgogIC8vIEBkZXYgU2V0IHRoZSBzdGFnZSBmb3IgdGhlIHNhbGU6CiAgLy8gICAxLiBTZXRzIHRoZSBgY2FwYCBjb250cm9sbGVyIHZhcmlhYmxlIGJhc2VkIG9uIHRoZSBVU0QvRVRIIHByaWNlCiAgLy8gICAyLiBVcGRhdGVzIHRoZSBgd2VpUmFpc2VkYCB0byB0aGUgYmFsYW5jZSBvZiBvdXIgd2FsbGV0CiAgLy8gICAzLiBUYWtlcyB0aGUgdW5hbGxvY2F0ZWQgcG9ydGlvbiBvZiB0aGUgYWR2aXNvciBwb29sIGFuZCB0cmFuc2ZlcnMgdG8gdGhlIHdhbGxldAogIC8vICAgNC4gU2V0cyB0aGUgYHJhdGVgIGZvciB0aGUgc2FsZSBub3cgYmFzZWQgb24gdGhlIHJlbWFpbmluZyB0b2tlbnMgYW5kIGNhcAogIC8vCiAgLy8gQHBhcmFtIF9jZW50cyBUaGUgbnVtYmVyIG9mIGNlbnRzIGluIFVTRCB0byBwdXJjaGFzZSAxIEVUSAogIC8vIEBwYXJhbSBfd2VpUmFpc2VkT2ZmQ2hhaW4gVG90YWwgYW1vdW50IG9mIHdlaSByYWlzZWQgKGF0IHNwZWNpZmllZCBjb252ZXJzaW9uIHJhdGUpIG91dHNpZGUgb2Ygd2FsbGV0CiAgZnVuY3Rpb24gZmluaXNoUHJlc2FsZSh1aW50MjU2IF9jZW50cywgdWludDI1NiBfd2VpUmFpc2VkT2ZmQ2hhaW4pIHB1YmxpYyBwcmVzYWxlT25seSByZXR1cm5zIChib29sKSB7CiAgICBzZXRDYXBGcm9tRXRoZXJQcmljZShfY2VudHMpOwogICAgc3luY1ByZXNhbGVXZWlSYWlzZWQoX3dlaVJhaXNlZE9mZkNoYWluKTsKICAgIHRyYW5zZmVyVW5hbGxvY2F0ZWRBZHZpc29yVG9rZW5zKCk7CiAgICB1cGRhdGVSYXRlQmFzZWRPbkZ1bmRzQW5kU3VwcGx5KCk7CiAgICBmaW5pc2hDb25maWd1cmF0aW9uKCk7CiAgfQoKICAvLyBAZGV2IFJldm9rZSBhIHRva2VuIGdyYW50LCB0cmFuc2ZlcmluZyB0aGUgdW52ZXN0ZWQgdG9rZW5zIHRvIG91ciBzYWxlIHdhbGxldAogIC8vCiAgLy8gQHBhcmFtIF9ob2xkZXIgT3duZXIgb2YgdGhlIHZlc3RpbmcgZ3JhbnQgdGhhdCBpcyBiZWluZyByZXZva2VkCiAgLy8gQHBhcmFtIF9ncmFudElkIElEIG9mIHRoZSBncmFudCBiZWluZyByZXZva2VkCiAgZnVuY3Rpb24gcmV2b2tlR3JhbnQoYWRkcmVzcyBfaG9sZGVyLCB1aW50MjU2IF9ncmFudElkKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHRva2VuLnJldm9rZVRva2VuR3JhbnQoX2hvbGRlciwgd2FsbGV0LCBfZ3JhbnRJZCk7CiAgfQoKICAvLyBAZGV2IGxvdyBsZXZlbCB0b2tlbiBwdXJjaGFzZSBmdW5jdGlvbgogIC8vIEBwYXJhbSBfYmVuZWZpY2lhcnkgYWRkcmVzcyB0aGUgdG9rZW5zIHdpbGwgYmUgY3JlZGl0ZWQgdG8KICBmdW5jdGlvbiBwcm94eVBheW1lbnQoYWRkcmVzcyBfYmVuZWZpY2lhcnkpCiAgICBwdWJsaWMKICAgIHBheWFibGUKICAgIHdoZW5Ob3RQYXVzZWQKICAgIG9ubHlBZnRlckNvbmZpZ3VyYXRpb24KICAgIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoX2JlbmVmaWNpYXJ5ICE9IDB4MCk7CiAgICByZXF1aXJlKHZhbGlkUHVyY2hhc2UoKSk7CgogICAgdWludDI1NiB3ZWlBbW91bnQgPSBtc2cudmFsdWU7CgogICAgLy8gVXBkYXRlIHRoZSB0b3RhbCB3ZWkgcmFpc2VkCiAgICB3ZWlSYWlzZWQgPSB3ZWlSYWlzZWQuYWRkKHdlaUFtb3VudCk7CgogICAgLy8gVHJhbnNmZXIgdG9rZW5zIGZyb20gdGhlIGNvbnRyb2xsZXIgdG8gdGhlIF9iZW5lZmljaWFyeQogICAgYWxsb2NhdGVUb2tlbnMoX2JlbmVmaWNpYXJ5LCB3ZWlBbW91bnQpOwoKICAgIC8vIFNlbmQgdGhlIHRyYW5zZmVyZWQgd2VpIHRvIG91ciB3YWxsZXQKICAgIGZvcndhcmRGdW5kcygpOwoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8gQGRldiBjb250cm9sbGVyIGNhbGxiYWNrIGZvciBhcHByb3ZpbmcgdG9rZW4gdHJhbnNmZXJzLiBPbmx5IHN1cHBvcnRzCiAgLy8gICB0cmFuc2ZlcnMgZnJvbSB0aGUgY29udHJvbGxlciBmb3Igbm93LgogIC8vCiAgLy8gQHBhcmFtIF9mcm9tIGFkZHJlc3MgdGhhdCB3YW50cyB0byB0cmFuc2ZlciB0aGVpciB0b2tlbnMKICBmdW5jdGlvbiBvblRyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIF9mcm9tID09IGFkZHJlc3ModGhpcykgfHwgX3RvID09IGFkZHJlc3Mod2FsbGV0KTsKICB9CgogIC8vIEBkZXYgY29udHJvbGxlciBjYWxsYmFjayBmb3IgYXBwcm92aW5nIHRva2VuIHRyYW5zZmVycy4gVGhpcyBmZWF0dXJlCiAgLy8gICBpcyBkaXNhYmxlZCBkdXJpbmcgdGhlIGNyb3dkc2FsZSBmb3IgdGhlIHNha2Ugb2Ygc2ltcGxpY2l0eQogIGZ1bmN0aW9uIG9uQXBwcm92ZShhZGRyZXNzLCBhZGRyZXNzLCB1aW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgLy8gQGRldiBDaGFuZ2UgdGhlIHRva2VuIGNvbnRyb2xsZXIgb25jZSB0aGUgc2FsZSBpcyBvdmVyCiAgLy8KICAvLyBAcGFyYW0gX25ld0NvbnRyb2xsZXIgQWRkcmVzcyBvZiBuZXcgdG9rZW4gY29udHJvbGxlcgogIGZ1bmN0aW9uIGNoYW5nZVRva2VuQ29udHJvbGxlcihhZGRyZXNzIF9uZXdDb250cm9sbGVyKSBwdWJsaWMgb25seU93bmVyIHdoZW5GaW5hbGl6ZWQgewogICAgdG9rZW4uY2hhbmdlQ29udHJvbGxlcihfbmV3Q29udHJvbGxlcik7CiAgfQoKICAvLyBAZGV2IFNldCB0aGUgY3Jvd2RzYWxlIGNhcCBiYXNlZCBvbiB0aGUgZXRoZXIgcHJpY2UKICAvLyBAcGFyYW0gX2NlbnRzIFRoZSBudW1iZXIgb2YgY2VudHMgaW4gVVNEIHRvIHB1cmNoYXNlIDEgRVRICiAgZnVuY3Rpb24gc2V0Q2FwRnJvbUV0aGVyUHJpY2UodWludDI1NiBfY2VudHMpIGludGVybmFsIHsKICAgIHJlcXVpcmUoX2NlbnRzID4gMTAwMDAgJiYgX2NlbnRzIDwgMTAwMDAwKTsKICAgIHVpbnQyNTYgd2VpUGVyRG9sbGFyID0gV0VJX1BFUl9FVEhFUl9UV09fREVDSU1BTFMuZGl2KF9jZW50cyk7CiAgICBjYXAgPSBNQVhfUkFJU0VfSU5fVVNELm11bCh3ZWlQZXJEb2xsYXIpOwogIH0KCiAgLy8gQGRldiBTZXQgdGhlIGB3ZWlSYWlzZWRgIGZvciB0aGlzIGNvbnRyYWN0IHRvIHRoZSBiYWxhbmNlIG9mIHRoZSBzYWxlIHdhbGxldAogIGZ1bmN0aW9uIHN5bmNQcmVzYWxlV2VpUmFpc2VkKHVpbnQyNTYgX3dlaVJhaXNlZE9mZkNoYWluKSBpbnRlcm5hbCB7CiAgICByZXF1aXJlKHdlaVJhaXNlZCA9PSAwKTsKICAgIHdlaVJhaXNlZCA9IHdhbGxldC5iYWxhbmNlLmFkZChfd2VpUmFpc2VkT2ZmQ2hhaW4pOwogIH0KCiAgLy8gQGRldiBUcmFuc2ZlciB1bmFsbG9jYXRlZCBhZHZpc29yIHRva2VucyB0byBvdXIgd2FsbGV0LiBMZXRzIHVzIHNlbGwgYW55IGxlZnRvdmVycwogIGZ1bmN0aW9uIHRyYW5zZmVyVW5hbGxvY2F0ZWRBZHZpc29yVG9rZW5zKCkgaW50ZXJuYWwgewogICAgdWludDI1NiBfdW5hbGxvY2F0ZWRUb2tlbnMgPSBhZHZpc29yUG9vbDsKICAgIC8vIEFkdmlzb3IgcG9vbCB3aWxsIG5vdCBiZSB1c2VkIGFnYWluIGJ1dCB3ZSB6ZXJvIGl0IG91dCBhbnl3YXlzIGZvciB0aGUgc2FrZSBvZiBib29rIGtlZXBpbmcKICAgIGFkdmlzb3JQb29sID0gMDsKICAgIHRva2VuLnRyYW5zZmVyRnJvbShhZGRyZXNzKHRoaXMpLCB3YWxsZXQsIF91bmFsbG9jYXRlZFRva2Vucyk7CiAgfQoKICAvLyBAZGV2IFNldCB0aGUgYHJhdGVgIGJhc2VkIG9uIG91ciByZW1haW5pbmcgdG9rZW4gc3VwcGx5IGFuZCBob3cgbXVjaCB3ZSBzdGlsbCBuZWVkIHRvIHJhaXNlCiAgZnVuY3Rpb24gdXBkYXRlUmF0ZUJhc2VkT25GdW5kc0FuZFN1cHBseSgpIGludGVybmFsIHsKICAgIHVpbnQyNTYgX3VucmFpc2VkV2VpID0gY2FwIC0gd2VpUmFpc2VkOwogICAgdWludDI1NiBfdG9rZW5zRm9yU2FsZSA9IHRva2VuLmJhbGFuY2VPZihhZGRyZXNzKHRoaXMpKTsKICAgIHJhdGUgPSBfdG9rZW5zRm9yU2FsZS5tdWwoMWUxOCkuZGl2KF91bnJhaXNlZFdlaSk7CiAgfQoKICAvLyBAZGV2IFRyYW5zZmVyIGZ1bmRzIGZyb20gdGhlIGNvbnRyb2xsZXIncyBhZGRyZXNzIHRvIHRoZSBfYmVuZWZpY2lhcnkuIFVzZXMKICAvLyAgIF93ZWlBbW91bnQgdG8gY29tcHV0ZSB0aGUgbnVtYmVyIG9mIHRva2VucyBwdXJjaGFzZWQuCiAgLy8gQHBhcmFtIF9iZW5lZmljaWFyeSByZWNpcGllbnQgb2YgdG9rZW5zCiAgLy8gQHBhcmFtIF93ZWlBbW91bnQgd2VpIHRyYW5zZmVyZWQgdG8gY3Jvd2RzYWxlCiAgZnVuY3Rpb24gYWxsb2NhdGVUb2tlbnMoYWRkcmVzcyBfYmVuZWZpY2lhcnksIHVpbnQyNTYgX3dlaUFtb3VudCkgaW50ZXJuYWwgewogICAgdG9rZW4udHJhbnNmZXJGcm9tKGFkZHJlc3ModGhpcyksIF9iZW5lZmljaWFyeSwgdG9rZW5zRm9yKF93ZWlBbW91bnQpKTsKICB9CgogIC8vIEBkZXYgQ29tcHV0ZSBudW1iZXIgb2YgdG9rZW4gdW5pdHMgYSBnaXZlbiBhbW91bnQgb2Ygd2VpIGdldHMKICAvLwogIC8vIEBwYXJhbSBfd2VpQW1vdW50IEFtb3VudCBvZiB3ZWkgdG8gY29udmVydAogIGZ1bmN0aW9uIHRva2Vuc0Zvcih1aW50MjU2IF93ZWlBbW91bnQpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBfd2VpQW1vdW50Lm11bChyYXRlKS5kaXYoMWUxOCk7CiAgfQoKICAvLyBAZGV2IHZhbGlkYXRlIHB1cmNoYXNlcy4gRGVsZWdhdGVzIHRvIHN1cGVyIG1ldGhvZCBhbmQgYWxzbyByZXF1aXJlcyB0aGF0CiAgLy8gICB0aGUgaW5pdGlhbCBjb25maWd1cmF0aW9uIHBoYXNlIGlzIGZpbmlzaGVkLgogIGZ1bmN0aW9uIHZhbGlkUHVyY2hhc2UoKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc3VwZXIudmFsaWRQdXJjaGFzZSgpICYmIG1zZy52YWx1ZSA+PSBEVVNUICYmIGNvbmZpZ3VyZWQ7CiAgfQoKICAvLyBAZGV2IHRyYW5zZmVyIGxlZnRvdmVyIHRva2VucyB0byBvdXIgd2FsbGV0CiAgZnVuY3Rpb24gZmluYWxpemF0aW9uKCkgaW50ZXJuYWwgewogICAgdG9rZW4udHJhbnNmZXJGcm9tKGFkZHJlc3ModGhpcyksIHdhbGxldCwgdG9rZW4uYmFsYW5jZU9mKGFkZHJlc3ModGhpcykpKTsKICB9CgogIGZ1bmN0aW9uIGluUHJlc2FsZVBoYXNlKCkgaW50ZXJuYWwgY29uc3RhbnQgYmVmb3JlU2FsZSBjb25maWd1cmF0aW9uIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgbW9kaWZpZXIgcHJlc2FsZU9ubHkoKSB7CiAgICByZXF1aXJlKGluUHJlc2FsZVBoYXNlKCkpOwogICAgXzsKICB9CgogIG1vZGlmaWVyIGJlZm9yZVNhbGUgewogICAgcmVxdWlyZShub3cgPCBzdGFydFRpbWUpOyAvLyBzb2xoaW50LWRpc2FibGUtbGluZSBub3QtcmVseS1vbi10aW1lCiAgICBfOwogIH0KCiAgbW9kaWZpZXIgd2hlbkZpbmFsaXplZCB7CiAgICByZXF1aXJlKGlzRmluYWxpemVkKTsKICAgIF87CiAgfQp9Cgpjb250cmFjdCBDb250cm9sbGVkIHsKICAgIC8vLyBAbm90aWNlIFRoZSBhZGRyZXNzIG9mIHRoZSBjb250cm9sbGVyIGlzIHRoZSBvbmx5IGFkZHJlc3MgdGhhdCBjYW4gY2FsbAogICAgLy8vICBhIGZ1bmN0aW9uIHdpdGggdGhpcyBtb2RpZmllcgogICAgbW9kaWZpZXIgb25seUNvbnRyb2xsZXIgeyByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY29udHJvbGxlcik7IF87IH0KCiAgICBhZGRyZXNzIHB1YmxpYyBjb250cm9sbGVyOwoKICAgIGZ1bmN0aW9uIENvbnRyb2xsZWQoKSB7IGNvbnRyb2xsZXIgPSBtc2cuc2VuZGVyO30KCiAgICAvLy8gQG5vdGljZSBDaGFuZ2VzIHRoZSBjb250cm9sbGVyIG9mIHRoZSBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfbmV3Q29udHJvbGxlciBUaGUgbmV3IGNvbnRyb2xsZXIgb2YgdGhlIGNvbnRyYWN0CiAgICBmdW5jdGlvbiBjaGFuZ2VDb250cm9sbGVyKGFkZHJlc3MgX25ld0NvbnRyb2xsZXIpIG9ubHlDb250cm9sbGVyIHsKICAgICAgICBjb250cm9sbGVyID0gX25ld0NvbnRyb2xsZXI7CiAgICB9Cn0KCmNvbnRyYWN0IEFwcHJvdmVBbmRDYWxsRmFsbEJhY2sgewogICAgZnVuY3Rpb24gcmVjZWl2ZUFwcHJvdmFsKGFkZHJlc3MgZnJvbSwgdWludDI1NiBfYW1vdW50LCBhZGRyZXNzIF90b2tlbiwgYnl0ZXMgX2RhdGEpOwp9Cgpjb250cmFjdCBNaW5pTWVUb2tlbiBpcyBDb250cm9sbGVkIHsKCiAgICBzdHJpbmcgcHVibGljIG5hbWU7ICAgICAgICAgICAgICAgIC8vVGhlIFRva2VuJ3MgbmFtZTogZS5nLiBEaWdpeERBTyBUb2tlbnMKICAgIHVpbnQ4IHB1YmxpYyBkZWNpbWFsczsgICAgICAgICAgICAgLy9OdW1iZXIgb2YgZGVjaW1hbHMgb2YgdGhlIHNtYWxsZXN0IHVuaXQKICAgIHN0cmluZyBwdWJsaWMgc3ltYm9sOyAgICAgICAgICAgICAgLy9BbiBpZGVudGlmaWVyOiBlLmcuIFJFUAogICAgc3RyaW5nIHB1YmxpYyB2ZXJzaW9uID0gJ01NVF8wLjEnOyAvL0FuIGFyYml0cmFyeSB2ZXJzaW9uaW5nIHNjaGVtZQoKCiAgICAvLy8gQGRldiBgQ2hlY2twb2ludGAgaXMgdGhlIHN0cnVjdHVyZSB0aGF0IGF0dGFjaGVzIGEgYmxvY2sgbnVtYmVyIHRvIGEKICAgIC8vLyAgZ2l2ZW4gdmFsdWUsIHRoZSBibG9jayBudW1iZXIgYXR0YWNoZWQgaXMgdGhlIG9uZSB0aGF0IGxhc3QgY2hhbmdlZCB0aGUKICAgIC8vLyAgdmFsdWUKICAgIHN0cnVjdCAgQ2hlY2twb2ludCB7CgogICAgICAgIC8vIGBmcm9tQmxvY2tgIGlzIHRoZSBibG9jayBudW1iZXIgdGhhdCB0aGUgdmFsdWUgd2FzIGdlbmVyYXRlZCBmcm9tCiAgICAgICAgdWludDEyOCBmcm9tQmxvY2s7CgogICAgICAgIC8vIGB2YWx1ZWAgaXMgdGhlIGFtb3VudCBvZiB0b2tlbnMgYXQgYSBzcGVjaWZpYyBibG9jayBudW1iZXIKICAgICAgICB1aW50MTI4IHZhbHVlOwogICAgfQoKICAgIC8vIGBwYXJlbnRUb2tlbmAgaXMgdGhlIFRva2VuIGFkZHJlc3MgdGhhdCB3YXMgY2xvbmVkIHRvIHByb2R1Y2UgdGhpcyB0b2tlbjsKICAgIC8vICBpdCB3aWxsIGJlIDB4MCBmb3IgYSB0b2tlbiB0aGF0IHdhcyBub3QgY2xvbmVkCiAgICBNaW5pTWVUb2tlbiBwdWJsaWMgcGFyZW50VG9rZW47CgogICAgLy8gYHBhcmVudFNuYXBTaG90QmxvY2tgIGlzIHRoZSBibG9jayBudW1iZXIgZnJvbSB0aGUgUGFyZW50IFRva2VuIHRoYXQgd2FzCiAgICAvLyAgdXNlZCB0byBkZXRlcm1pbmUgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBDbG9uZSBUb2tlbgogICAgdWludCBwdWJsaWMgcGFyZW50U25hcFNob3RCbG9jazsKCiAgICAvLyBgY3JlYXRpb25CbG9ja2AgaXMgdGhlIGJsb2NrIG51bWJlciB0aGF0IHRoZSBDbG9uZSBUb2tlbiB3YXMgY3JlYXRlZAogICAgdWludCBwdWJsaWMgY3JlYXRpb25CbG9jazsKCiAgICAvLyBgYmFsYW5jZXNgIGlzIHRoZSBtYXAgdGhhdCB0cmFja3MgdGhlIGJhbGFuY2Ugb2YgZWFjaCBhZGRyZXNzLCBpbiB0aGlzCiAgICAvLyAgY29udHJhY3Qgd2hlbiB0aGUgYmFsYW5jZSBjaGFuZ2VzIHRoZSBibG9jayBudW1iZXIgdGhhdCB0aGUgY2hhbmdlCiAgICAvLyAgb2NjdXJyZWQgaXMgYWxzbyBpbmNsdWRlZCBpbiB0aGUgbWFwCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IENoZWNrcG9pbnRbXSkgYmFsYW5jZXM7CgogICAgLy8gYGFsbG93ZWRgIHRyYWNrcyBhbnkgZXh0cmEgdHJhbnNmZXIgcmlnaHRzIGFzIGluIGFsbCBFUkMyMCB0b2tlbnMKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKCiAgICAvLyBUcmFja3MgdGhlIGhpc3Rvcnkgb2YgdGhlIGB0b3RhbFN1cHBseWAgb2YgdGhlIHRva2VuCiAgICBDaGVja3BvaW50W10gdG90YWxTdXBwbHlIaXN0b3J5OwoKICAgIC8vIEZsYWcgdGhhdCBkZXRlcm1pbmVzIGlmIHRoZSB0b2tlbiBpcyB0cmFuc2ZlcmFibGUgb3Igbm90LgogICAgYm9vbCBwdWJsaWMgdHJhbnNmZXJzRW5hYmxlZDsKCiAgICAvLyBUaGUgZmFjdG9yeSB1c2VkIHRvIGNyZWF0ZSBuZXcgY2xvbmUgdG9rZW5zCiAgICBNaW5pTWVUb2tlbkZhY3RvcnkgcHVibGljIHRva2VuRmFjdG9yeTsKCi8vLy8vLy8vLy8vLy8vLy8KLy8gQ29uc3RydWN0b3IKLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIENvbnN0cnVjdG9yIHRvIGNyZWF0ZSBhIE1pbmlNZVRva2VuCiAgICAvLy8gQHBhcmFtIF90b2tlbkZhY3RvcnkgVGhlIGFkZHJlc3Mgb2YgdGhlIE1pbmlNZVRva2VuRmFjdG9yeSBjb250cmFjdCB0aGF0CiAgICAvLy8gIHdpbGwgY3JlYXRlIHRoZSBDbG9uZSB0b2tlbiBjb250cmFjdHMsIHRoZSB0b2tlbiBmYWN0b3J5IG5lZWRzIHRvIGJlCiAgICAvLy8gIGRlcGxveWVkIGZpcnN0CiAgICAvLy8gQHBhcmFtIF9wYXJlbnRUb2tlbiBBZGRyZXNzIG9mIHRoZSBwYXJlbnQgdG9rZW4sIHNldCB0byAweDAgaWYgaXQgaXMgYQogICAgLy8vICBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3BhcmVudFNuYXBTaG90QmxvY2sgQmxvY2sgb2YgdGhlIHBhcmVudCB0b2tlbiB0aGF0IHdpbGwKICAgIC8vLyAgZGV0ZXJtaW5lIHRoZSBpbml0aWFsIGRpc3RyaWJ1dGlvbiBvZiB0aGUgY2xvbmUgdG9rZW4sIHNldCB0byAwIGlmIGl0CiAgICAvLy8gIGlzIGEgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF90b2tlbk5hbWUgTmFtZSBvZiB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF9kZWNpbWFsVW5pdHMgTnVtYmVyIG9mIGRlY2ltYWxzIG9mIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3Rva2VuU3ltYm9sIFRva2VuIFN5bWJvbCBmb3IgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfdHJhbnNmZXJzRW5hYmxlZCBJZiB0cnVlLCB0b2tlbnMgd2lsbCBiZSBhYmxlIHRvIGJlIHRyYW5zZmVycmVkCiAgICBmdW5jdGlvbiBNaW5pTWVUb2tlbigKICAgICAgICBhZGRyZXNzIF90b2tlbkZhY3RvcnksCiAgICAgICAgYWRkcmVzcyBfcGFyZW50VG9rZW4sCiAgICAgICAgdWludCBfcGFyZW50U25hcFNob3RCbG9jaywKICAgICAgICBzdHJpbmcgX3Rva2VuTmFtZSwKICAgICAgICB1aW50OCBfZGVjaW1hbFVuaXRzLAogICAgICAgIHN0cmluZyBfdG9rZW5TeW1ib2wsCiAgICAgICAgYm9vbCBfdHJhbnNmZXJzRW5hYmxlZAogICAgKSB7CiAgICAgICAgdG9rZW5GYWN0b3J5ID0gTWluaU1lVG9rZW5GYWN0b3J5KF90b2tlbkZhY3RvcnkpOwogICAgICAgIG5hbWUgPSBfdG9rZW5OYW1lOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgbmFtZQogICAgICAgIGRlY2ltYWxzID0gX2RlY2ltYWxVbml0czsgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgZGVjaW1hbHMKICAgICAgICBzeW1ib2wgPSBfdG9rZW5TeW1ib2w7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIHN5bWJvbAogICAgICAgIHBhcmVudFRva2VuID0gTWluaU1lVG9rZW4oX3BhcmVudFRva2VuKTsKICAgICAgICBwYXJlbnRTbmFwU2hvdEJsb2NrID0gX3BhcmVudFNuYXBTaG90QmxvY2s7CiAgICAgICAgdHJhbnNmZXJzRW5hYmxlZCA9IF90cmFuc2ZlcnNFbmFibGVkOwogICAgICAgIGNyZWF0aW9uQmxvY2sgPSBibG9jay5udW1iZXI7CiAgICB9CgoKLy8vLy8vLy8vLy8vLy8vLy8vLwovLyBFUkMyMCBNZXRob2RzCi8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBTZW5kIGBfYW1vdW50YCB0b2tlbnMgdG8gYF90b2AgZnJvbSBgbXNnLnNlbmRlcmAKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKHRyYW5zZmVyc0VuYWJsZWQpOwogICAgICAgIHJldHVybiBkb1RyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX2Ftb3VudCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgU2VuZCBgX2Ftb3VudGAgdG9rZW5zIHRvIGBfdG9gIGZyb20gYF9mcm9tYCBvbiB0aGUgY29uZGl0aW9uIGl0CiAgICAvLy8gIGlzIGFwcHJvdmVkIGJ5IGBfZnJvbWAKICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3MgaG9sZGluZyB0aGUgdG9rZW5zIGJlaW5nIHRyYW5zZmVycmVkCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudAogICAgKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKCiAgICAgICAgLy8gVGhlIGNvbnRyb2xsZXIgb2YgdGhpcyBjb250cmFjdCBjYW4gbW92ZSB0b2tlbnMgYXJvdW5kIGF0IHdpbGwsCiAgICAgICAgLy8gIHRoaXMgaXMgaW1wb3J0YW50IHRvIHJlY29nbml6ZSEgQ29uZmlybSB0aGF0IHlvdSB0cnVzdCB0aGUKICAgICAgICAvLyAgY29udHJvbGxlciBvZiB0aGlzIGNvbnRyYWN0LCB3aGljaCBpbiBtb3N0IHNpdHVhdGlvbnMgc2hvdWxkIGJlCiAgICAgICAgLy8gIGFub3RoZXIgb3BlbiBzb3VyY2Ugc21hcnQgY29udHJhY3Qgb3IgMHgwCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gY29udHJvbGxlcikgewogICAgICAgICAgICByZXF1aXJlKHRyYW5zZmVyc0VuYWJsZWQpOwoKICAgICAgICAgICAgLy8gVGhlIHN0YW5kYXJkIEVSQyAyMCB0cmFuc2ZlckZyb20gZnVuY3Rpb25hbGl0eQogICAgICAgICAgICBpZiAoYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPCBfYW1vdW50KSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdIC09IF9hbW91bnQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiBkb1RyYW5zZmVyKF9mcm9tLCBfdG8sIF9hbW91bnQpOwogICAgfQoKICAgIC8vLyBAZGV2IFRoaXMgaXMgdGhlIGFjdHVhbCB0cmFuc2ZlciBmdW5jdGlvbiBpbiB0aGUgdG9rZW4gY29udHJhY3QsIGl0IGNhbgogICAgLy8vICBvbmx5IGJlIGNhbGxlZCBieSBvdGhlciBmdW5jdGlvbnMgaW4gdGhpcyBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3MgaG9sZGluZyB0aGUgdG9rZW5zIGJlaW5nIHRyYW5zZmVycmVkCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsCiAgICBmdW5jdGlvbiBkb1RyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF9hbW91bnQKICAgICkgaW50ZXJuYWwgcmV0dXJucyhib29sKSB7CgogICAgICAgICAgIGlmIChfYW1vdW50ID09IDApIHsKICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgfQoKICAgICAgICAgICByZXF1aXJlKHBhcmVudFNuYXBTaG90QmxvY2sgPCBibG9jay5udW1iZXIpOwoKICAgICAgICAgICAvLyBEbyBub3QgYWxsb3cgdHJhbnNmZXIgdG8gMHgwIG9yIHRoZSB0b2tlbiBjb250cmFjdCBpdHNlbGYKICAgICAgICAgICByZXF1aXJlKChfdG8gIT0gMCkgJiYgKF90byAhPSBhZGRyZXNzKHRoaXMpKSk7CgogICAgICAgICAgIC8vIElmIHRoZSBhbW91bnQgYmVpbmcgdHJhbnNmZXJlZCBpcyBtb3JlIHRoYW4gdGhlIGJhbGFuY2Ugb2YgdGhlCiAgICAgICAgICAgLy8gIGFjY291bnQgdGhlIHRyYW5zZmVyIHJldHVybnMgZmFsc2UKICAgICAgICAgICB2YXIgcHJldmlvdXNCYWxhbmNlRnJvbSA9IGJhbGFuY2VPZkF0KF9mcm9tLCBibG9jay5udW1iZXIpOwogICAgICAgICAgIGlmIChwcmV2aW91c0JhbGFuY2VGcm9tIDwgX2Ftb3VudCkgewogICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgfQoKICAgICAgICAgICAvLyBBbGVydHMgdGhlIHRva2VuIGNvbnRyb2xsZXIgb2YgdGhlIHRyYW5zZmVyCiAgICAgICAgICAgaWYgKGlzQ29udHJhY3QoY29udHJvbGxlcikpIHsKICAgICAgICAgICAgICAgcmVxdWlyZShUb2tlbkNvbnRyb2xsZXIoY29udHJvbGxlcikub25UcmFuc2ZlcihfZnJvbSwgX3RvLCBfYW1vdW50KSk7CiAgICAgICAgICAgfQoKICAgICAgICAgICAvLyBGaXJzdCB1cGRhdGUgdGhlIGJhbGFuY2UgYXJyYXkgd2l0aCB0aGUgbmV3IHZhbHVlIGZvciB0aGUgYWRkcmVzcwogICAgICAgICAgIC8vICBzZW5kaW5nIHRoZSB0b2tlbnMKICAgICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KGJhbGFuY2VzW19mcm9tXSwgcHJldmlvdXNCYWxhbmNlRnJvbSAtIF9hbW91bnQpOwoKICAgICAgICAgICAvLyBUaGVuIHVwZGF0ZSB0aGUgYmFsYW5jZSBhcnJheSB3aXRoIHRoZSBuZXcgdmFsdWUgZm9yIHRoZSBhZGRyZXNzCiAgICAgICAgICAgLy8gIHJlY2VpdmluZyB0aGUgdG9rZW5zCiAgICAgICAgICAgdmFyIHByZXZpb3VzQmFsYW5jZVRvID0gYmFsYW5jZU9mQXQoX3RvLCBibG9jay5udW1iZXIpOwogICAgICAgICAgIHJlcXVpcmUocHJldmlvdXNCYWxhbmNlVG8gKyBfYW1vdW50ID49IHByZXZpb3VzQmFsYW5jZVRvKTsgLy8gQ2hlY2sgZm9yIG92ZXJmbG93CiAgICAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfdG9dLCBwcmV2aW91c0JhbGFuY2VUbyArIF9hbW91bnQpOwoKICAgICAgICAgICAvLyBBbiBldmVudCB0byBtYWtlIHRoZSB0cmFuc2ZlciBlYXN5IHRvIGZpbmQgb24gdGhlIGJsb2NrY2hhaW4KICAgICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfYW1vdW50KTsKCiAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCdzIGJhbGFuY2UgaXMgYmVpbmcgcmVxdWVzdGVkCiAgICAvLy8gQHJldHVybiBUaGUgYmFsYW5jZSBvZiBgX293bmVyYCBhdCB0aGUgY3VycmVudCBibG9jawogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgICAgICByZXR1cm4gYmFsYW5jZU9mQXQoX293bmVyLCBibG9jay5udW1iZXIpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgX3NwZW5kZXJgIHRvIHNwZW5kIGBfYW1vdW50YCB0b2tlbnMgb24KICAgIC8vLyAgaXRzIGJlaGFsZi4gVGhpcyBpcyBhIG1vZGlmaWVkIHZlcnNpb24gb2YgdGhlIEVSQzIwIGFwcHJvdmUgZnVuY3Rpb24KICAgIC8vLyAgdG8gYmUgYSBsaXR0bGUgYml0IHNhZmVyCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2VucwogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgYXBwcm92YWwgd2FzIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfYW1vdW50KSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKHRyYW5zZmVyc0VuYWJsZWQpOwoKICAgICAgICAvLyBUbyBjaGFuZ2UgdGhlIGFwcHJvdmUgYW1vdW50IHlvdSBmaXJzdCBoYXZlIHRvIHJlZHVjZSB0aGUgYWRkcmVzc2VzYAogICAgICAgIC8vICBhbGxvd2FuY2UgdG8gemVybyBieSBjYWxsaW5nIGBhcHByb3ZlKF9zcGVuZGVyLDApYCBpZiBpdCBpcyBub3QKICAgICAgICAvLyAgYWxyZWFkeSAwIHRvIG1pdGlnYXRlIHRoZSByYWNlIGNvbmRpdGlvbiBkZXNjcmliZWQgaGVyZToKICAgICAgICAvLyAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgICAgICByZXF1aXJlKChfYW1vdW50ID09IDApIHx8IChhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9PSAwKSk7CgogICAgICAgIC8vIEFsZXJ0cyB0aGUgdG9rZW4gY29udHJvbGxlciBvZiB0aGUgYXBwcm92ZSBmdW5jdGlvbiBjYWxsCiAgICAgICAgaWYgKGlzQ29udHJhY3QoY29udHJvbGxlcikpIHsKICAgICAgICAgICAgcmVxdWlyZShUb2tlbkNvbnRyb2xsZXIoY29udHJvbGxlcikub25BcHByb3ZlKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfYW1vdW50KSk7CiAgICAgICAgfQoKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF9hbW91bnQ7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF9hbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAZGV2IFRoaXMgZnVuY3Rpb24gbWFrZXMgaXQgZWFzeSB0byByZWFkIHRoZSBgYWxsb3dlZFtdYCBtYXAKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IHRoYXQgb3ducyB0aGUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHJldHVybiBBbW91bnQgb2YgcmVtYWluaW5nIHRva2VucyBvZiBfb3duZXIgdGhhdCBfc3BlbmRlciBpcyBhbGxvd2VkCiAgICAvLy8gIHRvIHNwZW5kCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIKICAgICkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBgbXNnLnNlbmRlcmAgYXBwcm92ZXMgYF9zcGVuZGVyYCB0byBzZW5kIGBfYW1vdW50YCB0b2tlbnMgb24KICAgIC8vLyAgaXRzIGJlaGFsZiwgYW5kIHRoZW4gYSBmdW5jdGlvbiBpcyB0cmlnZ2VyZWQgaW4gdGhlIGNvbnRyYWN0IHRoYXQgaXMKICAgIC8vLyAgYmVpbmcgYXBwcm92ZWQsIGBfc3BlbmRlcmAuIFRoaXMgYWxsb3dzIHVzZXJzIHRvIHVzZSB0aGVpciB0b2tlbnMgdG8KICAgIC8vLyAgaW50ZXJhY3Qgd2l0aCBjb250cmFjdHMgaW4gb25lIGZ1bmN0aW9uIGNhbGwgaW5zdGVhZCBvZiB0d28KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGNvbnRyYWN0IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2VucwogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgZnVuY3Rpb24gY2FsbCB3YXMgc3VjY2Vzc2Z1bAogICAgZnVuY3Rpb24gYXBwcm92ZUFuZENhbGwoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfYW1vdW50LCBieXRlcyBfZXh0cmFEYXRhCiAgICApIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUoYXBwcm92ZShfc3BlbmRlciwgX2Ftb3VudCkpOwoKICAgICAgICBBcHByb3ZlQW5kQ2FsbEZhbGxCYWNrKF9zcGVuZGVyKS5yZWNlaXZlQXBwcm92YWwoCiAgICAgICAgICAgIG1zZy5zZW5kZXIsCiAgICAgICAgICAgIF9hbW91bnQsCiAgICAgICAgICAgIHRoaXMsCiAgICAgICAgICAgIF9leHRyYURhdGEKICAgICAgICApOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBUaGlzIGZ1bmN0aW9uIG1ha2VzIGl0IGVhc3kgdG8gZ2V0IHRoZSB0b3RhbCBudW1iZXIgb2YgdG9rZW5zCiAgICAvLy8gQHJldHVybiBUaGUgdG90YWwgbnVtYmVyIG9mIHRva2VucwogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHRvdGFsU3VwcGx5QXQoYmxvY2subnVtYmVyKTsKICAgIH0KCgovLy8vLy8vLy8vLy8vLy8vCi8vIFF1ZXJ5IGJhbGFuY2UgYW5kIHRvdGFsU3VwcGx5IGluIEhpc3RvcnkKLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAZGV2IFF1ZXJpZXMgdGhlIGJhbGFuY2Ugb2YgYF9vd25lcmAgYXQgYSBzcGVjaWZpYyBgX2Jsb2NrTnVtYmVyYAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgZnJvbSB3aGljaCB0aGUgYmFsYW5jZSB3aWxsIGJlIHJldHJpZXZlZAogICAgLy8vIEBwYXJhbSBfYmxvY2tOdW1iZXIgVGhlIGJsb2NrIG51bWJlciB3aGVuIHRoZSBiYWxhbmNlIGlzIHF1ZXJpZWQKICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlIGF0IGBfYmxvY2tOdW1iZXJgCiAgICBmdW5jdGlvbiBiYWxhbmNlT2ZBdChhZGRyZXNzIF9vd25lciwgdWludCBfYmxvY2tOdW1iZXIpIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCkgewoKICAgICAgICAvLyBUaGVzZSBuZXh0IGZldyBsaW5lcyBhcmUgdXNlZCB3aGVuIHRoZSBiYWxhbmNlIG9mIHRoZSB0b2tlbiBpcwogICAgICAgIC8vICByZXF1ZXN0ZWQgYmVmb3JlIGEgY2hlY2sgcG9pbnQgd2FzIGV2ZXIgY3JlYXRlZCBmb3IgdGhpcyB0b2tlbiwgaXQKICAgICAgICAvLyAgcmVxdWlyZXMgdGhhdCB0aGUgYHBhcmVudFRva2VuLmJhbGFuY2VPZkF0YCBiZSBxdWVyaWVkIGF0IHRoZQogICAgICAgIC8vICBnZW5lc2lzIGJsb2NrIGZvciB0aGF0IHRva2VuIGFzIHRoaXMgY29udGFpbnMgaW5pdGlhbCBiYWxhbmNlIG9mCiAgICAgICAgLy8gIHRoaXMgdG9rZW4KICAgICAgICBpZiAoKGJhbGFuY2VzW19vd25lcl0ubGVuZ3RoID09IDApCiAgICAgICAgICAgIHx8IChiYWxhbmNlc1tfb3duZXJdWzBdLmZyb21CbG9jayA+IF9ibG9ja051bWJlcikpIHsKICAgICAgICAgICAgaWYgKGFkZHJlc3MocGFyZW50VG9rZW4pICE9IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwYXJlbnRUb2tlbi5iYWxhbmNlT2ZBdChfb3duZXIsIG1pbihfYmxvY2tOdW1iZXIsIHBhcmVudFNuYXBTaG90QmxvY2spKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEhhcyBubyBwYXJlbnQKICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICB9CgogICAgICAgIC8vIFRoaXMgd2lsbCByZXR1cm4gdGhlIGV4cGVjdGVkIGJhbGFuY2UgZHVyaW5nIG5vcm1hbCBzaXR1YXRpb25zCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGdldFZhbHVlQXQoYmFsYW5jZXNbX293bmVyXSwgX2Jsb2NrTnVtYmVyKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBub3RpY2UgVG90YWwgYW1vdW50IG9mIHRva2VucyBhdCBhIHNwZWNpZmljIGBfYmxvY2tOdW1iZXJgLgogICAgLy8vIEBwYXJhbSBfYmxvY2tOdW1iZXIgVGhlIGJsb2NrIG51bWJlciB3aGVuIHRoZSB0b3RhbFN1cHBseSBpcyBxdWVyaWVkCiAgICAvLy8gQHJldHVybiBUaGUgdG90YWwgYW1vdW50IG9mIHRva2VucyBhdCBgX2Jsb2NrTnVtYmVyYAogICAgZnVuY3Rpb24gdG90YWxTdXBwbHlBdCh1aW50IF9ibG9ja051bWJlcikgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7CgogICAgICAgIC8vIFRoZXNlIG5leHQgZmV3IGxpbmVzIGFyZSB1c2VkIHdoZW4gdGhlIHRvdGFsU3VwcGx5IG9mIHRoZSB0b2tlbiBpcwogICAgICAgIC8vICByZXF1ZXN0ZWQgYmVmb3JlIGEgY2hlY2sgcG9pbnQgd2FzIGV2ZXIgY3JlYXRlZCBmb3IgdGhpcyB0b2tlbiwgaXQKICAgICAgICAvLyAgcmVxdWlyZXMgdGhhdCB0aGUgYHBhcmVudFRva2VuLnRvdGFsU3VwcGx5QXRgIGJlIHF1ZXJpZWQgYXQgdGhlCiAgICAgICAgLy8gIGdlbmVzaXMgYmxvY2sgZm9yIHRoaXMgdG9rZW4gYXMgdGhhdCBjb250YWlucyB0b3RhbFN1cHBseSBvZiB0aGlzCiAgICAgICAgLy8gIHRva2VuIGF0IHRoaXMgYmxvY2sgbnVtYmVyLgogICAgICAgIGlmICgodG90YWxTdXBwbHlIaXN0b3J5Lmxlbmd0aCA9PSAwKQogICAgICAgICAgICB8fCAodG90YWxTdXBwbHlIaXN0b3J5WzBdLmZyb21CbG9jayA+IF9ibG9ja051bWJlcikpIHsKICAgICAgICAgICAgaWYgKGFkZHJlc3MocGFyZW50VG9rZW4pICE9IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwYXJlbnRUb2tlbi50b3RhbFN1cHBseUF0KG1pbihfYmxvY2tOdW1iZXIsIHBhcmVudFNuYXBTaG90QmxvY2spKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICB9CgogICAgICAgIC8vIFRoaXMgd2lsbCByZXR1cm4gdGhlIGV4cGVjdGVkIHRvdGFsU3VwcGx5IGR1cmluZyBub3JtYWwgc2l0dWF0aW9ucwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBnZXRWYWx1ZUF0KHRvdGFsU3VwcGx5SGlzdG9yeSwgX2Jsb2NrTnVtYmVyKTsKICAgICAgICB9CiAgICB9CgovLy8vLy8vLy8vLy8vLy8vCi8vIENsb25lIFRva2VuIE1ldGhvZAovLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgQ3JlYXRlcyBhIG5ldyBjbG9uZSB0b2tlbiB3aXRoIHRoZSBpbml0aWFsIGRpc3RyaWJ1dGlvbiBiZWluZwogICAgLy8vICB0aGlzIHRva2VuIGF0IGBfc25hcHNob3RCbG9ja2AKICAgIC8vLyBAcGFyYW0gX2Nsb25lVG9rZW5OYW1lIE5hbWUgb2YgdGhlIGNsb25lIHRva2VuCiAgICAvLy8gQHBhcmFtIF9jbG9uZURlY2ltYWxVbml0cyBOdW1iZXIgb2YgZGVjaW1hbHMgb2YgdGhlIHNtYWxsZXN0IHVuaXQKICAgIC8vLyBAcGFyYW0gX2Nsb25lVG9rZW5TeW1ib2wgU3ltYm9sIG9mIHRoZSBjbG9uZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfc25hcHNob3RCbG9jayBCbG9jayB3aGVuIHRoZSBkaXN0cmlidXRpb24gb2YgdGhlIHBhcmVudCB0b2tlbiBpcwogICAgLy8vICBjb3BpZWQgdG8gc2V0IHRoZSBpbml0aWFsIGRpc3RyaWJ1dGlvbiBvZiB0aGUgbmV3IGNsb25lIHRva2VuOwogICAgLy8vICBpZiB0aGUgYmxvY2sgaXMgemVybyB0aGFuIHRoZSBhY3R1YWwgYmxvY2ssIHRoZSBjdXJyZW50IGJsb2NrIGlzIHVzZWQKICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgVHJ1ZSBpZiB0cmFuc2ZlcnMgYXJlIGFsbG93ZWQgaW4gdGhlIGNsb25lCiAgICAvLy8gQHJldHVybiBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IE1pbmlNZVRva2VuIENvbnRyYWN0CiAgICBmdW5jdGlvbiBjcmVhdGVDbG9uZVRva2VuKAogICAgICAgIHN0cmluZyBfY2xvbmVUb2tlbk5hbWUsCiAgICAgICAgdWludDggX2Nsb25lRGVjaW1hbFVuaXRzLAogICAgICAgIHN0cmluZyBfY2xvbmVUb2tlblN5bWJvbCwKICAgICAgICB1aW50IF9zbmFwc2hvdEJsb2NrLAogICAgICAgIGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQKICAgICAgICApIHJldHVybnMoYWRkcmVzcykgewogICAgICAgIGlmIChfc25hcHNob3RCbG9jayA9PSAwKSBfc25hcHNob3RCbG9jayA9IGJsb2NrLm51bWJlcjsKICAgICAgICBNaW5pTWVUb2tlbiBjbG9uZVRva2VuID0gdG9rZW5GYWN0b3J5LmNyZWF0ZUNsb25lVG9rZW4oCiAgICAgICAgICAgIHRoaXMsCiAgICAgICAgICAgIF9zbmFwc2hvdEJsb2NrLAogICAgICAgICAgICBfY2xvbmVUb2tlbk5hbWUsCiAgICAgICAgICAgIF9jbG9uZURlY2ltYWxVbml0cywKICAgICAgICAgICAgX2Nsb25lVG9rZW5TeW1ib2wsCiAgICAgICAgICAgIF90cmFuc2ZlcnNFbmFibGVkCiAgICAgICAgICAgICk7CgogICAgICAgIGNsb25lVG9rZW4uY2hhbmdlQ29udHJvbGxlcihtc2cuc2VuZGVyKTsKCiAgICAgICAgLy8gQW4gZXZlbnQgdG8gbWFrZSB0aGUgdG9rZW4gZWFzeSB0byBmaW5kIG9uIHRoZSBibG9ja2NoYWluCiAgICAgICAgTmV3Q2xvbmVUb2tlbihhZGRyZXNzKGNsb25lVG9rZW4pLCBfc25hcHNob3RCbG9jayk7CiAgICAgICAgcmV0dXJuIGFkZHJlc3MoY2xvbmVUb2tlbik7CiAgICB9CgovLy8vLy8vLy8vLy8vLy8vCi8vIEdlbmVyYXRlIGFuZCBkZXN0cm95IHRva2VucwovLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgR2VuZXJhdGVzIGBfYW1vdW50YCB0b2tlbnMgdGhhdCBhcmUgYXNzaWduZWQgdG8gYF9vd25lcmAKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBiZSBhc3NpZ25lZCB0aGUgbmV3IHRva2VucwogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBxdWFudGl0eSBvZiB0b2tlbnMgZ2VuZXJhdGVkCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSB0b2tlbnMgYXJlIGdlbmVyYXRlZCBjb3JyZWN0bHkKICAgIGZ1bmN0aW9uIGdlbmVyYXRlVG9rZW5zKGFkZHJlc3MgX293bmVyLCB1aW50IF9hbW91bnQKICAgICkgb25seUNvbnRyb2xsZXIgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHVpbnQgY3VyVG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseSgpOwogICAgICAgIHJlcXVpcmUoY3VyVG90YWxTdXBwbHkgKyBfYW1vdW50ID49IGN1clRvdGFsU3VwcGx5KTsgLy8gQ2hlY2sgZm9yIG92ZXJmbG93CiAgICAgICAgdWludCBwcmV2aW91c0JhbGFuY2VUbyA9IGJhbGFuY2VPZihfb3duZXIpOwogICAgICAgIHJlcXVpcmUocHJldmlvdXNCYWxhbmNlVG8gKyBfYW1vdW50ID49IHByZXZpb3VzQmFsYW5jZVRvKTsgLy8gQ2hlY2sgZm9yIG92ZXJmbG93CiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyh0b3RhbFN1cHBseUhpc3RvcnksIGN1clRvdGFsU3VwcGx5ICsgX2Ftb3VudCk7CiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfb3duZXJdLCBwcmV2aW91c0JhbGFuY2VUbyArIF9hbW91bnQpOwogICAgICAgIFRyYW5zZmVyKDAsIF9vd25lciwgX2Ftb3VudCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgoKICAgIC8vLyBAbm90aWNlIEJ1cm5zIGBfYW1vdW50YCB0b2tlbnMgZnJvbSBgX293bmVyYAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIGxvc2UgdGhlIHRva2VucwogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBxdWFudGl0eSBvZiB0b2tlbnMgdG8gYnVybgogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdG9rZW5zIGFyZSBidXJuZWQgY29ycmVjdGx5CiAgICBmdW5jdGlvbiBkZXN0cm95VG9rZW5zKGFkZHJlc3MgX293bmVyLCB1aW50IF9hbW91bnQKICAgICkgb25seUNvbnRyb2xsZXIgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHVpbnQgY3VyVG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseSgpOwogICAgICAgIHJlcXVpcmUoY3VyVG90YWxTdXBwbHkgPj0gX2Ftb3VudCk7CiAgICAgICAgdWludCBwcmV2aW91c0JhbGFuY2VGcm9tID0gYmFsYW5jZU9mKF9vd25lcik7CiAgICAgICAgcmVxdWlyZShwcmV2aW91c0JhbGFuY2VGcm9tID49IF9hbW91bnQpOwogICAgICAgIHVwZGF0ZVZhbHVlQXROb3codG90YWxTdXBwbHlIaXN0b3J5LCBjdXJUb3RhbFN1cHBseSAtIF9hbW91bnQpOwogICAgICAgIHVwZGF0ZVZhbHVlQXROb3coYmFsYW5jZXNbX293bmVyXSwgcHJldmlvdXNCYWxhbmNlRnJvbSAtIF9hbW91bnQpOwogICAgICAgIFRyYW5zZmVyKF9vd25lciwgMCwgX2Ftb3VudCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgovLy8vLy8vLy8vLy8vLy8vCi8vIEVuYWJsZSB0b2tlbnMgdHJhbnNmZXJzCi8vLy8vLy8vLy8vLy8vLy8KCgogICAgLy8vIEBub3RpY2UgRW5hYmxlcyB0b2tlbiBob2xkZXJzIHRvIHRyYW5zZmVyIHRoZWlyIHRva2VucyBmcmVlbHkgaWYgdHJ1ZQogICAgLy8vIEBwYXJhbSBfdHJhbnNmZXJzRW5hYmxlZCBUcnVlIGlmIHRyYW5zZmVycyBhcmUgYWxsb3dlZCBpbiB0aGUgY2xvbmUKICAgIGZ1bmN0aW9uIGVuYWJsZVRyYW5zZmVycyhib29sIF90cmFuc2ZlcnNFbmFibGVkKSBvbmx5Q29udHJvbGxlciB7CiAgICAgICAgdHJhbnNmZXJzRW5hYmxlZCA9IF90cmFuc2ZlcnNFbmFibGVkOwogICAgfQoKLy8vLy8vLy8vLy8vLy8vLwovLyBJbnRlcm5hbCBoZWxwZXIgZnVuY3Rpb25zIHRvIHF1ZXJ5IGFuZCBzZXQgYSB2YWx1ZSBpbiBhIHNuYXBzaG90IGFycmF5Ci8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQGRldiBgZ2V0VmFsdWVBdGAgcmV0cmlldmVzIHRoZSBudW1iZXIgb2YgdG9rZW5zIGF0IGEgZ2l2ZW4gYmxvY2sgbnVtYmVyCiAgICAvLy8gQHBhcmFtIGNoZWNrcG9pbnRzIFRoZSBoaXN0b3J5IG9mIHZhbHVlcyBiZWluZyBxdWVyaWVkCiAgICAvLy8gQHBhcmFtIF9ibG9jayBUaGUgYmxvY2sgbnVtYmVyIHRvIHJldHJpZXZlIHRoZSB2YWx1ZSBhdAogICAgLy8vIEByZXR1cm4gVGhlIG51bWJlciBvZiB0b2tlbnMgYmVpbmcgcXVlcmllZAogICAgZnVuY3Rpb24gZ2V0VmFsdWVBdChDaGVja3BvaW50W10gc3RvcmFnZSBjaGVja3BvaW50cywgdWludCBfYmxvY2sKICAgICkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIGlmIChjaGVja3BvaW50cy5sZW5ndGggPT0gMCkgcmV0dXJuIDA7CgogICAgICAgIC8vIFNob3J0Y3V0IGZvciB0aGUgYWN0dWFsIHZhbHVlCiAgICAgICAgaWYgKF9ibG9jayA+PSBjaGVja3BvaW50c1tjaGVja3BvaW50cy5sZW5ndGgtMV0uZnJvbUJsb2NrKQogICAgICAgICAgICByZXR1cm4gY2hlY2twb2ludHNbY2hlY2twb2ludHMubGVuZ3RoLTFdLnZhbHVlOwogICAgICAgIGlmIChfYmxvY2sgPCBjaGVja3BvaW50c1swXS5mcm9tQmxvY2spIHJldHVybiAwOwoKICAgICAgICAvLyBCaW5hcnkgc2VhcmNoIG9mIHRoZSB2YWx1ZSBpbiB0aGUgYXJyYXkKICAgICAgICB1aW50IG1pbiA9IDA7CiAgICAgICAgdWludCBtYXggPSBjaGVja3BvaW50cy5sZW5ndGgtMTsKICAgICAgICB3aGlsZSAobWF4ID4gbWluKSB7CiAgICAgICAgICAgIHVpbnQgbWlkID0gKG1heCArIG1pbiArIDEpLyAyOwogICAgICAgICAgICBpZiAoY2hlY2twb2ludHNbbWlkXS5mcm9tQmxvY2s8PV9ibG9jaykgewogICAgICAgICAgICAgICAgbWluID0gbWlkOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbWF4ID0gbWlkLTE7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNoZWNrcG9pbnRzW21pbl0udmFsdWU7CiAgICB9CgogICAgLy8vIEBkZXYgYHVwZGF0ZVZhbHVlQXROb3dgIHVzZWQgdG8gdXBkYXRlIHRoZSBgYmFsYW5jZXNgIG1hcCBhbmQgdGhlCiAgICAvLy8gIGB0b3RhbFN1cHBseUhpc3RvcnlgCiAgICAvLy8gQHBhcmFtIGNoZWNrcG9pbnRzIFRoZSBoaXN0b3J5IG9mIGRhdGEgYmVpbmcgdXBkYXRlZAogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIG5ldyBudW1iZXIgb2YgdG9rZW5zCiAgICBmdW5jdGlvbiB1cGRhdGVWYWx1ZUF0Tm93KENoZWNrcG9pbnRbXSBzdG9yYWdlIGNoZWNrcG9pbnRzLCB1aW50IF92YWx1ZQogICAgKSBpbnRlcm5hbCAgewogICAgICAgIGlmICgoY2hlY2twb2ludHMubGVuZ3RoID09IDApCiAgICAgICAgfHwgKGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aCAtMV0uZnJvbUJsb2NrIDwgYmxvY2subnVtYmVyKSkgewogICAgICAgICAgICAgICBDaGVja3BvaW50IHN0b3JhZ2UgbmV3Q2hlY2tQb2ludCA9IGNoZWNrcG9pbnRzWyBjaGVja3BvaW50cy5sZW5ndGgrKyBdOwogICAgICAgICAgICAgICBuZXdDaGVja1BvaW50LmZyb21CbG9jayA9ICB1aW50MTI4KGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgICAgIG5ld0NoZWNrUG9pbnQudmFsdWUgPSB1aW50MTI4KF92YWx1ZSk7CiAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgQ2hlY2twb2ludCBzdG9yYWdlIG9sZENoZWNrUG9pbnQgPSBjaGVja3BvaW50c1tjaGVja3BvaW50cy5sZW5ndGgtMV07CiAgICAgICAgICAgICAgIG9sZENoZWNrUG9pbnQudmFsdWUgPSB1aW50MTI4KF92YWx1ZSk7CiAgICAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IEludGVybmFsIGZ1bmN0aW9uIHRvIGRldGVybWluZSBpZiBhbiBhZGRyZXNzIGlzIGEgY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX2FkZHIgVGhlIGFkZHJlc3MgYmVpbmcgcXVlcmllZAogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBgX2FkZHJgIGlzIGEgY29udHJhY3QKICAgIGZ1bmN0aW9uIGlzQ29udHJhY3QoYWRkcmVzcyBfYWRkcikgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyhib29sKSB7CiAgICAgICAgdWludCBzaXplOwogICAgICAgIGlmIChfYWRkciA9PSAwKSByZXR1cm4gZmFsc2U7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBzaXplIDo9IGV4dGNvZGVzaXplKF9hZGRyKQogICAgICAgIH0KICAgICAgICByZXR1cm4gc2l6ZT4wOwogICAgfQoKICAgIC8vLyBAZGV2IEhlbHBlciBmdW5jdGlvbiB0byByZXR1cm4gYSBtaW4gYmV0d2VuIHRoZSB0d28gdWludHMKICAgIGZ1bmN0aW9uIG1pbih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFRoZSBmYWxsYmFjayBmdW5jdGlvbjogSWYgdGhlIGNvbnRyYWN0J3MgY29udHJvbGxlciBoYXMgbm90IGJlZW4KICAgIC8vLyAgc2V0IHRvIDAsIHRoZW4gdGhlIGBwcm94eVBheW1lbnRgIG1ldGhvZCBpcyBjYWxsZWQgd2hpY2ggcmVsYXlzIHRoZQogICAgLy8vICBldGhlciBhbmQgY3JlYXRlcyB0b2tlbnMgYXMgZGVzY3JpYmVkIGluIHRoZSB0b2tlbiBjb250cm9sbGVyIGNvbnRyYWN0CiAgICBmdW5jdGlvbiAoKSAgcGF5YWJsZSB7CiAgICAgICAgcmVxdWlyZShpc0NvbnRyYWN0KGNvbnRyb2xsZXIpKTsKICAgICAgICByZXF1aXJlKFRva2VuQ29udHJvbGxlcihjb250cm9sbGVyKS5wcm94eVBheW1lbnQudmFsdWUobXNnLnZhbHVlKShtc2cuc2VuZGVyKSk7CiAgICB9CgovLy8vLy8vLy8vCi8vIFNhZmV0eSBNZXRob2RzCi8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBUaGlzIG1ldGhvZCBjYW4gYmUgdXNlZCBieSB0aGUgY29udHJvbGxlciB0byBleHRyYWN0IG1pc3Rha2VubHkKICAgIC8vLyAgc2VudCB0b2tlbnMgdG8gdGhpcyBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX3Rva2VuIFRoZSBhZGRyZXNzIG9mIHRoZSB0b2tlbiBjb250cmFjdCB0aGF0IHlvdSB3YW50IHRvIHJlY292ZXIKICAgIC8vLyAgc2V0IHRvIDAgaW4gY2FzZSB5b3Ugd2FudCB0byBleHRyYWN0IGV0aGVyLgogICAgZnVuY3Rpb24gY2xhaW1Ub2tlbnMoYWRkcmVzcyBfdG9rZW4pIG9ubHlDb250cm9sbGVyIHsKICAgICAgICBpZiAoX3Rva2VuID09IDB4MCkgewogICAgICAgICAgICBjb250cm9sbGVyLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIE1pbmlNZVRva2VuIHRva2VuID0gTWluaU1lVG9rZW4oX3Rva2VuKTsKICAgICAgICB1aW50IGJhbGFuY2UgPSB0b2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgICAgICAgdG9rZW4udHJhbnNmZXIoY29udHJvbGxlciwgYmFsYW5jZSk7CiAgICAgICAgQ2xhaW1lZFRva2VucyhfdG9rZW4sIGNvbnRyb2xsZXIsIGJhbGFuY2UpOwogICAgfQoKLy8vLy8vLy8vLy8vLy8vLwovLyBFdmVudHMKLy8vLy8vLy8vLy8vLy8vLwogICAgZXZlbnQgQ2xhaW1lZFRva2VucyhhZGRyZXNzIGluZGV4ZWQgX3Rva2VuLCBhZGRyZXNzIGluZGV4ZWQgX2NvbnRyb2xsZXIsIHVpbnQgX2Ftb3VudCk7CiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX2Ftb3VudCk7CiAgICBldmVudCBOZXdDbG9uZVRva2VuKGFkZHJlc3MgaW5kZXhlZCBfY2xvbmVUb2tlbiwgdWludCBfc25hcHNob3RCbG9jayk7CiAgICBldmVudCBBcHByb3ZhbCgKICAgICAgICBhZGRyZXNzIGluZGV4ZWQgX293bmVyLAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwKICAgICAgICB1aW50MjU2IF9hbW91bnQKICAgICAgICApOwoKfQoKY29udHJhY3QgTWluaU1lVG9rZW5GYWN0b3J5IHsKCiAgICAvLy8gQG5vdGljZSBVcGRhdGUgdGhlIERBcHAgYnkgY3JlYXRpbmcgYSBuZXcgdG9rZW4gd2l0aCBuZXcgZnVuY3Rpb25hbGl0aWVzCiAgICAvLy8gIHRoZSBtc2cuc2VuZGVyIGJlY29tZXMgdGhlIGNvbnRyb2xsZXIgb2YgdGhpcyBjbG9uZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfcGFyZW50VG9rZW4gQWRkcmVzcyBvZiB0aGUgdG9rZW4gYmVpbmcgY2xvbmVkCiAgICAvLy8gQHBhcmFtIF9zbmFwc2hvdEJsb2NrIEJsb2NrIG9mIHRoZSBwYXJlbnQgdG9rZW4gdGhhdCB3aWxsCiAgICAvLy8gIGRldGVybWluZSB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gb2YgdGhlIGNsb25lIHRva2VuCiAgICAvLy8gQHBhcmFtIF90b2tlbk5hbWUgTmFtZSBvZiB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF9kZWNpbWFsVW5pdHMgTnVtYmVyIG9mIGRlY2ltYWxzIG9mIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3Rva2VuU3ltYm9sIFRva2VuIFN5bWJvbCBmb3IgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfdHJhbnNmZXJzRW5hYmxlZCBJZiB0cnVlLCB0b2tlbnMgd2lsbCBiZSBhYmxlIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IHRva2VuIGNvbnRyYWN0CiAgICBmdW5jdGlvbiBjcmVhdGVDbG9uZVRva2VuKAogICAgICAgIGFkZHJlc3MgX3BhcmVudFRva2VuLAogICAgICAgIHVpbnQgX3NuYXBzaG90QmxvY2ssCiAgICAgICAgc3RyaW5nIF90b2tlbk5hbWUsCiAgICAgICAgdWludDggX2RlY2ltYWxVbml0cywKICAgICAgICBzdHJpbmcgX3Rva2VuU3ltYm9sLAogICAgICAgIGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQKICAgICkgcmV0dXJucyAoTWluaU1lVG9rZW4pIHsKICAgICAgICBNaW5pTWVUb2tlbiBuZXdUb2tlbiA9IG5ldyBNaW5pTWVUb2tlbigKICAgICAgICAgICAgdGhpcywKICAgICAgICAgICAgX3BhcmVudFRva2VuLAogICAgICAgICAgICBfc25hcHNob3RCbG9jaywKICAgICAgICAgICAgX3Rva2VuTmFtZSwKICAgICAgICAgICAgX2RlY2ltYWxVbml0cywKICAgICAgICAgICAgX3Rva2VuU3ltYm9sLAogICAgICAgICAgICBfdHJhbnNmZXJzRW5hYmxlZAogICAgICAgICAgICApOwoKICAgICAgICBuZXdUb2tlbi5jaGFuZ2VDb250cm9sbGVyKG1zZy5zZW5kZXIpOwogICAgICAgIHJldHVybiBuZXdUb2tlbjsKICAgIH0KfQoKY29udHJhY3QgTWluaU1lVmVzdGVkVG9rZW4gaXMgTWluaU1lVG9rZW4gewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwogIHVzaW5nIE1hdGggZm9yIHVpbnQ2NDsKCiAgc3RydWN0IFRva2VuR3JhbnQgewogICAgYWRkcmVzcyBncmFudGVyOyAgICAgLy8gMjAgYnl0ZXMKICAgIHVpbnQyNTYgdmFsdWU7ICAgICAgIC8vIDMyIGJ5dGVzCiAgICB1aW50NjQgY2xpZmY7CiAgICB1aW50NjQgdmVzdGluZzsKICAgIHVpbnQ2NCBzdGFydDsgICAgICAgIC8vIDMgKiA4ID0gMjQgYnl0ZXMKICAgIGJvb2wgcmV2b2thYmxlOwogICAgYm9vbCBidXJuc09uUmV2b2tlOyAgLy8gMiAqIDEgPSAyIGJpdHM/IG9yIDIgYnl0ZXM/CiAgfSAvLyB0b3RhbCA3OCBieXRlcyA9IDMgc3N0b3JlIHBlciBvcGVyYXRpb24gKDMyIHBlciBzc3RvcmUpCgogIGV2ZW50IE5ld1Rva2VuR3JhbnQoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSwgdWludDI1NiBncmFudElkKTsKCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBUb2tlbkdyYW50W10pIHB1YmxpYyBncmFudHM7CgogIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGNhbkNyZWF0ZUdyYW50czsKICBhZGRyZXNzIHB1YmxpYyB2ZXN0aW5nV2hpdGVsaXN0ZXI7CgogIG1vZGlmaWVyIGNhblRyYW5zZmVyKGFkZHJlc3MgX3NlbmRlciwgdWludCBfdmFsdWUpIHsKICAgIHJlcXVpcmUoc3BlbmRhYmxlQmFsYW5jZU9mKF9zZW5kZXIpID49IF92YWx1ZSk7CiAgICBfOwogIH0KCiAgbW9kaWZpZXIgb25seVZlc3RpbmdXaGl0ZWxpc3RlciB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gdmVzdGluZ1doaXRlbGlzdGVyKTsKICAgIF87CiAgfQoKICBmdW5jdGlvbiBNaW5pTWVWZXN0ZWRUb2tlbiAoCiAgICAgIGFkZHJlc3MgX3Rva2VuRmFjdG9yeSwKICAgICAgYWRkcmVzcyBfcGFyZW50VG9rZW4sCiAgICAgIHVpbnQgX3BhcmVudFNuYXBTaG90QmxvY2ssCiAgICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgICB1aW50OCBfZGVjaW1hbFVuaXRzLAogICAgICBzdHJpbmcgX3Rva2VuU3ltYm9sLAogICAgICBib29sIF90cmFuc2ZlcnNFbmFibGVkCiAgKSBwdWJsaWMKICAgIE1pbmlNZVRva2VuKF90b2tlbkZhY3RvcnksIF9wYXJlbnRUb2tlbiwgX3BhcmVudFNuYXBTaG90QmxvY2ssIF90b2tlbk5hbWUsIF9kZWNpbWFsVW5pdHMsIF90b2tlblN5bWJvbCwgX3RyYW5zZmVyc0VuYWJsZWQpIHsKICAgIHZlc3RpbmdXaGl0ZWxpc3RlciA9IG1zZy5zZW5kZXI7CiAgICBkb1NldENhbkNyZWF0ZUdyYW50cyh2ZXN0aW5nV2hpdGVsaXN0ZXIsIHRydWUpOwogIH0KCiAgLy8gQGRldiBBZGQgY2FuVHJhbnNmZXIgbW9kaWZpZXIgYmVmb3JlIGFsbG93aW5nIHRyYW5zZmVyIGFuZCB0cmFuc2ZlckZyb20gdG8gZ28gdGhyb3VnaAogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkKICAgICAgICAgICBwdWJsaWMKICAgICAgICAgICBjYW5UcmFuc2Zlcihtc2cuc2VuZGVyLCBfdmFsdWUpCiAgICAgICAgICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICByZXR1cm4gc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkKICAgICAgICAgICBwdWJsaWMKICAgICAgICAgICBjYW5UcmFuc2ZlcihfZnJvbSwgX3ZhbHVlKQogICAgICAgICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gc3BlbmRhYmxlQmFsYW5jZU9mKGFkZHJlc3MgX2hvbGRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiB0cmFuc2ZlcmFibGVUb2tlbnMoX2hvbGRlciwgdWludDY0KG5vdykpOyAvLyBzb2xoaW50LWRpc2FibGUgbm90LXJlbHktb24tdGltZQogIH0KCiAgLyoqCiAgICogQGRldiBHcmFudCB0b2tlbnMgdG8gYSBzcGVjaWZpZWQgYWRkcmVzcwogICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB0aGUgdG9rZW5zIHdpbGwgYmUgZ3JhbnRlZCB0by4KICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgZ3JhbnRlZC4KICAgKiBAcGFyYW0gX3N0YXJ0IHVpbnQ2NCBUaW1lIG9mIHRoZSBiZWdpbm5pbmcgb2YgdGhlIGdyYW50LgogICAqIEBwYXJhbSBfY2xpZmYgdWludDY0IFRpbWUgb2YgdGhlIGNsaWZmIHBlcmlvZC4KICAgKiBAcGFyYW0gX3Zlc3RpbmcgdWludDY0IFRoZSB2ZXN0aW5nIHBlcmlvZC4KICAgKi8KICBmdW5jdGlvbiBncmFudFZlc3RlZFRva2VucygKICAgIGFkZHJlc3MgX3RvLAogICAgdWludDI1NiBfdmFsdWUsCiAgICB1aW50NjQgX3N0YXJ0LAogICAgdWludDY0IF9jbGlmZiwKICAgIHVpbnQ2NCBfdmVzdGluZywKICAgIGJvb2wgX3Jldm9rYWJsZSwKICAgIGJvb2wgX2J1cm5zT25SZXZva2UKICApIHB1YmxpYyB7CiAgICAvLyBDaGVjayBzdGFydCwgY2xpZmYgYW5kIHZlc3RpbmcgYXJlIHByb3Blcmx5IG9yZGVyIHRvIGVuc3VyZSBjb3JyZWN0IGZ1bmN0aW9uYWxpdHkgb2YgdGhlIGZvcm11bGEuCiAgICByZXF1aXJlKF9jbGlmZiA+PSBfc3RhcnQpOwogICAgcmVxdWlyZShfdmVzdGluZyA+PSBfY2xpZmYpOwoKICAgIHJlcXVpcmUoY2FuQ3JlYXRlR3JhbnRzW21zZy5zZW5kZXJdKTsKICAgIHJlcXVpcmUodG9rZW5HcmFudHNDb3VudChfdG8pIDwgMjApOyAgIC8vIFRvIHByZXZlbnQgYSB1c2VyIGJlaW5nIHNwYW1tZWQgYW5kIGhhdmUgaGlzIGJhbGFuY2UgbG9ja2VkIChvdXQgb2YgZ2FzIGF0dGFjayB3aGVuIGNhbGN1bGF0aW5nIHZlc3RpbmcpLgoKICAgIFRva2VuR3JhbnQgbWVtb3J5IGdyYW50ID0gVG9rZW5HcmFudCgKICAgICAgX3Jldm9rYWJsZSA/IG1zZy5zZW5kZXIgOiAwLAogICAgICBfdmFsdWUsCiAgICAgIF9jbGlmZiwKICAgICAgX3Zlc3RpbmcsCiAgICAgIF9zdGFydCwKICAgICAgX3Jldm9rYWJsZSwKICAgICAgX2J1cm5zT25SZXZva2UKICAgICk7CgogICAgdWludDI1NiBjb3VudCA9IGdyYW50c1tfdG9dLnB1c2goZ3JhbnQpOwoKICAgIGFzc2VydCh0cmFuc2ZlcihfdG8sIF92YWx1ZSkpOwoKICAgIE5ld1Rva2VuR3JhbnQobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUsIGNvdW50IC0gMSk7CiAgfQoKICBmdW5jdGlvbiBzZXRDYW5DcmVhdGVHcmFudHMoYWRkcmVzcyBfYWRkciwgYm9vbCBfYWxsb3dlZCkKICAgICAgICAgICBwdWJsaWMgb25seVZlc3RpbmdXaGl0ZWxpc3RlciB7CiAgICBkb1NldENhbkNyZWF0ZUdyYW50cyhfYWRkciwgX2FsbG93ZWQpOwogIH0KCiAgZnVuY3Rpb24gY2hhbmdlVmVzdGluZ1doaXRlbGlzdGVyKGFkZHJlc3MgX25ld1doaXRlbGlzdGVyKSBwdWJsaWMgb25seVZlc3RpbmdXaGl0ZWxpc3RlciB7CiAgICByZXF1aXJlKF9uZXdXaGl0ZWxpc3RlciAhPSAwKTsKICAgIGRvU2V0Q2FuQ3JlYXRlR3JhbnRzKHZlc3RpbmdXaGl0ZWxpc3RlciwgZmFsc2UpOwogICAgdmVzdGluZ1doaXRlbGlzdGVyID0gX25ld1doaXRlbGlzdGVyOwogICAgZG9TZXRDYW5DcmVhdGVHcmFudHModmVzdGluZ1doaXRlbGlzdGVyLCB0cnVlKTsKICB9CgogIC8qKgogICAqIEBkZXYgUmV2b2tlIHRoZSBncmFudCBvZiB0b2tlbnMgb2YgYSBzcGVjaWZlZCBhZGRyZXNzLgogICAqIEBwYXJhbSBfaG9sZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgaGF2ZSBpdHMgdG9rZW5zIHJldm9rZWQuCiAgICogQHBhcmFtIF9yZWNlaXZlciBSZWNpcGllbnQgb2YgcmV2b2tlZCB0b2tlbnMuCiAgICogQHBhcmFtIF9ncmFudElkIFRoZSBpZCBvZiB0aGUgdG9rZW4gZ3JhbnQuCiAgICovCiAgZnVuY3Rpb24gcmV2b2tlVG9rZW5HcmFudChhZGRyZXNzIF9ob2xkZXIsIGFkZHJlc3MgX3JlY2VpdmVyLCB1aW50MjU2IF9ncmFudElkKSBwdWJsaWMgb25seVZlc3RpbmdXaGl0ZWxpc3RlciB7CiAgICByZXF1aXJlKF9yZWNlaXZlciAhPSAwKTsKCiAgICBUb2tlbkdyYW50IHN0b3JhZ2UgZ3JhbnQgPSBncmFudHNbX2hvbGRlcl1bX2dyYW50SWRdOwoKICAgIHJlcXVpcmUoZ3JhbnQucmV2b2thYmxlKTsKICAgIHJlcXVpcmUoZ3JhbnQuZ3JhbnRlciA9PSBtc2cuc2VuZGVyKTsgLy8gT25seSBncmFudGVyIGNhbiByZXZva2UgaXQKCiAgICBhZGRyZXNzIHJlY2VpdmVyID0gZ3JhbnQuYnVybnNPblJldm9rZSA/IDB4ZGVhZCA6IF9yZWNlaXZlcjsKCiAgICB1aW50MjU2IG5vblZlc3RlZCA9IG5vblZlc3RlZFRva2VucyhncmFudCwgdWludDY0KG5vdykpOwoKICAgIC8vIHJlbW92ZSBncmFudCBmcm9tIGFycmF5CiAgICBkZWxldGUgZ3JhbnRzW19ob2xkZXJdW19ncmFudElkXTsKICAgIGdyYW50c1tfaG9sZGVyXVtfZ3JhbnRJZF0gPSBncmFudHNbX2hvbGRlcl1bZ3JhbnRzW19ob2xkZXJdLmxlbmd0aC5zdWIoMSldOwogICAgZ3JhbnRzW19ob2xkZXJdLmxlbmd0aCAtPSAxOwoKICAgIGRvVHJhbnNmZXIoX2hvbGRlciwgcmVjZWl2ZXIsIG5vblZlc3RlZCk7CiAgfQoKICAvKioKICAgKiBAZGV2IENoZWNrIHRoZSBhbW91bnQgb2YgZ3JhbnRzIHRoYXQgYW4gYWRkcmVzcyBoYXMuCiAgICogQHBhcmFtIF9ob2xkZXIgVGhlIGhvbGRlciBvZiB0aGUgZ3JhbnRzLgogICAqIEByZXR1cm4gQSB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgdG90YWwgYW1vdW50IG9mIGdyYW50cy4KICAgKi8KICBmdW5jdGlvbiB0b2tlbkdyYW50c0NvdW50KGFkZHJlc3MgX2hvbGRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQgaW5kZXgpIHsKICAgIHJldHVybiBncmFudHNbX2hvbGRlcl0ubGVuZ3RoOwogIH0KCiAgLyoqCiAgICogQGRldiBHZXQgYWxsIGluZm9ybWF0aW9uIGFib3V0IGEgc3BlY2lmaWMgZ3JhbnQuCiAgICogQHBhcmFtIF9ob2xkZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBoYXZlIGl0cyB0b2tlbnMgcmV2b2tlZC4KICAgKiBAcGFyYW0gX2dyYW50SWQgVGhlIGlkIG9mIHRoZSB0b2tlbiBncmFudC4KICAgKiBAcmV0dXJuIFJldHVybnMgYWxsIHRoZSB2YWx1ZXMgdGhhdCByZXByZXNlbnQgYSBUb2tlbkdyYW50KGFkZHJlc3MsIHZhbHVlLCBzdGFydCwgY2xpZmYsCiAgICogcmV2b2thYmlsaXR5LCBidXJuc09uUmV2b2tlLCBhbmQgdmVzdGluZykgcGx1cyB0aGUgdmVzdGVkIHZhbHVlIGF0IHRoZSBjdXJyZW50IHRpbWUuCiAgICovCiAgZnVuY3Rpb24gdG9rZW5HcmFudChhZGRyZXNzIF9ob2xkZXIsIHVpbnQyNTYgX2dyYW50SWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzIGdyYW50ZXIsIHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgdmVzdGVkLCB1aW50NjQgc3RhcnQsIHVpbnQ2NCBjbGlmZiwgdWludDY0IHZlc3RpbmcsIGJvb2wgcmV2b2thYmxlLCBib29sIGJ1cm5zT25SZXZva2UpIHsKICAgIFRva2VuR3JhbnQgc3RvcmFnZSBncmFudCA9IGdyYW50c1tfaG9sZGVyXVtfZ3JhbnRJZF07CgogICAgZ3JhbnRlciA9IGdyYW50LmdyYW50ZXI7CiAgICB2YWx1ZSA9IGdyYW50LnZhbHVlOwogICAgc3RhcnQgPSBncmFudC5zdGFydDsKICAgIGNsaWZmID0gZ3JhbnQuY2xpZmY7CiAgICB2ZXN0aW5nID0gZ3JhbnQudmVzdGluZzsKICAgIHJldm9rYWJsZSA9IGdyYW50LnJldm9rYWJsZTsKICAgIGJ1cm5zT25SZXZva2UgPSBncmFudC5idXJuc09uUmV2b2tlOwoKICAgIHZlc3RlZCA9IHZlc3RlZFRva2VucyhncmFudCwgdWludDY0KG5vdykpOwogIH0KCiAgLy8gQGRldiBUaGUgZGF0ZSBpbiB3aGljaCBhbGwgdG9rZW5zIGFyZSB0cmFuc2ZlcmFibGUgZm9yIHRoZSBob2xkZXIKICAvLyBVc2VmdWwgZm9yIGRpc3BsYXlpbmcgcHVycG9zZXMgKG5vdCB1c2VkIGluIGFueSBsb2dpYyBjYWxjdWxhdGlvbnMpCiAgZnVuY3Rpb24gbGFzdFRva2VuSXNUcmFuc2ZlcmFibGVEYXRlKGFkZHJlc3MgaG9sZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDY0IGRhdGUpIHsKICAgIGRhdGUgPSB1aW50NjQobm93KTsKICAgIHVpbnQyNTYgZ3JhbnRJbmRleCA9IHRva2VuR3JhbnRzQ291bnQoaG9sZGVyKTsKICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IGdyYW50SW5kZXg7IGkrKykgewogICAgICBkYXRlID0gZ3JhbnRzW2hvbGRlcl1baV0udmVzdGluZy5tYXg2NChkYXRlKTsKICAgIH0KICAgIHJldHVybiBkYXRlOwogIH0KCiAgLy8gQGRldiBIb3cgbWFueSB0b2tlbnMgY2FuIGEgaG9sZGVyIHRyYW5zZmVyIGF0IGEgcG9pbnQgaW4gdGltZQogIGZ1bmN0aW9uIHRyYW5zZmVyYWJsZVRva2VucyhhZGRyZXNzIGhvbGRlciwgdWludDY0IHRpbWUpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGdyYW50SW5kZXggPSB0b2tlbkdyYW50c0NvdW50KGhvbGRlcik7CgogICAgaWYgKGdyYW50SW5kZXggPT0gMCkgcmV0dXJuIGJhbGFuY2VPZihob2xkZXIpOyAvLyBzaG9ydGN1dCBmb3IgaG9sZGVyIHdpdGhvdXQgZ3JhbnRzCgogICAgLy8gSXRlcmF0ZSB0aHJvdWdoIGFsbCB0aGUgZ3JhbnRzIHRoZSBob2xkZXIgaGFzLCBhbmQgYWRkIGFsbCBub24tdmVzdGVkIHRva2VucwogICAgdWludDI1NiBub25WZXN0ZWQgPSAwOwogICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgZ3JhbnRJbmRleDsgaSsrKSB7CiAgICAgIG5vblZlc3RlZCA9IG5vblZlc3RlZC5hZGQobm9uVmVzdGVkVG9rZW5zKGdyYW50c1tob2xkZXJdW2ldLCB0aW1lKSk7CiAgICB9CgogICAgLy8gQmFsYW5jZSAtIHRvdGFsTm9uVmVzdGVkIGlzIHRoZSBhbW91bnQgb2YgdG9rZW5zIGEgaG9sZGVyIGNhbiB0cmFuc2ZlciBhdCBhbnkgZ2l2ZW4gdGltZQogICAgcmV0dXJuIGJhbGFuY2VPZihob2xkZXIpLnN1Yihub25WZXN0ZWQpOwogIH0KCiAgZnVuY3Rpb24gZG9TZXRDYW5DcmVhdGVHcmFudHMoYWRkcmVzcyBfYWRkciwgYm9vbCBfYWxsb3dlZCkKICAgICAgICAgICBpbnRlcm5hbCB7CiAgICBjYW5DcmVhdGVHcmFudHNbX2FkZHJdID0gX2FsbG93ZWQ7CiAgfQoKICAvKioKICAgKiBAZGV2IENhbGN1bGF0ZSBhbW91bnQgb2YgdmVzdGVkIHRva2VucyBhdCBhIHNwZWNpZmljIHRpbWUKICAgKiBAcGFyYW0gdG9rZW5zIHVpbnQyNTYgVGhlIGFtb3VudCBvZiB0b2tlbnMgZ3JhbnRlZAogICAqIEBwYXJhbSB0aW1lIHVpbnQ2NCBUaGUgdGltZSB0byBiZSBjaGVja2VkCiAgICogQHBhcmFtIHN0YXJ0IHVpbnQ2NCBUaGUgdGltZSByZXByZXNlbnRpbmcgdGhlIGJlZ2lubmluZyBvZiB0aGUgZ3JhbnQKICAgKiBAcGFyYW0gY2xpZmYgdWludDY0ICBUaGUgY2xpZmYgcGVyaW9kLCB0aGUgcGVyaW9kIGJlZm9yZSBub3RoaW5nIGNhbiBiZSBwYWlkIG91dAogICAqIEBwYXJhbSB2ZXN0aW5nIHVpbnQ2NCBUaGUgdmVzdGluZyBwZXJpb2QKICAgKiBAcmV0dXJuIEFuIHVpbnQyNTYgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb2YgdmVzdGVkIHRva2VucyBvZiBhIHNwZWNpZmljIGdyYW50CiAgICogIHRyYW5zZmVyYWJsZVRva2VucwogICAqICAgfCAgICAgICAgICAgICAgICAgICAgICAgICBfLy0tLS0tLS0tICAgdmVzdGVkVG9rZW5zIHJlY3QKICAgKiAgIHwgICAgICAgICAgICAgICAgICAgICAgIF8vCiAgICogICB8ICAgICAgICAgICAgICAgICAgICAgXy8KICAgKiAgIHwgICAgICAgICAgICAgICAgICAgXy8KICAgKiAgIHwgICAgICAgICAgICAgICAgIF8vCiAgICogICB8ICAgICAgICAgICAgICAgIC8KICAgKiAgIHwgICAgICAgICAgICAgIC58CiAgICogICB8ICAgICAgICAgICAgLiAgfAogICAqICAgfCAgICAgICAgICAuICAgIHwKICAgKiAgIHwgICAgICAgIC4gICAgICB8CiAgICogICB8ICAgICAgLiAgICAgICAgfAogICAqICAgfCAgICAuICAgICAgICAgIHwKICAgKiAgICs9PT0rPT09PT09PT09PT0rLS0tLS0tLS0tKy0tLS0tLS0tLS0+IHRpbWUKICAgKiAgICAgIFN0YXJ0ICAgICAgIENsaWZmICAgIFZlc3RpbmcKICAgKi8KICBmdW5jdGlvbiBjYWxjdWxhdGVWZXN0ZWRUb2tlbnMoCiAgICB1aW50MjU2IHRva2VucywKICAgIHVpbnQyNTYgdGltZSwKICAgIHVpbnQyNTYgc3RhcnQsCiAgICB1aW50MjU2IGNsaWZmLAogICAgdWludDI1NiB2ZXN0aW5nKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KQogICAgewoKICAgIC8vIFNob3J0Y3V0cyBmb3IgYmVmb3JlIGNsaWZmIGFuZCBhZnRlciB2ZXN0aW5nIGNhc2VzLgogICAgaWYgKHRpbWUgPCBjbGlmZikgcmV0dXJuIDA7CiAgICBpZiAodGltZSA+PSB2ZXN0aW5nKSByZXR1cm4gdG9rZW5zOwoKICAgIC8vIEludGVycG9sYXRlIGFsbCB2ZXN0ZWQgdG9rZW5zLgogICAgLy8gQXMgYmVmb3JlIGNsaWZmIHRoZSBzaG9ydGN1dCByZXR1cm5zIDAsIHdlIGNhbiB1c2UganVzdCB0aGlzIGZ1bmN0aW9uIHRvCiAgICAvLyBjYWxjdWxhdGUgaXQuCgogICAgLy8gdmVzdGVkID0gdG9rZW5zICogKHRpbWUgLSBzdGFydCkgLyAodmVzdGluZyAtIHN0YXJ0KQogICAgdWludDI1NiB2ZXN0ZWQgPSB0b2tlbnMubXVsKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWUuc3ViKHN0YXJ0KQogICAgICAgICAgICAgICAgICAgICAgICAgICApLmRpdih2ZXN0aW5nLnN1YihzdGFydCkpOwoKICAgIHJldHVybiB2ZXN0ZWQ7CiAgfQoKICAvKioKICAgKiBAZGV2IENhbGN1bGF0ZSB0aGUgYW1vdW50IG9mIG5vbiB2ZXN0ZWQgdG9rZW5zIGF0IGEgc3BlY2lmaWMgdGltZS4KICAgKiBAcGFyYW0gZ3JhbnQgVG9rZW5HcmFudCBUaGUgZ3JhbnQgdG8gYmUgY2hlY2tlZC4KICAgKiBAcGFyYW0gdGltZSB1aW50NjQgVGhlIHRpbWUgdG8gYmUgY2hlY2tlZAogICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvZiBub24gdmVzdGVkIHRva2VucyBvZiBhIHNwZWNpZmljIGdyYW50IG9uIHRoZQogICAqIHBhc3NlZCB0aW1lIGZyYW1lLgogICAqLwogIGZ1bmN0aW9uIG5vblZlc3RlZFRva2VucyhUb2tlbkdyYW50IHN0b3JhZ2UgZ3JhbnQsIHVpbnQ2NCB0aW1lKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBPZiBhbGwgdGhlIHRva2VucyBvZiB0aGUgZ3JhbnQsIGhvdyBtYW55IG9mIHRoZW0gYXJlIG5vdCB2ZXN0ZWQ/CiAgICAvLyBncmFudFZhbHVlIC0gdmVzdGVkVG9rZW5zCiAgICByZXR1cm4gZ3JhbnQudmFsdWUuc3ViKHZlc3RlZFRva2VucyhncmFudCwgdGltZSkpOwogIH0KCiAgLyoqCiAgICogQGRldiBHZXQgdGhlIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIGF0IGEgc3BlY2lmaWMgdGltZS4KICAgKiBAcGFyYW0gZ3JhbnQgVG9rZW5HcmFudCBUaGUgZ3JhbnQgdG8gYmUgY2hlY2tlZC4KICAgKiBAcGFyYW0gdGltZSBUaGUgdGltZSB0byBiZSBjaGVja2VkCiAgICogQHJldHVybiBBbiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG9mIHZlc3RlZCB0b2tlbnMgb2YgYSBzcGVjaWZpYyBncmFudCBhdCBhIHNwZWNpZmljIHRpbWUuCiAgICovCiAgZnVuY3Rpb24gdmVzdGVkVG9rZW5zKFRva2VuR3JhbnQgZ3JhbnQsIHVpbnQ2NCB0aW1lKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBjYWxjdWxhdGVWZXN0ZWRUb2tlbnMoCiAgICAgIGdyYW50LnZhbHVlLAogICAgICB1aW50MjU2KHRpbWUpLAogICAgICB1aW50MjU2KGdyYW50LnN0YXJ0KSwKICAgICAgdWludDI1NihncmFudC5jbGlmZiksCiAgICAgIHVpbnQyNTYoZ3JhbnQudmVzdGluZykKICAgICk7CiAgfQp9Cgpjb250cmFjdCBCTFQgaXMgTWluaU1lVmVzdGVkVG9rZW4gewogIGZ1bmN0aW9uIEJMVChhZGRyZXNzIF90b2tlbkZhY3RvcnkpIHB1YmxpYyBNaW5pTWVWZXN0ZWRUb2tlbigKICAgIF90b2tlbkZhY3RvcnksCiAgICAweDAsICAgICAgICAgICAvLyBubyBwYXJlbnQgdG9rZW4KICAgIDAsICAgICAgICAgICAgIC8vIG5vIHNuYXBzaG90IGJsb2NrIG51bWJlciBmcm9tIHBhcmVudAogICAgIkJsb29tIFRva2VuIiwgLy8gVG9rZW4gbmFtZQogICAgMTgsICAgICAgICAgICAgLy8gRGVjaW1hbHMKICAgICJCTFQiLCAgICAgICAgIC8vIFN5bWJvbAogICAgdHJ1ZSAgICAgICAgICAgLy8gRW5hYmxlIHRyYW5zZmVycwogICkge30gLy8gc29saGludC1kaXNhYmxlLWxpbmUgbm8tZW1wdHktYmxvY2tzCn0='.
	

]
