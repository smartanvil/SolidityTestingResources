Class {
	#name : #SRTcadbdd55d5c7ae3bc199c64163369fd50477b73e,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTcadbdd55d5c7ae3bc199c64163369fd50477b73e >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7Cgpjb250cmFjdCBJR29sZCB7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gaXNzdWVUb2tlbnMoYWRkcmVzcyBfd2hvLCB1aW50IF90b2tlbnMpOwogICAgZnVuY3Rpb24gYnVyblRva2VucyhhZGRyZXNzIF93aG8sIHVpbnQgX3Rva2Vucyk7Cn0KCi8vIFN0ZFRva2VuIGluaGVyaXRhbmNlIGlzIGNvbW1lbnRlZCwgYmVjYXVzZSBubyAndG90YWxTdXBwbHknIG5lZWRlZApjb250cmFjdCBJTU5UUCB7IC8qaXMgU3RkVG9rZW4gKi8KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CgogICAgLy8gQWRkaXRpb25hbCBtZXRob2RzIHRoYXQgTU5UUCBjb250cmFjdCBwcm92aWRlcwogICAgZnVuY3Rpb24gbG9ja1RyYW5zZmVyKGJvb2wgX2xvY2spOwogICAgZnVuY3Rpb24gaXNzdWVUb2tlbnMoYWRkcmVzcyBfd2hvLCB1aW50IF90b2tlbnMpOwogICAgZnVuY3Rpb24gYnVyblRva2VucyhhZGRyZXNzIF93aG8sIHVpbnQgX3Rva2Vucyk7Cn0KCmNvbnRyYWN0IFNhZmVNYXRoIHsKICAgIGZ1bmN0aW9uIHNhZmVBZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICB1aW50IGMgPSBhICsgYjsKICAgICAgICBhc3NlcnQoYz49YSAmJiBjPj1iKTsKICAgICAgICByZXR1cm4gYzsKICAgICB9CgogICAgZnVuY3Rpb24gc2FmZVN1Yih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIGFzc2VydChiIDw9IGEpOwogICAgICAgIHJldHVybiBhIC0gYjsKICAgIH0KfQoKY29udHJhY3QgQ3JlYXRvckVuYWJsZWQgewogICAgYWRkcmVzcyBwdWJsaWMgY3JlYXRvciA9IDB4MDsKCiAgICBtb2RpZmllciBvbmx5Q3JlYXRvcigpIHsgcmVxdWlyZShtc2cuc2VuZGVyID09IGNyZWF0b3IpOyBfOyB9CgogICAgZnVuY3Rpb24gY2hhbmdlQ3JlYXRvcihhZGRyZXNzIF90bykgcHVibGljIG9ubHlDcmVhdG9yIHsKICAgICAgICBjcmVhdG9yID0gX3RvOwogICAgfQp9Cgpjb250cmFjdCBTdHJpbmdNb3ZlciB7CiAgICBmdW5jdGlvbiBzdHJpbmdUb0J5dGVzMzIoc3RyaW5nIHMpIGNvbnN0YW50IHJldHVybnMoYnl0ZXMzMil7CiAgICAgICAgYnl0ZXMzMiBvdXQ7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgb3V0IDo9IG1sb2FkKGFkZChzLCAzMikpCiAgICAgICAgfQogICAgICAgIHJldHVybiBvdXQ7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyaW5nVG9CeXRlczY0KHN0cmluZyBzKSBjb25zdGFudCByZXR1cm5zKGJ5dGVzMzIsYnl0ZXMzMil7CiAgICAgICAgYnl0ZXMzMiBvdXQ7CiAgICAgICAgYnl0ZXMzMiBvdXQyOwoKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICBvdXQgOj0gbWxvYWQoYWRkKHMsIDMyKSkKICAgICAgICAgICAgIG91dDIgOj0gbWxvYWQoYWRkKHMsIDY0KSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIChvdXQsb3V0Mik7CiAgICB9CgogICAgZnVuY3Rpb24gYnl0ZXMzMlRvU3RyaW5nKGJ5dGVzMzIgeCkgY29uc3RhbnQgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGJ5dGVzU3RyaW5nID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICB1aW50IGNoYXJDb3VudCA9IDA7CiAgICAgICAgZm9yICh1aW50IGogPSAwOyBqIDwgMzI7IGorKykgewogICAgICAgICAgICAgYnl0ZSBjaGFyID0gYnl0ZShieXRlczMyKHVpbnQoeCkgKiAyICoqICg4ICogaikpKTsKICAgICAgICAgICAgIGlmIChjaGFyICE9IDApIHsKICAgICAgICAgICAgICAgICAgYnl0ZXNTdHJpbmdbY2hhckNvdW50XSA9IGNoYXI7CiAgICAgICAgICAgICAgICAgIGNoYXJDb3VudCsrOwogICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBieXRlcyBtZW1vcnkgYnl0ZXNTdHJpbmdUcmltbWVkID0gbmV3IGJ5dGVzKGNoYXJDb3VudCk7CiAgICAgICAgZm9yIChqID0gMDsgaiA8IGNoYXJDb3VudDsgaisrKSB7CiAgICAgICAgICAgICBieXRlc1N0cmluZ1RyaW1tZWRbal0gPSBieXRlc1N0cmluZ1tqXTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN0cmluZyhieXRlc1N0cmluZ1RyaW1tZWQpOwogICAgfQoKICAgIGZ1bmN0aW9uIGJ5dGVzNjRUb1N0cmluZyhieXRlczMyIHgsIGJ5dGVzMzIgeSkgY29uc3RhbnQgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGJ5dGVzU3RyaW5nID0gbmV3IGJ5dGVzKDY0KTsKICAgICAgICB1aW50IGNoYXJDb3VudCA9IDA7CgogICAgICAgIGZvciAodWludCBqID0gMDsgaiA8IDMyOyBqKyspIHsKICAgICAgICAgICAgIGJ5dGUgY2hhciA9IGJ5dGUoYnl0ZXMzMih1aW50KHgpICogMiAqKiAoOCAqIGopKSk7CiAgICAgICAgICAgICBpZiAoY2hhciAhPSAwKSB7CiAgICAgICAgICAgICAgICAgIGJ5dGVzU3RyaW5nW2NoYXJDb3VudF0gPSBjaGFyOwogICAgICAgICAgICAgICAgICBjaGFyQ291bnQrKzsKICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZm9yIChqID0gMDsgaiA8IDMyOyBqKyspIHsKICAgICAgICAgICAgIGNoYXIgPSBieXRlKGJ5dGVzMzIodWludCh5KSAqIDIgKiogKDggKiBqKSkpOwogICAgICAgICAgICAgaWYgKGNoYXIgIT0gMCkgewogICAgICAgICAgICAgICAgICBieXRlc1N0cmluZ1tjaGFyQ291bnRdID0gY2hhcjsKICAgICAgICAgICAgICAgICAgY2hhckNvdW50Kys7CiAgICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBieXRlcyBtZW1vcnkgYnl0ZXNTdHJpbmdUcmltbWVkID0gbmV3IGJ5dGVzKGNoYXJDb3VudCk7CiAgICAgICAgZm9yIChqID0gMDsgaiA8IGNoYXJDb3VudDsgaisrKSB7CiAgICAgICAgICAgICBieXRlc1N0cmluZ1RyaW1tZWRbal0gPSBieXRlc1N0cmluZ1tqXTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN0cmluZyhieXRlc1N0cmluZ1RyaW1tZWQpOwogICAgfQp9CgoKY29udHJhY3QgU3RvcmFnZSBpcyBTYWZlTWF0aCwgU3RyaW5nTW92ZXIgewogICAgZnVuY3Rpb24gU3RvcmFnZSgpIHB1YmxpYyB7CiAgICAgICAgY29udHJvbGxlckFkZHJlc3MgPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIGFkZHJlc3MgcHVibGljIGNvbnRyb2xsZXJBZGRyZXNzID0gMHgwOwogICAgbW9kaWZpZXIgb25seUNvbnRyb2xsZXIoKSB7IHJlcXVpcmUobXNnLnNlbmRlcj09Y29udHJvbGxlckFkZHJlc3MpOyBfOyB9CgogICAgZnVuY3Rpb24gc2V0Q29udHJvbGxlckFkZHJlc3MoYWRkcmVzcyBfbmV3Q29udHJvbGxlcikgb25seUNvbnRyb2xsZXIgewogICAgICAgIGNvbnRyb2xsZXJBZGRyZXNzID0gX25ld0NvbnRyb2xsZXI7CiAgICB9CgogICAgYWRkcmVzcyBwdWJsaWMgaG90V2FsbGV0QWRkcmVzcyA9IDB4MDsKCiAgICBmdW5jdGlvbiBzZXRIb3RXYWxsZXRBZGRyZXNzKGFkZHJlc3MgX2FkZHJlc3MpIG9ubHlDb250cm9sbGVyIHsKICAgICAgIGhvdFdhbGxldEFkZHJlc3MgPSBfYWRkcmVzczsKICAgIH0KCgogICAgLy8gRmllbGRzIC0gMQogICAgbWFwcGluZyh1aW50ID0+IHN0cmluZykgZG9jczsKICAgIHVpbnQgcHVibGljIGRvY0NvdW50ID0gMDsKCiAgICAvLyBGaWVsZHMgLSAyCiAgICBtYXBwaW5nKHN0cmluZyA9PiBtYXBwaW5nKHVpbnQgPT4gaW50KSkgZmlhdFR4czsKICAgIG1hcHBpbmcoc3RyaW5nID0+IHVpbnQpIGZpYXRCYWxhbmNlc0NlbnRzOwogICAgbWFwcGluZyhzdHJpbmcgPT4gdWludCkgZmlhdFR4Q291bnRzOwogICAgdWludCBmaWF0VHhUb3RhbCA9IDA7CgogICAgLy8gRmllbGRzIC0gMwogICAgbWFwcGluZyhzdHJpbmcgPT4gbWFwcGluZyh1aW50ID0+IGludCkpIGdvbGRUeHM7CiAgICBtYXBwaW5nKHN0cmluZyA9PiB1aW50KSBnb2xkSG90QmFsYW5jZXM7CiAgICBtYXBwaW5nKHN0cmluZyA9PiB1aW50KSBnb2xkVHhDb3VudHM7CiAgICB1aW50IGdvbGRUeFRvdGFsID0gMDsKCiAgICAvLyBGaWVsZHMgLSA0CiAgICBzdHJ1Y3QgUmVxdWVzdCB7CiAgICAgICAgYWRkcmVzcyBzZW5kZXI7CiAgICAgICAgc3RyaW5nIHVzZXJJZDsKICAgICAgICBzdHJpbmcgcmVxdWVzdEhhc2g7CiAgICAgICAgYm9vbCBidXlSZXF1ZXN0OyAgICAgICAgIC8vIG90aGVyd2lzZSAtIHNlbGwKCiAgICAgICAgLy8gMCAtIGluaXQKICAgICAgICAvLyAxIC0gcHJvY2Vzc2VkCiAgICAgICAgLy8gMiAtIGNhbmNlbGxlZAogICAgICAgIHVpbnQ4IHN0YXRlOwogICAgfQoKICAgIG1hcHBpbmcgKHVpbnQ9PlJlcXVlc3QpIHJlcXVlc3RzOwogICAgdWludCBwdWJsaWMgcmVxdWVzdHNDb3VudCA9IDA7CgogICAgLy8vLy8vLwogICAgZnVuY3Rpb24gYWRkRG9jKHN0cmluZyBfaXBmc0RvY0xpbmspIHB1YmxpYyBvbmx5Q29udHJvbGxlciByZXR1cm5zKHVpbnQpIHsKICAgICAgICBkb2NzW2RvY0NvdW50XSA9IF9pcGZzRG9jTGluazsKICAgICAgICB1aW50IG91dCA9IGRvY0NvdW50OwogICAgICAgIGRvY0NvdW50Kys7CgogICAgICAgIHJldHVybiBvdXQ7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0RG9jQ291bnQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBkb2NDb3VudDsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXREb2NBc0J5dGVzNjQodWludCBfaW5kZXgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChieXRlczMyLGJ5dGVzMzIpIHsKICAgICAgICByZXF1aXJlKF9pbmRleCA8IGRvY0NvdW50KTsKICAgICAgICByZXR1cm4gc3RyaW5nVG9CeXRlczY0KGRvY3NbX2luZGV4XSk7CiAgICB9CgogICAgZnVuY3Rpb24gYWRkRmlhdFRyYW5zYWN0aW9uKHN0cmluZyBfdXNlcklkLCBpbnQgX2Ftb3VudENlbnRzKSBwdWJsaWMgb25seUNvbnRyb2xsZXIgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmVxdWlyZSgwICE9IF9hbW91bnRDZW50cyk7CgogICAgICAgIHVpbnQgYyA9IGZpYXRUeENvdW50c1tfdXNlcklkXTsKCiAgICAgICAgZmlhdFR4c1tfdXNlcklkXVtjXSA9IF9hbW91bnRDZW50czsKCiAgICAgICAgaWYgKF9hbW91bnRDZW50cyA+IDApIHsKICAgICAgICAgICAgZmlhdEJhbGFuY2VzQ2VudHNbX3VzZXJJZF0gPSBzYWZlQWRkKGZpYXRCYWxhbmNlc0NlbnRzW191c2VySWRdLCB1aW50KF9hbW91bnRDZW50cykpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGZpYXRCYWxhbmNlc0NlbnRzW191c2VySWRdID0gc2FmZVN1YihmaWF0QmFsYW5jZXNDZW50c1tfdXNlcklkXSwgdWludCgtX2Ftb3VudENlbnRzKSk7CiAgICAgICAgfQoKICAgICAgICBmaWF0VHhDb3VudHNbX3VzZXJJZF0gPSBzYWZlQWRkKGZpYXRUeENvdW50c1tfdXNlcklkXSwgMSk7CgogICAgICAgIGZpYXRUeFRvdGFsKys7CiAgICAgICAgcmV0dXJuIGM7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0RmlhdFRyYW5zYWN0aW9uc0NvdW50KHN0cmluZyBfdXNlcklkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBmaWF0VHhDb3VudHNbX3VzZXJJZF07CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0QWxsRmlhdFRyYW5zYWN0aW9uc0NvdW50KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gZmlhdFR4VG90YWw7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0RmlhdFRyYW5zYWN0aW9uKHN0cmluZyBfdXNlcklkLCB1aW50IF9pbmRleCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoaW50KSB7CiAgICAgICAgcmVxdWlyZShfaW5kZXggPCBmaWF0VHhDb3VudHNbX3VzZXJJZF0pOwogICAgICAgIHJldHVybiBmaWF0VHhzW191c2VySWRdW19pbmRleF07CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VXNlckZpYXRCYWxhbmNlKHN0cmluZyBfdXNlcklkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmV0dXJuIGZpYXRCYWxhbmNlc0NlbnRzW191c2VySWRdOwogICAgfQoKICAgIGZ1bmN0aW9uIGFkZEdvbGRUcmFuc2FjdGlvbihzdHJpbmcgX3VzZXJJZCwgaW50IF9hbW91bnQpIHB1YmxpYyBvbmx5Q29udHJvbGxlciByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXF1aXJlKDAgIT0gX2Ftb3VudCk7CgogICAgICAgIHVpbnQgYyA9IGdvbGRUeENvdW50c1tfdXNlcklkXTsKCiAgICAgICAgZ29sZFR4c1tfdXNlcklkXVtjXSA9IF9hbW91bnQ7CgogICAgICAgIGlmIChfYW1vdW50ID4gMCkgewogICAgICAgICAgICBnb2xkSG90QmFsYW5jZXNbX3VzZXJJZF0gPSBzYWZlQWRkKGdvbGRIb3RCYWxhbmNlc1tfdXNlcklkXSwgdWludChfYW1vdW50KSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZ29sZEhvdEJhbGFuY2VzW191c2VySWRdID0gc2FmZVN1Yihnb2xkSG90QmFsYW5jZXNbX3VzZXJJZF0sIHVpbnQoLV9hbW91bnQpKTsKICAgICAgICB9CgogICAgICAgIGdvbGRUeENvdW50c1tfdXNlcklkXSA9IHNhZmVBZGQoZ29sZFR4Q291bnRzW191c2VySWRdLCAxKTsKCiAgICAgICAgZ29sZFR4VG90YWwrKzsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRHb2xkVHJhbnNhY3Rpb25zQ291bnQoc3RyaW5nIF91c2VySWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGdvbGRUeENvdW50c1tfdXNlcklkXTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRBbGxHb2xkVHJhbnNhY3Rpb25zQ291bnQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBnb2xkVHhUb3RhbDsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRHb2xkVHJhbnNhY3Rpb24oc3RyaW5nIF91c2VySWQsIHVpbnQgX2luZGV4KSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhpbnQpIHsKICAgICAgICByZXF1aXJlKF9pbmRleCA8IGdvbGRUeENvdW50c1tfdXNlcklkXSk7CiAgICAgICAgcmV0dXJuIGdvbGRUeHNbX3VzZXJJZF1bX2luZGV4XTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRVc2VySG90R29sZEJhbGFuY2Uoc3RyaW5nIF91c2VySWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXR1cm4gZ29sZEhvdEJhbGFuY2VzW191c2VySWRdOwogICAgfQoKICAgIGZ1bmN0aW9uIGFkZEJ1eVRva2Vuc1JlcXVlc3QoYWRkcmVzcyBfd2hvLCBzdHJpbmcgX3VzZXJJZCwgc3RyaW5nIF9yZXF1ZXN0SGFzaCkgcHVibGljIG9ubHlDb250cm9sbGVyIHJldHVybnModWludCkgewogICAgICAgIFJlcXVlc3QgbWVtb3J5IHI7CiAgICAgICAgci5zZW5kZXIgPSBfd2hvOwogICAgICAgIHIudXNlcklkID0gX3VzZXJJZDsKICAgICAgICByLnJlcXVlc3RIYXNoID0gX3JlcXVlc3RIYXNoOwogICAgICAgIHIuYnV5UmVxdWVzdCA9IHRydWU7CiAgICAgICAgci5zdGF0ZSA9IDA7CgogICAgICAgIHJlcXVlc3RzW3JlcXVlc3RzQ291bnRdID0gcjsKICAgICAgICB1aW50IG91dCA9IHJlcXVlc3RzQ291bnQ7CiAgICAgICAgcmVxdWVzdHNDb3VudCsrOwogICAgICAgIHJldHVybiBvdXQ7CiAgICB9CgogICAgZnVuY3Rpb24gYWRkU2VsbFRva2Vuc1JlcXVlc3QoYWRkcmVzcyBfd2hvLCBzdHJpbmcgX3VzZXJJZCwgc3RyaW5nIF9yZXF1ZXN0SGFzaCkgb25seUNvbnRyb2xsZXIgcmV0dXJucyh1aW50KSB7CiAgICAgICAgUmVxdWVzdCBtZW1vcnkgcjsKICAgICAgICByLnNlbmRlciA9IF93aG87CiAgICAgICAgci51c2VySWQgPSBfdXNlcklkOwogICAgICAgIHIucmVxdWVzdEhhc2ggPSBfcmVxdWVzdEhhc2g7CiAgICAgICAgci5idXlSZXF1ZXN0ID0gZmFsc2U7CiAgICAgICAgci5zdGF0ZSA9IDA7CgogICAgICAgIHJlcXVlc3RzW3JlcXVlc3RzQ291bnRdID0gcjsKICAgICAgICB1aW50IG91dCA9IHJlcXVlc3RzQ291bnQ7CiAgICAgICAgcmVxdWVzdHNDb3VudCsrOwogICAgICAgIHJldHVybiBvdXQ7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0UmVxdWVzdHNDb3VudCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXR1cm4gcmVxdWVzdHNDb3VudDsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRSZXF1ZXN0KHVpbnQgX2luZGV4KSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucygKICAgICAgICBhZGRyZXNzIGEsCiAgICAgICAgYnl0ZXMzMiB1c2VySWQsCiAgICAgICAgYnl0ZXMzMiBoYXNoQSwgYnl0ZXMzMiBoYXNoQiwKICAgICAgICBib29sIGJ1eSwgdWludDggc3RhdGUpCiAgICB7CiAgICAgICAgcmVxdWlyZShfaW5kZXggPCByZXF1ZXN0c0NvdW50KTsKCiAgICAgICAgUmVxdWVzdCBtZW1vcnkgciA9IHJlcXVlc3RzW19pbmRleF07CgogICAgICAgIGJ5dGVzMzIgdXNlckJ5dGVzID0gc3RyaW5nVG9CeXRlczMyKHIudXNlcklkKTsKICAgICAgICB2YXIgKG91dDEsIG91dDIpID0gc3RyaW5nVG9CeXRlczY0KHIucmVxdWVzdEhhc2gpOwoKICAgICAgICByZXR1cm4gKHIuc2VuZGVyLCB1c2VyQnl0ZXMsIG91dDEsIG91dDIsIHIuYnV5UmVxdWVzdCwgci5zdGF0ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gY2FuY2VsUmVxdWVzdCh1aW50IF9pbmRleCkgb25seUNvbnRyb2xsZXIgcHVibGljIHsKICAgICAgICByZXF1aXJlKF9pbmRleCA8IHJlcXVlc3RzQ291bnQpOwogICAgICAgIHJlcXVpcmUoMD09cmVxdWVzdHNbX2luZGV4XS5zdGF0ZSk7CgogICAgICAgIHJlcXVlc3RzW19pbmRleF0uc3RhdGUgPSAyOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldFJlcXVlc3RQcm9jZXNzZWQodWludCBfaW5kZXgpIG9ubHlDb250cm9sbGVyIHB1YmxpYyB7CiAgICAgICAgcmVxdWVzdHNbX2luZGV4XS5zdGF0ZSA9IDE7CiAgICB9Cn0KCmNvbnRyYWN0IEdvbGRGaWF0RmVlIGlzIENyZWF0b3JFbmFibGVkLCBTdHJpbmdNb3ZlciB7CiAgICBzdHJpbmcgZ21Vc2VySWQgPSAiIjsKCiAgICAvLyBGdW5jdGlvbnM6CiAgICBmdW5jdGlvbiBHb2xkRmlhdEZlZShzdHJpbmcgX2dtVXNlcklkKSB7CiAgICAgICAgY3JlYXRvciA9IG1zZy5zZW5kZXI7CiAgICAgICAgZ21Vc2VySWQgPSBfZ21Vc2VySWQ7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0R29sZG1pbnRGZWVBY2NvdW50KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoYnl0ZXMzMikgewogICAgICAgIGJ5dGVzMzIgdXNlckJ5dGVzID0gc3RyaW5nVG9CeXRlczMyKGdtVXNlcklkKTsKICAgICAgICByZXR1cm4gdXNlckJ5dGVzOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldEdvbGRtaW50RmVlQWNjb3VudChzdHJpbmcgX2dtVXNlcklkKSBwdWJsaWMgb25seUNyZWF0b3IgewogICAgICAgIGdtVXNlcklkID0gX2dtVXNlcklkOwogICAgfQoKICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZUJ1eUdvbGRGZWUodWludCBfbW50cEJhbGFuY2UsIHVpbnQgX2dvbGRWYWx1ZSkgcHVibGljIGNvbnN0YW50IHJldHVybnModWludCkgewogICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZVNlbGxHb2xkRmVlKHVpbnQgX21udHBCYWxhbmNlLCB1aW50IF9nb2xkVmFsdWUpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsKICAgICAgICAvLyBJZiB0aGUgc2VuZGVyIGhvbGRzIDAgTU5UUCwgdGhlbiB0aGUgdHJhbnNhY3Rpb24gZmVlIGlzIDMlIGZpYXQsCiAgICAgICAgLy8gSWYgdGhlIHNlbmRlciBob2xkcyBhdCBsZWFzdCAxMCBNTlRQLCB0aGVuIHRoZSB0cmFuc2FjdGlvbiBmZWUgaXMgMiUgZmlhdCwKICAgICAgICAvLyBJZiB0aGUgc2VuZGVyIGhvbGRzIGF0IGxlYXN0IDEwMDAgTU5UUCwgdGhlbiB0aGUgdHJhbnNhY3Rpb24gZmVlIGlzIDEuNSUgZmlhdCwKICAgICAgICAvLyBJZiB0aGUgc2VuZGVyIGhvbGRzIGF0IGxlYXN0IDEwMDAwIE1OVFAsIHRoZW4gdGhlIHRyYW5zYWN0aW9uIGZlZSBpcyAxJSBmaWF0LAogICAgICAgIGlmIChfbW50cEJhbGFuY2UgPj0gKDEwMDAwICogMSBldGhlcikpIHsKICAgICAgICAgICAgIHJldHVybiAoNzUgKiBfZ29sZFZhbHVlIC8gMTAwMDApOwogICAgICAgIH0KCiAgICAgICAgaWYgKF9tbnRwQmFsYW5jZSA+PSAoMTAwMCAqIDEgZXRoZXIpKSB7CiAgICAgICAgICAgICByZXR1cm4gKDE1ICogX2dvbGRWYWx1ZSAvIDEwMDApOwogICAgICAgIH0KCiAgICAgICAgaWYgKF9tbnRwQmFsYW5jZSA+PSAoMTAgKiAxIGV0aGVyKSkgewogICAgICAgICAgICAgcmV0dXJuICgyNSAqIF9nb2xkVmFsdWUgLyAxMDAwKTsKICAgICAgICB9CgogICAgICAgIC8vIDMlCiAgICAgICAgcmV0dXJuICgzICogX2dvbGRWYWx1ZSAvIDEwMCk7CiAgICB9Cn0KCmNvbnRyYWN0IElHb2xkRmlhdEZlZSB7CiAgICBmdW5jdGlvbiBnZXRHb2xkbWludEZlZUFjY291bnQoKXB1YmxpYyBjb25zdGFudCByZXR1cm5zKGJ5dGVzMzIpOwogICAgZnVuY3Rpb24gY2FsY3VsYXRlQnV5R29sZEZlZSh1aW50IF9tbnRwQmFsYW5jZSwgdWludCBfZ29sZFZhbHVlKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyh1aW50KTsKICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZVNlbGxHb2xkRmVlKHVpbnQgX21udHBCYWxhbmNlLCB1aW50IF9nb2xkVmFsdWUpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQpOwp9Cgpjb250cmFjdCBTdG9yYWdlQ29udHJvbGxlciBpcyBTYWZlTWF0aCwgQ3JlYXRvckVuYWJsZWQsIFN0cmluZ01vdmVyIHsKICAgIFN0b3JhZ2UgcHVibGljIHN0b3I7CiAgICBJTU5UUCBwdWJsaWMgbW50cFRva2VuOwogICAgSUdvbGQgcHVibGljIGdvbGRUb2tlbjsKICAgIElHb2xkRmlhdEZlZSBwdWJsaWMgZmlhdEZlZTsKCiAgICBhZGRyZXNzIHB1YmxpYyBldGhEZXBvc2l0QWRkcmVzcyA9IDB4MDsKICAgIGFkZHJlc3MgcHVibGljIG1hbmFnZXJBZGRyZXNzID0gMHgwOwoKICAgIGV2ZW50IE5ld1Rva2VuQnV5UmVxdWVzdChhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIHN0cmluZyBpbmRleGVkIF91c2VySWQpOwogICAgZXZlbnQgTmV3VG9rZW5TZWxsUmVxdWVzdChhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIHN0cmluZyBpbmRleGVkIF91c2VySWQpOwogICAgZXZlbnQgUmVxdWVzdENhbmNlbGxlZCh1aW50IGluZGV4ZWQgX3JlcUlkKTsKICAgIGV2ZW50IFJlcXVlc3RQcm9jZXNzZWQodWludCBpbmRleGVkIF9yZXFJZCk7CiAgICBldmVudCBFdGhEZXBvc2l0ZWQodWludCBpbmRleGVkIF9yZXF1ZXN0SWQsIGFkZHJlc3MgaW5kZXhlZCBfYWRkcmVzcywgdWludCBfZXRoVmFsdWUpOwoKICAgIG1vZGlmaWVyIG9ubHlNYW5hZ2VyT3JDcmVhdG9yKCkgeyByZXF1aXJlKG1zZy5zZW5kZXIgPT0gbWFuYWdlckFkZHJlc3MgfHwgbXNnLnNlbmRlciA9PSBjcmVhdG9yKTsgXzsgfQoKICAgIGZ1bmN0aW9uIFN0b3JhZ2VDb250cm9sbGVyKGFkZHJlc3MgX21udHBDb250cmFjdEFkZHJlc3MsIGFkZHJlc3MgX2dvbGRDb250cmFjdEFkZHJlc3MsIGFkZHJlc3MgX3N0b3JhZ2VBZGRyZXNzLCBhZGRyZXNzIF9maWF0RmVlQ29udHJhY3QpIHsKICAgICAgICBjcmVhdG9yID0gbXNnLnNlbmRlcjsKCiAgICAgICAgaWYgKDAgIT0gX3N0b3JhZ2VBZGRyZXNzKSB7CiAgICAgICAgICAgICAvLyB1c2UgZXhpc3Rpbmcgc3RvcmFnZQogICAgICAgICAgICAgc3RvciA9IFN0b3JhZ2UoX3N0b3JhZ2VBZGRyZXNzKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgc3RvciA9IG5ldyBTdG9yYWdlKCk7CiAgICAgICAgfQoKICAgICAgICByZXF1aXJlKDB4MCE9X21udHBDb250cmFjdEFkZHJlc3MpOwogICAgICAgIHJlcXVpcmUoMHgwIT1fZ29sZENvbnRyYWN0QWRkcmVzcyk7CiAgICAgICAgcmVxdWlyZSgweDAhPV9maWF0RmVlQ29udHJhY3QpOwoKICAgICAgICBtbnRwVG9rZW4gPSBJTU5UUChfbW50cENvbnRyYWN0QWRkcmVzcyk7CiAgICAgICAgZ29sZFRva2VuID0gSUdvbGQoX2dvbGRDb250cmFjdEFkZHJlc3MpOwogICAgICAgIGZpYXRGZWUgPSBJR29sZEZpYXRGZWUoX2ZpYXRGZWVDb250cmFjdCk7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0RXRoRGVwb3NpdEFkZHJlc3MoYWRkcmVzcyBfYWRkcmVzcykgcHVibGljIG9ubHlDcmVhdG9yIHsKICAgICAgIGV0aERlcG9zaXRBZGRyZXNzID0gX2FkZHJlc3M7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0TWFuYWdlckFkZHJlc3MoYWRkcmVzcyBfYWRkcmVzcykgcHVibGljIG9ubHlDcmVhdG9yIHsKICAgICAgIG1hbmFnZXJBZGRyZXNzID0gX2FkZHJlc3M7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0RXRoRGVwb3NpdEFkZHJlc3MoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcykgewogICAgICAgcmV0dXJuIGV0aERlcG9zaXRBZGRyZXNzOwogICAgfQoKICAgIC8vIE9ubHkgb2xkIGNvbnRyb2xsZXIgY2FuIGNhbGwgc2V0Q29udHJvbGxlckFkZHJlc3MKICAgIGZ1bmN0aW9uIGNoYW5nZUNvbnRyb2xsZXIoYWRkcmVzcyBfbmV3Q29udHJvbGxlcikgcHVibGljIG9ubHlDcmVhdG9yIHsKICAgICAgICBzdG9yLnNldENvbnRyb2xsZXJBZGRyZXNzKF9uZXdDb250cm9sbGVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRIb3RXYWxsZXRBZGRyZXNzKGFkZHJlc3MgX2hvdFdhbGxldEFkZHJlc3MpIHB1YmxpYyBvbmx5Q3JlYXRvciB7CiAgICAgICBzdG9yLnNldEhvdFdhbGxldEFkZHJlc3MoX2hvdFdhbGxldEFkZHJlc3MpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEhvdFdhbGxldEFkZHJlc3MoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcykgewogICAgICAgIHJldHVybiBzdG9yLmhvdFdhbGxldEFkZHJlc3MoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjaGFuZ2VGaWF0RmVlQ29udHJhY3QoYWRkcmVzcyBfbmV3RmlhdEZlZSkgcHVibGljIG9ubHlDcmVhdG9yIHsKICAgICAgICBmaWF0RmVlID0gSUdvbGRGaWF0RmVlKF9uZXdGaWF0RmVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBhZGREb2Moc3RyaW5nIF9pcGZzRG9jTGluaykgcHVibGljIG9ubHlDcmVhdG9yIHJldHVybnModWludCkgewogICAgICAgIHJldHVybiBzdG9yLmFkZERvYyhfaXBmc0RvY0xpbmspOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldERvY0NvdW50KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gc3Rvci5kb2NDb3VudCgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldERvYyh1aW50IF9pbmRleCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHN0cmluZykgewogICAgICAgIHZhciAoeCwgeSkgPSBzdG9yLmdldERvY0FzQnl0ZXM2NChfaW5kZXgpOwogICAgICAgIHJldHVybiBieXRlczY0VG9TdHJpbmcoeCx5KTsKICAgIH0KCgogICAgLy8gX2Ftb3VudENlbnRzIGNhbiBiZSBuZWdhdGl2ZQogICAgLy8gcmV0dXJucyBpbmRleCBpbiB1c2VyIGFycmF5CiAgICBmdW5jdGlvbiBhZGRGaWF0VHJhbnNhY3Rpb24oc3RyaW5nIF91c2VySWQsIGludCBfYW1vdW50Q2VudHMpIHB1YmxpYyBvbmx5TWFuYWdlck9yQ3JlYXRvciByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXR1cm4gc3Rvci5hZGRGaWF0VHJhbnNhY3Rpb24oX3VzZXJJZCwgX2Ftb3VudENlbnRzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRGaWF0VHJhbnNhY3Rpb25zQ291bnQoc3RyaW5nIF91c2VySWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHN0b3IuZ2V0RmlhdFRyYW5zYWN0aW9uc0NvdW50KF91c2VySWQpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEFsbEZpYXRUcmFuc2FjdGlvbnNDb3VudCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHN0b3IuZ2V0QWxsRmlhdFRyYW5zYWN0aW9uc0NvdW50KCk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0RmlhdFRyYW5zYWN0aW9uKHN0cmluZyBfdXNlcklkLCB1aW50IF9pbmRleCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoaW50KSB7CiAgICAgICAgcmV0dXJuIHN0b3IuZ2V0RmlhdFRyYW5zYWN0aW9uKF91c2VySWQsIF9pbmRleCk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VXNlckZpYXRCYWxhbmNlKHN0cmluZyBfdXNlcklkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmV0dXJuIHN0b3IuZ2V0VXNlckZpYXRCYWxhbmNlKF91c2VySWQpOwogICAgfQoKICAgIGZ1bmN0aW9uIGFkZEdvbGRUcmFuc2FjdGlvbihzdHJpbmcgX3VzZXJJZCwgaW50IF9hbW91bnQpIHB1YmxpYyBvbmx5TWFuYWdlck9yQ3JlYXRvciByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXR1cm4gc3Rvci5hZGRHb2xkVHJhbnNhY3Rpb24oX3VzZXJJZCwgX2Ftb3VudCk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0R29sZFRyYW5zYWN0aW9uc0NvdW50KHN0cmluZyBfdXNlcklkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBzdG9yLmdldEdvbGRUcmFuc2FjdGlvbnNDb3VudChfdXNlcklkKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRBbGxHb2xkVHJhbnNhY3Rpb25zQ291bnQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBzdG9yLmdldEFsbEdvbGRUcmFuc2FjdGlvbnNDb3VudCgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEdvbGRUcmFuc2FjdGlvbihzdHJpbmcgX3VzZXJJZCwgdWludCBfaW5kZXgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGludCkgewogICAgICAgIHJlcXVpcmUoa2VjY2FrMjU2KF91c2VySWQpICE9IGtlY2NhazI1NigiIikpOwoKICAgICAgICByZXR1cm4gc3Rvci5nZXRHb2xkVHJhbnNhY3Rpb24oX3VzZXJJZCwgX2luZGV4KTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRVc2VySG90R29sZEJhbGFuY2Uoc3RyaW5nIF91c2VySWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXF1aXJlKGtlY2NhazI1NihfdXNlcklkKSAhPSBrZWNjYWsyNTYoIiIpKTsKCiAgICAgICAgcmV0dXJuIHN0b3IuZ2V0VXNlckhvdEdvbGRCYWxhbmNlKF91c2VySWQpOwogICAgfQoKCiAgICBmdW5jdGlvbiBhZGRCdXlUb2tlbnNSZXF1ZXN0KHN0cmluZyBfdXNlcklkLCBzdHJpbmcgX3JlcXVlc3RIYXNoKSBwdWJsaWMgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmVxdWlyZShrZWNjYWsyNTYoX3VzZXJJZCkgIT0ga2VjY2FrMjU2KCIiKSk7CgogICAgICAgIE5ld1Rva2VuQnV5UmVxdWVzdChtc2cuc2VuZGVyLCBfdXNlcklkKTsKICAgICAgICByZXR1cm4gc3Rvci5hZGRCdXlUb2tlbnNSZXF1ZXN0KG1zZy5zZW5kZXIsIF91c2VySWQsIF9yZXF1ZXN0SGFzaCk7CiAgICB9CgogICAgZnVuY3Rpb24gYWRkU2VsbFRva2Vuc1JlcXVlc3Qoc3RyaW5nIF91c2VySWQsIHN0cmluZyBfcmVxdWVzdEhhc2gpIHB1YmxpYyByZXR1cm5zKHVpbnQpIHsKICAgICAgcmVxdWlyZShrZWNjYWsyNTYoX3VzZXJJZCkgIT0ga2VjY2FrMjU2KCIiKSk7CgogICAgICBOZXdUb2tlblNlbGxSZXF1ZXN0KG1zZy5zZW5kZXIsIF91c2VySWQpOwoKICAgIHJldHVybiBzdG9yLmFkZFNlbGxUb2tlbnNSZXF1ZXN0KG1zZy5zZW5kZXIsIF91c2VySWQsIF9yZXF1ZXN0SGFzaCk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0UmVxdWVzdHNDb3VudCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXR1cm4gc3Rvci5nZXRSZXF1ZXN0c0NvdW50KCk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0UmVxdWVzdCh1aW50IF9pbmRleCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoYWRkcmVzcywgc3RyaW5nLCBzdHJpbmcsIGJvb2wsIHVpbnQ4KSB7CiAgICAgICAgdmFyIChzZW5kZXIsIHVzZXJJZEJ5dGVzLCBoYXNoQSwgaGFzaEIsIGJ1eSwgc3RhdGUpID0gc3Rvci5nZXRSZXF1ZXN0KF9pbmRleCk7CgogICAgICAgIHN0cmluZyBtZW1vcnkgdXNlcklkID0gYnl0ZXMzMlRvU3RyaW5nKHVzZXJJZEJ5dGVzKTsKICAgICAgICBzdHJpbmcgbWVtb3J5IGhhc2ggPSBieXRlczY0VG9TdHJpbmcoaGFzaEEsIGhhc2hCKTsKCiAgICAgICAgcmV0dXJuIChzZW5kZXIsIHVzZXJJZCwgaGFzaCwgYnV5LCBzdGF0ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gY2FuY2VsUmVxdWVzdCh1aW50IF9pbmRleCkgb25seU1hbmFnZXJPckNyZWF0b3IgcHVibGljIHsKICAgICAgICBSZXF1ZXN0Q2FuY2VsbGVkKF9pbmRleCk7CiAgICAgICAgc3Rvci5jYW5jZWxSZXF1ZXN0KF9pbmRleCk7CiAgICB9CgogICAgZnVuY3Rpb24gcHJvY2Vzc1JlcXVlc3QodWludCBfaW5kZXgsIHVpbnQgX2Ftb3VudENlbnRzLCB1aW50IF9jZW50c1BlckdvbGQpIG9ubHlNYW5hZ2VyT3JDcmVhdG9yIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShfaW5kZXggPCBnZXRSZXF1ZXN0c0NvdW50KCkpOwoKICAgICAgICB2YXIgKHNlbmRlciwgdXNlcklkLCBoYXNoLCBpc0J1eSwgc3RhdGUpID0gZ2V0UmVxdWVzdChfaW5kZXgpOwogICAgICAgIHJlcXVpcmUoMCA9PSBzdGF0ZSk7CgogICAgICAgIGlmIChpc0J1eSkgewogICAgICAgICAgICAgcHJvY2Vzc0J1eVJlcXVlc3QodXNlcklkLCBzZW5kZXIsIF9hbW91bnRDZW50cywgX2NlbnRzUGVyR29sZCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgIHByb2Nlc3NTZWxsUmVxdWVzdCh1c2VySWQsIHNlbmRlciwgX2Ftb3VudENlbnRzLCBfY2VudHNQZXJHb2xkKTsKICAgICAgICB9CgogICAgICAgIC8vIDMgLSB1cGRhdGUgc3RhdGUKICAgICAgICBzdG9yLnNldFJlcXVlc3RQcm9jZXNzZWQoX2luZGV4KTsKCiAgICAgICAgLy8gNCAtIHNlbmQgZXZlbnQKICAgICAgICBSZXF1ZXN0UHJvY2Vzc2VkKF9pbmRleCk7CiAgICB9CgogICAgZnVuY3Rpb24gcHJvY2Vzc0J1eVJlcXVlc3Qoc3RyaW5nIF91c2VySWQsIGFkZHJlc3MgX3VzZXJBZGRyZXNzLCB1aW50IF9hbW91bnRDZW50cywgdWludCBfY2VudHNQZXJHb2xkKSBpbnRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShrZWNjYWsyNTYoX3VzZXJJZCkgIT0ga2VjY2FrMjU2KCIiKSk7CgogICAgICAgIHVpbnQgdXNlckZpYXRCYWxhbmNlID0gZ2V0VXNlckZpYXRCYWxhbmNlKF91c2VySWQpOwogICAgICAgIHJlcXVpcmUodXNlckZpYXRCYWxhbmNlID4gMCk7CgogICAgICAgIGlmIChfYW1vdW50Q2VudHMgPiB1c2VyRmlhdEJhbGFuY2UpIHsKICAgICAgICAgICAgIF9hbW91bnRDZW50cyA9IHVzZXJGaWF0QmFsYW5jZTsKICAgICAgICB9CgogICAgICAgIHVpbnQgdXNlck1udHBCYWxhbmNlID0gbW50cFRva2VuLmJhbGFuY2VPZihfdXNlckFkZHJlc3MpOwogICAgICAgIHVpbnQgZmVlID0gZmlhdEZlZS5jYWxjdWxhdGVCdXlHb2xkRmVlKHVzZXJNbnRwQmFsYW5jZSwgX2Ftb3VudENlbnRzKTsKICAgICAgICByZXF1aXJlKF9hbW91bnRDZW50cyA+IGZlZSk7CgogICAgICAgIC8vIDEgLSBpc3N1ZSB0b2tlbnMgbWludXMgZmVlCiAgICAgICAgdWludCBhbW91bnRNaW51c0ZlZSA9IF9hbW91bnRDZW50czsKICAgICAgICBpZiAoZmVlID4gMCkgewogICAgICAgICAgICAgYW1vdW50TWludXNGZWUgPSBzYWZlU3ViKF9hbW91bnRDZW50cywgZmVlKTsKICAgICAgICB9CgogICAgICAgIHJlcXVpcmUoYW1vdW50TWludXNGZWUgPiAwKTsKCiAgICAgICAgdWludCB0b2tlbnMgPSAodWludChhbW91bnRNaW51c0ZlZSkgKiAxIGV0aGVyKSAvIF9jZW50c1BlckdvbGQ7CiAgICAgICAgaXNzdWVHb2xkVG9rZW5zKF91c2VyQWRkcmVzcywgdG9rZW5zKTsKCiAgICAgICAgLy8gcmVxdWVzdCBmcm9tIGhvdCB3YWxsZXQKICAgICAgICBpZiAoaXNIb3RXYWxsZXQoX3VzZXJBZGRyZXNzKSkgewogICAgICAgICAgYWRkR29sZFRyYW5zYWN0aW9uKF91c2VySWQsIGludCh0b2tlbnMpKTsKICAgICAgICB9CgogICAgICAgIC8vIDIgLSBhZGQgZmlhdCB0eAogICAgICAgIC8vIG5lZ2F0aXZlIGZvciBidXkgKHRvdGFsIGFtb3VudCBpbmNsdWRpbmcgZmVlISkKICAgICAgICBhZGRGaWF0VHJhbnNhY3Rpb24oX3VzZXJJZCwgLSBpbnQoX2Ftb3VudENlbnRzKSk7CgogICAgICAgIC8vIDMgLSBzZW5kIGZlZSB0byBHb2xkbWludAogICAgICAgIC8vIHBvc2l0aXZlIGZvciBzZWxsCiAgICAgICAgaWYgKGZlZSA+IDApIHsKICAgICAgICAgICAgIHN0cmluZyBtZW1vcnkgZ21BY2NvdW50ID0gYnl0ZXMzMlRvU3RyaW5nKGZpYXRGZWUuZ2V0R29sZG1pbnRGZWVBY2NvdW50KCkpOwogICAgICAgICAgICAgYWRkRmlhdFRyYW5zYWN0aW9uKGdtQWNjb3VudCwgaW50KGZlZSkpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBwcm9jZXNzU2VsbFJlcXVlc3Qoc3RyaW5nIF91c2VySWQsIGFkZHJlc3MgX3VzZXJBZGRyZXNzLCB1aW50IF9hbW91bnRDZW50cywgdWludCBfY2VudHNQZXJHb2xkKSBpbnRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShrZWNjYWsyNTYoX3VzZXJJZCkgIT0ga2VjY2FrMjU2KCIiKSk7CgogICAgICAgIHVpbnQgdG9rZW5zID0gKHVpbnQoX2Ftb3VudENlbnRzKSAqIDEgZXRoZXIpIC8gX2NlbnRzUGVyR29sZDsKICAgICAgICB1aW50IHRva2VuQmFsYW5jZSA9IGdvbGRUb2tlbi5iYWxhbmNlT2YoX3VzZXJBZGRyZXNzKTsKCiAgICAgICAgaWYgKGlzSG90V2FsbGV0KF91c2VyQWRkcmVzcykpIHsKICAgICAgICAgICAgdG9rZW5CYWxhbmNlID0gZ2V0VXNlckhvdEdvbGRCYWxhbmNlKF91c2VySWQpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRva2VuQmFsYW5jZSA8IHRva2VucykgewogICAgICAgICAgICAgdG9rZW5zID0gdG9rZW5CYWxhbmNlOwogICAgICAgICAgICAgX2Ftb3VudENlbnRzID0gdWludCgodG9rZW5zICogX2NlbnRzUGVyR29sZCkgLyAxIGV0aGVyKTsKICAgICAgICB9CgogICAgICAgIGJ1cm5Hb2xkVG9rZW5zKF91c2VyQWRkcmVzcywgdG9rZW5zKTsKCiAgICAgICAgLy8gcmVxdWVzdCBmcm9tIGhvdCB3YWxsZXQKICAgICAgICBpZiAoaXNIb3RXYWxsZXQoX3VzZXJBZGRyZXNzKSkgewogICAgICAgICAgYWRkR29sZFRyYW5zYWN0aW9uKF91c2VySWQsIC0gaW50KHRva2VucykpOwogICAgICAgIH0KCiAgICAgICAgLy8gMiAtIGFkZCBmaWF0IHR4CiAgICAgICAgdWludCB1c2VyTW50cEJhbGFuY2UgPSBtbnRwVG9rZW4uYmFsYW5jZU9mKF91c2VyQWRkcmVzcyk7CiAgICAgICAgdWludCBmZWUgPSBmaWF0RmVlLmNhbGN1bGF0ZVNlbGxHb2xkRmVlKHVzZXJNbnRwQmFsYW5jZSwgX2Ftb3VudENlbnRzKTsKICAgICAgICByZXF1aXJlKF9hbW91bnRDZW50cyA+IGZlZSk7CgogICAgICAgIHVpbnQgYW1vdW50TWludXNGZWUgPSBfYW1vdW50Q2VudHM7CgogICAgICAgIGlmIChmZWUgPiAwKSB7CiAgICAgICAgICAgICBhbW91bnRNaW51c0ZlZSA9IHNhZmVTdWIoX2Ftb3VudENlbnRzLCBmZWUpOwogICAgICAgIH0KCiAgICAgICAgcmVxdWlyZShhbW91bnRNaW51c0ZlZSA+IDApOwogICAgICAgIC8vIHBvc2l0aXZlIGZvciBzZWxsCiAgICAgICAgYWRkRmlhdFRyYW5zYWN0aW9uKF91c2VySWQsIGludChhbW91bnRNaW51c0ZlZSkpOwoKICAgICAgICAvLyAzIC0gc2VuZCBmZWUgdG8gR29sZG1pbnQKICAgICAgICBpZiAoZmVlID4gMCkgewogICAgICAgICAgICAgc3RyaW5nIG1lbW9yeSBnbUFjY291bnQgPSBieXRlczMyVG9TdHJpbmcoZmlhdEZlZS5nZXRHb2xkbWludEZlZUFjY291bnQoKSk7CiAgICAgICAgICAgICBhZGRGaWF0VHJhbnNhY3Rpb24oZ21BY2NvdW50LCBpbnQoZmVlKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLy8vLy8vIElOVEVSTkFMIFJFUVVFU1RTIEZST00gSE9UIFdBTExFVAogICAgZnVuY3Rpb24gcHJvY2Vzc0ludGVybmFsUmVxdWVzdChzdHJpbmcgX3VzZXJJZCwgYm9vbCBfaXNCdXksIHVpbnQgX2Ftb3VudENlbnRzLCB1aW50IF9jZW50c1BlckdvbGQpIG9ubHlNYW5hZ2VyT3JDcmVhdG9yIHB1YmxpYyB7CiAgICAgIGlmIChfaXNCdXkpIHsKICAgICAgICAgIHByb2Nlc3NCdXlSZXF1ZXN0KF91c2VySWQsIGdldEhvdFdhbGxldEFkZHJlc3MoKSwgX2Ftb3VudENlbnRzLCBfY2VudHNQZXJHb2xkKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAgIHByb2Nlc3NTZWxsUmVxdWVzdChfdXNlcklkLCBnZXRIb3RXYWxsZXRBZGRyZXNzKCksIF9hbW91bnRDZW50cywgX2NlbnRzUGVyR29sZCk7CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlckdvbGRGcm9tSG90V2FsbGV0KGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSwgc3RyaW5nIF91c2VySWQpIG9ubHlNYW5hZ2VyT3JDcmVhdG9yIHB1YmxpYyB7CiAgICAgIHJlcXVpcmUoa2VjY2FrMjU2KF91c2VySWQpICE9IGtlY2NhazI1NigiIikpOwoKICAgICAgdWludCBiYWxhbmNlID0gZ2V0VXNlckhvdEdvbGRCYWxhbmNlKF91c2VySWQpOwogICAgICByZXF1aXJlKGJhbGFuY2UgPj0gX3ZhbHVlKTsKCiAgICAgIGdvbGRUb2tlbi5idXJuVG9rZW5zKGdldEhvdFdhbGxldEFkZHJlc3MoKSwgX3ZhbHVlKTsKICAgICAgZ29sZFRva2VuLmlzc3VlVG9rZW5zKF90bywgX3ZhbHVlKTsKCiAgICAgIGFkZEdvbGRUcmFuc2FjdGlvbihfdXNlcklkLCAtaW50KF92YWx1ZSkpOwogICAgfQoKICAgIC8vLy8vLy8vCiAgICBmdW5jdGlvbiBpc3N1ZUdvbGRUb2tlbnMoYWRkcmVzcyBfdXNlckFkZHJlc3MsIHVpbnQgX3Rva2VuQW1vdW50KSBpbnRlcm5hbCB7CiAgICAgICAgcmVxdWlyZSgwIT1fdG9rZW5BbW91bnQpOwogICAgICAgIGdvbGRUb2tlbi5pc3N1ZVRva2VucyhfdXNlckFkZHJlc3MsIF90b2tlbkFtb3VudCk7CiAgICB9CgogICAgZnVuY3Rpb24gYnVybkdvbGRUb2tlbnMoYWRkcmVzcyBfdXNlckFkZHJlc3MsIHVpbnQgX3Rva2VuQW1vdW50KSBpbnRlcm5hbCB7CiAgICAgICAgcmVxdWlyZSgwIT1fdG9rZW5BbW91bnQpOwogICAgICAgIGdvbGRUb2tlbi5idXJuVG9rZW5zKF91c2VyQWRkcmVzcywgX3Rva2VuQW1vdW50KTsKICAgIH0KCiAgICBmdW5jdGlvbiBpc0hvdFdhbGxldChhZGRyZXNzIF9hZGRyZXNzKSBpbnRlcm5hbCByZXR1cm5zKGJvb2wpIHsKICAgICAgIHJldHVybiBfYWRkcmVzcyA9PSBnZXRIb3RXYWxsZXRBZGRyZXNzKCk7CiAgICB9CgogICAgLy8vLy8vLwogICAgZnVuY3Rpb24gZGVwb3NpdEV0aCh1aW50IF9yZXF1ZXN0SWQpIHB1YmxpYyBwYXlhYmxlIHsKICAgICAgcmVxdWlyZShldGhEZXBvc2l0QWRkcmVzcyAhPSAweDApOwogICAgICAvL21pbiBkZXBvc2l0IGlzIDAuMDEgRVRICiAgICAgIHJlcXVpcmUobXNnLnZhbHVlID49IDAuMDEgKiAxIGV0aGVyKTsKCiAgICAgIGV0aERlcG9zaXRBZGRyZXNzLnRyYW5zZmVyKG1zZy52YWx1ZSk7CgogICAgICBFdGhEZXBvc2l0ZWQoX3JlcXVlc3RJZCwgbXNnLnNlbmRlciwgbXNnLnZhbHVlKTsKICAgIH0KCiAgICAvLyBkbyBub3QgYWxsb3cgdG8gc2VuZCBtb25leSB0byB0aGlzIGNvbnRyYWN0Li4uCiAgICBmdW5jdGlvbigpIGV4dGVybmFsIHBheWFibGUgewogICAgICByZXZlcnQoKTsKICAgIH0KfQ=='.
	

]
