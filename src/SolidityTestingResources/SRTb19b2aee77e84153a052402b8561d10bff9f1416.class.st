Class {
	#name : #SRTb19b2aee77e84153a052402b8561d10bff9f1416,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTb19b2aee77e84153a052402b8561d10bff9f1416 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgogCmxpYnJhcnkgU2FmZU1hdGggewogIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludDI1NiBjID0gYSAvIGI7CiAgICBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KCgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOwogICAgb3duZXIgPSBuZXdPd25lcjsKICB9Cgp9Cgpjb250cmFjdCBFUkMyMEludGVyZmFjZSB7CiAgICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCk7CiAgICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgdG9rZW5Pd25lcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQgYmFsYW5jZSk7CiAgICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgdG9rZW5Pd25lciwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCByZW1haW5pbmcpOwogICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQgdG9rZW5zKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludCB0b2tlbnMpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdG9rZW5zKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50IHRva2Vucyk7CiAgICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIHRva2VuT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50IHRva2Vucyk7Cn0KCmNvbnRyYWN0IEh5cGVSaWRlVG9rZW4gaXMgRVJDMjBJbnRlcmZhY2UsT3duYWJsZSB7CgogICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKICAgCiAgIHN0cmluZyBwdWJsaWMgbmFtZTsKICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7CiAgIHVpbnQyNTYgcHVibGljIGRlY2ltYWxzOwoKICAgdWludDI1NiBwdWJsaWMgX3RvdGFsU3VwcGx5OwogICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgdG9rZW5CYWxhbmNlczsKICAgYWRkcmVzcyBvd25lcldhbGxldDsKICAgLy8gT3duZXIgb2YgYWNjb3VudCBhcHByb3ZlcyB0aGUgdHJhbnNmZXIgb2YgYW4gYW1vdW50IHRvIGFub3RoZXIgYWNjb3VudAogICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CiAgIAogICAvKioKICAgKiBAZGV2IENvbnRydWN0b3IgdGhhdCBnaXZlcyBtc2cuc2VuZGVyIGFsbCBvZiBleGlzdGluZyB0b2tlbnMuCiAgICovCiAgICBmdW5jdGlvbiBIeXBlUmlkZVRva2VuKGFkZHJlc3Mgd2FsbGV0KSBwdWJsaWMgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgICAgICBvd25lcldhbGxldCA9IHdhbGxldDsKICAgICAgICBuYW1lICA9ICJIWVBFUklERSI7CiAgICAgICAgc3ltYm9sID0gIkhZUEUiOwogICAgICAgIGRlY2ltYWxzID0gMTg7CiAgICAgICAgX3RvdGFsU3VwcGx5ID0gMTUwMDAwMDAwICogMTAgKiogdWludChkZWNpbWFscyk7CiAgICAgICAgdG9rZW5CYWxhbmNlc1t3YWxsZXRdID0gX3RvdGFsU3VwcGx5OyAgIC8vU2luY2Ugd2UgZGl2aWRlZCB0aGUgdG9rZW4gaW50byAxMF4xOCBwYXJ0cwogICAgfQogICAgCiAgICAgLy8gR2V0IHRoZSB0b2tlbiBiYWxhbmNlIGZvciBhY2NvdW50IGB0b2tlbk93bmVyYAogICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHRva2VuT3duZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50IGJhbGFuY2UpIHsKICAgICAgICAgcmV0dXJuIHRva2VuQmFsYW5jZXNbdG9rZW5Pd25lcl07CiAgICAgfQogIAogICAgIC8vIFRyYW5zZmVyIHRoZSBiYWxhbmNlIGZyb20gb3duZXIncyBhY2NvdW50IHRvIGFub3RoZXIgYWNjb3VudAogICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQgdG9rZW5zKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgIHJlcXVpcmUodG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgIHJlcXVpcmUodG9rZW5zIDw9IHRva2VuQmFsYW5jZXNbbXNnLnNlbmRlcl0pOwogICAgICAgICB0b2tlbkJhbGFuY2VzW21zZy5zZW5kZXJdID0gdG9rZW5CYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIodG9rZW5zKTsKICAgICAgICAgdG9rZW5CYWxhbmNlc1t0b10gPSB0b2tlbkJhbGFuY2VzW3RvXS5hZGQodG9rZW5zKTsKICAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgdG8sIHRva2Vucyk7CiAgICAgICAgIHJldHVybiB0cnVlOwogICAgIH0KICAKICAgICAvKioKICAgKiBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIKICAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tCiAgICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHRyYW5zZmVyIHRvCiAgICogQHBhcmFtIF92YWx1ZSB1aW50MjU2IHRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgcmVxdWlyZShfdmFsdWUgPD0gdG9rZW5CYWxhbmNlc1tfZnJvbV0pOwogICAgcmVxdWlyZShfdmFsdWUgPD0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0pOwoKICAgIHRva2VuQmFsYW5jZXNbX2Zyb21dID0gdG9rZW5CYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICB0b2tlbkJhbGFuY2VzW190b10gPSB0b2tlbkJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KICAKICAgICAvKioKICAgKiBAZGV2IEFwcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWhhbGYgb2YgbXNnLnNlbmRlci4KICAgKgogICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHNwZW50LgogICAqLwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAvLyBUb3RhbCBzdXBwbHkKICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgIHJldHVybiBfdG90YWxTdXBwbHkgIC0gdG9rZW5CYWxhbmNlc1thZGRyZXNzKDApXTsKICAgICB9CiAgICAgCiAgICAKICAgICAKICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAvLyBSZXR1cm5zIHRoZSBhbW91bnQgb2YgdG9rZW5zIGFwcHJvdmVkIGJ5IHRoZSBvd25lciB0aGF0IGNhbiBiZQogICAgIC8vIHRyYW5zZmVycmVkIHRvIHRoZSBzcGVuZGVyJ3MgYWNjb3VudAogICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIHRva2VuT3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVtYWluaW5nKSB7CiAgICAgICAgIHJldHVybiBhbGxvd2VkW3Rva2VuT3duZXJdW3NwZW5kZXJdOwogICAgIH0KICAgICAKICAgICAvKioKICAgKiBAZGV2IEluY3JlYXNlIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgYW4gb3duZXIgYWxsb3dlZCB0byBhIHNwZW5kZXIuCiAgICoKICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF9hZGRlZFZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGluY3JlYXNlIHRoZSBhbGxvd2FuY2UgYnkuCiAgICovCiAgZnVuY3Rpb24gaW5jcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hZGRlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXS5hZGQoX2FkZGVkVmFsdWUpOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBEZWNyZWFzZSB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAqCiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfc3VidHJhY3RlZFZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGRlY3JlYXNlIHRoZSBhbGxvd2FuY2UgYnkuCiAgICovCiAgZnVuY3Rpb24gZGVjcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9zdWJ0cmFjdGVkVmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICB1aW50IG9sZFZhbHVlID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl07CiAgICBpZiAoX3N1YnRyYWN0ZWRWYWx1ZSA+IG9sZFZhbHVlKSB7CiAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gMDsKICAgIH0gZWxzZSB7CiAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gb2xkVmFsdWUuc3ViKF9zdWJ0cmFjdGVkVmFsdWUpOwogICAgfQogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgICAgCiAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgLy8gRG9uJ3QgYWNjZXB0IEVUSAogICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgIGZ1bmN0aW9uICgpIHB1YmxpYyBwYXlhYmxlIHsKICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgfQogCiAKICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAvLyBPd25lciBjYW4gdHJhbnNmZXIgb3V0IGFueSBhY2NpZGVudGFsbHkgc2VudCBFUkMyMCB0b2tlbnMKICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICBmdW5jdGlvbiB0cmFuc2ZlckFueUVSQzIwVG9rZW4oYWRkcmVzcyB0b2tlbkFkZHJlc3MsIHVpbnQgdG9rZW5zKSBwdWJsaWMgb25seU93bmVyIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgICByZXR1cm4gRVJDMjBJbnRlcmZhY2UodG9rZW5BZGRyZXNzKS50cmFuc2Zlcihvd25lciwgdG9rZW5zKTsKICAgICB9CiAgICAgCiAgICAgLy9vbmx5IHRvIGJlIHVzZWQgYnkgdGhlIElDTwogICAgIAogICAgIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyB3YWxsZXQsIGFkZHJlc3MgYnV5ZXIsIHVpbnQyNTYgdG9rZW5BbW91bnQpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICByZXF1aXJlKHRva2VuQmFsYW5jZXNbd2FsbGV0XSA+PSB0b2tlbkFtb3VudCk7ICAgICAgICAgICAgICAgLy8gY2hlY2tzIGlmIGl0IGhhcyBlbm91Z2ggdG8gc2VsbAogICAgICB0b2tlbkJhbGFuY2VzW2J1eWVyXSA9IHRva2VuQmFsYW5jZXNbYnV5ZXJdLmFkZCh0b2tlbkFtb3VudCk7ICAgICAgICAgICAgICAgICAgLy8gYWRkcyB0aGUgYW1vdW50IHRvIGJ1eWVyJ3MgYmFsYW5jZQogICAgICB0b2tlbkJhbGFuY2VzW3dhbGxldF0gPSB0b2tlbkJhbGFuY2VzW3dhbGxldF0uc3ViKHRva2VuQW1vdW50KTsgICAgICAgICAgICAgICAgICAgICAgICAvLyBzdWJ0cmFjdHMgYW1vdW50IGZyb20gc2VsbGVyJ3MgYmFsYW5jZQogICAgICBUcmFuc2Zlcih3YWxsZXQsIGJ1eWVyLCB0b2tlbkFtb3VudCk7IAogICAgICBfdG90YWxTdXBwbHkgPSBfdG90YWxTdXBwbHkuc3ViKHRva2VuQW1vdW50KTsKICAgIH0KfQpjb250cmFjdCBIeXBlUmlkZUNyb3dkc2FsZSB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CiAKICAvLyBUaGUgdG9rZW4gYmVpbmcgc29sZAogIEh5cGVSaWRlVG9rZW4gcHVibGljIHRva2VuOwoKICAvLyBzdGFydCBhbmQgZW5kIHRpbWVzdGFtcHMgd2hlcmUgaW52ZXN0bWVudHMgYXJlIGFsbG93ZWQgKGJvdGggaW5jbHVzaXZlKQogIHVpbnQyNTYgcHVibGljIHN0YXJ0VGltZTsKICB1aW50MjU2IHB1YmxpYyBlbmRUaW1lOwoKICAvLyBhZGRyZXNzIHdoZXJlIGZ1bmRzIGFyZSBjb2xsZWN0ZWQKICAvLyBhZGRyZXNzIHdoZXJlIHRva2VucyBhcmUgZGVwb3NpdGVkIGFuZCBmcm9tIHdoZXJlIHdlIHNlbmQgdG9rZW5zIHRvIGJ1eWVycwogIGFkZHJlc3MgcHVibGljIHdhbGxldDsKCiAgLy8gaG93IG1hbnkgdG9rZW4gdW5pdHMgYSBidXllciBnZXRzIHBlciB3ZWkKICB1aW50MjU2IHB1YmxpYyByYXRlUGVyV2VpID0gMTAwMDsKCiAgLy8gYW1vdW50IG9mIHJhaXNlZCBtb25leSBpbiB3ZWkKICB1aW50MjU2IHB1YmxpYyB3ZWlSYWlzZWQ7CgogIHVpbnQyNTYgVE9LRU5TX1NPTEQ7CiAgdWludDI1NiBtYXhUb2tlbnNUb1NhbGUgPSAxNTAwMDAwMDAgKiAxMCAqKiAxODsKICB1aW50MjU2IG1heFRva2Vuc1RvU2FsZUluUHJlSUNPUGhhc2UgPSAgNzUwMDAwMCAqIDEwICoqIDE4OwogIHVpbnQyNTYgbWF4VG9rZW5zVG9TYWxlSW5JQ09QaGFzZTEgPSAxNDI1MDAwMCAqIDEwICoqIDE4OwogIHVpbnQyNTYgbWF4VG9rZW5zVG9TYWxlSW5JQ09QaGFzZTIgPSAyMDI1MDAwMCAqIDEwICoqIDE4OwogIHVpbnQyNTYgbWF4VG9rZW5zVG9TYWxlSW5JQ09QaGFzZTMgPSAyNTc1MDAwMCAqIDEwICoqIDE4OwogIAogIGJvb2wgaXNDcm93ZHNhbGVQYXVzZWQgPSBmYWxzZTsKCiAgLyoqCiAgICogZXZlbnQgZm9yIHRva2VuIHB1cmNoYXNlIGxvZ2dpbmcKICAgKiBAcGFyYW0gcHVyY2hhc2VyIHdobyBwYWlkIGZvciB0aGUgdG9rZW5zCiAgICogQHBhcmFtIGJlbmVmaWNpYXJ5IHdobyBnb3QgdGhlIHRva2VucwogICAqIEBwYXJhbSB2YWx1ZSB3ZWlzIHBhaWQgZm9yIHB1cmNoYXNlCiAgICogQHBhcmFtIGFtb3VudCBhbW91bnQgb2YgdG9rZW5zIHB1cmNoYXNlZAogICAqLwogIGV2ZW50IFRva2VuUHVyY2hhc2UoYWRkcmVzcyBpbmRleGVkIHB1cmNoYXNlciwgYWRkcmVzcyBpbmRleGVkIGJlbmVmaWNpYXJ5LCB1aW50MjU2IHZhbHVlLCB1aW50MjU2IGFtb3VudCk7CgoKICBmdW5jdGlvbiBIeXBlUmlkZUNyb3dkc2FsZSh1aW50MjU2IF9zdGFydFRpbWUsIGFkZHJlc3MgX3dhbGxldCkgcHVibGljIAogIHsKICAgIHN0YXJ0VGltZSA9IF9zdGFydFRpbWU7CiAgICBlbmRUaW1lID0gc3RhcnRUaW1lICsgMTIwIGRheXM7CiAgICAKICAgIHJlcXVpcmUoc3RhcnRUaW1lID49bm93KTsKICAgIHJlcXVpcmUoZW5kVGltZSA+PSBzdGFydFRpbWUpOwogICAgcmVxdWlyZShfd2FsbGV0ICE9IDB4MCk7CgogICAgd2FsbGV0ID0gX3dhbGxldDsKICAgIHRva2VuID0gY3JlYXRlVG9rZW5Db250cmFjdCh3YWxsZXQpOwogIH0KICAKICAgLy8gY3JlYXRlcyB0aGUgdG9rZW4gdG8gYmUgc29sZC4KICBmdW5jdGlvbiBjcmVhdGVUb2tlbkNvbnRyYWN0KGFkZHJlc3Mgd2FsbCkgaW50ZXJuYWwgcmV0dXJucyAoSHlwZVJpZGVUb2tlbikgewogICAgcmV0dXJuIG5ldyBIeXBlUmlkZVRva2VuKHdhbGwpOwogIH0KICAvLyBmYWxsYmFjayBmdW5jdGlvbiBjYW4gYmUgdXNlZCB0byBidXkgdG9rZW5zCiAgZnVuY3Rpb24gKCkgcHVibGljIHBheWFibGUgewogICAgYnV5VG9rZW5zKG1zZy5zZW5kZXIpOwogIH0KICAgCiAgLy8gbG93IGxldmVsIHRva2VuIHB1cmNoYXNlIGZ1bmN0aW9uCiAgLy8gTWluaW11bSBwdXJjaGFzZSBjYW4gYmUgb2YgMSBFVEgKICBmdW5jdGlvbiBkZXRlcm1pbmVCb251cyh1aW50IHRva2VucykgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2IGJvbnVzKSAKICAgIHsKICAgICAgICB1aW50MjU2IHRpbWVFbGFwc2VkID0gbm93IC0gc3RhcnRUaW1lOwogICAgICAgIHVpbnQyNTYgdGltZUVsYXBzZWRJbkRheXMgPSB0aW1lRWxhcHNlZC5kaXYoMSBkYXlzKTsKICAgICAgICBpZiAodGltZUVsYXBzZWRJbkRheXMgPDMwKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKFRPS0VOU19TT0xEIDxtYXhUb2tlbnNUb1NhbGVJblByZUlDT1BoYXNlKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBib251cyA9IHRva2Vucy5tdWwoNTApOyAvLzUwJSBib251cwogICAgICAgICAgICAgICAgYm9udXMgPSBib251cy5kaXYoMTAwKTsKICAgICAgICAgICAgICAgIHJlcXVpcmUgKFRPS0VOU19TT0xEICsgdG9rZW5zICsgYm9udXMgPD0gbWF4VG9rZW5zVG9TYWxlSW5QcmVJQ09QaGFzZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAoVE9LRU5TX1NPTEQgPj0gbWF4VG9rZW5zVG9TYWxlSW5QcmVJQ09QaGFzZSAmJiBUT0tFTlNfU09MRCA8IG1heFRva2Vuc1RvU2FsZUluSUNPUGhhc2UxKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBib251cyA9IHRva2Vucy5tdWwoMzUpOyAvLzM1JSBib251cwogICAgICAgICAgICAgICAgYm9udXMgPSBib251cy5kaXYoMTAwKTsKICAgICAgICAgICAgICAgIHJlcXVpcmUgKFRPS0VOU19TT0xEICsgdG9rZW5zICsgYm9udXMgPD0gbWF4VG9rZW5zVG9TYWxlSW5JQ09QaGFzZTEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICBlbHNlIGlmIChUT0tFTlNfU09MRCA+PSBtYXhUb2tlbnNUb1NhbGVJbklDT1BoYXNlMSAmJiBUT0tFTlNfU09MRCA8IG1heFRva2Vuc1RvU2FsZUluSUNPUGhhc2UyKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBib251cyA9IHRva2Vucy5tdWwoMjApOyAvLzIwJSBib251cwogICAgICAgICAgICAgICAgYm9udXMgPSBib251cy5kaXYoMTAwKTsKICAgICAgICAgICAgICAgIHJlcXVpcmUgKFRPS0VOU19TT0xEICsgdG9rZW5zICsgYm9udXMgPD0gbWF4VG9rZW5zVG9TYWxlSW5JQ09QaGFzZTIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICBlbHNlIGlmIChUT0tFTlNfU09MRCA+PSBtYXhUb2tlbnNUb1NhbGVJbklDT1BoYXNlMiAmJiBUT0tFTlNfU09MRCA8IG1heFRva2Vuc1RvU2FsZUluSUNPUGhhc2UzKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBib251cyA9IHRva2Vucy5tdWwoMTApOyAvLzEwJSBib251cwogICAgICAgICAgICAgICAgYm9udXMgPSBib251cy5kaXYoMTAwKTsKICAgICAgICAgICAgICAgIHJlcXVpcmUgKFRPS0VOU19TT0xEICsgdG9rZW5zICsgYm9udXMgPD0gbWF4VG9rZW5zVG9TYWxlSW5JQ09QaGFzZTMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGJvbnVzID0gMDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIGlmICh0aW1lRWxhcHNlZEluRGF5cyA+PSAzMCAmJiB0aW1lRWxhcHNlZEluRGF5czw2MCkgICAvL0lDTyBwaGFzZSAxLCAyIHdlZWtzCiAgICAgICAgewogICAgICAgICAgICBpZiAoVE9LRU5TX1NPTEQgPCBtYXhUb2tlbnNUb1NhbGVJbklDT1BoYXNlMSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgYm9udXMgPSB0b2tlbnMubXVsKDM1KTsgLy8zNSUgYm9udXMKICAgICAgICAgICAgICAgIGJvbnVzID0gYm9udXMuZGl2KDEwMCk7CiAgICAgICAgICAgICAgICByZXF1aXJlIChUT0tFTlNfU09MRCArIHRva2VucyArIGJvbnVzIDw9IG1heFRva2Vuc1RvU2FsZUluSUNPUGhhc2UxKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAgZWxzZSBpZiAoVE9LRU5TX1NPTEQgPj0gbWF4VG9rZW5zVG9TYWxlSW5JQ09QaGFzZTEgJiYgVE9LRU5TX1NPTEQgPCBtYXhUb2tlbnNUb1NhbGVJbklDT1BoYXNlMikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgYm9udXMgPSB0b2tlbnMubXVsKDIwKTsgLy8yMCUgYm9udXMKICAgICAgICAgICAgICAgIGJvbnVzID0gYm9udXMuZGl2KDEwMCk7CiAgICAgICAgICAgICAgICByZXF1aXJlIChUT0tFTlNfU09MRCArIHRva2VucyArIGJvbnVzIDw9IG1heFRva2Vuc1RvU2FsZUluSUNPUGhhc2UyKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAgZWxzZSBpZiAoVE9LRU5TX1NPTEQgPj0gbWF4VG9rZW5zVG9TYWxlSW5JQ09QaGFzZTIgJiYgVE9LRU5TX1NPTEQgPCBtYXhUb2tlbnNUb1NhbGVJbklDT1BoYXNlMykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgYm9udXMgPSB0b2tlbnMubXVsKDEwKTsgLy8xMCUgYm9udXMKICAgICAgICAgICAgICAgIGJvbnVzID0gYm9udXMuZGl2KDEwMCk7CiAgICAgICAgICAgICAgICByZXF1aXJlIChUT0tFTlNfU09MRCArIHRva2VucyArIGJvbnVzIDw9IG1heFRva2Vuc1RvU2FsZUluSUNPUGhhc2UzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGJvbnVzID0gMDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIGlmICh0aW1lRWxhcHNlZEluRGF5cyA+PSA2MCAmJiB0aW1lRWxhcHNlZEluRGF5czw5MCkgICAvL0lDTyBwaGFzZSAyLCAyIHdlZWtzCiAgICAgICAgewogICAgICAgICAgICBpZiAoVE9LRU5TX1NPTEQgPCBtYXhUb2tlbnNUb1NhbGVJbklDT1BoYXNlMikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgYm9udXMgPSB0b2tlbnMubXVsKDIwKTsgLy8yMCUgYm9udXMKICAgICAgICAgICAgICAgIGJvbnVzID0gYm9udXMuZGl2KDEwMCk7CiAgICAgICAgICAgICAgICByZXF1aXJlIChUT0tFTlNfU09MRCArIHRva2VucyArIGJvbnVzIDw9IG1heFRva2Vuc1RvU2FsZUluSUNPUGhhc2UyKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAgZWxzZSBpZiAoVE9LRU5TX1NPTEQgPj0gbWF4VG9rZW5zVG9TYWxlSW5JQ09QaGFzZTIgJiYgVE9LRU5TX1NPTEQgPCBtYXhUb2tlbnNUb1NhbGVJbklDT1BoYXNlMykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgYm9udXMgPSB0b2tlbnMubXVsKDEwKTsgLy8xMCUgYm9udXMKICAgICAgICAgICAgICAgIGJvbnVzID0gYm9udXMuZGl2KDEwMCk7CiAgICAgICAgICAgICAgICByZXF1aXJlIChUT0tFTlNfU09MRCArIHRva2VucyArIGJvbnVzIDw9IG1heFRva2Vuc1RvU2FsZUluSUNPUGhhc2UzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGJvbnVzID0gMDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIGlmICh0aW1lRWxhcHNlZEluRGF5cyA+PSA5MCAmJiB0aW1lRWxhcHNlZEluRGF5czwxMjApICAgLy9JQ08gcGhhc2UgMywgMiB3ZWVrcwogICAgICAgIHsKICAgICAgICAgICAgaWYgKFRPS0VOU19TT0xEIDwgbWF4VG9rZW5zVG9TYWxlSW5JQ09QaGFzZTMpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGJvbnVzID0gdG9rZW5zLm11bCgxMCk7IC8vMTAlIGJvbnVzCiAgICAgICAgICAgICAgICBib251cyA9IGJvbnVzLmRpdigxMDApOwogICAgICAgICAgICAgICAgcmVxdWlyZSAoVE9LRU5TX1NPTEQgKyB0b2tlbnMgKyBib251cyA8PSBtYXhUb2tlbnNUb1NhbGVJbklDT1BoYXNlMyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBib251cyA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSAKICAgICAgICB7CiAgICAgICAgICAgIGJvbnVzID0gMDsKICAgICAgICB9CiAgICB9CgogIGZ1bmN0aW9uIGJ1eVRva2VucyhhZGRyZXNzIGJlbmVmaWNpYXJ5KSBwdWJsaWMgcGF5YWJsZSB7CiAgICAgIAogICAgdWludDI1NiB3ZWlBbW91bnQ7CiAgICB1aW50MjU2IHRva2VuczsKICAgIGlmIChub3cgPD0gZW5kVGltZSkKICAgIHsKICAgICAgICByZXF1aXJlKGJlbmVmaWNpYXJ5ICE9IDB4MCk7CiAgICAgICAgcmVxdWlyZShpc0Nyb3dkc2FsZVBhdXNlZCA9PSBmYWxzZSk7CiAgICAgICAgcmVxdWlyZSh2YWxpZFB1cmNoYXNlKCkpOwogICAgICAgIHJlcXVpcmUoVE9LRU5TX1NPTEQ8bWF4VG9rZW5zVG9TYWxlKTsKICAgICAgICB3ZWlBbW91bnQgPSBtc2cudmFsdWU7CiAgICAKICAgICAgICAvLyBjYWxjdWxhdGUgdG9rZW4gYW1vdW50IHRvIGJlIGNyZWF0ZWQKICAgIAogICAgICAgIHRva2VucyA9IHdlaUFtb3VudC5tdWwocmF0ZVBlcldlaSk7CiAgICAgICAgdWludDI1NiBib251cyA9IGRldGVybWluZUJvbnVzKHRva2Vucyk7CiAgICAgICAgdG9rZW5zID0gdG9rZW5zLmFkZChib251cyk7CiAgICAgICAgcmVxdWlyZShUT0tFTlNfU09MRCt0b2tlbnM8PW1heFRva2Vuc1RvU2FsZSk7CiAgICAKICAgICAgICAvLyB1cGRhdGUgc3RhdGUKICAgICAgICB3ZWlSYWlzZWQgPSB3ZWlSYWlzZWQuYWRkKHdlaUFtb3VudCk7CgogICAgICAgIHRva2VuLm1pbnQod2FsbGV0LCBiZW5lZmljaWFyeSwgdG9rZW5zKTsgCiAgICAgICAgVG9rZW5QdXJjaGFzZShtc2cuc2VuZGVyLCBiZW5lZmljaWFyeSwgd2VpQW1vdW50LCB0b2tlbnMpOwogICAgICAgIFRPS0VOU19TT0xEID0gVE9LRU5TX1NPTEQuYWRkKHRva2Vucyk7CiAgICAgICAgZm9yd2FyZEZ1bmRzKCk7CiAgICB9CiAgICBlbHNlIGlmIChub3cgPiBlbmRUaW1lICYmIG5vdyA8PSBlbmRUaW1lICsgMzY1IGRheXMpCiAgICB7CiAgICAgICAgcmVxdWlyZShiZW5lZmljaWFyeSAhPSAweDApOwogICAgICAgIHJlcXVpcmUoaXNDcm93ZHNhbGVQYXVzZWQgPT0gZmFsc2UpOwogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID4gMCk7CiAgICAgICAgcmVxdWlyZShUT0tFTlNfU09MRDxtYXhUb2tlbnNUb1NhbGUpOwogICAgICAgIHdlaUFtb3VudCA9IG1zZy52YWx1ZTsKICAgIAogICAgICAgIC8vIGNhbGN1bGF0ZSB0b2tlbiBhbW91bnQgdG8gYmUgY3JlYXRlZAogICAgCiAgICAgICAgdG9rZW5zID0gd2VpQW1vdW50Lm11bChyYXRlUGVyV2VpKTsKICAgICAgICByZXF1aXJlKFRPS0VOU19TT0xEK3Rva2Vuczw9bWF4VG9rZW5zVG9TYWxlKTsKICAgIAogICAgICAgIC8vIHVwZGF0ZSBzdGF0ZQogICAgICAgIHdlaVJhaXNlZCA9IHdlaVJhaXNlZC5hZGQod2VpQW1vdW50KTsKCiAgICAgICAgdG9rZW4ubWludCh3YWxsZXQsIGJlbmVmaWNpYXJ5LCB0b2tlbnMpOyAKICAgICAgICBUb2tlblB1cmNoYXNlKG1zZy5zZW5kZXIsIGJlbmVmaWNpYXJ5LCB3ZWlBbW91bnQsIHRva2Vucyk7CiAgICAgICAgVE9LRU5TX1NPTEQgPSBUT0tFTlNfU09MRC5hZGQodG9rZW5zKTsKICAgICAgICBmb3J3YXJkRnVuZHMoKTsKICAgIH0KICB9CgogIC8vIHNlbmQgZXRoZXIgdG8gdGhlIGZ1bmQgY29sbGVjdGlvbiB3YWxsZXQKICAvLyBvdmVycmlkZSB0byBjcmVhdGUgY3VzdG9tIGZ1bmQgZm9yd2FyZGluZyBtZWNoYW5pc21zCiAgZnVuY3Rpb24gZm9yd2FyZEZ1bmRzKCkgaW50ZXJuYWwgewogICAgd2FsbGV0LnRyYW5zZmVyKG1zZy52YWx1ZSk7CiAgfQoKICAvLyBAcmV0dXJuIHRydWUgaWYgdGhlIHRyYW5zYWN0aW9uIGNhbiBidXkgdG9rZW5zCiAgZnVuY3Rpb24gdmFsaWRQdXJjaGFzZSgpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIGJvb2wgd2l0aGluUGVyaW9kID0gbm93ID49IHN0YXJ0VGltZSAmJiBub3cgPD0gZW5kVGltZTsKICAgIGJvb2wgbm9uWmVyb1B1cmNoYXNlID0gbXNnLnZhbHVlICE9IDA7CiAgICByZXR1cm4gd2l0aGluUGVyaW9kICYmIG5vblplcm9QdXJjaGFzZTsKICB9CgogIC8vIEByZXR1cm4gdHJ1ZSBpZiBjcm93ZHNhbGUgZXZlbnQgaGFzIGVuZGVkCiAgZnVuY3Rpb24gaGFzRW5kZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIG5vdyA+IGVuZFRpbWU7CiAgfQogIAogICAgLyoqCiAgICAgKiBmdW5jdGlvbiB0byBjaGFuZ2UgdGhlIGVuZCBkYXRlICYgdGltZQogICAgICogY2FuIG9ubHkgYmUgY2FsbGVkIGZyb20gb3duZXIgd2FsbGV0CiAgICAgKiovCiAgICAgICAgCiAgICBmdW5jdGlvbiBjaGFuZ2VFbmREYXRlKHVpbnQyNTYgZW5kVGltZVVuaXhUaW1lc3RhbXApIHB1YmxpYyByZXR1cm5zKGJvb2wpIHsKICAgICAgICByZXF1aXJlIChtc2cuc2VuZGVyID09IHdhbGxldCk7CiAgICAgICAgZW5kVGltZSA9IGVuZFRpbWVVbml4VGltZXN0YW1wOwogICAgfQogICAgCiAgICAvKioKICAgICAqIGZ1bmN0aW9uIHRvIGNoYW5nZSB0aGUgc3RhcnQgZGF0ZSAmIHRpbWUKICAgICAqIGNhbiBvbmx5IGJlIGNhbGxlZCBmcm9tIG93bmVyIHdhbGxldAogICAgICoqLwogICAgIAogICAgZnVuY3Rpb24gY2hhbmdlU3RhcnREYXRlKHVpbnQyNTYgc3RhcnRUaW1lVW5peFRpbWVzdGFtcCkgcHVibGljIHJldHVybnMoYm9vbCkgewogICAgICAgIHJlcXVpcmUgKG1zZy5zZW5kZXIgPT0gd2FsbGV0KTsKICAgICAgICBzdGFydFRpbWUgPSBzdGFydFRpbWVVbml4VGltZXN0YW1wOwogICAgfQogICAgCiAgICAvKioKICAgICAqIGZ1bmN0aW9uIHRvIGNoYW5nZSB0aGUgcHJpY2UgcmF0ZSAKICAgICAqIGNhbiBvbmx5IGJlIGNhbGxlZCBmcm9tIG93bmVyIHdhbGxldAogICAgICoqLwogICAgIAogICAgZnVuY3Rpb24gc2V0UHJpY2VSYXRlKHVpbnQyNTYgbmV3UHJpY2UpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZSAobXNnLnNlbmRlciA9PSB3YWxsZXQpOwogICAgICAgIHJhdGVQZXJXZWkgPSBuZXdQcmljZTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBmdW5jdGlvbiB0byBlbmFibGUgdG9rZW4gc2FsZXMgcG9zdCBJQ08KICAgICAqIGNhbiBvbmx5IGJlIGNhbGxlZCBmcm9tIG93bmVyIHdhbGxldAogICAgICoqLwogICAgIAogICAgZnVuY3Rpb24gY2lyY3VsYXRlVG9rZW5zRm9yU2FsZSh1aW50MjU2IHRva2VuQW1vdW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUgKG1zZy5zZW5kZXIgPT0gd2FsbGV0KTsKICAgICAgICB0b2tlbkFtb3VudCA9IHRva2VuQW1vdW50ICogMTAgKiogMTg7CiAgICAgICAgbWF4VG9rZW5zVG9TYWxlID0gbWF4VG9rZW5zVG9TYWxlICsgdG9rZW5BbW91bnQ7CiAgICB9CiAgICAKICAgICAvKioKICAgICAqIGZ1bmN0aW9uIHRvIHBhdXNlIHRoZSBjcm93ZHNhbGUgCiAgICAgKiBjYW4gb25seSBiZSBjYWxsZWQgZnJvbSBvd25lciB3YWxsZXQKICAgICAqKi8KICAgICAKICAgIGZ1bmN0aW9uIHBhdXNlQ3Jvd2RzYWxlKCkgcHVibGljIHJldHVybnMoYm9vbCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlcj09d2FsbGV0KTsKICAgICAgICBpc0Nyb3dkc2FsZVBhdXNlZCA9IHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBmdW5jdGlvbiB0byByZXN1bWUgdGhlIGNyb3dkc2FsZSBpZiBpdCBpcyBwYXVzZWQKICAgICAqIGNhbiBvbmx5IGJlIGNhbGxlZCBmcm9tIG93bmVyIHdhbGxldAogICAgICogaWYgdGhlIGNyb3dkc2FsZSBoYXMgYmVlbiBzdG9wcGVkLCB0aGlzIGZ1bmN0aW9uIHdvdWxkIG5vdCByZXN1bWUgaXQKICAgICAqKi8gCiAgICBmdW5jdGlvbiByZXN1bWVDcm93ZHNhbGUoKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlcj09d2FsbGV0KTsKICAgICAgICBpc0Nyb3dkc2FsZVBhdXNlZCA9IGZhbHNlOwogICAgfQogICAgCiAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgLy8gUmVtYWluaW5nIHRva2VucyBmb3Igc2FsZQogICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgIGZ1bmN0aW9uIHJlbWFpbmluZ1Rva2Vuc0ZvclNhbGUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgICByZXR1cm4gbWF4VG9rZW5zVG9TYWxlIC0gVE9LRU5TX1NPTEQ7CiAgICAgfQogICAgIAogICAgIGZ1bmN0aW9uIHNob3dNeVRva2VuQmFsYW5jZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgIHJldHVybiB0b2tlbi5iYWxhbmNlT2YobXNnLnNlbmRlcik7CiAgICAgfQp9'.
	

]
