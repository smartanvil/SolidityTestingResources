Class {
	#name : #SRT3c01ddc7af41e6888cbd8d0398fe34a81c3c7f36,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT3c01ddc7af41e6888cbd8d0398fe34a81c3c7f36 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuNjsKCi8qKgoqIEB0aXRsZSBSTFBSZWFkZXIKKgoqIFJMUFJlYWRlciBpcyB1c2VkIHRvIHJlYWQgYW5kIHBhcnNlIFJMUCBlbmNvZGVkIGRhdGEgaW4gbWVtb3J5LgoqCiogQGF1dGhvciBBbmRyZWFzIE9sb2Zzc29uICg8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iYzBhMWFlYTRiMmFmYWNhZmYxZjlmOGYwODBhN2FkYTFhOWFjZWVhM2FmYWQiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+KQoqLwpsaWJyYXJ5IFJMUCB7CgogdWludCBjb25zdGFudCBEQVRBX1NIT1JUX1NUQVJUID0gMHg4MDsKIHVpbnQgY29uc3RhbnQgREFUQV9MT05HX1NUQVJUID0gMHhCODsKIHVpbnQgY29uc3RhbnQgTElTVF9TSE9SVF9TVEFSVCA9IDB4QzA7CiB1aW50IGNvbnN0YW50IExJU1RfTE9OR19TVEFSVCA9IDB4Rjg7CgogdWludCBjb25zdGFudCBEQVRBX0xPTkdfT0ZGU0VUID0gMHhCNzsKIHVpbnQgY29uc3RhbnQgTElTVF9MT05HX09GRlNFVCA9IDB4Rjc7CgoKIHN0cnVjdCBSTFBJdGVtIHsKICAgICB1aW50IF91bnNhZmVfbWVtUHRyOyAgICAvLyBQb2ludGVyIHRvIHRoZSBSTFAtZW5jb2RlZCBieXRlcy4KICAgICB1aW50IF91bnNhZmVfbGVuZ3RoOyAgICAvLyBOdW1iZXIgb2YgYnl0ZXMuIFRoaXMgaXMgdGhlIGZ1bGwgbGVuZ3RoIG9mIHRoZSBzdHJpbmcuCiB9Cgogc3RydWN0IEl0ZXJhdG9yIHsKICAgICBSTFBJdGVtIF91bnNhZmVfaXRlbTsgICAvLyBJdGVtIHRoYXQncyBiZWluZyBpdGVyYXRlZCBvdmVyLgogICAgIHVpbnQgX3Vuc2FmZV9uZXh0UHRyOyAgIC8vIFBvc2l0aW9uIG9mIHRoZSBuZXh0IGl0ZW0gaW4gdGhlIGxpc3QuCiB9CgogLyogSXRlcmF0b3IgKi8KCiBmdW5jdGlvbiBuZXh0KEl0ZXJhdG9yIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChSTFBJdGVtIG1lbW9yeSBzdWJJdGVtKSB7CiAgICAgaWYoaGFzTmV4dChzZWxmKSkgewogICAgICAgICB2YXIgcHRyID0gc2VsZi5fdW5zYWZlX25leHRQdHI7CiAgICAgICAgIHZhciBpdGVtTGVuZ3RoID0gX2l0ZW1MZW5ndGgocHRyKTsKICAgICAgICAgc3ViSXRlbS5fdW5zYWZlX21lbVB0ciA9IHB0cjsKICAgICAgICAgc3ViSXRlbS5fdW5zYWZlX2xlbmd0aCA9IGl0ZW1MZW5ndGg7CiAgICAgICAgIHNlbGYuX3Vuc2FmZV9uZXh0UHRyID0gcHRyICsgaXRlbUxlbmd0aDsKICAgICB9CiAgICAgZWxzZQogICAgICAgICB0aHJvdzsKIH0KCiBmdW5jdGlvbiBuZXh0KEl0ZXJhdG9yIG1lbW9yeSBzZWxmLCBib29sIHN0cmljdCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoUkxQSXRlbSBtZW1vcnkgc3ViSXRlbSkgewogICAgIHN1Ykl0ZW0gPSBuZXh0KHNlbGYpOwogICAgIGlmKHN0cmljdCAmJiAhX3ZhbGlkYXRlKHN1Ykl0ZW0pKQogICAgICAgICB0aHJvdzsKICAgICByZXR1cm47CiB9CgogZnVuY3Rpb24gaGFzTmV4dChJdGVyYXRvciBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgIHZhciBpdGVtID0gc2VsZi5fdW5zYWZlX2l0ZW07CiAgICAgcmV0dXJuIHNlbGYuX3Vuc2FmZV9uZXh0UHRyIDwgaXRlbS5fdW5zYWZlX21lbVB0ciArIGl0ZW0uX3Vuc2FmZV9sZW5ndGg7CiB9CgogLyogUkxQSXRlbSAqLwoKIC8vLyBAZGV2IENyZWF0ZXMgYW4gUkxQSXRlbSBmcm9tIGFuIGFycmF5IG9mIFJMUCBlbmNvZGVkIGJ5dGVzLgogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFAgZW5jb2RlZCBieXRlcy4KIC8vLyBAcmV0dXJuIEFuIFJMUEl0ZW0KIGZ1bmN0aW9uIHRvUkxQSXRlbShieXRlcyBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoUkxQSXRlbSBtZW1vcnkpIHsKICAgICB1aW50IGxlbiA9IHNlbGYubGVuZ3RoOwogICAgIGlmIChsZW4gPT0gMCkgewogICAgICAgICByZXR1cm4gUkxQSXRlbSgwLCAwKTsKICAgICB9CiAgICAgdWludCBtZW1QdHI7CiAgICAgYXNzZW1ibHkgewogICAgICAgICBtZW1QdHIgOj0gYWRkKHNlbGYsIDB4MjApCiAgICAgfQogICAgIHJldHVybiBSTFBJdGVtKG1lbVB0ciwgbGVuKTsKIH0KCiAvLy8gQGRldiBDcmVhdGVzIGFuIFJMUEl0ZW0gZnJvbSBhbiBhcnJheSBvZiBSTFAgZW5jb2RlZCBieXRlcy4KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQIGVuY29kZWQgYnl0ZXMuCiAvLy8gQHBhcmFtIHN0cmljdCBXaWxsIHRocm93IGlmIHRoZSBkYXRhIGlzIG5vdCBSTFAgZW5jb2RlZC4KIC8vLyBAcmV0dXJuIEFuIFJMUEl0ZW0KIGZ1bmN0aW9uIHRvUkxQSXRlbShieXRlcyBtZW1vcnkgc2VsZiwgYm9vbCBzdHJpY3QpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKFJMUEl0ZW0gbWVtb3J5KSB7CiAgICAgdmFyIGl0ZW0gPSB0b1JMUEl0ZW0oc2VsZik7CiAgICAgaWYoc3RyaWN0KSB7CiAgICAgICAgIHVpbnQgbGVuID0gc2VsZi5sZW5ndGg7CiAgICAgICAgIGlmKF9wYXlsb2FkT2Zmc2V0KGl0ZW0pID4gbGVuKQogICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgIGlmKF9pdGVtTGVuZ3RoKGl0ZW0uX3Vuc2FmZV9tZW1QdHIpICE9IGxlbikKICAgICAgICAgICAgIHRocm93OwogICAgICAgICBpZighX3ZhbGlkYXRlKGl0ZW0pKQogICAgICAgICAgICAgdGhyb3c7CiAgICAgfQogICAgIHJldHVybiBpdGVtOwogfQoKIC8vLyBAZGV2IENoZWNrIGlmIHRoZSBSTFAgaXRlbSBpcyBudWxsLgogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFAgaXRlbS4KIC8vLyBAcmV0dXJuICd0cnVlJyBpZiB0aGUgaXRlbSBpcyBudWxsLgogZnVuY3Rpb24gaXNOdWxsKFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wgcmV0KSB7CiAgICAgcmV0dXJuIHNlbGYuX3Vuc2FmZV9sZW5ndGggPT0gMDsKIH0KCiAvLy8gQGRldiBDaGVjayBpZiB0aGUgUkxQIGl0ZW0gaXMgYSBsaXN0LgogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFAgaXRlbS4KIC8vLyBAcmV0dXJuICd0cnVlJyBpZiB0aGUgaXRlbSBpcyBhIGxpc3QuCiBmdW5jdGlvbiBpc0xpc3QoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCByZXQpIHsKICAgICBpZiAoc2VsZi5fdW5zYWZlX2xlbmd0aCA9PSAwKQogICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgdWludCBtZW1QdHIgPSBzZWxmLl91bnNhZmVfbWVtUHRyOwogICAgIGFzc2VtYmx5IHsKICAgICAgICAgcmV0IDo9IGlzemVybyhsdChieXRlKDAsIG1sb2FkKG1lbVB0cikpLCAweEMwKSkKICAgICB9CiB9CgogLy8vIEBkZXYgQ2hlY2sgaWYgdGhlIFJMUCBpdGVtIGlzIGRhdGEuCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUCBpdGVtLgogLy8vIEByZXR1cm4gJ3RydWUnIGlmIHRoZSBpdGVtIGlzIGRhdGEuCiBmdW5jdGlvbiBpc0RhdGEoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCByZXQpIHsKICAgICBpZiAoc2VsZi5fdW5zYWZlX2xlbmd0aCA9PSAwKQogICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgdWludCBtZW1QdHIgPSBzZWxmLl91bnNhZmVfbWVtUHRyOwogICAgIGFzc2VtYmx5IHsKICAgICAgICAgcmV0IDo9IGx0KGJ5dGUoMCwgbWxvYWQobWVtUHRyKSksIDB4QzApCiAgICAgfQogfQoKIC8vLyBAZGV2IENoZWNrIGlmIHRoZSBSTFAgaXRlbSBpcyBlbXB0eSAoc3RyaW5nIG9yIGxpc3QpLgogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFAgaXRlbS4KIC8vLyBAcmV0dXJuICd0cnVlJyBpZiB0aGUgaXRlbSBpcyBudWxsLgogZnVuY3Rpb24gaXNFbXB0eShSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sIHJldCkgewogICAgIGlmKGlzTnVsbChzZWxmKSkKICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgIHVpbnQgYjA7CiAgICAgdWludCBtZW1QdHIgPSBzZWxmLl91bnNhZmVfbWVtUHRyOwogICAgIGFzc2VtYmx5IHsKICAgICAgICAgYjAgOj0gYnl0ZSgwLCBtbG9hZChtZW1QdHIpKQogICAgIH0KICAgICByZXR1cm4gKGIwID09IERBVEFfU0hPUlRfU1RBUlQgfHwgYjAgPT0gTElTVF9TSE9SVF9TVEFSVCk7CiB9CgogLy8vIEBkZXYgR2V0IHRoZSBudW1iZXIgb2YgaXRlbXMgaW4gYW4gUkxQIGVuY29kZWQgbGlzdC4KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQIGl0ZW0uCiAvLy8gQHJldHVybiBUaGUgbnVtYmVyIG9mIGl0ZW1zLgogZnVuY3Rpb24gaXRlbXMoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgIGlmICghaXNMaXN0KHNlbGYpKQogICAgICAgICByZXR1cm4gMDsKICAgICB1aW50IGIwOwogICAgIHVpbnQgbWVtUHRyID0gc2VsZi5fdW5zYWZlX21lbVB0cjsKICAgICBhc3NlbWJseSB7CiAgICAgICAgIGIwIDo9IGJ5dGUoMCwgbWxvYWQobWVtUHRyKSkKICAgICB9CiAgICAgdWludCBwb3MgPSBtZW1QdHIgKyBfcGF5bG9hZE9mZnNldChzZWxmKTsKICAgICB1aW50IGxhc3QgPSBtZW1QdHIgKyBzZWxmLl91bnNhZmVfbGVuZ3RoIC0gMTsKICAgICB1aW50IGl0bXM7CiAgICAgd2hpbGUocG9zIDw9IGxhc3QpIHsKICAgICAgICAgcG9zICs9IF9pdGVtTGVuZ3RoKHBvcyk7CiAgICAgICAgIGl0bXMrKzsKICAgICB9CiAgICAgcmV0dXJuIGl0bXM7CiB9CgogLy8vIEBkZXYgQ3JlYXRlIGFuIGl0ZXJhdG9yLgogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFAgaXRlbS4KIC8vLyBAcmV0dXJuIEFuICdJdGVyYXRvcicgb3ZlciB0aGUgaXRlbS4KIGZ1bmN0aW9uIGl0ZXJhdG9yKFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKEl0ZXJhdG9yIG1lbW9yeSBpdCkgewogICAgIGlmICghaXNMaXN0KHNlbGYpKQogICAgICAgICB0aHJvdzsKICAgICB1aW50IHB0ciA9IHNlbGYuX3Vuc2FmZV9tZW1QdHIgKyBfcGF5bG9hZE9mZnNldChzZWxmKTsKICAgICBpdC5fdW5zYWZlX2l0ZW0gPSBzZWxmOwogICAgIGl0Ll91bnNhZmVfbmV4dFB0ciA9IHB0cjsKIH0KCiAvLy8gQGRldiBSZXR1cm4gdGhlIFJMUCBlbmNvZGVkIGJ5dGVzLgogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFBJdGVtLgogLy8vIEByZXR1cm4gVGhlIGJ5dGVzLgogZnVuY3Rpb24gdG9CeXRlcyhSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChieXRlcyBtZW1vcnkgYnRzKSB7CiAgICAgdmFyIGxlbiA9IHNlbGYuX3Vuc2FmZV9sZW5ndGg7CiAgICAgaWYgKGxlbiA9PSAwKQogICAgICAgICByZXR1cm47CiAgICAgYnRzID0gbmV3IGJ5dGVzKGxlbik7CiAgICAgX2NvcHlUb0J5dGVzKHNlbGYuX3Vuc2FmZV9tZW1QdHIsIGJ0cywgbGVuKTsKIH0KCiAvLy8gQGRldiBEZWNvZGUgYW4gUkxQSXRlbSBpbnRvIGJ5dGVzLiBUaGlzIHdpbGwgbm90IHdvcmsgaWYgdGhlCiAvLy8gUkxQSXRlbSBpcyBhIGxpc3QuCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUEl0ZW0uCiAvLy8gQHJldHVybiBUaGUgZGVjb2RlZCBzdHJpbmcuCiBmdW5jdGlvbiB0b0RhdGEoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMgbWVtb3J5IGJ0cykgewogICAgIGlmKCFpc0RhdGEoc2VsZikpCiAgICAgICAgIHRocm93OwogICAgIHZhciAoclN0YXJ0UG9zLCBsZW4pID0gX2RlY29kZShzZWxmKTsKICAgICBidHMgPSBuZXcgYnl0ZXMobGVuKTsKICAgICBfY29weVRvQnl0ZXMoclN0YXJ0UG9zLCBidHMsIGxlbik7CiB9CgogLy8vIEBkZXYgR2V0IHRoZSBsaXN0IG9mIHN1Yi1pdGVtcyBmcm9tIGFuIFJMUCBlbmNvZGVkIGxpc3QuCiAvLy8gV2FybmluZzogVGhpcyBpcyBpbmVmZmljaWVudCwgYXMgaXQgcmVxdWlyZXMgdGhhdCB0aGUgbGlzdCBpcyByZWFkIHR3aWNlLgogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFAgaXRlbS4KIC8vLyBAcmV0dXJuIEFycmF5IG9mIFJMUEl0ZW1zLgogZnVuY3Rpb24gdG9MaXN0KFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKFJMUEl0ZW1bXSBtZW1vcnkgbGlzdCkgewogICAgIGlmKCFpc0xpc3Qoc2VsZikpCiAgICAgICAgIHRocm93OwogICAgIHZhciBudW1JdGVtcyA9IGl0ZW1zKHNlbGYpOwogICAgIGxpc3QgPSBuZXcgUkxQSXRlbVtdKG51bUl0ZW1zKTsKICAgICB2YXIgaXQgPSBpdGVyYXRvcihzZWxmKTsKICAgICB1aW50IGlkeDsKICAgICB3aGlsZShoYXNOZXh0KGl0KSkgewogICAgICAgICBsaXN0W2lkeF0gPSBuZXh0KGl0KTsKICAgICAgICAgaWR4Kys7CiAgICAgfQogfQoKIC8vLyBAZGV2IERlY29kZSBhbiBSTFBJdGVtIGludG8gYW4gYXNjaWkgc3RyaW5nLiBUaGlzIHdpbGwgbm90IHdvcmsgaWYgdGhlCiAvLy8gUkxQSXRlbSBpcyBhIGxpc3QuCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUEl0ZW0uCiAvLy8gQHJldHVybiBUaGUgZGVjb2RlZCBzdHJpbmcuCiBmdW5jdGlvbiB0b0FzY2lpKFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHN0cmluZyBtZW1vcnkgc3RyKSB7CiAgICAgaWYoIWlzRGF0YShzZWxmKSkKICAgICAgICAgdGhyb3c7CiAgICAgdmFyIChyU3RhcnRQb3MsIGxlbikgPSBfZGVjb2RlKHNlbGYpOwogICAgIGJ5dGVzIG1lbW9yeSBidHMgPSBuZXcgYnl0ZXMobGVuKTsKICAgICBfY29weVRvQnl0ZXMoclN0YXJ0UG9zLCBidHMsIGxlbik7CiAgICAgc3RyID0gc3RyaW5nKGJ0cyk7CiB9CgogLy8vIEBkZXYgRGVjb2RlIGFuIFJMUEl0ZW0gaW50byBhIHVpbnQuIFRoaXMgd2lsbCBub3Qgd29yayBpZiB0aGUKIC8vLyBSTFBJdGVtIGlzIGEgbGlzdC4KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQSXRlbS4KIC8vLyBAcmV0dXJuIFRoZSBkZWNvZGVkIHN0cmluZy4KIGZ1bmN0aW9uIHRvVWludChSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50IGRhdGEpIHsKICAgICBpZighaXNEYXRhKHNlbGYpKQogICAgICAgICB0aHJvdzsKICAgICB2YXIgKHJTdGFydFBvcywgbGVuKSA9IF9kZWNvZGUoc2VsZik7CiAgICAgaWYgKGxlbiA+IDMyIHx8IGxlbiA9PSAwKQogICAgICAgICB0aHJvdzsKICAgICBhc3NlbWJseSB7CiAgICAgICAgIGRhdGEgOj0gZGl2KG1sb2FkKHJTdGFydFBvcyksIGV4cCgyNTYsIHN1YigzMiwgbGVuKSkpCiAgICAgfQogfQoKIC8vLyBAZGV2IERlY29kZSBhbiBSTFBJdGVtIGludG8gYSBib29sZWFuLiBUaGlzIHdpbGwgbm90IHdvcmsgaWYgdGhlCiAvLy8gUkxQSXRlbSBpcyBhIGxpc3QuCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUEl0ZW0uCiAvLy8gQHJldHVybiBUaGUgZGVjb2RlZCBzdHJpbmcuCiBmdW5jdGlvbiB0b0Jvb2woUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBkYXRhKSB7CiAgICAgaWYoIWlzRGF0YShzZWxmKSkKICAgICAgICAgdGhyb3c7CiAgICAgdmFyIChyU3RhcnRQb3MsIGxlbikgPSBfZGVjb2RlKHNlbGYpOwogICAgIGlmIChsZW4gIT0gMSkKICAgICAgICAgdGhyb3c7CiAgICAgdWludCB0ZW1wOwogICAgIGFzc2VtYmx5IHsKICAgICAgICAgdGVtcCA6PSBieXRlKDAsIG1sb2FkKHJTdGFydFBvcykpCiAgICAgfQogICAgIGlmICh0ZW1wID4gMSkKICAgICAgICAgdGhyb3c7CiAgICAgcmV0dXJuIHRlbXAgPT0gMSA/IHRydWUgOiBmYWxzZTsKIH0KCiAvLy8gQGRldiBEZWNvZGUgYW4gUkxQSXRlbSBpbnRvIGEgYnl0ZS4gVGhpcyB3aWxsIG5vdCB3b3JrIGlmIHRoZQogLy8vIFJMUEl0ZW0gaXMgYSBsaXN0LgogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFBJdGVtLgogLy8vIEByZXR1cm4gVGhlIGRlY29kZWQgc3RyaW5nLgogZnVuY3Rpb24gdG9CeXRlKFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJ5dGUgZGF0YSkgewogICAgIGlmKCFpc0RhdGEoc2VsZikpCiAgICAgICAgIHRocm93OwogICAgIHZhciAoclN0YXJ0UG9zLCBsZW4pID0gX2RlY29kZShzZWxmKTsKICAgICBpZiAobGVuICE9IDEpCiAgICAgICAgIHRocm93OwogICAgIHVpbnQgdGVtcDsKICAgICBhc3NlbWJseSB7CiAgICAgICAgIHRlbXAgOj0gYnl0ZSgwLCBtbG9hZChyU3RhcnRQb3MpKQogICAgIH0KICAgICByZXR1cm4gYnl0ZSh0ZW1wKTsKIH0KCiAvLy8gQGRldiBEZWNvZGUgYW4gUkxQSXRlbSBpbnRvIGFuIGludC4gVGhpcyB3aWxsIG5vdCB3b3JrIGlmIHRoZQogLy8vIFJMUEl0ZW0gaXMgYSBsaXN0LgogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFBJdGVtLgogLy8vIEByZXR1cm4gVGhlIGRlY29kZWQgc3RyaW5nLgogZnVuY3Rpb24gdG9JbnQoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoaW50IGRhdGEpIHsKICAgICByZXR1cm4gaW50KHRvVWludChzZWxmKSk7CiB9CgogLy8vIEBkZXYgRGVjb2RlIGFuIFJMUEl0ZW0gaW50byBhIGJ5dGVzMzIuIFRoaXMgd2lsbCBub3Qgd29yayBpZiB0aGUKIC8vLyBSTFBJdGVtIGlzIGEgbGlzdC4KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQSXRlbS4KIC8vLyBAcmV0dXJuIFRoZSBkZWNvZGVkIHN0cmluZy4KIGZ1bmN0aW9uIHRvQnl0ZXMzMihSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChieXRlczMyIGRhdGEpIHsKICAgICByZXR1cm4gYnl0ZXMzMih0b1VpbnQoc2VsZikpOwogfQoKIC8vLyBAZGV2IERlY29kZSBhbiBSTFBJdGVtIGludG8gYW4gYWRkcmVzcy4gVGhpcyB3aWxsIG5vdCB3b3JrIGlmIHRoZQogLy8vIFJMUEl0ZW0gaXMgYSBsaXN0LgogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFBJdGVtLgogLy8vIEByZXR1cm4gVGhlIGRlY29kZWQgc3RyaW5nLgogZnVuY3Rpb24gdG9BZGRyZXNzKFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MgZGF0YSkgewogICAgIGlmKCFpc0RhdGEoc2VsZikpCiAgICAgICAgIHRocm93OwogICAgIHZhciAoclN0YXJ0UG9zLCBsZW4pID0gX2RlY29kZShzZWxmKTsKICAgICBpZiAobGVuICE9IDIwKQogICAgICAgICB0aHJvdzsKICAgICBhc3NlbWJseSB7CiAgICAgICAgIGRhdGEgOj0gZGl2KG1sb2FkKHJTdGFydFBvcyksIGV4cCgyNTYsIDEyKSkKICAgICB9CiB9CgogLy8gR2V0IHRoZSBwYXlsb2FkIG9mZnNldC4KIGZ1bmN0aW9uIF9wYXlsb2FkT2Zmc2V0KFJMUEl0ZW0gbWVtb3J5IHNlbGYpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgIGlmKHNlbGYuX3Vuc2FmZV9sZW5ndGggPT0gMCkKICAgICAgICAgcmV0dXJuIDA7CiAgICAgdWludCBiMDsKICAgICB1aW50IG1lbVB0ciA9IHNlbGYuX3Vuc2FmZV9tZW1QdHI7CiAgICAgYXNzZW1ibHkgewogICAgICAgICBiMCA6PSBieXRlKDAsIG1sb2FkKG1lbVB0cikpCiAgICAgfQogICAgIGlmKGIwIDwgREFUQV9TSE9SVF9TVEFSVCkKICAgICAgICAgcmV0dXJuIDA7CiAgICAgaWYoYjAgPCBEQVRBX0xPTkdfU1RBUlQgfHwgKGIwID49IExJU1RfU0hPUlRfU1RBUlQgJiYgYjAgPCBMSVNUX0xPTkdfU1RBUlQpKQogICAgICAgICByZXR1cm4gMTsKICAgICBpZihiMCA8IExJU1RfU0hPUlRfU1RBUlQpCiAgICAgICAgIHJldHVybiBiMCAtIERBVEFfTE9OR19PRkZTRVQgKyAxOwogICAgIHJldHVybiBiMCAtIExJU1RfTE9OR19PRkZTRVQgKyAxOwogfQoKIC8vIEdldCB0aGUgZnVsbCBsZW5ndGggb2YgYW4gUkxQIGl0ZW0uCiBmdW5jdGlvbiBfaXRlbUxlbmd0aCh1aW50IG1lbVB0cikgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50IGxlbikgewogICAgIHVpbnQgYjA7CiAgICAgYXNzZW1ibHkgewogICAgICAgICBiMCA6PSBieXRlKDAsIG1sb2FkKG1lbVB0cikpCiAgICAgfQogICAgIGlmIChiMCA8IERBVEFfU0hPUlRfU1RBUlQpCiAgICAgICAgIGxlbiA9IDE7CiAgICAgZWxzZSBpZiAoYjAgPCBEQVRBX0xPTkdfU1RBUlQpCiAgICAgICAgIGxlbiA9IGIwIC0gREFUQV9TSE9SVF9TVEFSVCArIDE7CiAgICAgZWxzZSBpZiAoYjAgPCBMSVNUX1NIT1JUX1NUQVJUKSB7CiAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgIGxldCBiTGVuIDo9IHN1YihiMCwgMHhCNykgLy8gYnl0ZXMgbGVuZ3RoIChEQVRBX0xPTkdfT0ZGU0VUKQogICAgICAgICAgICAgbGV0IGRMZW4gOj0gZGl2KG1sb2FkKGFkZChtZW1QdHIsIDEpKSwgZXhwKDI1Niwgc3ViKDMyLCBiTGVuKSkpIC8vIGRhdGEgbGVuZ3RoCiAgICAgICAgICAgICBsZW4gOj0gYWRkKDEsIGFkZChiTGVuLCBkTGVuKSkgLy8gdG90YWwgbGVuZ3RoCiAgICAgICAgIH0KICAgICB9CiAgICAgZWxzZSBpZiAoYjAgPCBMSVNUX0xPTkdfU1RBUlQpCiAgICAgICAgIGxlbiA9IGIwIC0gTElTVF9TSE9SVF9TVEFSVCArIDE7CiAgICAgZWxzZSB7CiAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgIGxldCBiTGVuIDo9IHN1YihiMCwgMHhGNykgLy8gYnl0ZXMgbGVuZ3RoIChMSVNUX0xPTkdfT0ZGU0VUKQogICAgICAgICAgICAgbGV0IGRMZW4gOj0gZGl2KG1sb2FkKGFkZChtZW1QdHIsIDEpKSwgZXhwKDI1Niwgc3ViKDMyLCBiTGVuKSkpIC8vIGRhdGEgbGVuZ3RoCiAgICAgICAgICAgICBsZW4gOj0gYWRkKDEsIGFkZChiTGVuLCBkTGVuKSkgLy8gdG90YWwgbGVuZ3RoCiAgICAgICAgIH0KICAgICB9CiB9CgogLy8gR2V0IHN0YXJ0IHBvc2l0aW9uIGFuZCBsZW5ndGggb2YgdGhlIGRhdGEuCiBmdW5jdGlvbiBfZGVjb2RlKFJMUEl0ZW0gbWVtb3J5IHNlbGYpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludCBtZW1QdHIsIHVpbnQgbGVuKSB7CiAgICAgaWYoIWlzRGF0YShzZWxmKSkKICAgICAgICAgdGhyb3c7CiAgICAgdWludCBiMDsKICAgICB1aW50IHN0YXJ0ID0gc2VsZi5fdW5zYWZlX21lbVB0cjsKICAgICBhc3NlbWJseSB7CiAgICAgICAgIGIwIDo9IGJ5dGUoMCwgbWxvYWQoc3RhcnQpKQogICAgIH0KICAgICBpZiAoYjAgPCBEQVRBX1NIT1JUX1NUQVJUKSB7CiAgICAgICAgIG1lbVB0ciA9IHN0YXJ0OwogICAgICAgICBsZW4gPSAxOwogICAgICAgICByZXR1cm47CiAgICAgfQogICAgIGlmIChiMCA8IERBVEFfTE9OR19TVEFSVCkgewogICAgICAgICBsZW4gPSBzZWxmLl91bnNhZmVfbGVuZ3RoIC0gMTsKICAgICAgICAgbWVtUHRyID0gc3RhcnQgKyAxOwogICAgIH0gZWxzZSB7CiAgICAgICAgIHVpbnQgYkxlbjsKICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgYkxlbiA6PSBzdWIoYjAsIDB4QjcpIC8vIERBVEFfTE9OR19PRkZTRVQKICAgICAgICAgfQogICAgICAgICBsZW4gPSBzZWxmLl91bnNhZmVfbGVuZ3RoIC0gMSAtIGJMZW47CiAgICAgICAgIG1lbVB0ciA9IHN0YXJ0ICsgYkxlbiArIDE7CiAgICAgfQogICAgIHJldHVybjsKIH0KCiAvLyBBc3N1bWVzIHRoYXQgZW5vdWdoIG1lbW9yeSBoYXMgYmVlbiBhbGxvY2F0ZWQgdG8gc3RvcmUgaW4gdGFyZ2V0LgogZnVuY3Rpb24gX2NvcHlUb0J5dGVzKHVpbnQgYnRzUHRyLCBieXRlcyBtZW1vcnkgdGd0LCB1aW50IGJ0c0xlbikgcHJpdmF0ZSBjb25zdGFudCB7CiAgICAgLy8gRXhwbG9pdGluZyB0aGUgZmFjdCB0aGF0ICd0Z3QnIHdhcyB0aGUgbGFzdCB0aGluZyB0byBiZSBhbGxvY2F0ZWQsCiAgICAgLy8gd2UgY2FuIHdyaXRlIGVudGlyZSB3b3JkcywgYW5kIGp1c3Qgb3ZlcndyaXRlIGFueSBleGNlc3MuCiAgICAgYXNzZW1ibHkgewogICAgICAgICB7CiAgICAgICAgICAgICAgICAgbGV0IGkgOj0gMCAvLyBTdGFydCBhdCBhcnIgKyAweDIwCiAgICAgICAgICAgICAgICAgbGV0IHdvcmRzIDo9IGRpdihhZGQoYnRzTGVuLCAzMSksIDMyKQogICAgICAgICAgICAgICAgIGxldCByT2Zmc2V0IDo9IGJ0c1B0cgogICAgICAgICAgICAgICAgIGxldCB3T2Zmc2V0IDo9IGFkZCh0Z3QsIDB4MjApCiAgICAgICAgICAgICB0YWdfbG9vcDoKICAgICAgICAgICAgICAgICBqdW1waShlbmQsIGVxKGksIHdvcmRzKSkKICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIGxldCBvZmZzZXQgOj0gbXVsKGksIDB4MjApCiAgICAgICAgICAgICAgICAgICAgIG1zdG9yZShhZGQod09mZnNldCwgb2Zmc2V0KSwgbWxvYWQoYWRkKHJPZmZzZXQsIG9mZnNldCkpKQogICAgICAgICAgICAgICAgICAgICBpIDo9IGFkZChpLCAxKQogICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICBqdW1wKHRhZ19sb29wKQogICAgICAgICAgICAgZW5kOgogICAgICAgICAgICAgICAgIG1zdG9yZShhZGQodGd0LCBhZGQoMHgyMCwgbWxvYWQodGd0KSkpLCAwKQogICAgICAgICB9CiAgICAgfQogfQoKIC8vIENoZWNrIHRoYXQgYW4gUkxQIGl0ZW0gaXMgdmFsaWQuCiAgICAgZnVuY3Rpb24gX3ZhbGlkYXRlKFJMUEl0ZW0gbWVtb3J5IHNlbGYpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAoYm9vbCByZXQpIHsKICAgICAgICAgLy8gQ2hlY2sgdGhhdCBSTFAgaXMgd2VsbC1mb3JtZWQuCiAgICAgICAgIHVpbnQgYjA7CiAgICAgICAgIHVpbnQgYjE7CiAgICAgICAgIHVpbnQgbWVtUHRyID0gc2VsZi5fdW5zYWZlX21lbVB0cjsKICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgYjAgOj0gYnl0ZSgwLCBtbG9hZChtZW1QdHIpKQogICAgICAgICAgICAgYjEgOj0gYnl0ZSgxLCBtbG9hZChtZW1QdHIpKQogICAgICAgICB9CiAgICAgICAgIGlmKGIwID09IERBVEFfU0hPUlRfU1RBUlQgKyAxICYmIGIxIDwgREFUQV9TSE9SVF9TVEFSVCkKICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgfQp9CgovKgogICAgQ29weXJpZ2h0IDIwMTYsIEpvcmRpIEJheWxpbmEKCiAgICBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQogICAgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkKICAgIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yCiAgICAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgoKICAgIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAogICAgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKICAgIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUKICAgIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCgogICAgWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UKICAgIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LgogKi8KCi8vLyBAdGl0bGUgTWlsZXN0b25lVHJhY2tlciBDb250cmFjdAovLy8gQGF1dGhvciBKb3JkaSBCYXlsaW5hCi8vLyBAZGV2IFRoaXMgY29udHJhY3QgdHJhY2tzIHRoZQoKCi8vLyBpcyBydWxlcyB0aGUgcmVsYXRpb24gYmV0d2VuIGEgZG9ub3IgYW5kIGEgcmVjaXBpZW50Ci8vLyAgaW4gb3JkZXIgdG8gZ3VhcmFudHkgdG8gdGhlIGRvbm9yIHRoYXQgdGhlIGpvYiB3aWxsIGJlIGRvbmUgYW5kIHRvIGd1YXJhbnR5Ci8vLyAgdG8gdGhlIHJlY2lwaWVudCB0aGF0IGhlIHdpbGwgYmUgcGFpZAoKCi8vLyBAZGV2IFdlIHVzZSB0aGUgUkxQIGxpYnJhcnkgdG8gZGVjb2RlIFJMUCBzbyB0aGF0IHRoZSBkb25vciBjYW4gYXBwcm92ZSBvbmUKLy8vICBzZXQgb2YgbWlsZXN0b25lIGNoYW5nZXMgYXQgYSB0aW1lLgovLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9hbmRyb2xvL3N0YW5kYXJkLWNvbnRyYWN0cy9ibG9iL21hc3Rlci9jb250cmFjdHMvc3JjL2NvZGVjL1JMUC5zb2wKLy8gaW1wb3J0ICJSTFAuc29sIjsKCgoKLy8vIEBkZXYgVGhpcyBjb250cmFjdCBhbGxvd3MgZm9yIGByZWNpcGllbnRgIHRvIHNldCBhbmQgbW9kaWZ5IG1pbGVzdG9uZXMKY29udHJhY3QgTWlsZXN0b25lVHJhY2tlciB7CiAgICB1c2luZyBSTFAgZm9yIFJMUC5STFBJdGVtOwogICAgdXNpbmcgUkxQIGZvciBSTFAuSXRlcmF0b3I7CiAgICB1c2luZyBSTFAgZm9yIGJ5dGVzOwoKICAgIHN0cnVjdCBNaWxlc3RvbmUgewogICAgICAgIHN0cmluZyBkZXNjcmlwdGlvbjsgICAgIC8vIERlc2NyaXB0aW9uIG9mIHRoZSBtaWxlc3RvbmUKICAgICAgICBzdHJpbmcgdXJsOyAgICAgICAgICAgICAvLyBBIGxpbmsgdG8gbW9yZSBpbmZvcm1hdGlvbiAoc3dhcm0gZ2F0ZXdheSkKICAgICAgICB1aW50IG1pbkNvbXBsZXRpb25EYXRlOyAgICAgICAvLyBFYXJsaWVzdCBVTklYIHRpbWUgdGhlIG1pbGVzdG9uZSBjYW4gYmUgcGFpZAogICAgICAgIHVpbnQgbWF4Q29tcGxldGlvbkRhdGU7ICAgICAgIC8vIExhdGVzdCBVTklYIHRpbWUgdGhlIG1pbGVzdG9uZSBjYW4gYmUgcGFpZAogICAgICAgIGFkZHJlc3MgcmV2aWV3ZXI7ICAgICAgIC8vIFdobyB3aWxsIGNoZWNrIHRoZSBtaWxlc3RvbmUgaGFzIGNvbXBsZXRlZAogICAgICAgIHVpbnQgcmV2aWV3VGltZTsgICAgICAgIC8vIEhvdyBtYW55IHNlY29uZHMgdGhlIHJldmlld2VyIGhhcyB0byByZXZpZXcKICAgICAgICBhZGRyZXNzIHBheW1lbnRTb3VyY2U7ICAvLyBXaGVyZSB0aGUgbWlsZXN0b25lIHBheW1lbnQgaXMgc2VudCBmcm9tCiAgICAgICAgYnl0ZXMgcGF5RGF0YTsgICAgICAgICAgLy8gRGF0YSBkZWZpbmluZyBob3cgbXVjaCBldGhlciBpcyBzZW50IHdoZXJlCgogICAgICAgIE1pbGVzdG9uZVN0YXR1cyBzdGF0dXM7IC8vIEN1cnJlbnQgc3RhdHVzIG9mIHRoZSBtaWxlc3RvbmUgKENvbXBsZXRlZCwgUGFpZC4uLikKICAgICAgICB1aW50IGRvbmVUaW1lOyAgICAgICAgICAvLyBVTklYIHRpbWUgd2hlbiB0aGUgbWlsZXN0b25lIHdhcyBtYXJrZWQgRE9ORQogICAgfQoKICAgIC8vIFRoZSBsaXN0IG9mIGFsbCB0aGUgbWlsZXN0b25lcy4KICAgIE1pbGVzdG9uZVtdIHB1YmxpYyBtaWxlc3RvbmVzOwoKICAgIGFkZHJlc3MgcHVibGljIHJlY2lwaWVudDsgICAvLyBDYWxscyBmdW5jdGlvbnMgaW4gdGhlIG5hbWUgb2YgdGhlIHJlY2lwaWVudAogICAgYWRkcmVzcyBwdWJsaWMgZG9ub3I7ICAgICAgIC8vIENhbGxzIGZ1bmN0aW9ucyBpbiB0aGUgbmFtZSBvZiB0aGUgZG9ub3IKICAgIGFkZHJlc3MgcHVibGljIGFyYml0cmF0b3I7ICAvLyBDYWxscyBmdW5jdGlvbnMgaW4gdGhlIG5hbWUgb2YgdGhlIGFyYml0cmF0b3IKCiAgICBlbnVtIE1pbGVzdG9uZVN0YXR1cyB7IEFjY2VwdGVkQW5kSW5Qcm9ncmVzcywgQ29tcGxldGVkLCBQYWlkLCBDYW5jZWxlZCB9CgogICAgLy8gVHJ1ZSBpZiB0aGUgY2FtcGFpZ24gaGFzIGJlZW4gY2FuY2VsZWQKICAgIGJvb2wgcHVibGljIGNhbXBhaWduQ2FuY2VsZWQ7CgogICAgLy8gVHJ1ZSBpZiBhbiBhcHByb3ZhbCBvbiBhIGNoYW5nZSB0byBgbWlsZXN0b25lc2AgaXMgYSBwZW5kaW5nCiAgICBib29sIHB1YmxpYyBjaGFuZ2luZ01pbGVzdG9uZXM7CgogICAgLy8gVGhlIHBlbmRpbmcgY2hhbmdlIHRvIGBtaWxlc3RvbmVzYCBlbmNvZGVkIGluIFJMUAogICAgYnl0ZXMgcHVibGljIHByb3Bvc2VkTWlsZXN0b25lczsKCgogICAgLy8vIEBkZXYgVGhlIGZvbGxvd2luZyBtb2RpZmllcnMgb25seSBhbGxvdyBzcGVjaWZpYyByb2xlcyB0byBjYWxsIGZ1bmN0aW9ucwogICAgLy8vIHdpdGggdGhlc2UgbW9kaWZpZXJzCiAgICBtb2RpZmllciBvbmx5UmVjaXBpZW50IHsgaWYgKG1zZy5zZW5kZXIgIT0gIHJlY2lwaWVudCkgdGhyb3c7IF87IH0KICAgIG1vZGlmaWVyIG9ubHlBcmJpdHJhdG9yIHsgaWYgKG1zZy5zZW5kZXIgIT0gYXJiaXRyYXRvcikgdGhyb3c7IF87IH0KICAgIG1vZGlmaWVyIG9ubHlEb25vciB7IGlmIChtc2cuc2VuZGVyICE9IGRvbm9yKSB0aHJvdzsgXzsgfQoKICAgIC8vLyBAZGV2IFRoZSBmb2xsb3dpbmcgbW9kaWZpZXJzIHByZXZlbnQgZnVuY3Rpb25zIGZyb20gYmVpbmcgY2FsbGVkIGlmIHRoZQogICAgLy8vIGNhbXBhaWduIGhhcyBiZWVuIGNhbmNlbGVkIG9yIGlmIG5ldyBtaWxlc3RvbmVzIGFyZSBiZWluZyBwcm9wb3NlZAogICAgbW9kaWZpZXIgY2FtcGFpZ25Ob3RDYW5jZWxlZCB7IGlmIChjYW1wYWlnbkNhbmNlbGVkKSB0aHJvdzsgXzsgfQogICAgbW9kaWZpZXIgbm90Q2hhbmdpbmcgeyBpZiAoY2hhbmdpbmdNaWxlc3RvbmVzKSB0aHJvdzsgXzsgfQoKIC8vIEBkZXYgRXZlbnRzIHRvIG1ha2UgdGhlIHBheW1lbnQgbW92ZW1lbnRzIGVhc3kgdG8gZmluZCBvbiB0aGUgYmxvY2tjaGFpbgogICAgZXZlbnQgTmV3TWlsZXN0b25lTGlzdFByb3Bvc2VkKCk7CiAgICBldmVudCBOZXdNaWxlc3RvbmVMaXN0VW5wcm9wb3NlZCgpOwogICAgZXZlbnQgTmV3TWlsZXN0b25lTGlzdEFjY2VwdGVkKCk7CiAgICBldmVudCBQcm9wb3NhbFN0YXR1c0NoYW5nZWQodWludCBpZFByb3Bvc2FsLCBNaWxlc3RvbmVTdGF0dXMgbmV3UHJvcG9zYWwpOwogICAgZXZlbnQgQ2FtcGFpZ25DYWxuY2VsbGVkKCk7CgoKLy8vLy8vLy8vLy8KLy8gQ29uc3RydWN0b3IKLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBUaGUgQ29uc3RydWN0b3IgY3JlYXRlcyB0aGUgTWlsZXN0b25lIGNvbnRyYWN0IG9uIHRoZSBibG9ja2NoYWluCiAgICAvLy8gQHBhcmFtIF9hcmJpdHJhdG9yIEFkZHJlc3MgYXNzaWduZWQgdG8gYmUgdGhlIGFyYml0cmF0b3IKICAgIC8vLyBAcGFyYW0gX2Rvbm9yIEFkZHJlc3MgYXNzaWduZWQgdG8gYmUgdGhlIGRvbm9yCiAgICAvLy8gQHBhcmFtIF9yZWNpcGllbnQgQWRkcmVzcyBhc3NpZ25lZCB0byBiZSB0aGUgcmVjaXBpZW50CiAgICBmdW5jdGlvbiBNaWxlc3RvbmVUcmFja2VyICgKICAgICAgICBhZGRyZXNzIF9hcmJpdHJhdG9yLAogICAgICAgIGFkZHJlc3MgX2Rvbm9yLAogICAgICAgIGFkZHJlc3MgX3JlY2lwaWVudAogICAgKSB7CiAgICAgICAgYXJiaXRyYXRvciA9IF9hcmJpdHJhdG9yOwogICAgICAgIGRvbm9yID0gX2Rvbm9yOwogICAgICAgIHJlY2lwaWVudCA9IF9yZWNpcGllbnQ7CiAgICB9CgoKLy8vLy8vLy8vCi8vIEhlbHBlciBmdW5jdGlvbnMKLy8vLy8vLy8vCgogICAgLy8vIEByZXR1cm4gVGhlIG51bWJlciBvZiBtaWxlc3RvbmVzIGV2ZXIgY3JlYXRlZCBldmVuIGlmIHRoZXkgd2VyZSBjYW5jZWxlZAogICAgZnVuY3Rpb24gbnVtYmVyT2ZNaWxlc3RvbmVzKCkgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBtaWxlc3RvbmVzLmxlbmd0aDsKICAgIH0KCgovLy8vLy8vLwovLyBDaGFuZ2UgcGxheWVycwovLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIGBvbmx5QXJiaXRyYXRvcmAgUmVhc3NpZ25zIHRoZSBhcmJpdHJhdG9yIHRvIGEgbmV3IGFkZHJlc3MKICAgIC8vLyBAcGFyYW0gX25ld0FyYml0cmF0b3IgVGhlIG5ldyBhcmJpdHJhdG9yCiAgICBmdW5jdGlvbiBjaGFuZ2VBcmJpdHJhdG9yKGFkZHJlc3MgX25ld0FyYml0cmF0b3IpIG9ubHlBcmJpdHJhdG9yIHsKICAgICAgICBhcmJpdHJhdG9yID0gX25ld0FyYml0cmF0b3I7CiAgICB9CgogICAgLy8vIEBub3RpY2UgYG9ubHlEb25vcmAgUmVhc3NpZ25zIHRoZSBgZG9ub3JgIHRvIGEgbmV3IGFkZHJlc3MKICAgIC8vLyBAcGFyYW0gX25ld0Rvbm9yIFRoZSBuZXcgZG9ub3IKICAgIGZ1bmN0aW9uIGNoYW5nZURvbm9yKGFkZHJlc3MgX25ld0Rvbm9yKSBvbmx5RG9ub3IgewogICAgICAgIGRvbm9yID0gX25ld0Rvbm9yOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGBvbmx5UmVjaXBpZW50YCBSZWFzc2lnbnMgdGhlIGByZWNpcGllbnRgIHRvIGEgbmV3IGFkZHJlc3MKICAgIC8vLyBAcGFyYW0gX25ld1JlY2lwaWVudCBUaGUgbmV3IHJlY2lwaWVudAogICAgZnVuY3Rpb24gY2hhbmdlUmVjaXBpZW50KGFkZHJlc3MgX25ld1JlY2lwaWVudCkgb25seVJlY2lwaWVudCB7CiAgICAgICAgcmVjaXBpZW50ID0gX25ld1JlY2lwaWVudDsKICAgIH0KCgovLy8vLy8vLy8vLy8KLy8gQ3JlYXRpb24gYW5kIG1vZGlmaWNhdGlvbiBvZiBNaWxlc3RvbmVzCi8vLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIGBvbmx5UmVjaXBpZW50YCBQcm9wb3NlcyBuZXcgbWlsZXN0b25lcyBvciBjaGFuZ2VzIG9sZAogICAgLy8vICBtaWxlc3RvbmVzLCB0aGlzIHdpbGwgcmVxdWlyZSBhIHVzZXIgaW50ZXJmYWNlIHRvIGJlIGJ1aWx0IHVwIHRvCiAgICAvLy8gIHN1cHBvcnQgdGhpcyBmdW5jdGlvbmFsaXR5IGFzIGFza3MgZm9yIFJMUCBlbmNvZGVkIGJ5dGVjb2RlIHRvIGJlCiAgICAvLy8gIGdlbmVyYXRlZCwgdW50aWwgdGhpcyBpbnRlcmZhY2UgaXMgYnVpbHQgeW91IGNhbiB1c2UgdGhpcyBzY3JpcHQ6CiAgICAvLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9HaXZldGgvbWlsZXN0b25ldHJhY2tlci9ibG9iL21hc3Rlci9qcy9taWxlc3RvbmV0cmFja2VyX2hlbHBlci5qcwogICAgLy8vICB0aGUgZnVuY3Rpb25zIG1pbGVzdG9uZXMyYnl0ZXMgYW5kIGJ5dGVzMm1pbGVzdG9uZXMgd2lsbCBlbmFibGUgdGhlCiAgICAvLy8gIHJlY2lwaWVudCB0byBlbmNvZGUgYW5kIGRlY29kZSBhIGxpc3Qgb2YgbWlsZXN0b25lcywgYWxzbyBzZWUKICAgIC8vLyAgaHR0cHM6Ly9naXRodWIuY29tL0dpdmV0aC9taWxlc3RvbmV0cmFja2VyL2Jsb2IvbWFzdGVyL1JFQURNRS5tZAogICAgLy8vIEBwYXJhbSBfbmV3TWlsZXN0b25lcyBUaGUgUkxQIGVuY29kZWQgbGlzdCBvZiBtaWxlc3RvbmVzOyBlYWNoIG1pbGVzdG9uZQogICAgLy8vICBoYXMgdGhlc2UgZmllbGRzOgogICAgLy8vICAgICAgIHN0cmluZyBkZXNjcmlwdGlvbiwKICAgIC8vLyAgICAgICBzdHJpbmcgdXJsLAogICAgLy8vICAgICAgIGFkZHJlc3MgcGF5bWVudFNvdXJjZSwKICAgIC8vLyAgICAgICBieXRlcyBwYXlEYXRhLAogICAgLy8vICAgICAgIHVpbnQgbWluQ29tcGxldGlvbkRhdGUsCiAgICAvLy8gICAgICAgdWludCBtYXhDb21wbGV0aW9uRGF0ZSwKICAgIC8vLyAgICAgICBhZGRyZXNzIHJldmlld2VyLAogICAgLy8vICAgICAgIHVpbnQgcmV2aWV3VGltZQogICAgZnVuY3Rpb24gcHJvcG9zZU1pbGVzdG9uZXMoYnl0ZXMgX25ld01pbGVzdG9uZXMKICAgICkgb25seVJlY2lwaWVudCBjYW1wYWlnbk5vdENhbmNlbGVkIHsKICAgICAgICBwcm9wb3NlZE1pbGVzdG9uZXMgPSBfbmV3TWlsZXN0b25lczsKICAgICAgICBjaGFuZ2luZ01pbGVzdG9uZXMgPSB0cnVlOwogICAgICAgIE5ld01pbGVzdG9uZUxpc3RQcm9wb3NlZCgpOwogICAgfQoKCi8vLy8vLy8vLy8vLwovLyBOb3JtYWwgYWN0aW9ucyB0aGF0IHdpbGwgY2hhbmdlIHRoZSBzdGF0ZSBvZiB0aGUgbWlsZXN0b25lcwovLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBgb25seVJlY2lwaWVudGAgQ2FuY2VscyB0aGUgcHJvcG9zZWQgbWlsZXN0b25lcyBhbmQgcmVhY3RpdmF0ZXMKICAgIC8vLyAgdGhlIHByZXZpb3VzIHNldCBvZiBtaWxlc3RvbmVzCiAgICBmdW5jdGlvbiB1bnByb3Bvc2VNaWxlc3RvbmVzKCkgb25seVJlY2lwaWVudCBjYW1wYWlnbk5vdENhbmNlbGVkIHsKICAgICAgICBkZWxldGUgcHJvcG9zZWRNaWxlc3RvbmVzOwogICAgICAgIGNoYW5naW5nTWlsZXN0b25lcyA9IGZhbHNlOwogICAgICAgIE5ld01pbGVzdG9uZUxpc3RVbnByb3Bvc2VkKCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgYG9ubHlEb25vcmAgQXBwcm92ZXMgdGhlIHByb3Bvc2VkIG1pbGVzdG9uZSBsaXN0CiAgICAvLy8gQHBhcmFtIF9oYXNoUHJvcG9zYWxzIFRoZSBzaGEzKCkgb2YgdGhlIHByb3Bvc2VkIG1pbGVzdG9uZSBsaXN0J3MKICAgIC8vLyAgYnl0ZWNvZGU7IHRoaXMgY29uZmlybXMgdGhhdCB0aGUgYGRvbm9yYCBrbm93cyB0aGUgc2V0IG9mIG1pbGVzdG9uZXMKICAgIC8vLyAgdGhleSBhcmUgYXBwcm92aW5nCiAgICBmdW5jdGlvbiBhY2NlcHRQcm9wb3NlZE1pbGVzdG9uZXMoYnl0ZXMzMiBfaGFzaFByb3Bvc2FscwogICAgKSBvbmx5RG9ub3IgY2FtcGFpZ25Ob3RDYW5jZWxlZCB7CgogICAgICAgIHVpbnQgaTsKCiAgICAgICAgaWYgKCFjaGFuZ2luZ01pbGVzdG9uZXMpIHRocm93OwogICAgICAgIGlmIChzaGEzKHByb3Bvc2VkTWlsZXN0b25lcykgIT0gX2hhc2hQcm9wb3NhbHMpIHRocm93OwoKICAgICAgICAvLyBDYW5jZWwgYWxsIHRoZSB1bmZpbmlzaGVkIG1pbGVzdG9uZXMKICAgICAgICBmb3IgKGk9MDsgaTxtaWxlc3RvbmVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChtaWxlc3RvbmVzW2ldLnN0YXR1cyAhPSBNaWxlc3RvbmVTdGF0dXMuUGFpZCkgewogICAgICAgICAgICAgICAgbWlsZXN0b25lc1tpXS5zdGF0dXMgPSBNaWxlc3RvbmVTdGF0dXMuQ2FuY2VsZWQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLy8gRGVjb2RlIHRoZSBSTFAgZW5jb2RlZCBtaWxlc3RvbmVzIGFuZCBhZGQgdGhlbSB0byB0aGUgbWlsZXN0b25lcyBsaXN0CiAgICAgICAgYnl0ZXMgbWVtb3J5IG1Qcm9wb3NlZE1pbGVzdG9uZXMgPSBwcm9wb3NlZE1pbGVzdG9uZXM7CgogICAgICAgIHZhciBpdG1Qcm9wb3NhbHMgPSBtUHJvcG9zZWRNaWxlc3RvbmVzLnRvUkxQSXRlbSh0cnVlKTsKCiAgICAgICAgaWYgKCFpdG1Qcm9wb3NhbHMuaXNMaXN0KCkpIHRocm93OwoKICAgICAgICB2YXIgaXRyUHJvcG9zYWxzID0gaXRtUHJvcG9zYWxzLml0ZXJhdG9yKCk7CgogICAgICAgIHdoaWxlKGl0clByb3Bvc2Fscy5oYXNOZXh0KCkpIHsKCgogICAgICAgICAgICB2YXIgaXRtUHJvcG9zYWwgPSBpdHJQcm9wb3NhbHMubmV4dCgpOwoKICAgICAgICAgICAgTWlsZXN0b25lIG1pbGVzdG9uZSA9IG1pbGVzdG9uZXNbbWlsZXN0b25lcy5sZW5ndGggKytdOwoKICAgICAgICAgICAgaWYgKCFpdG1Qcm9wb3NhbC5pc0xpc3QoKSkgdGhyb3c7CgogICAgICAgICAgICB2YXIgaXRyUHJvcG9zYWwgPSBpdG1Qcm9wb3NhbC5pdGVyYXRvcigpOwoKICAgICAgICAgICAgbWlsZXN0b25lLmRlc2NyaXB0aW9uID0gaXRyUHJvcG9zYWwubmV4dCgpLnRvQXNjaWkoKTsKICAgICAgICAgICAgbWlsZXN0b25lLnVybCA9IGl0clByb3Bvc2FsLm5leHQoKS50b0FzY2lpKCk7CiAgICAgICAgICAgIG1pbGVzdG9uZS5taW5Db21wbGV0aW9uRGF0ZSA9IGl0clByb3Bvc2FsLm5leHQoKS50b1VpbnQoKTsKICAgICAgICAgICAgbWlsZXN0b25lLm1heENvbXBsZXRpb25EYXRlID0gaXRyUHJvcG9zYWwubmV4dCgpLnRvVWludCgpOwogICAgICAgICAgICBtaWxlc3RvbmUucmV2aWV3ZXIgPSBpdHJQcm9wb3NhbC5uZXh0KCkudG9BZGRyZXNzKCk7CiAgICAgICAgICAgIG1pbGVzdG9uZS5yZXZpZXdUaW1lID0gaXRyUHJvcG9zYWwubmV4dCgpLnRvVWludCgpOwogICAgICAgICAgICBtaWxlc3RvbmUucGF5bWVudFNvdXJjZSA9IGl0clByb3Bvc2FsLm5leHQoKS50b0FkZHJlc3MoKTsKICAgICAgICAgICAgbWlsZXN0b25lLnBheURhdGEgPSBpdHJQcm9wb3NhbC5uZXh0KCkudG9EYXRhKCk7CgogICAgICAgICAgICBtaWxlc3RvbmUuc3RhdHVzID0gTWlsZXN0b25lU3RhdHVzLkFjY2VwdGVkQW5kSW5Qcm9ncmVzczsKCiAgICAgICAgfQoKICAgICAgICBkZWxldGUgcHJvcG9zZWRNaWxlc3RvbmVzOwogICAgICAgIGNoYW5naW5nTWlsZXN0b25lcyA9IGZhbHNlOwogICAgICAgIE5ld01pbGVzdG9uZUxpc3RBY2NlcHRlZCgpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGBvbmx5UmV2aWV3ZXJgIEFwcHJvdmVzIGEgc3BlY2lmaWMgbWlsZXN0b25lCiAgICAvLy8gQHBhcmFtIF9pZE1pbGVzdG9uZSBJRCBvZiB0aGUgbWlsZXN0b25lIHRoYXQgaXMgYXBwcm92ZWQKICAgIGZ1bmN0aW9uIGFwcHJvdmVDb21wbGV0ZWRNaWxlc3RvbmUodWludCBfaWRNaWxlc3RvbmUpIGNhbXBhaWduTm90Q2FuY2VsZWQgbm90Q2hhbmdpbmcgewogICAgICAgIGlmIChfaWRNaWxlc3RvbmUgPj0gbWlsZXN0b25lcy5sZW5ndGgpIHRocm93OwogICAgICAgIE1pbGVzdG9uZSBtaWxlc3RvbmUgPSBtaWxlc3RvbmVzW19pZE1pbGVzdG9uZV07CiAgICAgICAgaWYgKChtc2cuc2VuZGVyICE9IG1pbGVzdG9uZS5yZXZpZXdlcikgfHwKICAgICAgICAgICAgKG1pbGVzdG9uZS5zdGF0dXMgIT0gTWlsZXN0b25lU3RhdHVzLkNvbXBsZXRlZCkpIHRocm93OwoKICAgICAgICBkb1BheW1lbnQoX2lkTWlsZXN0b25lKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBgb25seVJldmlld2VyYCBSZWplY3RzIGEgc3BlY2lmaWMgbWlsZXN0b25lJ3MgY29tcGxldGlvbiBhbmQKICAgIC8vLyAgcmV2ZXJ0cyB0aGUgYG1pbGVzdG9uZS5zdGF0dXNgIGJhY2sgdG8gdGhlIGBBY2NlcHRlZEFuZEluUHJvZ3Jlc3NgIHN0YXRlCiAgICAvLy8gQHBhcmFtIF9pZE1pbGVzdG9uZSBJRCBvZiB0aGUgbWlsZXN0b25lIHRoYXQgaXMgYmVpbmcgcmVqZWN0ZWQKICAgIGZ1bmN0aW9uIHJlamVjdE1pbGVzdG9uZSh1aW50IF9pZE1pbGVzdG9uZSkgY2FtcGFpZ25Ob3RDYW5jZWxlZCBub3RDaGFuZ2luZyB7CiAgICAgICAgaWYgKF9pZE1pbGVzdG9uZSA+PSBtaWxlc3RvbmVzLmxlbmd0aCkgdGhyb3c7CiAgICAgICAgTWlsZXN0b25lIG1pbGVzdG9uZSA9IG1pbGVzdG9uZXNbX2lkTWlsZXN0b25lXTsKICAgICAgICBpZiAoKG1zZy5zZW5kZXIgIT0gbWlsZXN0b25lLnJldmlld2VyKSB8fAogICAgICAgICAgICAobWlsZXN0b25lLnN0YXR1cyAhPSBNaWxlc3RvbmVTdGF0dXMuQ29tcGxldGVkKSkgdGhyb3c7CgogICAgICAgIG1pbGVzdG9uZS5zdGF0dXMgPSBNaWxlc3RvbmVTdGF0dXMuQWNjZXB0ZWRBbmRJblByb2dyZXNzOwogICAgICAgIFByb3Bvc2FsU3RhdHVzQ2hhbmdlZChfaWRNaWxlc3RvbmUsIG1pbGVzdG9uZS5zdGF0dXMpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGBvbmx5UmVjaXBpZW50YCBNYXJrcyBhIG1pbGVzdG9uZSBhcyBET05FIGFuZCByZWFkeSBmb3IgcmV2aWV3CiAgICAvLy8gQHBhcmFtIF9pZE1pbGVzdG9uZSBJRCBvZiB0aGUgbWlsZXN0b25lIHRoYXQgaGFzIGJlZW4gY29tcGxldGVkCiAgICBmdW5jdGlvbiBtaWxlc3RvbmVDb21wbGV0ZWQodWludCBfaWRNaWxlc3RvbmUpIG9ubHlSZWNpcGllbnQgY2FtcGFpZ25Ob3RDYW5jZWxlZCBub3RDaGFuZ2luZyB7CiAgICAgICAgaWYgKF9pZE1pbGVzdG9uZSA+PSBtaWxlc3RvbmVzLmxlbmd0aCkgdGhyb3c7CiAgICAgICAgTWlsZXN0b25lIG1pbGVzdG9uZSA9IG1pbGVzdG9uZXNbX2lkTWlsZXN0b25lXTsKICAgICAgICBpZiAobWlsZXN0b25lLnN0YXR1cyAhPSBNaWxlc3RvbmVTdGF0dXMuQWNjZXB0ZWRBbmRJblByb2dyZXNzKSB0aHJvdzsKICAgICAgICBpZiAobm93IDwgbWlsZXN0b25lLm1pbkNvbXBsZXRpb25EYXRlKSB0aHJvdzsKICAgICAgICBpZiAobm93ID4gbWlsZXN0b25lLm1heENvbXBsZXRpb25EYXRlKSB0aHJvdzsKICAgICAgICBtaWxlc3RvbmUuc3RhdHVzID0gTWlsZXN0b25lU3RhdHVzLkNvbXBsZXRlZDsKICAgICAgICBtaWxlc3RvbmUuZG9uZVRpbWUgPSBub3c7CiAgICAgICAgUHJvcG9zYWxTdGF0dXNDaGFuZ2VkKF9pZE1pbGVzdG9uZSwgbWlsZXN0b25lLnN0YXR1cyk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgYG9ubHlSZWNpcGllbnRgIFNlbmRzIHRoZSBtaWxlc3RvbmUgcGF5bWVudCBhcyBzcGVjaWZpZWQgaW4KICAgIC8vLyAgYHBheURhdGFgOyB0aGUgcmVjaXBpZW50IGNhbiBvbmx5IGNhbGwgdGhpcyBhZnRlciB0aGUgYHJldmlld1RpbWVgIGhhcwogICAgLy8vICBlbGFwc2VkCiAgICAvLy8gQHBhcmFtIF9pZE1pbGVzdG9uZSBJRCBvZiB0aGUgbWlsZXN0b25lIHRvIGJlIHBhaWQgb3V0CiAgICBmdW5jdGlvbiBjb2xsZWN0TWlsZXN0b25lUGF5bWVudCh1aW50IF9pZE1pbGVzdG9uZQogICAgICAgICkgb25seVJlY2lwaWVudCBjYW1wYWlnbk5vdENhbmNlbGVkIG5vdENoYW5naW5nIHsKICAgICAgICBpZiAoX2lkTWlsZXN0b25lID49IG1pbGVzdG9uZXMubGVuZ3RoKSB0aHJvdzsKICAgICAgICBNaWxlc3RvbmUgbWlsZXN0b25lID0gbWlsZXN0b25lc1tfaWRNaWxlc3RvbmVdOwogICAgICAgIGlmICAoKG1pbGVzdG9uZS5zdGF0dXMgIT0gTWlsZXN0b25lU3RhdHVzLkNvbXBsZXRlZCkgfHwKICAgICAgICAgICAgIChub3cgPCBtaWxlc3RvbmUuZG9uZVRpbWUgKyBtaWxlc3RvbmUucmV2aWV3VGltZSkpCiAgICAgICAgICAgIHRocm93OwoKICAgICAgICBkb1BheW1lbnQoX2lkTWlsZXN0b25lKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBgb25seVJlY2lwaWVudGAgQ2FuY2VscyBhIHByZXZpb3VzbHkgYWNjZXB0ZWQgbWlsZXN0b25lCiAgICAvLy8gQHBhcmFtIF9pZE1pbGVzdG9uZSBJRCBvZiB0aGUgbWlsZXN0b25lIHRvIGJlIGNhbmNlbGVkCiAgICBmdW5jdGlvbiBjYW5jZWxNaWxlc3RvbmUodWludCBfaWRNaWxlc3RvbmUpIG9ubHlSZWNpcGllbnQgY2FtcGFpZ25Ob3RDYW5jZWxlZCBub3RDaGFuZ2luZyB7CiAgICAgICAgaWYgKF9pZE1pbGVzdG9uZSA+PSBtaWxlc3RvbmVzLmxlbmd0aCkgdGhyb3c7CiAgICAgICAgTWlsZXN0b25lIG1pbGVzdG9uZSA9IG1pbGVzdG9uZXNbX2lkTWlsZXN0b25lXTsKICAgICAgICBpZiAgKChtaWxlc3RvbmUuc3RhdHVzICE9IE1pbGVzdG9uZVN0YXR1cy5BY2NlcHRlZEFuZEluUHJvZ3Jlc3MpICYmCiAgICAgICAgICAgICAobWlsZXN0b25lLnN0YXR1cyAhPSBNaWxlc3RvbmVTdGF0dXMuQ29tcGxldGVkKSkKICAgICAgICAgICAgdGhyb3c7CgogICAgICAgIG1pbGVzdG9uZS5zdGF0dXMgPSBNaWxlc3RvbmVTdGF0dXMuQ2FuY2VsZWQ7CiAgICAgICAgUHJvcG9zYWxTdGF0dXNDaGFuZ2VkKF9pZE1pbGVzdG9uZSwgbWlsZXN0b25lLnN0YXR1cyk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgYG9ubHlBcmJpdHJhdG9yYCBGb3JjZXMgYSBtaWxlc3RvbmUgdG8gYmUgcGFpZCBvdXQgYXMgbG9uZyBhcyBpdAogICAgLy8vIGhhcyBub3QgYmVlbiBwYWlkIG9yIGNhbmNlbGVkCiAgICAvLy8gQHBhcmFtIF9pZE1pbGVzdG9uZSBJRCBvZiB0aGUgbWlsZXN0b25lIHRvIGJlIHBhaWQgb3V0CiAgICBmdW5jdGlvbiBhcmJpdHJhdGVBcHByb3ZlTWlsZXN0b25lKHVpbnQgX2lkTWlsZXN0b25lCiAgICApIG9ubHlBcmJpdHJhdG9yIGNhbXBhaWduTm90Q2FuY2VsZWQgbm90Q2hhbmdpbmcgewogICAgICAgIGlmIChfaWRNaWxlc3RvbmUgPj0gbWlsZXN0b25lcy5sZW5ndGgpIHRocm93OwogICAgICAgIE1pbGVzdG9uZSBtaWxlc3RvbmUgPSBtaWxlc3RvbmVzW19pZE1pbGVzdG9uZV07CiAgICAgICAgaWYgICgobWlsZXN0b25lLnN0YXR1cyAhPSBNaWxlc3RvbmVTdGF0dXMuQWNjZXB0ZWRBbmRJblByb2dyZXNzKSAmJgogICAgICAgICAgICAgKG1pbGVzdG9uZS5zdGF0dXMgIT0gTWlsZXN0b25lU3RhdHVzLkNvbXBsZXRlZCkpCiAgICAgICAgICAgdGhyb3c7CiAgICAgICAgZG9QYXltZW50KF9pZE1pbGVzdG9uZSk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgYG9ubHlBcmJpdHJhdG9yYCBDYW5jZWxzIHRoZSBlbnRpcmUgY2FtcGFpZ24gdm9pZGluZyBhbGwKICAgIC8vLyAgbWlsZXN0b25lcyB2bwogICAgZnVuY3Rpb24gYXJiaXRyYXRlQ2FuY2VsQ2FtcGFpZ24oKSBvbmx5QXJiaXRyYXRvciBjYW1wYWlnbk5vdENhbmNlbGVkIHsKICAgICAgICBjYW1wYWlnbkNhbmNlbGVkID0gdHJ1ZTsKICAgICAgICBDYW1wYWlnbkNhbG5jZWxsZWQoKTsKICAgIH0KCiAgICAvLyBAZGV2IFRoaXMgaW50ZXJuYWwgZnVuY3Rpb24gaXMgZXhlY3V0ZWQgd2hlbiB0aGUgbWlsZXN0b25lIGlzIHBhaWQgb3V0CiAgICBmdW5jdGlvbiBkb1BheW1lbnQodWludCBfaWRNaWxlc3RvbmUpIGludGVybmFsIHsKICAgICAgICBpZiAoX2lkTWlsZXN0b25lID49IG1pbGVzdG9uZXMubGVuZ3RoKSB0aHJvdzsKICAgICAgICBNaWxlc3RvbmUgbWlsZXN0b25lID0gbWlsZXN0b25lc1tfaWRNaWxlc3RvbmVdOwogICAgICAgIC8vIFJlY2hlY2sgYWdhaW4gdG8gbm90IHBheSB0d2ljZQogICAgICAgIGlmIChtaWxlc3RvbmUuc3RhdHVzID09IE1pbGVzdG9uZVN0YXR1cy5QYWlkKSB0aHJvdzsKICAgICAgICBtaWxlc3RvbmUuc3RhdHVzID0gTWlsZXN0b25lU3RhdHVzLlBhaWQ7CiAgICAgICAgaWYgKCFtaWxlc3RvbmUucGF5bWVudFNvdXJjZS5jYWxsLnZhbHVlKDApKG1pbGVzdG9uZS5wYXlEYXRhKSkKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgUHJvcG9zYWxTdGF0dXNDaGFuZ2VkKF9pZE1pbGVzdG9uZSwgbWlsZXN0b25lLnN0YXR1cyk7CiAgICB9Cn0='.
	

]
