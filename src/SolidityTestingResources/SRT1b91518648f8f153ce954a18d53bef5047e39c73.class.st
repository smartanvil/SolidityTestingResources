Class {
	#name : #SRT1b91518648f8f153ce954a18d53bef5047e39c73,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT1b91518648f8f153ce954a18d53bef5047e39c73 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovKioKICogQXV0aG9yZWQgYnkgaHR0cHM6Ly93d3cuY29pbmZhYnJpay5jb20vCiAqLwoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovKioKICogT3JpZ2luYWxseSBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28KICogTW9kaWZpZWQgYnkgaHR0cHM6Ly93d3cuY29pbmZhYnJpay5jb20vCiAqLwoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovKioKICogRW52aXNpb25lZCBpbiBGaXJzdEJsb29kIElDTyBjb250cmFjdC4KICogT3JpZ2luYWxseSBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28KICogTW9kaWZpZWQgYnkgaHR0cHM6Ly93d3cuY29pbmZhYnJpay5jb20vCiAqLwoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovKioKICogT3JpZ2luYWxseSBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9PcGVuWmVwcGVsaW4vemVwcGVsaW4tc29saWRpdHkKICogTW9kaWZpZWQgYnkgaHR0cHM6Ly93d3cuY29pbmZhYnJpay5jb20vCiAqLwoKLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wgCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuIAogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICAvKiogCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgaW50ZXJuYWwgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCgogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4gCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLiAKICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICBvd25lciA9IG5ld093bmVyOwogIH0KCn0KCi8qKgogKiBBYnN0cmFjdCBjb250cmFjdCB0aGF0IGFsbG93cyBjaGlsZHJlbiB0byBpbXBsZW1lbnQgYW4KICogZW1lcmdlbmN5IHN0b3AgbWVjaGFuaXNtLiBEaWZmZXJzIGZyb20gUGF1c2FibGUgYnkgY2F1c2luZyBhIHRocm93IHdoZW4gaW4gaGFsdCBtb2RlLgogKgogKi8KY29udHJhY3QgSGFsdGFibGUgaXMgT3duYWJsZSB7CiAgYm9vbCBwdWJsaWMgaGFsdGVkOwoKICBldmVudCBIYWx0ZWQoYm9vbCBoYWx0ZWQpOwoKICBtb2RpZmllciBzdG9wSW5FbWVyZ2VuY3kgewogICAgcmVxdWlyZSghaGFsdGVkKTsKICAgIF87CiAgfQoKICBtb2RpZmllciBvbmx5SW5FbWVyZ2VuY3kgewogICAgcmVxdWlyZShoYWx0ZWQpOwogICAgXzsKICB9CgogIC8vIGNhbGxlZCBieSB0aGUgb3duZXIgb24gZW1lcmdlbmN5LCB0cmlnZ2VycyBzdG9wcGVkIHN0YXRlCiAgZnVuY3Rpb24gaGFsdCgpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICBoYWx0ZWQgPSB0cnVlOwogICAgSGFsdGVkKHRydWUpOwogIH0KCiAgLy8gY2FsbGVkIGJ5IHRoZSBvd25lciBvbiBlbmQgb2YgZW1lcmdlbmN5LCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogIGZ1bmN0aW9uIHVuaGFsdCgpIGV4dGVybmFsIG9ubHlPd25lciBvbmx5SW5FbWVyZ2VuY3kgewogICAgaGFsdGVkID0gZmFsc2U7CiAgICBIYWx0ZWQoZmFsc2UpOwogIH0KfQpwcmFnbWEgc29saWRpdHkgXjAuNC4xOTsKCi8qKgogKiBPcmlnaW5hbGx5IGZyb20gIGh0dHBzOi8vZ2l0aHViLmNvbS9PcGVuWmVwcGVsaW4vemVwcGVsaW4tc29saWRpdHkKICogTW9kaWZpZWQgYnkgaHR0cHM6Ly93d3cuY29pbmZhYnJpay5jb20vCiAqLwoKLyoqCiAqIE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MKICovCmxpYnJhcnkgU2FmZU1hdGggewogIGZ1bmN0aW9uIG11bCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGRpdih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgZnVuY3Rpb24gYWRkKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50NjQpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50NjQpIHsKICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWF4MjU2KHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjI1Nih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICB9Cn0KCnByYWdtYSBzb2xpZGl0eSBeMC40LjE5OwoKLyoqCiAqIE9yaWdpbmFsbHkgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vVG9rZW5NYXJrZXROZXQvaWNvCiAqIE1vZGlmaWVkIGJ5IGh0dHBzOi8vd3d3LmNvaW5mYWJyaWsuY29tLwogKi8KCnByYWdtYSBzb2xpZGl0eSBeMC40LjE5OwoKLyoqCiAqIE9yaWdpbmFsbHkgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vVG9rZW5NYXJrZXROZXQvaWNvCiAqIE1vZGlmaWVkIGJ5IGh0dHBzOi8vd3d3LmNvaW5mYWJyaWsuY29tLwogKi8KCnByYWdtYSBzb2xpZGl0eSBeMC40LjE5OwoKLyoqCiAqIE9yaWdpbmFsbHkgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vT3BlblplcHBlbGluL3plcHBlbGluLXNvbGlkaXR5CiAqIE1vZGlmaWVkIGJ5IGh0dHBzOi8vd3d3LmNvaW5mYWJyaWsuY29tLwogKi8KCnByYWdtYSBzb2xpZGl0eSBeMC40LjE5OwoKLyoqCiAqIEludGVyZmFjZSBmb3IgdGhlIHN0YW5kYXJkIHRva2VuLgogKiBCYXNlZCBvbiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9ibG9iL21hc3Rlci9FSVBTL2VpcC0yMC10b2tlbi1zdGFuZGFyZC5tZAogKi8KY29udHJhY3QgRUlQMjBUb2tlbiB7CgogIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpOwogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwoKICAvKioKICAqKiBPcHRpb25hbCBmdW5jdGlvbnMKICAqCiAgZnVuY3Rpb24gbmFtZSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZyBuYW1lKTsKICBmdW5jdGlvbiBzeW1ib2woKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgc3ltYm9sKTsKICBmdW5jdGlvbiBkZWNpbWFscygpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQ4IGRlY2ltYWxzKTsKICAqCiAgKiovCgp9CnByYWdtYSBzb2xpZGl0eSBeMC40LjE5OwoKLy8gSW50ZXJmYWNlIGZvciBidXJuaW5nIHRva2Vucwpjb250cmFjdCBCdXJuYWJsZSB7CiAgLy8gQGRldiBEZXN0cm95cyB0b2tlbnMgZm9yIGFuIGFjY291bnQKICAvLyBAcGFyYW0gYWNjb3VudCBBY2NvdW50IHdob3NlIHRva2VucyBhcmUgZGVzdHJveWVkCiAgLy8gQHBhcmFtIHZhbHVlIEFtb3VudCBvZiB0b2tlbnMgdG8gZGVzdHJveQogIGZ1bmN0aW9uIGJ1cm5Ub2tlbnMoYWRkcmVzcyBhY2NvdW50LCB1aW50IHZhbHVlKSBpbnRlcm5hbDsKICBldmVudCBCdXJuZWQoYWRkcmVzcyBhY2NvdW50LCB1aW50IHZhbHVlKTsKfQpwcmFnbWEgc29saWRpdHkgXjAuNC4xOTsKCi8qKgogKiBBdXRob3JlZCBieSBodHRwczovL3d3dy5jb2luZmFicmlrLmNvbS8KICovCgoKLyoqCiAqIEludGVybmFsIGludGVyZmFjZSBmb3IgdGhlIG1pbnRpbmcgb2YgdG9rZW5zLgogKi8KY29udHJhY3QgTWludGFibGUgewoKICAvKioKICAgKiBAZGV2IE1pbnRzIHRva2VucyBmb3IgYW4gYWNjb3VudAogICAqIFRoaXMgZnVuY3Rpb24gc2hvdWxkIHRoZSBNaW50ZWQgZXZlbnQuCiAgICovCiAgZnVuY3Rpb24gbWludEludGVybmFsKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgYW1vdW50KSBpbnRlcm5hbDsKCiAgLyoqIFRva2VuIHN1cHBseSBnb3QgaW5jcmVhc2VkIGFuZCBhIG5ldyBvd25lciByZWNlaXZlZCB0aGVzZSB0b2tlbnMgKi8KICBldmVudCBNaW50ZWQoYWRkcmVzcyByZWNlaXZlciwgdWludCBhbW91bnQpOwp9CgovKioKICogQHRpdGxlIFN0YW5kYXJkIHRva2VuCiAqIEBkZXYgQmFzaWMgaW1wbGVtZW50YXRpb24gb2YgdGhlIEVJUDIwIHN0YW5kYXJkIHRva2VuIChhbHNvIGtub3duIGFzIEVSQzIwIHRva2VuKS4KICovCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgRUlQMjBUb2tlbiwgQnVybmFibGUsIE1pbnRhYmxlIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgdWludCBwcml2YXRlIHRvdGFsX3N1cHBseTsKICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgcHJpdmF0ZSBiYWxhbmNlczsKICBtYXBwaW5nKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSkgcHJpdmF0ZSBhbGxvd2VkOwoKCiAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gdG90YWxfc3VwcGx5OwogIH0KCiAgLyoqCiAgICogQGRldiB0cmFuc2ZlciB0b2tlbiBmb3IgYSBzcGVjaWZpZWQgYWRkcmVzcwogICAqIEBwYXJhbSB0byBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0by4KICAgKiBAcGFyYW0gdmFsdWUgVGhlIGFtb3VudCB0byBiZSB0cmFuc2ZlcnJlZC4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1Yih2YWx1ZSk7CiAgICBiYWxhbmNlc1t0b10gPSBiYWxhbmNlc1t0b10uYWRkKHZhbHVlKTsKICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIHRvLCB2YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuCiAgICogQHBhcmFtIGFjY291bnQgVGhlIGFkZHJlc3Mgd2hvc2UgYmFsYW5jZSBpcyB0byBiZSBxdWVyaWVkLgogICAqIEByZXR1cm4gQW4gdWludCByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgICovCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgYWNjb3VudCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCBiYWxhbmNlKSB7CiAgICByZXR1cm4gYmFsYW5jZXNbYWNjb3VudF07CiAgfQoKICAvKioKICAgKiBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIKICAgKiBAcGFyYW0gZnJvbSBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20KICAgKiBAcGFyYW0gdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAqIEBwYXJhbSB2YWx1ZSB1aW50IHRoZSBhbW91dCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJlZAogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIHVpbnQgYWxsb3dhbmNlID0gYWxsb3dlZFtmcm9tXVttc2cuc2VuZGVyXTsKCiAgICAvLyBDaGVjayBpcyBub3QgbmVlZGVkIGJlY2F1c2Ugc3ViKGFsbG93YW5jZSwgdmFsdWUpIHdpbGwgYWxyZWFkeSB0aHJvdyBpZiB0aGlzIGNvbmRpdGlvbiBpcyBub3QgbWV0CiAgICAvLyByZXF1aXJlKHZhbHVlIDw9IGFsbG93YW5jZSk7CiAgICAvLyBTYWZlTWF0aCB1c2VzIGFzc2VydCBpbnN0ZWFkIG9mIHJlcXVpcmUgdGhvdWdoLCBiZXdhcmUgd2hlbiB1c2luZyBhbiBhbmFseXNpcyB0b29sCgogICAgYmFsYW5jZXNbZnJvbV0gPSBiYWxhbmNlc1tmcm9tXS5zdWIodmFsdWUpOwogICAgYmFsYW5jZXNbdG9dID0gYmFsYW5jZXNbdG9dLmFkZCh2YWx1ZSk7CiAgICBhbGxvd2VkW2Zyb21dW21zZy5zZW5kZXJdID0gYWxsb3dhbmNlLnN1Yih2YWx1ZSk7CiAgICBUcmFuc2Zlcihmcm9tLCB0bywgdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEFwcm92ZSB0aGUgcGFzc2VkIGFkZHJlc3MgdG8gc3BlbmQgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIG9uIGJlaGFsZiBvZiBtc2cuc2VuZGVyLgogICAqIEBwYXJhbSBzcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSB2YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAgKi8KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludCB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewoKICAgIC8vIFRvIGNoYW5nZSB0aGUgYXBwcm92ZSBhbW91bnQgeW91IGZpcnN0IGhhdmUgdG8gcmVkdWNlIHRoZSBhZGRyZXNzZXMnCiAgICAvLyAgYWxsb3dhbmNlIHRvIHplcm8gYnkgY2FsbGluZyBgYXBwcm92ZShzcGVuZGVyLCAwKWAgaWYgaXQgaXMgbm90CiAgICAvLyAgYWxyZWFkeSAwIHRvIG1pdGlnYXRlIHRoZSByYWNlIGNvbmRpdGlvbiBkZXNjcmliZWQgaGVyZToKICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgcmVxdWlyZSAodmFsdWUgPT0gMCB8fCBhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdID09IDApOwoKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bc3BlbmRlcl0gPSB2YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIHNwZW5kZXIsIHZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBjaGVjayB0aGUgYW1vdW50IG9mIHRva2VucyB0aGFuIGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAqIEBwYXJhbSBhY2NvdW50IGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICogQHBhcmFtIHNwZW5kZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcmV0dXJuIEEgdWludCBzcGVjaWZpbmcgdGhlIGFtb3VudCBvZiB0b2tlbnMgc3RpbGwgYXZhaWJsZSBmb3IgdGhlIHNwZW5kZXIuCiAgICovCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgYWNjb3VudCwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50IHJlbWFpbmluZykgewogICAgcmV0dXJuIGFsbG93ZWRbYWNjb3VudF1bc3BlbmRlcl07CiAgfQoKICAvKioKICAgKiBBdG9taWMgaW5jcmVtZW50IG9mIGFwcHJvdmVkIHNwZW5kaW5nCiAgICoKICAgKiBXb3JrcyBhcm91bmQgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgKgogICAqLwogIGZ1bmN0aW9uIGFkZEFwcHJvdmFsKGFkZHJlc3Mgc3BlbmRlciwgdWludCBhZGRlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgIHVpbnQgb2xkVmFsdWUgPSBhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdOwogICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdID0gb2xkVmFsdWUuYWRkKGFkZGVkVmFsdWUpOwogICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBzcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdKTsKICAgICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBBdG9taWMgZGVjcmVtZW50IG9mIGFwcHJvdmVkIHNwZW5kaW5nLgogICAqCiAgICogV29ya3MgYXJvdW5kIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICovCiAgZnVuY3Rpb24gc3ViQXBwcm92YWwoYWRkcmVzcyBzcGVuZGVyLCB1aW50IHN1YnRyYWN0ZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewoKICAgICAgdWludCBvbGRWYWwgPSBhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdOwoKICAgICAgaWYgKHN1YnRyYWN0ZWRWYWx1ZSA+IG9sZFZhbCkgewogICAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtzcGVuZGVyXSA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdID0gb2xkVmFsLnN1YihzdWJ0cmFjdGVkVmFsdWUpOwogICAgICB9CiAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIHNwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bc3BlbmRlcl0pOwogICAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgUHJvdmlkZXMgYW4gaW50ZXJuYWwgZnVuY3Rpb24gZm9yIGRlc3Ryb3lpbmcgdG9rZW5zLiBVc2VmdWwgZm9yIHVwZ3JhZGVzLgogICAqLwogIGZ1bmN0aW9uIGJ1cm5Ub2tlbnMoYWRkcmVzcyBhY2NvdW50LCB1aW50IHZhbHVlKSBpbnRlcm5hbCB7CiAgICBiYWxhbmNlc1thY2NvdW50XSA9IGJhbGFuY2VzW2FjY291bnRdLnN1Yih2YWx1ZSk7CiAgICB0b3RhbF9zdXBwbHkgPSB0b3RhbF9zdXBwbHkuc3ViKHZhbHVlKTsKICAgIFRyYW5zZmVyKGFjY291bnQsIDAsIHZhbHVlKTsKICAgIEJ1cm5lZChhY2NvdW50LCB2YWx1ZSk7CiAgfQoKICAvKioKICAgKiBAZGV2IFByb3ZpZGVzIGFuIGludGVybmFsIG1pbnRpbmcgZnVuY3Rpb24uCiAgICovCiAgZnVuY3Rpb24gbWludEludGVybmFsKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgYW1vdW50KSBpbnRlcm5hbCB7CiAgICB0b3RhbF9zdXBwbHkgPSB0b3RhbF9zdXBwbHkuYWRkKGFtb3VudCk7CiAgICBiYWxhbmNlc1tyZWNlaXZlcl0gPSBiYWxhbmNlc1tyZWNlaXZlcl0uYWRkKGFtb3VudCk7CiAgICBNaW50ZWQocmVjZWl2ZXIsIGFtb3VudCk7CgogICAgLy8gQmV3YXJlOiBBZGRyZXNzIHplcm8gbWF5IGJlIHVzZWQgZm9yIHNwZWNpYWwgdHJhbnNhY3Rpb25zIGluIGEgZnV0dXJlIGZvcmsuCiAgICAvLyBUaGlzIHdpbGwgbWFrZSB0aGUgbWludCB0cmFuc2FjdGlvbiBhcHBlYXIgaW4gRXRoZXJTY2FuLmlvCiAgICAvLyBXZSBjYW4gcmVtb3ZlIHRoaXMgYWZ0ZXIgdGhlcmUgaXMgYSBzdGFuZGFyZGl6ZWQgbWludGluZyBldmVudAogICAgVHJhbnNmZXIoMCwgcmVjZWl2ZXIsIGFtb3VudCk7CiAgfQogIAp9CgovKioKICogRGVmaW5lIGludGVyZmFjZSBmb3IgcmVsZWFzaW5nIHRoZSB0b2tlbiB0cmFuc2ZlciBhZnRlciBhIHN1Y2Nlc3NmdWwgY3Jvd2RzYWxlLgogKi8KY29udHJhY3QgUmVsZWFzYWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIE93bmFibGUgewoKICAvKiBUaGUgZmluYWxpemVyIGNvbnRyYWN0IHRoYXQgYWxsb3dzIGxpZnRpbmcgdGhlIHRyYW5zZmVyIGxpbWl0cyBvbiB0aGlzIHRva2VuICovCiAgYWRkcmVzcyBwdWJsaWMgcmVsZWFzZUFnZW50OwoKICAvKiogQSBjcm93ZHNhbGUgY29udHJhY3QgY2FuIHJlbGVhc2UgdXMgdG8gdGhlIHdpbGQgaWYgSUNPIHN1Y2Nlc3MuIElmIGZhbHNlIHdlIGFyZSBhcmUgaW4gdHJhbnNmZXIgbG9jayB1cCBwZXJpb2QuKi8KICBib29sIHB1YmxpYyByZWxlYXNlZCA9IGZhbHNlOwoKICAvKiogTWFwIG9mIGFnZW50cyB0aGF0IGFyZSBhbGxvd2VkIHRvIHRyYW5zZmVyIHRva2VucyByZWdhcmRsZXNzIG9mIHRoZSBsb2NrIGRvd24gcGVyaW9kLiBUaGVzZSBhcmUgY3Jvd2RzYWxlIGNvbnRyYWN0cyBhbmQgcG9zc2libGUgdGhlIHRlYW0gbXVsdGlzaWcgaXRzZWxmLiAqLwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIHRyYW5zZmVyQWdlbnRzOwoKICAvKioKICAgKiBTZXQgdGhlIGNvbnRyYWN0IHRoYXQgY2FuIGNhbGwgcmVsZWFzZSBhbmQgbWFrZSB0aGUgdG9rZW4gdHJhbnNmZXJhYmxlLgogICAqCiAgICogU2luY2UgdGhlIG93bmVyIG9mIHRoaXMgY29udHJhY3QgaXMgKG9yIHNob3VsZCBiZSkgdGhlIGNyb3dkc2FsZSwKICAgKiBpdCBjYW4gb25seSBiZSBjYWxsZWQgYnkgYSBjb3JyZXNwb25kaW5nIGV4cG9zZWQgQVBJIGluIHRoZSBjcm93ZHNhbGUgY29udHJhY3QgaW4gY2FzZSBvZiBpbnB1dCBlcnJvci4KICAgKi8KICBmdW5jdGlvbiBzZXRSZWxlYXNlQWdlbnQoYWRkcmVzcyBhZGRyKSBvbmx5T3duZXIgaW5SZWxlYXNlU3RhdGUoZmFsc2UpIHB1YmxpYyB7CiAgICAvLyBXZSBkb24ndCBkbyBpbnRlcmZhY2UgY2hlY2sgaGVyZSBhcyB3ZSBtaWdodCB3YW50IHRvIGhhdmUgYSBub3JtYWwgd2FsbGV0IGFkZHJlc3MgdG8gYWN0IGFzIGEgcmVsZWFzZSBhZ2VudC4KICAgIHJlbGVhc2VBZ2VudCA9IGFkZHI7CiAgfQoKICAvKioKICAgKiBPd25lciBjYW4gYWxsb3cgYSBwYXJ0aWN1bGFyIGFkZHJlc3MgKGUuZy4gYSBjcm93ZHNhbGUgY29udHJhY3QpIHRvIHRyYW5zZmVyIHRva2VucyBkZXNwaXRlIHRoZSBsb2NrIHVwIHBlcmlvZC4KICAgKi8KICBmdW5jdGlvbiBzZXRUcmFuc2ZlckFnZW50KGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0ZSkgb25seU93bmVyIGluUmVsZWFzZVN0YXRlKGZhbHNlKSBwdWJsaWMgewogICAgdHJhbnNmZXJBZ2VudHNbYWRkcl0gPSBzdGF0ZTsKICB9CgogIC8qKgogICAqIE9uZSB3YXkgZnVuY3Rpb24gdG8gcmVsZWFzZSB0aGUgdG9rZW5zIGludG8gdGhlIHdpbGQuCiAgICoKICAgKiBDYW4gYmUgY2FsbGVkIG9ubHkgZnJvbSB0aGUgcmVsZWFzZSBhZ2VudCB0aGF0IHNob3VsZCB0eXBpY2FsbHkgYmUgdGhlIGZpbmFsaXplIGFnZW50IElDTyBjb250cmFjdC4KICAgKiBJbiB0aGUgc2NvcGUgb2YgdGhlIGNyb3dkc2FsZSwgaXQgaXMgb25seSBjYWxsZWQgaWYgdGhlIGNyb3dkc2FsZSBoYXMgYmVlbiBhIHN1Y2Nlc3MgKGZpcnN0IG1pbGVzdG9uZSByZWFjaGVkKS4KICAgKi8KICBmdW5jdGlvbiByZWxlYXNlVG9rZW5UcmFuc2ZlcigpIHB1YmxpYyBvbmx5UmVsZWFzZUFnZW50IHsKICAgIHJlbGVhc2VkID0gdHJ1ZTsKICB9CgogIC8qKgogICAqIExpbWl0IHRva2VuIHRyYW5zZmVyIHVudGlsIHRoZSBjcm93ZHNhbGUgaXMgb3Zlci4KICAgKi8KICBtb2RpZmllciBjYW5UcmFuc2ZlcihhZGRyZXNzIHNlbmRlcikgewogICAgcmVxdWlyZShyZWxlYXNlZCB8fCB0cmFuc2ZlckFnZW50c1tzZW5kZXJdKTsKICAgIF87CiAgfQoKICAvKiogVGhlIGZ1bmN0aW9uIGNhbiBiZSBjYWxsZWQgb25seSBiZWZvcmUgb3IgYWZ0ZXIgdGhlIHRva2VucyBoYXZlIGJlZW4gcmVsZWFzZWQgKi8KICBtb2RpZmllciBpblJlbGVhc2VTdGF0ZShib29sIHJlbGVhc2VTdGF0ZSkgewogICAgcmVxdWlyZShyZWxlYXNlU3RhdGUgPT0gcmVsZWFzZWQpOwogICAgXzsKICB9CgogIC8qKiBUaGUgZnVuY3Rpb24gY2FuIGJlIGNhbGxlZCBvbmx5IGJ5IGEgd2hpdGVsaXN0ZWQgcmVsZWFzZSBhZ2VudC4gKi8KICBtb2RpZmllciBvbmx5UmVsZWFzZUFnZW50KCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHJlbGVhc2VBZ2VudCk7CiAgICBfOwogIH0KCiAgLyoqIFdlIHJlc3RyaWN0IHRyYW5zZmVyIGJ5IG92ZXJyaWRpbmcgaXQgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSBwdWJsaWMgY2FuVHJhbnNmZXIobXNnLnNlbmRlcikgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAvLyBDYWxsIFN0YW5kYXJkVG9rZW4udHJhbnNmZXIoKQogICByZXR1cm4gc3VwZXIudHJhbnNmZXIodG8sIHZhbHVlKTsKICB9CgogIC8qKiBXZSByZXN0cmljdCB0cmFuc2ZlckZyb20gYnkgb3ZlcnJpZGluZyBpdCAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHB1YmxpYyBjYW5UcmFuc2Zlcihmcm9tKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIC8vIENhbGwgU3RhbmRhcmRUb2tlbi50cmFuc2ZlckZvcm0oKQogICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShmcm9tLCB0bywgdmFsdWUpOwogIH0KCn0KCgoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovKioKICogRmlyc3QgZW52aXNpb25lZCBieSBHb2xlbSBhbmQgTHVueXIgcHJvamVjdHMuCiAqIE9yaWdpbmFsbHkgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vVG9rZW5NYXJrZXROZXQvaWNvCiAqIE1vZGlmaWVkIGJ5IGh0dHBzOi8vd3d3LmNvaW5mYWJyaWsuY29tLwogKi8KCnByYWdtYSBzb2xpZGl0eSBeMC40LjE5OwoKLyoqCiAqIEluc3BpcmVkIGJ5IEx1bnlyLgogKiBPcmlnaW5hbGx5IGZyb20gaHR0cHM6Ly9naXRodWIuY29tL1Rva2VuTWFya2V0TmV0L2ljbwogKi8KCi8qKgogKiBVcGdyYWRlIGFnZW50IHRyYW5zZmVycyB0b2tlbnMgdG8gYSBuZXcgY29udHJhY3QuCiAqIFVwZ3JhZGUgYWdlbnQgaXRzZWxmIGNhbiBiZSB0aGUgdG9rZW4gY29udHJhY3QsIG9yIGp1c3QgYSBtaWRkbGUgbWFuIGNvbnRyYWN0IGRvaW5nIHRoZSBoZWF2eSBsaWZ0aW5nLgogKgogKiBUaGUgVXBncmFkZSBhZ2VudCBpcyB0aGUgaW50ZXJmYWNlIHVzZWQgdG8gaW1wbGVtZW50IGEgdG9rZW4KICogbWlncmF0aW9uIGluIHRoZSBjYXNlIG9mIGFuIGVtZXJnZW5jeS4KICogVGhlIGZ1bmN0aW9uIHVwZ3JhZGVGcm9tIGhhcyB0byBpbXBsZW1lbnQgdGhlIHBhcnQgb2YgdGhlIGNyZWF0aW9uCiAqIG9mIG5ldyB0b2tlbnMgb24gYmVoYWxmIG9mIHRoZSB1c2VyIGRvaW5nIHRoZSB1cGdyYWRlLgogKgogKiBUaGUgbmV3IHRva2VuIGNhbiBpbXBsZW1lbnQgdGhpcyBpbnRlcmZhY2UgZGlyZWN0bHksIG9yIHVzZS4KICovCmNvbnRyYWN0IFVwZ3JhZGVBZ2VudCB7CgogIC8qKiBUaGlzIHZhbHVlIHNob3VsZCBiZSB0aGUgc2FtZSBhcyB0aGUgb3JpZ2luYWwgdG9rZW4ncyB0b3RhbCBzdXBwbHkgKi8KICB1aW50IHB1YmxpYyBvcmlnaW5hbFN1cHBseTsKCiAgLyoqIEludGVyZmFjZSB0byBlbnN1cmUgdGhlIGNvbnRyYWN0IGlzIGNvcnJlY3RseSBjb25maWd1cmVkICovCiAgZnVuY3Rpb24gaXNVcGdyYWRlQWdlbnQoKSBwdWJsaWMgcHVyZSByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogIFVwZ3JhZGUgYW4gYWNjb3VudAoKICBXaGVuIHRoZSB0b2tlbiBjb250cmFjdCBpcyBpbiB0aGUgdXBncmFkZSBzdGF0dXMgdGhlIGVhY2ggdXNlciB3aWxsCiAgaGF2ZSB0byBjYWxsIGB1cGdyYWRlKHZhbHVlKWAgZnVuY3Rpb24gZnJvbSBVcGdyYWRlYWJsZVRva2VuLgoKICBUaGUgdXBncmFkZSBmdW5jdGlvbiBhZGp1c3QgdGhlIGJhbGFuY2Ugb2YgdGhlIHVzZXIgYW5kIHRoZSBzdXBwbHkKICBvZiB0aGUgcHJldmlvdXMgdG9rZW4gYW5kIHRoZW4gY2FsbCBgdXBncmFkZUZyb20odmFsdWUpYC4KCiAgVGhlIFVwZ3JhZGVBZ2VudCBpcyB0aGUgcmVzcG9uc2libGUgdG8gY3JlYXRlIHRoZSB0b2tlbnMgZm9yIHRoZSB1c2VyCiAgaW4gdGhlIG5ldyBjb250cmFjdC4KCiAgKiBAcGFyYW0gZnJvbSBBY2NvdW50IHRvIHVwZ3JhZGUuCiAgKiBAcGFyYW0gdmFsdWUgVG9rZW5zIHRvIHVwZ3JhZGUuCgogICovCiAgZnVuY3Rpb24gdXBncmFkZUZyb20oYWRkcmVzcyBmcm9tLCB1aW50IHZhbHVlKSBwdWJsaWM7Cgp9CgoKLyoqCiAqIEEgdG9rZW4gdXBncmFkZSBtZWNoYW5pc20gd2hlcmUgdXNlcnMgY2FuIG9wdC1pbiBhbW91bnQgb2YgdG9rZW5zIHRvIHRoZSBuZXh0IHNtYXJ0IGNvbnRyYWN0IHJldmlzaW9uLgogKgogKi8KY29udHJhY3QgVXBncmFkZWFibGVUb2tlbiBpcyBFSVAyMFRva2VuLCBCdXJuYWJsZSB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7CgogIC8qKiBDb250cmFjdCAvIHBlcnNvbiB3aG8gY2FuIHNldCB0aGUgdXBncmFkZSBwYXRoLiBUaGlzIGNhbiBiZSB0aGUgc2FtZSBhcyB0ZWFtIG11bHRpc2lnIHdhbGxldCwgYXMgd2hhdCBpdCBpcyB3aXRoIGl0cyBkZWZhdWx0IHZhbHVlLiAqLwogIGFkZHJlc3MgcHVibGljIHVwZ3JhZGVNYXN0ZXI7CgogIC8qKiBUaGUgbmV4dCBjb250cmFjdCB3aGVyZSB0aGUgdG9rZW5zIHdpbGwgYmUgbWlncmF0ZWQuICovCiAgVXBncmFkZUFnZW50IHB1YmxpYyB1cGdyYWRlQWdlbnQ7CgogIC8qKiBIb3cgbWFueSB0b2tlbnMgd2UgaGF2ZSB1cGdyYWRlZCBieSBub3cuICovCiAgdWludCBwdWJsaWMgdG90YWxVcGdyYWRlZCA9IDA7CgogIC8qKgogICAqIFVwZ3JhZGUgc3RhdGVzLgogICAqCiAgICogLSBOb3RBbGxvd2VkOiBUaGUgY2hpbGQgY29udHJhY3QgaGFzIG5vdCByZWFjaGVkIGEgY29uZGl0aW9uIHdoZXJlIHRoZSB1cGdyYWRlIGNhbiBiZ3VuCiAgICogLSBXYWl0aW5nRm9yQWdlbnQ6IFRva2VuIGFsbG93cyB1cGdyYWRlLCBidXQgd2UgZG9uJ3QgaGF2ZSBhIG5ldyBhZ2VudCB5ZXQKICAgKiAtIFJlYWR5VG9VcGdyYWRlOiBUaGUgYWdlbnQgaXMgc2V0LCBidXQgbm90IGEgc2luZ2xlIHRva2VuIGhhcyBiZWVuIHVwZ3JhZGVkIHlldC4gVGhpcyBhbGxvd3MgY2hhbmdpbmcgdGhlIHVwZ3JhZGUgYWdlbnQgd2hpbGUgdGhlcmUgaXMgdGltZS4KICAgKiAtIFVwZ3JhZGluZzogVXBncmFkZSBhZ2VudCBpcyBzZXQgYW5kIHRoZSBiYWxhbmNlIGhvbGRlcnMgY2FuIHVwZ3JhZGUgdGhlaXIgdG9rZW5zCiAgICoKICAgKi8KICBlbnVtIFVwZ3JhZGVTdGF0ZSB7VW5rbm93biwgTm90QWxsb3dlZCwgV2FpdGluZ0ZvckFnZW50LCBSZWFkeVRvVXBncmFkZSwgVXBncmFkaW5nfQoKICAvKioKICAgKiBTb21lYm9keSBoYXMgdXBncmFkZWQgc29tZSBvZiBoaXMgdG9rZW5zLgogICAqLwogIGV2ZW50IFVwZ3JhZGUoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpOwoKICAvKioKICAgKiBOZXcgdXBncmFkZSBhZ2VudCBhdmFpbGFibGUuCiAgICovCiAgZXZlbnQgVXBncmFkZUFnZW50U2V0KGFkZHJlc3MgYWdlbnQpOwoKICAvKioKICAgKiBEbyBub3QgYWxsb3cgY29uc3RydWN0aW9uIHdpdGhvdXQgdXBncmFkZSBtYXN0ZXIgc2V0LgogICAqLwogIGZ1bmN0aW9uIFVwZ3JhZGVhYmxlVG9rZW4oYWRkcmVzcyBtYXN0ZXIpIGludGVybmFsIHsKICAgIHNldFVwZ3JhZGVNYXN0ZXIobWFzdGVyKTsKICB9CgogIC8qKgogICAqIEFsbG93IHRoZSB0b2tlbiBob2xkZXIgdG8gdXBncmFkZSBzb21lIG9mIHRoZWlyIHRva2VucyB0byBhIG5ldyBjb250cmFjdC4KICAgKi8KICBmdW5jdGlvbiB1cGdyYWRlKHVpbnQgdmFsdWUpIHB1YmxpYyB7CiAgICBVcGdyYWRlU3RhdGUgc3RhdGUgPSBnZXRVcGdyYWRlU3RhdGUoKTsKICAgIC8vIEVuc3VyZSBpdCdzIG5vdCBjYWxsZWQgaW4gYSBiYWQgc3RhdGUKICAgIHJlcXVpcmUoc3RhdGUgPT0gVXBncmFkZVN0YXRlLlJlYWR5VG9VcGdyYWRlIHx8IHN0YXRlID09IFVwZ3JhZGVTdGF0ZS5VcGdyYWRpbmcpOwoKICAgIC8vIFZhbGlkYXRlIGlucHV0IHZhbHVlLgogICAgcmVxdWlyZSh2YWx1ZSAhPSAwKTsKCiAgICAvLyBVcGdyYWRlIGFnZW50IHJlaXNzdWVzIHRoZSB0b2tlbnMKICAgIHVwZ3JhZGVBZ2VudC51cGdyYWRlRnJvbShtc2cuc2VuZGVyLCB2YWx1ZSk7CiAgICAKICAgIC8vIFRha2UgdG9rZW5zIG91dCBmcm9tIGNpcmN1bGF0aW9uCiAgICBidXJuVG9rZW5zKG1zZy5zZW5kZXIsIHZhbHVlKTsKICAgIHRvdGFsVXBncmFkZWQgPSB0b3RhbFVwZ3JhZGVkLmFkZCh2YWx1ZSk7CgogICAgVXBncmFkZShtc2cuc2VuZGVyLCB1cGdyYWRlQWdlbnQsIHZhbHVlKTsKICB9CgogIC8qKgogICAqIFNldCBhbiB1cGdyYWRlIGFnZW50IHRoYXQgaGFuZGxlcyB0aGUgdXBncmFkZSBwcm9jZXNzCiAgICovCiAgZnVuY3Rpb24gc2V0VXBncmFkZUFnZW50KGFkZHJlc3MgYWdlbnQpIG9ubHlNYXN0ZXIgZXh0ZXJuYWwgewogICAgLy8gQ2hlY2sgd2hldGhlciB0aGUgdG9rZW4gaXMgaW4gYSBzdGF0ZSB0aGF0IHdlIGNvdWxkIHRoaW5rIG9mIHVwZ3JhZGluZwogICAgcmVxdWlyZShjYW5VcGdyYWRlKCkpOwoKICAgIHJlcXVpcmUoYWdlbnQgIT0gMHgwKTsKICAgIC8vIFVwZ3JhZGUgaGFzIGFscmVhZHkgYmVndW4gZm9yIGFuIGFnZW50CiAgICByZXF1aXJlKGdldFVwZ3JhZGVTdGF0ZSgpICE9IFVwZ3JhZGVTdGF0ZS5VcGdyYWRpbmcpOwoKICAgIHVwZ3JhZGVBZ2VudCA9IFVwZ3JhZGVBZ2VudChhZ2VudCk7CgogICAgLy8gQmFkIGludGVyZmFjZQogICAgcmVxdWlyZSh1cGdyYWRlQWdlbnQuaXNVcGdyYWRlQWdlbnQoKSk7CiAgICAvLyBNYWtlIHN1cmUgdGhhdCB0b2tlbiBzdXBwbGllcyBtYXRjaCBpbiBzb3VyY2UgYW5kIHRhcmdldAogICAgcmVxdWlyZSh1cGdyYWRlQWdlbnQub3JpZ2luYWxTdXBwbHkoKSA9PSB0b3RhbFN1cHBseSgpKTsKCiAgICBVcGdyYWRlQWdlbnRTZXQodXBncmFkZUFnZW50KTsKICB9CgogIC8qKgogICAqIEdldCB0aGUgc3RhdGUgb2YgdGhlIHRva2VuIHVwZ3JhZGUuCiAgICovCiAgZnVuY3Rpb24gZ2V0VXBncmFkZVN0YXRlKCkgcHVibGljIHZpZXcgcmV0dXJucyhVcGdyYWRlU3RhdGUpIHsKICAgIGlmICghY2FuVXBncmFkZSgpKSByZXR1cm4gVXBncmFkZVN0YXRlLk5vdEFsbG93ZWQ7CiAgICBlbHNlIGlmIChhZGRyZXNzKHVwZ3JhZGVBZ2VudCkgPT0gMHgwMCkgcmV0dXJuIFVwZ3JhZGVTdGF0ZS5XYWl0aW5nRm9yQWdlbnQ7CiAgICBlbHNlIGlmICh0b3RhbFVwZ3JhZGVkID09IDApIHJldHVybiBVcGdyYWRlU3RhdGUuUmVhZHlUb1VwZ3JhZGU7CiAgICBlbHNlIHJldHVybiBVcGdyYWRlU3RhdGUuVXBncmFkaW5nOwogIH0KCiAgLyoqCiAgICogQ2hhbmdlIHRoZSB1cGdyYWRlIG1hc3Rlci4KICAgKgogICAqIFRoaXMgYWxsb3dzIHVzIHRvIHNldCBhIG5ldyBvd25lciBmb3IgdGhlIHVwZ3JhZGUgbWVjaGFuaXNtLgogICAqLwogIGZ1bmN0aW9uIGNoYW5nZVVwZ3JhZGVNYXN0ZXIoYWRkcmVzcyBuZXdfbWFzdGVyKSBvbmx5TWFzdGVyIHB1YmxpYyB7CiAgICBzZXRVcGdyYWRlTWFzdGVyKG5ld19tYXN0ZXIpOwogIH0KCiAgLyoqCiAgICogSW50ZXJuYWwgdXBncmFkZSBtYXN0ZXIgc2V0dGVyLgogICAqLwogIGZ1bmN0aW9uIHNldFVwZ3JhZGVNYXN0ZXIoYWRkcmVzcyBuZXdfbWFzdGVyKSBwcml2YXRlIHsKICAgIHJlcXVpcmUobmV3X21hc3RlciAhPSAweDApOwogICAgdXBncmFkZU1hc3RlciA9IG5ld19tYXN0ZXI7CiAgfQoKICAvKioKICAgKiBDaGlsZCBjb250cmFjdCBjYW4gb3ZlcnJpZGUgdG8gcHJvdmlkZSB0aGUgY29uZGl0aW9uIGluIHdoaWNoIHRoZSB1cGdyYWRlIGNhbiBiZWdpbi4KICAgKi8KICBmdW5jdGlvbiBjYW5VcGdyYWRlKCkgcHVibGljIHZpZXcgcmV0dXJucyhib29sKSB7CiAgICAgcmV0dXJuIHRydWU7CiAgfQoKCiAgbW9kaWZpZXIgb25seU1hc3RlcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSB1cGdyYWRlTWFzdGVyKTsKICAgIF87CiAgfQp9CgpwcmFnbWEgc29saWRpdHkgXjAuNC4xOTsKCi8qKgogKiBBdXRob3JlZCBieSBodHRwczovL3d3dy5jb2luZmFicmlrLmNvbS8KICovCgoKLy8gVGhpcyBjb250cmFjdCBhaW1zIHRvIHByb3ZpZGUgYW4gaW5oZXJpdGFibGUgd2F5IHRvIHJlY292ZXIgdG9rZW5zIGZyb20gYSBjb250cmFjdCBub3QgbWVhbnQgdG8gaG9sZCB0b2tlbnMKLy8gVG8gdXNlIHRoaXMgY29udHJhY3QsIGhhdmUgeW91ciB0b2tlbi1pZ25vcmluZyBjb250cmFjdCBpbmhlcml0IHRoaXMgb25lIGFuZCBpbXBsZW1lbnQgZ2V0TG9zdEFuZEZvdW5kTWFzdGVyIHRvIGRlY2lkZSB3aG8gY2FuIG1vdmUgbG9zdCB0b2tlbnMuCi8vIE9mIGNvdXJzZSwgdGhpcyBjb250cmFjdCBpbXBvc2VzIHN1cHBvcnQgY29zdHMgdXBvbiB3aG9ldmVyIGlzIHRoZSBsb3N0IGFuZCBmb3VuZCBtYXN0ZXIuCmNvbnRyYWN0IExvc3RBbmRGb3VuZFRva2VuIHsKICAvKioKICAgKiBAcmV0dXJuIEFkZHJlc3Mgb2YgdGhlIGFjY291bnQgdGhhdCBoYW5kbGVzIG1vdmVtZW50cy4KICAgKi8KICBmdW5jdGlvbiBnZXRMb3N0QW5kRm91bmRNYXN0ZXIoKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGFkZHJlc3MpOwoKICAvKioKICAgKiBAcGFyYW0gYWdlbnQgQWRkcmVzcyB0aGF0IHdpbGwgYmUgYWJsZSB0byBtb3ZlIHRva2VucyB3aXRoIHRyYW5zZmVyRnJvbQogICAqIEBwYXJhbSB0b2tlbnMgQW1vdW50IG9mIHRva2VucyBhcHByb3ZlZCBmb3IgdHJhbnNmZXIKICAgKiBAcGFyYW0gdG9rZW5fY29udHJhY3QgQ29udHJhY3Qgb2YgdGhlIHRva2VuCiAgICovCiAgZnVuY3Rpb24gZW5hYmxlTG9zdEFuZEZvdW5kKGFkZHJlc3MgYWdlbnQsIHVpbnQgdG9rZW5zLCBFSVAyMFRva2VuIHRva2VuX2NvbnRyYWN0KSBwdWJsaWMgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGdldExvc3RBbmRGb3VuZE1hc3RlcigpKTsKICAgIC8vIFdlIHVzZSBhcHByb3ZlIGluc3RlYWQgb2YgdHJhbnNmZXIgdG8gbWluaW1pemUgdGhlIHBvc3NpYmlsaXR5IG9mIHRoZSBsb3N0IGFuZCBmb3VuZCBtYXN0ZXIKICAgIC8vICBnZXR0aW5nIHRoZW0gc3R1Y2sgaW4gYW5vdGhlciBhZGRyZXNzIGJ5IGFjY2lkZW50LgogICAgdG9rZW5fY29udHJhY3QuYXBwcm92ZShhZ2VudCwgdG9rZW5zKTsKICB9Cn0KcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovKioKICogT3JpZ2luYWxseSBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28KICogTW9kaWZpZWQgYnkgaHR0cHM6Ly93d3cuY29pbmZhYnJpay5jb20vCiAqLwoKCi8qKgogKiBBIHB1YmxpYyBpbnRlcmZhY2UgdG8gaW5jcmVhc2UgdGhlIHN1cHBseSBvZiBhIHRva2VuLgogKgogKiBUaGlzIGFsbG93cyB1bmNhcHBlZCBjcm93ZHNhbGUgYnkgZHluYW1pY2FsbHkgaW5jcmVhc2luZyB0aGUgc3VwcGx5IHdoZW4gbW9uZXkgcG91cnMgaW4uCiAqIE9ubHkgbWludCBhZ2VudHMsIHVzdWFsbHkgY29udHJhY3RzIHdoaXRlbGlzdGVkIGJ5IHRoZSBvd25lciwgY2FuIG1pbnQgbmV3IHRva2Vucy4KICoKICovCmNvbnRyYWN0IE1pbnRhYmxlVG9rZW4gaXMgTWludGFibGUsIE93bmFibGUgewoKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgYm9vbCBwdWJsaWMgbWludGluZ0ZpbmlzaGVkID0gZmFsc2U7CgogIC8qKiBMaXN0IG9mIGFnZW50cyB0aGF0IGFyZSBhbGxvd2VkIHRvIGNyZWF0ZSBuZXcgdG9rZW5zICovCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgbWludEFnZW50czsKCiAgZXZlbnQgTWludGluZ0FnZW50Q2hhbmdlZChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdGUpOwoKCiAgZnVuY3Rpb24gTWludGFibGVUb2tlbih1aW50IGluaXRpYWxTdXBwbHksIGFkZHJlc3MgbXVsdGlzaWcsIGJvb2wgbWludGFibGUpIGludGVybmFsIHsKICAgIHJlcXVpcmUobXVsdGlzaWcgIT0gYWRkcmVzcygwKSk7CiAgICAvLyBDYW5ub3QgY3JlYXRlIGEgdG9rZW4gd2l0aG91dCBzdXBwbHkgYW5kIG5vIG1pbnRpbmcKICAgIHJlcXVpcmUobWludGFibGUgfHwgaW5pdGlhbFN1cHBseSAhPSAwKTsKICAgIC8vIENyZWF0ZSBpbml0aWFsbHkgYWxsIGJhbGFuY2Ugb24gdGhlIHRlYW0gbXVsdGlzaWcKICAgIGlmIChpbml0aWFsU3VwcGx5ID4gMCkKICAgICAgbWludEludGVybmFsKG11bHRpc2lnLCBpbml0aWFsU3VwcGx5KTsKICAgIC8vIE5vIG1vcmUgbmV3IHN1cHBseSBhbGxvd2VkIGFmdGVyIHRoZSB0b2tlbiBjcmVhdGlvbgogICAgbWludGluZ0ZpbmlzaGVkID0gIW1pbnRhYmxlOwogIH0KCiAgLyoqCiAgICogQ3JlYXRlIG5ldyB0b2tlbnMgYW5kIGFsbG9jYXRlIHRoZW0gdG8gYW4gYWRkcmVzcy4KICAgKgogICAqIE9ubHkgY2FsbGFibGUgYnkgYSBtaW50IGFnZW50IChlLmcuIGNyb3dkc2FsZSBjb250cmFjdCkuCiAgICovCiAgZnVuY3Rpb24gbWludChhZGRyZXNzIHJlY2VpdmVyLCB1aW50IGFtb3VudCkgb25seU1pbnRBZ2VudCBjYW5NaW50IHB1YmxpYyB7CiAgICBtaW50SW50ZXJuYWwocmVjZWl2ZXIsIGFtb3VudCk7CiAgfQoKICAvKioKICAgKiBPd25lciBjYW4gYWxsb3cgYSBjcm93ZHNhbGUgY29udHJhY3QgdG8gbWludCBuZXcgdG9rZW5zLgogICAqLwogIGZ1bmN0aW9uIHNldE1pbnRBZ2VudChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdGUpIG9ubHlPd25lciBjYW5NaW50IHB1YmxpYyB7CiAgICBtaW50QWdlbnRzW2FkZHJdID0gc3RhdGU7CiAgICBNaW50aW5nQWdlbnRDaGFuZ2VkKGFkZHIsIHN0YXRlKTsKICB9CgogIG1vZGlmaWVyIG9ubHlNaW50QWdlbnQoKSB7CiAgICAvLyBPbmx5IG1pbnQgYWdlbnRzIGFyZSBhbGxvd2VkIHRvIG1pbnQgbmV3IHRva2VucwogICAgcmVxdWlyZShtaW50QWdlbnRzW21zZy5zZW5kZXJdKTsKICAgIF87CiAgfQoKICAvKiogTWFrZSBzdXJlIHdlIGFyZSBub3QgZG9uZSB5ZXQuICovCiAgbW9kaWZpZXIgY2FuTWludCgpIHsKICAgIHJlcXVpcmUoIW1pbnRpbmdGaW5pc2hlZCk7CiAgICBfOwogIH0KfQoKLyoqCiAqIEEgY3Jvd2RzYWxlIHRva2VuLgogKgogKiBBbiBFUkMtMjAgdG9rZW4gZGVzaWduZWQgc3BlY2lmaWNhbGx5IGZvciBjcm93ZHNhbGVzIHdpdGggaW52ZXN0b3IgcHJvdGVjdGlvbiBhbmQgZnVydGhlciBkZXZlbG9wbWVudCBwYXRoLgogKgogKiAtIFRoZSB0b2tlbiB0cmFuc2ZlcigpIGlzIGRpc2FibGVkIHVudGlsIHRoZSBjcm93ZHNhbGUgaXMgb3ZlcgogKiAtIFRoZSB0b2tlbiBjb250cmFjdCBnaXZlcyBhbiBvcHQtaW4gdXBncmFkZSBwYXRoIHRvIGEgbmV3IGNvbnRyYWN0CiAqIC0gVGhlIHNhbWUgdG9rZW4gY2FuIGJlIHBhcnQgb2Ygc2V2ZXJhbCBjcm93ZHNhbGVzIHRocm91Z2ggdGhlIGFwcHJvdmUoKSBtZWNoYW5pc20KICogLSBUaGUgdG9rZW4gY2FuIGJlIGNhcHBlZCAoc3VwcGx5IHNldCBpbiB0aGUgY29uc3RydWN0b3IpIG9yIHVuY2FwcGVkIChjcm93ZHNhbGUgY29udHJhY3QgY2FuIG1pbnQgbmV3IHRva2VucykKICogLSBFUkMyMCB0b2tlbnMgdHJhbnNmZXJyZWQgdG8gdGhpcyBjb250cmFjdCBjYW4gYmUgcmVjb3ZlcmVkIGJ5IGEgbG9zdCBhbmQgZm91bmQgbWFzdGVyCiAqCiAqLwpjb250cmFjdCBDcm93ZHNhbGVUb2tlbiBpcyBSZWxlYXNhYmxlVG9rZW4sIE1pbnRhYmxlVG9rZW4sIFVwZ3JhZGVhYmxlVG9rZW4sIExvc3RBbmRGb3VuZFRva2VuIHsKCiAgc3RyaW5nIHB1YmxpYyBuYW1lID0gIkNyeXB0b3NvbGFydGVjaCI7CgogIHN0cmluZyBwdWJsaWMgc3ltYm9sID0gIkNTVCI7CgogIHVpbnQ4IHB1YmxpYyBkZWNpbWFsczsKCiAgYWRkcmVzcyBwdWJsaWMgbG9zdF9hbmRfZm91bmRfbWFzdGVyOwoKICAvKioKICAgKiBDb25zdHJ1Y3QgdGhlIHRva2VuLgogICAqCiAgICogVGhpcyB0b2tlbiBtdXN0IGJlIGNyZWF0ZWQgdGhyb3VnaCBhIHRlYW0gbXVsdGlzaWcgd2FsbGV0LCBzbyB0aGF0IGl0IGlzIG93bmVkIGJ5IHRoYXQgd2FsbGV0LgogICAqCiAgICogQHBhcmFtIGluaXRpYWxfc3VwcGx5IEhvdyBtYW55IHRva2VucyB3ZSBzdGFydCB3aXRoLgogICAqIEBwYXJhbSB0b2tlbl9kZWNpbWFscyBOdW1iZXIgb2YgZGVjaW1hbCBwbGFjZXMuCiAgICogQHBhcmFtIHRlYW1fbXVsdGlzaWcgQWRkcmVzcyBvZiB0aGUgbXVsdGlzaWcgdGhhdCByZWNlaXZlcyB0aGUgaW5pdGlhbCBzdXBwbHkgYW5kIGlzIHNldCBhcyB0aGUgdXBncmFkZSBtYXN0ZXIuCiAgICogQHBhcmFtIHRva2VuX3JldHJpZXZlciBBZGRyZXNzIG9mIHRoZSBhY2NvdW50IHRoYXQgaGFuZGxlcyBFUkMyMCB0b2tlbnMgdGhhdCB3ZXJlIGFjY2lkZW50YWxseSBzZW50IHRvIHRoaXMgY29udHJhY3QuCiAgICovCiAgZnVuY3Rpb24gQ3Jvd2RzYWxlVG9rZW4odWludCBpbml0aWFsX3N1cHBseSwgdWludDggdG9rZW5fZGVjaW1hbHMsIGFkZHJlc3MgdGVhbV9tdWx0aXNpZywgYWRkcmVzcyB0b2tlbl9yZXRyaWV2ZXIpIHB1YmxpYwogIFVwZ3JhZGVhYmxlVG9rZW4odGVhbV9tdWx0aXNpZykgTWludGFibGVUb2tlbihpbml0aWFsX3N1cHBseSwgdGVhbV9tdWx0aXNpZywgdHJ1ZSkgewogICAgcmVxdWlyZSh0b2tlbl9yZXRyaWV2ZXIgIT0gYWRkcmVzcygwKSk7CiAgICBkZWNpbWFscyA9IHRva2VuX2RlY2ltYWxzOwogICAgbG9zdF9hbmRfZm91bmRfbWFzdGVyID0gdG9rZW5fcmV0cmlldmVyOwogIH0KCiAgLyoqCiAgICogV2hlbiB0b2tlbiBpcyByZWxlYXNlZCB0byBiZSB0cmFuc2ZlcmFibGUsIHByb2hpYml0IG5ldyB0b2tlbiBjcmVhdGlvbi4KICAgKi8KICBmdW5jdGlvbiByZWxlYXNlVG9rZW5UcmFuc2ZlcigpIHB1YmxpYyBvbmx5UmVsZWFzZUFnZW50IHsKICAgIG1pbnRpbmdGaW5pc2hlZCA9IHRydWU7CiAgICBzdXBlci5yZWxlYXNlVG9rZW5UcmFuc2ZlcigpOwogIH0KCiAgLyoqCiAgICogQWxsb3cgdXBncmFkZSBhZ2VudCBmdW5jdGlvbmFsaXR5IHRvIGtpY2sgaW4gb25seSBpZiB0aGUgY3Jvd2RzYWxlIHdhcyBhIHN1Y2Nlc3MuCiAgICovCiAgZnVuY3Rpb24gY2FuVXBncmFkZSgpIHB1YmxpYyB2aWV3IHJldHVybnMoYm9vbCkgewogICAgcmV0dXJuIHJlbGVhc2VkICYmIHN1cGVyLmNhblVwZ3JhZGUoKTsKICB9CgogIGZ1bmN0aW9uIGJ1cm4odWludCB2YWx1ZSkgcHVibGljIHsKICAgIGJ1cm5Ub2tlbnMobXNnLnNlbmRlciwgdmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gZ2V0TG9zdEFuZEZvdW5kTWFzdGVyKCkgaW50ZXJuYWwgdmlldyByZXR1cm5zKGFkZHJlc3MpIHsKICAgIHJldHVybiBsb3N0X2FuZF9mb3VuZF9tYXN0ZXI7CiAgfQp9CgovKioKICogQWJzdHJhY3QgYmFzZSBjb250cmFjdCBmb3IgdG9rZW4gc2FsZXMuCiAqCiAqIEhhbmRsZXMKICogLSBzdGFydCBhbmQgZW5kIGRhdGVzCiAqIC0gYWNjZXB0aW5nIGludmVzdG1lbnRzCiAqIC0gdmFyaW91cyBzdGF0aXN0aWNzIGR1cmluZyB0aGUgY3Jvd2RmdW5kCiAqIC0gZGlmZmVyZW50IGludmVzdG1lbnQgcG9saWNpZXMgKHJlcXVpcmUgc2VydmVyIHNpZGUgY3VzdG9tZXIgaWQsIGFsbG93IG9ubHkgd2hpdGVsaXN0ZWQgYWRkcmVzc2VzKQogKgogKi8KY29udHJhY3QgR2VuZXJpY0Nyb3dkc2FsZSBpcyBIYWx0YWJsZSB7CgogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50OwoKICAvKiBUaGUgdG9rZW4gd2UgYXJlIHNlbGxpbmcgKi8KICBDcm93ZHNhbGVUb2tlbiBwdWJsaWMgdG9rZW47CgogIC8qIGV0aGVyIHdpbGwgYmUgdHJhbnNmZXJyZWQgdG8gdGhpcyBhZGRyZXNzICovCiAgYWRkcmVzcyBwdWJsaWMgbXVsdGlzaWdXYWxsZXQ7CgogIC8qIHRoZSBzdGFydGluZyB0aW1lc3RhbXAgb2YgdGhlIGNyb3dkc2FsZSAqLwogIHVpbnQgcHVibGljIHN0YXJ0c0F0OwoKICAvKiB0aGUgZW5kaW5nIHRpbWVzdGFtcCBvZiB0aGUgY3Jvd2RzYWxlICovCiAgdWludCBwdWJsaWMgZW5kc0F0OwoKICAvKiB0aGUgbnVtYmVyIG9mIHRva2VucyBhbHJlYWR5IHNvbGQgdGhyb3VnaCB0aGlzIGNvbnRyYWN0Ki8KICB1aW50IHB1YmxpYyB0b2tlbnNTb2xkID0gMDsKCiAgLyogSG93IG1hbnkgd2VpIG9mIGZ1bmRpbmcgd2UgaGF2ZSByYWlzZWQgKi8KICB1aW50IHB1YmxpYyB3ZWlSYWlzZWQgPSAwOwoKICAvKiBIb3cgbWFueSBkaXN0aW5jdCBhZGRyZXNzZXMgaGF2ZSBpbnZlc3RlZCAqLwogIHVpbnQgcHVibGljIGludmVzdG9yQ291bnQgPSAwOwoKICAvKiBIYXMgdGhpcyBjcm93ZHNhbGUgYmVlbiBmaW5hbGl6ZWQgKi8KICBib29sIHB1YmxpYyBmaW5hbGl6ZWQgPSBmYWxzZTsKCiAgLyogRG8gd2UgbmVlZCB0byBoYXZlIGEgdW5pcXVlIGNvbnRyaWJ1dG9yIGlkIGZvciBlYWNoIGN1c3RvbWVyICovCiAgYm9vbCBwdWJsaWMgcmVxdWlyZUN1c3RvbWVySWQgPSBmYWxzZTsKCiAgLyogSGFzIHRoaXMgY3Jvd2RzYWxlIGJlZW4gY29uZmlndXJlZCAqLwogIGJvb2wgcHVibGljIGNvbmZpZ3VyZWQgPSBmYWxzZTsKCiAgLyoqCiAgICogRG8gd2UgdmVyaWZ5IHRoYXQgY29udHJpYnV0b3IgaGFzIGJlZW4gY2xlYXJlZCBvbiB0aGUgc2VydmVyIHNpZGUgKGFjY3JlZGl0ZWQgaW52ZXN0b3JzIG9ubHkpLgogICAqIFRoaXMgbWV0aG9kIHdhcyBmaXJzdCB1c2VkIGluIHRoZSBGaXJzdEJsb29kIGNyb3dkc2FsZSB0byBlbnN1cmUgYWxsIGNvbnRyaWJ1dG9ycyBoYWQgYWNjZXB0ZWQgdGVybXMgb2Ygc2FsZSAob24gdGhlIHdlYikuCiAgICovCiAgYm9vbCBwdWJsaWMgcmVxdWlyZWRTaWduZWRBZGRyZXNzID0gZmFsc2U7CgogIC8qKiBTZXJ2ZXIgc2lkZSBhZGRyZXNzIHRoYXQgc2lnbmVkIGFsbG93ZWQgY29udHJpYnV0b3JzIChFdGhlcmV1bSBhZGRyZXNzZXMpIHRoYXQgY2FuIHBhcnRpY2lwYXRlIHRoZSBjcm93ZHNhbGUgKi8KICBhZGRyZXNzIHB1YmxpYyBzaWduZXJBZGRyZXNzOwoKICAvKiogSG93IG1hbnkgRVRIIGVhY2ggYWRkcmVzcyBoYXMgaW52ZXN0ZWQgaW4gdGhpcyBjcm93ZHNhbGUgKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyBpbnZlc3RlZEFtb3VudE9mOwoKICAvKiogSG93IG1hbnkgdG9rZW5zIHRoaXMgY3Jvd2RzYWxlIGhhcyBjcmVkaXRlZCBmb3IgZWFjaCBpbnZlc3RvciBhZGRyZXNzICovCiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgdG9rZW5BbW91bnRPZjsKCiAgLyoqIEFkZHJlc3NlcyB0aGF0IGFyZSBhbGxvd2VkIHRvIGludmVzdCBldmVuIGJlZm9yZSBJQ08gb2ZmaWNpYWxseSBvcGVucy4gRm9yIHRlc3RpbmcsIGZvciBJQ08gcGFydG5lcnMsIGV0Yy4gKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBlYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0OwoKICAvKiogU3RhdGUgbWFjaGluZQogICAqCiAgICogLSBQZW5kaW5nQ29uZmlndXJhdGlvbjogQ3Jvd2RzYWxlIG5vdCB5ZXQgY29uZmlndXJlZAogICAqIC0gUHJlZnVuZGluZzogV2UgaGF2ZSBub3QgcmVhY2hlZCB0aGUgc3RhcnRpbmcgdGltZXN0YW1wIHlldAogICAqIC0gRnVuZGluZzogQWN0aXZlIGNyb3dkc2FsZQogICAqIC0gU3VjY2VzczogQ3Jvd2RzYWxlIGVuZGVkCiAgICogLSBGaW5hbGl6ZWQ6IFRoZSBmaW5hbGl6ZSBmdW5jdGlvbiBoYXMgYmVlbiBjYWxsZWQgYW5kIHN1Y2Nlc3NmdWxseSBleGVjdXRlZAogICAqLwogIGVudW0gU3RhdGV7VW5rbm93biwgUGVuZGluZ0NvbmZpZ3VyYXRpb24sIFByZUZ1bmRpbmcsIEZ1bmRpbmcsIFN1Y2Nlc3MsIEZpbmFsaXplZH0KCgogIC8vIEEgbmV3IGludmVzdG1lbnQgd2FzIG1hZGUKICBldmVudCBJbnZlc3RlZChhZGRyZXNzIGludmVzdG9yLCB1aW50IHdlaUFtb3VudCwgdWludCB0b2tlbkFtb3VudCwgdWludDEyOCBjdXN0b21lcklkKTsKCiAgLy8gVGhlIHJ1bGVzIGFib3V0IHdoYXQga2luZCBvZiBpbnZlc3RtZW50cyB3ZSBhY2NlcHQgd2VyZSBjaGFuZ2VkCiAgZXZlbnQgSW52ZXN0bWVudFBvbGljeUNoYW5nZWQoYm9vbCByZXF1aXJlQ0lkLCBib29sIHJlcXVpcmVTaWduZWRBZGRyZXNzLCBhZGRyZXNzIHNpZ25lcik7CgogIC8vIEFkZHJlc3MgZWFybHkgcGFydGljaXBhdGlvbiB3aGl0ZWxpc3Qgc3RhdHVzIGNoYW5nZWQKICBldmVudCBXaGl0ZWxpc3RlZChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdHVzKTsKCiAgLy8gQ3Jvd2RzYWxlJ3MgZmluYWxpemUgZnVuY3Rpb24gaGFzIGJlZW4gY2FsbGVkCiAgZXZlbnQgRmluYWxpemVkKCk7CgogIC8qCiAgICogVGhlIGNvbmZpZ3VyYXRpb24gZnJvbSB0aGUgY29uc3RydWN0b3Igd2FzIG1vdmVkIHRvIHRoZSBjb25maWd1cmF0aW9uR2VuZXJpY0Nyb3dkc2FsZSBmdW5jdGlvbi4KICAgKgogICAqIEBwYXJhbSB0ZWFtX211bHRpc2lnIEFkZHJlc3Mgb2YgdGhlIG11bHRpc2lnbmF0dXJlIHdhbGxldCBvZiB0aGUgdGVhbSB0aGF0IHdpbGwgcmVjZWl2ZSBhbGwgdGhlIGZ1bmRzIGNvbnRyaWJ1dGVkIGluIHRoZSBjcm93ZHNhbGUuCiAgICogQHBhcmFtIHN0YXJ0IFRpbWVzdGFtcCB3aGVyZSB0aGUgY3Jvd2RzYWxlIHdpbGwgYmUgb2ZmaWNpYWxseSBzdGFydGVkLiBJdCBzaG91bGQgYmUgZ3JlYXRlciB0aGFuIHRoZSB0aW1lc3RhbXAgaW4gd2hpY2ggdGhlIGNvbnRyYWN0IGlzIGRlcGxveWVkLgogICAqIEBwYXJhbSBlbmQgVGltZXN0YW1wIHdoZXJlIHRoZSBjcm93ZHNhbGUgZmluaXNoZXMuIE5vIHRva2VucyBjYW4gYmUgc29sZCB0aHJvdWdoIHRoaXMgY29udHJhY3QgYWZ0ZXIgdGhpcyB0aW1lc3RhbXAuCiAgICoKICAgKiBjb25maWd1cmF0aW9uR2VuZXJpY0Nyb3dkc2FsZSBjYW4gb25seSBiZSBjYWxsZWQgd2hlbiBpbiBTdGF0ZS5QZW5kaW5nQ29uZmlndXJhdGlvbiBiZWNhdXNlIG9mIHRoZSBpblN0YXRlIG1vZGlmaWVyLgogICAqLwogIGZ1bmN0aW9uIGNvbmZpZ3VyYXRpb25HZW5lcmljQ3Jvd2RzYWxlKGFkZHJlc3MgdGVhbV9tdWx0aXNpZywgdWludCBzdGFydCwgdWludCBlbmQpIGludGVybmFsIGluU3RhdGUoU3RhdGUuUGVuZGluZ0NvbmZpZ3VyYXRpb24pIHsKICAgIHNldE11bHRpc2lnKHRlYW1fbXVsdGlzaWcpOwoKICAgIC8vIERvbid0IG1lc3MgdGhlIGRhdGVzCiAgICByZXF1aXJlKHN0YXJ0ICE9IDAgJiYgZW5kICE9IDApOwogICAgcmVxdWlyZShub3cgPCBzdGFydCAmJiBzdGFydCA8IGVuZCk7CiAgICBzdGFydHNBdCA9IHN0YXJ0OwogICAgZW5kc0F0ID0gZW5kOwogICAgY29uZmlndXJlZCA9IHRydWU7CiAgfQoKICAvKioKICAgKiBEZWZhdWx0IGZhbGxiYWNrIGJlaGF2aW91ciBpcyB0byBjYWxsIGJ1eS4KICAgKiBJZGVhbGx5LCBubyBjb250cmFjdCBjYWxscyB0aGlzIGNyb3dkc2FsZSB3aXRob3V0IHN1cHBvcnRpbmcgRVJDMjAuCiAgICogSG93ZXZlciwgc29tZSBzb3J0IG9mIHJlZnVuZGluZyBmdW5jdGlvbiBtYXkgYmUgZGVzaXJlZCB0byBjb3ZlciBzdWNoIHNpdHVhdGlvbnMuCiAgICovCiAgZnVuY3Rpb24oKSBwYXlhYmxlIHB1YmxpYyB7CiAgICBidXkoKTsKICB9CgogIC8qKgogICAqIE1ha2UgYW4gaW52ZXN0bWVudC4KICAgKgogICAqIFRoZSBjcm93ZHNhbGUgbXVzdCBiZSBydW5uaW5nIGZvciBvbmUgdG8gaW52ZXN0LgogICAqIFdlIG11c3QgaGF2ZSBub3QgcHJlc3NlZCB0aGUgZW1lcmdlbmN5IGJyYWtlLgogICAqCiAgICogQHBhcmFtIHJlY2VpdmVyIFRoZSBFdGhlcmV1bSBhZGRyZXNzIHdobyByZWNlaXZlcyB0aGUgdG9rZW5zCiAgICogQHBhcmFtIGN1c3RvbWVySWQgKG9wdGlvbmFsKSBVVUlEIHY0IHRvIHRyYWNrIHRoZSBzdWNjZXNzZnVsIHBheW1lbnRzIG9uIHRoZSBzZXJ2ZXIgc2lkZQogICAqCiAgICovCiAgZnVuY3Rpb24gaW52ZXN0SW50ZXJuYWwoYWRkcmVzcyByZWNlaXZlciwgdWludDEyOCBjdXN0b21lcklkKSBzdG9wSW5FbWVyZ2VuY3kgbm90RmluaXNoZWQgcHJpdmF0ZSB7CiAgICAvLyBEZXRlcm1pbmUgaWYgaXQncyBhIGdvb2QgdGltZSB0byBhY2NlcHQgaW52ZXN0bWVudCBmcm9tIHRoaXMgcGFydGljaXBhbnQKICAgIGlmIChnZXRTdGF0ZSgpID09IFN0YXRlLlByZUZ1bmRpbmcpIHsKICAgICAgLy8gQXJlIHdlIHdoaXRlbGlzdGVkIGZvciBlYXJseSBkZXBvc2l0CiAgICAgIHJlcXVpcmUoZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdFttc2cuc2VuZGVyXSk7CiAgICB9CgogICAgdWludCB3ZWlBbW91bnQ7CiAgICB1aW50IHRva2VuQW1vdW50OwogICAgKHdlaUFtb3VudCwgdG9rZW5BbW91bnQpID0gY2FsY3VsYXRlVG9rZW5BbW91bnQobXNnLnZhbHVlLCByZWNlaXZlcik7CiAgICAvLyBTYW5pdHkgY2hlY2sgYWdhaW5zdCBiYWQgaW1wbGVtZW50YXRpb24uCiAgICBhc3NlcnQod2VpQW1vdW50IDw9IG1zZy52YWx1ZSk7CiAgICAKICAgIC8vIER1c3QgdHJhbnNhY3Rpb24gaWYgbm8gdG9rZW5zIGNhbiBiZSBnaXZlbgogICAgcmVxdWlyZSh0b2tlbkFtb3VudCAhPSAwKTsKCiAgICBpZiAoaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0gPT0gMCkgewogICAgICAvLyBBIG5ldyBpbnZlc3RvcgogICAgICBpbnZlc3RvckNvdW50Kys7CiAgICB9CiAgICB1cGRhdGVJbnZlc3RvckZ1bmRzKHRva2VuQW1vdW50LCB3ZWlBbW91bnQsIHJlY2VpdmVyLCBjdXN0b21lcklkKTsKCiAgICAvLyBQb2NrZXQgdGhlIG1vbmV5CiAgICBtdWx0aXNpZ1dhbGxldC50cmFuc2Zlcih3ZWlBbW91bnQpOwoKICAgIC8vIFJldHVybiBleGNlc3Mgb2YgbW9uZXkKICAgIHJldHVybkV4Y2VkZW50KG1zZy52YWx1ZS5zdWIod2VpQW1vdW50KSwgbXNnLnNlbmRlcik7CiAgfQoKICAvKioKICAgKiBQcmVhbGxvY2F0ZSB0b2tlbnMgZm9yIHRoZSBlYXJseSBpbnZlc3RvcnMuCiAgICoKICAgKiBQcmVhbGxvY2F0ZWQgdG9rZW5zIGhhdmUgYmVlbiBzb2xkIGJlZm9yZSB0aGUgYWN0dWFsIGNyb3dkc2FsZSBvcGVucy4KICAgKiBUaGlzIGZ1bmN0aW9uIG1pbnRzIHRoZSB0b2tlbnMgYW5kIG1vdmVzIHRoZSBjcm93ZHNhbGUgbmVlZGxlLgogICAqCiAgICogTm8gbW9uZXkgaXMgZXhjaGFuZ2VkLCBhcyB0aGUgY3Jvd2RzYWxlIHRlYW0gYWxyZWFkeSBoYXZlIHJlY2VpdmVkIHRoZSBwYXltZW50LgogICAqCiAgICogQHBhcmFtIHJlY2VpdmVyIEFjY291bnQgdGhhdCByZWNlaXZlcyB0aGUgdG9rZW5zLgogICAqIEBwYXJhbSBmdWxsVG9rZW5zIHRva2VucyBhcyBmdWxsIHRva2VucyAtIGRlY2ltYWwgcGxhY2VzIGFyZSBhZGRlZCBpbnRlcm5hbGx5LgogICAqIEBwYXJhbSB3ZWlQcmljZSBQcmljZSBvZiBhIHNpbmdsZSBpbmRpdmlzaWJsZSB0b2tlbiBpbiB3ZWkuCiAgICoKICAgKi8KICBmdW5jdGlvbiBwcmVhbGxvY2F0ZShhZGRyZXNzIHJlY2VpdmVyLCB1aW50IGZ1bGxUb2tlbnMsIHVpbnQgd2VpUHJpY2UpIHB1YmxpYyBvbmx5T3duZXIgbm90RmluaXNoZWQgewogICAgcmVxdWlyZShyZWNlaXZlciAhPSBhZGRyZXNzKDApKTsKICAgIHVpbnQgdG9rZW5BbW91bnQgPSBmdWxsVG9rZW5zLm11bCgxMCoqdWludCh0b2tlbi5kZWNpbWFscygpKSk7CiAgICByZXF1aXJlKHRva2VuQW1vdW50ICE9IDApOwogICAgdWludCB3ZWlBbW91bnQgPSB3ZWlQcmljZS5tdWwodG9rZW5BbW91bnQpOyAvLyBUaGlzIGNhbiBhbHNvIGJlIDAsIGluIHdoaWNoIGNhc2Ugd2UgZ2l2ZSBvdXQgdG9rZW5zIGZvciBmcmVlCiAgICB1cGRhdGVJbnZlc3RvckZ1bmRzKHRva2VuQW1vdW50LCB3ZWlBbW91bnQsIHJlY2VpdmVyICwgMCk7CiAgfQoKICAvKioKICAgKiBQcml2YXRlIGZ1bmN0aW9uIHRvIHVwZGF0ZSBhY2NvdW50aW5nIGluIHRoZSBjcm93ZHNhbGUuCiAgICovCiAgZnVuY3Rpb24gdXBkYXRlSW52ZXN0b3JGdW5kcyh1aW50IHRva2VuQW1vdW50LCB1aW50IHdlaUFtb3VudCwgYWRkcmVzcyByZWNlaXZlciwgdWludDEyOCBjdXN0b21lcklkKSBwcml2YXRlIHsKICAgIC8vIFVwZGF0ZSBpbnZlc3RvcgogICAgaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0gPSBpbnZlc3RlZEFtb3VudE9mW3JlY2VpdmVyXS5hZGQod2VpQW1vdW50KTsKICAgIHRva2VuQW1vdW50T2ZbcmVjZWl2ZXJdID0gdG9rZW5BbW91bnRPZltyZWNlaXZlcl0uYWRkKHRva2VuQW1vdW50KTsKCiAgICAvLyBVcGRhdGUgdG90YWxzCiAgICB3ZWlSYWlzZWQgPSB3ZWlSYWlzZWQuYWRkKHdlaUFtb3VudCk7CiAgICB0b2tlbnNTb2xkID0gdG9rZW5zU29sZC5hZGQodG9rZW5BbW91bnQpOwoKICAgIGFzc2lnblRva2VucyhyZWNlaXZlciwgdG9rZW5BbW91bnQpOwogICAgLy8gVGVsbCB1cyB0aGF0IHRoZSBpbnZlc3RtZW50IHdhcyBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5CiAgICBJbnZlc3RlZChyZWNlaXZlciwgd2VpQW1vdW50LCB0b2tlbkFtb3VudCwgY3VzdG9tZXJJZCk7CiAgfQoKICAvKioKICAgKiBJbnZlc3RpbmcgZnVuY3Rpb24gdGhhdCByZWNvZ25pemVzIHRoZSByZWNlaXZlciBhbmQgdmVyaWZpZXMgaGUgaXMgYWxsb3dlZCB0byBpbnZlc3QuCiAgICoKICAgKiBAcGFyYW0gY3VzdG9tZXJJZCBVVUlEdjQgdGhhdCBpZGVudGlmaWVzIHRoaXMgY29udHJpYnV0b3IKICAgKi8KICBmdW5jdGlvbiBidXlPbkJlaGFsZldpdGhTaWduZWRBZGRyZXNzKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQxMjggY3VzdG9tZXJJZCwgdWludDggdiwgYnl0ZXMzMiByLCBieXRlczMyIHMpIHB1YmxpYyBwYXlhYmxlIHZhbGlkQ3VzdG9tZXJJZChjdXN0b21lcklkKSB7CiAgICBieXRlczMyIGhhc2ggPSBzaGEyNTYocmVjZWl2ZXIpOwogICAgcmVxdWlyZShlY3JlY292ZXIoaGFzaCwgdiwgciwgcykgPT0gc2lnbmVyQWRkcmVzcyk7CiAgICBpbnZlc3RJbnRlcm5hbChyZWNlaXZlciwgY3VzdG9tZXJJZCk7CiAgfQoKICAvKioKICAgKiBJbnZlc3RpbmcgZnVuY3Rpb24gdGhhdCByZWNvZ25pemVzIHRoZSByZWNlaXZlci4KICAgKiAKICAgKiBAcGFyYW0gY3VzdG9tZXJJZCBVVUlEdjQgdGhhdCBpZGVudGlmaWVzIHRoaXMgY29udHJpYnV0b3IKICAgKi8KICBmdW5jdGlvbiBidXlPbkJlaGFsZldpdGhDdXN0b21lcklkKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQxMjggY3VzdG9tZXJJZCkgcHVibGljIHBheWFibGUgdmFsaWRDdXN0b21lcklkKGN1c3RvbWVySWQpIHVuc2lnbmVkQnV5QWxsb3dlZCB7CiAgICBpbnZlc3RJbnRlcm5hbChyZWNlaXZlciwgY3VzdG9tZXJJZCk7CiAgfQoKICAvKioKICAgKiBCdXlzIHRva2VucyBvbiBiZWhhbGYgb2YgYW4gYWRkcmVzcy4KICAgKgogICAqIFBheSBmb3IgZnVuZGluZywgZ2V0IGludmVzdGVkIHRva2VucyBiYWNrIGluIHRoZSByZWNlaXZlciBhZGRyZXNzLgogICAqLwogIGZ1bmN0aW9uIGJ1eU9uQmVoYWxmKGFkZHJlc3MgcmVjZWl2ZXIpIHB1YmxpYyBwYXlhYmxlIHVuc2lnbmVkQnV5QWxsb3dlZCB7CiAgICByZXF1aXJlKCFyZXF1aXJlQ3VzdG9tZXJJZCk7IC8vIENyb3dkc2FsZSBuZWVkcyB0byB0cmFjayBwYXJ0aWNpcGFudHMgZm9yIHRoYW5rIHlvdSBlbWFpbAogICAgaW52ZXN0SW50ZXJuYWwocmVjZWl2ZXIsIDApOwogIH0KCiAgLyoqCiAgICogSW52ZXN0aW5nIGZ1bmN0aW9uIHRoYXQgcmVjb2duaXplcyB0aGUgcGF5ZXIgYW5kIHZlcmlmaWVzIGhlIGlzIGFsbG93ZWQgdG8gaW52ZXN0LgogICAqCiAgICogQHBhcmFtIGN1c3RvbWVySWQgVVVJRHY0IHRoYXQgaWRlbnRpZmllcyB0aGlzIGNvbnRyaWJ1dG9yCiAgICovCiAgZnVuY3Rpb24gYnV5V2l0aFNpZ25lZEFkZHJlc3ModWludDEyOCBjdXN0b21lcklkLCB1aW50OCB2LCBieXRlczMyIHIsIGJ5dGVzMzIgcykgcHVibGljIHBheWFibGUgewogICAgYnV5T25CZWhhbGZXaXRoU2lnbmVkQWRkcmVzcyhtc2cuc2VuZGVyLCBjdXN0b21lcklkLCB2LCByLCBzKTsKICB9CgoKICAvKioKICAgKiBJbnZlc3RpbmcgZnVuY3Rpb24gdGhhdCByZWNvZ25pemVzIHRoZSBwYXllci4KICAgKiAKICAgKiBAcGFyYW0gY3VzdG9tZXJJZCBVVUlEdjQgdGhhdCBpZGVudGlmaWVzIHRoaXMgY29udHJpYnV0b3IKICAgKi8KICBmdW5jdGlvbiBidXlXaXRoQ3VzdG9tZXJJZCh1aW50MTI4IGN1c3RvbWVySWQpIHB1YmxpYyBwYXlhYmxlIHsKICAgIGJ1eU9uQmVoYWxmV2l0aEN1c3RvbWVySWQobXNnLnNlbmRlciwgY3VzdG9tZXJJZCk7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzaWMgZW50cnkgcG9pbnQgdG8gcGFydGljaXBhdGUgaW4gdGhlIGNyb3dkc2FsZSBwcm9jZXNzLgogICAqCiAgICogUGF5IGZvciBmdW5kaW5nLCBnZXQgaW52ZXN0ZWQgdG9rZW5zIGJhY2sgaW4gdGhlIHNlbmRlciBhZGRyZXNzLgogICAqLwogIGZ1bmN0aW9uIGJ1eSgpIHB1YmxpYyBwYXlhYmxlIHsKICAgIGJ1eU9uQmVoYWxmKG1zZy5zZW5kZXIpOwogIH0KCiAgLyoqCiAgICogRmluYWxpemUgYSBzdWNjZXNzZnVsIGNyb3dkc2FsZS4KICAgKgogICAqIFRoZSBvd25lciBjYW4gdHJpZ2dlciBwb3N0LWNyb3dkc2FsZSBhY3Rpb25zLCBsaWtlIHJlbGVhc2luZyB0aGUgdG9rZW5zLgogICAqIE5vdGUgdGhhdCBieSBkZWZhdWx0IHRva2VucyBhcmUgbm90IGluIGEgcmVsZWFzZWQgc3RhdGUuCiAgICovCiAgZnVuY3Rpb24gZmluYWxpemUoKSBwdWJsaWMgaW5TdGF0ZShTdGF0ZS5TdWNjZXNzKSBvbmx5T3duZXIgc3RvcEluRW1lcmdlbmN5IHsKICAgIGZpbmFsaXplZCA9IHRydWU7CiAgICBGaW5hbGl6ZWQoKTsKICB9CgogIC8qKgogICAqIFNldCBwb2xpY3kgZG8gd2UgbmVlZCB0byBoYXZlIHNlcnZlci1zaWRlIGN1c3RvbWVyIGlkcyBmb3IgdGhlIGludmVzdG1lbnRzLgogICAqCiAgICovCiAgZnVuY3Rpb24gc2V0UmVxdWlyZUN1c3RvbWVySWQoYm9vbCB2YWx1ZSkgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlQ3VzdG9tZXJJZCA9IHZhbHVlOwogICAgSW52ZXN0bWVudFBvbGljeUNoYW5nZWQocmVxdWlyZUN1c3RvbWVySWQsIHJlcXVpcmVkU2lnbmVkQWRkcmVzcywgc2lnbmVyQWRkcmVzcyk7CiAgfQoKICAvKioKICAgKiBTZXQgcG9saWN5IGlmIGFsbCBpbnZlc3RvcnMgbXVzdCBiZSBjbGVhcmVkIG9uIHRoZSBzZXJ2ZXIgc2lkZSBmaXJzdC4KICAgKgogICAqIFRoaXMgaXMgZS5nLiBmb3IgdGhlIGFjY3JlZGl0ZWQgaW52ZXN0b3IgY2xlYXJpbmcuCiAgICoKICAgKi8KICBmdW5jdGlvbiBzZXRSZXF1aXJlU2lnbmVkQWRkcmVzcyhib29sIHZhbHVlLCBhZGRyZXNzIHNpZ25lcikgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlZFNpZ25lZEFkZHJlc3MgPSB2YWx1ZTsKICAgIHNpZ25lckFkZHJlc3MgPSBzaWduZXI7CiAgICBJbnZlc3RtZW50UG9saWN5Q2hhbmdlZChyZXF1aXJlQ3VzdG9tZXJJZCwgcmVxdWlyZWRTaWduZWRBZGRyZXNzLCBzaWduZXJBZGRyZXNzKTsKICB9CgogIC8qKgogICAqIEFsbG93IGFkZHJlc3NlcyB0byBkbyBlYXJseSBwYXJ0aWNpcGF0aW9uLgogICAqLwogIGZ1bmN0aW9uIHNldEVhcmx5UGFydGljaXBhbnRXaGl0ZWxpc3QoYWRkcmVzcyBhZGRyLCBib29sIHN0YXR1cykgcHVibGljIG9ubHlPd25lciBub3RGaW5pc2hlZCBzdG9wSW5FbWVyZ2VuY3kgewogICAgZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdFthZGRyXSA9IHN0YXR1czsKICAgIFdoaXRlbGlzdGVkKGFkZHIsIHN0YXR1cyk7CiAgfQoKICAvKioKICAgKiBJbnRlcm5hbCBzZXR0ZXIgZm9yIHRoZSBtdWx0aXNpZyB3YWxsZXQKICAgKi8KICBmdW5jdGlvbiBzZXRNdWx0aXNpZyhhZGRyZXNzIGFkZHIpIGludGVybmFsIHsKICAgIHJlcXVpcmUoYWRkciAhPSAwKTsKICAgIG11bHRpc2lnV2FsbGV0ID0gYWRkcjsKICB9CgogIC8qKgogICAqIENyb3dkZnVuZCBzdGF0ZSBtYWNoaW5lIG1hbmFnZW1lbnQuCiAgICoKICAgKiBUaGlzIGZ1bmN0aW9uIGhhcyB0aGUgdGltZWQgdHJhbnNpdGlvbiBidWlsdGluLgogICAqIFNvIHRoZXJlIGlzIG5vIGNoYW5jZSBvZiB0aGUgdmFyaWFibGUgYmVpbmcgc3RhbGUuCiAgICovCiAgZnVuY3Rpb24gZ2V0U3RhdGUoKSBwdWJsaWMgdmlldyByZXR1cm5zIChTdGF0ZSkgewogICAgaWYgKGZpbmFsaXplZCkgcmV0dXJuIFN0YXRlLkZpbmFsaXplZDsKICAgIGVsc2UgaWYgKCFjb25maWd1cmVkKSByZXR1cm4gU3RhdGUuUGVuZGluZ0NvbmZpZ3VyYXRpb247CiAgICBlbHNlIGlmIChub3cgPCBzdGFydHNBdCkgcmV0dXJuIFN0YXRlLlByZUZ1bmRpbmc7CiAgICBlbHNlIGlmIChub3cgPD0gZW5kc0F0ICYmICFpc0Nyb3dkc2FsZUZ1bGwoKSkgcmV0dXJuIFN0YXRlLkZ1bmRpbmc7CiAgICBlbHNlIHJldHVybiBTdGF0ZS5TdWNjZXNzOwogIH0KCiAgLyoqIEludGVybmFsIGZ1bmN0aW9ucyB0aGF0IGV4aXN0IHRvIHByb3ZpZGUgaW52ZXJzaW9uIG9mIGNvbnRyb2wgc2hvdWxkIHRoZXkgYmUgb3ZlcnJpZGVuICovCgogIC8qKiBJbnRlcmZhY2UgZm9yIHRoZSBjb25jcmV0ZSBpbnN0YW5jZSB0byBpbnRlcmFjdCB3aXRoIHRoZSB0b2tlbiBjb250cmFjdCBpbiBhIGN1c3RvbWl6YWJsZSB3YXkgKi8KICBmdW5jdGlvbiBhc3NpZ25Ub2tlbnMoYWRkcmVzcyByZWNlaXZlciwgdWludCB0b2tlbkFtb3VudCkgaW50ZXJuYWw7CgogIC8qKgogICAqICBEZXRlcm1pbmUgaWYgdGhlIGdvYWwgd2FzIGFscmVhZHkgcmVhY2hlZCBpbiB0aGUgY3VycmVudCBjcm93ZHNhbGUKICAgKi8KICBmdW5jdGlvbiBpc0Nyb3dkc2FsZUZ1bGwoKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wgZnVsbCk7CgogIC8qKgogICAqIFJldHVybnMgYW55IGV4Y2VzcyB3ZWkgcmVjZWl2ZWQKICAgKiAKICAgKiBUaGlzIGZ1bmN0aW9uIGNhbiBiZSBvdmVycmlkZW4gdG8gcHJvdmlkZSBhIGRpZmZlcmVudCByZWZ1bmRpbmcgbWV0aG9kLgogICAqLwogIGZ1bmN0aW9uIHJldHVybkV4Y2VkZW50KHVpbnQgZXhjZWRlbnQsIGFkZHJlc3MgcmVjZWl2ZXIpIGludGVybmFsIHsKICAgIGlmIChleGNlZGVudCA+IDApIHsKICAgICAgcmVjZWl2ZXIudHJhbnNmZXIoZXhjZWRlbnQpOwogICAgfQogIH0KCiAgLyoqIAogICAqICBDYWxjdWxhdGUgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBjb3JyZXNwb25kcyB0byB0aGUgcmVjZWl2ZWQgYW1vdW50LgogICAqICBUaGUgd2VpIGFtb3VudCBpcyByZXR1cm5lZCB0b28gaW4gY2FzZSBub3QgYWxsIG9mIGl0IGNhbiBiZSBpbnZlc3RlZC4KICAgKgogICAqICBOb3RlOiBXaGVuIHRoZXJlJ3MgYW4gZXhjZWRlbnQgZHVlIHRvIHJvdW5kaW5nIGVycm9yLCBpdCBzaG91bGQgYmUgcmV0dXJuZWQgdG8gYWxsb3cgcmVmdW5kaW5nLgogICAqICBUaGlzIGlzIHdvcmtlZCBhcm91bmQgaW4gdGhlIGN1cnJlbnQgZGVzaWduIHVzaW5nIGFuIGFwcHJvcHJpYXRlIGFtb3VudCBvZiBkZWNpbWFscyBpbiB0aGUgRnJhY3Rpb25hbEVSQzIwIHN0YW5kYXJkLgogICAqICBUaGUgd29ya2Fyb3VuZCBpcyBnb29kIGVub3VnaCBmb3IgbW9zdCB1c2UgY2FzZXMsIGhlbmNlIHRoZSBzaW1wbGlmaWVkIGZ1bmN0aW9uIHNpZ25hdHVyZS4KICAgKiAgQHJldHVybiB3ZWlBbGxvd2VkIFRoZSBhbW91bnQgb2Ygd2VpIGFjY2VwdGVkIGluIHRoaXMgdHJhbnNhY3Rpb24uCiAgICogIEByZXR1cm4gdG9rZW5BbW91bnQgVGhlIHRva2VucyB0aGF0IGFyZSBhc3NpZ25lZCB0byB0aGUgcmVjZWl2ZXIgaW4gdGhpcyB0cmFuc2FjdGlvbi4KICAgKi8KICBmdW5jdGlvbiBjYWxjdWxhdGVUb2tlbkFtb3VudCh1aW50IHdlaUFtb3VudCwgYWRkcmVzcyByZWNlaXZlcikgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50IHdlaUFsbG93ZWQsIHVpbnQgdG9rZW5BbW91bnQpOwoKICAvLwogIC8vIE1vZGlmaWVycwogIC8vCgogIG1vZGlmaWVyIGluU3RhdGUoU3RhdGUgc3RhdGUpIHsKICAgIHJlcXVpcmUoZ2V0U3RhdGUoKSA9PSBzdGF0ZSk7CiAgICBfOwogIH0KCiAgbW9kaWZpZXIgdW5zaWduZWRCdXlBbGxvd2VkKCkgewogICAgcmVxdWlyZSghcmVxdWlyZWRTaWduZWRBZGRyZXNzKTsKICAgIF87CiAgfQoKICAvKiogTW9kaWZpZXIgYWxsb3dpbmcgZXhlY3V0aW9uIG9ubHkgaWYgdGhlIGNyb3dkc2FsZSBpcyBjdXJyZW50bHkgcnVubmluZy4gICovCiAgbW9kaWZpZXIgbm90RmluaXNoZWQoKSB7CiAgICBTdGF0ZSBjdXJyZW50X3N0YXRlID0gZ2V0U3RhdGUoKTsKICAgIHJlcXVpcmUoY3VycmVudF9zdGF0ZSA9PSBTdGF0ZS5QcmVGdW5kaW5nIHx8IGN1cnJlbnRfc3RhdGUgPT0gU3RhdGUuRnVuZGluZyk7CiAgICBfOwogIH0KCiAgbW9kaWZpZXIgdmFsaWRDdXN0b21lcklkKHVpbnQxMjggY3VzdG9tZXJJZCkgewogICAgcmVxdWlyZShjdXN0b21lcklkICE9IDApOyAgLy8gVVVJRHY0IHNhbml0eSBjaGVjawogICAgXzsKICB9Cn0KcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovLyBTaW1wbGUgZGVwbG95bWVudCBpbmZvcm1hdGlvbiBzdG9yZSBpbnNpZGUgY29udHJhY3Qgc3RvcmFnZS4KY29udHJhY3QgRGVwbG95bWVudEluZm8gewogIHVpbnQgcHJpdmF0ZSBkZXBsb3llZF9vbjsKCiAgZnVuY3Rpb24gRGVwbG95bWVudEluZm8oKSBwdWJsaWMgewogICAgZGVwbG95ZWRfb24gPSBibG9jay5udW1iZXI7CiAgfQoKCiAgZnVuY3Rpb24gZ2V0RGVwbG95bWVudEJsb2NrKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIGRlcGxveWVkX29uOwogIH0KfQoKLyoqCiAqIFRoaXMgc21hcnQgY29udHJhY3QgY29kZSBpcyBDb3B5cmlnaHQgMjAxNyBUb2tlbk1hcmtldCBMdGQuIEZvciBtb3JlIGluZm9ybWF0aW9uIHNlZSBodHRwczovL3Rva2VubWFya2V0Lm5ldAogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIHZlcnNpb24gMi4wOiBodHRwczovL2dpdGh1Yi5jb20vVG9rZW5NYXJrZXROZXQvaWNvL2Jsb2IvbWFzdGVyL0xJQ0VOU0UudHh0CiAqCiAqIEhlYXZpbHkgbW9kaWZpZWQgYnkgaHR0cHM6Ly93d3cuY29pbmZhYnJpay5jb20vCiAqLwoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgoKLy8vIEBkZXYgVHJhbmNoZSBiYXNlZCBwcmljaW5nLgovLy8gICAgICBJbXBsZW1lbnRpbmcgImZpcnN0IHByaWNlIiB0cmFuY2hlcywgbWVhbmluZywgdGhhdCBpZiBhIGJ1eWVyJ3Mgb3JkZXIgaXMKLy8vICAgICAgY292ZXJpbmcgbW9yZSB0aGFuIG9uZSB0cmFuY2hlLCB0aGUgcHJpY2Ugb2YgdGhlIGxvd2VzdCB0cmFuY2hlIHdpbGwgYXBwbHkKLy8vICAgICAgdG8gdGhlIHdob2xlIG9yZGVyLgpjb250cmFjdCBUb2tlblRyYW5jaGVQcmljaW5nIHsKCiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7CgogIC8qKgogICAqIERlZmluZSBwcmljaW5nIHNjaGVkdWxlIHVzaW5nIHRyYW5jaGVzLgogICAqLwogIHN0cnVjdCBUcmFuY2hlIHsKICAgICAgLy8gQW1vdW50IGluIHRva2VucyB3aGVuIHRoaXMgdHJhbmNoZSBiZWNvbWVzIGluYWN0aXZlCiAgICAgIHVpbnQgYW1vdW50OwogICAgICAvLyBUaW1lc3RhbXAgaW50ZXJ2YWwgW3N0YXJ0LCBlbmQpCiAgICAgIC8vIFN0YXJ0aW5nIHRpbWVzdGFtcCAoaW5jbHVkZWQgaW4gdGhlIGludGVydmFsKQogICAgICB1aW50IHN0YXJ0OwogICAgICAvLyBFbmRpbmcgdGltZXN0YW1wIChleGNsdWRlZCBmcm9tIHRoZSBpbnRlcnZhbCkKICAgICAgdWludCBlbmQ7CiAgICAgIC8vIEhvdyBtYW55IHRva2VucyBwZXIgd2VpIHlvdSB3aWxsIGdldCB3aGlsZSB0aGlzIHRyYW5jaGUgaXMgYWN0aXZlCiAgICAgIHVpbnQgcHJpY2U7CiAgfQogIC8vIFdlIGRlZmluZSBvZmZzZXRzIGFuZCBzaXplIGZvciB0aGUgZGVzZXJpYWxpemF0aW9uIG9mIG9yZGVyZWQgdHVwbGVzIGluIHJhdyBhcnJheXMKICB1aW50IHByaXZhdGUgY29uc3RhbnQgYW1vdW50X29mZnNldCA9IDA7CiAgdWludCBwcml2YXRlIGNvbnN0YW50IHN0YXJ0X29mZnNldCA9IDE7CiAgdWludCBwcml2YXRlIGNvbnN0YW50IGVuZF9vZmZzZXQgPSAyOwogIHVpbnQgcHJpdmF0ZSBjb25zdGFudCBwcmljZV9vZmZzZXQgPSAzOwogIHVpbnQgcHJpdmF0ZSBjb25zdGFudCB0cmFuY2hlX3NpemUgPSA0OwoKICBUcmFuY2hlW10gcHVibGljIHRyYW5jaGVzOwoKICBmdW5jdGlvbiBnZXRUcmFuY2hlc0xlbmd0aCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiB0cmFuY2hlcy5sZW5ndGg7CiAgfQogIAogIC8vIFRoZSBjb25maWd1cmF0aW9uIGZyb20gdGhlIGNvbnN0cnVjdG9yIHdhcyBtb3ZlZCB0byB0aGUgY29uZmlndXJhdGlvblRva2VuVHJhbmNoZVByaWNpbmcgZnVuY3Rpb24uCiAgLy8KICAvLy8gQGRldiBDb25zdHJ1Y3Rpb24sIGNyZWF0aW5nIGEgbGlzdCBvZiB0cmFuY2hlcwogIC8qIEBwYXJhbSBpbml0X3RyYW5jaGVzIFJhdyBhcnJheSBvZiBvcmRlcmVkIHR1cGxlczogKHN0YXJ0IGFtb3VudCwgc3RhcnQgdGltZXN0YW1wLCBlbmQgdGltZXN0YW1wLCBwcmljZSkgKi8KICAvLwogIGZ1bmN0aW9uIGNvbmZpZ3VyYXRpb25Ub2tlblRyYW5jaGVQcmljaW5nKHVpbnRbXSBpbml0X3RyYW5jaGVzKSBpbnRlcm5hbCB7CiAgICAvLyBOZWVkIHRvIGhhdmUgdHVwbGVzLCBsZW5ndGggY2hlY2sKICAgIHJlcXVpcmUoaW5pdF90cmFuY2hlcy5sZW5ndGggJSB0cmFuY2hlX3NpemUgPT0gMCk7CiAgICAvLyBBIHRyYW5jaGUgd2l0aCBhbW91bnQgemVybyBjYW4gbmV2ZXIgYmUgc2VsZWN0ZWQgYW5kIGlzIHRoZXJlZm9yZSB1c2VsZXNzLgogICAgLy8gVGhpcyBjaGVjayBhbmQgdGhlIG9uZSBpbnNpZGUgdGhlIGxvb3AgZW5zdXJlIG5vIHRyYW5jaGUgY2FuIGhhdmUgYW4gYW1vdW50IGVxdWFsIHRvIHplcm8uCiAgICByZXF1aXJlKGluaXRfdHJhbmNoZXNbYW1vdW50X29mZnNldF0gPiAwKTsKCiAgICB1aW50IGlucHV0X3RyYW5jaGVzX2xlbmd0aCA9IGluaXRfdHJhbmNoZXMubGVuZ3RoLmRpdih0cmFuY2hlX3NpemUpOwogICAgVHJhbmNoZSBtZW1vcnkgbGFzdF90cmFuY2hlOwogICAgZm9yICh1aW50IGkgPSAwOyBpIDwgaW5wdXRfdHJhbmNoZXNfbGVuZ3RoOyBpKyspIHsKICAgICAgdWludCB0cmFuY2hlX29mZnNldCA9IGkubXVsKHRyYW5jaGVfc2l6ZSk7CiAgICAgIHVpbnQgYW1vdW50ID0gaW5pdF90cmFuY2hlc1t0cmFuY2hlX29mZnNldC5hZGQoYW1vdW50X29mZnNldCldOwogICAgICB1aW50IHN0YXJ0ID0gaW5pdF90cmFuY2hlc1t0cmFuY2hlX29mZnNldC5hZGQoc3RhcnRfb2Zmc2V0KV07CiAgICAgIHVpbnQgZW5kID0gaW5pdF90cmFuY2hlc1t0cmFuY2hlX29mZnNldC5hZGQoZW5kX29mZnNldCldOwogICAgICB1aW50IHByaWNlID0gaW5pdF90cmFuY2hlc1t0cmFuY2hlX29mZnNldC5hZGQocHJpY2Vfb2Zmc2V0KV07CiAgICAgIC8vIE5vIGludmFsaWQgc3RlcHMKICAgICAgcmVxdWlyZShzdGFydCA8IGVuZCAmJiBub3cgPCBlbmQpOwogICAgICAvLyBCYWlsIG91dCB3aGVuIGVudGVyaW5nIHVubmVjZXNzYXJ5IHRyYW5jaGVzCiAgICAgIC8vIFRoaXMgaXMgcHJlZmVyYWJseSBjaGVja2VkIGJlZm9yZSBkZXBsb3lpbmcgY29udHJhY3QgaW50byBhbnkgYmxvY2tjaGFpbi4KICAgICAgcmVxdWlyZShpID09IDAgfHwgKGVuZCA+PSBsYXN0X3RyYW5jaGUuZW5kICYmIGFtb3VudCA+IGxhc3RfdHJhbmNoZS5hbW91bnQpIHx8CiAgICAgICAgICAgICAgKGVuZCA+IGxhc3RfdHJhbmNoZS5lbmQgJiYgYW1vdW50ID49IGxhc3RfdHJhbmNoZS5hbW91bnQpKTsKCiAgICAgIGxhc3RfdHJhbmNoZSA9IFRyYW5jaGUoYW1vdW50LCBzdGFydCwgZW5kLCBwcmljZSk7CiAgICAgIHRyYW5jaGVzLnB1c2gobGFzdF90cmFuY2hlKTsKICAgIH0KICB9CgogIC8vLyBAZGV2IEdldCB0aGUgY3VycmVudCB0cmFuY2hlIG9yIGJhaWwgb3V0IGlmIHRoZXJlIGlzIG5vIHRyYW5jaGUgZGVmaW5lZCBmb3IgdGhlIGN1cnJlbnQgdGltZXN0YW1wLgogIC8vLyBAcGFyYW0gdG9rZW5zU29sZCB0b3RhbCBhbW91bnQgb2YgdG9rZW5zIHNvbGQsIGZvciBjYWxjdWxhdGluZyB0aGUgY3VycmVudCB0cmFuY2hlCiAgLy8vIEByZXR1cm4gUmV0dXJucyB0aGUgc3RydWN0IHJlcHJlc2VudGluZyB0aGUgY3VycmVudCB0cmFuY2hlCiAgZnVuY3Rpb24gZ2V0Q3VycmVudFRyYW5jaGUodWludCB0b2tlbnNTb2xkKSBwcml2YXRlIHZpZXcgcmV0dXJucyAoVHJhbmNoZSBzdG9yYWdlKSB7CiAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCB0cmFuY2hlcy5sZW5ndGg7IGkrKykgewogICAgICBpZiAodHJhbmNoZXNbaV0uc3RhcnQgPD0gbm93ICYmIG5vdyA8IHRyYW5jaGVzW2ldLmVuZCAmJiB0b2tlbnNTb2xkIDwgdHJhbmNoZXNbaV0uYW1vdW50KSB7CiAgICAgICAgcmV0dXJuIHRyYW5jaGVzW2ldOwogICAgICB9CiAgICB9CiAgICAvLyBObyB0cmFuY2hlIGlzIGN1cnJlbnRseSBhY3RpdmUKICAgIHJldmVydCgpOwogIH0KCiAgLy8vIEBkZXYgR2V0IHRoZSBjdXJyZW50IHByaWNlLiBNYXkgcmV2ZXJ0IGlmIHRoZXJlIGlzIG5vIHRyYW5jaGUgY3VycmVudGx5IGFjdGl2ZS4KICAvLy8gQHBhcmFtIHRva2Vuc1NvbGQgdG90YWwgYW1vdW50IG9mIHRva2VucyBzb2xkLCBmb3IgY2FsY3VsYXRpbmcgdGhlIGN1cnJlbnQgdHJhbmNoZQogIC8vLyBAcmV0dXJuIFRoZSBjdXJyZW50IHByaWNlCiAgZnVuY3Rpb24gZ2V0Q3VycmVudFByaWNlKHVpbnQgdG9rZW5zU29sZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50IHJlc3VsdCkgewogICAgcmV0dXJuIGdldEN1cnJlbnRUcmFuY2hlKHRva2Vuc1NvbGQpLnByaWNlOwogIH0KCn0KCi8vIFRoaXMgY29udHJhY3QgaGFzIHRoZSBzb2xlIG9iamVjdGl2ZSBvZiBwcm92aWRpbmcgYSBzYW5lIGNvbmNyZXRlIGluc3RhbmNlIG9mIHRoZSBDcm93ZHNhbGUgY29udHJhY3QuCmNvbnRyYWN0IENyb3dkc2FsZSBpcyBHZW5lcmljQ3Jvd2RzYWxlLCBMb3N0QW5kRm91bmRUb2tlbiwgRGVwbG95bWVudEluZm8sIFRva2VuVHJhbmNoZVByaWNpbmcgewogIHVpbnQgcHVibGljIHNlbGxhYmxlX3Rva2VuczsKICB1aW50IHB1YmxpYyBpbml0aWFsX3Rva2VuczsKICB1aW50IHB1YmxpYyBtaWxpZXVyc19wZXJfZXRoOwogIC8vIE1pbmltdW0gYW1vdW50cyBvZiB0b2tlbnMgdGhhdCBtdXN0IGJlIGJvdWdodCBieSBhbiBpbnZlc3RvcgogIHVpbnQgcHVibGljIG1pbmltdW1fYnV5X3ZhbHVlOwogIGFkZHJlc3MgcHVibGljIHByaWNlX2FnZW50OyAKCiAgLyoKICAgKiBUaGUgY29uc3RydWN0b3IgZm9yIHRoZSBjcm93ZHNhbGUgd2FzIHJlbW92ZWQgZ2l2ZW4gaXQgZGlkbid0IHJlY2VpdmUgYW55IGFyZ3VtZW50cyBub3IgaGFkIGFueSBib2R5LgogICAqCiAgICogVGhlIGNvbmZpZ3VyYXRpb24gZnJvbSB0aGUgY29uc3RydWN0b3Igd2FzIG1vdmVkIHRvIHRoZSBjb25maWd1cmF0aW9uQ3Jvd2RzYWxlIGZ1bmN0aW9uIHdoaWNoIGNyZWF0ZXMgdGhlIHRva2VuIGNvbnRyYWN0IGFuZCBhbHNvIGNhbGxzIHRoZSBjb25maWd1cmF0aW9uIGZ1bmN0aW9ucyBmcm9tIEdlbmVyaWNDcm93ZHNhbGUgYW5kIFRva2VuVHJhbmNoZVByaWNpbmcuCiAgICogCiAgICoKICAgKiBAcGFyYW0gdGVhbV9tdWx0aXNpZyBBZGRyZXNzIG9mIHRoZSBtdWx0aXNpZ25hdHVyZSB3YWxsZXQgb2YgdGhlIHRlYW0gdGhhdCB3aWxsIHJlY2VpdmUgYWxsIHRoZSBmdW5kcyBjb250cmlidXRlZCBpbiB0aGUgY3Jvd2RzYWxlLgogICAqIEBwYXJhbSBzdGFydCBUaW1lc3RhbXAgd2hlcmUgdGhlIGNyb3dkc2FsZSB3aWxsIGJlIG9mZmljaWFsbHkgc3RhcnRlZC4gSXQgc2hvdWxkIGJlIGdyZWF0ZXIgdGhhbiB0aGUgdGltZXN0YW1wIGluIHdoaWNoIHRoZSBjb250cmFjdCBpcyBkZXBsb3llZC4KICAgKiBAcGFyYW0gZW5kIFRpbWVzdGFtcCB3aGVyZSB0aGUgY3Jvd2RzYWxlIGZpbmlzaGVzLiBObyB0b2tlbnMgY2FuIGJlIHNvbGQgdGhyb3VnaCB0aGlzIGNvbnRyYWN0IGFmdGVyIHRoaXMgdGltZXN0YW1wLgogICAqIEBwYXJhbSB0b2tlbl9yZXRyaWV2ZXIgQWRkcmVzcyB0aGF0IHdpbGwgaGFuZGxlIHRva2VucyBhY2NpZGVudGFsbHkgc2VudCB0byB0aGUgdG9rZW4gY29udHJhY3QuIFNlZSB0aGUgTG9zdEFuZEZvdW5kVG9rZW4gYW5kIENyb3dkc2FsZVRva2VuIGNvbnRyYWN0cyBmb3IgZnVydGhlciBkZXRhaWxzLgogICAqLwoKICBmdW5jdGlvbiBjb25maWd1cmF0aW9uQ3Jvd2RzYWxlKGFkZHJlc3MgdGVhbV9tdWx0aXNpZywgdWludCBzdGFydCwgdWludCBlbmQsCiAgYWRkcmVzcyB0b2tlbl9yZXRyaWV2ZXIsIHVpbnRbXSBpbml0X3RyYW5jaGVzLCB1aW50IG11bHRpc2lnX3N1cHBseSwgdWludCBjcm93ZHNhbGVfc3VwcGx5LAogIHVpbnQ4IHRva2VuX2RlY2ltYWxzLCB1aW50IG1heF90b2tlbnNfdG9fc2VsbCkgcHVibGljIG9ubHlPd25lciB7CgogICAgaW5pdGlhbF90b2tlbnMgPSBtdWx0aXNpZ19zdXBwbHk7CiAgICBtaW5pbXVtX2J1eV92YWx1ZSA9IHVpbnQoMTAwKS5tdWwoMTAgKiogdWludCh0b2tlbl9kZWNpbWFscykpOwogICAgdG9rZW4gPSBuZXcgQ3Jvd2RzYWxlVG9rZW4obXVsdGlzaWdfc3VwcGx5LCB0b2tlbl9kZWNpbWFscywgdGVhbV9tdWx0aXNpZywgdG9rZW5fcmV0cmlldmVyKTsKICAgIC8vIE5lY2Vzc2FyeSBpZiBhc3NpZ25Ub2tlbnMgbWludHMKICAgIHRva2VuLnNldE1pbnRBZ2VudChhZGRyZXNzKHRoaXMpLCB0cnVlKTsKICAgIC8vIE5lY2Vzc2FyeSBpZiBmaW5hbGl6ZSBpcyBvdmVycmlkZW4gdG8gcmVsZWFzZSB0aGUgdG9rZW5zIGZvciBwdWJsaWMgdHJhZGluZy4KICAgIHRva2VuLnNldFJlbGVhc2VBZ2VudChhZGRyZXNzKHRoaXMpKTsKICAgIC8vIE5lY2Vzc2FyeSBmb3IgdGhlIGV4ZWN1dGlvbiBvZiBidXkgZnVuY3Rpb24gYW5kIG9mIHRoZSBzdWJzZXF1ZW50IENyb3dkc2FsZVRva2VuJ3MgdHJhbnNmZXIgZnVuY3Rpb24uIAogICAgdG9rZW4uc2V0VHJhbnNmZXJBZ2VudChhZGRyZXNzKHRoaXMpLCB0cnVlKTsKICAgIC8vIE5lY2Vzc2FyeSBmb3IgdGhlIGRlbGl2ZXJ5IG9mIGJvdW50aWVzIAogICAgdG9rZW4uc2V0VHJhbnNmZXJBZ2VudCh0ZWFtX211bHRpc2lnLCB0cnVlKTsKICAgIC8vIENyb3dkc2FsZSBtaW50cyB0byBoaW1zZWxmIHRoZSBpbml0aWFsIHN1cHBseQogICAgdG9rZW4ubWludChhZGRyZXNzKHRoaXMpLCBjcm93ZHNhbGVfc3VwcGx5KTsKICAgIC8vIE5lY2Vzc2FyeSBpZiBhc3NpZ25Ub2tlbnMgbWludHMKICAgIHRva2VuLnNldE1pbnRBZ2VudChhZGRyZXNzKHRoaXMpLCBmYWxzZSk7CgogICAgc2VsbGFibGVfdG9rZW5zID0gbWF4X3Rva2Vuc190b19zZWxsOwoKICAgIC8vIENvbmZpZ3VyYXRpb24gZnVuY3Rpb25hbGl0eSBmb3IgR2VuZXJpY0Nyb3dkc2FsZS4KICAgIGNvbmZpZ3VyYXRpb25HZW5lcmljQ3Jvd2RzYWxlKHRlYW1fbXVsdGlzaWcsIHN0YXJ0LCBlbmQpOwoKICAgIC8vIENvbmZpZ3VyYXRpb24gZnVuY3Rpb25hbGl0eSBmb3IgVG9rZW5UcmFuY2hlUHJpY2luZy4KICAgIGNvbmZpZ3VyYXRpb25Ub2tlblRyYW5jaGVQcmljaW5nKGluaXRfdHJhbmNoZXMpOwogIH0KCiAgLy90b2tlbiBhc3NpZ25hdGlvbgogIGZ1bmN0aW9uIGFzc2lnblRva2VucyhhZGRyZXNzIHJlY2VpdmVyLCB1aW50IHRva2VuQW1vdW50KSBpbnRlcm5hbCB7CiAgICB0b2tlbi50cmFuc2ZlcihyZWNlaXZlciwgdG9rZW5BbW91bnQpOwogIH0KCiAgLy90b2tlbiBhbW91bnQgY2FsY3VsYXRpb24KICBmdW5jdGlvbiBjYWxjdWxhdGVUb2tlbkFtb3VudCh1aW50IHdlaUFtb3VudCwgYWRkcmVzcyByZWNlaXZlcikgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50IHdlaUFsbG93ZWQsIHVpbnQgdG9rZW5BbW91bnQpIHsKICAgIC8vRGl2aWRlZCBieSAxMDAwIGJlY2F1c2UgZXRoIGV0aF9wcmljZV9pbl9ldXJzIGlzIG11bHRpcGxpZWQgYnkgMTAwMAogICAgdWludCB0b2tlbnNQZXJFdGggPSBnZXRDdXJyZW50UHJpY2UodG9rZW5zU29sZCkubXVsKG1pbGlldXJzX3Blcl9ldGgpLmRpdigxMDAwKTsKICAgIHVpbnQgbWF4V2VpQWxsb3dlZCA9IHNlbGxhYmxlX3Rva2Vucy5zdWIodG9rZW5zU29sZCkubXVsKDEgZXRoZXIpLmRpdih0b2tlbnNQZXJFdGgpOwogICAgd2VpQWxsb3dlZCA9IG1heFdlaUFsbG93ZWQubWluMjU2KHdlaUFtb3VudCk7CgogICAgaWYgKHdlaUFtb3VudCA8IG1heFdlaUFsbG93ZWQpIHsKICAgICAgdG9rZW5BbW91bnQgPSB0b2tlbnNQZXJFdGgubXVsKHdlaUFtb3VudCkuZGl2KDEgZXRoZXIpOwogICAgfQogICAgLy8gV2l0aCB0aGlzIGNhc2Ugd2UgbGV0IHRoZSBjcm93ZHNhbGUgZW5kIGV2ZW4gd2hlbiB0aGVyZSBhcmUgcm91bmRpbmcgZXJyb3JzIGR1ZSB0byB0aGUgdG9rZW5zIHRvIHdlaSByYXRpbwogICAgZWxzZSB7CiAgICAgIHRva2VuQW1vdW50ID0gc2VsbGFibGVfdG9rZW5zLnN1Yih0b2tlbnNTb2xkKTsKICAgIH0KCiAgICAvLyBSZXF1aXJlIGEgbWluaW11bSBjb250cmlidXRpb24gb2YgMTAwIGZ1bGx0b2tlbnMKICAgIHJlcXVpcmUodG9rZW4uYmFsYW5jZU9mKHJlY2VpdmVyKS5hZGQodG9rZW5BbW91bnQpID49IG1pbmltdW1fYnV5X3ZhbHVlKTsKICB9CgogIC8vIEltcGxlbWVudHMgZnVuZGluZyBzdGF0ZSBjcml0ZXJpb24KICBmdW5jdGlvbiBpc0Nyb3dkc2FsZUZ1bGwoKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wgZnVsbCkgewogICAgcmV0dXJuIHRva2Vuc1NvbGQgPj0gc2VsbGFibGVfdG9rZW5zOwogIH0KCiAgLyoqCiAgICogRmluYWxpemUgYSBzdWNjZXNzZnVsIGNyb3dkc2FsZS4KICAgKgogICAqIFRoZSBvd25lciBjYW4gdHJpZ2dlciBwb3N0LWNyb3dkc2FsZSBhY3Rpb25zLCBsaWtlIHJlbGVhc2luZyB0aGUgdG9rZW5zLgogICAqIE5vdGUgdGhhdCBieSBkZWZhdWx0IHRva2VucyBhcmUgbm90IGluIGEgcmVsZWFzZWQgc3RhdGUuCiAgICovCiAgZnVuY3Rpb24gZmluYWxpemUoKSBwdWJsaWMgaW5TdGF0ZShTdGF0ZS5TdWNjZXNzKSBvbmx5T3duZXIgc3RvcEluRW1lcmdlbmN5IHsKICAgIC8vVG9rZW5zIHNvbGQgKyBib3VudGllcyByZXByZXNlbnQgODIlIG9mIHRoZSB0b3RhbCwgdGhlIG90aGVyIDE4JSBnb2VzIHRvIHRoZSBtdWx0aXNpZywgcGFydG5lcnMgYW5kIG1hcmtldCBtYWtpbmcKICAgIHVpbnQgc29sZCA9IHRva2Vuc1NvbGQuYWRkKGluaXRpYWxfdG9rZW5zKTsKICAgIHVpbnQgdG9TaGFyZSA9IHNvbGQubXVsKDE4KS5kaXYoODIpOwoKICAgIC8vIE1pbnQgdGhlIDE4JSB0byB0aGUgbXVsdGlzaWcKICAgIHRva2VuLnNldE1pbnRBZ2VudChhZGRyZXNzKHRoaXMpLCB0cnVlKTsKICAgIHRva2VuLm1pbnQobXVsdGlzaWdXYWxsZXQsIHRvU2hhcmUpOwogICAgdG9rZW4uc2V0TWludEFnZW50KGFkZHJlc3ModGhpcyksIGZhbHNlKTsKCiAgICAvLyBSZWxlYXNlIHRyYW5zZmVycyBhbmQgYnVybiB1bnNvbGQgdG9rZW5zLgogICAgdG9rZW4ucmVsZWFzZVRva2VuVHJhbnNmZXIoKTsKICAgIHRva2VuLmJ1cm4odG9rZW4uYmFsYW5jZU9mKGFkZHJlc3ModGhpcykpKTsKCiAgICBzdXBlci5maW5hbGl6ZSgpOwogIH0KCiAgLyoqCiAgICogVGhpcyBmdW5jdGlvbiBkZWNpZGVzIHdobyBoYW5kbGVzIGxvc3QgdG9rZW5zLgogICAqIERvIG5vdGUgdGhhdCB0aGlzIGZ1bmN0aW9uIGlzIE5PVCBtZWFudCB0byBiZSB1c2VkIGluIGEgdG9rZW4gcmVmdW5kIG1lY2FobmlzbS4KICAgKiBJdHMgc29sZSBwdXJwb3NlIGlzIGRldGVybWluaW5nIHdobyBjYW4gbW92ZSBhcm91bmQgRVJDMjAgdG9rZW5zIGFjY2lkZW50YWxseSBzZW50IHRvIHRoaXMgY29udHJhY3QuCiAgICovCiAgZnVuY3Rpb24gZ2V0TG9zdEFuZEZvdW5kTWFzdGVyKCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChhZGRyZXNzKSB7CiAgICByZXR1cm4gb3duZXI7CiAgfQoKICAvLyBUaGVzZSB0d28gc2V0dGVycyBhcmUgcHJlc2VudCBvbmx5IHRvIGNvcnJlY3QgdGltZXN0YW1wcyBpZiB0aGV5IGFyZSBvZmYgZnJvbSB0aGVpciB0YXJnZXQgZGF0ZSBieSBtb3JlIHRoYW4sIHNheSwgYSBkYXkKICBmdW5jdGlvbiBzZXRTdGFydGluZ1RpbWUodWludCBzdGFydGluZ1RpbWUpIHB1YmxpYyBvbmx5T3duZXIgaW5TdGF0ZShTdGF0ZS5QcmVGdW5kaW5nKSB7CiAgICByZXF1aXJlKG5vdyA8IHN0YXJ0aW5nVGltZSAmJiBzdGFydGluZ1RpbWUgPCBlbmRzQXQpOwogICAgc3RhcnRzQXQgPSBzdGFydGluZ1RpbWU7CiAgfQoKICBmdW5jdGlvbiBzZXRFbmRpbmdUaW1lKHVpbnQgZW5kaW5nVGltZSkgcHVibGljIG9ubHlPd25lciBub3RGaW5pc2hlZCB7CiAgICByZXF1aXJlKG5vdyA8IGVuZGluZ1RpbWUgJiYgc3RhcnRzQXQgPCBlbmRpbmdUaW1lKTsKICAgIGVuZHNBdCA9IGVuZGluZ1RpbWU7CiAgfQoKICBmdW5jdGlvbiB1cGRhdGVFdXJzUGVyRXRoICh1aW50IG1pbGlldXJzX2Ftb3VudCkgcHVibGljIG5vdEZpbmlzaGVkIHsKICAgIHJlcXVpcmUobWlsaWV1cnNfYW1vdW50ID49IDEwMCk7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gcHJpY2VfYWdlbnQpOwogICAgbWlsaWV1cnNfcGVyX2V0aCA9IG1pbGlldXJzX2Ftb3VudDsKICB9CgogIGZ1bmN0aW9uIHVwZGF0ZVByaWNlQWdlbnQoYWRkcmVzcyBuZXdfcHJpY2VfYWdlbnQpIHB1YmxpYyBvbmx5T3duZXIgbm90RmluaXNoZWQgewogICAgcHJpY2VfYWdlbnQgPSBuZXdfcHJpY2VfYWdlbnQ7CiAgfQoKICAvKioKICAgKiBAcGFyYW0gbmV3X21pbmltdW0gTmV3IG1pbmltdW0gYW1vdW50IG9mIGluZGl2aXNpYmxlIHRva2VucyB0byBiZSByZXF1aXJlZAogICAqLwogIGZ1bmN0aW9uIHNldE1pbmltdW1CdXlWYWx1ZSh1aW50IG5ld19taW5pbXVtKSBwdWJsaWMgb25seU93bmVyIG5vdEZpbmlzaGVkIHsKICAgIG1pbmltdW1fYnV5X3ZhbHVlID0gbmV3X21pbmltdW07CiAgfQp9'.
	

]
