Class {
	#name : #SRT40c9a1557b4eaf4a2ec2922858398ac8d59254b7,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT40c9a1557b4eaf4a2ec2922858398ac8d59254b7 >> base64 [
	^ 'LyoqCiAqIEB0aXRsZSBFUkMyMEJhc2ljCiAqIEBkZXYgU2ltcGxlciB2ZXJzaW9uIG9mIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTc5CiAqLwpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKfQoKLyoqCiAqIEB0aXRsZSBTYWZlTWF0aAogKiBAZGV2IE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MgdGhhdCB0aHJvdyBvbiBlcnJvcgogKi8KbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGlmIChhID09IDApIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKLyoqCiAqIEB0aXRsZSBCYXNpYyB0b2tlbgogKiBAZGV2IEJhc2ljIHZlcnNpb24gb2YgU3RhbmRhcmRUb2tlbiwgd2l0aCBubyBhbGxvd2FuY2VzLgogKi8KY29udHJhY3QgQmFzaWNUb2tlbiBpcyBFUkMyMEJhc2ljIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOwoKICAvKioKICAqIEBkZXYgdHJhbnNmZXIgdG9rZW4gZm9yIGEgc3BlY2lmaWVkIGFkZHJlc3MKICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8uCiAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJyZWQuCiAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGJhbGFuY2VzW21zZy5zZW5kZXJdKTsKCiAgICAvLyBTYWZlTWF0aC5zdWIgd2lsbCB0aHJvdyBpZiB0aGVyZSBpcyBub3QgZW5vdWdoIGJhbGFuY2UuCiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdG8gcXVlcnkgdGhlIHRoZSBiYWxhbmNlIG9mLgogICogQHJldHVybiBBbiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcy4KICAqLwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICB9Cgp9CgovKioKICogQHRpdGxlIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwp9CgovKioKICogQHRpdGxlIFN0YW5kYXJkIEVSQzIwIHRva2VuCiAqCiAqIEBkZXYgSW1wbGVtZW50YXRpb24gb2YgdGhlIGJhc2ljIHN0YW5kYXJkIHRva2VuLgogKiBAZGV2IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKiBAZGV2IEJhc2VkIG9uIGNvZGUgYnkgRmlyc3RCbG9vZDogaHR0cHM6Ly9naXRodWIuY29tL0ZpcnN0Ymxvb2Rpby90b2tlbi9ibG9iL21hc3Rlci9zbWFydF9jb250cmFjdC9GaXJzdEJsb29kVG9rZW4uc29sCiAqLwpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEVSQzIwLCBCYXNpY1Rva2VuIHsKCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBpbnRlcm5hbCBhbGxvd2VkOwoKCiAgLyoqCiAgICogQGRldiBUcmFuc2ZlciB0b2tlbnMgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyCiAgICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gc2VuZCB0b2tlbnMgZnJvbQogICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAqIEBwYXJhbSBfdmFsdWUgdWludDI1NiB0aGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGJhbGFuY2VzW19mcm9tXSk7CiAgICByZXF1aXJlKF92YWx1ZSA8PSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSk7CgogICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBBcHByb3ZlIHRoZSBwYXNzZWQgYWRkcmVzcyB0byBzcGVuZCB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiB0b2tlbnMgb24gYmVoYWxmIG9mIG1zZy5zZW5kZXIuCiAgICoKICAgKiBCZXdhcmUgdGhhdCBjaGFuZ2luZyBhbiBhbGxvd2FuY2Ugd2l0aCB0aGlzIG1ldGhvZCBicmluZ3MgdGhlIHJpc2sgdGhhdCBzb21lb25lIG1heSB1c2UgYm90aCB0aGUgb2xkCiAgICogYW5kIHRoZSBuZXcgYWxsb3dhbmNlIGJ5IHVuZm9ydHVuYXRlIHRyYW5zYWN0aW9uIG9yZGVyaW5nLiBPbmUgcG9zc2libGUgc29sdXRpb24gdG8gbWl0aWdhdGUgdGhpcwogICAqIHJhY2UgY29uZGl0aW9uIGlzIHRvIGZpcnN0IHJlZHVjZSB0aGUgc3BlbmRlcidzIGFsbG93YW5jZSB0byAwIGFuZCBzZXQgdGhlIGRlc2lyZWQgdmFsdWUgYWZ0ZXJ3YXJkczoKICAgKiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHNwZW50LgogICAqLwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIGNoZWNrIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgYW4gb3duZXIgYWxsb3dlZCB0byBhIHNwZW5kZXIuCiAgICogQHBhcmFtIF9vd25lciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIG93bnMgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfc3BlbmRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEByZXR1cm4gQSB1aW50MjU2IHNwZWNpZnlpbmcgdGhlIGFtb3VudCBvZiB0b2tlbnMgc3RpbGwgYXZhaWxhYmxlIGZvciB0aGUgc3BlbmRlci4KICAgKi8KICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogIH0KCiAgLyoqCiAgICogYXBwcm92ZSBzaG91bGQgYmUgY2FsbGVkIHdoZW4gYWxsb3dlZFtfc3BlbmRlcl0gPT0gMC4gVG8gaW5jcmVtZW50CiAgICogYWxsb3dlZCB2YWx1ZSBpcyBiZXR0ZXIgdG8gdXNlIHRoaXMgZnVuY3Rpb24gdG8gYXZvaWQgMiBjYWxscyAoYW5kIHdhaXQgdW50aWwKICAgKiB0aGUgZmlyc3QgdHJhbnNhY3Rpb24gaXMgbWluZWQpCiAgICogRnJvbSBNb25vbGl0aERBTyBUb2tlbi5zb2wKICAgKi8KICBmdW5jdGlvbiBpbmNyZWFzZUFwcHJvdmFsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2FkZGVkVmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdLmFkZChfYWRkZWRWYWx1ZSk7CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiBkZWNyZWFzZUFwcHJvdmFsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3N1YnRyYWN0ZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHVpbnQgb2xkVmFsdWUgPSBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXTsKICAgIGlmIChfc3VidHJhY3RlZFZhbHVlID4gb2xkVmFsdWUpIHsKICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSAwOwogICAgfSBlbHNlIHsKICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBvbGRWYWx1ZS5zdWIoX3N1YnRyYWN0ZWRWYWx1ZSk7CiAgICB9CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgcmV0dXJuIHRydWU7CiAgfQoKfQoKLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4KICovCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKCiAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIHByZXZpb3VzT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBuZXdPd25lcik7CgoKICAvKioKICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgKiBhY2NvdW50LgogICAqLwogIGZ1bmN0aW9uIE93bmFibGUoKSBwdWJsaWMgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCgogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgKi8KICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CgoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKLyoqCiAqIEB0aXRsZSBNaW50YWJsZSB0b2tlbgogKiBAZGV2IFNpbXBsZSBFUkMyMCBUb2tlbiBleGFtcGxlLCB3aXRoIG1pbnRhYmxlIHRva2VuIGNyZWF0aW9uCiAqIEBkZXYgSXNzdWU6ICogaHR0cHM6Ly9naXRodWIuY29tL09wZW5aZXBwZWxpbi96ZXBwZWxpbi1zb2xpZGl0eS9pc3N1ZXMvMTIwCiAqIEJhc2VkIG9uIGNvZGUgYnkgVG9rZW5NYXJrZXROZXQ6IGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28vYmxvYi9tYXN0ZXIvY29udHJhY3RzL01pbnRhYmxlVG9rZW4uc29sCiAqLwoKY29udHJhY3QgTWludGFibGVUb2tlbiBpcyBTdGFuZGFyZFRva2VuLCBPd25hYmxlIHsKICBldmVudCBNaW50KGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiBhbW91bnQpOwogIGV2ZW50IE1pbnRGaW5pc2hlZCgpOwoKICBib29sIHB1YmxpYyBtaW50aW5nRmluaXNoZWQgPSBmYWxzZTsKCgogIG1vZGlmaWVyIGNhbk1pbnQoKSB7CiAgICByZXF1aXJlKCFtaW50aW5nRmluaXNoZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gbWludCB0b2tlbnMKICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCByZWNlaXZlIHRoZSBtaW50ZWQgdG9rZW5zLgogICAqIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIG1pbnQuCiAgICogQHJldHVybiBBIGJvb2xlYW4gdGhhdCBpbmRpY2F0ZXMgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bC4KICAgKi8KICBmdW5jdGlvbiBtaW50KGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIG9ubHlPd25lciBjYW5NaW50IHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LmFkZChfYW1vdW50KTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfYW1vdW50KTsKICAgIE1pbnQoX3RvLCBfYW1vdW50KTsKICAgIFRyYW5zZmVyKGFkZHJlc3MoMCksIF90bywgX2Ftb3VudCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gc3RvcCBtaW50aW5nIG5ldyB0b2tlbnMuCiAgICogQHJldHVybiBUcnVlIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwuCiAgICovCiAgZnVuY3Rpb24gZmluaXNoTWludGluZygpIG9ubHlPd25lciBjYW5NaW50IHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBtaW50aW5nRmluaXNoZWQgPSB0cnVlOwogICAgTWludEZpbmlzaGVkKCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KCi8qKgogKiBAdGl0bGUgQ2FwcGVkIHRva2VuCiAqIEBkZXYgTWludGFibGUgdG9rZW4gd2l0aCBhIHRva2VuIGNhcC4KICovCgpjb250cmFjdCBDYXBwZWRUb2tlbiBpcyBNaW50YWJsZVRva2VuIHsKCiAgdWludDI1NiBwdWJsaWMgY2FwOwoKICBmdW5jdGlvbiBDYXBwZWRUb2tlbih1aW50MjU2IF9jYXApIHB1YmxpYyB7CiAgICByZXF1aXJlKF9jYXAgPiAwKTsKICAgIGNhcCA9IF9jYXA7CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIG1pbnQgdG9rZW5zCiAgICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgcmVjZWl2ZSB0aGUgbWludGVkIHRva2Vucy4KICAgKiBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBtaW50LgogICAqIEByZXR1cm4gQSBib29sZWFuIHRoYXQgaW5kaWNhdGVzIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwuCiAgICovCiAgZnVuY3Rpb24gbWludChhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBvbmx5T3duZXIgY2FuTWludCBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZSh0b3RhbFN1cHBseS5hZGQoX2Ftb3VudCkgPD0gY2FwKTsKCiAgICByZXR1cm4gc3VwZXIubWludChfdG8sIF9hbW91bnQpOwogIH0KCn0KCi8qKgogKiBAdGl0bGUgU2FmZUVSQzIwCiAqIEBkZXYgV3JhcHBlcnMgYXJvdW5kIEVSQzIwIG9wZXJhdGlvbnMgdGhhdCB0aHJvdyBvbiBmYWlsdXJlLgogKiBUbyB1c2UgdGhpcyBsaWJyYXJ5IHlvdSBjYW4gYWRkIGEgYHVzaW5nIFNhZmVFUkMyMCBmb3IgRVJDMjA7YCBzdGF0ZW1lbnQgdG8geW91ciBjb250cmFjdCwKICogd2hpY2ggYWxsb3dzIHlvdSB0byBjYWxsIHRoZSBzYWZlIG9wZXJhdGlvbnMgYXMgYHRva2VuLnNhZmVUcmFuc2ZlciguLi4pYCwgZXRjLgogKi8KbGlicmFyeSBTYWZlRVJDMjAgewogIGZ1bmN0aW9uIHNhZmVUcmFuc2ZlcihFUkMyMEJhc2ljIHRva2VuLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBpbnRlcm5hbCB7CiAgICBhc3NlcnQodG9rZW4udHJhbnNmZXIodG8sIHZhbHVlKSk7CiAgfQoKICBmdW5jdGlvbiBzYWZlVHJhbnNmZXJGcm9tKEVSQzIwIHRva2VuLCBhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHsKICAgIGFzc2VydCh0b2tlbi50cmFuc2ZlckZyb20oZnJvbSwgdG8sIHZhbHVlKSk7CiAgfQoKICBmdW5jdGlvbiBzYWZlQXBwcm92ZShFUkMyMCB0b2tlbiwgYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBpbnRlcm5hbCB7CiAgICBhc3NlcnQodG9rZW4uYXBwcm92ZShzcGVuZGVyLCB2YWx1ZSkpOwogIH0KfQoKLyoqCiAqIEB0aXRsZSBUb2tlblZlc3RpbmcKICogQGRldiBBIHRva2VuIGhvbGRlciBjb250cmFjdCB0aGF0IGNhbiByZWxlYXNlIGl0cyB0b2tlbiBiYWxhbmNlIGdyYWR1YWxseSBsaWtlIGEKICogdHlwaWNhbCB2ZXN0aW5nIHNjaGVtZSwgd2l0aCBhIGNsaWZmIGFuZCB2ZXN0aW5nIHBlcmlvZC4gT3B0aW9uYWxseSByZXZvY2FibGUgYnkgdGhlCiAqIG93bmVyLgogKi8KY29udHJhY3QgVG9rZW5WZXN0aW5nIGlzIE93bmFibGUgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwogIHVzaW5nIFNhZmVFUkMyMCBmb3IgRVJDMjBCYXNpYzsKCiAgZXZlbnQgUmVsZWFzZWQodWludDI1NiBhbW91bnQpOwogIGV2ZW50IFJldm9rZWQoKTsKCiAgLy8gYmVuZWZpY2lhcnkgb2YgdG9rZW5zIGFmdGVyIHRoZXkgYXJlIHJlbGVhc2VkCiAgYWRkcmVzcyBwdWJsaWMgYmVuZWZpY2lhcnk7CgogIHVpbnQyNTYgcHVibGljIGNsaWZmOwogIHVpbnQyNTYgcHVibGljIHN0YXJ0OwogIHVpbnQyNTYgcHVibGljIGR1cmF0aW9uOwoKICBib29sIHB1YmxpYyByZXZvY2FibGU7CgogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIHJlbGVhc2VkOwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIHJldm9rZWQ7CgogIC8qKgogICAqIEBkZXYgQ3JlYXRlcyBhIHZlc3RpbmcgY29udHJhY3QgdGhhdCB2ZXN0cyBpdHMgYmFsYW5jZSBvZiBhbnkgRVJDMjAgdG9rZW4gdG8gdGhlCiAgICogX2JlbmVmaWNpYXJ5LCBncmFkdWFsbHkgaW4gYSBsaW5lYXIgZmFzaGlvbiB1bnRpbCBfc3RhcnQgKyBfZHVyYXRpb24uIEJ5IHRoZW4gYWxsCiAgICogb2YgdGhlIGJhbGFuY2Ugd2lsbCBoYXZlIHZlc3RlZC4KICAgKiBAcGFyYW0gX2JlbmVmaWNpYXJ5IGFkZHJlc3Mgb2YgdGhlIGJlbmVmaWNpYXJ5IHRvIHdob20gdmVzdGVkIHRva2VucyBhcmUgdHJhbnNmZXJyZWQKICAgKiBAcGFyYW0gX2NsaWZmIGR1cmF0aW9uIGluIHNlY29uZHMgb2YgdGhlIGNsaWZmIGluIHdoaWNoIHRva2VucyB3aWxsIGJlZ2luIHRvIHZlc3QKICAgKiBAcGFyYW0gX2R1cmF0aW9uIGR1cmF0aW9uIGluIHNlY29uZHMgb2YgdGhlIHBlcmlvZCBpbiB3aGljaCB0aGUgdG9rZW5zIHdpbGwgdmVzdAogICAqIEBwYXJhbSBfcmV2b2NhYmxlIHdoZXRoZXIgdGhlIHZlc3RpbmcgaXMgcmV2b2NhYmxlIG9yIG5vdAogICAqLwogIGZ1bmN0aW9uIFRva2VuVmVzdGluZyhhZGRyZXNzIF9iZW5lZmljaWFyeSwgdWludDI1NiBfc3RhcnQsIHVpbnQyNTYgX2NsaWZmLCB1aW50MjU2IF9kdXJhdGlvbiwgYm9vbCBfcmV2b2NhYmxlKSBwdWJsaWMgewogICAgcmVxdWlyZShfYmVuZWZpY2lhcnkgIT0gYWRkcmVzcygwKSk7CiAgICByZXF1aXJlKF9jbGlmZiA8PSBfZHVyYXRpb24pOwoKICAgIGJlbmVmaWNpYXJ5ID0gX2JlbmVmaWNpYXJ5OwogICAgcmV2b2NhYmxlID0gX3Jldm9jYWJsZTsKICAgIGR1cmF0aW9uID0gX2R1cmF0aW9uOwogICAgY2xpZmYgPSBfc3RhcnQuYWRkKF9jbGlmZik7CiAgICBzdGFydCA9IF9zdGFydDsKICB9CgogIC8qKgogICAqIEBub3RpY2UgVHJhbnNmZXJzIHZlc3RlZCB0b2tlbnMgdG8gYmVuZWZpY2lhcnkuCiAgICogQHBhcmFtIHRva2VuIEVSQzIwIHRva2VuIHdoaWNoIGlzIGJlaW5nIHZlc3RlZAogICAqLwogIGZ1bmN0aW9uIHJlbGVhc2UoRVJDMjBCYXNpYyB0b2tlbikgcHVibGljIHsKICAgIHVpbnQyNTYgdW5yZWxlYXNlZCA9IHJlbGVhc2FibGVBbW91bnQodG9rZW4pOwoKICAgIHJlcXVpcmUodW5yZWxlYXNlZCA+IDApOwoKICAgIHJlbGVhc2VkW3Rva2VuXSA9IHJlbGVhc2VkW3Rva2VuXS5hZGQodW5yZWxlYXNlZCk7CgogICAgdG9rZW4uc2FmZVRyYW5zZmVyKGJlbmVmaWNpYXJ5LCB1bnJlbGVhc2VkKTsKCiAgICBSZWxlYXNlZCh1bnJlbGVhc2VkKTsKICB9CgogIC8qKgogICAqIEBub3RpY2UgQWxsb3dzIHRoZSBvd25lciB0byByZXZva2UgdGhlIHZlc3RpbmcuIFRva2VucyBhbHJlYWR5IHZlc3RlZAogICAqIHJlbWFpbiBpbiB0aGUgY29udHJhY3QsIHRoZSByZXN0IGFyZSByZXR1cm5lZCB0byB0aGUgb3duZXIuCiAgICogQHBhcmFtIHRva2VuIEVSQzIwIHRva2VuIHdoaWNoIGlzIGJlaW5nIHZlc3RlZAogICAqLwogIGZ1bmN0aW9uIHJldm9rZShFUkMyMEJhc2ljIHRva2VuKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmUocmV2b2NhYmxlKTsKICAgIHJlcXVpcmUoIXJldm9rZWRbdG9rZW5dKTsKCiAgICB1aW50MjU2IGJhbGFuY2UgPSB0b2tlbi5iYWxhbmNlT2YodGhpcyk7CgogICAgdWludDI1NiB1bnJlbGVhc2VkID0gcmVsZWFzYWJsZUFtb3VudCh0b2tlbik7CiAgICB1aW50MjU2IHJlZnVuZCA9IGJhbGFuY2Uuc3ViKHVucmVsZWFzZWQpOwoKICAgIHJldm9rZWRbdG9rZW5dID0gdHJ1ZTsKCiAgICB0b2tlbi5zYWZlVHJhbnNmZXIob3duZXIsIHJlZnVuZCk7CgogICAgUmV2b2tlZCgpOwogIH0KCiAgLyoqCiAgICogQGRldiBDYWxjdWxhdGVzIHRoZSBhbW91bnQgdGhhdCBoYXMgYWxyZWFkeSB2ZXN0ZWQgYnV0IGhhc24ndCBiZWVuIHJlbGVhc2VkIHlldC4KICAgKiBAcGFyYW0gdG9rZW4gRVJDMjAgdG9rZW4gd2hpY2ggaXMgYmVpbmcgdmVzdGVkCiAgICovCiAgZnVuY3Rpb24gcmVsZWFzYWJsZUFtb3VudChFUkMyMEJhc2ljIHRva2VuKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gdmVzdGVkQW1vdW50KHRva2VuKS5zdWIocmVsZWFzZWRbdG9rZW5dKTsKICB9CgogIC8qKgogICAqIEBkZXYgQ2FsY3VsYXRlcyB0aGUgYW1vdW50IHRoYXQgaGFzIGFscmVhZHkgdmVzdGVkLgogICAqIEBwYXJhbSB0b2tlbiBFUkMyMCB0b2tlbiB3aGljaCBpcyBiZWluZyB2ZXN0ZWQKICAgKi8KICBmdW5jdGlvbiB2ZXN0ZWRBbW91bnQoRVJDMjBCYXNpYyB0b2tlbikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjdXJyZW50QmFsYW5jZSA9IHRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgIHVpbnQyNTYgdG90YWxCYWxhbmNlID0gY3VycmVudEJhbGFuY2UuYWRkKHJlbGVhc2VkW3Rva2VuXSk7CgogICAgaWYgKG5vdyA8IGNsaWZmKSB7CiAgICAgIHJldHVybiAwOwogICAgfSBlbHNlIGlmIChub3cgPj0gc3RhcnQuYWRkKGR1cmF0aW9uKSB8fCByZXZva2VkW3Rva2VuXSkgewogICAgICByZXR1cm4gdG90YWxCYWxhbmNlOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHRvdGFsQmFsYW5jZS5tdWwobm93LnN1YihzdGFydCkpLmRpdihkdXJhdGlvbik7CiAgICB9CiAgfQp9Cgpjb250cmFjdCBNb250aGx5VG9rZW5WZXN0aW5nIGlzIFRva2VuVmVzdGluZyB7CgogICAgdWludDI1NiBwdWJsaWMgcHJldmlvdXNUb2tlblZlc3RpbmcgPSAwOwoKICAgIGZ1bmN0aW9uIE1vbnRobHlUb2tlblZlc3RpbmcoCiAgICAgICAgYWRkcmVzcyBfYmVuZWZpY2lhcnksCiAgICAgICAgdWludDI1NiBfc3RhcnQsCiAgICAgICAgdWludDI1NiBfY2xpZmYsCiAgICAgICAgdWludDI1NiBfZHVyYXRpb24sCiAgICAgICAgYm9vbCBfcmV2b2NhYmxlCiAgICApIHB1YmxpYwogICAgVG9rZW5WZXN0aW5nKF9iZW5lZmljaWFyeSwgX3N0YXJ0LCBfY2xpZmYsIF9kdXJhdGlvbiwgX3Jldm9jYWJsZSkKICAgIHsgfQoKCiAgICBmdW5jdGlvbiByZWxlYXNlKEVSQzIwQmFzaWMgdG9rZW4pIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUobm93ID49IHByZXZpb3VzVG9rZW5WZXN0aW5nICsgMzAgZGF5cyk7CiAgICAgICAgc3VwZXIucmVsZWFzZSh0b2tlbik7CiAgICAgICAgcHJldmlvdXNUb2tlblZlc3RpbmcgPSBub3c7CiAgICB9Cn0KCmNvbnRyYWN0IENSRURUb2tlbiBpcyBDYXBwZWRUb2tlbiB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICAvKioKICAgICAqIENvbnN0YW50IGZpZWxkcwogICAgICovCgogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBuYW1lID0gIlZlcmlmeSBUb2tlbiI7CiAgICB1aW50OCBwdWJsaWMgY29uc3RhbnQgZGVjaW1hbHMgPSAxODsKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gIkNSRUQiOwoKICAgIC8qKgogICAgICogSW1tdXRhYmxlIHN0YXRlIHZhcmlhYmxlcwogICAgICovCgogICAgLy8gVGltZSB3aGVuIHRlYW0gYW5kIHJlc2VydmVkIHRva2VucyBhcmUgdW5sb2NrZWQKICAgIHVpbnQyNTYgcHVibGljIHJlc2VydmVVbmxvY2tUaW1lOwoKICAgIGFkZHJlc3MgcHVibGljIHRlYW1XYWxsZXQ7CiAgICBhZGRyZXNzIHB1YmxpYyByZXNlcnZlV2FsbGV0OwogICAgYWRkcmVzcyBwdWJsaWMgYWR2aXNvcnNXYWxsZXQ7CgogICAgLyoqCiAgICAgKiBTdGF0ZSB2YXJpYWJsZXMKICAgICAqLwoKICAgIHVpbnQyNTYgdGVhbUxvY2tlZDsKICAgIHVpbnQyNTYgcmVzZXJ2ZUxvY2tlZDsKICAgIHVpbnQyNTYgYWR2aXNvcnNMb2NrZWQ7CgogICAgLy8gQXJlIHRoZSB0b2tlbnMgbm9uLXRyYW5zZmVycmFibGU/CiAgICBib29sIHB1YmxpYyBsb2NrZWQgPSB0cnVlOwoKICAgIC8vIFdoZW4gdG9rZW5zIGNhbiBiZSB1bmZyZWV6ZWQuCiAgICB1aW50MjU2IHB1YmxpYyB1bmZyZWV6ZVRpbWUgPSAwOwoKICAgIGJvb2wgcHVibGljIHVubG9ja2VkUmVzZXJ2ZUFuZFRlYW1GdW5kcyA9IGZhbHNlOwoKICAgIE1vbnRobHlUb2tlblZlc3RpbmcgcHVibGljIGFkdmlzb3JzVmVzdGluZyA9IE1vbnRobHlUb2tlblZlc3RpbmcoYWRkcmVzcygwKSk7CgogICAgLyoqCiAgICAgKiBFdmVudHMKICAgICAqLwoKICAgIGV2ZW50IE1pbnRMb2NrZWQoYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IGFtb3VudCk7CgogICAgZXZlbnQgVW5sb2NrZWQoYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IGFtb3VudCk7CgogICAgLyoqCiAgICAgKiBNb2RpZmllcnMKICAgICAqLwoKICAgIC8vIFRva2VucyBtdXN0IG5vdCBiZSBsb2NrZWQuCiAgICBtb2RpZmllciB3aGVuTGlxdWlkIHsKICAgICAgICByZXF1aXJlKCFsb2NrZWQpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgYWZ0ZXJSZXNlcnZlVW5sb2NrVGltZSB7CiAgICAgICAgcmVxdWlyZShub3cgPj0gcmVzZXJ2ZVVubG9ja1RpbWUpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgdW5sb2NrUmVzZXJ2ZUFuZFRlYW1PbmNlIHsKICAgICAgICByZXF1aXJlKCF1bmxvY2tlZFJlc2VydmVBbmRUZWFtRnVuZHMpOwogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3RvcgogICAgICovCiAgICBmdW5jdGlvbiBDUkVEVG9rZW4oCiAgICAgICAgdWludDI1NiBfY2FwLAogICAgICAgIHVpbnQyNTYgX3llYXJMb2NrRW5kVGltZSwKICAgICAgICBhZGRyZXNzIF90ZWFtV2FsbGV0LAogICAgICAgIGFkZHJlc3MgX3Jlc2VydmVXYWxsZXQsCiAgICAgICAgYWRkcmVzcyBfYWR2aXNvcnNXYWxsZXQKICAgICkKICAgIENhcHBlZFRva2VuKF9jYXApCiAgICBwdWJsaWMKICAgIHsKICAgICAgICByZXF1aXJlKF95ZWFyTG9ja0VuZFRpbWUgIT0gMCk7CiAgICAgICAgcmVxdWlyZShfdGVhbVdhbGxldCAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF9yZXNlcnZlV2FsbGV0ICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX2Fkdmlzb3JzV2FsbGV0ICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICByZXNlcnZlVW5sb2NrVGltZSA9IF95ZWFyTG9ja0VuZFRpbWU7CiAgICAgICAgdGVhbVdhbGxldCA9IF90ZWFtV2FsbGV0OwogICAgICAgIHJlc2VydmVXYWxsZXQgPSBfcmVzZXJ2ZVdhbGxldDsKICAgICAgICBhZHZpc29yc1dhbGxldCA9IF9hZHZpc29yc1dhbGxldDsKICAgIH0KCiAgICAvLyBNaW50IGEgY2VydGFpbiBudW1iZXIgb2YgdG9rZW5zIHRoYXQgYXJlIGxvY2tlZCB1cC4KICAgIC8vIF92YWx1ZSBoYXMgdG8gYmUgYm91bmRlZCBub3QgdG8gb3ZlcmZsb3cuCiAgICBmdW5jdGlvbiBtaW50QWR2aXNvcnNUb2tlbnModWludDI1NiBfdmFsdWUpIHB1YmxpYyBvbmx5T3duZXIgY2FuTWludCB7CiAgICAgICAgcmVxdWlyZShhZHZpc29yc0xvY2tlZCA9PSAwKTsKICAgICAgICByZXF1aXJlKF92YWx1ZS5hZGQodG90YWxTdXBwbHkpIDw9IGNhcCk7CiAgICAgICAgYWR2aXNvcnNMb2NrZWQgPSBfdmFsdWU7CiAgICAgICAgTWludExvY2tlZChhZHZpc29yc1dhbGxldCwgX3ZhbHVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBtaW50VGVhbVRva2Vucyh1aW50MjU2IF92YWx1ZSkgcHVibGljIG9ubHlPd25lciBjYW5NaW50IHsKICAgICAgICByZXF1aXJlKHRlYW1Mb2NrZWQgPT0gMCk7CiAgICAgICAgcmVxdWlyZShfdmFsdWUuYWRkKHRvdGFsU3VwcGx5KSA8PSBjYXApOwogICAgICAgIHRlYW1Mb2NrZWQgPSBfdmFsdWU7CiAgICAgICAgTWludExvY2tlZCh0ZWFtV2FsbGV0LCBfdmFsdWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIG1pbnRSZXNlcnZlVG9rZW5zKHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgb25seU93bmVyIGNhbk1pbnQgewogICAgICAgIHJlcXVpcmUocmVzZXJ2ZUxvY2tlZCA9PSAwKTsKICAgICAgICByZXF1aXJlKF92YWx1ZS5hZGQodG90YWxTdXBwbHkpIDw9IGNhcCk7CiAgICAgICAgcmVzZXJ2ZUxvY2tlZCA9IF92YWx1ZTsKICAgICAgICBNaW50TG9ja2VkKHJlc2VydmVXYWxsZXQsIF92YWx1ZSk7CiAgICB9CgoKICAgIC8vLyBGaW5hbGlzZSBhbnkgbWludGluZyBvcGVyYXRpb25zLiBSZXNldHMgdGhlIG93bmVyIGFuZCBjYXVzZXMgbm9ybWFsIHRva2VucwogICAgLy8vIHRvIGJlIGZyb3plbi4gQWxzbyBiZWdpbnMgdGhlIGNvdW50ZG93biBmb3IgbG9ja2VkLXVwIHRva2Vucy4KICAgIGZ1bmN0aW9uIGZpbmFsaXNlKCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShyZXNlcnZlTG9ja2VkID4gMCk7CiAgICAgICAgcmVxdWlyZSh0ZWFtTG9ja2VkID4gMCk7CiAgICAgICAgcmVxdWlyZShhZHZpc29yc0xvY2tlZCA+IDApOwoKICAgICAgICBhZHZpc29yc1Zlc3RpbmcgPSBuZXcgTW9udGhseVRva2VuVmVzdGluZyhhZHZpc29yc1dhbGxldCwgbm93LCA5MiBkYXlzLCAyIHllYXJzLCBmYWxzZSk7CiAgICAgICAgbWludChhZHZpc29yc1Zlc3RpbmcsIGFkdmlzb3JzTG9ja2VkKTsKICAgICAgICBmaW5pc2hNaW50aW5nKCk7CgogICAgICAgIG93bmVyID0gMDsKICAgICAgICB1bmZyZWV6ZVRpbWUgPSBub3cgKyAxIHdlZWtzOwogICAgfQoKCiAgICAvLyBDYXVzZXMgdG9rZW5zIHRvIGJlIGxpcXVpZCAxIHdlZWsgYWZ0ZXIgdGhlIHRva2Vuc2FsZSBpcyBjb21wbGV0ZWQKICAgIGZ1bmN0aW9uIHVuZnJlZXplKCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKHVuZnJlZXplVGltZSA+IDApOwogICAgICAgIHJlcXVpcmUobm93ID49IHVuZnJlZXplVGltZSk7CiAgICAgICAgbG9ja2VkID0gZmFsc2U7CiAgICB9CgoKICAgIC8vLyBVbmxvY2sgYW55IG5vdyBmcmVlYWJsZSB0b2tlbnMgdGhhdCBhcmUgbG9ja2VkIHVwIGZvciB0ZWFtIGFuZCByZXNlcnZlIGFjY291bnRzIC4KICAgIGZ1bmN0aW9uIHVubG9ja1RlYW1BbmRSZXNlcnZlVG9rZW5zKCkgcHVibGljIHdoZW5MaXF1aWQgYWZ0ZXJSZXNlcnZlVW5sb2NrVGltZSB1bmxvY2tSZXNlcnZlQW5kVGVhbU9uY2UgewogICAgICAgIHJlcXVpcmUodG90YWxTdXBwbHkuYWRkKHRlYW1Mb2NrZWQpLmFkZChyZXNlcnZlTG9ja2VkKSA8PSBjYXApOwoKICAgICAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LmFkZCh0ZWFtTG9ja2VkKS5hZGQocmVzZXJ2ZUxvY2tlZCk7CiAgICAgICAgYmFsYW5jZXNbdGVhbVdhbGxldF0gPSBiYWxhbmNlc1t0ZWFtV2FsbGV0XS5hZGQodGVhbUxvY2tlZCk7CiAgICAgICAgYmFsYW5jZXNbcmVzZXJ2ZVdhbGxldF0gPSBiYWxhbmNlc1tyZXNlcnZlV2FsbGV0XS5hZGQocmVzZXJ2ZUxvY2tlZCk7CiAgICAgICAgdGVhbUxvY2tlZCA9IDA7CiAgICAgICAgcmVzZXJ2ZUxvY2tlZCA9IDA7CiAgICAgICAgdW5sb2NrZWRSZXNlcnZlQW5kVGVhbUZ1bmRzID0gdHJ1ZTsKCiAgICAgICAgVHJhbnNmZXIoYWRkcmVzcygwKSwgdGVhbVdhbGxldCwgdGVhbUxvY2tlZCk7CiAgICAgICAgVHJhbnNmZXIoYWRkcmVzcygwKSwgcmVzZXJ2ZVdhbGxldCwgcmVzZXJ2ZUxvY2tlZCk7CiAgICAgICAgVW5sb2NrZWQodGVhbVdhbGxldCwgdGVhbUxvY2tlZCk7CiAgICAgICAgVW5sb2NrZWQocmVzZXJ2ZVdhbGxldCwgcmVzZXJ2ZUxvY2tlZCk7CiAgICB9CgogICAgZnVuY3Rpb24gdW5sb2NrQWR2aXNvclRva2VucygpIHB1YmxpYyB3aGVuTGlxdWlkIHsKICAgICAgICBhZHZpc29yc1Zlc3RpbmcucmVsZWFzZSh0aGlzKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBNZXRob2RzIG92ZXJyaWRpbmcgc29tZSBPcGVuWmVwcGVsaW4gZnVuY3Rpb25zIHRvIHByZXZlbnQgY2FsbGluZyB0aGVtIHdoZW4gdG9rZW4gaXMgbm90IGxpcXVpZC4KICAgICAqLwoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHdoZW5MaXF1aWQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHdoZW5MaXF1aWQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBzdXBlci50cmFuc2ZlckZyb20oX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgd2hlbkxpcXVpZCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHN1cGVyLmFwcHJvdmUoX3NwZW5kZXIsIF92YWx1ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gaW5jcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF9hZGRlZFZhbHVlKSBwdWJsaWMgd2hlbkxpcXVpZCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHN1cGVyLmluY3JlYXNlQXBwcm92YWwoX3NwZW5kZXIsIF9hZGRlZFZhbHVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBkZWNyZWFzZUFwcHJvdmFsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3N1YnRyYWN0ZWRWYWx1ZSkgcHVibGljIHdoZW5MaXF1aWQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBzdXBlci5kZWNyZWFzZUFwcHJvdmFsKF9zcGVuZGVyLCBfc3VidHJhY3RlZFZhbHVlKTsKICAgIH0KCn0KCi8qKgogKiBAdGl0bGUgQ3Jvd2RzYWxlCiAqIEBkZXYgQ3Jvd2RzYWxlIGlzIGEgYmFzZSBjb250cmFjdCBmb3IgbWFuYWdpbmcgYSB0b2tlbiBjcm93ZHNhbGUuCiAqIENyb3dkc2FsZXMgaGF2ZSBhIHN0YXJ0IGFuZCBlbmQgdGltZXN0YW1wcywgd2hlcmUgaW52ZXN0b3JzIGNhbiBtYWtlCiAqIHRva2VuIHB1cmNoYXNlcyBhbmQgdGhlIGNyb3dkc2FsZSB3aWxsIGFzc2lnbiB0aGVtIHRva2VucyBiYXNlZAogKiBvbiBhIHRva2VuIHBlciBFVEggcmF0ZS4gRnVuZHMgY29sbGVjdGVkIGFyZSBmb3J3YXJkZWQgdG8gYSB3YWxsZXQKICogYXMgdGhleSBhcnJpdmUuCiAqLwpjb250cmFjdCBDcm93ZHNhbGUgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAvLyBUaGUgdG9rZW4gYmVpbmcgc29sZAogIE1pbnRhYmxlVG9rZW4gcHVibGljIHRva2VuOwoKICAvLyBzdGFydCBhbmQgZW5kIHRpbWVzdGFtcHMgd2hlcmUgaW52ZXN0bWVudHMgYXJlIGFsbG93ZWQgKGJvdGggaW5jbHVzaXZlKQogIHVpbnQyNTYgcHVibGljIHN0YXJ0VGltZTsKICB1aW50MjU2IHB1YmxpYyBlbmRUaW1lOwoKICAvLyBhZGRyZXNzIHdoZXJlIGZ1bmRzIGFyZSBjb2xsZWN0ZWQKICBhZGRyZXNzIHB1YmxpYyB3YWxsZXQ7CgogIC8vIGhvdyBtYW55IHRva2VuIHVuaXRzIGEgYnV5ZXIgZ2V0cyBwZXIgd2VpCiAgdWludDI1NiBwdWJsaWMgcmF0ZTsKCiAgLy8gYW1vdW50IG9mIHJhaXNlZCBtb25leSBpbiB3ZWkKICB1aW50MjU2IHB1YmxpYyB3ZWlSYWlzZWQ7CgogIC8qKgogICAqIGV2ZW50IGZvciB0b2tlbiBwdXJjaGFzZSBsb2dnaW5nCiAgICogQHBhcmFtIHB1cmNoYXNlciB3aG8gcGFpZCBmb3IgdGhlIHRva2VucwogICAqIEBwYXJhbSBiZW5lZmljaWFyeSB3aG8gZ290IHRoZSB0b2tlbnMKICAgKiBAcGFyYW0gdmFsdWUgd2VpcyBwYWlkIGZvciBwdXJjaGFzZQogICAqIEBwYXJhbSBhbW91bnQgYW1vdW50IG9mIHRva2VucyBwdXJjaGFzZWQKICAgKi8KICBldmVudCBUb2tlblB1cmNoYXNlKGFkZHJlc3MgaW5kZXhlZCBwdXJjaGFzZXIsIGFkZHJlc3MgaW5kZXhlZCBiZW5lZmljaWFyeSwgdWludDI1NiB2YWx1ZSwgdWludDI1NiBhbW91bnQpOwoKCiAgZnVuY3Rpb24gQ3Jvd2RzYWxlKHVpbnQyNTYgX3N0YXJ0VGltZSwgdWludDI1NiBfZW5kVGltZSwgdWludDI1NiBfcmF0ZSwgYWRkcmVzcyBfd2FsbGV0KSBwdWJsaWMgewogICAgcmVxdWlyZShfc3RhcnRUaW1lID49IG5vdyk7CiAgICByZXF1aXJlKF9lbmRUaW1lID49IF9zdGFydFRpbWUpOwogICAgcmVxdWlyZShfcmF0ZSA+IDApOwogICAgcmVxdWlyZShfd2FsbGV0ICE9IGFkZHJlc3MoMCkpOwoKICAgIHRva2VuID0gY3JlYXRlVG9rZW5Db250cmFjdCgpOwogICAgc3RhcnRUaW1lID0gX3N0YXJ0VGltZTsKICAgIGVuZFRpbWUgPSBfZW5kVGltZTsKICAgIHJhdGUgPSBfcmF0ZTsKICAgIHdhbGxldCA9IF93YWxsZXQ7CiAgfQoKICAvLyBjcmVhdGVzIHRoZSB0b2tlbiB0byBiZSBzb2xkLgogIC8vIG92ZXJyaWRlIHRoaXMgbWV0aG9kIHRvIGhhdmUgY3Jvd2RzYWxlIG9mIGEgc3BlY2lmaWMgbWludGFibGUgdG9rZW4uCiAgZnVuY3Rpb24gY3JlYXRlVG9rZW5Db250cmFjdCgpIGludGVybmFsIHJldHVybnMgKE1pbnRhYmxlVG9rZW4pIHsKICAgIHJldHVybiBuZXcgTWludGFibGVUb2tlbigpOwogIH0KCgogIC8vIGZhbGxiYWNrIGZ1bmN0aW9uIGNhbiBiZSB1c2VkIHRvIGJ1eSB0b2tlbnMKICBmdW5jdGlvbiAoKSBleHRlcm5hbCBwYXlhYmxlIHsKICAgIGJ1eVRva2Vucyhtc2cuc2VuZGVyKTsKICB9CgogIC8vIGxvdyBsZXZlbCB0b2tlbiBwdXJjaGFzZSBmdW5jdGlvbgogIGZ1bmN0aW9uIGJ1eVRva2VucyhhZGRyZXNzIGJlbmVmaWNpYXJ5KSBwdWJsaWMgcGF5YWJsZSB7CiAgICByZXF1aXJlKGJlbmVmaWNpYXJ5ICE9IGFkZHJlc3MoMCkpOwogICAgcmVxdWlyZSh2YWxpZFB1cmNoYXNlKCkpOwoKICAgIHVpbnQyNTYgd2VpQW1vdW50ID0gbXNnLnZhbHVlOwoKICAgIC8vIGNhbGN1bGF0ZSB0b2tlbiBhbW91bnQgdG8gYmUgY3JlYXRlZAogICAgdWludDI1NiB0b2tlbnMgPSB3ZWlBbW91bnQubXVsKHJhdGUpOwoKICAgIC8vIHVwZGF0ZSBzdGF0ZQogICAgd2VpUmFpc2VkID0gd2VpUmFpc2VkLmFkZCh3ZWlBbW91bnQpOwoKICAgIHRva2VuLm1pbnQoYmVuZWZpY2lhcnksIHRva2Vucyk7CiAgICBUb2tlblB1cmNoYXNlKG1zZy5zZW5kZXIsIGJlbmVmaWNpYXJ5LCB3ZWlBbW91bnQsIHRva2Vucyk7CgogICAgZm9yd2FyZEZ1bmRzKCk7CiAgfQoKICAvLyBzZW5kIGV0aGVyIHRvIHRoZSBmdW5kIGNvbGxlY3Rpb24gd2FsbGV0CiAgLy8gb3ZlcnJpZGUgdG8gY3JlYXRlIGN1c3RvbSBmdW5kIGZvcndhcmRpbmcgbWVjaGFuaXNtcwogIGZ1bmN0aW9uIGZvcndhcmRGdW5kcygpIGludGVybmFsIHsKICAgIHdhbGxldC50cmFuc2Zlcihtc2cudmFsdWUpOwogIH0KCiAgLy8gQHJldHVybiB0cnVlIGlmIHRoZSB0cmFuc2FjdGlvbiBjYW4gYnV5IHRva2VucwogIGZ1bmN0aW9uIHZhbGlkUHVyY2hhc2UoKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgIGJvb2wgd2l0aGluUGVyaW9kID0gbm93ID49IHN0YXJ0VGltZSAmJiBub3cgPD0gZW5kVGltZTsKICAgIGJvb2wgbm9uWmVyb1B1cmNoYXNlID0gbXNnLnZhbHVlICE9IDA7CiAgICByZXR1cm4gd2l0aGluUGVyaW9kICYmIG5vblplcm9QdXJjaGFzZTsKICB9CgogIC8vIEByZXR1cm4gdHJ1ZSBpZiBjcm93ZHNhbGUgZXZlbnQgaGFzIGVuZGVkCiAgZnVuY3Rpb24gaGFzRW5kZWQoKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gbm93ID4gZW5kVGltZTsKICB9CgoKfQovKioKICogQHRpdGxlIENhcHBlZENyb3dkc2FsZQogKiBAZGV2IEV4dGVuc2lvbiBvZiBDcm93ZHNhbGUgd2l0aCBhIG1heCBhbW91bnQgb2YgZnVuZHMgcmFpc2VkCiAqLwpjb250cmFjdCBDYXBwZWRDcm93ZHNhbGUgaXMgQ3Jvd2RzYWxlIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgdWludDI1NiBwdWJsaWMgY2FwOwoKICBmdW5jdGlvbiBDYXBwZWRDcm93ZHNhbGUodWludDI1NiBfY2FwKSBwdWJsaWMgewogICAgcmVxdWlyZShfY2FwID4gMCk7CiAgICBjYXAgPSBfY2FwOwogIH0KCiAgLy8gb3ZlcnJpZGluZyBDcm93ZHNhbGUjdmFsaWRQdXJjaGFzZSB0byBhZGQgZXh0cmEgY2FwIGxvZ2ljCiAgLy8gQHJldHVybiB0cnVlIGlmIGludmVzdG9ycyBjYW4gYnV5IGF0IHRoZSBtb21lbnQKICBmdW5jdGlvbiB2YWxpZFB1cmNoYXNlKCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICBib29sIHdpdGhpbkNhcCA9IHdlaVJhaXNlZC5hZGQobXNnLnZhbHVlKSA8PSBjYXA7CiAgICByZXR1cm4gc3VwZXIudmFsaWRQdXJjaGFzZSgpICYmIHdpdGhpbkNhcDsKICB9CgogIC8vIG92ZXJyaWRpbmcgQ3Jvd2RzYWxlI2hhc0VuZGVkIHRvIGFkZCBjYXAgbG9naWMKICAvLyBAcmV0dXJuIHRydWUgaWYgY3Jvd2RzYWxlIGV2ZW50IGhhcyBlbmRlZAogIGZ1bmN0aW9uIGhhc0VuZGVkKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgYm9vbCBjYXBSZWFjaGVkID0gd2VpUmFpc2VkID49IGNhcDsKICAgIHJldHVybiBzdXBlci5oYXNFbmRlZCgpIHx8IGNhcFJlYWNoZWQ7CiAgfQoKfQoKLyoqCiAqIEB0aXRsZSBQYXVzYWJsZQogKiBAZGV2IEJhc2UgY29udHJhY3Qgd2hpY2ggYWxsb3dzIGNoaWxkcmVuIHRvIGltcGxlbWVudCBhbiBlbWVyZ2VuY3kgc3RvcCBtZWNoYW5pc20uCiAqLwpjb250cmFjdCBQYXVzYWJsZSBpcyBPd25hYmxlIHsKICBldmVudCBQYXVzZSgpOwogIGV2ZW50IFVucGF1c2UoKTsKCiAgYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CgoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIG5vdCBwYXVzZWQuCiAgICovCiAgbW9kaWZpZXIgd2hlbk5vdFBhdXNlZCgpIHsKICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBNb2RpZmllciB0byBtYWtlIGEgZnVuY3Rpb24gY2FsbGFibGUgb25seSB3aGVuIHRoZSBjb250cmFjdCBpcyBwYXVzZWQuCiAgICovCiAgbW9kaWZpZXIgd2hlblBhdXNlZCgpIHsKICAgIHJlcXVpcmUocGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gcGF1c2UsIHRyaWdnZXJzIHN0b3BwZWQgc3RhdGUKICAgKi8KICBmdW5jdGlvbiBwYXVzZSgpIG9ubHlPd25lciB3aGVuTm90UGF1c2VkIHB1YmxpYyB7CiAgICBwYXVzZWQgPSB0cnVlOwogICAgUGF1c2UoKTsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byB1bnBhdXNlLCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHVucGF1c2UoKSBvbmx5T3duZXIgd2hlblBhdXNlZCBwdWJsaWMgewogICAgcGF1c2VkID0gZmFsc2U7CiAgICBVbnBhdXNlKCk7CiAgfQp9Cgpjb250cmFjdCBUb2tlbnNhbGUgaXMgQ2FwcGVkQ3Jvd2RzYWxlLCBQYXVzYWJsZXsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAgIHVpbnQyNTYgY29uc3RhbnQgcHVibGljIE1BWF9TVVBQTFkgPSA1MDAwMDAwMCBldGhlcjsKICAgIHVpbnQyNTYgY29uc3RhbnQgcHVibGljIFNBTEVfVE9LRU5TX1NVUFBMWSA9IDExMTI1MDAwIGV0aGVyOwogICAgdWludDI1NiBjb25zdGFudCBwdWJsaWMgSU5WRVNUTUVOVF9GVU5EX1RPS0VOU19TVVBQTFkgPSAxMDUwMDAwMCBldGhlcjsKICAgIHVpbnQyNTYgY29uc3RhbnQgcHVibGljIE1JU0NFTExBTkVPVVNfVE9LRU5TX1NVUFBMWSA9IDI4NzUwMDAgZXRoZXI7CiAgICB1aW50MjU2IGNvbnN0YW50IHB1YmxpYyBURUFNX1RPS0VOU19TVVBQTFkgPSAxMDAwMDAwMCBldGhlcjsKICAgIHVpbnQyNTYgY29uc3RhbnQgcHVibGljIFJFU0VSVkVfVE9LRU5TX1NVUFBMWSA9IDEwMDAwMDAwIGV0aGVyOwogICAgdWludDI1NiBjb25zdGFudCBwdWJsaWMgQURWSVNPUlNfVE9LRU5TX1NVUFBMWSA9IDU1MDAwMDAgZXRoZXI7CgoKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU29sZDsKICAgIHVpbnQyNTYgcHVibGljIHNvbGREdXJpbmdUb2tlbnNhbGU7CgogICAgdWludDI1NiBwdWJsaWMgcHJlc2FsZVN0YXJ0VGltZTsKCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIHByZXNhbGVMaW1pdDsKCgogICAgbW9kaWZpZXIgYmVmb3JlU2FsZSgpIHsKICAgICAgICByZXF1aXJlKG5vdyA8IHN0YXJ0VGltZSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBkdXJpbmdTYWxlKCkgewogICAgICAgIHJlcXVpcmUobm93ID49IHN0YXJ0VGltZSAmJiAhaGFzRW5kZWQoKSAmJiAhcGF1c2VkKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIFRva2Vuc2FsZSgKICAgICAgICB1aW50MjU2IF9wcmVzYWxlU3RhcnRUaW1lLAogICAgICAgIHVpbnQyNTYgX3N0YXJ0VGltZSwKICAgICAgICB1aW50MjU2IF9oYXJkQ2FwLAogICAgICAgIGFkZHJlc3MgX2ludmVzdG1lbnRGdW5kV2FsbGV0LAogICAgICAgIGFkZHJlc3MgX21pc2NlbGxhbmVvdXNXYWxsZXQsCiAgICAgICAgYWRkcmVzcyBfdHJlYXN1cnksCiAgICAgICAgYWRkcmVzcyBfdGVhbVdhbGxldCwKICAgICAgICBhZGRyZXNzIF9yZXNlcnZlV2FsbGV0LAogICAgICAgIGFkZHJlc3MgX2Fkdmlzb3JzV2FsbGV0CiAgICApCiAgICBDYXBwZWRDcm93ZHNhbGUoX2hhcmRDYXApCiAgICBDcm93ZHNhbGUoX3N0YXJ0VGltZSwgX3N0YXJ0VGltZSArIDMwIGRheXMsIFNBTEVfVE9LRU5TX1NVUFBMWS5kaXYoX2hhcmRDYXApLCBfdHJlYXN1cnkpCiAgICBwdWJsaWMKICAgIHsKICAgICAgICByZXF1aXJlKF9zdGFydFRpbWUgPiBfcHJlc2FsZVN0YXJ0VGltZSk7CiAgICAgICAgcmVxdWlyZShub3cgPCBfcHJlc2FsZVN0YXJ0VGltZSk7CgogICAgICAgIHRva2VuID0gbmV3IENSRURUb2tlbigKICAgICAgICAgICAgTUFYX1NVUFBMWSwKICAgICAgICAgICAgX3N0YXJ0VGltZSArIDEgeWVhcnMsCiAgICAgICAgICAgIF90ZWFtV2FsbGV0LAogICAgICAgICAgICBfcmVzZXJ2ZVdhbGxldCwKICAgICAgICAgICAgX2Fkdmlzb3JzV2FsbGV0CiAgICAgICAgKTsKICAgICAgICBwcmVzYWxlU3RhcnRUaW1lID0gX3ByZXNhbGVTdGFydFRpbWU7CiAgICAgICAgbWludEludmVzdG1lbnRGdW5kQW5kTWlzY2VsbGFuZW91cyhfaW52ZXN0bWVudEZ1bmRXYWxsZXQsIF9taXNjZWxsYW5lb3VzV2FsbGV0KTsKICAgICAgICBjYXN0ZWRUb2tlbigpLm1pbnRUZWFtVG9rZW5zKFRFQU1fVE9LRU5TX1NVUFBMWSk7CiAgICAgICAgY2FzdGVkVG9rZW4oKS5taW50UmVzZXJ2ZVRva2VucyhSRVNFUlZFX1RPS0VOU19TVVBQTFkpOwogICAgICAgIGNhc3RlZFRva2VuKCkubWludEFkdmlzb3JzVG9rZW5zKEFEVklTT1JTX1RPS0VOU19TVVBQTFkpOwoKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRIYXJkQ2FwKHVpbnQyNTYgX2NhcCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShub3cgPCBwcmVzYWxlU3RhcnRUaW1lKTsKICAgICAgICByZXF1aXJlKF9jYXAgPiAwKTsKICAgICAgICBjYXAgPSBfY2FwOwogICAgICAgIHJhdGUgPSBTQUxFX1RPS0VOU19TVVBQTFkuZGl2KF9jYXApOwogICAgfQoKICAgIC8vIEZ1bmN0aW9uIGZvciBzZXR0aW5nIHByZXNhbGUgYnV5IGxpbWl0cyBmb3IgbGlzdCBvZiBhY2NvdW50cwogICAgZnVuY3Rpb24gYWRkUHJlc2FsZVdhbGxldHMoYWRkcmVzc1tdIF93YWxsZXRzLCB1aW50MjU2W10gX3dlaUxpbWl0KSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUobm93IDwgc3RhcnRUaW1lKTsKICAgICAgICByZXF1aXJlKF93YWxsZXRzLmxlbmd0aCA9PSBfd2VpTGltaXQubGVuZ3RoKTsKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBfd2FsbGV0cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBwcmVzYWxlTGltaXRbX3dhbGxldHNbaV1dID0gX3dlaUxpbWl0W2ldOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBPdmVycmlkZSB0byB0cmFjayBzb2xkIHRva2VucwogICAgZnVuY3Rpb24gYnV5VG9rZW5zKGFkZHJlc3MgYmVuZWZpY2lhcnkpIHB1YmxpYyBwYXlhYmxlIHsKICAgICAgICBzdXBlci5idXlUb2tlbnMoYmVuZWZpY2lhcnkpOwogICAgICAgIC8vIElmIGJvdWdodCBpbiBwcmVzYWxlLCBkZWNyZWFzZSBsaW1pdAogICAgICAgIGlmIChub3cgPCBzdGFydFRpbWUpIHsKICAgICAgICAgICAgcHJlc2FsZUxpbWl0W21zZy5zZW5kZXJdID0gcHJlc2FsZUxpbWl0W21zZy5zZW5kZXJdLnN1Yihtc2cudmFsdWUpOwogICAgICAgIH0KICAgICAgICB0b3RhbFNvbGQgPSB0b3RhbFNvbGQuYWRkKG1zZy52YWx1ZS5tdWwocmF0ZSkpOwogICAgfQoKICAgIGZ1bmN0aW9uIGZpbmFsaXNlKCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKGhhc0VuZGVkKCkpOwogICAgICAgIGNhc3RlZFRva2VuKCkuZmluYWxpc2UoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBtaW50SW52ZXN0bWVudEZ1bmRBbmRNaXNjZWxsYW5lb3VzKAogICAgICAgIGFkZHJlc3MgX2ludmVzdG1lbnRGdW5kV2FsbGV0LAogICAgICAgIGFkZHJlc3MgX21pc2NlbGxhbmVvdXNXYWxsZXQKICAgICkgaW50ZXJuYWwgewogICAgICAgIHJlcXVpcmUoX2ludmVzdG1lbnRGdW5kV2FsbGV0ICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX21pc2NlbGxhbmVvdXNXYWxsZXQgIT0gYWRkcmVzcygwKSk7CgogICAgICAgIHRva2VuLm1pbnQoX2ludmVzdG1lbnRGdW5kV2FsbGV0LCBJTlZFU1RNRU5UX0ZVTkRfVE9LRU5TX1NVUFBMWSk7CiAgICAgICAgdG9rZW4ubWludChfbWlzY2VsbGFuZW91c1dhbGxldCwgTUlTQ0VMTEFORU9VU19UT0tFTlNfU1VQUExZKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjYXN0ZWRUb2tlbigpIGludGVybmFsIHZpZXcgcmV0dXJucyAoQ1JFRFRva2VuKSB7CiAgICAgICAgcmV0dXJuIENSRURUb2tlbih0b2tlbik7CiAgICB9CgogICAgLy8gT3ZlcnJpZGVzIENyb3dkc2FsZSNjcmVhdGVUb2tlbkNvbnRyYWN0IG5vdCB0byBjcmVhdGUgbmV3IHRva2VuCiAgICAvLyBDUkVEIFRva2VuIGlzIGNyZWF0ZWQgaW4gdGhlIGNvbnN0cnVjdG9yCiAgICBmdW5jdGlvbiBjcmVhdGVUb2tlbkNvbnRyYWN0KCkgaW50ZXJuYWwgcmV0dXJucyAoTWludGFibGVUb2tlbikgewogICAgICAgIHJldHVybiBNaW50YWJsZVRva2VuKGFkZHJlc3MoMCkpOwogICAgfQoKICAgIGZ1bmN0aW9uIHZhbGlkU2FsZVB1cmNoYXNlKCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHN1cGVyLnZhbGlkUHVyY2hhc2UoKTsKICAgIH0KCiAgICBmdW5jdGlvbiB2YWxpZFByZVNhbGVQdXJjaGFzZSgpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGlmIChtc2cudmFsdWUgPiBwcmVzYWxlTGltaXRbbXNnLnNlbmRlcl0pIHsgcmV0dXJuIGZhbHNlOyB9CiAgICAgICAgaWYgKHdlaVJhaXNlZC5hZGQobXNnLnZhbHVlKSA+IGNhcCkgeyByZXR1cm4gZmFsc2U7IH0KICAgICAgICBpZiAobm93IDwgcHJlc2FsZVN0YXJ0VGltZSkgeyByZXR1cm4gZmFsc2U7IH0KICAgICAgICBpZiAobm93ID49IHN0YXJ0VGltZSkgeyByZXR1cm4gZmFsc2U7IH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLyBPdmVycmlkZXMgQ2FwcGVkQ3Jvd2RzYWxlI3ZhbGlkUHVyY2hhc2UgdG8gY2hlY2sgaWYgbm90IHBhdXNlZAogICAgZnVuY3Rpb24gdmFsaWRQdXJjaGFzZSgpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICAgICAgcmV0dXJuIHZhbGlkU2FsZVB1cmNoYXNlKCkgfHwgdmFsaWRQcmVTYWxlUHVyY2hhc2UoKTsKICAgIH0KCn0='.
	

]
