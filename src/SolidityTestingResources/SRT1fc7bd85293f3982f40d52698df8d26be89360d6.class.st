Class {
	#name : #SRT1fc7bd85293f3982f40d52698df8d26be89360d6,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT1fc7bd85293f3982f40d52698df8d26be89360d6 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTY7CgovLyBjb3B5cmlnaHQgPHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI5NWY2ZmFmYmUxZjRmNmUxZDVkMGUxZmRmMGU3ZjBmOGZhZmJiYmY2ZmFmOCI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4KCmNvbnRyYWN0IFNhZmVNYXRoIHsKCiAgICAvKiBmdW5jdGlvbiBhc3NlcnQoYm9vbCBhc3NlcnRpb24pIGludGVybmFsIHsgKi8KICAgIC8qICAgaWYgKCFhc3NlcnRpb24pIHsgKi8KICAgIC8qICAgICB0aHJvdzsgKi8KICAgIC8qICAgfSAqLwogICAgLyogfSAgICAgIC8vIGFzc2VydCBubyBsb25nZXIgbmVlZGVkIG9uY2Ugc29saWRpdHkgaXMgb24gMC40LjEwICovCgogICAgZnVuY3Rpb24gc2FmZUFkZCh1aW50MjU2IHgsIHVpbnQyNTYgeSkgcHVyZSBpbnRlcm5hbCByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgdWludDI1NiB6ID0geCArIHk7CiAgICAgIGFzc2VydCgoeiA+PSB4KSAmJiAoeiA+PSB5KSk7CiAgICAgIHJldHVybiB6OwogICAgfQoKICAgIGZ1bmN0aW9uIHNhZmVTdWJ0cmFjdCh1aW50MjU2IHgsIHVpbnQyNTYgeSkgcHVyZSBpbnRlcm5hbCByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgYXNzZXJ0KHggPj0geSk7CiAgICAgIHVpbnQyNTYgeiA9IHggLSB5OwogICAgICByZXR1cm4gejsKICAgIH0KCiAgICBmdW5jdGlvbiBzYWZlTXVsdCh1aW50MjU2IHgsIHVpbnQyNTYgeSkgcHVyZSBpbnRlcm5hbCByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgdWludDI1NiB6ID0geCAqIHk7CiAgICAgIGFzc2VydCgoeCA9PSAwKXx8KHoveCA9PSB5KSk7CiAgICAgIHJldHVybiB6OwogICAgfQoKfQoKY29udHJhY3QgQmFzaWNBY2Nlc3NDb250cm9sIHsKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwogICAgLy8gYWRkcmVzc1tdIHB1YmxpYyBtb2RlcmF0b3JzOwogICAgdWludDE2IHB1YmxpYyB0b3RhbE1vZGVyYXRvcnMgPSAwOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgbW9kZXJhdG9yczsKICAgIGJvb2wgcHVibGljIGlzTWFpbnRhaW5pbmcgPSB0cnVlOwoKICAgIGZ1bmN0aW9uIEJhc2ljQWNjZXNzQ29udHJvbCgpIHB1YmxpYyB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlNb2RlcmF0b3JzKCkgewogICAgICAgIHJlcXVpcmUobW9kZXJhdG9yc1ttc2cuc2VuZGVyXSA9PSB0cnVlKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGlzQWN0aXZlIHsKICAgICAgICByZXF1aXJlKCFpc01haW50YWluaW5nKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIENoYW5nZU93bmVyKGFkZHJlc3MgX25ld093bmVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICBpZiAoX25ld093bmVyICE9IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgb3duZXIgPSBfbmV3T3duZXI7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIEFkZE1vZGVyYXRvcihhZGRyZXNzIF9uZXdNb2RlcmF0b3IpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIGlmIChtb2RlcmF0b3JzW19uZXdNb2RlcmF0b3JdID09IGZhbHNlKSB7CiAgICAgICAgICAgIG1vZGVyYXRvcnNbX25ld01vZGVyYXRvcl0gPSB0cnVlOwogICAgICAgICAgICB0b3RhbE1vZGVyYXRvcnMgKz0gMTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIFJlbW92ZU1vZGVyYXRvcihhZGRyZXNzIF9vbGRNb2RlcmF0b3IpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIGlmIChtb2RlcmF0b3JzW19vbGRNb2RlcmF0b3JdID09IHRydWUpIHsKICAgICAgICAgICAgbW9kZXJhdG9yc1tfb2xkTW9kZXJhdG9yXSA9IGZhbHNlOwogICAgICAgICAgICB0b3RhbE1vZGVyYXRvcnMgLT0gMTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIFVwZGF0ZU1haW50YWluaW5nKGJvb2wgX2lzTWFpbnRhaW5pbmcpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIGlzTWFpbnRhaW5pbmcgPSBfaXNNYWludGFpbmluZzsKICAgIH0KfQoKY29udHJhY3QgRXRoZXJlbW9uRW51bSB7CgogICAgZW51bSBSZXN1bHRDb2RlIHsKICAgICAgICBTVUNDRVNTLAogICAgICAgIEVSUk9SX0NMQVNTX05PVF9GT1VORCwKICAgICAgICBFUlJPUl9MT1dfQkFMQU5DRSwKICAgICAgICBFUlJPUl9TRU5EX0ZBSUwsCiAgICAgICAgRVJST1JfTk9UX1RSQUlORVIsCiAgICAgICAgRVJST1JfTk9UX0VOT1VHSF9NT05FWSwKICAgICAgICBFUlJPUl9JTlZBTElEX0FNT1VOVAogICAgfQogICAgCiAgICBlbnVtIEFycmF5VHlwZSB7CiAgICAgICAgQ0xBU1NfVFlQRSwKICAgICAgICBTVEFUX1NURVAsCiAgICAgICAgU1RBVF9TVEFSVCwKICAgICAgICBTVEFUX0JBU0UsCiAgICAgICAgT0JKX1NLSUxMCiAgICB9CiAgICAKICAgIGVudW0gUHJvcGVydHlUeXBlIHsKICAgICAgICBBTkNFU1RPUiwKICAgICAgICBYRkFDVE9SCiAgICB9Cn0KCmNvbnRyYWN0IEV0aGVyZW1vbkRhdGFCYXNlIGlzIEV0aGVyZW1vbkVudW0sIEJhc2ljQWNjZXNzQ29udHJvbCwgU2FmZU1hdGggewogICAgCiAgICB1aW50NjQgcHVibGljIHRvdGFsTW9uc3RlcjsKICAgIHVpbnQzMiBwdWJsaWMgdG90YWxDbGFzczsKICAgIAogICAgLy8gd3JpdGUKICAgIGZ1bmN0aW9uIHdpdGhkcmF3RXRoZXIoYWRkcmVzcyBfc2VuZFRvLCB1aW50IF9hbW91bnQpIG9ubHlPd25lciBwdWJsaWMgcmV0dXJucyhSZXN1bHRDb2RlKTsKICAgIGZ1bmN0aW9uIGFkZEVsZW1lbnRUb0FycmF5VHlwZShBcnJheVR5cGUgX3R5cGUsIHVpbnQ2NCBfaWQsIHVpbnQ4IF92YWx1ZSkgb25seU1vZGVyYXRvcnMgcHVibGljIHJldHVybnModWludCk7CiAgICBmdW5jdGlvbiB1cGRhdGVJbmRleE9mQXJyYXlUeXBlKEFycmF5VHlwZSBfdHlwZSwgdWludDY0IF9pZCwgdWludCBfaW5kZXgsIHVpbnQ4IF92YWx1ZSkgb25seU1vZGVyYXRvcnMgcHVibGljIHJldHVybnModWludCk7CiAgICBmdW5jdGlvbiBzZXRNb25zdGVyQ2xhc3ModWludDMyIF9jbGFzc0lkLCB1aW50MjU2IF9wcmljZSwgdWludDI1NiBfcmV0dXJuUHJpY2UsIGJvb2wgX2NhdGNoYWJsZSkgb25seU1vZGVyYXRvcnMgcHVibGljIHJldHVybnModWludDMyKTsKICAgIGZ1bmN0aW9uIGFkZE1vbnN0ZXJPYmoodWludDMyIF9jbGFzc0lkLCBhZGRyZXNzIF90cmFpbmVyLCBzdHJpbmcgX25hbWUpIG9ubHlNb2RlcmF0b3JzIHB1YmxpYyByZXR1cm5zKHVpbnQ2NCk7CiAgICBmdW5jdGlvbiBzZXRNb25zdGVyT2JqKHVpbnQ2NCBfb2JqSWQsIHN0cmluZyBfbmFtZSwgdWludDMyIF9leHAsIHVpbnQzMiBfY3JlYXRlSW5kZXgsIHVpbnQzMiBfbGFzdENsYWltSW5kZXgpIG9ubHlNb2RlcmF0b3JzIHB1YmxpYzsKICAgIGZ1bmN0aW9uIGluY3JlYXNlTW9uc3RlckV4cCh1aW50NjQgX29iaklkLCB1aW50MzIgYW1vdW50KSBvbmx5TW9kZXJhdG9ycyBwdWJsaWM7CiAgICBmdW5jdGlvbiBkZWNyZWFzZU1vbnN0ZXJFeHAodWludDY0IF9vYmpJZCwgdWludDMyIGFtb3VudCkgb25seU1vZGVyYXRvcnMgcHVibGljOwogICAgZnVuY3Rpb24gcmVtb3ZlTW9uc3RlcklkTWFwcGluZyhhZGRyZXNzIF90cmFpbmVyLCB1aW50NjQgX21vbnN0ZXJJZCkgb25seU1vZGVyYXRvcnMgcHVibGljOwogICAgZnVuY3Rpb24gYWRkTW9uc3RlcklkTWFwcGluZyhhZGRyZXNzIF90cmFpbmVyLCB1aW50NjQgX21vbnN0ZXJJZCkgb25seU1vZGVyYXRvcnMgcHVibGljOwogICAgZnVuY3Rpb24gY2xlYXJNb25zdGVyUmV0dXJuQmFsYW5jZSh1aW50NjQgX21vbnN0ZXJJZCkgb25seU1vZGVyYXRvcnMgcHVibGljIHJldHVybnModWludDI1NiBhbW91bnQpOwogICAgZnVuY3Rpb24gY29sbGVjdEFsbFJldHVybkJhbGFuY2UoYWRkcmVzcyBfdHJhaW5lcikgb25seU1vZGVyYXRvcnMgcHVibGljIHJldHVybnModWludDI1NiBhbW91bnQpOwogICAgZnVuY3Rpb24gdHJhbnNmZXJNb25zdGVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50NjQgX21vbnN0ZXJJZCkgb25seU1vZGVyYXRvcnMgcHVibGljIHJldHVybnMoUmVzdWx0Q29kZSk7CiAgICBmdW5jdGlvbiBhZGRFeHRyYUJhbGFuY2UoYWRkcmVzcyBfdHJhaW5lciwgdWludDI1NiBfYW1vdW50KSBvbmx5TW9kZXJhdG9ycyBwdWJsaWMgcmV0dXJucyh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIGRlZHVjdEV4dHJhQmFsYW5jZShhZGRyZXNzIF90cmFpbmVyLCB1aW50MjU2IF9hbW91bnQpIG9ubHlNb2RlcmF0b3JzIHB1YmxpYyByZXR1cm5zKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gc2V0RXh0cmFCYWxhbmNlKGFkZHJlc3MgX3RyYWluZXIsIHVpbnQyNTYgX2Ftb3VudCkgb25seU1vZGVyYXRvcnMgcHVibGljOwogICAgCiAgICAvLyByZWFkCiAgICBmdW5jdGlvbiBnZXRTaXplQXJyYXlUeXBlKEFycmF5VHlwZSBfdHlwZSwgdWludDY0IF9pZCkgY29uc3RhbnQgcHVibGljIHJldHVybnModWludCk7CiAgICBmdW5jdGlvbiBnZXRFbGVtZW50SW5BcnJheVR5cGUoQXJyYXlUeXBlIF90eXBlLCB1aW50NjQgX2lkLCB1aW50IF9pbmRleCkgY29uc3RhbnQgcHVibGljIHJldHVybnModWludDgpOwogICAgZnVuY3Rpb24gZ2V0TW9uc3RlckNsYXNzKHVpbnQzMiBfY2xhc3NJZCkgY29uc3RhbnQgcHVibGljIHJldHVybnModWludDMyIGNsYXNzSWQsIHVpbnQyNTYgcHJpY2UsIHVpbnQyNTYgcmV0dXJuUHJpY2UsIHVpbnQzMiB0b3RhbCwgYm9vbCBjYXRjaGFibGUpOwogICAgZnVuY3Rpb24gZ2V0TW9uc3Rlck9iaih1aW50NjQgX29iaklkKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50NjQgb2JqSWQsIHVpbnQzMiBjbGFzc0lkLCBhZGRyZXNzIHRyYWluZXIsIHVpbnQzMiBleHAsIHVpbnQzMiBjcmVhdGVJbmRleCwgdWludDMyIGxhc3RDbGFpbUluZGV4LCB1aW50IGNyZWF0ZVRpbWUpOwogICAgZnVuY3Rpb24gZ2V0TW9uc3Rlck5hbWUodWludDY0IF9vYmpJZCkgY29uc3RhbnQgcHVibGljIHJldHVybnMoc3RyaW5nIG5hbWUpOwogICAgZnVuY3Rpb24gZ2V0RXh0cmFCYWxhbmNlKGFkZHJlc3MgX3RyYWluZXIpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gZ2V0TW9uc3RlckRleFNpemUoYWRkcmVzcyBfdHJhaW5lcikgY29uc3RhbnQgcHVibGljIHJldHVybnModWludCk7CiAgICBmdW5jdGlvbiBnZXRNb25zdGVyT2JqSWQoYWRkcmVzcyBfdHJhaW5lciwgdWludCBpbmRleCkgY29uc3RhbnQgcHVibGljIHJldHVybnModWludDY0KTsKICAgIGZ1bmN0aW9uIGdldEV4cGVjdGVkQmFsYW5jZShhZGRyZXNzIF90cmFpbmVyKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIGdldE1vbnN0ZXJSZXR1cm4odWludDY0IF9vYmpJZCkgY29uc3RhbnQgcHVibGljIHJldHVybnModWludDI1NiBjdXJyZW50LCB1aW50MjU2IHRvdGFsKTsKfQoKY29udHJhY3QgRXRoZXJlbW9uR2F0ZXdheSBpcyBFdGhlcmVtb25FbnVtLCBCYXNpY0FjY2Vzc0NvbnRyb2wgewogICAgLy8gdXNpbmcgZm9yIGJhdHRsZSBjb250cmFjdCBsYXRlcgogICAgZnVuY3Rpb24gaW5jcmVhc2VNb25zdGVyRXhwKHVpbnQ2NCBfb2JqSWQsIHVpbnQzMiBhbW91bnQpIG9ubHlNb2RlcmF0b3JzIHB1YmxpYzsKICAgIGZ1bmN0aW9uIGRlY3JlYXNlTW9uc3RlckV4cCh1aW50NjQgX29iaklkLCB1aW50MzIgYW1vdW50KSBvbmx5TW9kZXJhdG9ycyBwdWJsaWM7CiAgICAKICAgIC8vIHJlYWQgCiAgICBmdW5jdGlvbiBpc0dhc29uKHVpbnQ2NCBfb2JqSWQpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMoYm9vbCk7CiAgICBmdW5jdGlvbiBnZXRPYmpCYXR0bGVJbmZvKHVpbnQ2NCBfb2JqSWQpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnModWludDMyIGNsYXNzSWQsIHVpbnQzMiBleHAsIGJvb2wgaXNHYXNvbiwgCiAgICAgICAgdWludCBhbmNlc3Rvckxlbmd0aCwgdWludCB4ZmFjdG9yc0xlbmd0aCk7CiAgICBmdW5jdGlvbiBnZXRDbGFzc1Byb3BlcnR5U2l6ZSh1aW50MzIgX2NsYXNzSWQsIFByb3BlcnR5VHlwZSBfdHlwZSkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyh1aW50KTsKICAgIGZ1bmN0aW9uIGdldENsYXNzUHJvcGVydHlWYWx1ZSh1aW50MzIgX2NsYXNzSWQsIFByb3BlcnR5VHlwZSBfdHlwZSwgdWludCBpbmRleCkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyh1aW50MzIpOwp9Cgpjb250cmFjdCBFdGhlcmVtb25Xb3JsZCBpcyBFdGhlcmVtb25HYXRld2F5LCBTYWZlTWF0aCB7CiAgICAvLyBvbGQgcHJvY2Vzc29yCiAgICBhZGRyZXNzIGNvbnN0YW50IHB1YmxpYyBFVEhFUkVNT05fUFJPQ0VTU09SID0gYWRkcmVzcygweDhhNjA4MDZGMDU4NzZmNGQ2ZEIwMGM4NzdCMDU1OERiQ0FEMzA2ODIpOwogICAgdWludDggY29uc3RhbnQgcHVibGljIFNUQVRfQ09VTlQgPSA2OwogICAgdWludDggY29uc3RhbnQgcHVibGljIFNUQVRfTUFYID0gMzI7CiAgICB1aW50OCBjb25zdGFudCBwdWJsaWMgR0VOMF9OTyA9IDI0OwogICAgCiAgICBzdHJ1Y3QgTW9uc3RlckNsYXNzQWNjIHsKICAgICAgICB1aW50MzIgY2xhc3NJZDsKICAgICAgICB1aW50MjU2IHByaWNlOwogICAgICAgIHVpbnQyNTYgcmV0dXJuUHJpY2U7CiAgICAgICAgdWludDMyIHRvdGFsOwogICAgICAgIGJvb2wgY2F0Y2hhYmxlOwogICAgfQoKICAgIHN0cnVjdCBNb25zdGVyT2JqQWNjIHsKICAgICAgICB1aW50NjQgbW9uc3RlcklkOwogICAgICAgIHVpbnQzMiBjbGFzc0lkOwogICAgICAgIGFkZHJlc3MgdHJhaW5lcjsKICAgICAgICBzdHJpbmcgbmFtZTsKICAgICAgICB1aW50MzIgZXhwOwogICAgICAgIHVpbnQzMiBjcmVhdGVJbmRleDsKICAgICAgICB1aW50MzIgbGFzdENsYWltSW5kZXg7CiAgICAgICAgdWludCBjcmVhdGVUaW1lOwogICAgfQogICAgCiAgICAvLyBHZW4wIGhhcyByZXR1cm4gcHJpY2UgJiBubyBsb25nZXIgY2FuIGJlIGNhdWdodCB3aGVuIHRoaXMgY29udHJhY3QgaXMgZGVwbG95ZWQKICAgIHN0cnVjdCBHZW4wQ29uZmlnIHsKICAgICAgICB1aW50MzIgY2xhc3NJZDsKICAgICAgICB1aW50MjU2IG9yaWdpbmFsUHJpY2U7CiAgICAgICAgdWludDI1NiByZXR1cm5QcmljZTsKICAgICAgICB1aW50MzIgdG90YWw7IC8vIHRvdGFsIGNhdWdodCAobm90IGNvdW50IHRob3NlIGZyb20gZWdncykKICAgIH0KICAgIAogICAgc3RydWN0IEdlblhQcm9wZXJ0eSB7CiAgICAgICAgdWludDMyIGNsYXNzSWQ7CiAgICAgICAgYm9vbCBpc0dhc29uOwogICAgICAgIHVpbnQzMltdIGFuY2VzdG9yczsKICAgICAgICB1aW50MzJbXSB4ZmFjdG9yczsKICAgIH0KICAgIAogICAgbWFwcGluZyh1aW50MzIgPT4gR2VuMENvbmZpZykgcHVibGljIGdlbjBDb25maWc7CiAgICBtYXBwaW5nKHVpbnQzMiA9PiBHZW5YUHJvcGVydHkpIHB1YmxpYyBnZW54UHJvcGVydHk7CiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbENhc2hvdXQgPSAwOyAvLyBmb3IgYWRtaW4KICAgIHVpbnQyNTYgcHVibGljIHRvdGFsRWFybiA9IDA7IC8vIGV4Y2x1ZGUgZ2VuIDAKICAgIHVpbnQxNiBwdWJsaWMgcHJpY2VJbmNyZWFzaW5nUmF0aW8gPSAxMDAwOwogICAgdWludCBwdWJsaWMgbWF4RGV4U2l6ZSA9IDUwMDsKICAgIAogICAgYWRkcmVzcyBwcml2YXRlIGxhc3RIdW50ZXIgPSBhZGRyZXNzKDB4MCk7CgogICAgLy8gZGF0YSBjb250cmFjdAogICAgYWRkcmVzcyBwdWJsaWMgZGF0YUNvbnRyYWN0OwogICAgCiAgICAvLyBldmVudAogICAgZXZlbnQgRXZlbnRDYXRjaE1vbnN0ZXIoYWRkcmVzcyBpbmRleGVkIHRyYWluZXIsIHVpbnQ2NCBvYmpJZCk7CiAgICBldmVudCBFdmVudENhc2hPdXQoYWRkcmVzcyBpbmRleGVkIHRyYWluZXIsIFJlc3VsdENvZGUgcmVzdWx0LCB1aW50MjU2IGFtb3VudCk7CiAgICBldmVudCBFdmVudFdpdGhkcmF3RXRoZXIoYWRkcmVzcyBpbmRleGVkIHNlbmRUbywgUmVzdWx0Q29kZSByZXN1bHQsIHVpbnQyNTYgYW1vdW50KTsKICAgIAogICAgZnVuY3Rpb24gRXRoZXJlbW9uV29ybGQoYWRkcmVzcyBfZGF0YUNvbnRyYWN0KSBwdWJsaWMgewogICAgICAgIGRhdGFDb250cmFjdCA9IF9kYXRhQ29udHJhY3Q7CiAgICB9CiAgICAKICAgICAvLyBhZG1pbiAmIG1vZGVyYXRvcnMKICAgIGZ1bmN0aW9uIHNldE1heERleFNpemUodWludCBfdmFsdWUpIG9ubHlNb2RlcmF0b3JzIGV4dGVybmFsIHsKICAgICAgICBtYXhEZXhTaXplID0gX3ZhbHVlOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBzZXRPcmlnaW5hbFByaWNlR2VuMCgpIG9ubHlNb2RlcmF0b3JzIGV4dGVybmFsIHsKICAgICAgICBnZW4wQ29uZmlnWzFdID0gR2VuMENvbmZpZygxLCAwLjMgZXRoZXIsIDAuMDAzIGV0aGVyLCAzNzQpOwogICAgICAgIGdlbjBDb25maWdbMl0gPSBHZW4wQ29uZmlnKDIsIDAuMyBldGhlciwgMC4wMDMgZXRoZXIsIDQwOCk7CiAgICAgICAgZ2VuMENvbmZpZ1szXSA9IEdlbjBDb25maWcoMywgMC4zIGV0aGVyLCAwLjAwMyBldGhlciwgMzczKTsKICAgICAgICBnZW4wQ29uZmlnWzRdID0gR2VuMENvbmZpZyg0LCAwLjIgZXRoZXIsIDAuMDAyIGV0aGVyLCA0MzcpOwogICAgICAgIGdlbjBDb25maWdbNV0gPSBHZW4wQ29uZmlnKDUsIDAuMSBldGhlciwgMC4wMDEgZXRoZXIsIDQ5Nyk7CiAgICAgICAgZ2VuMENvbmZpZ1s2XSA9IEdlbjBDb25maWcoNiwgMC4zIGV0aGVyLCAwLjAwMyBldGhlciwgMzgwKTsgCiAgICAgICAgZ2VuMENvbmZpZ1s3XSA9IEdlbjBDb25maWcoNywgMC4yIGV0aGVyLCAwLjAwMiBldGhlciwgMzQ1KTsKICAgICAgICBnZW4wQ29uZmlnWzhdID0gR2VuMENvbmZpZyg4LCAwLjEgZXRoZXIsIDAuMDAxIGV0aGVyLCA1MTgpOyAKICAgICAgICBnZW4wQ29uZmlnWzldID0gR2VuMENvbmZpZyg5LCAwLjEgZXRoZXIsIDAuMDAxIGV0aGVyLCA0NDcpOwogICAgICAgIGdlbjBDb25maWdbMTBdID0gR2VuMENvbmZpZygxMCwgMC4yIGV0aGVyLCAwLjAwMiBldGhlciwgMzgwKTsgCiAgICAgICAgZ2VuMENvbmZpZ1sxMV0gPSBHZW4wQ29uZmlnKDExLCAwLjIgZXRoZXIsIDAuMDAyIGV0aGVyLCAzNTQpOwogICAgICAgIGdlbjBDb25maWdbMTJdID0gR2VuMENvbmZpZygxMiwgMC4yIGV0aGVyLCAwLjAwMiBldGhlciwgMzQ2KTsKICAgICAgICBnZW4wQ29uZmlnWzEzXSA9IEdlbjBDb25maWcoMTMsIDAuMiBldGhlciwgMC4wMDIgZXRoZXIsIDM1MSk7IAogICAgICAgIGdlbjBDb25maWdbMTRdID0gR2VuMENvbmZpZygxNCwgMC4yIGV0aGVyLCAwLjAwMiBldGhlciwgMzM4KTsKICAgICAgICBnZW4wQ29uZmlnWzE1XSA9IEdlbjBDb25maWcoMTUsIDAuMiBldGhlciwgMC4wMDIgZXRoZXIsIDM0MSk7CiAgICAgICAgZ2VuMENvbmZpZ1sxNl0gPSBHZW4wQ29uZmlnKDE2LCAwLjM1IGV0aGVyLCAwLjAwMzUgZXRoZXIsIDM4NCk7CiAgICAgICAgZ2VuMENvbmZpZ1sxN10gPSBHZW4wQ29uZmlnKDE3LCAwLjEgZXRoZXIsIDAuMDAxIGV0aGVyLCAzMDUpOyAKICAgICAgICBnZW4wQ29uZmlnWzE4XSA9IEdlbjBDb25maWcoMTgsIDAuMSBldGhlciwgMC4wMDEgZXRoZXIsIDQyNyk7CiAgICAgICAgZ2VuMENvbmZpZ1sxOV0gPSBHZW4wQ29uZmlnKDE5LCAwLjEgZXRoZXIsIDAuMDAxIGV0aGVyLCAzMDQpOwogICAgICAgIGdlbjBDb25maWdbMjBdID0gR2VuMENvbmZpZygyMCwgMC40IGV0aGVyLCAwLjAwNSBldGhlciwgODIpOwogICAgICAgIGdlbjBDb25maWdbMjFdID0gR2VuMENvbmZpZygyMSwgMSwgMSwgMTIzKTsKICAgICAgICBnZW4wQ29uZmlnWzIyXSA9IEdlbjBDb25maWcoMjIsIDAuMiBldGhlciwgMC4wMDEgZXRoZXIsIDQ2OCk7CiAgICAgICAgZ2VuMENvbmZpZ1syM10gPSBHZW4wQ29uZmlnKDIzLCAwLjUgZXRoZXIsIDAuMDAyNSBldGhlciwgMzAyKTsKICAgICAgICBnZW4wQ29uZmlnWzI0XSA9IEdlbjBDb25maWcoMjQsIDEgZXRoZXIsIDAuMDA1IGV0aGVyLCAxOTUpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEVhcm5pbmdBbW91bnQoKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgICAgLy8gY2FsY3VsYXRlIHZhbHVlIGZvciBnZW4wCiAgICAgICAgdWludDI1NiB0b3RhbFZhbGlkQW1vdW50ID0gMDsKICAgICAgICBmb3IgKHVpbnQzMiBjbGFzc0lkPTE7IGNsYXNzSWQgPD0gR0VOMF9OTzsgY2xhc3NJZCsrKSB7CiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB0aGVyZSBpcyBhIGNsYXNzCiAgICAgICAgICAgIEdlbjBDb25maWcgc3RvcmFnZSBnZW4wID0gZ2VuMENvbmZpZ1tjbGFzc0lkXTsKICAgICAgICAgICAgaWYgKGdlbjAudG90YWwgPjAgJiYgZ2VuMC5jbGFzc0lkID09IGNsYXNzSWQgJiYgZ2VuMC5vcmlnaW5hbFByaWNlID4gMCAmJiBnZW4wLnJldHVyblByaWNlID4gMCkgewogICAgICAgICAgICAgICAgdWludDI1NiByYXRlID0gZ2VuMC5vcmlnaW5hbFByaWNlL2dlbjAucmV0dXJuUHJpY2U7CiAgICAgICAgICAgICAgICBpZiAocmF0ZSA8IGdlbjAudG90YWwpIHsKICAgICAgICAgICAgICAgICAgICB0b3RhbFZhbGlkQW1vdW50ICs9IChnZW4wLm9yaWdpbmFsUHJpY2UgKyBnZW4wLnJldHVyblByaWNlKSAqIHJhdGUgLyAyOwogICAgICAgICAgICAgICAgICAgIHRvdGFsVmFsaWRBbW91bnQgKz0gKGdlbjAudG90YWwgLSByYXRlKSAqIGdlbjAucmV0dXJuUHJpY2U7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRvdGFsVmFsaWRBbW91bnQgKz0gKGdlbjAub3JpZ2luYWxQcmljZSArIGdlbjAucmV0dXJuUHJpY2UgKiAocmF0ZSAtIGdlbjAudG90YWwgKyAxKSkgLyAyICogZ2VuMC50b3RhbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBhZGQgaW4gZWFybiBmcm9tIGdlbngKICAgICAgICB0b3RhbFZhbGlkQW1vdW50ID0gc2FmZUFkZCh0b3RhbFZhbGlkQW1vdW50LCB0b3RhbEVhcm4pOwogICAgICAgIC8vIGRlZHVjdCBhbW91bnQgb2YgY2FzaGluZyBvdXQgCiAgICAgICAgdG90YWxWYWxpZEFtb3VudCA9IHNhZmVTdWJ0cmFjdCh0b3RhbFZhbGlkQW1vdW50LCB0b3RhbENhc2hvdXQpOwogICAgICAgIAogICAgICAgIHJldHVybiB0b3RhbFZhbGlkQW1vdW50OwogICAgfQogICAgCiAgICBmdW5jdGlvbiB3aXRoZHJhd0V0aGVyKGFkZHJlc3MgX3NlbmRUbywgdWludCBfYW1vdW50KSBvbmx5TW9kZXJhdG9ycyBleHRlcm5hbCByZXR1cm5zKFJlc3VsdENvZGUpIHsKICAgICAgICBpZiAoX2Ftb3VudCA+IHRoaXMuYmFsYW5jZSkgewogICAgICAgICAgICBFdmVudFdpdGhkcmF3RXRoZXIoX3NlbmRUbywgUmVzdWx0Q29kZS5FUlJPUl9JTlZBTElEX0FNT1VOVCwgMCk7CiAgICAgICAgICAgIHJldHVybiBSZXN1bHRDb2RlLkVSUk9SX0lOVkFMSURfQU1PVU5UOwogICAgICAgIH0KICAgICAgICAKICAgICAgICB1aW50MjU2IHRvdGFsVmFsaWRBbW91bnQgPSBnZXRFYXJuaW5nQW1vdW50KCk7CiAgICAgICAgaWYgKF9hbW91bnQgPiB0b3RhbFZhbGlkQW1vdW50KSB7CiAgICAgICAgICAgIEV2ZW50V2l0aGRyYXdFdGhlcihfc2VuZFRvLCBSZXN1bHRDb2RlLkVSUk9SX0lOVkFMSURfQU1PVU5ULCAwKTsKICAgICAgICAgICAgcmV0dXJuIFJlc3VsdENvZGUuRVJST1JfSU5WQUxJRF9BTU9VTlQ7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIF9zZW5kVG8udHJhbnNmZXIoX2Ftb3VudCk7CiAgICAgICAgdG90YWxDYXNob3V0ICs9IF9hbW91bnQ7CiAgICAgICAgRXZlbnRXaXRoZHJhd0V0aGVyKF9zZW5kVG8sIFJlc3VsdENvZGUuU1VDQ0VTUywgX2Ftb3VudCk7CiAgICAgICAgcmV0dXJuIFJlc3VsdENvZGUuU1VDQ0VTUzsKICAgIH0KCiAgICAvLyBjb252ZW5pZW50IHRvb2wgdG8gYWRkIG1vbnN0ZXIKICAgIGZ1bmN0aW9uIGFkZE1vbnN0ZXJDbGFzc0Jhc2ljKHVpbnQzMiBfY2xhc3NJZCwgdWludDggX3R5cGUsIHVpbnQyNTYgX3ByaWNlLCB1aW50MjU2IF9yZXR1cm5QcmljZSwKICAgICAgICB1aW50OCBfc3MxLCB1aW50OCBfc3MyLCB1aW50OCBfc3MzLCB1aW50OCBfc3M0LCB1aW50OCBfc3M1LCB1aW50OCBfc3M2KSBvbmx5TW9kZXJhdG9ycyBleHRlcm5hbCB7CiAgICAgICAgCiAgICAgICAgRXRoZXJlbW9uRGF0YUJhc2UgZGF0YSA9IEV0aGVyZW1vbkRhdGFCYXNlKGRhdGFDb250cmFjdCk7CiAgICAgICAgTW9uc3RlckNsYXNzQWNjIG1lbW9yeSBjbGFzczsKICAgICAgICAoY2xhc3MuY2xhc3NJZCwgY2xhc3MucHJpY2UsIGNsYXNzLnJldHVyblByaWNlLCBjbGFzcy50b3RhbCwgY2xhc3MuY2F0Y2hhYmxlKSA9IGRhdGEuZ2V0TW9uc3RlckNsYXNzKF9jbGFzc0lkKTsKICAgICAgICAvLyBjYW4gYWRkIG9ubHkgb25lIHRpbWUKICAgICAgICBpZiAoX2NsYXNzSWQgPT0gMCB8fCBjbGFzcy5jbGFzc0lkID09IF9jbGFzc0lkKQogICAgICAgICAgICByZXZlcnQoKTsKCiAgICAgICAgZGF0YS5zZXRNb25zdGVyQ2xhc3MoX2NsYXNzSWQsIF9wcmljZSwgX3JldHVyblByaWNlLCB0cnVlKTsKICAgICAgICBkYXRhLmFkZEVsZW1lbnRUb0FycmF5VHlwZShBcnJheVR5cGUuQ0xBU1NfVFlQRSwgdWludDY0KF9jbGFzc0lkKSwgX3R5cGUpOwogICAgICAgIAogICAgICAgIC8vIGFkZCBzdGF0IHN0ZXAKICAgICAgICBkYXRhLmFkZEVsZW1lbnRUb0FycmF5VHlwZShBcnJheVR5cGUuU1RBVF9TVEFSVCwgdWludDY0KF9jbGFzc0lkKSwgX3NzMSk7CiAgICAgICAgZGF0YS5hZGRFbGVtZW50VG9BcnJheVR5cGUoQXJyYXlUeXBlLlNUQVRfU1RBUlQsIHVpbnQ2NChfY2xhc3NJZCksIF9zczIpOwogICAgICAgIGRhdGEuYWRkRWxlbWVudFRvQXJyYXlUeXBlKEFycmF5VHlwZS5TVEFUX1NUQVJULCB1aW50NjQoX2NsYXNzSWQpLCBfc3MzKTsKICAgICAgICBkYXRhLmFkZEVsZW1lbnRUb0FycmF5VHlwZShBcnJheVR5cGUuU1RBVF9TVEFSVCwgdWludDY0KF9jbGFzc0lkKSwgX3NzNCk7CiAgICAgICAgZGF0YS5hZGRFbGVtZW50VG9BcnJheVR5cGUoQXJyYXlUeXBlLlNUQVRfU1RBUlQsIHVpbnQ2NChfY2xhc3NJZCksIF9zczUpOwogICAgICAgIGRhdGEuYWRkRWxlbWVudFRvQXJyYXlUeXBlKEFycmF5VHlwZS5TVEFUX1NUQVJULCB1aW50NjQoX2NsYXNzSWQpLCBfc3M2KTsKICAgICAgICAKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYWRkTW9uc3RlckNsYXNzRXh0ZW5kKHVpbnQzMiBfY2xhc3NJZCwgdWludDggX3R5cGUyLCB1aW50OCBfdHlwZTMsIAogICAgICAgIHVpbnQ4IF9zdDEsIHVpbnQ4IF9zdDIsIHVpbnQ4IF9zdDMsIHVpbnQ4IF9zdDQsIHVpbnQ4IF9zdDUsIHVpbnQ4IF9zdDYgKSBvbmx5TW9kZXJhdG9ycyBleHRlcm5hbCB7CgogICAgICAgIEV0aGVyZW1vbkRhdGFCYXNlIGRhdGEgPSBFdGhlcmVtb25EYXRhQmFzZShkYXRhQ29udHJhY3QpOwogICAgICAgIGlmIChfY2xhc3NJZCA9PSAwIHx8IGRhdGEuZ2V0U2l6ZUFycmF5VHlwZShBcnJheVR5cGUuU1RBVF9TVEVQLCB1aW50NjQoX2NsYXNzSWQpKSA+IDApCiAgICAgICAgICAgIHJldmVydCgpOwoKICAgICAgICBpZiAoX3R5cGUyID4gMCkgewogICAgICAgICAgICBkYXRhLmFkZEVsZW1lbnRUb0FycmF5VHlwZShBcnJheVR5cGUuQ0xBU1NfVFlQRSwgdWludDY0KF9jbGFzc0lkKSwgX3R5cGUyKTsKICAgICAgICB9CiAgICAgICAgaWYgKF90eXBlMyA+IDApIHsKICAgICAgICAgICAgZGF0YS5hZGRFbGVtZW50VG9BcnJheVR5cGUoQXJyYXlUeXBlLkNMQVNTX1RZUEUsIHVpbnQ2NChfY2xhc3NJZCksIF90eXBlMyk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIGFkZCBzdGF0IGJhc2UKICAgICAgICBkYXRhLmFkZEVsZW1lbnRUb0FycmF5VHlwZShBcnJheVR5cGUuU1RBVF9TVEVQLCB1aW50NjQoX2NsYXNzSWQpLCBfc3QxKTsKICAgICAgICBkYXRhLmFkZEVsZW1lbnRUb0FycmF5VHlwZShBcnJheVR5cGUuU1RBVF9TVEVQLCB1aW50NjQoX2NsYXNzSWQpLCBfc3QyKTsKICAgICAgICBkYXRhLmFkZEVsZW1lbnRUb0FycmF5VHlwZShBcnJheVR5cGUuU1RBVF9TVEVQLCB1aW50NjQoX2NsYXNzSWQpLCBfc3QzKTsKICAgICAgICBkYXRhLmFkZEVsZW1lbnRUb0FycmF5VHlwZShBcnJheVR5cGUuU1RBVF9TVEVQLCB1aW50NjQoX2NsYXNzSWQpLCBfc3Q0KTsKICAgICAgICBkYXRhLmFkZEVsZW1lbnRUb0FycmF5VHlwZShBcnJheVR5cGUuU1RBVF9TVEVQLCB1aW50NjQoX2NsYXNzSWQpLCBfc3Q1KTsKICAgICAgICBkYXRhLmFkZEVsZW1lbnRUb0FycmF5VHlwZShBcnJheVR5cGUuU1RBVF9TVEVQLCB1aW50NjQoX2NsYXNzSWQpLCBfc3Q2KTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gc2V0Q2F0Y2hhYmxlKHVpbnQzMiBfY2xhc3NJZCwgYm9vbCBjYXRjaGFibGUpIG9ubHlNb2RlcmF0b3JzIGV4dGVybmFsIHsKICAgICAgICAvLyBjYW4gbm90IGVkaXQgZ2VuIDAgLSBjYW4gbm90IGNhdGNoIGZvcmV2ZXIKICAgICAgICBHZW4wQ29uZmlnIHN0b3JhZ2UgZ2VuMCA9IGdlbjBDb25maWdbX2NsYXNzSWRdOwogICAgICAgIGlmIChnZW4wLmNsYXNzSWQgPT0gX2NsYXNzSWQpCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIAogICAgICAgIEV0aGVyZW1vbkRhdGFCYXNlIGRhdGEgPSBFdGhlcmVtb25EYXRhQmFzZShkYXRhQ29udHJhY3QpOwogICAgICAgIE1vbnN0ZXJDbGFzc0FjYyBtZW1vcnkgY2xhc3M7CiAgICAgICAgKGNsYXNzLmNsYXNzSWQsIGNsYXNzLnByaWNlLCBjbGFzcy5yZXR1cm5QcmljZSwgY2xhc3MudG90YWwsIGNsYXNzLmNhdGNoYWJsZSkgPSBkYXRhLmdldE1vbnN0ZXJDbGFzcyhfY2xhc3NJZCk7CiAgICAgICAgZGF0YS5zZXRNb25zdGVyQ2xhc3MoY2xhc3MuY2xhc3NJZCwgY2xhc3MucHJpY2UsIGNsYXNzLnJldHVyblByaWNlLCBjYXRjaGFibGUpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBzZXRQcmljZUluY3JlYXNpbmdSYXRpbyh1aW50MTYgX3JhdGlvKSBvbmx5TW9kZXJhdG9ycyBleHRlcm5hbCB7CiAgICAgICAgcHJpY2VJbmNyZWFzaW5nUmF0aW8gPSBfcmF0aW87CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHNldEdhc29uKHVpbnQzMiBfY2xhc3NJZCwgYm9vbCBfaXNHYXNvbikgb25seU1vZGVyYXRvcnMgZXh0ZXJuYWwgewogICAgICAgIEdlblhQcm9wZXJ0eSBzdG9yYWdlIHBybyA9IGdlbnhQcm9wZXJ0eVtfY2xhc3NJZF07CiAgICAgICAgcHJvLmlzR2Fzb24gPSBfaXNHYXNvbjsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYWRkQ2xhc3NQcm9wZXJ0eSh1aW50MzIgX2NsYXNzSWQsIFByb3BlcnR5VHlwZSBfdHlwZSwgdWludDMyIHZhbHVlKSBvbmx5TW9kZXJhdG9ycyBleHRlcm5hbCB7CiAgICAgICAgR2VuWFByb3BlcnR5IHN0b3JhZ2UgcHJvID0gZ2VueFByb3BlcnR5W19jbGFzc0lkXTsKICAgICAgICBwcm8uY2xhc3NJZCA9IF9jbGFzc0lkOwogICAgICAgIGlmIChfdHlwZSA9PSBQcm9wZXJ0eVR5cGUuQU5DRVNUT1IpIHsKICAgICAgICAgICAgcHJvLmFuY2VzdG9ycy5wdXNoKHZhbHVlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwcm8ueGZhY3RvcnMucHVzaCh2YWx1ZSk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLyBnYXRlIHdheSAKICAgIGZ1bmN0aW9uIGluY3JlYXNlTW9uc3RlckV4cCh1aW50NjQgX29iaklkLCB1aW50MzIgYW1vdW50KSBvbmx5TW9kZXJhdG9ycyBwdWJsaWMgewogICAgICAgIEV0aGVyZW1vbkRhdGFCYXNlIGRhdGEgPSBFdGhlcmVtb25EYXRhQmFzZShkYXRhQ29udHJhY3QpOwogICAgICAgIGRhdGEuaW5jcmVhc2VNb25zdGVyRXhwKF9vYmpJZCwgYW1vdW50KTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZGVjcmVhc2VNb25zdGVyRXhwKHVpbnQ2NCBfb2JqSWQsIHVpbnQzMiBhbW91bnQpIG9ubHlNb2RlcmF0b3JzIHB1YmxpYyB7CiAgICAgICAgRXRoZXJlbW9uRGF0YUJhc2UgZGF0YSA9IEV0aGVyZW1vbkRhdGFCYXNlKGRhdGFDb250cmFjdCk7CiAgICAgICAgZGF0YS5kZWNyZWFzZU1vbnN0ZXJFeHAoX29iaklkLCBhbW91bnQpOwogICAgfQogICAgCiAgICAvLyBoZWxwZXIKICAgIGZ1bmN0aW9uIGdldFJhbmRvbSh1aW50OCBtYXhSYW4sIHVpbnQ4IGluZGV4LCBhZGRyZXNzIHByaUFkZHJlc3MpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQ4KSB7CiAgICAgICAgdWludDI1NiBnZW5OdW0gPSB1aW50MjU2KGJsb2NrLmJsb2NraGFzaChibG9jay5udW1iZXItMSkpICsgdWludDI1NihwcmlBZGRyZXNzKTsKICAgICAgICBmb3IgKHVpbnQ4IGkgPSAwOyBpIDwgaW5kZXggJiYgaSA8IDY7IGkgKyspIHsKICAgICAgICAgICAgZ2VuTnVtIC89IDI1NjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHVpbnQ4KGdlbk51bSAlIG1heFJhbik7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uICgpIHBheWFibGUgcHVibGljIHsKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBFVEhFUkVNT05fUFJPQ0VTU09SKQogICAgICAgICAgICByZXZlcnQoKTsKICAgIH0KICAgIAogICAgLy8gcHVibGljCiAgICAKICAgIGZ1bmN0aW9uIGlzR2Fzb24odWludDY0IF9vYmpJZCkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyhib29sKSB7CiAgICAgICAgRXRoZXJlbW9uRGF0YUJhc2UgZGF0YSA9IEV0aGVyZW1vbkRhdGFCYXNlKGRhdGFDb250cmFjdCk7CiAgICAgICAgTW9uc3Rlck9iakFjYyBtZW1vcnkgb2JqOwogICAgICAgIChvYmoubW9uc3RlcklkLCBvYmouY2xhc3NJZCwgb2JqLnRyYWluZXIsIG9iai5leHAsIG9iai5jcmVhdGVJbmRleCwgb2JqLmxhc3RDbGFpbUluZGV4LCBvYmouY3JlYXRlVGltZSkgPSBkYXRhLmdldE1vbnN0ZXJPYmooX29iaklkKTsKICAgICAgICBHZW5YUHJvcGVydHkgc3RvcmFnZSBwcm8gPSBnZW54UHJvcGVydHlbb2JqLmNsYXNzSWRdOwogICAgICAgIHJldHVybiBwcm8uaXNHYXNvbjsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0T2JqSW5kZXgodWludDY0IF9vYmpJZCkgY29uc3RhbnQgcHVibGljIHJldHVybnModWludDMyIGNsYXNzSWQsIHVpbnQzMiBjcmVhdGVJbmRleCwgdWludDMyIGxhc3RDbGFpbUluZGV4KSB7CiAgICAgICAgRXRoZXJlbW9uRGF0YUJhc2UgZGF0YSA9IEV0aGVyZW1vbkRhdGFCYXNlKGRhdGFDb250cmFjdCk7CiAgICAgICAgTW9uc3Rlck9iakFjYyBtZW1vcnkgb2JqOwogICAgICAgIChvYmoubW9uc3RlcklkLCBvYmouY2xhc3NJZCwgb2JqLnRyYWluZXIsIG9iai5leHAsIG9iai5jcmVhdGVJbmRleCwgb2JqLmxhc3RDbGFpbUluZGV4LCBvYmouY3JlYXRlVGltZSkgPSBkYXRhLmdldE1vbnN0ZXJPYmooX29iaklkKTsKICAgICAgICByZXR1cm4gKG9iai5jbGFzc0lkLCBvYmouY3JlYXRlSW5kZXgsIG9iai5sYXN0Q2xhaW1JbmRleCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldE9iakJhdHRsZUluZm8odWludDY0IF9vYmpJZCkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyh1aW50MzIgY2xhc3NJZCwgdWludDMyIGV4cCwgYm9vbCBpc0dhc29uLCAKICAgICAgICB1aW50IGFuY2VzdG9yTGVuZ3RoLCB1aW50IHhmYWN0b3JzTGVuZ3RoKSB7CiAgICAgICAgRXRoZXJlbW9uRGF0YUJhc2UgZGF0YSA9IEV0aGVyZW1vbkRhdGFCYXNlKGRhdGFDb250cmFjdCk7CiAgICAgICAgTW9uc3Rlck9iakFjYyBtZW1vcnkgb2JqOwogICAgICAgIChvYmoubW9uc3RlcklkLCBvYmouY2xhc3NJZCwgb2JqLnRyYWluZXIsIG9iai5leHAsIG9iai5jcmVhdGVJbmRleCwgb2JqLmxhc3RDbGFpbUluZGV4LCBvYmouY3JlYXRlVGltZSkgPSBkYXRhLmdldE1vbnN0ZXJPYmooX29iaklkKTsKICAgICAgICBHZW5YUHJvcGVydHkgc3RvcmFnZSBwcm8gPSBnZW54UHJvcGVydHlbb2JqLmNsYXNzSWRdOwogICAgICAgIHJldHVybiAob2JqLmNsYXNzSWQsIG9iai5leHAsIHByby5pc0dhc29uLCBwcm8uYW5jZXN0b3JzLmxlbmd0aCwgcHJvLnhmYWN0b3JzLmxlbmd0aCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldENsYXNzUHJvcGVydHlTaXplKHVpbnQzMiBfY2xhc3NJZCwgUHJvcGVydHlUeXBlIF90eXBlKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zKHVpbnQpIHsKICAgICAgICBpZiAoX3R5cGUgPT0gUHJvcGVydHlUeXBlLkFOQ0VTVE9SKSAKICAgICAgICAgICAgcmV0dXJuIGdlbnhQcm9wZXJ0eVtfY2xhc3NJZF0uYW5jZXN0b3JzLmxlbmd0aDsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiBnZW54UHJvcGVydHlbX2NsYXNzSWRdLnhmYWN0b3JzLmxlbmd0aDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0Q2xhc3NQcm9wZXJ0eVZhbHVlKHVpbnQzMiBfY2xhc3NJZCwgUHJvcGVydHlUeXBlIF90eXBlLCB1aW50IGluZGV4KSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zKHVpbnQzMikgewogICAgICAgIGlmIChfdHlwZSA9PSBQcm9wZXJ0eVR5cGUuQU5DRVNUT1IpCiAgICAgICAgICAgIHJldHVybiBnZW54UHJvcGVydHlbX2NsYXNzSWRdLmFuY2VzdG9yc1tpbmRleF07CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gZ2VueFByb3BlcnR5W19jbGFzc0lkXS54ZmFjdG9yc1tpbmRleF07CiAgICB9CiAgICAKICAgIC8vIG9ubHkgZ2VuIDAKICAgIGZ1bmN0aW9uIGdldEdlbjBDT25maWcodWludDMyIF9jbGFzc0lkKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50MzIsIHVpbnQyNTYsIHVpbnQzMikgewogICAgICAgIEdlbjBDb25maWcgc3RvcmFnZSBnZW4wID0gZ2VuMENvbmZpZ1tfY2xhc3NJZF07CiAgICAgICAgcmV0dXJuIChnZW4wLmNsYXNzSWQsIGdlbjAub3JpZ2luYWxQcmljZSwgZ2VuMC50b3RhbCk7CiAgICB9CiAgICAKICAgIC8vIG9ubHkgZ2VuIDAKICAgIGZ1bmN0aW9uIGdldFJldHVybkZyb21Nb25zdGVyKHVpbnQ2NCBfb2JqSWQpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQyNTYgY3VycmVudCwgdWludDI1NiB0b3RhbCkgewogICAgICAgIC8qCiAgICAgICAgMS4gR2VuIDAgY2FuIG5vdCBiZSBjYXVnaHQgYW55bW9yZS4KICAgICAgICAyLiBFZ2cgd2lsbCBub3QgZ2l2ZSByZXR1cm4uCiAgICAgICAgKi8KICAgICAgICAKICAgICAgICB1aW50MzIgY2xhc3NJZCA9IDA7CiAgICAgICAgdWludDMyIGNyZWF0ZUluZGV4ID0gMDsKICAgICAgICB1aW50MzIgbGFzdENsYWltSW5kZXggPSAwOwogICAgICAgIChjbGFzc0lkLCBjcmVhdGVJbmRleCwgbGFzdENsYWltSW5kZXgpID0gZ2V0T2JqSW5kZXgoX29iaklkKTsKICAgICAgICBHZW4wQ29uZmlnIHN0b3JhZ2UgZ2VuMCA9IGdlbjBDb25maWdbY2xhc3NJZF07CiAgICAgICAgaWYgKGdlbjAuY2xhc3NJZCAhPSBjbGFzc0lkKSB7CiAgICAgICAgICAgIHJldHVybiAoMCwgMCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHVpbnQzMiBjdXJyZW50R2FwID0gMDsKICAgICAgICB1aW50MzIgdG90YWxHYXAgPSAwOwogICAgICAgIGlmIChsYXN0Q2xhaW1JbmRleCA8IGdlbjAudG90YWwpCiAgICAgICAgICAgIGN1cnJlbnRHYXAgPSBnZW4wLnRvdGFsIC0gbGFzdENsYWltSW5kZXg7CiAgICAgICAgaWYgKGNyZWF0ZUluZGV4IDwgZ2VuMC50b3RhbCkKICAgICAgICAgICAgdG90YWxHYXAgPSBnZW4wLnRvdGFsIC0gY3JlYXRlSW5kZXg7CiAgICAgICAgcmV0dXJuIChzYWZlTXVsdChjdXJyZW50R2FwLCBnZW4wLnJldHVyblByaWNlKSwgc2FmZU11bHQodG90YWxHYXAsIGdlbjAucmV0dXJuUHJpY2UpKTsKICAgIH0KICAgIAogICAgLy8gd3JpdGUgYWNjZXNzCiAgICAKICAgIGZ1bmN0aW9uIG1vdmVEYXRhQ29udHJhY3RCYWxhbmNlVG9Xb3JsZCgpIGV4dGVybmFsIHsKICAgICAgICBFdGhlcmVtb25EYXRhQmFzZSBkYXRhID0gRXRoZXJlbW9uRGF0YUJhc2UoZGF0YUNvbnRyYWN0KTsKICAgICAgICBkYXRhLndpdGhkcmF3RXRoZXIoYWRkcmVzcyh0aGlzKSwgZGF0YS5iYWxhbmNlKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gcmVuYW1lTW9uc3Rlcih1aW50NjQgX29iaklkLCBzdHJpbmcgbmFtZSkgaXNBY3RpdmUgZXh0ZXJuYWwgewogICAgICAgIEV0aGVyZW1vbkRhdGFCYXNlIGRhdGEgPSBFdGhlcmVtb25EYXRhQmFzZShkYXRhQ29udHJhY3QpOwogICAgICAgIE1vbnN0ZXJPYmpBY2MgbWVtb3J5IG9iajsKICAgICAgICAob2JqLm1vbnN0ZXJJZCwgb2JqLmNsYXNzSWQsIG9iai50cmFpbmVyLCBvYmouZXhwLCBvYmouY3JlYXRlSW5kZXgsIG9iai5sYXN0Q2xhaW1JbmRleCwgb2JqLmNyZWF0ZVRpbWUpID0gZGF0YS5nZXRNb25zdGVyT2JqKF9vYmpJZCk7CiAgICAgICAgaWYgKG9iai5tb25zdGVySWQgIT0gX29iaklkIHx8IG9iai50cmFpbmVyICE9IG1zZy5zZW5kZXIpIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQogICAgICAgIGRhdGEuc2V0TW9uc3Rlck9iaihfb2JqSWQsIG5hbWUsIG9iai5leHAsIG9iai5jcmVhdGVJbmRleCwgb2JqLmxhc3RDbGFpbUluZGV4KTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gY2F0Y2hNb25zdGVyKHVpbnQzMiBfY2xhc3NJZCwgc3RyaW5nIF9uYW1lKSBpc0FjdGl2ZSBleHRlcm5hbCBwYXlhYmxlIHsKICAgICAgICBFdGhlcmVtb25EYXRhQmFzZSBkYXRhID0gRXRoZXJlbW9uRGF0YUJhc2UoZGF0YUNvbnRyYWN0KTsKICAgICAgICBNb25zdGVyQ2xhc3NBY2MgbWVtb3J5IGNsYXNzOwogICAgICAgIChjbGFzcy5jbGFzc0lkLCBjbGFzcy5wcmljZSwgY2xhc3MucmV0dXJuUHJpY2UsIGNsYXNzLnRvdGFsLCBjbGFzcy5jYXRjaGFibGUpID0gZGF0YS5nZXRNb25zdGVyQ2xhc3MoX2NsYXNzSWQpOwogICAgICAgIAogICAgICAgIGlmIChjbGFzcy5jbGFzc0lkID09IDAgfHwgY2xhc3MuY2F0Y2hhYmxlID09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBjYW4gbm90IGtlZXAgdG9vIG11Y2ggZXRoZXJlbW9uIAogICAgICAgIGlmIChkYXRhLmdldE1vbnN0ZXJEZXhTaXplKG1zZy5zZW5kZXIpID4gbWF4RGV4U2l6ZSkKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgCiAgICAgICAgdWludDI1NiB0b3RhbEJhbGFuY2UgPSBzYWZlQWRkKG1zZy52YWx1ZSwgZGF0YS5nZXRFeHRyYUJhbGFuY2UobXNnLnNlbmRlcikpOwogICAgICAgIHVpbnQyNTYgcGF5UHJpY2UgPSBjbGFzcy5wcmljZTsKICAgICAgICAvLyBpbmNyZWFzZSBwcmljZSBmb3IgZWFjaCBldGhlcmVtb24gY3JlYXRlZAogICAgICAgIGlmIChjbGFzcy50b3RhbCA+IDApCiAgICAgICAgICAgIHBheVByaWNlICs9IGNsYXNzLnByaWNlKihjbGFzcy50b3RhbC0xKS9wcmljZUluY3JlYXNpbmdSYXRpbzsKICAgICAgICBpZiAocGF5UHJpY2UgPiB0b3RhbEJhbGFuY2UpIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQogICAgICAgIHRvdGFsRWFybiArPSBwYXlQcmljZTsKICAgICAgICAKICAgICAgICAvLyBkZWR1Y3QgdGhlIGJhbGFuY2UKICAgICAgICBkYXRhLnNldEV4dHJhQmFsYW5jZShtc2cuc2VuZGVyLCBzYWZlU3VidHJhY3QodG90YWxCYWxhbmNlLCBwYXlQcmljZSkpOwogICAgICAgIAogICAgICAgIC8vIGFkZCBtb25zdGVyCiAgICAgICAgdWludDY0IG9iaklkID0gZGF0YS5hZGRNb25zdGVyT2JqKF9jbGFzc0lkLCBtc2cuc2VuZGVyLCBfbmFtZSk7CiAgICAgICAgLy8gZ2VuZXJhdGUgYmFzZSBzdGF0IGZvciB0aGUgcHJldmlvdXMgb25lCiAgICAgICAgZm9yICh1aW50IGk9MDsgaSA8IFNUQVRfQ09VTlQ7IGkrPSAxKSB7CiAgICAgICAgICAgIHVpbnQ4IHZhbHVlID0gZ2V0UmFuZG9tKFNUQVRfTUFYLCB1aW50OChpKSwgbGFzdEh1bnRlcikgKyBkYXRhLmdldEVsZW1lbnRJbkFycmF5VHlwZShBcnJheVR5cGUuU1RBVF9TVEFSVCwgdWludDY0KF9jbGFzc0lkKSwgaSk7CiAgICAgICAgICAgIGRhdGEuYWRkRWxlbWVudFRvQXJyYXlUeXBlKEFycmF5VHlwZS5TVEFUX0JBU0UsIG9iaklkLCB2YWx1ZSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGxhc3RIdW50ZXIgPSBtc2cuc2VuZGVyOwogICAgICAgIEV2ZW50Q2F0Y2hNb25zdGVyKG1zZy5zZW5kZXIsIG9iaklkKTsKICAgIH0KCgogICAgZnVuY3Rpb24gY2FzaE91dCh1aW50MjU2IF9hbW91bnQpIHB1YmxpYyByZXR1cm5zKFJlc3VsdENvZGUpIHsKICAgICAgICBFdGhlcmVtb25EYXRhQmFzZSBkYXRhID0gRXRoZXJlbW9uRGF0YUJhc2UoZGF0YUNvbnRyYWN0KTsKICAgICAgICAKICAgICAgICB1aW50MjU2IHRvdGFsQW1vdW50ID0gZGF0YS5nZXRFeHRyYUJhbGFuY2UobXNnLnNlbmRlcik7CiAgICAgICAgdWludDY0IG9iaklkID0gMDsKCiAgICAgICAgLy8gY29sbGVjdCBnZW4gMCByZXR1cm4gcHJpY2UgCiAgICAgICAgdWludCBkZXhTaXplID0gZGF0YS5nZXRNb25zdGVyRGV4U2l6ZShtc2cuc2VuZGVyKTsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBkZXhTaXplOyBpKyspIHsKICAgICAgICAgICAgb2JqSWQgPSBkYXRhLmdldE1vbnN0ZXJPYmpJZChtc2cuc2VuZGVyLCBpKTsKICAgICAgICAgICAgaWYgKG9iaklkID4gMCkgewogICAgICAgICAgICAgICAgTW9uc3Rlck9iakFjYyBtZW1vcnkgb2JqOwogICAgICAgICAgICAgICAgKG9iai5tb25zdGVySWQsIG9iai5jbGFzc0lkLCBvYmoudHJhaW5lciwgb2JqLmV4cCwgb2JqLmNyZWF0ZUluZGV4LCBvYmoubGFzdENsYWltSW5kZXgsIG9iai5jcmVhdGVUaW1lKSA9IGRhdGEuZ2V0TW9uc3Rlck9iaihvYmpJZCk7CiAgICAgICAgICAgICAgICBHZW4wQ29uZmlnIHN0b3JhZ2UgZ2VuMCA9IGdlbjBDb25maWdbb2JqLmNsYXNzSWRdOwogICAgICAgICAgICAgICAgaWYgKGdlbjAuY2xhc3NJZCA9PSBvYmouY2xhc3NJZCkgewogICAgICAgICAgICAgICAgICAgIGlmIChvYmoubGFzdENsYWltSW5kZXggPCBnZW4wLnRvdGFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMiBnYXAgPSB1aW50MzIoc2FmZVN1YnRyYWN0KGdlbjAudG90YWwsIG9iai5sYXN0Q2xhaW1JbmRleCkpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ2FwID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBbW91bnQgKz0gc2FmZU11bHQoZ2FwLCBnZW4wLnJldHVyblByaWNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlc2V0IHRvdGFsIChleGNlcHQgbmFtZSBpcyBjbGVhcmVkIDooICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuc2V0TW9uc3Rlck9iaihvYmoubW9uc3RlcklkLCAiIG5hbWUgbWUgIiwgb2JqLmV4cCwgb2JqLmNyZWF0ZUluZGV4LCBnZW4wLnRvdGFsKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBkZWZhdWx0IHRvIGNhc2ggb3V0IGFsbAogICAgICAgIGlmIChfYW1vdW50ID09IDApIHsKICAgICAgICAgICAgX2Ftb3VudCA9IHRvdGFsQW1vdW50OwogICAgICAgIH0KICAgICAgICBpZiAoX2Ftb3VudCA+IHRvdGFsQW1vdW50KSB7CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBjaGVjayBjb250cmFjdCBoYXMgZW5vdWdoIG1vbmV5CiAgICAgICAgaWYgKHRoaXMuYmFsYW5jZSArIGRhdGEuYmFsYW5jZSA8IF9hbW91bnQpewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9IGVsc2UgaWYgKHRoaXMuYmFsYW5jZSA8IF9hbW91bnQpIHsKICAgICAgICAgICAgZGF0YS53aXRoZHJhd0V0aGVyKGFkZHJlc3ModGhpcyksIGRhdGEuYmFsYW5jZSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmIChfYW1vdW50ID4gMCkgewogICAgICAgICAgICBkYXRhLnNldEV4dHJhQmFsYW5jZShtc2cuc2VuZGVyLCB0b3RhbEFtb3VudCAtIF9hbW91bnQpOwogICAgICAgICAgICBpZiAoIW1zZy5zZW5kZXIuc2VuZChfYW1vdW50KSkgewogICAgICAgICAgICAgICAgZGF0YS5zZXRFeHRyYUJhbGFuY2UobXNnLnNlbmRlciwgdG90YWxBbW91bnQpOwogICAgICAgICAgICAgICAgRXZlbnRDYXNoT3V0KG1zZy5zZW5kZXIsIFJlc3VsdENvZGUuRVJST1JfU0VORF9GQUlMLCAwKTsKICAgICAgICAgICAgICAgIHJldHVybiBSZXN1bHRDb2RlLkVSUk9SX1NFTkRfRkFJTDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBFdmVudENhc2hPdXQobXNnLnNlbmRlciwgUmVzdWx0Q29kZS5TVUNDRVNTLCBfYW1vdW50KTsKICAgICAgICByZXR1cm4gUmVzdWx0Q29kZS5TVUNDRVNTOwogICAgfQogICAgCiAgICAvLyByZWFkIGFjY2VzcwogICAgCiAgICBmdW5jdGlvbiBnZXRUcmFpbmVyRWFybihhZGRyZXNzIF90cmFpbmVyKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgICAgRXRoZXJlbW9uRGF0YUJhc2UgZGF0YSA9IEV0aGVyZW1vbkRhdGFCYXNlKGRhdGFDb250cmFjdCk7CiAgICAgICAgdWludDI1NiByZXR1cm5Gcm9tTW9uc3RlciA9IDA7CiAgICAgICAgLy8gY29sbGVjdCBnZW4gMCByZXR1cm4gcHJpY2UgCiAgICAgICAgdWludDI1NiBnZW4wY3VycmVudCA9IDA7CiAgICAgICAgdWludDI1NiBnZW4wdG90YWwgPSAwOwogICAgICAgIHVpbnQ2NCBvYmpJZCA9IDA7CiAgICAgICAgdWludCBkZXhTaXplID0gZGF0YS5nZXRNb25zdGVyRGV4U2l6ZShfdHJhaW5lcik7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgZGV4U2l6ZTsgaSsrKSB7CiAgICAgICAgICAgIG9iaklkID0gZGF0YS5nZXRNb25zdGVyT2JqSWQoX3RyYWluZXIsIGkpOwogICAgICAgICAgICBpZiAob2JqSWQgPiAwKSB7CiAgICAgICAgICAgICAgICAoZ2VuMGN1cnJlbnQsIGdlbjB0b3RhbCkgPSBnZXRSZXR1cm5Gcm9tTW9uc3RlcihvYmpJZCk7CiAgICAgICAgICAgICAgICByZXR1cm5Gcm9tTW9uc3RlciArPSBnZW4wY3VycmVudDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gcmV0dXJuRnJvbU1vbnN0ZXI7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldFRyYWluZXJCYWxhbmNlKGFkZHJlc3MgX3RyYWluZXIpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnModWludDI1NikgewogICAgICAgIEV0aGVyZW1vbkRhdGFCYXNlIGRhdGEgPSBFdGhlcmVtb25EYXRhQmFzZShkYXRhQ29udHJhY3QpOwogICAgICAgIAogICAgICAgIHVpbnQyNTYgdXNlckV4dHJhQmFsYW5jZSA9IGRhdGEuZ2V0RXh0cmFCYWxhbmNlKF90cmFpbmVyKTsKICAgICAgICB1aW50MjU2IHJldHVybkZyb21Nb25zdGVyID0gZ2V0VHJhaW5lckVhcm4oX3RyYWluZXIpOwoKICAgICAgICByZXR1cm4gKHVzZXJFeHRyYUJhbGFuY2UgKyByZXR1cm5Gcm9tTW9uc3Rlcik7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldE1vbnN0ZXJDbGFzc0Jhc2ljKHVpbnQzMiBfY2xhc3NJZCkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyh1aW50MjU2LCB1aW50MjU2LCB1aW50MjU2LCBib29sKSB7CiAgICAgICAgRXRoZXJlbW9uRGF0YUJhc2UgZGF0YSA9IEV0aGVyZW1vbkRhdGFCYXNlKGRhdGFDb250cmFjdCk7CiAgICAgICAgTW9uc3RlckNsYXNzQWNjIG1lbW9yeSBjbGFzczsKICAgICAgICAoY2xhc3MuY2xhc3NJZCwgY2xhc3MucHJpY2UsIGNsYXNzLnJldHVyblByaWNlLCBjbGFzcy50b3RhbCwgY2xhc3MuY2F0Y2hhYmxlKSA9IGRhdGEuZ2V0TW9uc3RlckNsYXNzKF9jbGFzc0lkKTsKICAgICAgICByZXR1cm4gKGNsYXNzLnByaWNlLCBjbGFzcy5yZXR1cm5QcmljZSwgY2xhc3MudG90YWwsIGNsYXNzLmNhdGNoYWJsZSk7CiAgICB9Cgp9'.
	

]
