Class {
	#name : #SRTb4007597da3402a1e2b69c8e1c6dd753d01a8035,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTb4007597da3402a1e2b69c8e1c6dd753d01a8035 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTc7CgovKgoKICogc291cmNlICAgICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9ibG9ja2JpdHNpby8KCiAqIEBuYW1lICAgICAgICBBcHBsaWNhdGlvbiBFbnRpdHkgR2VuZXJpYyBDb250cmFjdAogKiBAcGFja2FnZSAgICAgQmxvY2tCaXRzSU8KICogQGF1dGhvciAgICAgIE1pY2t5IFNvY2FjaSA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImUxOGM4ODgyOGE5OGExOGY4ZTk2OGQ4ODk3ODRjZjkzOGUiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+PgoKICAgIFVzZWQgZm9yIHRoZSBBQkkgaW50ZXJmYWNlIHdoZW4gYXNzZXRzIG5lZWQgdG8gY2FsbCBBcHBsaWNhdGlvbiBFbnRpdHkuCgogICAgVGhpcyBpcyByZXF1aXJlZCwgb3RoZXJ3aXNlIHdlIGVuZCB1cCBsb2FkaW5nIHRoZSBhc3NldHMgdGhlbXNlbHZlcyB3aGVuIHdlIGxvYWQgdGhlIEFwcGxpY2F0aW9uRW50aXR5IGNvbnRyYWN0CiAgICBhbmQgZW5kIHVwIGluIGEgbG9vcAoqLwoKCgpjb250cmFjdCBBcHBsaWNhdGlvbkVudGl0eUFCSSB7CgogICAgYWRkcmVzcyBwdWJsaWMgUHJvcG9zYWxzRW50aXR5OwogICAgYWRkcmVzcyBwdWJsaWMgRnVuZGluZ0VudGl0eTsKICAgIGFkZHJlc3MgcHVibGljIE1pbGVzdG9uZXNFbnRpdHk7CiAgICBhZGRyZXNzIHB1YmxpYyBNZWV0aW5nc0VudGl0eTsKICAgIGFkZHJlc3MgcHVibGljIEJvdW50eU1hbmFnZXJFbnRpdHk7CiAgICBhZGRyZXNzIHB1YmxpYyBUb2tlbk1hbmFnZXJFbnRpdHk7CiAgICBhZGRyZXNzIHB1YmxpYyBMaXN0aW5nQ29udHJhY3RFbnRpdHk7CiAgICBhZGRyZXNzIHB1YmxpYyBGdW5kaW5nTWFuYWdlckVudGl0eTsKICAgIGFkZHJlc3MgcHVibGljIE5ld3NDb250cmFjdEVudGl0eTsKCiAgICBib29sIHB1YmxpYyBfaW5pdGlhbGl6ZWQgPSBmYWxzZTsKICAgIGJvb2wgcHVibGljIF9sb2NrZWQgPSBmYWxzZTsKICAgIHVpbnQ4IHB1YmxpYyBDdXJyZW50RW50aXR5U3RhdGU7CiAgICB1aW50OCBwdWJsaWMgQXNzZXRDb2xsZWN0aW9uTnVtOwogICAgYWRkcmVzcyBwdWJsaWMgR2F0ZXdheUludGVyZmFjZUFkZHJlc3M7CiAgICBhZGRyZXNzIHB1YmxpYyBkZXBsb3llckFkZHJlc3M7CiAgICBhZGRyZXNzIHRlc3RBZGRyZXNzQWxsb3dVcGdyYWRlRnJvbTsKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gdWludDgpIHB1YmxpYyBFbnRpdHlTdGF0ZXM7CiAgICBtYXBwaW5nIChieXRlczMyID0+IGFkZHJlc3MpIHB1YmxpYyBBc3NldENvbGxlY3Rpb247CiAgICBtYXBwaW5nICh1aW50OCA9PiBieXRlczMyKSBwdWJsaWMgQXNzZXRDb2xsZWN0aW9uSWRUb05hbWU7CiAgICBtYXBwaW5nIChieXRlczMyID0+IHVpbnQyNTYpIHB1YmxpYyBCeWxhd3NVaW50MjU2OwogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiBieXRlczMyKSBwdWJsaWMgQnlsYXdzQnl0ZXMzMjsKCiAgICBmdW5jdGlvbiBBcHBsaWNhdGlvbkVudGl0eSgpIHB1YmxpYzsKICAgIGZ1bmN0aW9uIGdldEVudGl0eVN0YXRlKGJ5dGVzMzIgbmFtZSkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDgpOwogICAgZnVuY3Rpb24gbGlua1RvR2F0ZXdheSggYWRkcmVzcyBfR2F0ZXdheUludGVyZmFjZUFkZHJlc3MsIGJ5dGVzMzIgX3NvdXJjZUNvZGVVcmwgKSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIHNldFVwZ3JhZGVTdGF0ZSh1aW50OCBzdGF0ZSkgcHVibGljIDsKICAgIGZ1bmN0aW9uIGFkZEFzc2V0UHJvcG9zYWxzKGFkZHJlc3MgX2Fzc2V0QWRkcmVzc2VzKSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIGFkZEFzc2V0RnVuZGluZyhhZGRyZXNzIF9hc3NldEFkZHJlc3NlcykgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBhZGRBc3NldE1pbGVzdG9uZXMoYWRkcmVzcyBfYXNzZXRBZGRyZXNzZXMpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gYWRkQXNzZXRNZWV0aW5ncyhhZGRyZXNzIF9hc3NldEFkZHJlc3NlcykgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBhZGRBc3NldEJvdW50eU1hbmFnZXIoYWRkcmVzcyBfYXNzZXRBZGRyZXNzZXMpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gYWRkQXNzZXRUb2tlbk1hbmFnZXIoYWRkcmVzcyBfYXNzZXRBZGRyZXNzZXMpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gYWRkQXNzZXRGdW5kaW5nTWFuYWdlcihhZGRyZXNzIF9hc3NldEFkZHJlc3NlcykgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBhZGRBc3NldExpc3RpbmdDb250cmFjdChhZGRyZXNzIF9hc3NldEFkZHJlc3NlcykgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBhZGRBc3NldE5ld3NDb250cmFjdChhZGRyZXNzIF9hc3NldEFkZHJlc3NlcykgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBnZXRBc3NldEFkZHJlc3NCeU5hbWUoYnl0ZXMzMiBfbmFtZSkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcyk7CiAgICBmdW5jdGlvbiBzZXRCeWxhd1VpbnQyNTYoYnl0ZXMzMiBuYW1lLCB1aW50MjU2IHZhbHVlKSBwdWJsaWM7CiAgICBmdW5jdGlvbiBnZXRCeWxhd1VpbnQyNTYoYnl0ZXMzMiBuYW1lKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIHNldEJ5bGF3Qnl0ZXMzMihieXRlczMyIG5hbWUsIGJ5dGVzMzIgdmFsdWUpIHB1YmxpYzsKICAgIGZ1bmN0aW9uIGdldEJ5bGF3Qnl0ZXMzMihieXRlczMyIG5hbWUpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJ5dGVzMzIpOwogICAgZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIGV4dGVybmFsIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gZ2V0UGFyZW50QWRkcmVzcygpIGV4dGVybmFsIHZpZXcgcmV0dXJucyhhZGRyZXNzKTsKICAgIGZ1bmN0aW9uIGNyZWF0ZUNvZGVVcGdyYWRlUHJvcG9zYWwoIGFkZHJlc3MgX25ld0FkZHJlc3MsIGJ5dGVzMzIgX3NvdXJjZUNvZGVVcmwgKSBleHRlcm5hbCByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIGFjY2VwdENvZGVVcGdyYWRlUHJvcG9zYWwoYWRkcmVzcyBfbmV3QWRkcmVzcykgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBpbml0aWFsaXplQXNzZXRzVG9UaGlzQXBwbGljYXRpb24oKSBleHRlcm5hbCByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyQXNzZXRzVG9OZXdBcHBsaWNhdGlvbihhZGRyZXNzIF9uZXdBZGRyZXNzKSBleHRlcm5hbCByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGxvY2soKSBleHRlcm5hbCByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGNhbkluaXRpYXRlQ29kZVVwZ3JhZGUoYWRkcmVzcyBfc2VuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zKGJvb2wpOwogICAgZnVuY3Rpb24gZG9TdGF0ZUNoYW5nZXMoKSBwdWJsaWM7CiAgICBmdW5jdGlvbiBoYXNSZXF1aXJlZFN0YXRlQ2hhbmdlcygpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gYW55QXNzZXRIYXNDaGFuZ2VzKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBleHRlbmRlZEFueUFzc2V0SGFzQ2hhbmdlcygpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBnZXRSZXF1aXJlZFN0YXRlQ2hhbmdlcygpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQ4LCB1aW50OCk7CiAgICBmdW5jdGlvbiBnZXRUaW1lc3RhbXAoKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KTsKCn0KCi8qCgogKiBzb3VyY2UgICAgICAgaHR0cHM6Ly9naXRodWIuY29tL2Jsb2NrYml0c2lvLwoKICogQG5hbWUgICAgICAgIEFwcGxpY2F0aW9uIEFzc2V0IENvbnRyYWN0CiAqIEBwYWNrYWdlICAgICBCbG9ja0JpdHNJTwogKiBAYXV0aG9yICAgICAgTWlja3kgU29jYWNpIDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iNGEyNzIzMjkyMTMzMGEyNDI1M2QyNjIzM2MyZjY0MzgyNSI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+CgogQW55IGNvbnRyYWN0IGluaGVyaXRpbmcgdGhpcyB3aWxsIGJlIHVzYWJsZSBhcyBhbiBBc3NldCBpbiB0aGUgQXBwbGljYXRpb24gRW50aXR5CgoqLwoKCgoKY29udHJhY3QgQXBwbGljYXRpb25Bc3NldCB7CgogICAgZXZlbnQgRXZlbnRBcHBBc3NldE93bmVyU2V0KGJ5dGVzMzIgaW5kZXhlZCBfbmFtZSwgYWRkcmVzcyBpbmRleGVkIF9vd25lcik7CiAgICBldmVudCBFdmVudFJ1bkJlZm9yZUluaXQoYnl0ZXMzMiBpbmRleGVkIF9uYW1lKTsKICAgIGV2ZW50IEV2ZW50UnVuQmVmb3JlQXBwbHlpbmdTZXR0aW5ncyhieXRlczMyIGluZGV4ZWQgX25hbWUpOwoKCiAgICBtYXBwaW5nIChieXRlczMyID0+IHVpbnQ4KSBwdWJsaWMgRW50aXR5U3RhdGVzOwogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiB1aW50OCkgcHVibGljIFJlY29yZFN0YXRlczsKICAgIHVpbnQ4IHB1YmxpYyBDdXJyZW50RW50aXR5U3RhdGU7CgogICAgZXZlbnQgRXZlbnRFbnRpdHlQcm9jZXNzb3IoYnl0ZXMzMiBpbmRleGVkIF9hc3NldE5hbWUsIHVpbnQ4IGluZGV4ZWQgX2N1cnJlbnQsIHVpbnQ4IGluZGV4ZWQgX3JlcXVpcmVkKTsKICAgIGV2ZW50IERlYnVnRW50aXR5UmVxdWlyZWRDaGFuZ2VzKCBieXRlczMyIF9hc3NldE5hbWUsIHVpbnQ4IGluZGV4ZWQgX2N1cnJlbnQsIHVpbnQ4IGluZGV4ZWQgX3JlcXVpcmVkICk7CgogICAgYnl0ZXMzMiBwdWJsaWMgYXNzZXROYW1lOwoKICAgIC8qIEFzc2V0IHJlY29yZHMgKi8KICAgIHVpbnQ4IHB1YmxpYyBSZWNvcmROdW0gPSAwOwoKICAgIC8qIEFzc2V0IGluaXRpYWxpc2VkIG9yIG5vdCAqLwogICAgYm9vbCBwdWJsaWMgX2luaXRpYWxpemVkID0gZmFsc2U7CgogICAgLyogQXNzZXQgc2V0dGluZ3MgcHJlc2VudCBvciBub3QgKi8KICAgIGJvb2wgcHVibGljIF9zZXR0aW5nc0FwcGxpZWQgPSBmYWxzZTsKCiAgICAvKiBBc3NldCBvd25lciAoIEFwcGxpY2F0aW9uRW50aXR5IGFkZHJlc3MgKSAqLwogICAgYWRkcmVzcyBwdWJsaWMgb3duZXIgPSBhZGRyZXNzKDB4MCkgOwogICAgYWRkcmVzcyBwdWJsaWMgZGVwbG95ZXJBZGRyZXNzOwoKICAgIGZ1bmN0aW9uIEFwcGxpY2F0aW9uQXNzZXQoKSBwdWJsaWMgewogICAgICAgIGRlcGxveWVyQWRkcmVzcyA9IG1zZy5zZW5kZXI7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0SW5pdGlhbEFwcGxpY2F0aW9uQWRkcmVzcyhhZGRyZXNzIF9vd25lckFkZHJlc3MpIHB1YmxpYyBvbmx5RGVwbG95ZXIgcmVxdWlyZU5vdEluaXRpYWxpc2VkIHsKICAgICAgICBvd25lciA9IF9vd25lckFkZHJlc3M7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0SW5pdGlhbE93bmVyQW5kTmFtZShieXRlczMyIF9uYW1lKSBleHRlcm5hbAogICAgICAgIHJlcXVpcmVOb3RJbml0aWFsaXNlZAogICAgICAgIG9ubHlPd25lcgogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgLy8gaW5pdCBzdGF0ZXMKICAgICAgICBzZXRBc3NldFN0YXRlcygpOwogICAgICAgIGFzc2V0TmFtZSA9IF9uYW1lOwogICAgICAgIC8vIHNldCBpbml0aWFsIHN0YXRlCiAgICAgICAgQ3VycmVudEVudGl0eVN0YXRlID0gZ2V0RW50aXR5U3RhdGUoIk5FVyIpOwogICAgICAgIHJ1bkJlZm9yZUluaXRpYWxpemF0aW9uKCk7CiAgICAgICAgX2luaXRpYWxpemVkID0gdHJ1ZTsKICAgICAgICBFdmVudEFwcEFzc2V0T3duZXJTZXQoX25hbWUsIG93bmVyKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRBc3NldFN0YXRlcygpIGludGVybmFsIHsKICAgICAgICAvLyBBc3NldCBTdGF0ZXMKICAgICAgICBFbnRpdHlTdGF0ZXNbIl9fSUdOT1JFRF9fIl0gICAgID0gMDsKICAgICAgICBFbnRpdHlTdGF0ZXNbIk5FVyJdICAgICAgICAgICAgID0gMTsKICAgICAgICAvLyBGdW5kaW5nIFN0YWdlIFN0YXRlcwogICAgICAgIFJlY29yZFN0YXRlc1siX19JR05PUkVEX18iXSAgICAgPSAwOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFJlY29yZFN0YXRlKGJ5dGVzMzIgbmFtZSkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDgpIHsKICAgICAgICByZXR1cm4gUmVjb3JkU3RhdGVzW25hbWVdOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEVudGl0eVN0YXRlKGJ5dGVzMzIgbmFtZSkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDgpIHsKICAgICAgICByZXR1cm4gRW50aXR5U3RhdGVzW25hbWVdOwogICAgfQoKICAgIGZ1bmN0aW9uIHJ1bkJlZm9yZUluaXRpYWxpemF0aW9uKCkgaW50ZXJuYWwgcmVxdWlyZU5vdEluaXRpYWxpc2VkICB7CiAgICAgICAgRXZlbnRSdW5CZWZvcmVJbml0KGFzc2V0TmFtZSk7CiAgICB9CgogICAgZnVuY3Rpb24gYXBwbHlBbmRMb2NrU2V0dGluZ3MoKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlEZXBsb3llcgogICAgICAgIHJlcXVpcmVJbml0aWFsaXNlZAogICAgICAgIHJlcXVpcmVTZXR0aW5nc05vdEFwcGxpZWQKICAgICAgICByZXR1cm5zKGJvb2wpCiAgICB7CiAgICAgICAgcnVuQmVmb3JlQXBwbHlpbmdTZXR0aW5ncygpOwogICAgICAgIF9zZXR0aW5nc0FwcGxpZWQgPSB0cnVlOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIHJ1bkJlZm9yZUFwcGx5aW5nU2V0dGluZ3MoKSBpbnRlcm5hbCByZXF1aXJlSW5pdGlhbGlzZWQgcmVxdWlyZVNldHRpbmdzTm90QXBwbGllZCAgewogICAgICAgIEV2ZW50UnVuQmVmb3JlQXBwbHlpbmdTZXR0aW5ncyhhc3NldE5hbWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyVG9OZXdPd25lcihhZGRyZXNzIF9uZXdPd25lcikgcHVibGljIHJlcXVpcmVJbml0aWFsaXNlZCBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUob3duZXIgIT0gYWRkcmVzcygweDApICYmIF9uZXdPd25lciAhPSBhZGRyZXNzKDB4MCkpOwogICAgICAgIG93bmVyID0gX25ld093bmVyOwogICAgICAgIEV2ZW50QXBwQXNzZXRPd25lclNldChhc3NldE5hbWUsIG93bmVyKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRBcHBsaWNhdGlvbkFzc2V0QWRkcmVzc0J5TmFtZShieXRlczMyIF9uYW1lKQogICAgICAgIHB1YmxpYwogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zKGFkZHJlc3MpCiAgICB7CiAgICAgICAgYWRkcmVzcyBhc3NldCA9IEFwcGxpY2F0aW9uRW50aXR5QUJJKG93bmVyKS5nZXRBc3NldEFkZHJlc3NCeU5hbWUoX25hbWUpOwogICAgICAgIGlmKCBhc3NldCAhPSBhZGRyZXNzKDB4MCkgKSB7CiAgICAgICAgICAgIHJldHVybiBhc3NldDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0QXBwbGljYXRpb25TdGF0ZSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQ4KSB7CiAgICAgICAgcmV0dXJuIEFwcGxpY2F0aW9uRW50aXR5QUJJKG93bmVyKS5DdXJyZW50RW50aXR5U3RhdGUoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRBcHBsaWNhdGlvbkVudGl0eVN0YXRlKGJ5dGVzMzIgbmFtZSkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDgpIHsKICAgICAgICByZXR1cm4gQXBwbGljYXRpb25FbnRpdHlBQkkob3duZXIpLmdldEVudGl0eVN0YXRlKG5hbWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEFwcEJ5bGF3VWludDI1NihieXRlczMyIG5hbWUpIHB1YmxpYyB2aWV3IHJlcXVpcmVJbml0aWFsaXNlZCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgQXBwbGljYXRpb25FbnRpdHlBQkkgQ3VycmVudEFwcCA9IEFwcGxpY2F0aW9uRW50aXR5QUJJKG93bmVyKTsKICAgICAgICByZXR1cm4gQ3VycmVudEFwcC5nZXRCeWxhd1VpbnQyNTYobmFtZSk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0QXBwQnlsYXdCeXRlczMyKGJ5dGVzMzIgbmFtZSkgcHVibGljIHZpZXcgcmVxdWlyZUluaXRpYWxpc2VkIHJldHVybnMgKGJ5dGVzMzIpIHsKICAgICAgICBBcHBsaWNhdGlvbkVudGl0eUFCSSBDdXJyZW50QXBwID0gQXBwbGljYXRpb25FbnRpdHlBQkkob3duZXIpOwogICAgICAgIHJldHVybiBDdXJyZW50QXBwLmdldEJ5bGF3Qnl0ZXMzMihuYW1lKTsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlBcHBsaWNhdGlvbkVudGl0eSgpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgcmVxdWlyZUluaXRpYWxpc2VkKCkgewogICAgICAgIHJlcXVpcmUoX2luaXRpYWxpemVkID09IHRydWUpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgcmVxdWlyZU5vdEluaXRpYWxpc2VkKCkgewogICAgICAgIHJlcXVpcmUoX2luaXRpYWxpemVkID09IGZhbHNlKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIHJlcXVpcmVTZXR0aW5nc0FwcGxpZWQoKSB7CiAgICAgICAgcmVxdWlyZShfc2V0dGluZ3NBcHBsaWVkID09IHRydWUpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgcmVxdWlyZVNldHRpbmdzTm90QXBwbGllZCgpIHsKICAgICAgICByZXF1aXJlKF9zZXR0aW5nc0FwcGxpZWQgPT0gZmFsc2UpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seURlcGxveWVyKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBkZXBsb3llckFkZHJlc3MpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUFzc2V0KGJ5dGVzMzIgX25hbWUpIHsKICAgICAgICBhZGRyZXNzIEFzc2V0QWRkcmVzcyA9IGdldEFwcGxpY2F0aW9uQXNzZXRBZGRyZXNzQnlOYW1lKF9uYW1lKTsKICAgICAgICByZXF1aXJlKCBtc2cuc2VuZGVyID09IEFzc2V0QWRkcmVzcyk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRUaW1lc3RhbXAoKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIG5vdzsKICAgIH0KCgp9CgovKgoKICogc291cmNlICAgICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9ibG9ja2JpdHNpby8KCiAqIEBuYW1lICAgICAgICBBcHBsaWNhdGlvbiBBc3NldCBDb250cmFjdCBBQkkKICogQHBhY2thZ2UgICAgIEJsb2NrQml0c0lPCiAqIEBhdXRob3IgICAgICBNaWNreSBTb2NhY2kgPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI1MTNjMzgzMjNhMjgxMTNmM2UyNjNkMzgyNzM0N2YyMzNlIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4KCiBBbnkgY29udHJhY3QgaW5oZXJpdGluZyB0aGlzIHdpbGwgYmUgdXNhYmxlIGFzIGFuIEFzc2V0IGluIHRoZSBBcHBsaWNhdGlvbiBFbnRpdHkKCiovCgoKCmNvbnRyYWN0IEFCSUFwcGxpY2F0aW9uQXNzZXQgewoKICAgIGJ5dGVzMzIgcHVibGljIGFzc2V0TmFtZTsKICAgIHVpbnQ4IHB1YmxpYyBDdXJyZW50RW50aXR5U3RhdGU7CiAgICB1aW50OCBwdWJsaWMgUmVjb3JkTnVtOwogICAgYm9vbCBwdWJsaWMgX2luaXRpYWxpemVkOwogICAgYm9vbCBwdWJsaWMgX3NldHRpbmdzQXBwbGllZDsKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwogICAgYWRkcmVzcyBwdWJsaWMgZGVwbG95ZXJBZGRyZXNzOwogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiB1aW50OCkgcHVibGljIEVudGl0eVN0YXRlczsKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gdWludDgpIHB1YmxpYyBSZWNvcmRTdGF0ZXM7CgogICAgZnVuY3Rpb24gc2V0SW5pdGlhbEFwcGxpY2F0aW9uQWRkcmVzcyhhZGRyZXNzIF9vd25lckFkZHJlc3MpIHB1YmxpYzsKICAgIGZ1bmN0aW9uIHNldEluaXRpYWxPd25lckFuZE5hbWUoYnl0ZXMzMiBfbmFtZSkgZXh0ZXJuYWwgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBnZXRSZWNvcmRTdGF0ZShieXRlczMyIG5hbWUpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQ4KTsKICAgIGZ1bmN0aW9uIGdldEVudGl0eVN0YXRlKGJ5dGVzMzIgbmFtZSkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDgpOwogICAgZnVuY3Rpb24gYXBwbHlBbmRMb2NrU2V0dGluZ3MoKSBwdWJsaWMgcmV0dXJucyhib29sKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyVG9OZXdPd25lcihhZGRyZXNzIF9uZXdPd25lcikgcHVibGljIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gZ2V0QXBwbGljYXRpb25Bc3NldEFkZHJlc3NCeU5hbWUoYnl0ZXMzMiBfbmFtZSkgcHVibGljIHJldHVybnMoYWRkcmVzcyk7CiAgICBmdW5jdGlvbiBnZXRBcHBsaWNhdGlvblN0YXRlKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDgpOwogICAgZnVuY3Rpb24gZ2V0QXBwbGljYXRpb25FbnRpdHlTdGF0ZShieXRlczMyIG5hbWUpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQ4KTsKICAgIGZ1bmN0aW9uIGdldEFwcEJ5bGF3VWludDI1NihieXRlczMyIG5hbWUpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gZ2V0QXBwQnlsYXdCeXRlczMyKGJ5dGVzMzIgbmFtZSkgcHVibGljIHZpZXcgcmV0dXJucyAoYnl0ZXMzMik7CiAgICBmdW5jdGlvbiBnZXRUaW1lc3RhbXAoKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KTsKCgp9CgovKgoKICogc291cmNlICAgICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9ibG9ja2JpdHNpby8KCiAqIEBuYW1lICAgICAgICBUb2tlbiBNYW5hZ2VyIENvbnRyYWN0CiAqIEBwYWNrYWdlICAgICBCbG9ja0JpdHNJTwogKiBAYXV0aG9yICAgICAgTWlja3kgU29jYWNpIDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iYTZjYmNmYzVjZGRmZTZjOGM5ZDFjYWNmZDBjMzg4ZDRjOSI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+CgoqLwoKCgoKCmNvbnRyYWN0IEFCSVRva2VuTWFuYWdlciBpcyBBQklBcHBsaWNhdGlvbkFzc2V0IHsKCiAgICBhZGRyZXNzIHB1YmxpYyBUb2tlblNDQURBRW50aXR5OwogICAgYWRkcmVzcyBwdWJsaWMgVG9rZW5FbnRpdHk7CiAgICBhZGRyZXNzIHB1YmxpYyBNYXJrZXRpbmdNZXRob2RBZGRyZXNzOwogICAgYm9vbCBPd25lclRva2VuQmFsYW5jZXNSZWxlYXNlZCA9IGZhbHNlOwoKICAgIGZ1bmN0aW9uIGFkZFNldHRpbmdzKGFkZHJlc3MgX3NjYWRhQWRkcmVzcywgYWRkcmVzcyBfdG9rZW5BZGRyZXNzLCBhZGRyZXNzIF9tYXJrZXRpbmcgKSBwdWJsaWM7CiAgICBmdW5jdGlvbiBnZXRUb2tlblNDQURBUmVxdWlyZXNIYXJkQ2FwKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBtaW50KGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGZpbmlzaE1pbnRpbmcoKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBtaW50Rm9yTWFya2V0aW5nUG9vbChhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBleHRlcm5hbCByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIFJlbGVhc2VPd25lcnNMb2NrZWRUb2tlbnMoYWRkcmVzcyBfbXVsdGlTaWdPdXRwdXRBZGRyZXNzKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7Cgp9CgovKgoKICogc291cmNlICAgICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9ibG9ja2JpdHNpby8KCiAqIEBuYW1lICAgICAgICBQcm9wb3NhbHMgQ29udHJhY3QKICogQHBhY2thZ2UgICAgIEJsb2NrQml0c0lPCiAqIEBhdXRob3IgICAgICBNaWNreSBTb2NhY2kgPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSJiM2RlZGFkMGQ4Y2FmM2RkZGNjNGRmZGFjNWQ2OWRjMWRjIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4KCiBDb250YWlucyB0aGUgUHJvcG9zYWxzIENvbnRyYWN0IGNvZGUgZGVwbG95ZWQgYW5kIGxpbmtlZCB0byB0aGUgQXBwbGljYXRpb24gRW50aXR5CgoqLwoKCgoKCmNvbnRyYWN0IEFCSVByb3Bvc2FscyBpcyBBQklBcHBsaWNhdGlvbkFzc2V0IHsKCiAgICBhZGRyZXNzIHB1YmxpYyBBcHBsaWNhdGlvbjsKICAgIGFkZHJlc3MgcHVibGljIExpc3RpbmdDb250cmFjdEVudGl0eTsKICAgIGFkZHJlc3MgcHVibGljIEZ1bmRpbmdFbnRpdHk7CiAgICBhZGRyZXNzIHB1YmxpYyBGdW5kaW5nTWFuYWdlckVudGl0eTsKICAgIGFkZHJlc3MgcHVibGljIFRva2VuTWFuYWdlckVudGl0eTsKICAgIGFkZHJlc3MgcHVibGljIFRva2VuRW50aXR5OwogICAgYWRkcmVzcyBwdWJsaWMgTWlsZXN0b25lc0VudGl0eTsKCiAgICBzdHJ1Y3QgUHJvcG9zYWxSZWNvcmQgewogICAgICAgIGFkZHJlc3MgY3JlYXRvcjsKICAgICAgICBieXRlczMyIG5hbWU7CiAgICAgICAgdWludDggYWN0aW9uVHlwZTsKICAgICAgICB1aW50OCBzdGF0ZTsKICAgICAgICBieXRlczMyIGhhc2g7ICAgICAgICAgICAgICAgICAgICAgICAvLyBhY3Rpb24gbmFtZSArIGFyZ3MgaGFzaAogICAgICAgIGFkZHJlc3MgYWRkcjsKICAgICAgICBieXRlczMyIHNvdXJjZUNvZGVVcmw7CiAgICAgICAgdWludDI1NiBleHRyYTsKICAgICAgICB1aW50MjU2IHRpbWVfc3RhcnQ7CiAgICAgICAgdWludDI1NiB0aW1lX2VuZDsKICAgICAgICB1aW50MjU2IGluZGV4OwogICAgfQoKICAgIHN0cnVjdCBWb3RlU3RydWN0IHsKICAgICAgICBhZGRyZXNzIHZvdGVyOwogICAgICAgIHVpbnQyNTYgdGltZTsKICAgICAgICBib29sICAgIHZvdGU7CiAgICAgICAgdWludDI1NiBwb3dlcjsKICAgICAgICBib29sICAgIGFubnVsbGVkOwogICAgICAgIHVpbnQyNTYgaW5kZXg7CiAgICB9CgogICAgc3RydWN0IFJlc3VsdFJlY29yZCB7CiAgICAgICAgdWludDI1NiB0b3RhbEF2YWlsYWJsZTsKICAgICAgICB1aW50MjU2IHJlcXVpcmVkRm9yUmVzdWx0OwogICAgICAgIHVpbnQyNTYgdG90YWxTb0ZhcjsKICAgICAgICB1aW50MjU2IHllczsKICAgICAgICB1aW50MjU2IG5vOwogICAgICAgIGJvb2wgICAgcmVxdWlyZXNDb3VudGluZzsKICAgIH0KCiAgICB1aW50OCBwdWJsaWMgQWN0aXZlUHJvcG9zYWxOdW07CiAgICB1aW50MjU2IHB1YmxpYyBWb3RlQ291bnRQZXJQcm9jZXNzOwogICAgYm9vbCBwdWJsaWMgRW1lcmdlbmN5RnVuZGluZ1JlbGVhc2VBcHByb3ZlZDsKCiAgICBtYXBwaW5nIChieXRlczMyID0+IHVpbnQ4KSBwdWJsaWMgQWN0aW9uVHlwZXM7CiAgICBtYXBwaW5nICh1aW50OCA9PiB1aW50MjU2KSBwdWJsaWMgQWN0aXZlUHJvcG9zYWxJZHM7CiAgICBtYXBwaW5nICh1aW50MjU2ID0+IGJvb2wpIHB1YmxpYyBFeHBpcmVkUHJvcG9zYWxJZHM7CiAgICBtYXBwaW5nICh1aW50MjU2ID0+IFByb3Bvc2FsUmVjb3JkKSBwdWJsaWMgUHJvcG9zYWxzQnlJZDsKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gdWludDI1NikgcHVibGljIFByb3Bvc2FsSWRCeUhhc2g7CiAgICBtYXBwaW5nICh1aW50MjU2ID0+IG1hcHBpbmcgKHVpbnQyNTYgPT4gVm90ZVN0cnVjdCkgKSBwdWJsaWMgVm90ZXNCeVByb3Bvc2FsSWQ7CiAgICBtYXBwaW5nICh1aW50MjU2ID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gVm90ZVN0cnVjdCkgKSBwdWJsaWMgVm90ZXNCeUNhc3RlcjsKICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gdWludDI1NikgcHVibGljIFZvdGVzTnVtQnlQcm9wb3NhbElkOwogICAgbWFwcGluZyAodWludDI1NiA9PiBSZXN1bHRSZWNvcmQgKSBwdWJsaWMgUmVzdWx0c0J5UHJvcG9zYWxJZDsKICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gdWludDI1NikgcHVibGljIGxhc3RQcm9jZXNzZWRWb3RlSWRCeVByb3Bvc2FsOwogICAgbWFwcGluZyAodWludDI1NiA9PiB1aW50MjU2KSBwdWJsaWMgUHJvY2Vzc2VkVm90ZXNCeVByb3Bvc2FsOwogICAgbWFwcGluZyAodWludDI1NiA9PiB1aW50MjU2KSBwdWJsaWMgVm90ZUNvdW50QXRQcm9jZXNzaW5nU3RhcnRCeVByb3Bvc2FsOwoKICAgIGZ1bmN0aW9uIGdldFJlY29yZFN0YXRlKGJ5dGVzMzIgbmFtZSkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDgpOwogICAgZnVuY3Rpb24gZ2V0QWN0aW9uVHlwZShieXRlczMyIG5hbWUpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQ4KTsKICAgIGZ1bmN0aW9uIGdldFByb3Bvc2FsU3RhdGUodWludDI1NiBfcHJvcG9zYWxJZCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDgpOwogICAgZnVuY3Rpb24gZ2V0QnlsYXdzUHJvcG9zYWxWb3RpbmdEdXJhdGlvbigpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gZ2V0QnlsYXdzTWlsZXN0b25lTWluUG9zdHBvbmluZygpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gZ2V0QnlsYXdzTWlsZXN0b25lTWF4UG9zdHBvbmluZygpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gZ2V0SGFzaCh1aW50OCBhY3Rpb25UeXBlLCBieXRlczMyIGFyZzEsIGJ5dGVzMzIgYXJnMikgcHVibGljIHB1cmUgcmV0dXJucyAoIGJ5dGVzMzIgKTsKICAgIGZ1bmN0aW9uIHByb2Nlc3MoKSBwdWJsaWM7CiAgICBmdW5jdGlvbiBoYXNSZXF1aXJlZFN0YXRlQ2hhbmdlcygpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gZ2V0UmVxdWlyZWRTdGF0ZUNoYW5nZXMoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50OCk7CiAgICBmdW5jdGlvbiBhZGRDb2RlVXBncmFkZVByb3Bvc2FsKGFkZHJlc3MgX2FkZHIsIGJ5dGVzMzIgX3NvdXJjZUNvZGVVcmwpIGV4dGVybmFsIHJldHVybnMgKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gY3JlYXRlTWlsZXN0b25lQWNjZXB0YW5jZVByb3Bvc2FsKCkgZXh0ZXJuYWwgcmV0dXJucyAodWludDI1Nik7CiAgICBmdW5jdGlvbiBjcmVhdGVNaWxlc3RvbmVQb3N0cG9uaW5nUHJvcG9zYWwodWludDI1NiBfZHVyYXRpb24pIGV4dGVybmFsIHJldHVybnMgKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gZ2V0Q3VycmVudE1pbGVzdG9uZVBvc3Rwb25pbmdQcm9wb3NhbER1cmF0aW9uKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgICBmdW5jdGlvbiBnZXRDdXJyZW50TWlsZXN0b25lUHJvcG9zYWxTdGF0dXNGb3JUeXBlKHVpbnQ4IF9hY3Rpb25UeXBlICkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDgpOwogICAgZnVuY3Rpb24gY3JlYXRlRW1lcmdlbmN5RnVuZFJlbGVhc2VQcm9wb3NhbCgpIGV4dGVybmFsIHJldHVybnMgKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gY3JlYXRlRGVsaXN0aW5nUHJvcG9zYWwodWludDI1NiBfcHJvamVjdElkKSBleHRlcm5hbCByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIFJlZ2lzdGVyVm90ZSh1aW50MjU2IF9wcm9wb3NhbElkLCBib29sIF9teVZvdGUpIHB1YmxpYzsKICAgIGZ1bmN0aW9uIGhhc1ByZXZpb3VzVm90ZSh1aW50MjU2IF9wcm9wb3NhbElkLCBhZGRyZXNzIF92b3RlcikgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBnZXRUb3RhbFRva2VuVm90aW5nUG93ZXIoYWRkcmVzcyBfdm90ZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKCB1aW50MjU2ICk7CiAgICBmdW5jdGlvbiBnZXRWb3RpbmdQb3dlcih1aW50MjU2IF9wcm9wb3NhbElkLCBhZGRyZXNzIF92b3RlcikgcHVibGljIHZpZXcgcmV0dXJucyAoIHVpbnQyNTYgKTsKICAgIGZ1bmN0aW9uIHNldFZvdGVDb3VudFBlclByb2Nlc3ModWludDI1NiBfcGVyUHJvY2VzcykgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBQcm9jZXNzVm90ZVRvdGFscyh1aW50MjU2IF9wcm9wb3NhbElkLCB1aW50MjU2IGxlbmd0aCkgcHVibGljOwogICAgZnVuY3Rpb24gY2FuRW5kVm90aW5nKHVpbnQyNTYgX3Byb3Bvc2FsSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gZ2V0UHJvcG9zYWxUeXBlKHVpbnQyNTYgX3Byb3Bvc2FsSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQ4KTsKICAgIGZ1bmN0aW9uIGV4cGlyeUNoYW5nZXNTdGF0ZSh1aW50MjU2IF9wcm9wb3NhbElkKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIG5lZWRzUHJvY2Vzc2luZyh1aW50MjU2IF9wcm9wb3NhbElkKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGdldE15Vm90ZUZvckN1cnJlbnRNaWxlc3RvbmVSZWxlYXNlKGFkZHJlc3MgX3ZvdGVyKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGdldEhhc1ZvdGVGb3JDdXJyZW50TWlsZXN0b25lUmVsZWFzZShhZGRyZXNzIF92b3RlcikgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBnZXRNeVZvdGUodWludDI1NiBfcHJvcG9zYWxJZCwgYWRkcmVzcyBfdm90ZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpOwoKfQoKLyoKCiAqIHNvdXJjZSAgICAgICBodHRwczovL2dpdGh1Yi5jb20vYmxvY2tiaXRzaW8vCgogKiBAbmFtZSAgICAgICAgTWlsZXN0b25lcyBDb250cmFjdAogKiBAcGFja2FnZSAgICAgQmxvY2tCaXRzSU8KICogQGF1dGhvciAgICAgIE1pY2t5IFNvY2FjaSA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImYwOWQ5OTkzOWI4OWIwOWU5Zjg3OWM5OTg2OTVkZTgyOWYiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+PgoKIENvbnRhaW5zIHRoZSBNaWxlc3RvbmVzIENvbnRyYWN0IGNvZGUgZGVwbG95ZWQgYW5kIGxpbmtlZCB0byB0aGUgQXBwbGljYXRpb24gRW50aXR5CgoqLwoKCgoKCmNvbnRyYWN0IEFCSU1pbGVzdG9uZXMgaXMgQUJJQXBwbGljYXRpb25Bc3NldCB7CgogICAgc3RydWN0IFJlY29yZCB7CiAgICAgICAgYnl0ZXMzMiBuYW1lOwogICAgICAgIHN0cmluZyBkZXNjcmlwdGlvbjsgICAgICAgICAgICAgICAgICAgICAvLyB3aWxsIGNoYW5nZSB0byBoYXNoIHBvaW50ZXIgKCBleHRlcm5hbCBzdG9yYWdlICkKICAgICAgICB1aW50OCBzdGF0ZTsKICAgICAgICB1aW50MjU2IGR1cmF0aW9uOwogICAgICAgIHVpbnQyNTYgdGltZV9zdGFydDsgICAgICAgICAgICAgICAgICAgICAvLyBzdGFydCBhdCB1bml4dGltZXN0YW1wCiAgICAgICAgdWludDI1NiBsYXN0X3N0YXRlX2NoYW5nZV90aW1lOyAgICAgICAgIC8vIHRpbWUgb2YgbGFzdCBzdGF0ZSBjaGFuZ2UKICAgICAgICB1aW50MjU2IHRpbWVfZW5kOyAgICAgICAgICAgICAgICAgICAgICAgLy8gZXN0aW1hdGVkIGVuZCB0aW1lID4+IGNhbiBiZSBpbmNyZWFzZWQgYnkgcHJvcG9zYWwKICAgICAgICB1aW50MjU2IHRpbWVfZW5kZWQ7ICAgICAgICAgICAgICAgICAgICAgLy8gYWN0dWFsIGVuZCB0aW1lCiAgICAgICAgdWludDI1NiBtZWV0aW5nX3RpbWU7CiAgICAgICAgdWludDggZnVuZGluZ19wZXJjZW50YWdlOwogICAgICAgIHVpbnQ4IGluZGV4OwogICAgfQoKICAgIHVpbnQ4IHB1YmxpYyBjdXJyZW50UmVjb3JkOwogICAgdWludDI1NiBwdWJsaWMgTWlsZXN0b25lQ2FzaEJhY2tUaW1lID0gMDsKICAgIG1hcHBpbmcgKHVpbnQ4ID0+IFJlY29yZCkgcHVibGljIENvbGxlY3Rpb247CiAgICBtYXBwaW5nIChieXRlczMyID0+IGJvb2wpIHB1YmxpYyBNaWxlc3RvbmVQb3N0cG9uaW5nSGFzaDsKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gdWludDI1NikgcHVibGljIFByb3Bvc2FsSWRCeUhhc2g7CgogICAgZnVuY3Rpb24gZ2V0QnlsYXdzUHJvamVjdERldmVsb3BtZW50U3RhcnQoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIGdldEJ5bGF3c01pblRpbWVJblRoZUZ1dHVyZUZvck1lZXRpbmdDcmVhdGlvbigpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gZ2V0QnlsYXdzQ2FzaEJhY2tWb3RlUmVqZWN0ZWREdXJhdGlvbigpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gYWRkUmVjb3JkKCBieXRlczMyIF9uYW1lLCBzdHJpbmcgX2Rlc2NyaXB0aW9uLCB1aW50MjU2IF9kdXJhdGlvbiwgdWludDggX3BlcmMgKSBwdWJsaWM7CiAgICBmdW5jdGlvbiBnZXRNaWxlc3RvbmVGdW5kaW5nUGVyY2VudGFnZSh1aW50OCByZWNvcmRJZCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDgpOwogICAgZnVuY3Rpb24gZG9TdGF0ZUNoYW5nZXMoKSBwdWJsaWM7CiAgICBmdW5jdGlvbiBnZXRSZWNvcmRTdGF0ZVJlcXVpcmVkQ2hhbmdlcygpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQ4KTsKICAgIGZ1bmN0aW9uIGhhc1JlcXVpcmVkU3RhdGVDaGFuZ2VzKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBhZnRlclZvdGVOb0Nhc2hCYWNrVGltZSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKCBib29sICk7CiAgICBmdW5jdGlvbiBnZXRIYXNoKHVpbnQ4IGFjdGlvblR5cGUsIGJ5dGVzMzIgYXJnMSwgYnl0ZXMzMiBhcmcyKSBwdWJsaWMgcHVyZSByZXR1cm5zICggYnl0ZXMzMiApOwogICAgZnVuY3Rpb24gZ2V0Q3VycmVudEhhc2goKSBwdWJsaWMgdmlldyByZXR1cm5zICggYnl0ZXMzMiApOwogICAgZnVuY3Rpb24gZ2V0Q3VycmVudFByb3Bvc2FsSWQoKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKCB1aW50MjU2ICk7CiAgICBmdW5jdGlvbiBzZXRDdXJyZW50TWlsZXN0b25lTWVldGluZ1RpbWUodWludDI1NiBfbWVldGluZ190aW1lKSBwdWJsaWM7CiAgICBmdW5jdGlvbiBpc1JlY29yZFVwZGF0ZUFsbG93ZWQodWludDggX25ld19zdGF0ZSApIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gZ2V0UmVxdWlyZWRTdGF0ZUNoYW5nZXMoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50OCwgdWludDgsIHVpbnQ4KTsKICAgIGZ1bmN0aW9uIEFwcGxpY2F0aW9uSXNJbkRldmVsb3BtZW50KCkgcHVibGljIHZpZXcgcmV0dXJucyhib29sKTsKICAgIGZ1bmN0aW9uIE1lZXRpbmdUaW1lU2V0RmFpbHVyZSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpOwoKfQoKLyoKCiAqIHNvdXJjZSAgICAgICBodHRwczovL2dpdGh1Yi5jb20vYmxvY2tiaXRzaW8vCgogKiBAbmFtZSAgICAgICAgRnVuZGluZyBDb250cmFjdCBBQkkKICogQHBhY2thZ2UgICAgIEJsb2NrQml0c0lPCiAqIEBhdXRob3IgICAgICBNaWNreSBTb2NhY2kgPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI2ZTAzMDcwZDA1MTcyZTAwMDExOTAyMDcxODBiNDAxYzAxIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4KCiBDb250YWlucyB0aGUgRnVuZGluZyBDb250cmFjdCBjb2RlIGRlcGxveWVkIGFuZCBsaW5rZWQgdG8gdGhlIEFwcGxpY2F0aW9uIEVudGl0eQoKCiAgICAhISEgTGlua3MgZGlyZWN0bHkgdG8gTWlsZXN0b25lcwoKKi8KCgoKCgpjb250cmFjdCBBQklGdW5kaW5nIGlzIEFCSUFwcGxpY2F0aW9uQXNzZXQgewoKICAgIGFkZHJlc3MgcHVibGljIG11bHRpU2lnT3V0cHV0QWRkcmVzczsKICAgIGFkZHJlc3MgcHVibGljIERpcmVjdElucHV0OwogICAgYWRkcmVzcyBwdWJsaWMgTWlsZXN0b25lSW5wdXQ7CiAgICBhZGRyZXNzIHB1YmxpYyBUb2tlbk1hbmFnZXJFbnRpdHk7CiAgICBhZGRyZXNzIHB1YmxpYyBGdW5kaW5nTWFuYWdlckVudGl0eTsKCiAgICBzdHJ1Y3QgRnVuZGluZ1N0YWdlIHsKICAgICAgICBieXRlczMyIG5hbWU7CiAgICAgICAgdWludDggICBzdGF0ZTsKICAgICAgICB1aW50MjU2IHRpbWVfc3RhcnQ7CiAgICAgICAgdWludDI1NiB0aW1lX2VuZDsKICAgICAgICB1aW50MjU2IGFtb3VudF9jYXBfc29mdDsgICAgICAgICAgICAvLyAwID0gbm90IGVuZm9yY2VkCiAgICAgICAgdWludDI1NiBhbW91bnRfY2FwX2hhcmQ7ICAgICAgICAgICAgLy8gMCA9IG5vdCBlbmZvcmNlZAogICAgICAgIHVpbnQyNTYgYW1vdW50X3JhaXNlZDsgICAgICAgICAgICAgIC8vIDAgPSBub3QgZW5mb3JjZWQKICAgICAgICAvLyBmdW5kaW5nIG1ldGhvZCBzZXR0aW5ncwogICAgICAgIHVpbnQyNTYgbWluaW11bV9lbnRyeTsKICAgICAgICB1aW50OCAgIG1ldGhvZHM7ICAgICAgICAgICAgICAgICAgICAvLyBGdW5kaW5nTWV0aG9kSWRzCiAgICAgICAgLy8gdG9rZW4gc2V0dGluZ3MKICAgICAgICB1aW50MjU2IGZpeGVkX3Rva2VuczsKICAgICAgICB1aW50OCAgIHByaWNlX2FkZGl0aW9uX3BlcmNlbnRhZ2U7ICAvLwogICAgICAgIHVpbnQ4ICAgdG9rZW5fc2hhcmVfcGVyY2VudGFnZTsKICAgICAgICB1aW50OCAgIGluZGV4OwogICAgfQoKICAgIG1hcHBpbmcgKHVpbnQ4ID0+IEZ1bmRpbmdTdGFnZSkgcHVibGljIENvbGxlY3Rpb247CiAgICB1aW50OCBwdWJsaWMgRnVuZGluZ1N0YWdlTnVtOwogICAgdWludDggcHVibGljIGN1cnJlbnRGdW5kaW5nU3RhZ2U7CiAgICB1aW50MjU2IHB1YmxpYyBBbW91bnRSYWlzZWQ7CiAgICB1aW50MjU2IHB1YmxpYyBNaWxlc3RvbmVBbW91bnRSYWlzZWQ7CiAgICB1aW50MjU2IHB1YmxpYyBHbG9iYWxBbW91bnRDYXBTb2Z0OwogICAgdWludDI1NiBwdWJsaWMgR2xvYmFsQW1vdW50Q2FwSGFyZDsKICAgIHVpbnQ4IHB1YmxpYyBUb2tlblNlbGxQZXJjZW50YWdlOwogICAgdWludDI1NiBwdWJsaWMgRnVuZGluZ19TZXR0aW5nX2Z1bmRpbmdfdGltZV9zdGFydDsKICAgIHVpbnQyNTYgcHVibGljIEZ1bmRpbmdfU2V0dGluZ19mdW5kaW5nX3RpbWVfZW5kOwogICAgdWludDI1NiBwdWJsaWMgRnVuZGluZ19TZXR0aW5nX2Nhc2hiYWNrX3RpbWVfc3RhcnQ7CiAgICB1aW50MjU2IHB1YmxpYyBGdW5kaW5nX1NldHRpbmdfY2FzaGJhY2tfdGltZV9lbmQ7CiAgICB1aW50MjU2IHB1YmxpYyBGdW5kaW5nX1NldHRpbmdfY2FzaGJhY2tfYmVmb3JlX3N0YXJ0X3dhaXRfZHVyYXRpb247CiAgICB1aW50MjU2IHB1YmxpYyBGdW5kaW5nX1NldHRpbmdfY2FzaGJhY2tfZHVyYXRpb247CgoKICAgIGZ1bmN0aW9uIGFkZEZ1bmRpbmdTdGFnZSgKICAgICAgICBieXRlczMyIF9uYW1lLAogICAgICAgIHVpbnQyNTYgX3RpbWVfc3RhcnQsCiAgICAgICAgdWludDI1NiBfdGltZV9lbmQsCiAgICAgICAgdWludDI1NiBfYW1vdW50X2NhcF9zb2Z0LAogICAgICAgIHVpbnQyNTYgX2Ftb3VudF9jYXBfaGFyZCwgICAvLyByZXF1aXJlZCA+IDAKICAgICAgICB1aW50OCAgIF9tZXRob2RzLAogICAgICAgIHVpbnQyNTYgX21pbmltdW1fZW50cnksCiAgICAgICAgdWludDI1NiBfZml4ZWRfdG9rZW5zLAogICAgICAgIHVpbnQ4ICAgX3ByaWNlX2FkZGl0aW9uX3BlcmNlbnRhZ2UsCiAgICAgICAgdWludDggICBfdG9rZW5fc2hhcmVfcGVyY2VudGFnZQogICAgKQogICAgcHVibGljOwoKICAgIGZ1bmN0aW9uIGFkZFNldHRpbmdzKGFkZHJlc3MgX291dHB1dEFkZHJlc3MsIHVpbnQyNTYgc29mdF9jYXAsIHVpbnQyNTYgaGFyZF9jYXAsIHVpbnQ4IHNhbGVfcGVyY2VudGFnZSwgYWRkcmVzcyBfZGlyZWN0LCBhZGRyZXNzIF9taWxlc3RvbmUgKSBwdWJsaWM7CiAgICBmdW5jdGlvbiBnZXRTdGFnZUFtb3VudCh1aW50OCBTdGFnZUlkKSBwdWJsaWMgdmlldyByZXR1cm5zICggdWludDI1NiApOwogICAgZnVuY3Rpb24gYWxsb3dlZFBheW1lbnRNZXRob2QodWludDggX3BheW1lbnRfbWV0aG9kKSBwdWJsaWMgcHVyZSByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIHJlY2VpdmVQYXltZW50KGFkZHJlc3MgX3NlbmRlciwgdWludDggX3BheW1lbnRfbWV0aG9kKSBwYXlhYmxlIHB1YmxpYyByZXR1cm5zKGJvb2wpOwogICAgZnVuY3Rpb24gY2FuQWNjZXB0UGF5bWVudCh1aW50MjU2IF9hbW91bnQpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gZ2V0VmFsdWVPdmVyQ3VycmVudENhcCh1aW50MjU2IF9hbW91bnQpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gaXNGdW5kaW5nU3RhZ2VVcGRhdGVBbGxvd2VkKHVpbnQ4IF9uZXdfc3RhdGUgKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGdldFJlY29yZFN0YXRlUmVxdWlyZWRDaGFuZ2VzKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDgpOwogICAgZnVuY3Rpb24gZG9TdGF0ZUNoYW5nZXMoKSBwdWJsaWM7CiAgICBmdW5jdGlvbiBoYXNSZXF1aXJlZFN0YXRlQ2hhbmdlcygpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gZ2V0UmVxdWlyZWRTdGF0ZUNoYW5nZXMoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50OCwgdWludDgsIHVpbnQ4KTsKCn0KCi8qCgogKiBzb3VyY2UgICAgICAgaHR0cHM6Ly9naXRodWIuY29tL2Jsb2NrYml0c2lvLwoKICogQG5hbWUgICAgICAgIFRva2VuIENvbnRyYWN0CiAqIEBwYWNrYWdlICAgICBCbG9ja0JpdHNJTwogKiBAYXV0aG9yICAgICAgTWlja3kgU29jYWNpIDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iMTg3NTcxN2I3MzYxNTg3Njc3NmY3NDcxNmU3ZDM2NmE3NyI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+CgogWmVwcGVsaW4gRVJDMjAgU3RhbmRhcmQgVG9rZW4KCiovCgoKCmNvbnRyYWN0IEFCSVRva2VuIHsKCiAgICBzdHJpbmcgcHVibGljICBzeW1ib2w7CiAgICBzdHJpbmcgcHVibGljICBuYW1lOwogICAgdWludDggcHVibGljICAgZGVjaW1hbHM7CiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICAgIHN0cmluZyBwdWJsaWMgIHZlcnNpb247CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBiYWxhbmNlczsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKICAgIGFkZHJlc3MgcHVibGljIG1hbmFnZXI7CiAgICBhZGRyZXNzIHB1YmxpYyBkZXBsb3llcjsKICAgIGJvb2wgcHVibGljIG1pbnRpbmdGaW5pc2hlZCA9IGZhbHNlOwogICAgYm9vbCBwdWJsaWMgaW5pdGlhbGl6ZWQgPSBmYWxzZTsKCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpOwogICAgZnVuY3Rpb24gaW5jcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hZGRlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGRlY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfc3VidHJhY3RlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gZmluaXNoTWludGluZygpIHB1YmxpYyByZXR1cm5zIChib29sKTsKCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IGluZGV4ZWQgdmFsdWUpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiBpbmRleGVkIHZhbHVlKTsKICAgIGV2ZW50IE1pbnQoYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IGFtb3VudCk7CiAgICBldmVudCBNaW50RmluaXNoZWQoKTsKfQoKLyoKCiAqIHNvdXJjZSAgICAgICBodHRwczovL2dpdGh1Yi5jb20vYmxvY2tiaXRzaW8vCgogKiBAbmFtZSAgICAgICAgVG9rZW4gU3Rha2UgQ2FsY3VsYXRpb24gQW5kIERpc3RyaWJ1dGlvbiBBbGdvcml0aG0gLSBUeXBlIDMgLSBTZWxsIGEgdmFyaWFibGUgYW1vdW50IG9mIHRva2VucyBmb3IgYSBmaXhlZCBwcmljZQogKiBAcGFja2FnZSAgICAgQmxvY2tCaXRzSU8KICogQGF1dGhvciAgICAgIE1pY2t5IFNvY2FjaSA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImQ0YjliZGI3YmZhZDk0YmFiYmEzYjhiZGEyYjFmYWE2YmIiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+PgoKCiAgICBJbnB1dHM6CgogICAgRGVmaW5lZCBudW1iZXIgb2YgdG9rZW5zIHBlciB3ZWkgKCBYIFRva2VucyA9IDEgd2VpICkKICAgIFJlY2VpdmVkIGFtb3VudCBvZiBFVEgKICAgIEdlbmVyYXRlczoKCiAgICBUb3RhbCBTdXBwbHkgb2YgdG9rZW5zIGF2YWlsYWJsZSBpbiBGdW5kaW5nIFBoYXNlIHJlc3BlY3RpdmVseSBQcm9qZWN0CiAgICBPYnNlcnZhdGlvbnM6CgogICAgV2lsbCBzZWxsIHRoZSB3aG9sZSBzdXBwbHkgb2YgVG9rZW5zIGF2YWlsYWJsZSB0byBDdXJyZW50IEZ1bmRpbmcgUGhhc2UKICAgIFVzZSBjYXNlczoKCiAgICBBbnkgRnVuZGluZyBQaGFzZSB3aGVyZSB5b3Ugd2FudCB0aGUgZmlyc3QgRnVuZGluZyBQaGFzZSB0byBkZXRlcm1pbmUgdGhlIHRva2VuIHN1cHBseSBvZiB0aGUgd2hvbGUgUHJvamVjdAoKKi8KCgoKCmNvbnRyYWN0IEFCSVRva2VuU0NBREFWYXJpYWJsZSB7CiAgICBib29sIHB1YmxpYyBTQ0FEQV9yZXF1aXJlc19oYXJkX2NhcCA9IHRydWU7CiAgICBib29sIHB1YmxpYyBpbml0aWFsaXplZDsKICAgIGFkZHJlc3MgcHVibGljIGRlcGxveWVyQWRkcmVzczsKICAgIGZ1bmN0aW9uIGFkZFNldHRpbmdzKGFkZHJlc3MgX2Z1bmRpbmdDb250cmFjdCkgcHVibGljOwogICAgZnVuY3Rpb24gcmVxdWlyZXNIYXJkQ2FwKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBnZXRUb2tlbnNGb3JWYWx1ZUluQ3VycmVudFN0YWdlKHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIGdldFRva2Vuc0ZvclZhbHVlSW5TdGFnZSh1aW50OCBfc3RhZ2UsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIGdldEJvdWdodFRva2VucyggYWRkcmVzcyBfdmF1bHRBZGRyZXNzLCBib29sIF9kaXJlY3QgKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKfQoKLyoKCiAqIHNvdXJjZSAgICAgICBodHRwczovL2dpdGh1Yi5jb20vYmxvY2tiaXRzaW8vCgogKiBAbmFtZSAgICAgICAgRnVuZGluZyBDb250cmFjdCBBQkkKICogQHBhY2thZ2UgICAgIEJsb2NrQml0c0lPCiAqIEBhdXRob3IgICAgICBNaWNreSBTb2NhY2kgPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI3ZDEwMTQxZTE2MDQzZDEzMTIwYTExMTQwYjE4NTMwZjEyIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4KCiBDb250YWlucyB0aGUgRnVuZGluZyBDb250cmFjdCBjb2RlIGRlcGxveWVkIGFuZCBsaW5rZWQgdG8gdGhlIEFwcGxpY2F0aW9uIEVudGl0eQoKKi8KCgoKCgpjb250cmFjdCBBQklGdW5kaW5nTWFuYWdlciBpcyBBQklBcHBsaWNhdGlvbkFzc2V0IHsKCiAgICBib29sIHB1YmxpYyBmdW5kaW5nUHJvY2Vzc2VkOwogICAgYm9vbCBGdW5kaW5nUG9vbEJhbGFuY2VzQWxsb2NhdGVkOwogICAgdWludDggcHVibGljIFZhdWx0Q291bnRQZXJQcm9jZXNzOwogICAgdWludDI1NiBwdWJsaWMgbGFzdFByb2Nlc3NlZFZhdWx0SWQ7CiAgICB1aW50MjU2IHB1YmxpYyB2YXVsdE51bTsKICAgIHVpbnQyNTYgcHVibGljIExvY2tlZFZvdGluZ1Rva2VuczsKICAgIGJ5dGVzMzIgcHVibGljIGN1cnJlbnRUYXNrOwogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiBib29sKSBwdWJsaWMgdGFza0J5SGFzaDsKICAgIG1hcHBpbmcgIChhZGRyZXNzID0+IGFkZHJlc3MpIHB1YmxpYyB2YXVsdExpc3Q7CiAgICBtYXBwaW5nICAodWludDI1NiA9PiBhZGRyZXNzKSBwdWJsaWMgdmF1bHRCeUlkOwoKICAgIGZ1bmN0aW9uIHJlY2VpdmVQYXltZW50KGFkZHJlc3MgX3NlbmRlciwgdWludDggX3BheW1lbnRfbWV0aG9kLCB1aW50OCBfZnVuZGluZ19zdGFnZSkgcGF5YWJsZSBwdWJsaWMgcmV0dXJucyhib29sKTsKICAgIGZ1bmN0aW9uIGdldE15VmF1bHRBZGRyZXNzKGFkZHJlc3MgX3NlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcyk7CiAgICBmdW5jdGlvbiBzZXRWYXVsdENvdW50UGVyUHJvY2Vzcyh1aW50OCBfcGVyUHJvY2VzcykgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBnZXRIYXNoKGJ5dGVzMzIgYWN0aW9uVHlwZSwgYnl0ZXMzMiBhcmcxKSBwdWJsaWMgcHVyZSByZXR1cm5zICggYnl0ZXMzMiApOwogICAgZnVuY3Rpb24gZ2V0Q3VycmVudE1pbGVzdG9uZVByb2Nlc3NlZCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gcHJvY2Vzc0Z1bmRpbmdGYWlsZWRGaW5pc2hlZCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gcHJvY2Vzc0Z1bmRpbmdTdWNjZXNzZnVsRmluaXNoZWQoKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGdldEN1cnJlbnRNaWxlc3RvbmVJZEhhc2goKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJ5dGVzMzIpOwogICAgZnVuY3Rpb24gcHJvY2Vzc01pbGVzdG9uZUZpbmlzaGVkKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBwcm9jZXNzRW1lcmdlbmN5RnVuZFJlbGVhc2VGaW5pc2hlZCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gZ2V0QWZ0ZXJUcmFuc2ZlckxvY2tlZFRva2VuQmFsYW5jZXMoYWRkcmVzcyB2YXVsdEFkZHJlc3MsIGJvb2wgZXhjbHVkZUN1cnJlbnQpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gVmF1bHRSZXF1ZXN0ZWRVcGRhdGVGb3JMb2NrZWRWb3RpbmdUb2tlbnMoYWRkcmVzcyBvd25lcikgcHVibGljOwogICAgZnVuY3Rpb24gZG9TdGF0ZUNoYW5nZXMoKSBwdWJsaWM7CiAgICBmdW5jdGlvbiBoYXNSZXF1aXJlZFN0YXRlQ2hhbmdlcygpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gZ2V0UmVxdWlyZWRTdGF0ZUNoYW5nZXMoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50OCwgdWludDgpOwogICAgZnVuY3Rpb24gQXBwbGljYXRpb25JbkZ1bmRpbmdPckRldmVsb3BtZW50KCkgcHVibGljIHZpZXcgcmV0dXJucyhib29sKTsKCn0KCi8qCgogKiBzb3VyY2UgICAgICAgaHR0cHM6Ly9naXRodWIuY29tL2Jsb2NrYml0c2lvLwoKICogQG5hbWUgICAgICAgIEZ1bmRpbmcgVmF1bHQKICogQHBhY2thZ2UgICAgIEJsb2NrQml0c0lPCiAqIEBhdXRob3IgICAgICBNaWNreSBTb2NhY2kgPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI5ZmYyZjZmY2Y0ZTZkZmYxZjBlOGYzZjZlOWZhYjFlZGYwIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4KCiAgICBlYWNoIHB1cmNoYXNlIGNyZWF0ZXMgYSBzZXBhcmF0ZSBmdW5kaW5nIHZhdWx0IGNvbnRyYWN0CiovCgoKCgoKCgoKCgoKCgpjb250cmFjdCBGdW5kaW5nVmF1bHQgewoKICAgIC8qIEFzc2V0IGluaXRpYWxpc2VkIG9yIG5vdCAqLwogICAgYm9vbCBwdWJsaWMgX2luaXRpYWxpemVkID0gZmFsc2U7CgogICAgLyoKICAgICAgICBBZGRyZXNzZXM6CiAgICAgICAgdmF1bHRPd25lciAtIHRoZSBhZGRyZXNzIG9mIHRoZSB3YWxsZXQgdGhhdCBzdG9yZXMgcHVyY2hhc2VzIGluIHRoaXMgdmF1bHQgKCBpbnZlc3RvciBhZGRyZXNzICkKICAgICAgICBvdXRwdXRBZGRyZXNzIC0gYWRkcmVzcyB3aGVyZSBmdW5kcyBnbyB1cG9uIHN1Y2Nlc3NmdWwgZnVuZGluZyBvciBzdWNjZXNzZnVsIG1pbGVzdG9uZSByZWxlYXNlCiAgICAgICAgbWFuYWdlckFkZHJlc3MgLSBhZGRyZXNzIG9mIHRoZSAiRnVuZGluZ01hbmFnZXIiCiAgICAqLwogICAgYWRkcmVzcyBwdWJsaWMgdmF1bHRPd25lciA7CiAgICBhZGRyZXNzIHB1YmxpYyBvdXRwdXRBZGRyZXNzOwogICAgYWRkcmVzcyBwdWJsaWMgbWFuYWdlckFkZHJlc3M7CgogICAgLyoKICAgICAgICBMb2NrIGFuZCBCbGFja0hvbGUgc2V0dGluZ3MKICAgICovCgogICAgYm9vbCBwdWJsaWMgYWxsRnVuZGluZ1Byb2Nlc3NlZCA9IGZhbHNlOwogICAgYm9vbCBwdWJsaWMgRGlyZWN0RnVuZGluZ1Byb2Nlc3NlZCA9IGZhbHNlOwoKICAgIC8qCiAgICAgICAgQXNzZXRzCiAgICAqLwogICAgLy8gQXBwbGljYXRpb25FbnRpdHlBQkkgcHVibGljIEFwcGxpY2F0aW9uRW50aXR5OwogICAgQUJJRnVuZGluZyBGdW5kaW5nRW50aXR5OwogICAgQUJJRnVuZGluZ01hbmFnZXIgRnVuZGluZ01hbmFnZXJFbnRpdHk7CiAgICBBQklNaWxlc3RvbmVzIE1pbGVzdG9uZXNFbnRpdHk7CiAgICBBQklQcm9wb3NhbHMgUHJvcG9zYWxzRW50aXR5OwogICAgQUJJVG9rZW5TQ0FEQVZhcmlhYmxlIFRva2VuU0NBREFFbnRpdHk7CiAgICBBQklUb2tlbiBUb2tlbkVudGl0eSA7CgogICAgLyoKICAgICAgICBHbG9iYWxzCiAgICAqLwogICAgdWludDI1NiBwdWJsaWMgYW1vdW50X2RpcmVjdCA9IDA7CiAgICB1aW50MjU2IHB1YmxpYyBhbW91bnRfbWlsZXN0b25lID0gMDsKCiAgICAvLyBieWxhd3MKICAgIGJvb2wgcHVibGljIGVtZXJnZW5jeUZ1bmRSZWxlYXNlZCA9IGZhbHNlOwogICAgdWludDggZW1lcmdlbmN5RnVuZFBlcmNlbnRhZ2UgPSAwOwogICAgdWludDI1NiBCeWxhd3NDYXNoQmFja093bmVyTWlhRHVyYXRpb247CiAgICB1aW50MjU2IEJ5bGF3c0Nhc2hCYWNrVm90ZVJlamVjdGVkRHVyYXRpb247CiAgICB1aW50MjU2IEJ5bGF3c1Byb3Bvc2FsVm90aW5nRHVyYXRpb247CgogICAgc3RydWN0IFB1cmNoYXNlU3RydWN0IHsKICAgICAgICB1aW50MjU2IHVuaXhfdGltZTsKICAgICAgICB1aW50OCBwYXltZW50X21ldGhvZDsKICAgICAgICB1aW50MjU2IGFtb3VudDsKICAgICAgICB1aW50OCBmdW5kaW5nX3N0YWdlOwogICAgICAgIHVpbnQxNiBpbmRleDsKICAgIH0KCiAgICBtYXBwaW5nKHVpbnQxNiA9PiBQdXJjaGFzZVN0cnVjdCkgcHVibGljIHB1cmNoYXNlUmVjb3JkczsKICAgIHVpbnQxNiBwdWJsaWMgcHVyY2hhc2VSZWNvcmRzTnVtOwoKICAgIGV2ZW50IEV2ZW50UGF5bWVudFJlY2VpdmVkKHVpbnQ4IGluZGV4ZWQgX3BheW1lbnRfbWV0aG9kLCB1aW50MjU2IGluZGV4ZWQgX2Ftb3VudCwgdWludDE2IGluZGV4ZWQgX2luZGV4ICk7CiAgICBldmVudCBWYXVsdEluaXRpYWxpemVkKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIpOwoKICAgIGZ1bmN0aW9uIGluaXRpYWxpemUoCiAgICAgICAgYWRkcmVzcyBfb3duZXIsCiAgICAgICAgYWRkcmVzcyBfb3V0cHV0LAogICAgICAgIGFkZHJlc3MgX2Z1bmRpbmdBZGRyZXNzLAogICAgICAgIGFkZHJlc3MgX21pbGVzdG9uZUFkZHJlc3MsCiAgICAgICAgYWRkcmVzcyBfcHJvcG9zYWxzQWRkcmVzcwogICAgKQogICAgICAgIHB1YmxpYwogICAgICAgIHJlcXVpcmVOb3RJbml0aWFsaXNlZAogICAgICAgIHJldHVybnMoYm9vbCkKICAgIHsKICAgICAgICBWYXVsdEluaXRpYWxpemVkKF9vd25lcik7CgogICAgICAgIG91dHB1dEFkZHJlc3MgPSBfb3V0cHV0OwogICAgICAgIHZhdWx0T3duZXIgPSBfb3duZXI7CgogICAgICAgIC8vIHdob21ldmVyIGNyZWF0ZXMgdGhpcyBjb250cmFjdCBpcyB0aGUgbWFuYWdlci4KICAgICAgICBtYW5hZ2VyQWRkcmVzcyA9IG1zZy5zZW5kZXI7CgogICAgICAgIC8vIGFzc2V0cwogICAgICAgIEZ1bmRpbmdFbnRpdHkgPSBBQklGdW5kaW5nKF9mdW5kaW5nQWRkcmVzcyk7CiAgICAgICAgRnVuZGluZ01hbmFnZXJFbnRpdHkgPSBBQklGdW5kaW5nTWFuYWdlcihtYW5hZ2VyQWRkcmVzcyk7CiAgICAgICAgTWlsZXN0b25lc0VudGl0eSA9IEFCSU1pbGVzdG9uZXMoX21pbGVzdG9uZUFkZHJlc3MpOwogICAgICAgIFByb3Bvc2Fsc0VudGl0eSA9IEFCSVByb3Bvc2FscyhfcHJvcG9zYWxzQWRkcmVzcyk7CgogICAgICAgIGFkZHJlc3MgVG9rZW5NYW5hZ2VyQWRkcmVzcyA9IEZ1bmRpbmdFbnRpdHkuZ2V0QXBwbGljYXRpb25Bc3NldEFkZHJlc3NCeU5hbWUoIlRva2VuTWFuYWdlciIpOwogICAgICAgIEFCSVRva2VuTWFuYWdlciBUb2tlbk1hbmFnZXJFbnRpdHkgPSBBQklUb2tlbk1hbmFnZXIoVG9rZW5NYW5hZ2VyQWRkcmVzcyk7CgogICAgICAgIGFkZHJlc3MgVG9rZW5BZGRyZXNzID0gVG9rZW5NYW5hZ2VyRW50aXR5LlRva2VuRW50aXR5KCk7CiAgICAgICAgVG9rZW5FbnRpdHkgPSBBQklUb2tlbihUb2tlbkFkZHJlc3MpOwoKICAgICAgICBhZGRyZXNzIFRva2VuU0NBREFBZGRyZXNzID0gVG9rZW5NYW5hZ2VyRW50aXR5LlRva2VuU0NBREFFbnRpdHkoKTsKICAgICAgICBUb2tlblNDQURBRW50aXR5ID0gQUJJVG9rZW5TQ0FEQVZhcmlhYmxlKFRva2VuU0NBREFBZGRyZXNzKTsKCiAgICAgICAgLy8gc2V0IEVtZXJnZW5jeSBGdW5kIFBlcmNlbnRhZ2UgaWYgYXZhaWxhYmxlLgogICAgICAgIGFkZHJlc3MgQXBwbGljYXRpb25FbnRpdHlBZGRyZXNzID0gVG9rZW5NYW5hZ2VyRW50aXR5Lm93bmVyKCk7CiAgICAgICAgQXBwbGljYXRpb25FbnRpdHlBQkkgQXBwbGljYXRpb25FbnRpdHkgPSBBcHBsaWNhdGlvbkVudGl0eUFCSShBcHBsaWNhdGlvbkVudGl0eUFkZHJlc3MpOwoKICAgICAgICAvLyBnZXQgQXBwbGljYXRpb24gQnlsYXdzCiAgICAgICAgZW1lcmdlbmN5RnVuZFBlcmNlbnRhZ2UgICAgICAgICAgICAgPSB1aW50OCggQXBwbGljYXRpb25FbnRpdHkuZ2V0QnlsYXdVaW50MjU2KCJlbWVyZ2VuY3lfZnVuZF9wZXJjZW50YWdlIikgKTsKICAgICAgICBCeWxhd3NDYXNoQmFja093bmVyTWlhRHVyYXRpb24gICAgICA9IEFwcGxpY2F0aW9uRW50aXR5LmdldEJ5bGF3VWludDI1NigiY2FzaGJhY2tfb3duZXJfbWlhX2R1ciIpIDsKICAgICAgICBCeWxhd3NDYXNoQmFja1ZvdGVSZWplY3RlZER1cmF0aW9uICA9IEFwcGxpY2F0aW9uRW50aXR5LmdldEJ5bGF3VWludDI1NigiY2FzaGJhY2tfaW52ZXN0b3Jfbm8iKSA7CiAgICAgICAgQnlsYXdzUHJvcG9zYWxWb3RpbmdEdXJhdGlvbiAgICAgICAgPSBBcHBsaWNhdGlvbkVudGl0eS5nZXRCeWxhd1VpbnQyNTYoInByb3Bvc2FsX3ZvdGluZ19kdXJhdGlvbiIpIDsKCiAgICAgICAgLy8gaW5pdAogICAgICAgIF9pbml0aWFsaXplZCA9IHRydWU7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgoKCiAgICAvKgogICAgICAgIFRoZSBmdW5kaW5nIGNvbnRyYWN0IGRlY2lkZXMgaWYgYSB2YXVsdCBzaG91bGQgcmVjZWl2ZSBwYXltZW50cyBvciBub3QsIHNpbmNlIGl0J3MgdGhlIG9uZSB0aGF0IGNyZWF0ZXMgdGhlbSwKICAgICAgICBubyBwb2ludCBpbiBjcmVhdGluZyBvbmUgaWYgeW91IGNhbid0IGFjY2VwdCBwYXltZW50cy4KICAgICovCgogICAgbWFwcGluZyAodWludDggPT4gdWludDI1NikgcHVibGljIHN0YWdlQW1vdW50czsKICAgIG1hcHBpbmcgKHVpbnQ4ID0+IHVpbnQyNTYpIHB1YmxpYyBzdGFnZUFtb3VudHNEaXJlY3Q7CgogICAgZnVuY3Rpb24gYWRkUGF5bWVudCgKICAgICAgICB1aW50OCBfcGF5bWVudF9tZXRob2QsCiAgICAgICAgdWludDggX2Z1bmRpbmdfc3RhZ2UKICAgICkKICAgICAgICBwdWJsaWMKICAgICAgICBwYXlhYmxlCiAgICAgICAgcmVxdWlyZUluaXRpYWxpc2VkCiAgICAgICAgb25seU1hbmFnZXIKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGlmKG1zZy52YWx1ZSA+IDAgJiYgRnVuZGluZ0VudGl0eS5hbGxvd2VkUGF5bWVudE1ldGhvZChfcGF5bWVudF9tZXRob2QpKSB7CgogICAgICAgICAgICAvLyBzdG9yZSBwYXltZW50CiAgICAgICAgICAgIFB1cmNoYXNlU3RydWN0IHN0b3JhZ2UgcHVyY2hhc2UgPSBwdXJjaGFzZVJlY29yZHNbKytwdXJjaGFzZVJlY29yZHNOdW1dOwogICAgICAgICAgICAgICAgcHVyY2hhc2UudW5peF90aW1lID0gbm93OwogICAgICAgICAgICAgICAgcHVyY2hhc2UucGF5bWVudF9tZXRob2QgPSBfcGF5bWVudF9tZXRob2Q7CiAgICAgICAgICAgICAgICBwdXJjaGFzZS5hbW91bnQgPSBtc2cudmFsdWU7CiAgICAgICAgICAgICAgICBwdXJjaGFzZS5mdW5kaW5nX3N0YWdlID0gX2Z1bmRpbmdfc3RhZ2U7CiAgICAgICAgICAgICAgICBwdXJjaGFzZS5pbmRleCA9IHB1cmNoYXNlUmVjb3Jkc051bTsKCiAgICAgICAgICAgIC8vIGFzc2lnbiBwYXltZW50IHRvIGRpcmVjdCBvciBtaWxlc3RvbmUKICAgICAgICAgICAgaWYoX3BheW1lbnRfbWV0aG9kID09IDEpIHsKICAgICAgICAgICAgICAgIGFtb3VudF9kaXJlY3QrPSBwdXJjaGFzZS5hbW91bnQ7CiAgICAgICAgICAgICAgICBzdGFnZUFtb3VudHNEaXJlY3RbX2Z1bmRpbmdfc3RhZ2VdKz1wdXJjaGFzZS5hbW91bnQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKF9wYXltZW50X21ldGhvZCA9PSAyKSB7CiAgICAgICAgICAgICAgICBhbW91bnRfbWlsZXN0b25lKz0gcHVyY2hhc2UuYW1vdW50OwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBpbiBvcmRlciB0byBub3QgaXRlcmF0ZSB0aHJvdWdoIHB1cmNoYXNlIHJlY29yZHMsIHdlIGp1c3QgaW5jcmVhc2UgZnVuZGluZyBzdGFnZSBhbW91bnQuCiAgICAgICAgICAgIC8vIGlzc3VlIHdpdGggaXRlcmF0aW5nIG92ZXIgdGhlbSwgd2hpbGUgcHJvY2Vzc2luZyB2YXVsdHMsIHdvdWxkIGJlIHRoYXQgc29tZW9uZSBjb3VsZCBjcmVhdGUgYSBsYXJnZQogICAgICAgICAgICAvLyBudW1iZXIgb2YgcGF5bWVudHMsIHdoaWNoIHdvdWxkIHJlc3VsdCBpbiBhbiAib3V0IG9mIGdhcyIgLyBzdGFjayBvdmVyZmxvdyBpc3N1ZSwgdGhhdCB3b3VsZCBsb2NrCiAgICAgICAgICAgIC8vIG91ciBjb250cmFjdCwgc28gd2UgZG9uJ3QgcmVhbGx5IHdhbnQgdG8gZG8gdGhhdC4KICAgICAgICAgICAgLy8gZG9pbmcgaXQgdGhpcyB3YXkgYWxzbyBzYXZlcyBzb21lIGdhcwogICAgICAgICAgICBzdGFnZUFtb3VudHNbX2Z1bmRpbmdfc3RhZ2VdKz1wdXJjaGFzZS5hbW91bnQ7CgogICAgICAgICAgICBFdmVudFBheW1lbnRSZWNlaXZlZCggcHVyY2hhc2UucGF5bWVudF9tZXRob2QsIHB1cmNoYXNlLmFtb3VudCwgcHVyY2hhc2UuaW5kZXggKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGdldEJvdWdodFRva2VucygpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gVG9rZW5TQ0FEQUVudGl0eS5nZXRCb3VnaHRUb2tlbnMoIGFkZHJlc3ModGhpcyksIGZhbHNlICk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0RGlyZWN0Qm91Z2h0VG9rZW5zKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBUb2tlblNDQURBRW50aXR5LmdldEJvdWdodFRva2VucyggYWRkcmVzcyh0aGlzKSwgdHJ1ZSApOwogICAgfQoKCiAgICBtYXBwaW5nICh1aW50OCA9PiB1aW50MjU2KSBwdWJsaWMgZXRoZXJCYWxhbmNlczsKICAgIG1hcHBpbmcgKHVpbnQ4ID0+IHVpbnQyNTYpIHB1YmxpYyB0b2tlbkJhbGFuY2VzOwogICAgdWludDggcHVibGljIEJhbGFuY2VOdW0gPSAwOwoKICAgIGJvb2wgcHVibGljIEJhbGFuY2VzSW5pdGlhbGlzZWQgPSBmYWxzZTsKICAgIGZ1bmN0aW9uIGluaXRNaWxlc3RvbmVUb2tlbkFuZEV0aGVyQmFsYW5jZXMoKSBpbnRlcm5hbAogICAgewogICAgICAgIGlmKEJhbGFuY2VzSW5pdGlhbGlzZWQgPT0gZmFsc2UpIHsKCiAgICAgICAgICAgIHVpbnQyNTYgbWlsZXN0b25lVG9rZW5CYWxhbmNlID0gVG9rZW5FbnRpdHkuYmFsYW5jZU9mKGFkZHJlc3ModGhpcykpOwogICAgICAgICAgICB1aW50MjU2IG1pbGVzdG9uZUV0aGVyQmFsYW5jZSA9IHRoaXMuYmFsYW5jZTsKCiAgICAgICAgICAgIC8vIG5vIG5lZWQgdG8gd29ycnkgYWJvdXQgZnJhY3Rpb25zIGJlY2F1c2UgYXQgdGhlIGxhc3QgbWlsZXN0b25lLCB3ZSBzZW5kIGV2ZXJ5dGhpbmcgdGhhdCdzIGxlZnQuCgogICAgICAgICAgICAvLyBlbWVyZ2VuY3kgZnVuZCB0YWtlcyBpdCdzIHBlcmNlbnRhZ2UgZnJvbSBpbml0aWFsIGJhbGFuY2VzLgogICAgICAgICAgICBpZihlbWVyZ2VuY3lGdW5kUGVyY2VudGFnZSA+IDApIHsKICAgICAgICAgICAgICAgIHRva2VuQmFsYW5jZXNbMF0gPSBtaWxlc3RvbmVUb2tlbkJhbGFuY2UgLyAxMDAgKiBlbWVyZ2VuY3lGdW5kUGVyY2VudGFnZTsKICAgICAgICAgICAgICAgIGV0aGVyQmFsYW5jZXNbMF0gPSBtaWxlc3RvbmVFdGhlckJhbGFuY2UgLyAxMDAgKiBlbWVyZ2VuY3lGdW5kUGVyY2VudGFnZTsKCiAgICAgICAgICAgICAgICBtaWxlc3RvbmVUb2tlbkJhbGFuY2UtPXRva2VuQmFsYW5jZXNbMF07CiAgICAgICAgICAgICAgICBtaWxlc3RvbmVFdGhlckJhbGFuY2UtPWV0aGVyQmFsYW5jZXNbMF07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG1pbGVzdG9uZXMgcGVyY2VudGFnZXMgYXJlIHRoZW4gdGFrZW4gZnJvbSB3aGF0J3MgbGVmdC4KICAgICAgICAgICAgZm9yKHVpbnQ4IGkgPSAxOyBpIDw9IE1pbGVzdG9uZXNFbnRpdHkuUmVjb3JkTnVtKCk7IGkrKykgewoKICAgICAgICAgICAgICAgIHVpbnQ4IHBlcmMgPSBNaWxlc3RvbmVzRW50aXR5LmdldE1pbGVzdG9uZUZ1bmRpbmdQZXJjZW50YWdlKGkpOwogICAgICAgICAgICAgICAgdG9rZW5CYWxhbmNlc1tpXSA9IG1pbGVzdG9uZVRva2VuQmFsYW5jZSAvIDEwMCAqIHBlcmM7CiAgICAgICAgICAgICAgICBldGhlckJhbGFuY2VzW2ldID0gbWlsZXN0b25lRXRoZXJCYWxhbmNlIC8gMTAwICogcGVyYzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgQmFsYW5jZU51bSA9IGk7CiAgICAgICAgICAgIEJhbGFuY2VzSW5pdGlhbGlzZWQgPSB0cnVlOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBSZWxlYXNlRnVuZHNBbmRUb2tlbnMoKQogICAgICAgIHB1YmxpYwogICAgICAgIHJlcXVpcmVJbml0aWFsaXNlZAogICAgICAgIG9ubHlNYW5hZ2VyCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICAvLyBmaXJzdCBtYWtlIHN1cmUgY2FzaGJhY2sgaXMgbm90IHBvc3NpYmxlLCBhbmQgdGhhdCB3ZSd2ZSBub3QgcHJvY2Vzc2VkIGV2ZXJ5dGhpbmcgaW4gdGhpcyB2YXVsdAogICAgICAgIGlmKCFjYW5DYXNoQmFjaygpICYmIGFsbEZ1bmRpbmdQcm9jZXNzZWQgPT0gZmFsc2UpIHsKCiAgICAgICAgICAgIGlmKEZ1bmRpbmdNYW5hZ2VyRW50aXR5LkN1cnJlbnRFbnRpdHlTdGF0ZSgpID09IEZ1bmRpbmdNYW5hZ2VyRW50aXR5LmdldEVudGl0eVN0YXRlKCJGVU5ESU5HX1NVQ0NFU1NGVUxfUFJPR1JFU1MiKSkgewoKICAgICAgICAgICAgICAgIC8vIGNhc2UgMSwgZGlyZWN0IGZ1bmRpbmcgb25seQogICAgICAgICAgICAgICAgaWYoYW1vdW50X2RpcmVjdCA+IDAgJiYgYW1vdW50X21pbGVzdG9uZSA9PSAwKSB7CgogICAgICAgICAgICAgICAgICAgIC8vIGlmIHdlIGhhdmUgZGlyZWN0IGZ1bmRpbmcgYW5kIG5vIG1pbGVzdG9uZSBiYWxhbmNlLCB0cmFuc2ZlciBldmVyeXRoaW5nIGFuZCBsb2NrIHZhdWx0CiAgICAgICAgICAgICAgICAgICAgLy8gdG8gc2F2ZSBnYXMgaW4gZnV0dXJlIHByb2Nlc3NpbmcgcnVucy4KCiAgICAgICAgICAgICAgICAgICAgLy8gdHJhbnNmZXIgdG9rZW5zIHRvIHRoZSBpbnZlc3RvcgogICAgICAgICAgICAgICAgICAgIFRva2VuRW50aXR5LnRyYW5zZmVyKHZhdWx0T3duZXIsIFRva2VuRW50aXR5LmJhbGFuY2VPZiggYWRkcmVzcyh0aGlzKSApICk7CgogICAgICAgICAgICAgICAgICAgIC8vIHRyYW5zZmVyIGV0aGVyIHRvIHRoZSBvd25lcidzIHdhbGxldAogICAgICAgICAgICAgICAgICAgIG91dHB1dEFkZHJlc3MudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gbG9jayB2YXVsdC4uIGFuZCBlbmFibGUgYmxhY2sgaG9sZSBtZXRob2RzCiAgICAgICAgICAgICAgICAgICAgYWxsRnVuZGluZ1Byb2Nlc3NlZCA9IHRydWU7CgogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIGNhc2UgMiBhbmQgMywgZGlyZWN0IGZ1bmRpbmcgb25seQoKICAgICAgICAgICAgICAgICAgICBpZihhbW91bnRfZGlyZWN0ID4gMCAmJiBEaXJlY3RGdW5kaW5nUHJvY2Vzc2VkID09IGZhbHNlICkgewogICAgICAgICAgICAgICAgICAgICAgICBUb2tlbkVudGl0eS50cmFuc2Zlcih2YXVsdE93bmVyLCBnZXREaXJlY3RCb3VnaHRUb2tlbnMoKSApOwogICAgICAgICAgICAgICAgICAgICAgICAvLyB0cmFuc2ZlciAiZGlyZWN0IGZ1bmRpbmciIGV0aGVyIHRvIHRoZSBvd25lcidzIHdhbGxldAogICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRBZGRyZXNzLnRyYW5zZmVyKGFtb3VudF9kaXJlY3QpOwogICAgICAgICAgICAgICAgICAgICAgICBEaXJlY3RGdW5kaW5nUHJvY2Vzc2VkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIHByb2Nlc3MgYW5kIGluaXRpYWxpemUgbWlsZXN0b25lIGJhbGFuY2VzLCBlbWVyZ2VuY3kgZnVuZCwgZXRjLCBvbmNlCiAgICAgICAgICAgICAgICAgICAgaW5pdE1pbGVzdG9uZVRva2VuQW5kRXRoZXJCYWxhbmNlcygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CgogICAgICAgICAgICB9IGVsc2UgaWYoRnVuZGluZ01hbmFnZXJFbnRpdHkuQ3VycmVudEVudGl0eVN0YXRlKCkgPT0gRnVuZGluZ01hbmFnZXJFbnRpdHkuZ2V0RW50aXR5U3RhdGUoIk1JTEVTVE9ORV9QUk9DRVNTX1BST0dSRVNTIikpIHsKCiAgICAgICAgICAgICAgICAvLyBnZXQgY3VycmVudCBtaWxlc3RvbmUgc28gd2Uga25vdyB3aGljaCBvbmUgd2UgbmVlZCB0byByZWxlYXNlIGZ1bmRzIGZvci4KICAgICAgICAgICAgICAgIHVpbnQ4IG1pbGVzdG9uZUlkID0gTWlsZXN0b25lc0VudGl0eS5jdXJyZW50UmVjb3JkKCk7CgogICAgICAgICAgICAgICAgdWludDI1NiB0cmFuc2ZlclRva2VucyA9IHRva2VuQmFsYW5jZXNbbWlsZXN0b25lSWRdOwogICAgICAgICAgICAgICAgdWludDI1NiB0cmFuc2ZlckV0aGVyID0gZXRoZXJCYWxhbmNlc1ttaWxlc3RvbmVJZF07CgogICAgICAgICAgICAgICAgaWYobWlsZXN0b25lSWQgPT0gQmFsYW5jZU51bSAtIDEpIHsKICAgICAgICAgICAgICAgICAgICAvLyB3ZSdyZSBwcm9jZXNzaW5nIHRoZSBsYXN0IG1pbGVzdG9uZSBhbmQgYmFsYW5jZSwgdGhpcyBtZWFucyB3ZSdyZSB0cmFuc2ZlcnJpbmcgZXZlcnl0aGluZyBsZWZ0LgogICAgICAgICAgICAgICAgICAgIC8vIHRoaXMgaXMgZG9uZSB0byBtYWtlIHN1cmUgd2UndmUgdHJhbnNmZXJyZWQgZXZlcnl0aGluZywgZXZlbiAiZXRoZXIgdGhhdCBnb3QgbWlzdGFrZW5seSBzZW50IHRvIHRoaXMgYWRkcmVzcyIKICAgICAgICAgICAgICAgICAgICAvLyBhcyB3ZWxsIGFzIHRoZSBlbWVyZ2VuY3kgZnVuZCBpZiBpdCBoYXMgbm90IGJlZW4gdXNlZC4KICAgICAgICAgICAgICAgICAgICB0cmFuc2ZlclRva2VucyA9IFRva2VuRW50aXR5LmJhbGFuY2VPZihhZGRyZXNzKHRoaXMpKTsKICAgICAgICAgICAgICAgICAgICB0cmFuc2ZlckV0aGVyID0gdGhpcy5iYWxhbmNlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIHNldCBiYWxhbmNlcyB0byAwIHNvIHdlIGNhbid0IHRyYW5zZmVyIG11bHRpcGxlIHRpbWVzLgogICAgICAgICAgICAgICAgLy8gdG9rZW5CYWxhbmNlc1ttaWxlc3RvbmVJZF0gPSAwOwogICAgICAgICAgICAgICAgLy8gZXRoZXJCYWxhbmNlc1ttaWxlc3RvbmVJZF0gPSAwOwoKICAgICAgICAgICAgICAgIC8vIHRyYW5zZmVyIHRva2VucyB0byB0aGUgaW52ZXN0b3IKICAgICAgICAgICAgICAgIFRva2VuRW50aXR5LnRyYW5zZmVyKHZhdWx0T3duZXIsIHRyYW5zZmVyVG9rZW5zICk7CgogICAgICAgICAgICAgICAgLy8gdHJhbnNmZXIgZXRoZXIgdG8gdGhlIG93bmVyJ3Mgd2FsbGV0CiAgICAgICAgICAgICAgICBvdXRwdXRBZGRyZXNzLnRyYW5zZmVyKHRyYW5zZmVyRXRoZXIpOwoKICAgICAgICAgICAgICAgIGlmKG1pbGVzdG9uZUlkID09IEJhbGFuY2VOdW0gLSAxKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gbG9jayB2YXVsdC4uIGFuZCBlbmFibGUgYmxhY2sgaG9sZSBtZXRob2RzCiAgICAgICAgICAgICAgICAgICAgYWxsRnVuZGluZ1Byb2Nlc3NlZCA9IHRydWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCgogICAgZnVuY3Rpb24gcmVsZWFzZVRva2Vuc0FuZEV0aGVyRm9yRW1lcmdlbmN5RnVuZCgpCiAgICAgICAgcHVibGljCiAgICAgICAgcmVxdWlyZUluaXRpYWxpc2VkCiAgICAgICAgb25seU1hbmFnZXIKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGlmKCBlbWVyZ2VuY3lGdW5kUmVsZWFzZWQgPT0gZmFsc2UgJiYgZW1lcmdlbmN5RnVuZFBlcmNlbnRhZ2UgPiAwKSB7CgogICAgICAgICAgICAvLyB0cmFuc2ZlciB0b2tlbnMgdG8gdGhlIGludmVzdG9yCiAgICAgICAgICAgIFRva2VuRW50aXR5LnRyYW5zZmVyKHZhdWx0T3duZXIsIHRva2VuQmFsYW5jZXNbMF0gKTsKCiAgICAgICAgICAgIC8vIHRyYW5zZmVyIGV0aGVyIHRvIHRoZSBvd25lcidzIHdhbGxldAogICAgICAgICAgICBvdXRwdXRBZGRyZXNzLnRyYW5zZmVyKGV0aGVyQmFsYW5jZXNbMF0pOwoKICAgICAgICAgICAgZW1lcmdlbmN5RnVuZFJlbGVhc2VkID0gdHJ1ZTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBSZWxlYXNlRnVuZHNUb0ludmVzdG9yKCkKICAgICAgICBwdWJsaWMKICAgICAgICByZXF1aXJlSW5pdGlhbGlzZWQKICAgICAgICBpc093bmVyCiAgICB7CiAgICAgICAgaWYoY2FuQ2FzaEJhY2soKSkgewoKICAgICAgICAgICAgLy8gSUYgd2UncmUgZG9pbmcgYSBjYXNoYmFjawogICAgICAgICAgICAvLyB0cmFuc2ZlciB2YXVsdCB0b2tlbnMgYmFjayB0byBvd25lciBhZGRyZXNzCiAgICAgICAgICAgIC8vIHNlbmQgYWxsIGV0aGVyIHRvIHdhbGxldCBvd25lcgoKICAgICAgICAgICAgLy8gZ2V0IHRva2VuIGJhbGFuY2UKICAgICAgICAgICAgdWludDI1NiBteUJhbGFuY2UgPSBUb2tlbkVudGl0eS5iYWxhbmNlT2YoYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgICAgIC8vIHRyYW5zZmVyIGFsbCB2YXVsdCB0b2tlbnMgdG8gb3duZXIKICAgICAgICAgICAgaWYobXlCYWxhbmNlID4gMCkgewogICAgICAgICAgICAgICAgVG9rZW5FbnRpdHkudHJhbnNmZXIob3V0cHV0QWRkcmVzcywgbXlCYWxhbmNlICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG5vdyB0cmFuc2ZlciBhbGwgcmVtYWluaW5nIGV0aGVyIGJhY2sgdG8gaW52ZXN0b3IgYWRkcmVzcwogICAgICAgICAgICB2YXVsdE93bmVyLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CgogICAgICAgICAgICAvLyB1cGRhdGUgRnVuZGluZ01hbmFnZXIgTG9ja2VkIFRva2VuIEFtb3VudCwgc28gd2UgZG9uJ3QgYnJlYWsgdm90aW5nCiAgICAgICAgICAgIEZ1bmRpbmdNYW5hZ2VyRW50aXR5LlZhdWx0UmVxdWVzdGVkVXBkYXRlRm9yTG9ja2VkVm90aW5nVG9rZW5zKCB2YXVsdE93bmVyICk7CgogICAgICAgICAgICAvLyBkaXNhbGxvdyBmdXJ0aGVyIHByb2Nlc3NpbmcsIHNvIHdlIGRvbid0IGJyZWFrIEZ1bmRpbmcgTWFuYWdlci4KICAgICAgICAgICAgLy8gdGhpcyBtZXRob2QgY2FuIHN0aWxsIGJlIGNhbGxlZCB0byBjb2xsZWN0IGZ1dHVyZSBibGFjayBob2xlIGV0aGVyIHRvIHRoaXMgdmF1bHQuCiAgICAgICAgICAgIGFsbEZ1bmRpbmdQcm9jZXNzZWQgPSB0cnVlOwogICAgICAgIH0KICAgIH0KCiAgICAvKgogICAgICAgIDEgLSBpZiB0aGUgZnVuZGluZyBvZiB0aGUgcHJvamVjdCBGYWlsZWQsIGFsbG93cyBpbnZlc3RvcnMgdG8gY2xhaW0gdGhlaXIgbG9ja2VkIGV0aGVyIGJhY2suCiAgICAgICAgMiAtIGlmIHRoZSBJbnZlc3RvciB2b3RlcyBOTyB0byBhIERldmVsb3BtZW50IE1pbGVzdG9uZSBDb21wbGV0aW9uIFByb3Bvc2FsLCB3aGVyZSB0aGUgbWFqb3JpdHkKICAgICAgICAgICAgYWxzbyB2b3RlcyBOTyBhbGxvd3MgaW52ZXN0b3JzIHRvIGNsYWltIHRoZWlyIGxvY2tlZCBldGhlciBiYWNrLgogICAgICAgIDMgLSBwcm9qZWN0IG93bmVyIG1pc3NlcyB0byBzZXQgdGhlIHRpbWUgZm9yIGEgRGV2ZWxvcG1lbnQgTWlsZXN0b25lIENvbXBsZXRpb24gTWVldGluZyBhbGxvd3MgaW52ZXN0b3JzCiAgICAgICAgdG8gY2xhaW0gdGhlaXIgbG9ja2VkIGV0aGVyIGJhY2suCiAgICAqLwogICAgZnVuY3Rpb24gY2FuQ2FzaEJhY2soKSBwdWJsaWMgdmlldyByZXF1aXJlSW5pdGlhbGlzZWQgcmV0dXJucyAoYm9vbCkgewoKICAgICAgICAvLyBjYXNlIDEKICAgICAgICBpZihjaGVja0Z1bmRpbmdTdGF0ZUZhaWxlZCgpKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICAvLyBjYXNlIDIKICAgICAgICBpZihjaGVja01pbGVzdG9uZVN0YXRlSW52ZXN0b3JWb3RlZE5vVm90aW5nRW5kZWRObygpKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICAvLyBjYXNlIDMKICAgICAgICBpZihjaGVja093bmVyRmFpbGVkVG9TZXRUaW1lT25NZWV0aW5nKCkpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgZnVuY3Rpb24gY2hlY2tGdW5kaW5nU3RhdGVGYWlsZWQoKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgaWYoRnVuZGluZ0VudGl0eS5DdXJyZW50RW50aXR5U3RhdGUoKSA9PSBGdW5kaW5nRW50aXR5LmdldEVudGl0eVN0YXRlKCJGQUlMRURfRklOQUwiKSApIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICAvLyBhbHNvIGNoZWNrIGlmIGZ1bmRpbmcgcGVyaW9kIGVuZGVkLCBhbmQgNyBkYXlzIGhhdmUgcGFzc2VkIGFuZCBubyBwcm9jZXNzaW5nIHdhcyBkb25lLgogICAgICAgIGlmKCBGdW5kaW5nRW50aXR5LmdldFRpbWVzdGFtcCgpID49IEZ1bmRpbmdFbnRpdHkuRnVuZGluZ19TZXR0aW5nX2Nhc2hiYWNrX3RpbWVfc3RhcnQoKSApIHsKCiAgICAgICAgICAgIC8vIHNob3VsZCBvbmx5IGJlIHBvc3NpYmxlIGlmIGZ1bmRpbmcgZW50aXR5IGhhcyBiZWVuIHN0dWNrIGluIHByb2Nlc3NpbmcgZm9yIG1vcmUgdGhhbiA3IGRheXMuCiAgICAgICAgICAgIGlmKCBGdW5kaW5nRW50aXR5LkN1cnJlbnRFbnRpdHlTdGF0ZSgpICE9IEZ1bmRpbmdFbnRpdHkuZ2V0RW50aXR5U3RhdGUoIlNVQ0NFU1NGVUxfRklOQUwiKSApIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgZnVuY3Rpb24gY2hlY2tNaWxlc3RvbmVTdGF0ZUludmVzdG9yVm90ZWROb1ZvdGluZ0VuZGVkTm8oKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgaWYoTWlsZXN0b25lc0VudGl0eS5DdXJyZW50RW50aXR5U3RhdGUoKSA9PSBNaWxlc3RvbmVzRW50aXR5LmdldEVudGl0eVN0YXRlKCJWT1RJTkdfRU5ERURfTk8iKSApIHsKICAgICAgICAgICAgLy8gZmlyc3Qgd2UgbmVlZCB0byBtYWtlIHN1cmUgd2UgYWN0dWFsbHkgdm90ZWQuCiAgICAgICAgICAgIGlmKCBQcm9wb3NhbHNFbnRpdHkuZ2V0SGFzVm90ZUZvckN1cnJlbnRNaWxlc3RvbmVSZWxlYXNlKHZhdWx0T3duZXIpID09IHRydWUpIHsKICAgICAgICAgICAgICAgIC8vIG5vdyBtYWtlIHN1cmUgd2Ugdm90ZWQgTk8sIGFuZCBpZiBzbyByZXR1cm4gdHJ1ZQogICAgICAgICAgICAgICAgaWYoIFByb3Bvc2Fsc0VudGl0eS5nZXRNeVZvdGVGb3JDdXJyZW50TWlsZXN0b25lUmVsZWFzZSggdmF1bHRPd25lciApID09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIGNoZWNrT3duZXJGYWlsZWRUb1NldFRpbWVPbk1lZXRpbmcoKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgLy8gTG9va3MgbGlrZSB0aGUgcHJvamVjdCBvd25lciBpcyBtaXNzaW5nIGluIGFjdGlvbgogICAgICAgIC8vIHRoZXkgb25seSBoYXZlIHRvIGRvIDEgdGhpbmcsIHdoaWNoIGlzIHNldCB0aGUgbWVldGluZyB0aW1lIDcgZGF5cyBiZWZvcmUgdGhlIGVuZCBvZiB0aGUgbWlsZXN0b25lIHNvIHRoYXQKICAgICAgICAvLyBpbnZlc3RvcnMga25vdyB3aGVuIHRoZXkgbmVlZCB0byBzaG93IHVwIGZvciBhIHByb2dyZXNzIHJlcG9ydCBtZWV0aW5nCgogICAgICAgIC8vIGFzIHRoZXkgZGlkIG5vdCwgd2UgY29uc2lkZXIgdGhlbSBtaXNzaW5nIGluIGFjdGlvbiBhbmQgYWxsb3cgaW52ZXN0b3JzIHRvIHJldHJpZXZlIHRoZWlyIGxvY2tlZCBldGhlciBiYWNrCiAgICAgICAgaWYoIE1pbGVzdG9uZXNFbnRpdHkuQ3VycmVudEVudGl0eVN0YXRlKCkgPT0gTWlsZXN0b25lc0VudGl0eS5nZXRFbnRpdHlTdGF0ZSgiREVBRExJTkVfTUVFVElOR19USU1FX0ZBSUxFRCIpICkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKCiAgICBtb2RpZmllciBpc093bmVyKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSB2YXVsdE93bmVyKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlNYW5hZ2VyKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBtYW5hZ2VyQWRkcmVzcyk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciByZXF1aXJlSW5pdGlhbGlzZWQoKSB7CiAgICAgICAgcmVxdWlyZShfaW5pdGlhbGl6ZWQgPT0gdHJ1ZSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciByZXF1aXJlTm90SW5pdGlhbGlzZWQoKSB7CiAgICAgICAgcmVxdWlyZShfaW5pdGlhbGl6ZWQgPT0gZmFsc2UpOwogICAgICAgIF87CiAgICB9Cn0KCi8qCgogKiBzb3VyY2UgICAgICAgaHR0cHM6Ly9naXRodWIuY29tL2Jsb2NrYml0c2lvLwoKICogQG5hbWUgICAgICAgIEZ1bmRpbmcgQ29udHJhY3QKICogQHBhY2thZ2UgICAgIEJsb2NrQml0c0lPCiAqIEBhdXRob3IgICAgICBNaWNreSBTb2NhY2kgPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSIzOTU0NTA1YTUyNDA3OTU3NTY0ZTU1NTA0ZjVjMTc0YjU2Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4KCiBDb250YWlucyB0aGUgRnVuZGluZyBDb250cmFjdCBjb2RlIGRlcGxveWVkIGFuZCBsaW5rZWQgdG8gdGhlIEFwcGxpY2F0aW9uIEVudGl0eQoKKi8KCgoKCgoKCgoKCgoKCgoKY29udHJhY3QgRnVuZGluZ01hbmFnZXIgaXMgQXBwbGljYXRpb25Bc3NldCB7CgogICAgQUJJRnVuZGluZyBGdW5kaW5nRW50aXR5OwogICAgQUJJVG9rZW5NYW5hZ2VyIFRva2VuTWFuYWdlckVudGl0eTsKICAgIEFCSVRva2VuIFRva2VuRW50aXR5OwogICAgQUJJVG9rZW5TQ0FEQVZhcmlhYmxlIFRva2VuU0NBREFFbnRpdHk7CiAgICBBQklQcm9wb3NhbHMgUHJvcG9zYWxzRW50aXR5OwogICAgQUJJTWlsZXN0b25lcyBNaWxlc3RvbmVzRW50aXR5OwoKICAgIHVpbnQyNTYgcHVibGljIExvY2tlZFZvdGluZ1Rva2VucyA9IDA7CgogICAgZXZlbnQgRXZlbnRGdW5kaW5nTWFuYWdlclJlY2VpdmVkUGF5bWVudChhZGRyZXNzIGluZGV4ZWQgX3ZhdWx0LCB1aW50OCBpbmRleGVkIF9wYXltZW50X21ldGhvZCwgdWludDI1NiBpbmRleGVkIF9hbW91bnQgKTsKICAgIGV2ZW50IEV2ZW50RnVuZGluZ01hbmFnZXJQcm9jZXNzZWRWYXVsdChhZGRyZXNzIF92YXVsdCwgdWludDI1NiBpZCApOwoKICAgIG1hcHBpbmcgIChhZGRyZXNzID0+IGFkZHJlc3MpIHB1YmxpYyB2YXVsdExpc3Q7CiAgICBtYXBwaW5nICAodWludDI1NiA9PiBhZGRyZXNzKSBwdWJsaWMgdmF1bHRCeUlkOwogICAgdWludDI1NiBwdWJsaWMgdmF1bHROdW0gPSAwOwoKICAgIGZ1bmN0aW9uIHNldEFzc2V0U3RhdGVzKCkgaW50ZXJuYWwgewogICAgICAgIC8vIEFzc2V0IFN0YXRlcwogICAgICAgIEVudGl0eVN0YXRlc1siX19JR05PUkVEX18iXSAgICAgICAgICAgICAgICAgPSAwOwogICAgICAgIEVudGl0eVN0YXRlc1siTkVXIl0gICAgICAgICAgICAgICAgICAgICAgICAgPSAxOwogICAgICAgIEVudGl0eVN0YXRlc1siV0FJVElORyJdICAgICAgICAgICAgICAgICAgICAgPSAyOwoKICAgICAgICBFbnRpdHlTdGF0ZXNbIkZVTkRJTkdfRkFJTEVEX1NUQVJUIl0gICAgICAgID0gMTA7CiAgICAgICAgRW50aXR5U3RhdGVzWyJGVU5ESU5HX0ZBSUxFRF9QUk9HUkVTUyJdICAgICA9IDExOwogICAgICAgIEVudGl0eVN0YXRlc1siRlVORElOR19GQUlMRURfRE9ORSJdICAgICAgICAgPSAxMjsKCiAgICAgICAgRW50aXR5U3RhdGVzWyJGVU5ESU5HX1NVQ0NFU1NGVUxfU1RBUlQiXSAgICA9IDIwOwogICAgICAgIEVudGl0eVN0YXRlc1siRlVORElOR19TVUNDRVNTRlVMX1BST0dSRVNTIl0gPSAyMTsKICAgICAgICBFbnRpdHlTdGF0ZXNbIkZVTkRJTkdfU1VDQ0VTU0ZVTF9ET05FIl0gICAgID0gMjI7CiAgICAgICAgRW50aXR5U3RhdGVzWyJGVU5ESU5HX1NVQ0NFU1NGVUxfQUxMT0NBVEUiXSA9IDI1OwoKCiAgICAgICAgRW50aXR5U3RhdGVzWyJNSUxFU1RPTkVfUFJPQ0VTU19TVEFSVCJdICAgICA9IDMwOwogICAgICAgIEVudGl0eVN0YXRlc1siTUlMRVNUT05FX1BST0NFU1NfUFJPR1JFU1MiXSAgPSAzMTsKICAgICAgICBFbnRpdHlTdGF0ZXNbIk1JTEVTVE9ORV9QUk9DRVNTX0RPTkUiXSAgICAgID0gMzI7CgogICAgICAgIEVudGl0eVN0YXRlc1siRU1FUkdFTkNZX1BST0NFU1NfU1RBUlQiXSAgICAgPSA0MDsKICAgICAgICBFbnRpdHlTdGF0ZXNbIkVNRVJHRU5DWV9QUk9DRVNTX1BST0dSRVNTIl0gID0gNDE7CiAgICAgICAgRW50aXR5U3RhdGVzWyJFTUVSR0VOQ1lfUFJPQ0VTU19ET05FIl0gICAgICA9IDQyOwoKCiAgICAgICAgRW50aXR5U3RhdGVzWyJDT01QTEVURV9QUk9DRVNTX1NUQVJUIl0gICAgID0gMTAwOwogICAgICAgIEVudGl0eVN0YXRlc1siQ09NUExFVEVfUFJPQ0VTU19QUk9HUkVTUyJdICA9IDEwMTsKICAgICAgICBFbnRpdHlTdGF0ZXNbIkNPTVBMRVRFX1BST0NFU1NfRE9ORSJdICAgICAgPSAxMDI7CgogICAgICAgIC8vIEZ1bmRpbmcgU3RhZ2UgU3RhdGVzCiAgICAgICAgUmVjb3JkU3RhdGVzWyJfX0lHTk9SRURfXyJdICAgICA9IDA7CgogICAgfQoKICAgIGZ1bmN0aW9uIHJ1bkJlZm9yZUFwcGx5aW5nU2V0dGluZ3MoKQogICAgICAgIGludGVybmFsCiAgICAgICAgcmVxdWlyZUluaXRpYWxpc2VkCiAgICAgICAgcmVxdWlyZVNldHRpbmdzTm90QXBwbGllZAogICAgewogICAgICAgIGFkZHJlc3MgRnVuZGluZ0FkZHJlc3MgPSBnZXRBcHBsaWNhdGlvbkFzc2V0QWRkcmVzc0J5TmFtZSgnRnVuZGluZycpOwogICAgICAgIEZ1bmRpbmdFbnRpdHkgPSBBQklGdW5kaW5nKEZ1bmRpbmdBZGRyZXNzKTsKICAgICAgICBFdmVudFJ1bkJlZm9yZUFwcGx5aW5nU2V0dGluZ3MoYXNzZXROYW1lKTsKCiAgICAgICAgYWRkcmVzcyBUb2tlbk1hbmFnZXJBZGRyZXNzID0gZ2V0QXBwbGljYXRpb25Bc3NldEFkZHJlc3NCeU5hbWUoJ1Rva2VuTWFuYWdlcicpOwogICAgICAgIFRva2VuTWFuYWdlckVudGl0eSA9IEFCSVRva2VuTWFuYWdlcihUb2tlbk1hbmFnZXJBZGRyZXNzKTsKCiAgICAgICAgVG9rZW5FbnRpdHkgPSBBQklUb2tlbihUb2tlbk1hbmFnZXJFbnRpdHkuVG9rZW5FbnRpdHkoKSk7CgogICAgICAgIGFkZHJlc3MgVG9rZW5TQ0FEQUFkZHJlc3MgPSBUb2tlbk1hbmFnZXJFbnRpdHkuVG9rZW5TQ0FEQUVudGl0eSgpOwogICAgICAgIFRva2VuU0NBREFFbnRpdHkgPSBBQklUb2tlblNDQURBVmFyaWFibGUoVG9rZW5TQ0FEQUFkZHJlc3MpIDsKCiAgICAgICAgYWRkcmVzcyBNaWxlc3RvbmVzQWRkcmVzcyA9IGdldEFwcGxpY2F0aW9uQXNzZXRBZGRyZXNzQnlOYW1lKCdNaWxlc3RvbmVzJyk7CiAgICAgICAgTWlsZXN0b25lc0VudGl0eSA9IEFCSU1pbGVzdG9uZXMoTWlsZXN0b25lc0FkZHJlc3MpIDsKCiAgICAgICAgYWRkcmVzcyBQcm9wb3NhbHNBZGRyZXNzID0gZ2V0QXBwbGljYXRpb25Bc3NldEFkZHJlc3NCeU5hbWUoJ1Byb3Bvc2FscycpOwogICAgICAgIFByb3Bvc2Fsc0VudGl0eSA9IEFCSVByb3Bvc2FscyhQcm9wb3NhbHNBZGRyZXNzKSA7CiAgICB9CgoKCiAgICBmdW5jdGlvbiByZWNlaXZlUGF5bWVudChhZGRyZXNzIF9zZW5kZXIsIHVpbnQ4IF9wYXltZW50X21ldGhvZCwgdWludDggX2Z1bmRpbmdfc3RhZ2UpCiAgICAgICAgcGF5YWJsZQogICAgICAgIHB1YmxpYwogICAgICAgIHJlcXVpcmVJbml0aWFsaXNlZAogICAgICAgIG9ubHlBc3NldCgnRnVuZGluZycpCiAgICAgICAgcmV0dXJucyhib29sKQogICAgewogICAgICAgIC8vIGNoZWNrIHRoYXQgbXNnLnZhbHVlIGlzIGhpZ2hlciB0aGFuIDAsIGRvbid0IHJlYWxseSB3YW50IHRvIGhhdmUgdG8gZGVhbCB3aXRoIG1pbnVzIGluIGNhc2UgdGhlIG5ldHdvcmsgYnJlYWtzIHRoaXMgc29tZWhvdwogICAgICAgIGlmKG1zZy52YWx1ZSA+IDApIHsKICAgICAgICAgICAgRnVuZGluZ1ZhdWx0IHZhdWx0OwoKICAgICAgICAgICAgLy8gbm8gdmF1bHQgcHJlc2VudAogICAgICAgICAgICBpZighaGFzVmF1bHQoX3NlbmRlcikpIHsKICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSBhbmQgaW5pdGlhbGl6ZSBhIG5ldyBvbmUKICAgICAgICAgICAgICAgIHZhdWx0ID0gbmV3IEZ1bmRpbmdWYXVsdCgpOwogICAgICAgICAgICAgICAgaWYodmF1bHQuaW5pdGlhbGl6ZSgKICAgICAgICAgICAgICAgICAgICBfc2VuZGVyLAogICAgICAgICAgICAgICAgICAgIEZ1bmRpbmdFbnRpdHkubXVsdGlTaWdPdXRwdXRBZGRyZXNzKCksCiAgICAgICAgICAgICAgICAgICAgYWRkcmVzcyhGdW5kaW5nRW50aXR5KSwKICAgICAgICAgICAgICAgICAgICBhZGRyZXNzKGdldEFwcGxpY2F0aW9uQXNzZXRBZGRyZXNzQnlOYW1lKCdNaWxlc3RvbmVzJykpLAogICAgICAgICAgICAgICAgICAgIGFkZHJlc3MoZ2V0QXBwbGljYXRpb25Bc3NldEFkZHJlc3NCeU5hbWUoJ1Byb3Bvc2FscycpKQogICAgICAgICAgICAgICAgKSkgewogICAgICAgICAgICAgICAgICAgIC8vIHN0b3JlIG5ldyB2YXVsdCBhZGRyZXNzLgogICAgICAgICAgICAgICAgICAgIHZhdWx0TGlzdFtfc2VuZGVyXSA9IHZhdWx0OwogICAgICAgICAgICAgICAgICAgIC8vIGluY3JlYXNlIGludGVybmFsIHZhdWx0IG51bWJlcgogICAgICAgICAgICAgICAgICAgIHZhdWx0TnVtKys7CiAgICAgICAgICAgICAgICAgICAgLy8gYXNzaWduIHZhdWx0IHRvIGJ5IGludCByZWdpc3RyeQogICAgICAgICAgICAgICAgICAgIHZhdWx0QnlJZFt2YXVsdE51bV0gPSB2YXVsdDsKCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gdXNlIGV4aXN0aW5nIHZhdWx0CiAgICAgICAgICAgICAgICB2YXVsdCA9IEZ1bmRpbmdWYXVsdCh2YXVsdExpc3RbX3NlbmRlcl0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBFdmVudEZ1bmRpbmdNYW5hZ2VyUmVjZWl2ZWRQYXltZW50KHZhdWx0LCBfcGF5bWVudF9tZXRob2QsIG1zZy52YWx1ZSk7CgogICAgICAgICAgICBpZiggdmF1bHQuYWRkUGF5bWVudC52YWx1ZShtc2cudmFsdWUpKCBfcGF5bWVudF9tZXRob2QsIF9mdW5kaW5nX3N0YWdlICkgKSB7CgogICAgICAgICAgICAgICAgLy8gaWYgcGF5bWVudCBpcyByZWNlaXZlZCBpbiB0aGUgdmF1bHQgdGhlbiBtaW50IHRva2VucyBiYXNlZCBvbiB0aGUgcmVjZWl2ZWQgdmFsdWUhCiAgICAgICAgICAgICAgICBUb2tlbk1hbmFnZXJFbnRpdHkubWludCggdmF1bHQsIFRva2VuU0NBREFFbnRpdHkuZ2V0VG9rZW5zRm9yVmFsdWVJbkN1cnJlbnRTdGFnZShtc2cudmFsdWUpICk7CgogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBnZXRNeVZhdWx0QWRkcmVzcyhhZGRyZXNzIF9zZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3MpIHsKICAgICAgICByZXR1cm4gdmF1bHRMaXN0W19zZW5kZXJdOwogICAgfQoKICAgIGZ1bmN0aW9uIGhhc1ZhdWx0KGFkZHJlc3MgX3NlbmRlcikgaW50ZXJuYWwgdmlldyByZXR1cm5zKGJvb2wpIHsKICAgICAgICBpZih2YXVsdExpc3RbX3NlbmRlcl0gIT0gYWRkcmVzcygweDApKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgYm9vbCBwdWJsaWMgZnVuZGluZ1Byb2Nlc3NlZCA9IGZhbHNlOwogICAgdWludDI1NiBwdWJsaWMgbGFzdFByb2Nlc3NlZFZhdWx0SWQgPSAwOwogICAgdWludDggcHVibGljIFZhdWx0Q291bnRQZXJQcm9jZXNzID0gMTA7CiAgICBieXRlczMyIHB1YmxpYyBjdXJyZW50VGFzayA9ICIiOwoKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gYm9vbCkgcHVibGljIHRhc2tCeUhhc2g7CgogICAgZnVuY3Rpb24gc2V0VmF1bHRDb3VudFBlclByb2Nlc3ModWludDggX3BlclByb2Nlc3MpIGV4dGVybmFsIG9ubHlEZXBsb3llciB7CiAgICAgICAgaWYoX3BlclByb2Nlc3MgPiAwKSB7CiAgICAgICAgICAgIFZhdWx0Q291bnRQZXJQcm9jZXNzID0gX3BlclByb2Nlc3M7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGdldEhhc2goYnl0ZXMzMiBhY3Rpb25UeXBlLCBieXRlczMyIGFyZzEpIHB1YmxpYyBwdXJlIHJldHVybnMgKCBieXRlczMyICkgewogICAgICAgIHJldHVybiBrZWNjYWsyNTYoYWN0aW9uVHlwZSwgYXJnMSk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0Q3VycmVudE1pbGVzdG9uZVByb2Nlc3NlZCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gdGFza0J5SGFzaFsgZ2V0SGFzaCgiTUlMRVNUT05FX1BST0NFU1NfU1RBUlQiLCBnZXRDdXJyZW50TWlsZXN0b25lSWRIYXNoKCkgKSBdOwogICAgfQoKCgogICAgZnVuY3Rpb24gUHJvY2Vzc1ZhdWx0TGlzdCh1aW50OCBsZW5ndGgpIGludGVybmFsIHsKCiAgICAgICAgaWYodGFza0J5SGFzaFtjdXJyZW50VGFza10gPT0gZmFsc2UpIHsKICAgICAgICAgICAgaWYoCiAgICAgICAgICAgICAgICBDdXJyZW50RW50aXR5U3RhdGUgPT0gZ2V0RW50aXR5U3RhdGUoIkZVTkRJTkdfRkFJTEVEX1BST0dSRVNTIikgfHwKICAgICAgICAgICAgICAgIEN1cnJlbnRFbnRpdHlTdGF0ZSA9PSBnZXRFbnRpdHlTdGF0ZSgiRlVORElOR19TVUNDRVNTRlVMX1BST0dSRVNTIikgfHwKICAgICAgICAgICAgICAgIEN1cnJlbnRFbnRpdHlTdGF0ZSA9PSBnZXRFbnRpdHlTdGF0ZSgiTUlMRVNUT05FX1BST0NFU1NfUFJPR1JFU1MiKSB8fAogICAgICAgICAgICAgICAgQ3VycmVudEVudGl0eVN0YXRlID09IGdldEVudGl0eVN0YXRlKCJFTUVSR0VOQ1lfUFJPQ0VTU19QUk9HUkVTUyIpIHx8CiAgICAgICAgICAgICAgICBDdXJyZW50RW50aXR5U3RhdGUgPT0gZ2V0RW50aXR5U3RhdGUoIkNPTVBMRVRFX1BST0NFU1NfUFJPR1JFU1MiKQogICAgICAgICAgICApIHsKCiAgICAgICAgICAgICAgICB1aW50MjU2IHN0YXJ0ID0gbGFzdFByb2Nlc3NlZFZhdWx0SWQgKyAxOwogICAgICAgICAgICAgICAgdWludDI1NiBlbmQgPSBzdGFydCArIGxlbmd0aCAtIDE7CgogICAgICAgICAgICAgICAgaWYoZW5kID4gdmF1bHROdW0pIHsKICAgICAgICAgICAgICAgICAgICBlbmQgPSB2YXVsdE51bTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBmaXJzdCBydW4KICAgICAgICAgICAgICAgIGlmKHN0YXJ0ID09IDEpIHsKICAgICAgICAgICAgICAgICAgICAvLyByZXNldCBMb2NrZWRWb3RpbmdUb2tlbnMsIGFzIHdlIHJlaW5kZXggdGhlbQogICAgICAgICAgICAgICAgICAgIExvY2tlZFZvdGluZ1Rva2VucyA9IDA7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZm9yKHVpbnQyNTYgaSA9IHN0YXJ0OyBpIDw9IGVuZDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgYWRkcmVzcyBjdXJyZW50VmF1bHQgPSB2YXVsdEJ5SWRbaV07CiAgICAgICAgICAgICAgICAgICAgRXZlbnRGdW5kaW5nTWFuYWdlclByb2Nlc3NlZFZhdWx0KGN1cnJlbnRWYXVsdCwgaSk7CiAgICAgICAgICAgICAgICAgICAgUHJvY2Vzc0Z1bmRpbmdWYXVsdChjdXJyZW50VmF1bHQpOwogICAgICAgICAgICAgICAgICAgIGxhc3RQcm9jZXNzZWRWYXVsdElkKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZihsYXN0UHJvY2Vzc2VkVmF1bHRJZCA+PSB2YXVsdE51bSApIHsKICAgICAgICAgICAgICAgICAgICAvLyByZXNldCBpdGVyYXRvciBhbmQgc2V0IHRhc2sgc3RhdGUgdG8gdHJ1ZSBzbyB3ZSBjYW4ndCBjYWxsIGl0IGFnYWluLgogICAgICAgICAgICAgICAgICAgIGxhc3RQcm9jZXNzZWRWYXVsdElkID0gMDsKICAgICAgICAgICAgICAgICAgICB0YXNrQnlIYXNoW2N1cnJlbnRUYXNrXSA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBwcm9jZXNzRnVuZGluZ0ZhaWxlZEZpbmlzaGVkKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGJ5dGVzMzIgdGhpc0hhc2ggPSBnZXRIYXNoKCJGVU5ESU5HX0ZBSUxFRF9TVEFSVCIsICIiKTsKICAgICAgICByZXR1cm4gdGFza0J5SGFzaFt0aGlzSGFzaF07CiAgICB9CgogICAgZnVuY3Rpb24gcHJvY2Vzc0Z1bmRpbmdTdWNjZXNzZnVsRmluaXNoZWQoKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgYnl0ZXMzMiB0aGlzSGFzaCA9IGdldEhhc2goIkZVTkRJTkdfU1VDQ0VTU0ZVTF9TVEFSVCIsICIiKTsKICAgICAgICByZXR1cm4gdGFza0J5SGFzaFt0aGlzSGFzaF07CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0Q3VycmVudE1pbGVzdG9uZUlkSGFzaCgpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYnl0ZXMzMikgewogICAgICAgIHJldHVybiBieXRlczMyKE1pbGVzdG9uZXNFbnRpdHkuY3VycmVudFJlY29yZCgpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBwcm9jZXNzTWlsZXN0b25lRmluaXNoZWQoKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgYnl0ZXMzMiB0aGlzSGFzaCA9IGdldEhhc2goIk1JTEVTVE9ORV9QUk9DRVNTX1NUQVJUIiwgZ2V0Q3VycmVudE1pbGVzdG9uZUlkSGFzaCgpKTsKICAgICAgICByZXR1cm4gdGFza0J5SGFzaFt0aGlzSGFzaF07CiAgICB9CgogICAgZnVuY3Rpb24gcHJvY2Vzc0VtZXJnZW5jeUZ1bmRSZWxlYXNlRmluaXNoZWQoKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgYnl0ZXMzMiB0aGlzSGFzaCA9IGdldEhhc2goIkVNRVJHRU5DWV9QUk9DRVNTX1NUQVJUIiwgYnl0ZXMzMigwKSk7CiAgICAgICAgcmV0dXJuIHRhc2tCeUhhc2hbdGhpc0hhc2hdOwogICAgfQoKICAgIGZ1bmN0aW9uIFByb2Nlc3NGdW5kaW5nVmF1bHQoYWRkcmVzcyB2YXVsdEFkZHJlc3MgKSBpbnRlcm5hbCB7CiAgICAgICAgRnVuZGluZ1ZhdWx0IHZhdWx0ID0gRnVuZGluZ1ZhdWx0KHZhdWx0QWRkcmVzcyk7CgogICAgICAgIGlmKHZhdWx0LmFsbEZ1bmRpbmdQcm9jZXNzZWQoKSA9PSBmYWxzZSkgewoKICAgICAgICAgICAgaWYoQ3VycmVudEVudGl0eVN0YXRlID09IGdldEVudGl0eVN0YXRlKCJGVU5ESU5HX1NVQ0NFU1NGVUxfUFJPR1JFU1MiKSkgewoKICAgICAgICAgICAgICAgIC8vIHRva2VucyBhcmUgbWludGVkIGFuZCBhbGxvY2F0ZWQgdG8gdGhpcyB2YXVsdCB3aGVuIGl0IHJlY2VpdmVzIHBheW1lbnRzLgogICAgICAgICAgICAgICAgLy8gdmF1bHQgc2hvdWxkIG5vdyBob2xkIGFzIG1hbnkgdG9rZW5zIGFzIHRoZSBpbnZlc3RvciBib3VnaHQgdXNpbmcgZGlyZWN0IGFuZCBtaWxlc3RvbmUgZnVuZGluZywKICAgICAgICAgICAgICAgIC8vIGFzIHdlbGwgYXMgdGhlIGV0aGVyIHRoZXkgc2VudAogICAgICAgICAgICAgICAgLy8gImRpcmVjdCBmdW5kaW5nIiByZWxlYXNlIC0+IGZ1bmRzIHRvIG93bmVyIC8gdG9rZW5zIHRvIGludmVzdG9yCiAgICAgICAgICAgICAgICBpZighdmF1bHQuUmVsZWFzZUZ1bmRzQW5kVG9rZW5zKCkpIHsKICAgICAgICAgICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0gZWxzZSBpZihDdXJyZW50RW50aXR5U3RhdGUgPT0gZ2V0RW50aXR5U3RhdGUoIk1JTEVTVE9ORV9QUk9DRVNTX1BST0dSRVNTIikpIHsKICAgICAgICAgICAgICAgIC8vIHJlbGVhc2UgZnVuZHMgdG8gb3duZXIgLyB0b2tlbnMgdG8gaW52ZXN0b3IKICAgICAgICAgICAgICAgIGlmKCF2YXVsdC5SZWxlYXNlRnVuZHNBbmRUb2tlbnMoKSkgewogICAgICAgICAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfSBlbHNlIGlmKEN1cnJlbnRFbnRpdHlTdGF0ZSA9PSBnZXRFbnRpdHlTdGF0ZSgiRU1FUkdFTkNZX1BST0NFU1NfUFJPR1JFU1MiKSkgewogICAgICAgICAgICAgICAgLy8gcmVsZWFzZSBlbWVyZ2VuY3kgZnVuZHMgdG8gb3duZXIgLyB0b2tlbnMgdG8gaW52ZXN0b3IKICAgICAgICAgICAgICAgIGlmKCF2YXVsdC5yZWxlYXNlVG9rZW5zQW5kRXRoZXJGb3JFbWVyZ2VuY3lGdW5kKCkpIHsKICAgICAgICAgICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gRm9yIHByb3Bvc2FsIHZvdGluZywgd2UgbmVlZCB0byBrbm93IGhvdyBtYW55IGludmVzdG9yIGxvY2tlZCB0b2tlbnMgcmVtYWluLgogICAgICAgICAgICBMb2NrZWRWb3RpbmdUb2tlbnMrPSBnZXRBZnRlclRyYW5zZmVyTG9ja2VkVG9rZW5CYWxhbmNlcyh2YXVsdEFkZHJlc3MsIHRydWUpOwoKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0QWZ0ZXJUcmFuc2ZlckxvY2tlZFRva2VuQmFsYW5jZXMoYWRkcmVzcyB2YXVsdEFkZHJlc3MsIGJvb2wgZXhjbHVkZUN1cnJlbnQpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICBGdW5kaW5nVmF1bHQgdmF1bHQgPSBGdW5kaW5nVmF1bHQodmF1bHRBZGRyZXNzKTsKICAgICAgICB1aW50OCBjdXJyZW50TWlsZXN0b25lID0gTWlsZXN0b25lc0VudGl0eS5jdXJyZW50UmVjb3JkKCk7CgogICAgICAgIHVpbnQyNTYgTG9ja2VkQmFsYW5jZSA9IDA7CiAgICAgICAgLy8gaGFuZGxlIGVtZXJnZW5jeSBmdW5kaW5nIGZpcnN0CiAgICAgICAgaWYodmF1bHQuZW1lcmdlbmN5RnVuZFJlbGVhc2VkKCkgPT0gZmFsc2UpIHsKICAgICAgICAgICAgTG9ja2VkQmFsYW5jZSs9dmF1bHQudG9rZW5CYWxhbmNlcygwKTsKICAgICAgICB9CgogICAgICAgIC8vIGdldCB0b2tlbiBiYWxhbmNlcyBzdGFydGluZyBmcm9tIGN1cnJlbnQKICAgICAgICB1aW50OCBzdGFydCA9IGN1cnJlbnRNaWxlc3RvbmU7CgogICAgICAgIGlmKEN1cnJlbnRFbnRpdHlTdGF0ZSAhPSBnZXRFbnRpdHlTdGF0ZSgiRlVORElOR19TVUNDRVNTRlVMX1BST0dSRVNTIikpIHsKICAgICAgICAgICAgaWYoZXhjbHVkZUN1cnJlbnQgPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgc3RhcnQrKzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZm9yKHVpbnQ4IGkgPSBzdGFydDsgaSA8IHZhdWx0LkJhbGFuY2VOdW0oKSA7IGkrKykgewogICAgICAgICAgICBMb2NrZWRCYWxhbmNlKz12YXVsdC50b2tlbkJhbGFuY2VzKGkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gTG9ja2VkQmFsYW5jZTsKCiAgICB9CgogICAgZnVuY3Rpb24gVmF1bHRSZXF1ZXN0ZWRVcGRhdGVGb3JMb2NrZWRWb3RpbmdUb2tlbnMoYWRkcmVzcyBvd25lcikgcHVibGljIHsKICAgICAgICAvLyB2YWxpZGF0ZSBzZW5kZXIKICAgICAgICBhZGRyZXNzIHZhdWx0QWRkcmVzcyA9IHZhdWx0TGlzdFtvd25lcl07CiAgICAgICAgaWYobXNnLnNlbmRlciA9PSB2YXVsdEFkZHJlc3MpewogICAgICAgICAgICAvLyBnZXQgdG9rZW4gYmFsYW5jZXMgc3RhcnRpbmcgZnJvbSBjdXJyZW50CiAgICAgICAgICAgIExvY2tlZFZvdGluZ1Rva2Vucy09IGdldEFmdGVyVHJhbnNmZXJMb2NrZWRUb2tlbkJhbGFuY2VzKHZhdWx0QWRkcmVzcywgZmFsc2UpOwogICAgICAgIH0KICAgIH0KCiAgICBib29sIEZ1bmRpbmdQb29sQmFsYW5jZXNBbGxvY2F0ZWQgPSBmYWxzZTsKCiAgICBmdW5jdGlvbiBBbGxvY2F0ZUFmdGVyRnVuZGluZ0JhbGFuY2VzKCkgaW50ZXJuYWwgewogICAgICAgIC8vIGFsbG9jYXRlIG93bmVyLCBhZHZpc29yLCBib3VudHkgcG9vbHMKICAgICAgICBpZihGdW5kaW5nUG9vbEJhbGFuY2VzQWxsb2NhdGVkID09IGZhbHNlKSB7CgogICAgICAgICAgICAvLyBtaW50IGVtIQogICAgICAgICAgICB1aW50MjU2IG1pbnRlZFN1cHBseSA9IFRva2VuRW50aXR5LnRvdGFsU3VwcGx5KCk7CiAgICAgICAgICAgIHVpbnQyNTYgc2FsZVBlcmNlbnQgPSBnZXRBcHBCeWxhd1VpbnQyNTYoInRva2VuX3NhbGVfcGVyY2VudGFnZSIpOwoKICAgICAgICAgICAgLy8gZmluZCBvbmUgcGVyY2VudAogICAgICAgICAgICB1aW50MjU2IG9uZVBlcmNlbnQgPSAobWludGVkU3VwcGx5ICogMSAvIHNhbGVQZXJjZW50ICogMTAwKSAvIDEwMDsKCiAgICAgICAgICAgIC8vIGJvdW50eSB0b2tlbnMKICAgICAgICAgICAgdWludDI1NiBib3VudHlQZXJjZW50ID0gZ2V0QXBwQnlsYXdVaW50MjU2KCJ0b2tlbl9ib3VudHlfcGVyY2VudGFnZSIpOwogICAgICAgICAgICB1aW50MjU2IGJvdW50eVZhbHVlID0gb25lUGVyY2VudCAqIGJvdW50eVBlcmNlbnQ7CgogICAgICAgICAgICBhZGRyZXNzIEJvdW50eU1hbmFnZXJBZGRyZXNzID0gZ2V0QXBwbGljYXRpb25Bc3NldEFkZHJlc3NCeU5hbWUoIkJvdW50eU1hbmFnZXIiKTsKICAgICAgICAgICAgVG9rZW5NYW5hZ2VyRW50aXR5Lm1pbnQoIEJvdW50eU1hbmFnZXJBZGRyZXNzLCBib3VudHlWYWx1ZSApOwoKICAgICAgICAgICAgLy8gcHJvamVjdCB0b2tlbnMKICAgICAgICAgICAgLy8gc2hvdWxkIGJlIDQwCiAgICAgICAgICAgIHVpbnQyNTYgcHJvamVjdFBlcmNlbnQgPSAxMDAgLSBzYWxlUGVyY2VudCAtIGJvdW50eVBlcmNlbnQ7CiAgICAgICAgICAgIHVpbnQyNTYgcHJvamVjdFZhbHVlID0gb25lUGVyY2VudCAqIHByb2plY3RQZXJjZW50OwoKICAgICAgICAgICAgLy8gcHJvamVjdCB0b2tlbnMgZ2V0IG1pbnRlZCB0byBUb2tlbiBNYW5hZ2VyJ3MgYWRkcmVzcywgYW5kIGFyZSBsb2NrZWQgdGhlcmUKICAgICAgICAgICAgVG9rZW5NYW5hZ2VyRW50aXR5Lm1pbnQoIFRva2VuTWFuYWdlckVudGl0eSwgcHJvamVjdFZhbHVlICk7CiAgICAgICAgICAgIFRva2VuTWFuYWdlckVudGl0eS5maW5pc2hNaW50aW5nKCk7CgogICAgICAgICAgICBGdW5kaW5nUG9vbEJhbGFuY2VzQWxsb2NhdGVkID0gdHJ1ZTsKICAgICAgICB9CiAgICB9CgoKICAgIGZ1bmN0aW9uIGRvU3RhdGVDaGFuZ2VzKCkgcHVibGljIHsKCiAgICAgICAgdmFyIChyZXR1cm5lZEN1cnJlbnRFbnRpdHlTdGF0ZSwgRW50aXR5U3RhdGVSZXF1aXJlZCkgPSBnZXRSZXF1aXJlZFN0YXRlQ2hhbmdlcygpOwogICAgICAgIGJvb2wgY2FsbEFnYWluID0gZmFsc2U7CgogICAgICAgIERlYnVnRW50aXR5UmVxdWlyZWRDaGFuZ2VzKCBhc3NldE5hbWUsIHJldHVybmVkQ3VycmVudEVudGl0eVN0YXRlLCBFbnRpdHlTdGF0ZVJlcXVpcmVkICk7CgogICAgICAgIGlmKEVudGl0eVN0YXRlUmVxdWlyZWQgIT0gZ2V0RW50aXR5U3RhdGUoIl9fSUdOT1JFRF9fIikgKSB7CiAgICAgICAgICAgIEVudGl0eVByb2Nlc3NvcihFbnRpdHlTdGF0ZVJlcXVpcmVkKTsKICAgICAgICAgICAgY2FsbEFnYWluID0gdHJ1ZTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gaGFzUmVxdWlyZWRTdGF0ZUNoYW5nZXMoKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgYm9vbCBoYXNDaGFuZ2VzID0gZmFsc2U7CiAgICAgICAgdmFyIChyZXR1cm5lZEN1cnJlbnRFbnRpdHlTdGF0ZSwgRW50aXR5U3RhdGVSZXF1aXJlZCkgPSBnZXRSZXF1aXJlZFN0YXRlQ2hhbmdlcygpOwogICAgICAgIC8vIHN1cHByZXNzIHVudXNlZCBsb2NhbCB2YXJpYWJsZSB3YXJuaW5nCiAgICAgICAgcmV0dXJuZWRDdXJyZW50RW50aXR5U3RhdGUgPSAwOwogICAgICAgIGlmKEVudGl0eVN0YXRlUmVxdWlyZWQgIT0gZ2V0RW50aXR5U3RhdGUoIl9fSUdOT1JFRF9fIikgKSB7CiAgICAgICAgICAgIGhhc0NoYW5nZXMgPSB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaGFzQ2hhbmdlczsKICAgIH0KCiAgICBmdW5jdGlvbiBFbnRpdHlQcm9jZXNzb3IodWludDggRW50aXR5U3RhdGVSZXF1aXJlZCkgaW50ZXJuYWwgewoKICAgICAgICBFdmVudEVudGl0eVByb2Nlc3NvciggYXNzZXROYW1lLCBDdXJyZW50RW50aXR5U3RhdGUsIEVudGl0eVN0YXRlUmVxdWlyZWQgKTsKCiAgICAgICAgLy8gVXBkYXRlIG91ciBFbnRpdHkgU3RhdGUKICAgICAgICBDdXJyZW50RW50aXR5U3RhdGUgPSBFbnRpdHlTdGF0ZVJlcXVpcmVkOwogICAgICAgIC8vIERvIFN0YXRlIFNwZWNpZmljIFVwZGF0ZXMKCi8vIEZ1bmRpbmcgRmFpbGVkCiAgICAgICAgaWYgKCBFbnRpdHlTdGF0ZVJlcXVpcmVkID09IGdldEVudGl0eVN0YXRlKCJGVU5ESU5HX0ZBSUxFRF9TVEFSVCIpICkgewogICAgICAgICAgICAvLyBzZXQgUHJvY2Vzc1ZhdWx0TGlzdCBUYXNrCiAgICAgICAgICAgIGN1cnJlbnRUYXNrID0gZ2V0SGFzaCgiRlVORElOR19GQUlMRURfU1RBUlQiLCAiIik7CiAgICAgICAgICAgIEN1cnJlbnRFbnRpdHlTdGF0ZSA9IGdldEVudGl0eVN0YXRlKCJGVU5ESU5HX0ZBSUxFRF9QUk9HUkVTUyIpOwogICAgICAgIH0gZWxzZSBpZiAoIEVudGl0eVN0YXRlUmVxdWlyZWQgPT0gZ2V0RW50aXR5U3RhdGUoIkZVTkRJTkdfRkFJTEVEX1BST0dSRVNTIikgKSB7CiAgICAgICAgICAgIFByb2Nlc3NWYXVsdExpc3QoVmF1bHRDb3VudFBlclByb2Nlc3MpOwoKLy8gRnVuZGluZyBTdWNjZXNzZnVsCiAgICAgICAgfSBlbHNlIGlmICggRW50aXR5U3RhdGVSZXF1aXJlZCA9PSBnZXRFbnRpdHlTdGF0ZSgiRlVORElOR19TVUNDRVNTRlVMX1NUQVJUIikgKSB7CgogICAgICAgICAgICAvLyBpbml0IFNDQURBIHZhcmlhYmxlIGNhY2hlLgogICAgICAgICAgICAvL2lmKFRva2VuU0NBREFFbnRpdHkuaW5pdENhY2hlRm9yVmFyaWFibGVzKCkpIHsKCiAgICAgICAgICAgIC8vIHN0YXJ0IHByb2Nlc3NpbmcgdmF1bHRzCiAgICAgICAgICAgIGN1cnJlbnRUYXNrID0gZ2V0SGFzaCgiRlVORElOR19TVUNDRVNTRlVMX1NUQVJUIiwgIiIpOwogICAgICAgICAgICBDdXJyZW50RW50aXR5U3RhdGUgPSBnZXRFbnRpdHlTdGF0ZSgiRlVORElOR19TVUNDRVNTRlVMX1BST0dSRVNTIik7CgogICAgICAgIH0gZWxzZSBpZiAoIEVudGl0eVN0YXRlUmVxdWlyZWQgPT0gZ2V0RW50aXR5U3RhdGUoIkZVTkRJTkdfU1VDQ0VTU0ZVTF9QUk9HUkVTUyIpICkgewogICAgICAgICAgICBQcm9jZXNzVmF1bHRMaXN0KFZhdWx0Q291bnRQZXJQcm9jZXNzKTsKCiAgICAgICAgfSBlbHNlIGlmICggRW50aXR5U3RhdGVSZXF1aXJlZCA9PSBnZXRFbnRpdHlTdGF0ZSgiRlVORElOR19TVUNDRVNTRlVMX0FMTE9DQVRFIikgKSB7CiAgICAgICAgICAgIEFsbG9jYXRlQWZ0ZXJGdW5kaW5nQmFsYW5jZXMoKTsKCi8vIE1pbGVzdG9uZXMKICAgICAgICB9IGVsc2UgaWYgKCBFbnRpdHlTdGF0ZVJlcXVpcmVkID09IGdldEVudGl0eVN0YXRlKCJNSUxFU1RPTkVfUFJPQ0VTU19TVEFSVCIpICkgewogICAgICAgICAgICBjdXJyZW50VGFzayA9IGdldEhhc2goIk1JTEVTVE9ORV9QUk9DRVNTX1NUQVJUIiwgZ2V0Q3VycmVudE1pbGVzdG9uZUlkSGFzaCgpICk7CiAgICAgICAgICAgIEN1cnJlbnRFbnRpdHlTdGF0ZSA9IGdldEVudGl0eVN0YXRlKCJNSUxFU1RPTkVfUFJPQ0VTU19QUk9HUkVTUyIpOwoKICAgICAgICB9IGVsc2UgaWYgKCBFbnRpdHlTdGF0ZVJlcXVpcmVkID09IGdldEVudGl0eVN0YXRlKCJNSUxFU1RPTkVfUFJPQ0VTU19QUk9HUkVTUyIpICkgewogICAgICAgICAgICBQcm9jZXNzVmF1bHRMaXN0KFZhdWx0Q291bnRQZXJQcm9jZXNzKTsKCi8vIEVtZXJnZW5jeSBmdW5kaW5nIHJlbGVhc2UKICAgICAgICB9IGVsc2UgaWYgKCBFbnRpdHlTdGF0ZVJlcXVpcmVkID09IGdldEVudGl0eVN0YXRlKCJFTUVSR0VOQ1lfUFJPQ0VTU19TVEFSVCIpICkgewogICAgICAgICAgICBjdXJyZW50VGFzayA9IGdldEhhc2goIkVNRVJHRU5DWV9QUk9DRVNTX1NUQVJUIiwgYnl0ZXMzMigwKSApOwogICAgICAgICAgICBDdXJyZW50RW50aXR5U3RhdGUgPSBnZXRFbnRpdHlTdGF0ZSgiRU1FUkdFTkNZX1BST0NFU1NfUFJPR1JFU1MiKTsKICAgICAgICB9IGVsc2UgaWYgKCBFbnRpdHlTdGF0ZVJlcXVpcmVkID09IGdldEVudGl0eVN0YXRlKCJFTUVSR0VOQ1lfUFJPQ0VTU19QUk9HUkVTUyIpICkgewogICAgICAgICAgICBQcm9jZXNzVmF1bHRMaXN0KFZhdWx0Q291bnRQZXJQcm9jZXNzKTsKCi8vIENvbXBsZXRpb24KICAgICAgICB9IGVsc2UgaWYgKCBFbnRpdHlTdGF0ZVJlcXVpcmVkID09IGdldEVudGl0eVN0YXRlKCJDT01QTEVURV9QUk9DRVNTX1NUQVJUIikgKSB7CiAgICAgICAgICAgIGN1cnJlbnRUYXNrID0gZ2V0SGFzaCgiQ09NUExFVEVfUFJPQ0VTU19TVEFSVCIsICIiKTsKICAgICAgICAgICAgQ3VycmVudEVudGl0eVN0YXRlID0gZ2V0RW50aXR5U3RhdGUoIkNPTVBMRVRFX1BST0NFU1NfUFJPR1JFU1MiKTsKCiAgICAgICAgfSBlbHNlIGlmICggRW50aXR5U3RhdGVSZXF1aXJlZCA9PSBnZXRFbnRpdHlTdGF0ZSgiQ09NUExFVEVfUFJPQ0VTU19QUk9HUkVTUyIpICkgewogICAgICAgICAgICAvLyByZWxlYXNlIHBsYXRmb3JtIG93bmVyIHRva2VucyBmcm9tIHRva2VuIG1hbmFnZXIKICAgICAgICAgICAgVG9rZW5NYW5hZ2VyRW50aXR5LlJlbGVhc2VPd25lcnNMb2NrZWRUb2tlbnMoIEZ1bmRpbmdFbnRpdHkubXVsdGlTaWdPdXRwdXRBZGRyZXNzKCkgKTsKICAgICAgICAgICAgQ3VycmVudEVudGl0eVN0YXRlID0gZ2V0RW50aXR5U3RhdGUoIkNPTVBMRVRFX1BST0NFU1NfRE9ORSIpOwogICAgICAgIH0KCiAgICB9CgogICAgLyoKICAgICAqIE1ldGhvZDogR2V0IEVudGl0eSBSZXF1aXJlZCBTdGF0ZSBDaGFuZ2VzCiAgICAgKgogICAgICogQGFjY2VzcyAgICAgICBwdWJsaWMKICAgICAqIEB0eXBlICAgICAgICAgbWV0aG9kCiAgICAgKgogICAgICogQHJldHVybiAgICAgICAoIHVpbnQ4IEN1cnJlbnRFbnRpdHlTdGF0ZSwgdWludDggRW50aXR5U3RhdGVSZXF1aXJlZCApCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldFJlcXVpcmVkU3RhdGVDaGFuZ2VzKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDgsIHVpbnQ4KSB7CgogICAgICAgIHVpbnQ4IEVudGl0eVN0YXRlUmVxdWlyZWQgPSBnZXRFbnRpdHlTdGF0ZSgiX19JR05PUkVEX18iKTsKCiAgICAgICAgaWYoQXBwbGljYXRpb25JbkZ1bmRpbmdPckRldmVsb3BtZW50KCkpIHsKCiAgICAgICAgICAgIGlmICggQ3VycmVudEVudGl0eVN0YXRlID09IGdldEVudGl0eVN0YXRlKCJXQUlUSU5HIikgKSB7CiAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICAgIFRoaXMgaXMgd2hlcmUgd2UgZGVjaWRlIGlmIHdlIHNob3VsZCBwcm9jZXNzIHNvbWV0aGluZwogICAgICAgICAgICAgICAgKi8KCiAgICAgICAgICAgICAgICAvLyBGb3IgZnVuZGluZwogICAgICAgICAgICAgICAgaWYoRnVuZGluZ0VudGl0eS5DdXJyZW50RW50aXR5U3RhdGUoKSA9PSBGdW5kaW5nRW50aXR5LmdldEVudGl0eVN0YXRlKCJGQUlMRUQiKSkgewogICAgICAgICAgICAgICAgICAgIEVudGl0eVN0YXRlUmVxdWlyZWQgPSBnZXRFbnRpdHlTdGF0ZSgiRlVORElOR19GQUlMRURfU1RBUlQiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYoRnVuZGluZ0VudGl0eS5DdXJyZW50RW50aXR5U3RhdGUoKSA9PSBGdW5kaW5nRW50aXR5LmdldEVudGl0eVN0YXRlKCJTVUNDRVNTRlVMIikpIHsKICAgICAgICAgICAgICAgICAgICAvLyBtYWtlIHN1cmUgd2UgaGF2ZW4ndCBwcm9jZXNzZWQgdGhpcyB5ZXQKICAgICAgICAgICAgICAgICAgICBpZih0YXNrQnlIYXNoWyBnZXRIYXNoKCJGVU5ESU5HX1NVQ0NFU1NGVUxfU1RBUlQiLCAiIikgXSA9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgICAgICBFbnRpdHlTdGF0ZVJlcXVpcmVkID0gZ2V0RW50aXR5U3RhdGUoIkZVTkRJTkdfU1VDQ0VTU0ZVTF9TVEFSVCIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYoRnVuZGluZ0VudGl0eS5DdXJyZW50RW50aXR5U3RhdGUoKSA9PSBGdW5kaW5nRW50aXR5LmdldEVudGl0eVN0YXRlKCJTVUNDRVNTRlVMX0ZJTkFMIikpIHsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCBwcm9jZXNzTWlsZXN0b25lRmluaXNoZWQoKSA9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZigKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1pbGVzdG9uZXNFbnRpdHkuQ3VycmVudEVudGl0eVN0YXRlKCkgPT0gTWlsZXN0b25lc0VudGl0eS5nZXRFbnRpdHlTdGF0ZSgiVk9USU5HX0VOREVEX1lFUyIpIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNaWxlc3RvbmVzRW50aXR5LkN1cnJlbnRFbnRpdHlTdGF0ZSgpID09IE1pbGVzdG9uZXNFbnRpdHkuZ2V0RW50aXR5U3RhdGUoIlZPVElOR19FTkRFRF9OT19GSU5BTCIpCiAgICAgICAgICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgRW50aXR5U3RhdGVSZXF1aXJlZCA9IGdldEVudGl0eVN0YXRlKCJNSUxFU1RPTkVfUFJPQ0VTU19TVEFSVCIpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZihwcm9jZXNzRW1lcmdlbmN5RnVuZFJlbGVhc2VGaW5pc2hlZCgpID09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKFByb3Bvc2Fsc0VudGl0eS5FbWVyZ2VuY3lGdW5kaW5nUmVsZWFzZUFwcHJvdmVkKCkgPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgRW50aXR5U3RhdGVSZXF1aXJlZCA9IGdldEVudGl0eVN0YXRlKCJFTUVSR0VOQ1lfUFJPQ0VTU19TVEFSVCIpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBlbHNlLCBjaGVjayBpZiBhbGwgbWlsZXN0b25lcyBoYXZlIGJlZW4gcHJvY2Vzc2VkIGFuZCB0cnkgZmluYWxpc2luZyBkZXZlbG9wbWVudCBwcm9jZXNzCiAgICAgICAgICAgICAgICAgICAgLy8gRW50aXR5U3RhdGVSZXF1aXJlZCA9IGdldEVudGl0eVN0YXRlKCJDT01QTEVURV9QUk9DRVNTX1NUQVJUIik7CgoKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0gZWxzZSBpZiAoIEN1cnJlbnRFbnRpdHlTdGF0ZSA9PSBnZXRFbnRpdHlTdGF0ZSgiRlVORElOR19TVUNDRVNTRlVMX1BST0dSRVNTIikgKSB7CiAgICAgICAgICAgICAgICAvLyBzdGlsbCBpbiBwcm9ncmVzcz8gY2hlY2sgaWYgd2Ugc2hvdWxkIG1vdmUgdG8gZG9uZQogICAgICAgICAgICAgICAgaWYgKCBwcm9jZXNzRnVuZGluZ1N1Y2Nlc3NmdWxGaW5pc2hlZCgpICkgewogICAgICAgICAgICAgICAgICAgIEVudGl0eVN0YXRlUmVxdWlyZWQgPSBnZXRFbnRpdHlTdGF0ZSgiRlVORElOR19TVUNDRVNTRlVMX0FMTE9DQVRFIik7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIEVudGl0eVN0YXRlUmVxdWlyZWQgPSBnZXRFbnRpdHlTdGF0ZSgiRlVORElOR19TVUNDRVNTRlVMX1BST0dSRVNTIik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9IGVsc2UgaWYgKCBDdXJyZW50RW50aXR5U3RhdGUgPT0gZ2V0RW50aXR5U3RhdGUoIkZVTkRJTkdfU1VDQ0VTU0ZVTF9BTExPQ0FURSIpICkgewoKICAgICAgICAgICAgICAgIGlmKEZ1bmRpbmdQb29sQmFsYW5jZXNBbGxvY2F0ZWQpIHsKICAgICAgICAgICAgICAgICAgICBFbnRpdHlTdGF0ZVJlcXVpcmVkID0gZ2V0RW50aXR5U3RhdGUoIkZVTkRJTkdfU1VDQ0VTU0ZVTF9ET05FIik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9IGVsc2UgaWYgKCBDdXJyZW50RW50aXR5U3RhdGUgPT0gZ2V0RW50aXR5U3RhdGUoIkZVTkRJTkdfU1VDQ0VTU0ZVTF9ET05FIikgKSB7CiAgICAgICAgICAgICAgICBFbnRpdHlTdGF0ZVJlcXVpcmVkID0gZ2V0RW50aXR5U3RhdGUoIldBSVRJTkciKTsKCiAgICAvLyBGdW5kaW5nIEZhaWxlZAogICAgICAgICAgICB9IGVsc2UgaWYgKCBDdXJyZW50RW50aXR5U3RhdGUgPT0gZ2V0RW50aXR5U3RhdGUoIkZVTkRJTkdfRkFJTEVEX1BST0dSRVNTIikgKSB7CiAgICAgICAgICAgICAgICAvLyBzdGlsbCBpbiBwcm9ncmVzcz8gY2hlY2sgaWYgd2Ugc2hvdWxkIG1vdmUgdG8gZG9uZQogICAgICAgICAgICAgICAgaWYgKCBwcm9jZXNzRnVuZGluZ0ZhaWxlZEZpbmlzaGVkKCkgKSB7CiAgICAgICAgICAgICAgICAgICAgRW50aXR5U3RhdGVSZXF1aXJlZCA9IGdldEVudGl0eVN0YXRlKCJGVU5ESU5HX0ZBSUxFRF9ET05FIik7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIEVudGl0eVN0YXRlUmVxdWlyZWQgPSBnZXRFbnRpdHlTdGF0ZSgiRlVORElOR19GQUlMRURfUFJPR1JFU1MiKTsKICAgICAgICAgICAgICAgIH0KCiAgICAvLyBNaWxlc3RvbmUgcHJvY2VzcwogICAgICAgICAgICB9IGVsc2UgaWYgKCBDdXJyZW50RW50aXR5U3RhdGUgPT0gZ2V0RW50aXR5U3RhdGUoIk1JTEVTVE9ORV9QUk9DRVNTX1BST0dSRVNTIikgKSB7CiAgICAgICAgICAgICAgICAvLyBzdGlsbCBpbiBwcm9ncmVzcz8gY2hlY2sgaWYgd2Ugc2hvdWxkIG1vdmUgdG8gZG9uZQoKICAgICAgICAgICAgICAgIGlmICggcHJvY2Vzc01pbGVzdG9uZUZpbmlzaGVkKCkgKSB7CiAgICAgICAgICAgICAgICAgICAgRW50aXR5U3RhdGVSZXF1aXJlZCA9IGdldEVudGl0eVN0YXRlKCJNSUxFU1RPTkVfUFJPQ0VTU19ET05FIik7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIEVudGl0eVN0YXRlUmVxdWlyZWQgPSBnZXRFbnRpdHlTdGF0ZSgiTUlMRVNUT05FX1BST0NFU1NfUFJPR1JFU1MiKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0gZWxzZSBpZiAoIEN1cnJlbnRFbnRpdHlTdGF0ZSA9PSBnZXRFbnRpdHlTdGF0ZSgiTUlMRVNUT05FX1BST0NFU1NfRE9ORSIpICkgewoKICAgICAgICAgICAgICAgIGlmKHByb2Nlc3NNaWxlc3RvbmVGaW5pc2hlZCgpID09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgRW50aXR5U3RhdGVSZXF1aXJlZCA9IGdldEVudGl0eVN0YXRlKCJXQUlUSU5HIik7CgogICAgICAgICAgICAgICAgfSBlbHNlIGlmKE1pbGVzdG9uZXNFbnRpdHkuY3VycmVudFJlY29yZCgpID09IE1pbGVzdG9uZXNFbnRpdHkuUmVjb3JkTnVtKCkpIHsKICAgICAgICAgICAgICAgICAgICBFbnRpdHlTdGF0ZVJlcXVpcmVkID0gZ2V0RW50aXR5U3RhdGUoIkNPTVBMRVRFX1BST0NFU1NfU1RBUlQiKTsKICAgICAgICAgICAgICAgIH0KCiAgICAvLyBFbWVyZ2VuY3kgZnVuZGluZyByZWxlYXNlCiAgICAgICAgICAgIH0gZWxzZSBpZiAoIEN1cnJlbnRFbnRpdHlTdGF0ZSA9PSBnZXRFbnRpdHlTdGF0ZSgiRU1FUkdFTkNZX1BST0NFU1NfUFJPR1JFU1MiKSApIHsKICAgICAgICAgICAgICAgIC8vIHN0aWxsIGluIHByb2dyZXNzPyBjaGVjayBpZiB3ZSBzaG91bGQgbW92ZSB0byBkb25lCgogICAgICAgICAgICAgICAgaWYgKCBwcm9jZXNzRW1lcmdlbmN5RnVuZFJlbGVhc2VGaW5pc2hlZCgpICkgewogICAgICAgICAgICAgICAgICAgIEVudGl0eVN0YXRlUmVxdWlyZWQgPSBnZXRFbnRpdHlTdGF0ZSgiRU1FUkdFTkNZX1BST0NFU1NfRE9ORSIpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBFbnRpdHlTdGF0ZVJlcXVpcmVkID0gZ2V0RW50aXR5U3RhdGUoIkVNRVJHRU5DWV9QUk9DRVNTX1BST0dSRVNTIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoIEN1cnJlbnRFbnRpdHlTdGF0ZSA9PSBnZXRFbnRpdHlTdGF0ZSgiRU1FUkdFTkNZX1BST0NFU1NfRE9ORSIpICkgewogICAgICAgICAgICAgICAgRW50aXR5U3RhdGVSZXF1aXJlZCA9IGdldEVudGl0eVN0YXRlKCJXQUlUSU5HIik7CgogICAgLy8gQ29tcGxldGlvbgogICAgICAgICAgICB9IGVsc2UgaWYgKCBDdXJyZW50RW50aXR5U3RhdGUgPT0gZ2V0RW50aXR5U3RhdGUoIkNPTVBMRVRFX1BST0NFU1NfUFJPR1JFU1MiKSApIHsKICAgICAgICAgICAgICAgIEVudGl0eVN0YXRlUmVxdWlyZWQgPSBnZXRFbnRpdHlTdGF0ZSgiQ09NUExFVEVfUFJPQ0VTU19QUk9HUkVTUyIpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKCiAgICAgICAgICAgIGlmKCBDdXJyZW50RW50aXR5U3RhdGUgPT0gZ2V0RW50aXR5U3RhdGUoIk5FVyIpICkgewogICAgICAgICAgICAgICAgLy8gZ2VuZXJhbCBzbyB3ZSBrbm93IHdlIGluaXRpYWxpemVkCiAgICAgICAgICAgICAgICBFbnRpdHlTdGF0ZVJlcXVpcmVkID0gZ2V0RW50aXR5U3RhdGUoIldBSVRJTkciKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIChDdXJyZW50RW50aXR5U3RhdGUsIEVudGl0eVN0YXRlUmVxdWlyZWQpOwogICAgfQoKICAgIGZ1bmN0aW9uIEFwcGxpY2F0aW9uSW5GdW5kaW5nT3JEZXZlbG9wbWVudCgpIHB1YmxpYyB2aWV3IHJldHVybnMoYm9vbCkgewogICAgICAgIHVpbnQ4IEFwcFN0YXRlID0gZ2V0QXBwbGljYXRpb25TdGF0ZSgpOwogICAgICAgIGlmKAogICAgICAgICAgICBBcHBTdGF0ZSA9PSBnZXRBcHBsaWNhdGlvbkVudGl0eVN0YXRlKCJJTl9GVU5ESU5HIikgfHwKICAgICAgICAgICAgQXBwU3RhdGUgPT0gZ2V0QXBwbGljYXRpb25FbnRpdHlTdGF0ZSgiSU5fREVWRUxPUE1FTlQiKQogICAgICAgICkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKCgp9'.
	

]
