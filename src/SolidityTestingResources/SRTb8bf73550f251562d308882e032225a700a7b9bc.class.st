Class {
	#name : #SRTb8bf73550f251562d308882e032225a700a7b9bc,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTb8bf73550f251562d308882e032225a700a7b9bc >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgoKLyoqCiAqIEB0aXRsZSBTYWZlTWF0aAogKiBAZGV2IE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MgdGhhdCB0aHJvdyBvbiBlcnJvcgogKi8KbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGlmIChhID09IDApIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKCi8qKgogKiBAdGl0bGUgT3duYWJsZQogKiBAZGV2IFRoZSBPd25hYmxlIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgYXV0aG9yaXphdGlvbiBjb250cm9sCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBwcmV2aW91c093bmVyLCBhZGRyZXNzIGluZGV4ZWQgbmV3T3duZXIpOwoKCiAgLyoqCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgcHVibGljIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZShuZXdPd25lciAhPSBhZGRyZXNzKDApKTsKICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBuZXdPd25lcik7CiAgICBvd25lciA9IG5ld093bmVyOwogIH0KCn0KCgovKioKICogQHRpdGxlIENsYWltYWJsZQogKiBAZGV2IEV4dGVuc2lvbiBmb3IgdGhlIE93bmFibGUgY29udHJhY3QsIHdoZXJlIHRoZSBvd25lcnNoaXAgbmVlZHMgdG8gYmUgY2xhaW1lZC4KICogVGhpcyBhbGxvd3MgdGhlIG5ldyBvd25lciB0byBhY2NlcHQgdGhlIHRyYW5zZmVyLgogKi8KY29udHJhY3QgQ2xhaW1hYmxlIGlzIE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIHBlbmRpbmdPd25lcjsKCiAgLyoqCiAgICogQGRldiBNb2RpZmllciB0aHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIHBlbmRpbmdPd25lci4KICAgKi8KICBtb2RpZmllciBvbmx5UGVuZGluZ093bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHBlbmRpbmdPd25lcik7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gc2V0IHRoZSBwZW5kaW5nT3duZXIgYWRkcmVzcy4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciBwdWJsaWMgewogICAgcGVuZGluZ093bmVyID0gbmV3T3duZXI7CiAgfQoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgcGVuZGluZ093bmVyIGFkZHJlc3MgdG8gZmluYWxpemUgdGhlIHRyYW5zZmVyLgogICAqLwogIGZ1bmN0aW9uIGNsYWltT3duZXJzaGlwKCkgb25seVBlbmRpbmdPd25lciBwdWJsaWMgewogICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIHBlbmRpbmdPd25lcik7CiAgICBvd25lciA9IHBlbmRpbmdPd25lcjsKICAgIHBlbmRpbmdPd25lciA9IGFkZHJlc3MoMCk7CiAgfQp9CgoKLyoqCiAqIEB0aXRsZSBQYXVzYWJsZQogKiBAZGV2IEJhc2UgY29udHJhY3Qgd2hpY2ggYWxsb3dzIGNoaWxkcmVuIHRvIGltcGxlbWVudCBhbiBlbWVyZ2VuY3kgc3RvcCBtZWNoYW5pc20uCiAqLwpjb250cmFjdCBQYXVzYWJsZSBpcyBPd25hYmxlIHsKICBldmVudCBQYXVzZSgpOwogIGV2ZW50IFVucGF1c2UoKTsKCiAgYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CgoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIG5vdCBwYXVzZWQuCiAgICovCiAgbW9kaWZpZXIgd2hlbk5vdFBhdXNlZCgpIHsKICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBNb2RpZmllciB0byBtYWtlIGEgZnVuY3Rpb24gY2FsbGFibGUgb25seSB3aGVuIHRoZSBjb250cmFjdCBpcyBwYXVzZWQuCiAgICovCiAgbW9kaWZpZXIgd2hlblBhdXNlZCgpIHsKICAgIHJlcXVpcmUocGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gcGF1c2UsIHRyaWdnZXJzIHN0b3BwZWQgc3RhdGUKICAgKi8KICBmdW5jdGlvbiBwYXVzZSgpIG9ubHlPd25lciB3aGVuTm90UGF1c2VkIHB1YmxpYyB7CiAgICBwYXVzZWQgPSB0cnVlOwogICAgUGF1c2UoKTsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byB1bnBhdXNlLCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHVucGF1c2UoKSBvbmx5T3duZXIgd2hlblBhdXNlZCBwdWJsaWMgewogICAgcGF1c2VkID0gZmFsc2U7CiAgICBVbnBhdXNlKCk7CiAgfQp9CgoKLyoqCiAqIEB0aXRsZSBFUkMyMEJhc2ljCiAqIEBkZXYgU2ltcGxlciB2ZXJzaW9uIG9mIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTc5CiAqLwpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKfQoKCi8qKgogKiBAdGl0bGUgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7Cn0KCgovKioKICogQHRpdGxlIFNhZmVFUkMyMAogKiBAZGV2IFdyYXBwZXJzIGFyb3VuZCBFUkMyMCBvcGVyYXRpb25zIHRoYXQgdGhyb3cgb24gZmFpbHVyZS4KICogVG8gdXNlIHRoaXMgbGlicmFyeSB5b3UgY2FuIGFkZCBhIGB1c2luZyBTYWZlRVJDMjAgZm9yIEVSQzIwO2Agc3RhdGVtZW50IHRvIHlvdXIgY29udHJhY3QsCiAqIHdoaWNoIGFsbG93cyB5b3UgdG8gY2FsbCB0aGUgc2FmZSBvcGVyYXRpb25zIGFzIGB0b2tlbi5zYWZlVHJhbnNmZXIoLi4uKWAsIGV0Yy4KICovCmxpYnJhcnkgU2FmZUVSQzIwIHsKICBmdW5jdGlvbiBzYWZlVHJhbnNmZXIoRVJDMjBCYXNpYyB0b2tlbiwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgaW50ZXJuYWwgewogICAgYXNzZXJ0KHRva2VuLnRyYW5zZmVyKHRvLCB2YWx1ZSkpOwogIH0KCiAgZnVuY3Rpb24gc2FmZVRyYW5zZmVyRnJvbShFUkMyMCB0b2tlbiwgYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBpbnRlcm5hbCB7CiAgICBhc3NlcnQodG9rZW4udHJhbnNmZXJGcm9tKGZyb20sIHRvLCB2YWx1ZSkpOwogIH0KCiAgZnVuY3Rpb24gc2FmZUFwcHJvdmUoRVJDMjAgdG9rZW4sIGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgaW50ZXJuYWwgewogICAgYXNzZXJ0KHRva2VuLmFwcHJvdmUoc3BlbmRlciwgdmFsdWUpKTsKICB9Cn0KCgovKioKICogQHRpdGxlIENvbnRyYWN0cyB0aGF0IHNob3VsZCBiZSBhYmxlIHRvIHJlY292ZXIgdG9rZW5zCiAqIEBhdXRob3IgU3lsVGkKICogQGRldiBUaGlzIGFsbG93IGEgY29udHJhY3QgdG8gcmVjb3ZlciBhbnkgRVJDMjAgdG9rZW4gcmVjZWl2ZWQgaW4gYSBjb250cmFjdCBieSB0cmFuc2ZlcnJpbmcgdGhlIGJhbGFuY2UgdG8gdGhlIGNvbnRyYWN0IG93bmVyLgogKiBUaGlzIHdpbGwgcHJldmVudCBhbnkgYWNjaWRlbnRhbCBsb3NzIG9mIHRva2Vucy4KICovCmNvbnRyYWN0IENhblJlY2xhaW1Ub2tlbiBpcyBPd25hYmxlIHsKICB1c2luZyBTYWZlRVJDMjAgZm9yIEVSQzIwQmFzaWM7CgogIC8qKgogICAqIEBkZXYgUmVjbGFpbSBhbGwgRVJDMjBCYXNpYyBjb21wYXRpYmxlIHRva2VucwogICAqIEBwYXJhbSB0b2tlbiBFUkMyMEJhc2ljIFRoZSBhZGRyZXNzIG9mIHRoZSB0b2tlbiBjb250cmFjdAogICAqLwogIGZ1bmN0aW9uIHJlY2xhaW1Ub2tlbihFUkMyMEJhc2ljIHRva2VuKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgdWludDI1NiBiYWxhbmNlID0gdG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgdG9rZW4uc2FmZVRyYW5zZmVyKG93bmVyLCBiYWxhbmNlKTsKICB9Cgp9CgoKLy8vIEB0aXRsZSBJbnRlcmZhY2UgZm9yIGNvbnRyYWN0cyBjb25mb3JtaW5nIHRvIEVSQy03MjE6IERlZWQgU3RhbmRhcmQKLy8vIEBhdXRob3IgV2lsbGlhbSBFbnRyaWtlbiAoaHR0cHM6Ly9waG9yLm5ldCksIGV0IGFsLgovLy8gQGRldiBTcGVjaWZpY2F0aW9uIGF0IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL3B1bGwvODQxIChEUkFGVCkKaW50ZXJmYWNlIEVSQzcyMSB7CgogICAgLy8gQ09NUExJQU5DRSBXSVRIIEVSQy0xNjUgKERSQUZUKSAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAZGV2IEVSQy0xNjUgKGRyYWZ0KSBpbnRlcmZhY2Ugc2lnbmF0dXJlIGZvciBpdHNlbGYKICAgIC8vIGJ5dGVzNCBpbnRlcm5hbCBjb25zdGFudCBJTlRFUkZBQ0VfU0lHTkFUVVJFX0VSQzE2NSA9IC8vIDB4MDFmZmM5YTcKICAgIC8vICAgICBieXRlczQoa2VjY2FrMjU2KCdzdXBwb3J0c0ludGVyZmFjZShieXRlczQpJykpOwoKICAgIC8vLyBAZGV2IEVSQy0xNjUgKGRyYWZ0KSBpbnRlcmZhY2Ugc2lnbmF0dXJlIGZvciBFUkM3MjEKICAgIC8vIGJ5dGVzNCBpbnRlcm5hbCBjb25zdGFudCBJTlRFUkZBQ0VfU0lHTkFUVVJFX0VSQzcyMSA9IC8vIDB4ZGE2NzFiOWIKICAgIC8vICAgICBieXRlczQoa2VjY2FrMjU2KCdvd25lck9mKHVpbnQyNTYpJykpIF4KICAgIC8vICAgICBieXRlczQoa2VjY2FrMjU2KCdjb3VudE9mRGVlZHMoKScpKSBeCiAgICAvLyAgICAgYnl0ZXM0KGtlY2NhazI1NignY291bnRPZkRlZWRzQnlPd25lcihhZGRyZXNzKScpKSBeCiAgICAvLyAgICAgYnl0ZXM0KGtlY2NhazI1NignZGVlZE9mT3duZXJCeUluZGV4KGFkZHJlc3MsdWludDI1NiknKSkgXgogICAgLy8gICAgIGJ5dGVzNChrZWNjYWsyNTYoJ2FwcHJvdmUoYWRkcmVzcyx1aW50MjU2KScpKSBeCiAgICAvLyAgICAgYnl0ZXM0KGtlY2NhazI1NigndGFrZU93bmVyc2hpcCh1aW50MjU2KScpKTsKCiAgICAvLy8gQG5vdGljZSBRdWVyeSBhIGNvbnRyYWN0IHRvIHNlZSBpZiBpdCBzdXBwb3J0cyBhIGNlcnRhaW4gaW50ZXJmYWNlCiAgICAvLy8gQGRldiBSZXR1cm5zIGB0cnVlYCB0aGUgaW50ZXJmYWNlIGlzIHN1cHBvcnRlZCBhbmQgYGZhbHNlYCBvdGhlcndpc2UsCiAgICAvLy8gIHJldHVybnMgYHRydWVgIGZvciBJTlRFUkZBQ0VfU0lHTkFUVVJFX0VSQzE2NSBhbmQKICAgIC8vLyAgSU5URVJGQUNFX1NJR05BVFVSRV9FUkM3MjEsIHNlZSBFUkMtMTY1IGZvciBvdGhlciBpbnRlcmZhY2Ugc2lnbmF0dXJlcy4KICAgIGZ1bmN0aW9uIHN1cHBvcnRzSW50ZXJmYWNlKGJ5dGVzNCBfaW50ZXJmYWNlSUQpIGV4dGVybmFsIHB1cmUgcmV0dXJucyAoYm9vbCk7CgogICAgLy8gUFVCTElDIFFVRVJZIEZVTkNUSU9OUyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIEZpbmQgdGhlIG93bmVyIG9mIGEgZGVlZAogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBpZGVudGlmaWVyIGZvciBhIGRlZWQgd2UgYXJlIGluc3BlY3RpbmcKICAgIC8vLyBAZGV2IERlZWRzIGFzc2lnbmVkIHRvIHplcm8gYWRkcmVzcyBhcmUgY29uc2lkZXJlZCBkZXN0cm95ZWQsIGFuZAogICAgLy8vICBxdWVyaWVzIGFib3V0IHRoZW0gZG8gdGhyb3cuCiAgICAvLy8gQHJldHVybiBUaGUgbm9uLXplcm8gYWRkcmVzcyBvZiB0aGUgb3duZXIgb2YgZGVlZCBgX2RlZWRJZGAsIG9yIGB0aHJvd2AKICAgIC8vLyAgaWYgZGVlZCBgX2RlZWRJZGAgaXMgbm90IHRyYWNrZWQgYnkgdGhpcyBjb250cmFjdAogICAgZnVuY3Rpb24gb3duZXJPZih1aW50MjU2IF9kZWVkSWQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYWRkcmVzcyBfb3duZXIpOwoKICAgIC8vLyBAbm90aWNlIENvdW50IGRlZWRzIHRyYWNrZWQgYnkgdGhpcyBjb250cmFjdAogICAgLy8vIEByZXR1cm4gQSBjb3VudCBvZiB0aGUgZGVlZHMgdHJhY2tlZCBieSB0aGlzIGNvbnRyYWN0LCB3aGVyZSBlYWNoIG9uZSBvZgogICAgLy8vICB0aGVtIGhhcyBhbiBhc3NpZ25lZCBhbmQgcXVlcnlhYmxlIG93bmVyCiAgICBmdW5jdGlvbiBjb3VudE9mRGVlZHMoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IF9jb3VudCk7CgogICAgLy8vIEBub3RpY2UgQ291bnQgYWxsIGRlZWRzIGFzc2lnbmVkIHRvIGFuIG93bmVyCiAgICAvLy8gQGRldiBUaHJvd3MgaWYgYF9vd25lcmAgaXMgdGhlIHplcm8gYWRkcmVzcywgcmVwcmVzZW50aW5nIGRlc3Ryb3llZCBkZWVkcy4KICAgIC8vLyBAcGFyYW0gX293bmVyIEFuIGFkZHJlc3Mgd2hlcmUgd2UgYXJlIGludGVyZXN0ZWQgaW4gZGVlZHMgb3duZWQgYnkgdGhlbQogICAgLy8vIEByZXR1cm4gVGhlIG51bWJlciBvZiBkZWVkcyBvd25lZCBieSBgX293bmVyYCwgcG9zc2libHkgemVybwogICAgZnVuY3Rpb24gY291bnRPZkRlZWRzQnlPd25lcihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBfY291bnQpOwoKICAgIC8vLyBAbm90aWNlIEVudW1lcmF0ZSBkZWVkcyBhc3NpZ25lZCB0byBhbiBvd25lcgogICAgLy8vIEBkZXYgVGhyb3dzIGlmIGBfaW5kZXhgID49IGBjb3VudE9mRGVlZHNCeU93bmVyKF9vd25lcilgIG9yIGlmCiAgICAvLy8gIGBfb3duZXJgIGlzIHRoZSB6ZXJvIGFkZHJlc3MsIHJlcHJlc2VudGluZyBkZXN0cm95ZWQgZGVlZHMuCiAgICAvLy8gQHBhcmFtIF9vd25lciBBbiBhZGRyZXNzIHdoZXJlIHdlIGFyZSBpbnRlcmVzdGVkIGluIGRlZWRzIG93bmVkIGJ5IHRoZW0KICAgIC8vLyBAcGFyYW0gX2luZGV4IEEgY291bnRlciBiZXR3ZWVuIHplcm8gYW5kIGBjb3VudE9mRGVlZHNCeU93bmVyKF9vd25lcilgLAogICAgLy8vICBpbmNsdXNpdmUKICAgIC8vLyBAcmV0dXJuIFRoZSBpZGVudGlmaWVyIGZvciB0aGUgYF9pbmRleGB0aCBkZWVkIGFzc2lnbmVkIHRvIGBfb3duZXJgLAogICAgLy8vICAgKHNvcnQgb3JkZXIgbm90IHNwZWNpZmllZCkKICAgIGZ1bmN0aW9uIGRlZWRPZk93bmVyQnlJbmRleChhZGRyZXNzIF9vd25lciwgdWludDI1NiBfaW5kZXgpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NiBfZGVlZElkKTsKCiAgICAvLyBUUkFOU0ZFUiBNRUNIQU5JU00gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBkZXYgVGhpcyBldmVudCBlbWl0cyB3aGVuIG93bmVyc2hpcCBvZiBhbnkgZGVlZCBjaGFuZ2VzIGJ5IGFueQogICAgLy8vICBtZWNoYW5pc20uIFRoaXMgZXZlbnQgZW1pdHMgd2hlbiBkZWVkcyBhcmUgY3JlYXRlZCAoYGZyb21gID09IDApIGFuZAogICAgLy8vICBkZXN0cm95ZWQgKGB0b2AgPT0gMCkuIEV4Y2VwdGlvbjogZHVyaW5nIGNvbnRyYWN0IGNyZWF0aW9uLCBhbnkKICAgIC8vLyAgdHJhbnNmZXJzIG1heSBvY2N1ciB3aXRob3V0IGVtaXR0aW5nIGBUcmFuc2ZlcmAuCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IGluZGV4ZWQgZGVlZElkKTsKCiAgICAvLy8gQGRldiBUaGlzIGV2ZW50IGVtaXRzIG9uIGFueSBzdWNjZXNzZnVsIGNhbGwgdG8KICAgIC8vLyAgYGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfZGVlZElkKWAuIEV4Y2VwdGlvbjogZG9lcyBub3QgZW1pdAogICAgLy8vICBpZiBhbiBvd25lciByZXZva2VzIGFwcHJvdmFsIChgX3RvYCA9PSAweDApIG9uIGEgZGVlZCB3aXRoIG5vIGV4aXN0aW5nCiAgICAvLy8gIGFwcHJvdmFsLgogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgYXBwcm92ZWQsIHVpbnQyNTYgaW5kZXhlZCBkZWVkSWQpOwoKICAgIC8vLyBAbm90aWNlIEFwcHJvdmUgYSBuZXcgb3duZXIgdG8gdGFrZSB5b3VyIGRlZWQsIG9yIHJldm9rZSBhcHByb3ZhbCBieQogICAgLy8vICBzZXR0aW5nIHRoZSB6ZXJvIGFkZHJlc3MuIFlvdSBtYXkgYGFwcHJvdmVgIGFueSBudW1iZXIgb2YgdGltZXMgd2hpbGUKICAgIC8vLyAgdGhlIGRlZWQgaXMgYXNzaWduZWQgdG8geW91LCBvbmx5IHRoZSBtb3N0IHJlY2VudCBhcHByb3ZhbCBtYXR0ZXJzLgogICAgLy8vIEBkZXYgVGhyb3dzIGlmIGBtc2cuc2VuZGVyYCBkb2VzIG5vdCBvd24gZGVlZCBgX2RlZWRJZGAgb3IgaWYgYF90b2AgPT0KICAgIC8vLyAgYG1zZy5zZW5kZXJgLgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBkZWVkIHlvdSBhcmUgZ3JhbnRpbmcgb3duZXJzaGlwIG9mCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9kZWVkSWQpIGV4dGVybmFsOwoKICAgIC8vLyBAbm90aWNlIEJlY29tZSBvd25lciBvZiBhIGRlZWQgZm9yIHdoaWNoIHlvdSBhcmUgY3VycmVudGx5IGFwcHJvdmVkCiAgICAvLy8gQGRldiBUaHJvd3MgaWYgYG1zZy5zZW5kZXJgIGlzIG5vdCBhcHByb3ZlZCB0byBiZWNvbWUgdGhlIG93bmVyIG9mCiAgICAvLy8gIGBkZWVkSWRgIG9yIGlmIGBtc2cuc2VuZGVyYCBjdXJyZW50bHkgb3ducyBgX2RlZWRJZGAuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWQgVGhlIGRlZWQgdGhhdCBpcyBiZWluZyB0cmFuc2ZlcnJlZAogICAgZnVuY3Rpb24gdGFrZU93bmVyc2hpcCh1aW50MjU2IF9kZWVkSWQpIGV4dGVybmFsOwogICAgCiAgICAvLyBTUEVDIEVYVEVOU0lPTlMgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAKICAgIC8vLyBAbm90aWNlIFRyYW5zZmVyIGEgZGVlZCB0byBhIG5ldyBvd25lci4KICAgIC8vLyBAZGV2IFRocm93cyBpZiBgbXNnLnNlbmRlcmAgZG9lcyBub3Qgb3duIGRlZWQgYF9kZWVkSWRgIG9yIGlmCiAgICAvLy8gIGBfdG9gID09IDB4MC4KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgb3duZXIuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWQgVGhlIGRlZWQgeW91IGFyZSB0cmFuc2ZlcnJpbmcuCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfZGVlZElkKSBleHRlcm5hbDsKfQoKCi8vLyBAdGl0bGUgTWV0YWRhdGEgZXh0ZW5zaW9uIHRvIEVSQy03MjEgaW50ZXJmYWNlCi8vLyBAYXV0aG9yIFdpbGxpYW0gRW50cmlrZW4gKGh0dHBzOi8vcGhvci5uZXQpCi8vLyBAZGV2IFNwZWNpZmljYXRpb24gYXQgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvcHVsbC84NDEgKERSQUZUKQppbnRlcmZhY2UgRVJDNzIxTWV0YWRhdGEgewoKICAgIC8vLyBAZGV2IEVSQy0xNjUgKGRyYWZ0KSBpbnRlcmZhY2Ugc2lnbmF0dXJlIGZvciBFUkM3MjEKICAgIC8vIGJ5dGVzNCBpbnRlcm5hbCBjb25zdGFudCBJTlRFUkZBQ0VfU0lHTkFUVVJFX0VSQzcyMU1ldGFkYXRhID0gLy8gMHgyYTc4NmYxMQogICAgLy8gICAgIGJ5dGVzNChrZWNjYWsyNTYoJ25hbWUoKScpKSBeCiAgICAvLyAgICAgYnl0ZXM0KGtlY2NhazI1Nignc3ltYm9sKCknKSkgXgogICAgLy8gICAgIGJ5dGVzNChrZWNjYWsyNTYoJ2RlZWRVcmkodWludDI1NiknKSk7CgogICAgLy8vIEBub3RpY2UgQSBkZXNjcmlwdGl2ZSBuYW1lIGZvciBhIGNvbGxlY3Rpb24gb2YgZGVlZHMgbWFuYWdlZCBieSB0aGlzCiAgICAvLy8gIGNvbnRyYWN0CiAgICAvLy8gQGRldiBXYWxsZXRzIGFuZCBleGNoYW5nZXMgTUFZIGRpc3BsYXkgdGhpcyB0byB0aGUgZW5kIHVzZXIuCiAgICBmdW5jdGlvbiBuYW1lKCkgcHVibGljIHB1cmUgcmV0dXJucyAoc3RyaW5nIF9kZWVkTmFtZSk7CgogICAgLy8vIEBub3RpY2UgQW4gYWJicmV2aWF0ZWQgbmFtZSBmb3IgZGVlZHMgbWFuYWdlZCBieSB0aGlzIGNvbnRyYWN0CiAgICAvLy8gQGRldiBXYWxsZXRzIGFuZCBleGNoYW5nZXMgTUFZIGRpc3BsYXkgdGhpcyB0byB0aGUgZW5kIHVzZXIuCiAgICBmdW5jdGlvbiBzeW1ib2woKSBwdWJsaWMgcHVyZSByZXR1cm5zIChzdHJpbmcgX2RlZWRTeW1ib2wpOwoKICAgIC8vLyBAbm90aWNlIEEgZGlzdGluY3QgVVJJIChSRkMgMzk4NikgZm9yIGEgZ2l2ZW4gdG9rZW4uCiAgICAvLy8gQGRldiBJZjoKICAgIC8vLyAgKiBUaGUgVVJJIGlzIGEgVVJMCiAgICAvLy8gICogVGhlIFVSTCBpcyBhY2Nlc3NpYmxlCiAgICAvLy8gICogVGhlIFVSTCBwb2ludHMgdG8gYSB2YWxpZCBKU09OIGZpbGUgZm9ybWF0IChFQ01BLTQwNCAybmQgZWQuKQogICAgLy8vICAqIFRoZSBKU09OIGJhc2UgZWxlbWVudCBpcyBhbiBvYmplY3QKICAgIC8vLyAgdGhlbiB0aGVzZSBuYW1lcyBvZiB0aGUgYmFzZSBlbGVtZW50IFNIQUxMIGhhdmUgc3BlY2lhbCBtZWFuaW5nOgogICAgLy8vICAqICJuYW1lIjogQSBzdHJpbmcgaWRlbnRpZnlpbmcgdGhlIGl0ZW0gdG8gd2hpY2ggYF9kZWVkSWRgIGdyYW50cwogICAgLy8vICAgIG93bmVyc2hpcAogICAgLy8vICAqICJkZXNjcmlwdGlvbiI6IEEgc3RyaW5nIGRldGFpbGluZyB0aGUgaXRlbSB0byB3aGljaCBgX2RlZWRJZGAgZ3JhbnRzCiAgICAvLy8gICAgb3duZXJzaGlwCiAgICAvLy8gICogImltYWdlIjogQSBVUkkgcG9pbnRpbmcgdG8gYSBmaWxlIG9mIGltYWdlLyogbWltZSB0eXBlIHJlcHJlc2VudGluZwogICAgLy8vICAgIHRoZSBpdGVtIHRvIHdoaWNoIGBfZGVlZElkYCBncmFudHMgb3duZXJzaGlwCiAgICAvLy8gIFdhbGxldHMgYW5kIGV4Y2hhbmdlcyBNQVkgZGlzcGxheSB0aGlzIHRvIHRoZSBlbmQgdXNlci4KICAgIC8vLyAgQ29uc2lkZXIgbWFraW5nIGFueSBpbWFnZXMgYXQgYSB3aWR0aCBiZXR3ZWVuIDMyMCBhbmQgMTA4MCBwaXhlbHMgYW5kCiAgICAvLy8gIGFzcGVjdCByYXRpbyBiZXR3ZWVuIDEuOTE6MSBhbmQgNDo1IGluY2x1c2l2ZS4KICAgIGZ1bmN0aW9uIGRlZWRVcmkodWludDI1NiBfZGVlZElkKSBleHRlcm5hbCBwdXJlIHJldHVybnMgKHN0cmluZyBfdXJpKTsKfQoKCi8vLyBAZGV2IEltcGxlbWVudHMgYWNjZXNzIGNvbnRyb2wgdG8gdGhlIERXb3JsZCBjb250cmFjdC4KY29udHJhY3QgRFdvcmxkQWNjZXNzQ29udHJvbCBpcyBDbGFpbWFibGUsIFBhdXNhYmxlLCBDYW5SZWNsYWltVG9rZW4gewogICAgYWRkcmVzcyBwdWJsaWMgY2ZvQWRkcmVzczsKCiAgICBmdW5jdGlvbiBEV29ybGRBY2Nlc3NDb250cm9sKCkgcHVibGljIHsKICAgICAgICAvLyBUaGUgY3JlYXRvciBvZiB0aGUgY29udHJhY3QgaXMgdGhlIGluaXRpYWwgQ0ZPLgogICAgICAgIGNmb0FkZHJlc3MgPSBtc2cuc2VuZGVyOwogICAgfQogICAgCiAgICAvLy8gQGRldiBBY2Nlc3MgbW9kaWZpZXIgZm9yIENGTy1vbmx5IGZ1bmN0aW9uYWxpdHkuCiAgICBtb2RpZmllciBvbmx5Q0ZPKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBjZm9BZGRyZXNzKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAZGV2IEFzc2lnbnMgYSBuZXcgYWRkcmVzcyB0byBhY3QgYXMgdGhlIENGTy4gT25seSBhdmFpbGFibGUgdG8gdGhlIGN1cnJlbnQgY29udHJhY3Qgb3duZXIuCiAgICAvLy8gQHBhcmFtIF9uZXdDRk8gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBDRk8uCiAgICBmdW5jdGlvbiBzZXRDRk8oYWRkcmVzcyBfbmV3Q0ZPKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoX25ld0NGTyAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgY2ZvQWRkcmVzcyA9IF9uZXdDRk87CiAgICB9Cn0KCgovLy8gQGRldiBEZWZpbmVzIGJhc2UgZGF0YSBzdHJ1Y3R1cmVzIGZvciBEV29ybGQuCmNvbnRyYWN0IERXb3JsZEJhc2UgaXMgRFdvcmxkQWNjZXNzQ29udHJvbCB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKICAgIAogICAgLy8vIEBkZXYgQWxsIG1pbnRlZCBwbG90cyAoYXJyYXkgb2YgcGxvdCBpZGVudGlmaWVycykuIFRoZXJlIGFyZQogICAgLy8vIDJeMTYgKiAyXjE2IHBvc3NpYmxlIHBsb3RzIChjb3ZlcmluZyB0aGUgZW50aXJlIHdvcmxkKSwgdGh1cwogICAgLy8vIDMyIGJpdHMgYXJlIHJlcXVpcmVkLiBUaGlzIGZpdHMgaW4gYSB1aW50MzIuIFN0b3JpbmcKICAgIC8vLyB0aGUgaWRlbnRpZmllcnMgYXMgdWludDMyIGluc3RlYWQgb2YgdWludDI1NiBtYWtlcyBzdG9yYWdlCiAgICAvLy8gY2hlYXBlci4gKFRoZSBpbXBhY3Qgb2YgdGhpcyBpbiBtYXBwaW5ncyBpcyBsZXNzIG5vdGljZWFibGUsCiAgICAvLy8gYW5kIHVzaW5nIHVpbnQzMiBpbiB0aGUgbWFwcGluZ3MgYmVsb3cgYWN0dWFsbHkgKmluY3JlYXNlcyoKICAgIC8vLyBnYXMgY29zdCBmb3IgbWludGluZykuCiAgICB1aW50MzJbXSBwdWJsaWMgcGxvdHM7CiAgICAKICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gYWRkcmVzcykgaWRlbnRpZmllclRvT3duZXI7CiAgICBtYXBwaW5nICh1aW50MjU2ID0+IGFkZHJlc3MpIGlkZW50aWZpZXJUb0FwcHJvdmVkOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBvd25lcnNoaXBEZWVkQ291bnQ7CiAgICAKICAgIC8vIEJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIHRoZSBwbG90IHdhcyBib3VnaHQgYmVmb3JlIHRoZSBtaWdyYXRpb24uCiAgICBtYXBwaW5nICh1aW50MjU2ID0+IGJvb2wpIHB1YmxpYyBpZGVudGlmaWVySXNPcmlnaW5hbDsKICAgIAogICAgLy8vIEBkZXYgRXZlbnQgZmlyZWQgd2hlbiBhIHBsb3QncyBkYXRhIGFyZSBjaGFuZ2VkLiBUaGUgcGxvdAogICAgLy8vIGRhdGEgYXJlIG5vdCBzdG9yZWQgaW4gdGhlIGNvbnRyYWN0IGRpcmVjdGx5LCBpbnN0ZWFkIHRoZQogICAgLy8vIGRhdGEgYXJlIGxvZ2dlZCB0byB0aGUgYmxvY2suIFRoaXMgZ2l2ZXMgc2lnbmlmaWNhbnQKICAgIC8vLyByZWR1Y3Rpb25zIGluIGdhcyByZXF1aXJlbWVudHMgKH43NWsgZm9yIG1pbnRpbmcgd2l0aCBkYXRhCiAgICAvLy8gaW5zdGVhZCBvZiB+MTgwaykuIEhvd2V2ZXIsIGl0IGFsc28gbWVhbnMgcGxvdCBkYXRhIGFyZQogICAgLy8vIG5vdCBhdmFpbGFibGUgZnJvbSAqd2l0aGluKiBvdGhlciBjb250cmFjdHMuCiAgICBldmVudCBTZXREYXRhKHVpbnQyNTYgaW5kZXhlZCBkZWVkSWQsIHN0cmluZyBuYW1lLCBzdHJpbmcgZGVzY3JpcHRpb24sIHN0cmluZyBpbWFnZVVybCwgc3RyaW5nIGluZm9VcmwpOwogICAgCiAgICAvLy8gQG5vdGljZSBHZXQgYWxsIG1pbnRlZCBwbG90cy4KICAgIGZ1bmN0aW9uIGdldEFsbFBsb3RzKCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zKHVpbnQzMltdKSB7CiAgICAgICAgcmV0dXJuIHBsb3RzOwogICAgfQogICAgCiAgICAvLy8gQGRldiBSZXByZXNlbnQgYSAyRCBjb29yZGluYXRlIGFzIGEgc2luZ2xlIHVpbnQuCiAgICAvLy8gQHBhcmFtIHggVGhlIHgtY29vcmRpbmF0ZS4KICAgIC8vLyBAcGFyYW0geSBUaGUgeS1jb29yZGluYXRlLgogICAgZnVuY3Rpb24gY29vcmRpbmF0ZVRvSWRlbnRpZmllcih1aW50MjU2IHgsIHVpbnQyNTYgeSkgcHVibGljIHB1cmUgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgICAgcmVxdWlyZSh2YWxpZENvb3JkaW5hdGUoeCwgeSkpOwogICAgICAgIAogICAgICAgIHJldHVybiAoeSA8PCAxNikgKyB4OwogICAgfQogICAgCiAgICAvLy8gQGRldiBUdXJuIGEgc2luZ2xlIHVpbnQgcmVwcmVzZW50YXRpb24gb2YgYSBjb29yZGluYXRlIGludG8gaXRzIHggYW5kIHkgcGFydHMuCiAgICAvLy8gQHBhcmFtIGlkZW50aWZpZXIgVGhlIHVpbnQgcmVwcmVzZW50YXRpb24gb2YgYSBjb29yZGluYXRlLgogICAgZnVuY3Rpb24gaWRlbnRpZmllclRvQ29vcmRpbmF0ZSh1aW50MjU2IGlkZW50aWZpZXIpIHB1YmxpYyBwdXJlIHJldHVybnModWludDI1NiB4LCB1aW50MjU2IHkpIHsKICAgICAgICByZXF1aXJlKHZhbGlkSWRlbnRpZmllcihpZGVudGlmaWVyKSk7CiAgICAKICAgICAgICB5ID0gaWRlbnRpZmllciA+PiAxNjsKICAgICAgICB4ID0gaWRlbnRpZmllciAtICh5IDw8IDE2KTsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgVGVzdCB3aGV0aGVyIHRoZSBjb29yZGluYXRlIGlzIHZhbGlkLgogICAgLy8vIEBwYXJhbSB4IFRoZSB4LXBhcnQgb2YgdGhlIGNvb3JkaW5hdGUgdG8gdGVzdC4KICAgIC8vLyBAcGFyYW0geSBUaGUgeS1wYXJ0IG9mIHRoZSBjb29yZGluYXRlIHRvIHRlc3QuCiAgICBmdW5jdGlvbiB2YWxpZENvb3JkaW5hdGUodWludDI1NiB4LCB1aW50MjU2IHkpIHB1YmxpYyBwdXJlIHJldHVybnMoYm9vbCkgewogICAgICAgIHJldHVybiB4IDwgNjU1MzYgJiYgeSA8IDY1NTM2OyAvLyAyXjE2CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IFRlc3Qgd2hldGhlciBhbiBpZGVudGlmaWVyIGlzIHZhbGlkLgogICAgLy8vIEBwYXJhbSBpZGVudGlmaWVyIFRoZSBpZGVudGlmaWVyIHRvIHRlc3QuCiAgICBmdW5jdGlvbiB2YWxpZElkZW50aWZpZXIodWludDI1NiBpZGVudGlmaWVyKSBwdWJsaWMgcHVyZSByZXR1cm5zKGJvb2wpIHsKICAgICAgICByZXR1cm4gaWRlbnRpZmllciA8IDQyOTQ5NjcyOTY7IC8vIDJeMTYgKiAyXjE2CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IFNldCBhIHBsb3QncyBkYXRhLgogICAgLy8vIEBwYXJhbSBpZGVudGlmaWVyIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBwbG90IHRvIHNldCBkYXRhIGZvci4KICAgIGZ1bmN0aW9uIF9zZXRQbG90RGF0YSh1aW50MjU2IGlkZW50aWZpZXIsIHN0cmluZyBuYW1lLCBzdHJpbmcgZGVzY3JpcHRpb24sIHN0cmluZyBpbWFnZVVybCwgc3RyaW5nIGluZm9VcmwpIGludGVybmFsIHsKICAgICAgICBTZXREYXRhKGlkZW50aWZpZXIsIG5hbWUsIGRlc2NyaXB0aW9uLCBpbWFnZVVybCwgaW5mb1VybCk7CiAgICB9Cn0KCgovLy8gQGRldiBIb2xkcyBkZWVkIGZ1bmN0aW9uYWxpdHkgc3VjaCBhcyBhcHByb3ZpbmcgYW5kIHRyYW5zZmVycmluZy4gSW1wbGVtZW50cyBFUkM3MjEuCmNvbnRyYWN0IERXb3JsZERlZWQgaXMgRFdvcmxkQmFzZSwgRVJDNzIxLCBFUkM3MjFNZXRhZGF0YSB7CiAgICAKICAgIC8vLyBAbm90aWNlIE5hbWUgb2YgdGhlIGNvbGxlY3Rpb24gb2YgZGVlZHMgKG5vbi1mdW5naWJsZSB0b2tlbiksIGFzIGRlZmluZWQgaW4gRVJDNzIxTWV0YWRhdGEuCiAgICBmdW5jdGlvbiBuYW1lKCkgcHVibGljIHB1cmUgcmV0dXJucyAoc3RyaW5nIF9kZWVkTmFtZSkgewogICAgICAgIF9kZWVkTmFtZSA9ICJEV29ybGQgUGxvdHMiOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBTeW1ib2wgb2YgdGhlIGNvbGxlY3Rpb24gb2YgZGVlZHMgKG5vbi1mdW5naWJsZSB0b2tlbiksIGFzIGRlZmluZWQgaW4gRVJDNzIxTWV0YWRhdGEuCiAgICBmdW5jdGlvbiBzeW1ib2woKSBwdWJsaWMgcHVyZSByZXR1cm5zIChzdHJpbmcgX2RlZWRTeW1ib2wpIHsKICAgICAgICBfZGVlZFN5bWJvbCA9ICJEV1AiOwogICAgfQogICAgCiAgICAvLy8gQGRldiBFUkMtMTY1IChkcmFmdCkgaW50ZXJmYWNlIHNpZ25hdHVyZSBmb3IgaXRzZWxmCiAgICBieXRlczQgaW50ZXJuYWwgY29uc3RhbnQgSU5URVJGQUNFX1NJR05BVFVSRV9FUkMxNjUgPSAvLyAweDAxZmZjOWE3CiAgICAgICAgYnl0ZXM0KGtlY2NhazI1Nignc3VwcG9ydHNJbnRlcmZhY2UoYnl0ZXM0KScpKTsKCiAgICAvLy8gQGRldiBFUkMtMTY1IChkcmFmdCkgaW50ZXJmYWNlIHNpZ25hdHVyZSBmb3IgRVJDNzIxCiAgICBieXRlczQgaW50ZXJuYWwgY29uc3RhbnQgSU5URVJGQUNFX1NJR05BVFVSRV9FUkM3MjEgPSAvLyAweGRhNjcxYjliCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1Nignb3duZXJPZih1aW50MjU2KScpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NignY291bnRPZkRlZWRzKCknKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ2NvdW50T2ZEZWVkc0J5T3duZXIoYWRkcmVzcyknKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ2RlZWRPZk93bmVyQnlJbmRleChhZGRyZXNzLHVpbnQyNTYpJykpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCdhcHByb3ZlKGFkZHJlc3MsdWludDI1NiknKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3Rha2VPd25lcnNoaXAodWludDI1NiknKSk7CiAgICAgICAgCiAgICAvLy8gQGRldiBFUkMtMTY1IChkcmFmdCkgaW50ZXJmYWNlIHNpZ25hdHVyZSBmb3IgRVJDNzIxCiAgICBieXRlczQgaW50ZXJuYWwgY29uc3RhbnQgSU5URVJGQUNFX1NJR05BVFVSRV9FUkM3MjFNZXRhZGF0YSA9IC8vIDB4MmE3ODZmMTEKICAgICAgICBieXRlczQoa2VjY2FrMjU2KCduYW1lKCknKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3N5bWJvbCgpJykpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCdkZWVkVXJpKHVpbnQyNTYpJykpOwogICAgCiAgICAvLy8gQG5vdGljZSBJbnRyb3NwZWN0aW9uIGludGVyZmFjZSBhcyBwZXIgRVJDLTE2NSAoaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE2NSkuCiAgICAvLy8gUmV0dXJucyB0cnVlIGZvciBhbnkgc3RhbmRhcmRpemVkIGludGVyZmFjZXMgaW1wbGVtZW50ZWQgYnkgdGhpcyBjb250cmFjdC4KICAgIC8vLyAoRVJDLTE2NSBhbmQgRVJDLTcyMS4pCiAgICBmdW5jdGlvbiBzdXBwb3J0c0ludGVyZmFjZShieXRlczQgX2ludGVyZmFjZUlEKSBleHRlcm5hbCBwdXJlIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAoX2ludGVyZmFjZUlEID09IElOVEVSRkFDRV9TSUdOQVRVUkVfRVJDMTY1KQogICAgICAgICAgICB8fCAoX2ludGVyZmFjZUlEID09IElOVEVSRkFDRV9TSUdOQVRVUkVfRVJDNzIxKQogICAgICAgICAgICB8fCAoX2ludGVyZmFjZUlEID09IElOVEVSRkFDRV9TSUdOQVRVUkVfRVJDNzIxTWV0YWRhdGEpCiAgICAgICAgKTsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgQ2hlY2tzIGlmIGEgZ2l2ZW4gYWRkcmVzcyBvd25zIGEgcGFydGljdWxhciBwbG90LgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIG93bmVyIHRvIGNoZWNrIGZvci4KICAgIC8vLyBAcGFyYW0gX2RlZWRJZCBUaGUgcGxvdCBpZGVudGlmaWVyIHRvIGNoZWNrIGZvci4KICAgIGZ1bmN0aW9uIF9vd25zKGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF9kZWVkSWQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBpZGVudGlmaWVyVG9Pd25lcltfZGVlZElkXSA9PSBfb3duZXI7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IEFwcHJvdmUgYSBnaXZlbiBhZGRyZXNzIHRvIHRha2Ugb3duZXJzaGlwIG9mIGEgZGVlZC4KICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3MgYXBwcm92aW5nIHRha2luZyBvd25lcnNoaXAuCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0byBhcHByb3ZlIHRha2luZyBvd25lcnNoaXAuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWQgVGhlIGlkZW50aWZpZXIgb2YgdGhlIGRlZWQgdG8gZ2l2ZSBhcHByb3ZhbCBmb3IuCiAgICBmdW5jdGlvbiBfYXBwcm92ZShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfZGVlZElkKSBpbnRlcm5hbCB7CiAgICAgICAgaWRlbnRpZmllclRvQXBwcm92ZWRbX2RlZWRJZF0gPSBfdG87CiAgICAgICAgCiAgICAgICAgLy8gRW1pdCBldmVudC4KICAgICAgICBBcHByb3ZhbChfZnJvbSwgX3RvLCBfZGVlZElkKTsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgQ2hlY2tzIGlmIGEgZ2l2ZW4gYWRkcmVzcyBoYXMgYXBwcm92YWwgdG8gdGFrZSBvd25lcnNoaXAgb2YgYSBkZWVkLgogICAgLy8vIEBwYXJhbSBfY2xhaW1hbnQgVGhlIGFkZHJlc3Mgb2YgdGhlIGNsYWltYW50IHRvIGNoZWNrIGZvci4KICAgIC8vLyBAcGFyYW0gX2RlZWRJZCBUaGUgaWRlbnRpZmllciBvZiB0aGUgZGVlZCB0byBjaGVjayBmb3IuCiAgICBmdW5jdGlvbiBfYXBwcm92ZWRGb3IoYWRkcmVzcyBfY2xhaW1hbnQsIHVpbnQyNTYgX2RlZWRJZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGlkZW50aWZpZXJUb0FwcHJvdmVkW19kZWVkSWRdID09IF9jbGFpbWFudDsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgQXNzaWducyBvd25lcnNoaXAgb2YgYSBzcGVjaWZpYyBkZWVkIHRvIGFuIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRoZSBkZWVkIGZyb20uCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0aGUgZGVlZCB0by4KICAgIC8vLyBAcGFyYW0gX2RlZWRJZCBUaGUgaWRlbnRpZmllciBvZiB0aGUgZGVlZCB0byB0cmFuc2Zlci4KICAgIGZ1bmN0aW9uIF90cmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfZGVlZElkKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gVGhlIG51bWJlciBvZiBwbG90cyBpcyBjYXBwZWQgYXQgMl4xNiAqIDJeMTYsIHNvIHRoaXMgY2Fubm90CiAgICAgICAgLy8gYmUgb3ZlcmZsb3dlZC4KICAgICAgICBvd25lcnNoaXBEZWVkQ291bnRbX3RvXSsrOwogICAgICAgIAogICAgICAgIC8vIFRyYW5zZmVyIG93bmVyc2hpcC4KICAgICAgICBpZGVudGlmaWVyVG9Pd25lcltfZGVlZElkXSA9IF90bzsKICAgICAgICAKICAgICAgICAvLyBXaGVuIGEgbmV3IGRlZWQgaXMgbWludGVkLCB0aGUgX2Zyb20gYWRkcmVzcyBpcyAweDAsIGJ1dCB3ZQogICAgICAgIC8vIGRvIG5vdCB0cmFjayBkZWVkIG93bmVyc2hpcCBvZiAweDAuCiAgICAgICAgaWYgKF9mcm9tICE9IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgb3duZXJzaGlwRGVlZENvdW50W19mcm9tXS0tOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQ2xlYXIgdGFraW5nIG93bmVyc2hpcCBhcHByb3ZhbC4KICAgICAgICAgICAgZGVsZXRlIGlkZW50aWZpZXJUb0FwcHJvdmVkW19kZWVkSWRdOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBFbWl0IHRoZSB0cmFuc2ZlciBldmVudC4KICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfZGVlZElkKTsKICAgIH0KICAgIAogICAgLy8gRVJDIDcyMSBpbXBsZW1lbnRhdGlvbgogICAgCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIHRoZSB0b3RhbCBudW1iZXIgb2YgZGVlZHMgY3VycmVudGx5IGluIGV4aXN0ZW5jZS4KICAgIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UuCiAgICBmdW5jdGlvbiBjb3VudE9mRGVlZHMoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHBsb3RzLmxlbmd0aDsKICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgUmV0dXJucyB0aGUgbnVtYmVyIG9mIGRlZWRzIG93bmVkIGJ5IGEgc3BlY2lmaWMgYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBvd25lciBhZGRyZXNzIHRvIGNoZWNrLgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZQogICAgZnVuY3Rpb24gY291bnRPZkRlZWRzQnlPd25lcihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBvd25lcnNoaXBEZWVkQ291bnRbX293bmVyXTsKICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgUmV0dXJucyB0aGUgYWRkcmVzcyBjdXJyZW50bHkgYXNzaWduZWQgb3duZXJzaGlwIG9mIGEgZ2l2ZW4gZGVlZC4KICAgIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UuCiAgICBmdW5jdGlvbiBvd25lck9mKHVpbnQyNTYgX2RlZWRJZCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChhZGRyZXNzIF9vd25lcikgewogICAgICAgIF9vd25lciA9IGlkZW50aWZpZXJUb093bmVyW19kZWVkSWRdOwoKICAgICAgICByZXF1aXJlKF9vd25lciAhPSBhZGRyZXNzKDApKTsKICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgQXBwcm92ZSBhIGdpdmVuIGFkZHJlc3MgdG8gdGFrZSBvd25lcnNoaXAgb2YgYSBkZWVkLgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gYXBwcm92ZSB0YWtpbmcgb3dlcm5zaGlwLgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBkZWVkIHRvIGdpdmUgYXBwcm92YWwgZm9yLgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2RlZWRJZCkgZXh0ZXJuYWwgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgdWludDI1NltdIG1lbW9yeSBfZGVlZElkcyA9IG5ldyB1aW50MjU2W10oMSk7CiAgICAgICAgX2RlZWRJZHNbMF0gPSBfZGVlZElkOwogICAgICAgIAogICAgICAgIGFwcHJvdmVNdWx0aXBsZShfdG8sIF9kZWVkSWRzKTsKICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgQXBwcm92ZSBhIGdpdmVuIGFkZHJlc3MgdG8gdGFrZSBvd25lcnNoaXAgb2YgbXVsdGlwbGUgZGVlZHMuCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0byBhcHByb3ZlIHRha2luZyBvd25lcnNoaXAuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWRzIFRoZSBpZGVudGlmaWVycyBvZiB0aGUgZGVlZHMgdG8gZ2l2ZSBhcHByb3ZhbCBmb3IuCiAgICBmdW5jdGlvbiBhcHByb3ZlTXVsdGlwbGUoYWRkcmVzcyBfdG8sIHVpbnQyNTZbXSBfZGVlZElkcykgcHVibGljIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIC8vIEVuc3VyZSB0aGUgc2VuZGVyIGlzIG5vdCBhcHByb3ZpbmcgdGhlbXNlbHZlcy4KICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgIT0gX3RvKTsKICAgIAogICAgICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IF9kZWVkSWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHVpbnQyNTYgX2RlZWRJZCA9IF9kZWVkSWRzW2ldOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gUmVxdWlyZSB0aGUgc2VuZGVyIGlzIHRoZSBvd25lciBvZiB0aGUgZGVlZC4KICAgICAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfZGVlZElkKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBQZXJmb3JtIHRoZSBhcHByb3ZhbC4KICAgICAgICAgICAgX2FwcHJvdmUobXNnLnNlbmRlciwgX3RvLCBfZGVlZElkKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFRyYW5zZmVyIGEgZGVlZCB0byBhbm90aGVyIGFkZHJlc3MuIElmIHRyYW5zZmVycmluZyB0byBhIHNtYXJ0CiAgICAvLy8gY29udHJhY3QgYmUgVkVSWSBDQVJFRlVMIHRvIGVuc3VyZSB0aGF0IGl0IGlzIGF3YXJlIG9mIEVSQy03MjEsIG9yIHlvdXIKICAgIC8vLyBkZWVkIG1heSBiZSBsb3N0IGZvcmV2ZXIuCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50LCBjYW4gYmUgYSB1c2VyIG9yIGNvbnRyYWN0LgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBkZWVkIHRvIHRyYW5zZmVyLgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9kZWVkSWQpIGV4dGVybmFsIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIHVpbnQyNTZbXSBtZW1vcnkgX2RlZWRJZHMgPSBuZXcgdWludDI1NltdKDEpOwogICAgICAgIF9kZWVkSWRzWzBdID0gX2RlZWRJZDsKICAgICAgICAKICAgICAgICB0cmFuc2Zlck11bHRpcGxlKF90bywgX2RlZWRJZHMpOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBUcmFuc2ZlcnMgbXVsdGlwbGUgZGVlZHMgdG8gYW5vdGhlciBhZGRyZXNzLiBJZiB0cmFuc2ZlcnJpbmcgdG8KICAgIC8vLyBhIHNtYXJ0IGNvbnRyYWN0IGJlIFZFUlkgQ0FSRUZVTCB0byBlbnN1cmUgdGhhdCBpdCBpcyBhd2FyZSBvZiBFUkMtNzIxLAogICAgLy8vIG9yIHlvdXIgZGVlZHMgbWF5IGJlIGxvc3QgZm9yZXZlci4KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQsIGNhbiBiZSBhIHVzZXIgb3IgY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWRzIFRoZSBpZGVudGlmaWVycyBvZiB0aGUgZGVlZHMgdG8gdHJhbnNmZXIuCiAgICBmdW5jdGlvbiB0cmFuc2Zlck11bHRpcGxlKGFkZHJlc3MgX3RvLCB1aW50MjU2W10gX2RlZWRJZHMpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHsKICAgICAgICAvLyBTYWZldHkgY2hlY2sgdG8gcHJldmVudCBhZ2FpbnN0IGFuIHVuZXhwZWN0ZWQgMHgwIGRlZmF1bHQuCiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgCiAgICAgICAgLy8gRGlzYWxsb3cgdHJhbnNmZXJzIHRvIHRoaXMgY29udHJhY3QgdG8gcHJldmVudCBhY2NpZGVudGFsIG1pc3VzZS4KICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKHRoaXMpKTsKICAgIAogICAgICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IF9kZWVkSWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHVpbnQyNTYgX2RlZWRJZCA9IF9kZWVkSWRzW2ldOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gT25lIGNhbiBvbmx5IHRyYW5zZmVyIHRoZWlyIG93biBwbG90cy4KICAgICAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfZGVlZElkKSk7CgogICAgICAgICAgICAvLyBUcmFuc2ZlciBvd25lcnNoaXAKICAgICAgICAgICAgX3RyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX2RlZWRJZCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBUcmFuc2ZlciBhIGRlZWQgb3duZWQgYnkgYW5vdGhlciBhZGRyZXNzLCBmb3Igd2hpY2ggdGhlIGNhbGxpbmcKICAgIC8vLyBhZGRyZXNzIGhhcyBwcmV2aW91c2x5IGJlZW4gZ3JhbnRlZCB0cmFuc2ZlciBhcHByb3ZhbCBieSB0aGUgb3duZXIuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWQgVGhlIGlkZW50aWZpZXIgb2YgdGhlIGRlZWQgdG8gYmUgdHJhbnNmZXJyZWQuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgZnVuY3Rpb24gdGFrZU93bmVyc2hpcCh1aW50MjU2IF9kZWVkSWQpIGV4dGVybmFsIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIHVpbnQyNTZbXSBtZW1vcnkgX2RlZWRJZHMgPSBuZXcgdWludDI1NltdKDEpOwogICAgICAgIF9kZWVkSWRzWzBdID0gX2RlZWRJZDsKICAgICAgICAKICAgICAgICB0YWtlT3duZXJzaGlwTXVsdGlwbGUoX2RlZWRJZHMpOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBUcmFuc2ZlciBtdWx0aXBsZSBkZWVkcyBvd25lZCBieSBhbm90aGVyIGFkZHJlc3MsIGZvciB3aGljaCB0aGUKICAgIC8vLyBjYWxsaW5nIGFkZHJlc3MgaGFzIHByZXZpb3VzbHkgYmVlbiBncmFudGVkIHRyYW5zZmVyIGFwcHJvdmFsIGJ5IHRoZSBvd25lci4KICAgIC8vLyBAcGFyYW0gX2RlZWRJZHMgVGhlIGlkZW50aWZpZXIgb2YgdGhlIGRlZWQgdG8gYmUgdHJhbnNmZXJyZWQuCiAgICBmdW5jdGlvbiB0YWtlT3duZXJzaGlwTXVsdGlwbGUodWludDI1NltdIF9kZWVkSWRzKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgX2RlZWRJZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdWludDI1NiBfZGVlZElkID0gX2RlZWRJZHNbaV07CiAgICAgICAgICAgIGFkZHJlc3MgX2Zyb20gPSBpZGVudGlmaWVyVG9Pd25lcltfZGVlZElkXTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIENoZWNrIGZvciB0cmFuc2ZlciBhcHByb3ZhbAogICAgICAgICAgICByZXF1aXJlKF9hcHByb3ZlZEZvcihtc2cuc2VuZGVyLCBfZGVlZElkKSk7CgogICAgICAgICAgICAvLyBSZWFzc2lnbiBvd25lcnNoaXAgKGFsc28gY2xlYXJzIHBlbmRpbmcgYXBwcm92YWxzIGFuZCBlbWl0cyBUcmFuc2ZlciBldmVudCkuCiAgICAgICAgICAgIF90cmFuc2ZlcihfZnJvbSwgbXNnLnNlbmRlciwgX2RlZWRJZCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIGEgbGlzdCBvZiBhbGwgZGVlZCBpZGVudGlmaWVycyBhc3NpZ25lZCB0byBhbiBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIG93bmVyIHdob3NlIGRlZWRzIHdlIGFyZSBpbnRlcmVzdGVkIGluLgogICAgLy8vIEBkZXYgVGhpcyBtZXRob2QgTVVTVCBORVZFUiBiZSBjYWxsZWQgYnkgc21hcnQgY29udHJhY3QgY29kZS4gSXQncyB2ZXJ5CiAgICAvLy8gZXhwZW5zaXZlIGFuZCBpcyBub3Qgc3VwcG9ydGVkIGluIGNvbnRyYWN0LXRvLWNvbnRyYWN0IGNhbGxzIGFzIGl0IHJldHVybnMKICAgIC8vLyBhIGR5bmFtaWMgYXJyYXkgKG9ubHkgc3VwcG9ydGVkIGZvciB3ZWIzIGNhbGxzKS4KICAgIGZ1bmN0aW9uIGRlZWRzT2ZPd25lcihhZGRyZXNzIF9vd25lcikgZXh0ZXJuYWwgdmlldyByZXR1cm5zKHVpbnQyNTZbXSkgewogICAgICAgIHVpbnQyNTYgZGVlZENvdW50ID0gY291bnRPZkRlZWRzQnlPd25lcihfb3duZXIpOwoKICAgICAgICBpZiAoZGVlZENvdW50ID09IDApIHsKICAgICAgICAgICAgLy8gUmV0dXJuIGFuIGVtcHR5IGFycmF5LgogICAgICAgICAgICByZXR1cm4gbmV3IHVpbnQyNTZbXSgwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB1aW50MjU2W10gbWVtb3J5IHJlc3VsdCA9IG5ldyB1aW50MjU2W10oZGVlZENvdW50KTsKICAgICAgICAgICAgdWludDI1NiB0b3RhbERlZWRzID0gY291bnRPZkRlZWRzKCk7CiAgICAgICAgICAgIHVpbnQyNTYgcmVzdWx0SW5kZXggPSAwOwogICAgICAgICAgICAKICAgICAgICAgICAgZm9yICh1aW50MjU2IGRlZWROdW1iZXIgPSAwOyBkZWVkTnVtYmVyIDwgdG90YWxEZWVkczsgZGVlZE51bWJlcisrKSB7CiAgICAgICAgICAgICAgICB1aW50MjU2IGlkZW50aWZpZXIgPSBwbG90c1tkZWVkTnVtYmVyXTsKICAgICAgICAgICAgICAgIGlmIChpZGVudGlmaWVyVG9Pd25lcltpZGVudGlmaWVyXSA9PSBfb3duZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHRbcmVzdWx0SW5kZXhdID0gaWRlbnRpZmllcjsKICAgICAgICAgICAgICAgICAgICByZXN1bHRJbmRleCsrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgUmV0dXJucyBhIGRlZWQgaWRlbnRpZmllciBvZiB0aGUgb3duZXIgYXQgdGhlIGdpdmVuIGluZGV4LgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIG93bmVyIHdlIHdhbnQgdG8gZ2V0IGEgZGVlZCBmb3IuCiAgICAvLy8gQHBhcmFtIF9pbmRleCBUaGUgaW5kZXggb2YgdGhlIGRlZWQgd2Ugd2FudC4KICAgIGZ1bmN0aW9uIGRlZWRPZk93bmVyQnlJbmRleChhZGRyZXNzIF9vd25lciwgdWludDI1NiBfaW5kZXgpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIC8vIFRoZSBpbmRleCBzaG91bGQgYmUgdmFsaWQuCiAgICAgICAgcmVxdWlyZShfaW5kZXggPCBjb3VudE9mRGVlZHNCeU93bmVyKF9vd25lcikpOwoKICAgICAgICAvLyBMb29wIHRocm91Z2ggYWxsIHBsb3RzLCBhY2NvdW50aW5nIHRoZSBudW1iZXIgb2YgcGxvdHMgb2YgdGhlIG93bmVyIHdlJ3ZlIHNlZW4uCiAgICAgICAgdWludDI1NiBzZWVuID0gMDsKICAgICAgICB1aW50MjU2IHRvdGFsRGVlZHMgPSBjb3VudE9mRGVlZHMoKTsKICAgICAgICAKICAgICAgICBmb3IgKHVpbnQyNTYgZGVlZE51bWJlciA9IDA7IGRlZWROdW1iZXIgPCB0b3RhbERlZWRzOyBkZWVkTnVtYmVyKyspIHsKICAgICAgICAgICAgdWludDI1NiBpZGVudGlmaWVyID0gcGxvdHNbZGVlZE51bWJlcl07CiAgICAgICAgICAgIGlmIChpZGVudGlmaWVyVG9Pd25lcltpZGVudGlmaWVyXSA9PSBfb3duZXIpIHsKICAgICAgICAgICAgICAgIGlmIChzZWVuID09IF9pbmRleCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBpZGVudGlmaWVyOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzZWVuKys7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFJldHVybnMgYW4gKG9mZi1jaGFpbikgbWV0YWRhdGEgdXJsIGZvciB0aGUgZ2l2ZW4gZGVlZC4KICAgIC8vLyBAcGFyYW0gX2RlZWRJZCBUaGUgaWRlbnRpZmllciBvZiB0aGUgZGVlZCB0byBnZXQgdGhlIG1ldGFkYXRhCiAgICAvLy8gdXJsIGZvci4KICAgIC8vLyBAZGV2IEltcGxlbWVudGF0aW9uIG9mIG9wdGlvbmFsIEVSQy03MjEgZnVuY3Rpb25hbGl0eS4KICAgIGZ1bmN0aW9uIGRlZWRVcmkodWludDI1NiBfZGVlZElkKSBleHRlcm5hbCBwdXJlIHJldHVybnMgKHN0cmluZyB1cmkpIHsKICAgICAgICByZXF1aXJlKHZhbGlkSWRlbnRpZmllcihfZGVlZElkKSk7CiAgICAKICAgICAgICB2YXIgKHgsIHkpID0gaWRlbnRpZmllclRvQ29vcmRpbmF0ZShfZGVlZElkKTsKICAgIAogICAgICAgIC8vIE1heGltdW0gY29vcmRpbmF0ZSBsZW5ndGggaW4gZGVjaW1hbHMgaXMgNSAoNjU1MzUpCiAgICAgICAgdXJpID0gImh0dHBzOi8vZHdvcmxkLmlvL3Bsb3QveHh4eHgveHh4eHgiOwogICAgICAgIGJ5dGVzIG1lbW9yeSBfdXJpID0gYnl0ZXModXJpKTsKICAgICAgICAKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCA1OyBpKyspIHsKICAgICAgICAgICAgX3VyaVsyNyAtIGldID0gYnl0ZSg0OCArICh4IC8gMTAgKiogaSkgJSAxMCk7CiAgICAgICAgICAgIF91cmlbMzMgLSBpXSA9IGJ5dGUoNDggKyAoeSAvIDEwICoqIGkpICUgMTApOwogICAgICAgIH0KICAgIH0KfQoKCi8vLyBAZGV2IEhvbGRzIGZ1bmN0aW9uYWxpdHkgZm9yIGZpbmFuY2UgcmVsYXRlZCB0byBwbG90cy4KY29udHJhY3QgRFdvcmxkRmluYW5jZSBpcyBEV29ybGREZWVkIHsKICAgIC8vLyBUb3RhbCBhbW91bnQgb2YgRXRoZXIgeWV0IHRvIGJlIHBhaWQgdG8gYXVjdGlvbiBiZW5lZmljaWFyaWVzLgogICAgdWludDI1NiBwdWJsaWMgb3V0c3RhbmRpbmdFdGhlciA9IDAgZXRoZXI7CiAgICAKICAgIC8vLyBBbW91bnQgb2YgRXRoZXIgeWV0IHRvIGJlIHBhaWQgcGVyIGJlbmVmaWNpYXJ5LgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgYWRkcmVzc1RvRXRoZXJPd2VkOwogICAgCiAgICAvLy8gQmFzZSBwcmljZSBmb3IgdW5jbGFpbWVkIHBsb3RzLgogICAgdWludDI1NiBwdWJsaWMgdW5jbGFpbWVkUGxvdFByaWNlID0gMC4wMTI1IGV0aGVyOwogICAgCiAgICAvLy8gRGl2aWRlbmQgcGVyIHBsb3Qgc3Vycm91bmRpbmcgYSBuZXcgY2xhaW0sIGluIDEvMTAwMHRoIG9mIHBlcmNlbnRhZ2VzCiAgICAvLy8gb2YgdGhlIGJhc2UgdW5jbGFpbWVkIHBsb3QgcHJpY2UuCiAgICB1aW50MjU2IHB1YmxpYyBjbGFpbURpdmlkZW5kUGVyY2VudGFnZSA9IDUwMDAwOwogICAgCiAgICAvLy8gUGVyY2VudGFnZSBvZiB0aGUgYnV5b3V0IHByaWNlIHRoYXQgZ29lcyB0b3dhcmRzIGRpdmlkZW5kcy4KICAgIHVpbnQyNTYgcHVibGljIGJ1eW91dERpdmlkZW5kUGVyY2VudGFnZSA9IDUwMDA7CiAgICAKICAgIC8vLyBCdXlvdXQgZmVlIGluIDEvMTAwMHRoIG9mIGEgcGVyY2VudGFnZS4KICAgIHVpbnQyNTYgcHVibGljIGJ1eW91dEZlZVBlcmNlbnRhZ2UgPSAzNTAwOwogICAgCiAgICAvLy8gTnVtYmVyIG9mIGZyZWUgY2xhaW1zIHBlciBhZGRyZXNzLgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBmcmVlQ2xhaW1BbGxvd2FuY2U7CiAgICAKICAgIC8vLyBJbml0aWFsIHByaWNlIHBhaWQgZm9yIGEgcGxvdC4KICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gdWludDI1NikgcHVibGljIGluaXRpYWxQcmljZVBhaWQ7CiAgICAKICAgIC8vLyBDdXJyZW50IHBsb3QgcHJpY2UuCiAgICBtYXBwaW5nICh1aW50MjU2ID0+IHVpbnQyNTYpIHB1YmxpYyBpZGVudGlmaWVyVG9CdXlvdXRQcmljZTsKICAgIAogICAgLy8vIEJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIHRoZSBwbG90IGhhcyBiZWVuIGJvdWdodCBvdXQgYXQgbGVhc3Qgb25jZS4KICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gYm9vbCkgaWRlbnRpZmllclRvQm91Z2h0T3V0T25jZTsKICAgIAogICAgLy8vIEBkZXYgRXZlbnQgZmlyZWQgd2hlbiBkaXZpZGVuZCBpcyBwYWlkIGZvciBhIG5ldyBwbG90IGNsYWltLgogICAgZXZlbnQgQ2xhaW1EaXZpZGVuZChhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IGRlZWRJZEZyb20sIHVpbnQyNTYgaW5kZXhlZCBkZWVkSWRUbywgdWludDI1NiBkaXZpZGVuZCk7CiAgICAKICAgIC8vLyBAZGV2IEV2ZW50IGZpcmVkIHdoZW4gYSBidXlvdXQgaXMgcGVyZm9ybWVkLgogICAgZXZlbnQgQnV5b3V0KGFkZHJlc3MgaW5kZXhlZCBidXllciwgYWRkcmVzcyBpbmRleGVkIHNlbGxlciwgdWludDI1NiBpbmRleGVkIGRlZWRJZCwgdWludDI1NiB3aW5uaW5ncywgdWludDI1NiB0b3RhbENvc3QsIHVpbnQyNTYgbmV3UHJpY2UpOwogICAgCiAgICAvLy8gQGRldiBFdmVudCBmaXJlZCB3aGVuIGRpdmlkZW5kIGlzIHBhaWQgZm9yIGEgYnV5b3V0LgogICAgZXZlbnQgQnV5b3V0RGl2aWRlbmQoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiBkZWVkSWRGcm9tLCB1aW50MjU2IGluZGV4ZWQgZGVlZElkVG8sIHVpbnQyNTYgZGl2aWRlbmQpOwogICAgCiAgICAvLy8gQGRldiBFdmVudCBmaXJlZCB3aGVuIHRoZSBidXlvdXQgcHJpY2UgaXMgbWFudWFsbHkgY2hhbmdlZCBmb3IgYSBwbG90LgogICAgZXZlbnQgU2V0QnV5b3V0UHJpY2UodWludDI1NiBpbmRleGVkIGRlZWRJZCwgdWludDI1NiBuZXdQcmljZSk7CiAgICAKICAgIC8vLyBAZGV2IFRoZSB0aW1lIGFmdGVyIHdoaWNoIGJ1eW91dHMgd2lsbCBiZSBlbmFibGVkLiBTZXQgaW4gdGhlIERXb3JsZENvcmUgY29uc3RydWN0b3IuCiAgICB1aW50MjU2IHB1YmxpYyBidXlvdXRzRW5hYmxlZEZyb21UaW1lc3RhbXA7CiAgICAKICAgIC8vLyBAbm90aWNlIFNldHMgdGhlIG5ldyBwcmljZSBmb3IgdW5jbGFpbWVkIHBsb3RzLgogICAgLy8vIEBwYXJhbSBfdW5jbGFpbWVkUGxvdFByaWNlIFRoZSBuZXcgcHJpY2UgZm9yIHVuY2xhaW1lZCBwbG90cy4KICAgIGZ1bmN0aW9uIHNldFVuY2xhaW1lZFBsb3RQcmljZSh1aW50MjU2IF91bmNsYWltZWRQbG90UHJpY2UpIGV4dGVybmFsIG9ubHlDRk8gewogICAgICAgIHVuY2xhaW1lZFBsb3RQcmljZSA9IF91bmNsYWltZWRQbG90UHJpY2U7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFNldHMgdGhlIG5ldyBkaXZpZGVuZCBwZXJjZW50YWdlIGZvciB1bmNsYWltZWQgcGxvdHMuCiAgICAvLy8gQHBhcmFtIF9jbGFpbURpdmlkZW5kUGVyY2VudGFnZSBUaGUgbmV3IGRpdmlkZW5kIHBlcmNlbnRhZ2UgZm9yIHVuY2xhaW1lZCBwbG90cy4KICAgIGZ1bmN0aW9uIHNldENsYWltRGl2aWRlbmRQZXJjZW50YWdlKHVpbnQyNTYgX2NsYWltRGl2aWRlbmRQZXJjZW50YWdlKSBleHRlcm5hbCBvbmx5Q0ZPIHsKICAgICAgICAvLyBDbGFpbSBkaXZpZGVuZCBwZXJjZW50YWdlIG11c3QgYmUgMTAlIGF0IHRoZSBsZWFzdC4KICAgICAgICAvLyBDbGFpbSBkaXZpZGVuZCBwZXJjZW50YWdlIG1heSBiZSAxMDAlIGF0IHRoZSBtb3N0LgogICAgICAgIHJlcXVpcmUoMTAwMDAgPD0gX2NsYWltRGl2aWRlbmRQZXJjZW50YWdlICYmIF9jbGFpbURpdmlkZW5kUGVyY2VudGFnZSA8PSAxMDAwMDApOwogICAgICAgIAogICAgICAgIGNsYWltRGl2aWRlbmRQZXJjZW50YWdlID0gX2NsYWltRGl2aWRlbmRQZXJjZW50YWdlOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBTZXRzIHRoZSBuZXcgZGl2aWRlbmQgcGVyY2VudGFnZSBmb3IgYnV5b3V0cy4KICAgIC8vLyBAcGFyYW0gX2J1eW91dERpdmlkZW5kUGVyY2VudGFnZSBUaGUgbmV3IGRpdmlkZW5kIHBlcmNlbnRhZ2UgZm9yIGJ1eW91dHMuCiAgICBmdW5jdGlvbiBzZXRCdXlvdXREaXZpZGVuZFBlcmNlbnRhZ2UodWludDI1NiBfYnV5b3V0RGl2aWRlbmRQZXJjZW50YWdlKSBleHRlcm5hbCBvbmx5Q0ZPIHsKICAgICAgICAvLyBCdXlvdXQgZGl2aWRlbmQgbXVzdCBiZSAyJSBhdCB0aGUgbGVhc3QuCiAgICAgICAgLy8gQnV5b3V0IGRpdmlkZW5kIHBlcmNlbnRhZ2UgbWF5IGJlIDEyLjUlIGF0IHRoZSBtb3N0LgogICAgICAgIHJlcXVpcmUoMjAwMCA8PSBfYnV5b3V0RGl2aWRlbmRQZXJjZW50YWdlICYmIF9idXlvdXREaXZpZGVuZFBlcmNlbnRhZ2UgPD0gMTI1MDApOwogICAgICAgIAogICAgICAgIGJ1eW91dERpdmlkZW5kUGVyY2VudGFnZSA9IF9idXlvdXREaXZpZGVuZFBlcmNlbnRhZ2U7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFNldHMgdGhlIG5ldyBmZWUgcGVyY2VudGFnZSBmb3IgYnV5b3V0cy4KICAgIC8vLyBAcGFyYW0gX2J1eW91dEZlZVBlcmNlbnRhZ2UgVGhlIG5ldyBmZWUgcGVyY2VudGFnZSBmb3IgYnV5b3V0cy4KICAgIGZ1bmN0aW9uIHNldEJ1eW91dEZlZVBlcmNlbnRhZ2UodWludDI1NiBfYnV5b3V0RmVlUGVyY2VudGFnZSkgZXh0ZXJuYWwgb25seUNGTyB7CiAgICAgICAgLy8gQnV5b3V0IGZlZSBtYXkgYmUgNSUgYXQgdGhlIG1vc3QuCiAgICAgICAgcmVxdWlyZSgwIDw9IF9idXlvdXRGZWVQZXJjZW50YWdlICYmIF9idXlvdXRGZWVQZXJjZW50YWdlIDw9IDUwMDApOwogICAgICAgIAogICAgICAgIGJ1eW91dEZlZVBlcmNlbnRhZ2UgPSBfYnV5b3V0RmVlUGVyY2VudGFnZTsKICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgVGhlIGNsYWltIGRpdmlkZW5kIHRvIGJlIHBhaWQgZm9yIGVhY2ggYWRqYWNlbnQgcGxvdCwgYW5kCiAgICAvLy8gYXMgYSBmbGF0IGRpdmlkZW5kIGZvciBlYWNoIGJ1eW91dC4KICAgIGZ1bmN0aW9uIGNsYWltRGl2aWRlbmQoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHVuY2xhaW1lZFBsb3RQcmljZS5tdWwoY2xhaW1EaXZpZGVuZFBlcmNlbnRhZ2UpLmRpdigxMDAwMDApOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBTZXQgdGhlIGZyZWUgY2xhaW0gYWxsb3dhbmNlIGZvciBhbiBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBhZGRyIFRoZSBhZGRyZXNzIHRvIHNldCB0aGUgZnJlZSBjbGFpbSBhbGxvd2FuY2UgZm9yLgogICAgLy8vIEBwYXJhbSBhbGxvd2FuY2UgVGhlIGZyZWUgY2xhaW0gYWxsb3dhbmNlIHRvIHNldC4KICAgIGZ1bmN0aW9uIHNldEZyZWVDbGFpbUFsbG93YW5jZShhZGRyZXNzIGFkZHIsIHVpbnQyNTYgYWxsb3dhbmNlKSBleHRlcm5hbCBvbmx5Q0ZPIHsKICAgICAgICBmcmVlQ2xhaW1BbGxvd2FuY2VbYWRkcl0gPSBhbGxvd2FuY2U7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIEdldCB0aGUgZnJlZSBjbGFpbSBhbGxvd2FuY2Ugb2YgYW4gYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gYWRkciBUaGUgYWRkcmVzcyB0byBnZXQgdGhlIGZyZWUgY2xhaW0gYWxsb3dhbmNlIG9mLgogICAgZnVuY3Rpb24gZnJlZUNsYWltQWxsb3dhbmNlT2YoYWRkcmVzcyBhZGRyKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gZnJlZUNsYWltQWxsb3dhbmNlW2FkZHJdOwogICAgfQogICAgCiAgICAvLy8gQGRldiBBc3NpZ24gYmFsYW5jZSB0byBhbiBhY2NvdW50LgogICAgLy8vIEBwYXJhbSBhZGRyIFRoZSBhZGRyZXNzIHRvIGFzc2lnbiBiYWxhbmNlIHRvLgogICAgLy8vIEBwYXJhbSBhbW91bnQgVGhlIGFtb3VudCB0byBhc3NpZ24uCiAgICBmdW5jdGlvbiBfYXNzaWduQmFsYW5jZShhZGRyZXNzIGFkZHIsIHVpbnQyNTYgYW1vdW50KSBpbnRlcm5hbCB7CiAgICAgICAgYWRkcmVzc1RvRXRoZXJPd2VkW2FkZHJdID0gYWRkcmVzc1RvRXRoZXJPd2VkW2FkZHJdLmFkZChhbW91bnQpOwogICAgICAgIG91dHN0YW5kaW5nRXRoZXIgPSBvdXRzdGFuZGluZ0V0aGVyLmFkZChhbW91bnQpOwogICAgfQogICAgCiAgICAvLy8gQGRldiBGaW5kIHRoZSBfY2xhaW1lZF8gcGxvdHMgc3Vycm91bmRpbmcgYSBwbG90LgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBwbG90IHRvIGdldCB0aGUgc3Vycm91bmRpbmcgcGxvdHMgZm9yLgogICAgZnVuY3Rpb24gX2NsYWltZWRTdXJyb3VuZGluZ1Bsb3RzKHVpbnQyNTYgX2RlZWRJZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2W10gbWVtb3J5KSB7CiAgICAgICAgdmFyICh4LCB5KSA9IGlkZW50aWZpZXJUb0Nvb3JkaW5hdGUoX2RlZWRJZCk7CiAgICAgICAgCiAgICAgICAgLy8gRmluZCBhbGwgY2xhaW1lZCBzdXJyb3VuZGluZyBwbG90cy4KICAgICAgICB1aW50MjU2IGNsYWltZWQgPSAwOwogICAgICAgIAogICAgICAgIC8vIENyZWF0ZSBtZW1vcnkgYnVmZmVyIGNhcGFibGUgb2YgaG9sZGluZyBhbGwgcGxvdHMuCiAgICAgICAgdWludDI1NltdIG1lbW9yeSBfcGxvdHMgPSBuZXcgdWludDI1NltdKDgpOwogICAgICAgIAogICAgICAgIC8vIExvb3AgdGhyb3VnaCBhbGwgbmVpZ2hib3JzLgogICAgICAgIGZvciAoaW50MjU2IGR4ID0gLTE7IGR4IDw9IDE7IGR4KyspIHsKICAgICAgICAgICAgZm9yIChpbnQyNTYgZHkgPSAtMTsgZHkgPD0gMTsgZHkrKykgewogICAgICAgICAgICAgICAgaWYgKGR4ID09IDAgJiYgZHkgPT0gMCkgewogICAgICAgICAgICAgICAgICAgIC8vIFNraXAgdGhlIGNlbnRlciAoaS5lLiwgdGhlIHBsb3QgaXRzZWxmKS4KICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gR2V0IHRoZSBjb29yZGluYXRlcyBvZiB0aGlzIG5laWdoYm9yaW5nIGlkZW50aWZpZXIuCiAgICAgICAgICAgICAgICB1aW50MjU2IG5laWdoYm9ySWRlbnRpZmllciA9IGNvb3JkaW5hdGVUb0lkZW50aWZpZXIoCiAgICAgICAgICAgICAgICAgICAgdWludDI1NihpbnQyNTYoeCkgKyBkeCkgJSA2NTUzNiwKICAgICAgICAgICAgICAgICAgICB1aW50MjU2KGludDI1Nih5KSArIGR5KSAlIDY1NTM2CiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoaWRlbnRpZmllclRvT3duZXJbbmVpZ2hib3JJZGVudGlmaWVyXSAhPSAweDApIHsKICAgICAgICAgICAgICAgICAgICBfcGxvdHNbY2xhaW1lZF0gPSBuZWlnaGJvcklkZW50aWZpZXI7CiAgICAgICAgICAgICAgICAgICAgY2xhaW1lZCsrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIE1lbW9yeSBhcnJheXMgY2Fubm90IGJlIHJlc2l6ZWQsIHNvIGNvcHkgYWxsCiAgICAgICAgLy8gcGxvdHMgZnJvbSB0aGUgYnVmZmVyIHRvIHRoZSBwbG90IGFycmF5LgogICAgICAgIHVpbnQyNTZbXSBtZW1vcnkgcGxvdHMgPSBuZXcgdWludDI1NltdKGNsYWltZWQpOwogICAgICAgIAogICAgICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IGNsYWltZWQ7IGkrKykgewogICAgICAgICAgICBwbG90c1tpXSA9IF9wbG90c1tpXTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJuIHBsb3RzOwogICAgfQogICAgCiAgICAvLy8gQGRldiBBc3NpZ24gY2xhaW0gZGl2aWRlbmQgdG8gYW4gYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3Mgd2hvIHBhaWQgdGhlIGRpdmlkZW5kLgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGRpdmlkZW5kIGJlbmVmaWNpYXJ5LgogICAgLy8vIEBwYXJhbSBfZGVlZElkRnJvbSBUaGUgaWRlbnRpZmllciBvZiB0aGUgZGVlZCB0aGUgZGl2aWRlbmQgaXMgYmVpbmcgcGFpZCBmb3IuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWRUbyBUaGUgaWRlbnRpZmllciBvZiB0aGUgZGVlZCB0aGUgZGl2aWRlbmQgaXMgYmVpbmcgcGFpZCB0by4KICAgIGZ1bmN0aW9uIF9hc3NpZ25DbGFpbURpdmlkZW5kKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF9kZWVkSWRGcm9tLCB1aW50MjU2IF9kZWVkSWRUbykgaW50ZXJuYWwgewogICAgICAgIHVpbnQyNTYgX2NsYWltRGl2aWRlbmQgPSBjbGFpbURpdmlkZW5kKCk7CiAgICAgICAgCiAgICAgICAgLy8gVHJpZ2dlciBldmVudC4KICAgICAgICBDbGFpbURpdmlkZW5kKF9mcm9tLCBfdG8sIF9kZWVkSWRGcm9tLCBfZGVlZElkVG8sIF9jbGFpbURpdmlkZW5kKTsKICAgICAgICAKICAgICAgICAvLyBBc3NpZ24gdGhlIGRpdmlkZW5kLgogICAgICAgIF9hc3NpZ25CYWxhbmNlKF90bywgX2NsYWltRGl2aWRlbmQpOwogICAgfQoKICAgIC8vLyBAZGV2IENhbGN1bGF0ZSBhbmQgYXNzaWduIHRoZSBkaXZpZGVuZCBwYXlhYmxlIGZvciB0aGUgbmV3IHBsb3QgY2xhaW0uCiAgICAvLy8gQSBuZXcgY2xhaW0gcGF5cyBkaXZpZGVuZHMgdG8gYWxsIGV4aXN0aW5nIHN1cnJvdW5kaW5nIHBsb3RzLgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBuZXcgcGxvdCB0byBjYWxjdWxhdGUgYW5kIGFzc2lnbiBkaXZpZGVuZHMgZm9yLgogICAgLy8vIEFzc3VtZWQgdG8gYmUgdmFsaWQuCiAgICBmdW5jdGlvbiBfY2FsY3VsYXRlQW5kQXNzaWduQ2xhaW1EaXZpZGVuZHModWludDI1NiBfZGVlZElkKQogICAgICAgIGludGVybmFsCiAgICAgICAgcmV0dXJucyAodWludDI1NiB0b3RhbENsYWltRGl2aWRlbmQpCiAgICB7CiAgICAgICAgLy8gR2V0IGV4aXN0aW5nIHN1cnJvdW5kaW5nIHBsb3RzLgogICAgICAgIHVpbnQyNTZbXSBtZW1vcnkgY2xhaW1lZFN1cnJvdW5kaW5nUGxvdHMgPSBfY2xhaW1lZFN1cnJvdW5kaW5nUGxvdHMoX2RlZWRJZCk7CiAgICAgICAgCiAgICAgICAgLy8gS2VlcCB0cmFjayBvZiB0aGUgY2xhaW0gZGl2aWRlbmQuCiAgICAgICAgdWludDI1NiBfY2xhaW1EaXZpZGVuZCA9IGNsYWltRGl2aWRlbmQoKTsKICAgICAgICB0b3RhbENsYWltRGl2aWRlbmQgPSAwOwogICAgICAgIAogICAgICAgIC8vIEFzc2lnbiBjbGFpbSBkaXZpZGVuZC4KICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBjbGFpbWVkU3Vycm91bmRpbmdQbG90cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoaWRlbnRpZmllclRvT3duZXJbY2xhaW1lZFN1cnJvdW5kaW5nUGxvdHNbaV1dICE9IG1zZy5zZW5kZXIpIHsKICAgICAgICAgICAgICAgIHRvdGFsQ2xhaW1EaXZpZGVuZCA9IHRvdGFsQ2xhaW1EaXZpZGVuZC5hZGQoX2NsYWltRGl2aWRlbmQpOwogICAgICAgICAgICAgICAgX2Fzc2lnbkNsYWltRGl2aWRlbmQobXNnLnNlbmRlciwgaWRlbnRpZmllclRvT3duZXJbY2xhaW1lZFN1cnJvdW5kaW5nUGxvdHNbaV1dLCBfZGVlZElkLCBjbGFpbWVkU3Vycm91bmRpbmdQbG90c1tpXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IENhbGN1bGF0ZSB0aGUgbmV4dCBidXlvdXQgcHJpY2UgZ2l2ZW4gdGhlIGN1cnJlbnQgdG90YWwgYnV5b3V0IGNvc3QuCiAgICAvLy8gQHBhcmFtIHRvdGFsQ29zdCBUaGUgY3VycmVudCB0b3RhbCBidXlvdXQgY29zdC4KICAgIGZ1bmN0aW9uIG5leHRCdXlvdXRQcmljZSh1aW50MjU2IHRvdGFsQ29zdCkgcHVibGljIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIGlmICh0b3RhbENvc3QgPCAwLjA1IGV0aGVyKSB7CiAgICAgICAgICAgIHJldHVybiB0b3RhbENvc3QgKiAyOwogICAgICAgIH0gZWxzZSBpZiAodG90YWxDb3N0IDwgMC4yIGV0aGVyKSB7CiAgICAgICAgICAgIHJldHVybiB0b3RhbENvc3QgKiAxNzAgLyAxMDA7IC8vICogMS43CiAgICAgICAgfSBlbHNlIGlmICh0b3RhbENvc3QgPCAwLjUgZXRoZXIpIHsKICAgICAgICAgICAgcmV0dXJuIHRvdGFsQ29zdCAqIDE1MCAvIDEwMDsgLy8gKiAxLjUKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gdG90YWxDb3N0Lm11bCgxMjUpLmRpdigxMDApOyAvLyAqIDEuMjUKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIEdldCB0aGUgYnV5b3V0IGNvc3QgZm9yIGEgZ2l2ZW4gcGxvdC4KICAgIC8vLyBAcGFyYW0gX2RlZWRJZCBUaGUgaWRlbnRpZmllciBvZiB0aGUgcGxvdCB0byBnZXQgdGhlIGJ1eW91dCBjb3N0IGZvci4KICAgIGZ1bmN0aW9uIGJ1eW91dENvc3QodWludDI1NiBfZGVlZElkKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICAvLyBUaGUgY3VycmVudCBidXlvdXQgcHJpY2UuCiAgICAgICAgdWludDI1NiBwcmljZSA9IGlkZW50aWZpZXJUb0J1eW91dFByaWNlW19kZWVkSWRdOwogICAgCiAgICAgICAgLy8gR2V0IGV4aXN0aW5nIHN1cnJvdW5kaW5nIHBsb3RzLgogICAgICAgIHVpbnQyNTZbXSBtZW1vcnkgY2xhaW1lZFN1cnJvdW5kaW5nUGxvdHMgPSBfY2xhaW1lZFN1cnJvdW5kaW5nUGxvdHMoX2RlZWRJZCk7CiAgICAKICAgICAgICAvLyBUaGUgdG90YWwgY29zdCBpcyB0aGUgcHJpY2UgcGx1cyBmbGF0IHJhdGUgZGl2aWRlbmRzIGJhc2VkIG9uIGNsYWltIGRpdmlkZW5kcy4KICAgICAgICB1aW50MjU2IGZsYXREaXZpZGVuZHMgPSBjbGFpbURpdmlkZW5kKCkubXVsKGNsYWltZWRTdXJyb3VuZGluZ1Bsb3RzLmxlbmd0aCk7CiAgICAgICAgcmV0dXJuIHByaWNlLmFkZChmbGF0RGl2aWRlbmRzKTsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgQXNzaWduIHRoZSBwcm9jZWVkcyBvZiB0aGUgYnV5b3V0LgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBwbG90IHRoYXQgaXMgYmVpbmcgYm91Z2h0IG91dC4KICAgIGZ1bmN0aW9uIF9hc3NpZ25CdXlvdXRQcm9jZWVkcygKICAgICAgICBhZGRyZXNzIGN1cnJlbnRPd25lciwKICAgICAgICB1aW50MjU2IF9kZWVkSWQsCiAgICAgICAgdWludDI1NltdIG1lbW9yeSBjbGFpbWVkU3Vycm91bmRpbmdQbG90cywKICAgICAgICB1aW50MjU2IGN1cnJlbnRPd25lcldpbm5pbmdzLAogICAgICAgIHVpbnQyNTYgdG90YWxEaXZpZGVuZFBlckJlbmVmaWNpYXJ5LAogICAgICAgIHVpbnQyNTYgdG90YWxDb3N0CiAgICApCiAgICAgICAgaW50ZXJuYWwKICAgIHsKICAgICAgICAvLyBDYWxjdWxhdGUgYW5kIGFzc2lnbiB0aGUgY3VycmVudCBvd25lcidzIHdpbm5pbmdzLgogICAgICAgIAogICAgICAgIEJ1eW91dChtc2cuc2VuZGVyLCBjdXJyZW50T3duZXIsIF9kZWVkSWQsIGN1cnJlbnRPd25lcldpbm5pbmdzLCB0b3RhbENvc3QsIG5leHRCdXlvdXRQcmljZSh0b3RhbENvc3QpKTsKICAgICAgICBfYXNzaWduQmFsYW5jZShjdXJyZW50T3duZXIsIGN1cnJlbnRPd25lcldpbm5pbmdzKTsKICAgICAgICAKICAgICAgICAvLyBBc3NpZ24gZGl2aWRlbmRzIHRvIG93bmVycyBvZiBzdXJyb3VuZGluZyBwbG90cy4KICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBjbGFpbWVkU3Vycm91bmRpbmdQbG90cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBhZGRyZXNzIGJlbmVmaWNpYXJ5ID0gaWRlbnRpZmllclRvT3duZXJbY2xhaW1lZFN1cnJvdW5kaW5nUGxvdHNbaV1dOwogICAgICAgICAgICBCdXlvdXREaXZpZGVuZChtc2cuc2VuZGVyLCBiZW5lZmljaWFyeSwgX2RlZWRJZCwgY2xhaW1lZFN1cnJvdW5kaW5nUGxvdHNbaV0sIHRvdGFsRGl2aWRlbmRQZXJCZW5lZmljaWFyeSk7CiAgICAgICAgICAgIF9hc3NpZ25CYWxhbmNlKGJlbmVmaWNpYXJ5LCB0b3RhbERpdmlkZW5kUGVyQmVuZWZpY2lhcnkpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8vIEBkZXYgQ2FsY3VsYXRlIGFuZCBhc3NpZ24gdGhlIHByb2NlZWRzIGZyb20gdGhlIGJ1eW91dC4KICAgIC8vLyBAcGFyYW0gY3VycmVudE93bmVyIFRoZSBjdXJyZW50IG93bmVyIG9mIHRoZSBwbG90IHRoYXQgaXMgYmVpbmcgYm91Z2h0IG91dC4KICAgIC8vLyBAcGFyYW0gX2RlZWRJZCBUaGUgaWRlbnRpZmllciBvZiB0aGUgcGxvdCB0aGF0IGlzIGJlaW5nIGJvdWdodCBvdXQuCiAgICAvLy8gQHBhcmFtIGNsYWltZWRTdXJyb3VuZGluZ1Bsb3RzIFRoZSBzdXJyb3VuZGluZyBwbG90cyB0aGF0IGhhdmUgYmVlbiBjbGFpbWVkLgogICAgZnVuY3Rpb24gX2NhbGN1bGF0ZUFuZEFzc2lnbkJ1eW91dFByb2NlZWRzKGFkZHJlc3MgY3VycmVudE93bmVyLCB1aW50MjU2IF9kZWVkSWQsIHVpbnQyNTZbXSBtZW1vcnkgY2xhaW1lZFN1cnJvdW5kaW5nUGxvdHMpCiAgICAgICAgaW50ZXJuYWwgCiAgICAgICAgcmV0dXJucyAodWludDI1NiB0b3RhbENvc3QpCiAgICB7CiAgICAgICAgLy8gVGhlIGN1cnJlbnQgcHJpY2UuCiAgICAgICAgdWludDI1NiBwcmljZSA9IGlkZW50aWZpZXJUb0J1eW91dFByaWNlW19kZWVkSWRdOwogICAgCiAgICAgICAgLy8gVGhlIHRvdGFsIGNvc3QgaXMgdGhlIHByaWNlIHBsdXMgZmxhdCByYXRlIGRpdmlkZW5kcyBiYXNlZCBvbiBjbGFpbSBkaXZpZGVuZHMuCiAgICAgICAgdWludDI1NiBmbGF0RGl2aWRlbmRzID0gY2xhaW1EaXZpZGVuZCgpLm11bChjbGFpbWVkU3Vycm91bmRpbmdQbG90cy5sZW5ndGgpOwogICAgICAgIHRvdGFsQ29zdCA9IHByaWNlLmFkZChmbGF0RGl2aWRlbmRzKTsKICAgICAgICAKICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIHZhcmlhYmxlIGRpdmlkZW5kcyBiYXNlZCBvbiB0aGUgYnV5b3V0IHByaWNlCiAgICAgICAgLy8gKG9ubHkgdG8gYmUgcGFpZCBpZiB0aGVyZSBhcmUgc3Vycm91bmRpbmcgcGxvdHMpLgogICAgICAgIHVpbnQyNTYgdmFyaWFibGVEaXZpZGVuZHMgPSBwcmljZS5tdWwoYnV5b3V0RGl2aWRlbmRQZXJjZW50YWdlKS5kaXYoMTAwMDAwKTsKICAgICAgICAKICAgICAgICAvLyBDYWxjdWxhdGUgZmVlcy4KICAgICAgICB1aW50MjU2IGZlZSA9IHByaWNlLm11bChidXlvdXRGZWVQZXJjZW50YWdlKS5kaXYoMTAwMDAwKTsKICAgICAgICAKICAgICAgICAvLyBDYWxjdWxhdGUgYW5kIGFzc2lnbiBidXlvdXQgcHJvY2VlZHMuCiAgICAgICAgdWludDI1NiBjdXJyZW50T3duZXJXaW5uaW5ncyA9IHByaWNlLnN1YihmZWUpOwogICAgICAgIAogICAgICAgIHVpbnQyNTYgdG90YWxEaXZpZGVuZFBlckJlbmVmaWNpYXJ5OwogICAgICAgIGlmIChjbGFpbWVkU3Vycm91bmRpbmdQbG90cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIC8vIElmIHRoZXJlIGFyZSBzdXJyb3VuZGluZyBwbG90cywgdmFyaWFibGUgZGl2aWRlbmQgaXMgdG8gYmUgcGFpZAogICAgICAgICAgICAvLyBiYXNlZCBvbiB0aGUgYnV5b3V0IHByaWNlLi4KICAgICAgICAgICAgY3VycmVudE93bmVyV2lubmluZ3MgPSBjdXJyZW50T3duZXJXaW5uaW5ncy5zdWIodmFyaWFibGVEaXZpZGVuZHMpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSBkaXZpZGVuZCBwZXIgc3Vycm91bmRpbmcgcGxvdC4KICAgICAgICAgICAgdG90YWxEaXZpZGVuZFBlckJlbmVmaWNpYXJ5ID0gZmxhdERpdmlkZW5kcy5hZGQodmFyaWFibGVEaXZpZGVuZHMpIC8gY2xhaW1lZFN1cnJvdW5kaW5nUGxvdHMubGVuZ3RoOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBfYXNzaWduQnV5b3V0UHJvY2VlZHMoCiAgICAgICAgICAgIGN1cnJlbnRPd25lciwKICAgICAgICAgICAgX2RlZWRJZCwKICAgICAgICAgICAgY2xhaW1lZFN1cnJvdW5kaW5nUGxvdHMsCiAgICAgICAgICAgIGN1cnJlbnRPd25lcldpbm5pbmdzLAogICAgICAgICAgICB0b3RhbERpdmlkZW5kUGVyQmVuZWZpY2lhcnksCiAgICAgICAgICAgIHRvdGFsQ29zdAogICAgICAgICk7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIEJ1eSB0aGUgY3VycmVudCBvd25lciBvdXQgb2YgdGhlIHBsb3QuCiAgICBmdW5jdGlvbiBidXlvdXQodWludDI1NiBfZGVlZElkKSBleHRlcm5hbCBwYXlhYmxlIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIGJ1eW91dFdpdGhEYXRhKF9kZWVkSWQsICIiLCAiIiwgIiIsICIiKTsKICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgQnV5IHRoZSBjdXJyZW50IG93bmVyIG91dCBvZiB0aGUgcGxvdC4KICAgIGZ1bmN0aW9uIGJ1eW91dFdpdGhEYXRhKHVpbnQyNTYgX2RlZWRJZCwgc3RyaW5nIG5hbWUsIHN0cmluZyBkZXNjcmlwdGlvbiwgc3RyaW5nIGltYWdlVXJsLCBzdHJpbmcgaW5mb1VybCkKICAgICAgICBwdWJsaWMKICAgICAgICBwYXlhYmxlCiAgICAgICAgd2hlbk5vdFBhdXNlZCAKICAgIHsKICAgICAgICAvLyBCdXlvdXRzIG11c3QgYmUgZW5hYmxlZC4KICAgICAgICByZXF1aXJlKGJ1eW91dHNFbmFibGVkRnJvbVRpbWVzdGFtcCA8PSBibG9jay50aW1lc3RhbXApOwogICAgCiAgICAgICAgYWRkcmVzcyBjdXJyZW50T3duZXIgPSBpZGVudGlmaWVyVG9Pd25lcltfZGVlZElkXTsKICAgIAogICAgICAgIC8vIFRoZSBwbG90IG11c3QgYmUgb3duZWQgYmVmb3JlIGl0IGNhbiBiZSBib3VnaHQgb3V0LgogICAgICAgIHJlcXVpcmUoY3VycmVudE93bmVyICE9IDB4MCk7CiAgICAgICAgCiAgICAgICAgLy8gR2V0IGV4aXN0aW5nIHN1cnJvdW5kaW5nIHBsb3RzLgogICAgICAgIHVpbnQyNTZbXSBtZW1vcnkgY2xhaW1lZFN1cnJvdW5kaW5nUGxvdHMgPSBfY2xhaW1lZFN1cnJvdW5kaW5nUGxvdHMoX2RlZWRJZCk7CiAgICAgICAgCiAgICAgICAgLy8gQXNzaWduIHRoZSBidXlvdXQgcHJvY2VlZHMgYW5kIHJldHJpZXZlIHRoZSB0b3RhbCBjb3N0LgogICAgICAgIHVpbnQyNTYgdG90YWxDb3N0ID0gX2NhbGN1bGF0ZUFuZEFzc2lnbkJ1eW91dFByb2NlZWRzKGN1cnJlbnRPd25lciwgX2RlZWRJZCwgY2xhaW1lZFN1cnJvdW5kaW5nUGxvdHMpOwogICAgICAgIAogICAgICAgIC8vIEVuc3VyZSB0aGUgbWVzc2FnZSBoYXMgZW5vdWdoIHZhbHVlLgogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID49IHRvdGFsQ29zdCk7CiAgICAgICAgCiAgICAgICAgLy8gVHJhbnNmZXIgdGhlIHBsb3QuCiAgICAgICAgX3RyYW5zZmVyKGN1cnJlbnRPd25lciwgbXNnLnNlbmRlciwgX2RlZWRJZCk7CiAgICAgICAgCiAgICAgICAgLy8gU2V0IHRoZSBwbG90IGRhdGEKICAgICAgICBTZXREYXRhKF9kZWVkSWQsIG5hbWUsIGRlc2NyaXB0aW9uLCBpbWFnZVVybCwgaW5mb1VybCk7CiAgICAgICAgCiAgICAgICAgLy8gQ2FsY3VsYXRlIGFuZCBzZXQgdGhlIG5ldyBwbG90IHByaWNlLgogICAgICAgIGlkZW50aWZpZXJUb0J1eW91dFByaWNlW19kZWVkSWRdID0gbmV4dEJ1eW91dFByaWNlKHRvdGFsQ29zdCk7CiAgICAgICAgCiAgICAgICAgLy8gSW5kaWNhdGUgdGhlIHBsb3QgaGFzIGJlZW4gYm91Z2h0IG91dCBhdCBsZWFzdCBvbmNlCiAgICAgICAgaWYgKCFpZGVudGlmaWVyVG9Cb3VnaHRPdXRPbmNlW19kZWVkSWRdKSB7CiAgICAgICAgICAgIGlkZW50aWZpZXJUb0JvdWdodE91dE9uY2VbX2RlZWRJZF0gPSB0cnVlOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIGV4Y2VzcyBFdGhlciBzZW50LgogICAgICAgIC8vIG1zZy52YWx1ZSBpcyBncmVhdGVyIHRoYW4gb3IgZXF1YWwgdG8gdG90YWxDb3N0LAogICAgICAgIC8vIHNvIHRoaXMgY2Fubm90IHVuZGVyZmxvdy4KICAgICAgICB1aW50MjU2IGV4Y2VzcyA9IG1zZy52YWx1ZSAtIHRvdGFsQ29zdDsKICAgICAgICAKICAgICAgICBpZiAoZXhjZXNzID4gMCkgewogICAgICAgICAgICAvLyBSZWZ1bmQgYW55IGV4Y2VzcyBFdGhlciAobm90IHN1c2NlcHRpYmxlIHRvIHJlLWVudHJ5IGF0dGFjaywgYXMKICAgICAgICAgICAgLy8gdGhlIG93bmVyIGlzIGFzc2lnbmVkIGJlZm9yZSB0aGUgdHJhbnNmZXIgdGFrZXMgcGxhY2UpLgogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGV4Y2Vzcyk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBDYWxjdWxhdGUgdGhlIG1heGltdW0gaW5pdGlhbCBidXlvdXQgcHJpY2UgZm9yIGEgcGxvdC4KICAgIC8vLyBAcGFyYW0gX2RlZWRJZCBUaGUgaWRlbnRpZmllciBvZiB0aGUgcGxvdCB0byBnZXQgdGhlIG1heGltdW0gaW5pdGlhbCBidXlvdXQgcHJpY2UgZm9yLgogICAgZnVuY3Rpb24gbWF4aW11bUluaXRpYWxCdXlvdXRQcmljZSh1aW50MjU2IF9kZWVkSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICAvLyBUaGUgaW5pdGlhbCBidXlvdXQgcHJpY2UgY2FuIGJlIHNldCB0byA0eCB0aGUgaW5pdGlhbCBwbG90IHByaWNlCiAgICAgICAgLy8gKG9yIDEwMHggZm9yIHRoZSBvcmlnaW5hbCBwcmUtbWlncmF0aW9uIHBsb3RzKS4KICAgICAgICB1aW50MjU2IG11bCA9IDQ7CiAgICAgICAgCiAgICAgICAgaWYgKGlkZW50aWZpZXJJc09yaWdpbmFsW19kZWVkSWRdKSB7CiAgICAgICAgICAgIG11bCA9IDEwMDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJuIGluaXRpYWxQcmljZVBhaWRbX2RlZWRJZF0ubXVsKG11bCk7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFRlc3Qgd2hldGhlciBhIGJ1eW91dCBwcmljZSBpcyB2YWxpZC4KICAgIC8vLyBAcGFyYW0gX2RlZWRJZCBUaGUgaWRlbnRpZmllciBvZiB0aGUgcGxvdCB0byB0ZXN0IHRoZSBidXlvdXQgcHJpY2UgZm9yLgogICAgLy8vIEBwYXJhbSBwcmljZSBUaGUgYnV5b3V0IHByaWNlIHRvIHRlc3QuCiAgICBmdW5jdGlvbiB2YWxpZEluaXRpYWxCdXlvdXRQcmljZSh1aW50MjU2IF9kZWVkSWQsIHVpbnQyNTYgcHJpY2UpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsgICAgICAgIAogICAgICAgIHJldHVybiAocHJpY2UgPj0gdW5jbGFpbWVkUGxvdFByaWNlICYmIHByaWNlIDw9IG1heGltdW1Jbml0aWFsQnV5b3V0UHJpY2UoX2RlZWRJZCkpOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBNYW51YWxseSBzZXQgdGhlIGluaXRpYWwgYnV5b3V0IHByaWNlIG9mIGEgcGxvdC4KICAgIC8vLyBAcGFyYW0gX2RlZWRJZCBUaGUgaWRlbnRpZmllciBvZiB0aGUgcGxvdCB0byBzZXQgdGhlIGJ1eW91dCBwcmljZSBmb3IuCiAgICAvLy8gQHBhcmFtIHByaWNlIFRoZSB2YWx1ZSB0byBzZXQgdGhlIGJ1eW91dCBwcmljZSB0by4KICAgIGZ1bmN0aW9uIHNldEluaXRpYWxCdXlvdXRQcmljZSh1aW50MjU2IF9kZWVkSWQsIHVpbnQyNTYgcHJpY2UpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHsKICAgICAgICAvLyBPbmUgY2FuIG9ubHkgc2V0IHRoZSBidXlvdXQgcHJpY2Ugb2YgdGhlaXIgb3duIHBsb3RzLgogICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX2RlZWRJZCkpOwogICAgICAgIAogICAgICAgIC8vIFRoZSBpbml0aWFsIGJ1eW91dCBwcmljZSBjYW4gb25seSBiZSBzZXQgaWYgdGhlIHBsb3QgaGFzIG5ldmVyIGJlZW4gYm91Z2h0IG91dCBiZWZvcmUuCiAgICAgICAgcmVxdWlyZSghaWRlbnRpZmllclRvQm91Z2h0T3V0T25jZVtfZGVlZElkXSk7CiAgICAgICAgCiAgICAgICAgLy8gVGhlIGJ1eW91dCBwcmljZSBtdXN0IGJlIHZhbGlkLgogICAgICAgIHJlcXVpcmUodmFsaWRJbml0aWFsQnV5b3V0UHJpY2UoX2RlZWRJZCwgcHJpY2UpKTsKICAgICAgICAKICAgICAgICAvLyBTZXQgdGhlIGJ1eW91dCBwcmljZS4KICAgICAgICBpZGVudGlmaWVyVG9CdXlvdXRQcmljZVtfZGVlZElkXSA9IHByaWNlOwogICAgICAgIAogICAgICAgIC8vIFRyaWdnZXIgdGhlIGJ1eW91dCBwcmljZSBldmVudC4KICAgICAgICBTZXRCdXlvdXRQcmljZShfZGVlZElkLCBwcmljZSk7CiAgICB9Cn0KCgovLy8gQGRldiBIb2xkcyBmdW5jdGlvbmFsaXR5IGZvciBtaW50aW5nIG5ldyBwbG90IGRlZWRzLgpjb250cmFjdCBEV29ybGRNaW50aW5nIGlzIERXb3JsZEZpbmFuY2UgeyAgICAgICAKICAgIC8vLyBAbm90aWNlIEJ1eSBhbiB1bmNsYWltZWQgcGxvdC4KICAgIC8vLyBAcGFyYW0gX2RlZWRJZCBUaGUgdW5jbGFpbWVkIHBsb3QgdG8gYnV5LgogICAgLy8vIEBwYXJhbSBfYnV5b3V0UHJpY2UgVGhlIGluaXRpYWwgYnV5b3V0IHByaWNlIHRvIHNldCBvbiB0aGUgcGxvdC4KICAgIGZ1bmN0aW9uIGNsYWltUGxvdCh1aW50MjU2IF9kZWVkSWQsIHVpbnQyNTYgX2J1eW91dFByaWNlKSBleHRlcm5hbCBwYXlhYmxlIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIGNsYWltUGxvdFdpdGhEYXRhKF9kZWVkSWQsIF9idXlvdXRQcmljZSwgIiIsICIiLCAiIiwgIiIpOwogICAgfQogICAgICAgCiAgICAvLy8gQG5vdGljZSBCdXkgYW4gdW5jbGFpbWVkIHBsb3QuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWQgVGhlIHVuY2xhaW1lZCBwbG90IHRvIGJ1eS4KICAgIC8vLyBAcGFyYW0gX2J1eW91dFByaWNlIFRoZSBpbml0aWFsIGJ1eW91dCBwcmljZSB0byBzZXQgb24gdGhlIHBsb3QuCiAgICAvLy8gQHBhcmFtIG5hbWUgVGhlIG5hbWUgdG8gZ2l2ZSB0aGUgcGxvdC4KICAgIC8vLyBAcGFyYW0gZGVzY3JpcHRpb24gVGhlIGRlc2NyaXB0aW9uIHRvIGFkZCB0byB0aGUgcGxvdC4KICAgIC8vLyBAcGFyYW0gaW1hZ2VVcmwgVGhlIGltYWdlIHVybCBmb3IgdGhlIHBsb3QuCiAgICAvLy8gQHBhcmFtIGluZm9VcmwgVGhlIGluZm8gdXJsIGZvciB0aGUgcGxvdC4KICAgIGZ1bmN0aW9uIGNsYWltUGxvdFdpdGhEYXRhKHVpbnQyNTYgX2RlZWRJZCwgdWludDI1NiBfYnV5b3V0UHJpY2UsIHN0cmluZyBuYW1lLCBzdHJpbmcgZGVzY3JpcHRpb24sIHN0cmluZyBpbWFnZVVybCwgc3RyaW5nIGluZm9VcmwpIHB1YmxpYyBwYXlhYmxlIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIHVpbnQyNTZbXSBtZW1vcnkgX2RlZWRJZHMgPSBuZXcgdWludDI1NltdKDEpOwogICAgICAgIF9kZWVkSWRzWzBdID0gX2RlZWRJZDsKICAgICAgICAKICAgICAgICBjbGFpbVBsb3RNdWx0aXBsZVdpdGhEYXRhKF9kZWVkSWRzLCBfYnV5b3V0UHJpY2UsIG5hbWUsIGRlc2NyaXB0aW9uLCBpbWFnZVVybCwgaW5mb1VybCk7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIEJ1eSB1bmNsYWltZWQgcGxvdHMuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWRzIFRoZSB1bmNsYWltZWQgcGxvdHMgdG8gYnV5LgogICAgLy8vIEBwYXJhbSBfYnV5b3V0UHJpY2UgVGhlIGluaXRpYWwgYnV5b3V0IHByaWNlIHRvIHNldCBvbiB0aGUgcGxvdC4KICAgIGZ1bmN0aW9uIGNsYWltUGxvdE11bHRpcGxlKHVpbnQyNTZbXSBfZGVlZElkcywgdWludDI1NiBfYnV5b3V0UHJpY2UpIGV4dGVybmFsIHBheWFibGUgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgY2xhaW1QbG90TXVsdGlwbGVXaXRoRGF0YShfZGVlZElkcywgX2J1eW91dFByaWNlLCAiIiwgIiIsICIiLCAiIik7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIEJ1eSB1bmNsYWltZWQgcGxvdHMuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWRzIFRoZSB1bmNsYWltZWQgcGxvdHMgdG8gYnV5LgogICAgLy8vIEBwYXJhbSBfYnV5b3V0UHJpY2UgVGhlIGluaXRpYWwgYnV5b3V0IHByaWNlIHRvIHNldCBvbiB0aGUgcGxvdC4KICAgIC8vLyBAcGFyYW0gbmFtZSBUaGUgbmFtZSB0byBnaXZlIHRoZSBwbG90cy4KICAgIC8vLyBAcGFyYW0gZGVzY3JpcHRpb24gVGhlIGRlc2NyaXB0aW9uIHRvIGFkZCB0byB0aGUgcGxvdHMuCiAgICAvLy8gQHBhcmFtIGltYWdlVXJsIFRoZSBpbWFnZSB1cmwgZm9yIHRoZSBwbG90cy4KICAgIC8vLyBAcGFyYW0gaW5mb1VybCBUaGUgaW5mbyB1cmwgZm9yIHRoZSBwbG90cy4KICAgIGZ1bmN0aW9uIGNsYWltUGxvdE11bHRpcGxlV2l0aERhdGEodWludDI1NltdIF9kZWVkSWRzLCB1aW50MjU2IF9idXlvdXRQcmljZSwgc3RyaW5nIG5hbWUsIHN0cmluZyBkZXNjcmlwdGlvbiwgc3RyaW5nIGltYWdlVXJsLCBzdHJpbmcgaW5mb1VybCkgcHVibGljIHBheWFibGUgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgdWludDI1NiBidXlBbW91bnQgPSBfZGVlZElkcy5sZW5ndGg7CiAgICAgICAgdWludDI1NiBldGhlclJlcXVpcmVkOwogICAgICAgIGlmIChmcmVlQ2xhaW1BbGxvd2FuY2VbbXNnLnNlbmRlcl0gPiAwKSB7CiAgICAgICAgICAgIC8vIFRoZSBzZW5kZXIgaGFzIGEgZnJlZSBjbGFpbSBhbGxvd2FuY2UuCiAgICAgICAgICAgIGlmIChmcmVlQ2xhaW1BbGxvd2FuY2VbbXNnLnNlbmRlcl0gPiBidXlBbW91bnQpIHsKICAgICAgICAgICAgICAgIC8vIFN1YnRyYWN0IGZyb20gYWxsb3dhbmNlLgogICAgICAgICAgICAgICAgZnJlZUNsYWltQWxsb3dhbmNlW21zZy5zZW5kZXJdIC09IGJ1eUFtb3VudDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gTm8gZXRoZXIgaXMgcmVxdWlyZWQuCiAgICAgICAgICAgICAgICBldGhlclJlcXVpcmVkID0gMDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHVpbnQyNTYgZnJlZUFtb3VudCA9IGZyZWVDbGFpbUFsbG93YW5jZVttc2cuc2VuZGVyXTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gVGhlIGZ1bGwgYWxsb3dhbmNlIGhhcyBiZWVuIHVzZWQuCiAgICAgICAgICAgICAgICBkZWxldGUgZnJlZUNsYWltQWxsb3dhbmNlW21zZy5zZW5kZXJdOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBUaGUgc3VidHJhY3Rpb24gY2Fubm90IHVuZGVyZmxvdywgYXMgZnJlZUFtb3VudCA8PSBidXlBbW91bnQuCiAgICAgICAgICAgICAgICBldGhlclJlcXVpcmVkID0gdW5jbGFpbWVkUGxvdFByaWNlLm11bChidXlBbW91bnQgLSBmcmVlQW1vdW50KTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFRoZSBzZW5kZXIgZG9lcyBub3QgaGF2ZSBhIGZyZWUgY2xhaW0gYWxsb3dhbmNlLgogICAgICAgICAgICBldGhlclJlcXVpcmVkID0gdW5jbGFpbWVkUGxvdFByaWNlLm11bChidXlBbW91bnQpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICB1aW50MjU2IG9mZnNldCA9IHBsb3RzLmxlbmd0aDsKICAgICAgICAKICAgICAgICAvLyBBbGxvY2F0ZSBhZGRpdGlvbmFsIG1lbW9yeSBmb3IgdGhlIHBsb3RzIGFycmF5CiAgICAgICAgLy8gKHRoaXMgaXMgbW9yZSBlZmZpY2llbnQgdGhhbiAucHVzaC1pbmcgZWFjaCBpbmRpdmlkdWFsCiAgICAgICAgLy8gcGxvdCwgYXMgdGhhdCByZXF1aXJlcyBtdWx0aXBsZSBkeW5hbWljIGFsbG9jYXRpb25zKS4KICAgICAgICBwbG90cy5sZW5ndGggPSBwbG90cy5sZW5ndGguYWRkKF9kZWVkSWRzLmxlbmd0aCk7CiAgICAgICAgCiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgX2RlZWRJZHMubGVuZ3RoOyBpKyspIHsgCiAgICAgICAgICAgIHVpbnQyNTYgX2RlZWRJZCA9IF9kZWVkSWRzW2ldOwogICAgICAgICAgICByZXF1aXJlKHZhbGlkSWRlbnRpZmllcihfZGVlZElkKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBUaGUgcGxvdCBtdXN0IGJlIHVub3duZWQgKGEgcGxvdCBkZWVkIGNhbm5vdCBiZSB0cmFuc2ZlcnJlZCB0bwogICAgICAgICAgICAvLyAweDAsIHNvIG9uY2UgYSBwbG90IGlzIGNsYWltZWQgaXQgd2lsbCBhbHdheXMgYmUgb3duZWQgYnkgYQogICAgICAgICAgICAvLyBub24temVybyBhZGRyZXNzKS4KICAgICAgICAgICAgcmVxdWlyZShpZGVudGlmaWVyVG9Pd25lcltfZGVlZElkXSA9PSBhZGRyZXNzKDApKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIENyZWF0ZSB0aGUgcGxvdAogICAgICAgICAgICBwbG90c1tvZmZzZXQgKyBpXSA9IHVpbnQzMihfZGVlZElkKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFRyYW5zZmVyIHRoZSBuZXcgcGxvdCB0byB0aGUgc2VuZGVyLgogICAgICAgICAgICBfdHJhbnNmZXIoYWRkcmVzcygwKSwgbXNnLnNlbmRlciwgX2RlZWRJZCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTZXQgdGhlIHBsb3QgZGF0YS4KICAgICAgICAgICAgX3NldFBsb3REYXRhKF9kZWVkSWQsIG5hbWUsIGRlc2NyaXB0aW9uLCBpbWFnZVVybCwgaW5mb1VybCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBDYWxjdWxhdGUgYW5kIGFzc2lnbiBjbGFpbSBkaXZpZGVuZHMuCiAgICAgICAgICAgIHVpbnQyNTYgY2xhaW1EaXZpZGVuZHMgPSBfY2FsY3VsYXRlQW5kQXNzaWduQ2xhaW1EaXZpZGVuZHMoX2RlZWRJZCk7CiAgICAgICAgICAgIGV0aGVyUmVxdWlyZWQgPSBldGhlclJlcXVpcmVkLmFkZChjbGFpbURpdmlkZW5kcyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTZXQgdGhlIGluaXRpYWwgcHJpY2UgcGFpZCBmb3IgdGhlIHBsb3QuCiAgICAgICAgICAgIGluaXRpYWxQcmljZVBhaWRbX2RlZWRJZF0gPSB1bmNsYWltZWRQbG90UHJpY2UuYWRkKGNsYWltRGl2aWRlbmRzKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFNldCB0aGUgaW5pdGlhbCBidXlvdXQgcHJpY2UuIFRocm93cyBpZiBpdCBkb2VzIG5vdCBzdWNjZWVkLgogICAgICAgICAgICBzZXRJbml0aWFsQnV5b3V0UHJpY2UoX2RlZWRJZCwgX2J1eW91dFByaWNlKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gRW5zdXJlIGVub3VnaCBldGhlciBpcyBzdXBwbGllZC4KICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+PSBldGhlclJlcXVpcmVkKTsKICAgICAgICAKICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIGV4Y2VzcyBldGhlciBzZW50CiAgICAgICAgLy8gbXNnLnZhbHVlIGlzIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byBldGhlclJlcXVpcmVkLAogICAgICAgIC8vIHNvIHRoaXMgY2Fubm90IHVuZGVyZmxvdy4KICAgICAgICB1aW50MjU2IGV4Y2VzcyA9IG1zZy52YWx1ZSAtIGV0aGVyUmVxdWlyZWQ7CiAgICAgICAgCiAgICAgICAgaWYgKGV4Y2VzcyA+IDApIHsKICAgICAgICAgICAgLy8gUmVmdW5kIGFueSBleGNlc3MgZXRoZXIgKG5vdCBzdXNjZXB0aWJsZSB0byByZS1lbnRyeSBhdHRhY2ssIGFzCiAgICAgICAgICAgIC8vIHRoZSBvd25lciBpcyBhc3NpZ25lZCBiZWZvcmUgdGhlIHRyYW5zZmVyIHRha2VzIHBsYWNlKS4KICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihleGNlc3MpOwogICAgICAgIH0KICAgIH0KfQoKCi8vLyBAdGl0bGUgVGhlIGludGVybmFsIGNsb2NrIGF1Y3Rpb24gZnVuY3Rpb25hbGl0eS4KLy8vIEluc3BpcmVkIGJ5IENyeXB0b0tpdHRpZXMnIGNsb2NrIGF1Y3Rpb24KY29udHJhY3QgQ2xvY2tBdWN0aW9uQmFzZSB7CgogICAgLy8gQWRkcmVzcyBvZiB0aGUgRVJDNzIxIGNvbnRyYWN0IHRoaXMgYXVjdGlvbiBpcyBsaW5rZWQgdG8uCiAgICBFUkM3MjEgcHVibGljIGRlZWRDb250cmFjdDsKCiAgICAvLyBGZWUgcGVyIHN1Y2Nlc3NmdWwgYXVjdGlvbiBpbiAxLzEwMDB0aCBvZiBhIHBlcmNlbnRhZ2UuCiAgICB1aW50MjU2IHB1YmxpYyBmZWU7CiAgICAKICAgIC8vIFRvdGFsIGFtb3VudCBvZiBldGhlciB5ZXQgdG8gYmUgcGFpZCB0byBhdWN0aW9uIGJlbmVmaWNpYXJpZXMuCiAgICB1aW50MjU2IHB1YmxpYyBvdXRzdGFuZGluZ0V0aGVyID0gMCBldGhlcjsKICAgIAogICAgLy8gQW1vdW50IG9mIGV0aGVyIHlldCB0byBiZSBwYWlkIHBlciBiZW5lZmljaWFyeS4KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGFkZHJlc3NUb0V0aGVyT3dlZDsKICAgIAogICAgLy8vIEBkZXYgUmVwcmVzZW50cyBhIGRlZWQgYXVjdGlvbi4KICAgIC8vLyBDYXJlIGhhcyBiZWVuIHRha2VuIHRvIGVuc3VyZSB0aGUgYXVjdGlvbiBmaXRzIGluCiAgICAvLy8gdHdvIDI1Ni1iaXQgd29yZHMuCiAgICBzdHJ1Y3QgQXVjdGlvbiB7CiAgICAgICAgYWRkcmVzcyBzZWxsZXI7CiAgICAgICAgdWludDEyOCBzdGFydFByaWNlOwogICAgICAgIHVpbnQxMjggZW5kUHJpY2U7CiAgICAgICAgdWludDY0IGR1cmF0aW9uOwogICAgICAgIHVpbnQ2NCBzdGFydGVkQXQ7CiAgICB9CgogICAgbWFwcGluZyAodWludDI1NiA9PiBBdWN0aW9uKSBpZGVudGlmaWVyVG9BdWN0aW9uOwogICAgCiAgICAvLyBFdmVudHMKICAgIGV2ZW50IEF1Y3Rpb25DcmVhdGVkKGFkZHJlc3MgaW5kZXhlZCBzZWxsZXIsIHVpbnQyNTYgaW5kZXhlZCBkZWVkSWQsIHVpbnQyNTYgc3RhcnRQcmljZSwgdWludDI1NiBlbmRQcmljZSwgdWludDI1NiBkdXJhdGlvbik7CiAgICBldmVudCBBdWN0aW9uU3VjY2Vzc2Z1bChhZGRyZXNzIGluZGV4ZWQgYnV5ZXIsIHVpbnQyNTYgaW5kZXhlZCBkZWVkSWQsIHVpbnQyNTYgdG90YWxQcmljZSk7CiAgICBldmVudCBBdWN0aW9uQ2FuY2VsbGVkKHVpbnQyNTYgaW5kZXhlZCBkZWVkSWQpOwogICAgCiAgICAvLy8gQGRldiBNb2RpZmllciB0byBjaGVjayB3aGV0aGVyIHRoZSB2YWx1ZSBjYW4gYmUgc3RvcmVkIGluIGEgNjQgYml0IHVpbnQuCiAgICBtb2RpZmllciBmaXRzSW42NEJpdHModWludDI1NiBfdmFsdWUpIHsKICAgICAgICByZXF1aXJlIChfdmFsdWUgPT0gdWludDI1Nih1aW50NjQoX3ZhbHVlKSkpOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IE1vZGlmaWVyIHRvIGNoZWNrIHdoZXRoZXIgdGhlIHZhbHVlIGNhbiBiZSBzdG9yZWQgaW4gYSAxMjggYml0IHVpbnQuCiAgICBtb2RpZmllciBmaXRzSW4xMjhCaXRzKHVpbnQyNTYgX3ZhbHVlKSB7CiAgICAgICAgcmVxdWlyZSAoX3ZhbHVlID09IHVpbnQyNTYodWludDEyOChfdmFsdWUpKSk7CiAgICAgICAgXzsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gQ2xvY2tBdWN0aW9uQmFzZShhZGRyZXNzIF9kZWVkQ29udHJhY3RBZGRyZXNzLCB1aW50MjU2IF9mZWUpIHB1YmxpYyB7CiAgICAgICAgZGVlZENvbnRyYWN0ID0gRVJDNzIxKF9kZWVkQ29udHJhY3RBZGRyZXNzKTsKICAgICAgICAKICAgICAgICAvLyBDb250cmFjdCBtdXN0IGluZGljYXRlIHN1cHBvcnQgZm9yIEVSQzcyMSB0aHJvdWdoIGl0cyBpbnRlcmZhY2Ugc2lnbmF0dXJlLgogICAgICAgIHJlcXVpcmUoZGVlZENvbnRyYWN0LnN1cHBvcnRzSW50ZXJmYWNlKDB4ZGE2NzFiOWIpKTsKICAgICAgICAKICAgICAgICAvLyBGZWUgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDEwMCUuCiAgICAgICAgcmVxdWlyZSgwIDw9IF9mZWUgJiYgX2ZlZSA8PSAxMDAwMDApOwogICAgICAgIGZlZSA9IF9mZWU7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IENoZWNrcyB3aGV0aGVyIHRoZSBnaXZlbiBhdWN0aW9uIGlzIGFjdGl2ZS4KICAgIC8vLyBAcGFyYW0gYXVjdGlvbiBUaGUgYXVjdGlvbiB0byBjaGVjayBmb3IgYWN0aXZpdHkuCiAgICBmdW5jdGlvbiBfYWN0aXZlQXVjdGlvbihBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbikgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGF1Y3Rpb24uc3RhcnRlZEF0ID4gMDsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgUHV0IHRoZSBkZWVkIGludG8gZXNjcm93LCB0aGVyZWJ5IHRha2luZyBvd25lcnNoaXAgb2YgaXQuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWQgVGhlIGlkZW50aWZpZXIgb2YgdGhlIGRlZWQgdG8gcGxhY2UgaW50byBlc2Nyb3cuCiAgICBmdW5jdGlvbiBfZXNjcm93KHVpbnQyNTYgX2RlZWRJZCkgaW50ZXJuYWwgewogICAgICAgIC8vIFRocm93cyBpZiB0aGUgdHJhbnNmZXIgZmFpbHMKICAgICAgICBkZWVkQ29udHJhY3QudGFrZU93bmVyc2hpcChfZGVlZElkKTsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgQ3JlYXRlIHRoZSBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBkZWVkIHRvIGNyZWF0ZSB0aGUgYXVjdGlvbiBmb3IuCiAgICAvLy8gQHBhcmFtIGF1Y3Rpb24gVGhlIGF1Y3Rpb24gdG8gY3JlYXRlLgogICAgZnVuY3Rpb24gX2NyZWF0ZUF1Y3Rpb24odWludDI1NiBfZGVlZElkLCBBdWN0aW9uIGF1Y3Rpb24pIGludGVybmFsIHsKICAgICAgICAvLyBBZGQgdGhlIGF1Y3Rpb24gdG8gdGhlIGF1Y3Rpb24gbWFwcGluZy4KICAgICAgICBpZGVudGlmaWVyVG9BdWN0aW9uW19kZWVkSWRdID0gYXVjdGlvbjsKICAgICAgICAKICAgICAgICAvLyBUcmlnZ2VyIGF1Y3Rpb24gY3JlYXRlZCBldmVudC4KICAgICAgICBBdWN0aW9uQ3JlYXRlZChhdWN0aW9uLnNlbGxlciwgX2RlZWRJZCwgYXVjdGlvbi5zdGFydFByaWNlLCBhdWN0aW9uLmVuZFByaWNlLCBhdWN0aW9uLmR1cmF0aW9uKTsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgQmlkIG9uIGFuIGF1Y3Rpb24uCiAgICAvLy8gQHBhcmFtIF9idXllciBUaGUgYWRkcmVzcyBvZiB0aGUgYnV5ZXIuCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgdmFsdWUgc2VudCBieSB0aGUgc2VuZGVyIChpbiBldGhlcikuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWQgVGhlIGlkZW50aWZpZXIgb2YgdGhlIGRlZWQgdG8gYmlkIG9uLgogICAgZnVuY3Rpb24gX2JpZChhZGRyZXNzIF9idXllciwgdWludDI1NiBfdmFsdWUsIHVpbnQyNTYgX2RlZWRJZCkgaW50ZXJuYWwgewogICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gaWRlbnRpZmllclRvQXVjdGlvbltfZGVlZElkXTsKICAgICAgICAKICAgICAgICAvLyBUaGUgYXVjdGlvbiBtdXN0IGJlIGFjdGl2ZS4KICAgICAgICByZXF1aXJlKF9hY3RpdmVBdWN0aW9uKGF1Y3Rpb24pKTsKICAgICAgICAKICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIGF1Y3Rpb24ncyBjdXJyZW50IHByaWNlLgogICAgICAgIHVpbnQyNTYgcHJpY2UgPSBfY3VycmVudFByaWNlKGF1Y3Rpb24pOwogICAgICAgIAogICAgICAgIC8vIE1ha2Ugc3VyZSBlbm91Z2ggZnVuZHMgd2VyZSBzZW50LgogICAgICAgIHJlcXVpcmUoX3ZhbHVlID49IHByaWNlKTsKICAgICAgICAKICAgICAgICBhZGRyZXNzIHNlbGxlciA9IGF1Y3Rpb24uc2VsbGVyOwogICAgCiAgICAgICAgaWYgKHByaWNlID4gMCkgewogICAgICAgICAgICB1aW50MjU2IHRvdGFsRmVlID0gX2NhbGN1bGF0ZUZlZShwcmljZSk7CiAgICAgICAgICAgIHVpbnQyNTYgcHJvY2VlZHMgPSBwcmljZSAtIHRvdGFsRmVlOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQXNzaWduIHRoZSBwcm9jZWVkcyB0byB0aGUgc2VsbGVyLgogICAgICAgICAgICAvLyBXZSBkbyBub3Qgc2VuZCB0aGUgcHJvY2VlZHMgZGlyZWN0bHksIGFzIHRvIHByZXZlbnQKICAgICAgICAgICAgLy8gbWFsaWNpb3VzIHNlbGxlcnMgZnJvbSBkZW55aW5nIGF1Y3Rpb25zIChhbmQgYnVybmluZwogICAgICAgICAgICAvLyB0aGUgYnV5ZXIncyBnYXMpLgogICAgICAgICAgICBfYXNzaWduUHJvY2VlZHMoc2VsbGVyLCBwcm9jZWVkcyk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIEF1Y3Rpb25TdWNjZXNzZnVsKF9idXllciwgX2RlZWRJZCwgcHJpY2UpOwogICAgICAgIAogICAgICAgIC8vIFRoZSBiaWQgd2FzIHdvbiEKICAgICAgICBfd2luQmlkKHNlbGxlciwgX2J1eWVyLCBfZGVlZElkLCBwcmljZSk7CiAgICAgICAgCiAgICAgICAgLy8gUmVtb3ZlIHRoZSBhdWN0aW9uICh3ZSBkbyB0aGlzIGF0IHRoZSBlbmQsIGFzCiAgICAgICAgLy8gd2luQmlkIG1pZ2h0IHJlcXVpcmUgc29tZSBhZGRpdGlvbmFsIGluZm9ybWF0aW9uCiAgICAgICAgLy8gdGhhdCB3aWxsIGJlIHJlbW92ZWQgd2hlbiBfcmVtb3ZlQXVjdGlvbiBpcwogICAgICAgIC8vIGNhbGxlZC4gQXMgd2UgZG8gbm90IHRyYW5zZmVyIGZ1bmRzIGhlcmUsIHdlIGRvCiAgICAgICAgLy8gbm90IGhhdmUgdG8gd29ycnkgYWJvdXQgcmUtZW50cnkgYXR0YWNrcy4KICAgICAgICBfcmVtb3ZlQXVjdGlvbihfZGVlZElkKTsKICAgIH0KCiAgICAvLy8gQGRldiBQZXJmb3JtIHRoZSBiaWQgd2luIGxvZ2ljIChpbiB0aGlzIGNhc2U6IHRyYW5zZmVyIHRoZSBkZWVkKS4KICAgIC8vLyBAcGFyYW0gX3NlbGxlciBUaGUgYWRkcmVzcyBvZiB0aGUgc2VsbGVyLgogICAgLy8vIEBwYXJhbSBfd2lubmVyIFRoZSBhZGRyZXNzIG9mIHRoZSB3aW5uZXIuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWQgVGhlIGlkZW50aWZpZXIgb2YgdGhlIGRlZWQuCiAgICAvLy8gQHBhcmFtIF9wcmljZSBUaGUgcHJpY2UgdGhlIGF1Y3Rpb24gd2FzIGJvdWdodCBhdC4KICAgIGZ1bmN0aW9uIF93aW5CaWQoYWRkcmVzcyBfc2VsbGVyLCBhZGRyZXNzIF93aW5uZXIsIHVpbnQyNTYgX2RlZWRJZCwgdWludDI1NiBfcHJpY2UpIGludGVybmFsIHsKICAgICAgICBfdHJhbnNmZXIoX3dpbm5lciwgX2RlZWRJZCk7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IENhbmNlbCBhbiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBkZWVkIGZvciB3aGljaCB0aGUgYXVjdGlvbiBzaG91bGQgYmUgY2FuY2VsbGVkLgogICAgLy8vIEBwYXJhbSBhdWN0aW9uIFRoZSBhdWN0aW9uIHRvIGNhbmNlbC4KICAgIGZ1bmN0aW9uIF9jYW5jZWxBdWN0aW9uKHVpbnQyNTYgX2RlZWRJZCwgQXVjdGlvbiBhdWN0aW9uKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gUmVtb3ZlIHRoZSBhdWN0aW9uCiAgICAgICAgX3JlbW92ZUF1Y3Rpb24oX2RlZWRJZCk7CiAgICAgICAgCiAgICAgICAgLy8gVHJhbnNmZXIgdGhlIGRlZWQgYmFjayB0byB0aGUgc2VsbGVyCiAgICAgICAgX3RyYW5zZmVyKGF1Y3Rpb24uc2VsbGVyLCBfZGVlZElkKTsKICAgICAgICAKICAgICAgICAvLyBUcmlnZ2VyIGF1Y3Rpb24gY2FuY2VsbGVkIGV2ZW50LgogICAgICAgIEF1Y3Rpb25DYW5jZWxsZWQoX2RlZWRJZCk7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IFJlbW92ZSBhbiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBkZWVkIGZvciB3aGljaCB0aGUgYXVjdGlvbiBzaG91bGQgYmUgcmVtb3ZlZC4KICAgIGZ1bmN0aW9uIF9yZW1vdmVBdWN0aW9uKHVpbnQyNTYgX2RlZWRJZCkgaW50ZXJuYWwgewogICAgICAgIGRlbGV0ZSBpZGVudGlmaWVyVG9BdWN0aW9uW19kZWVkSWRdOwogICAgfQogICAgCiAgICAvLy8gQGRldiBUcmFuc2ZlciBhIGRlZWQgb3duZWQgYnkgdGhpcyBjb250cmFjdCB0byBhbm90aGVyIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0aGUgZGVlZCB0by4KICAgIC8vLyBAcGFyYW0gX2RlZWRJZCBUaGUgaWRlbnRpZmllciBvZiB0aGUgZGVlZC4KICAgIGZ1bmN0aW9uIF90cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfZGVlZElkKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gVGhyb3dzIGlmIHRoZSB0cmFuc2ZlciBmYWlscwogICAgICAgIGRlZWRDb250cmFjdC50cmFuc2ZlcihfdG8sIF9kZWVkSWQpOwogICAgfQogICAgCiAgICAvLy8gQGRldiBBc3NpZ24gcHJvY2VlZHMgdG8gYW4gYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIGFzc2lnbiBwcm9jZWVkcyB0by4KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBwcm9jZWVkcyB0byBhc3NpZ24uCiAgICBmdW5jdGlvbiBfYXNzaWduUHJvY2VlZHMoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBpbnRlcm5hbCB7CiAgICAgICAgb3V0c3RhbmRpbmdFdGhlciArPSBfdmFsdWU7CiAgICAgICAgYWRkcmVzc1RvRXRoZXJPd2VkW190b10gKz0gX3ZhbHVlOwogICAgfQogICAgCiAgICAvLy8gQGRldiBDYWxjdWxhdGUgdGhlIGN1cnJlbnQgcHJpY2Ugb2YgYW4gYXVjdGlvbi4KICAgIGZ1bmN0aW9uIF9jdXJyZW50UHJpY2UoQXVjdGlvbiBzdG9yYWdlIF9hdWN0aW9uKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXF1aXJlKG5vdyA+PSBfYXVjdGlvbi5zdGFydGVkQXQpOwogICAgICAgIAogICAgICAgIHVpbnQyNTYgc2Vjb25kc1Bhc3NlZCA9IG5vdyAtIF9hdWN0aW9uLnN0YXJ0ZWRBdDsKICAgICAgICAKICAgICAgICBpZiAoc2Vjb25kc1Bhc3NlZCA+PSBfYXVjdGlvbi5kdXJhdGlvbikgewogICAgICAgICAgICByZXR1cm4gX2F1Y3Rpb24uZW5kUHJpY2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gTmVnYXRpdmUgaWYgdGhlIGVuZCBwcmljZSBpcyBoaWdoZXIgdGhhbiB0aGUgc3RhcnQgcHJpY2UhCiAgICAgICAgICAgIGludDI1NiB0b3RhbFByaWNlQ2hhbmdlID0gaW50MjU2KF9hdWN0aW9uLmVuZFByaWNlKSAtIGludDI1NihfYXVjdGlvbi5zdGFydFByaWNlKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgY3VycmVudCBwcmljZSBiYXNlZCBvbiB0aGUgdG90YWwgY2hhbmdlIG92ZXIgdGhlIGVudGlyZQogICAgICAgICAgICAvLyBhdWN0aW9uIGR1cmF0aW9uLCBhbmQgdGhlIGFtb3VudCBvZiB0aW1lIHBhc3NlZCBzaW5jZSB0aGUgc3RhcnQgb2YgdGhlCiAgICAgICAgICAgIC8vIGF1Y3Rpb24uCiAgICAgICAgICAgIGludDI1NiBjdXJyZW50UHJpY2VDaGFuZ2UgPSB0b3RhbFByaWNlQ2hhbmdlICogaW50MjU2KHNlY29uZHNQYXNzZWQpIC8gaW50MjU2KF9hdWN0aW9uLmR1cmF0aW9uKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgZmluYWwgcHJpY2UuIE5vdGUgdGhpcyBvbmNlIGFnYWluCiAgICAgICAgICAgIC8vIGlzIHJlcHJlc2VudGFibGUgYnkgYSB1aW50MjU2LCBhcyB0aGUgcHJpY2UgY2FuCiAgICAgICAgICAgIC8vIG5ldmVyIGJlIG5lZ2F0aXZlLgogICAgICAgICAgICBpbnQyNTYgcHJpY2UgPSBpbnQyNTYoX2F1Y3Rpb24uc3RhcnRQcmljZSkgKyBjdXJyZW50UHJpY2VDaGFuZ2U7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBUaGlzIG5ldmVyIHRocm93cy4KICAgICAgICAgICAgYXNzZXJ0KHByaWNlID49IDApOwogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHVpbnQyNTYocHJpY2UpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8vIEBkZXYgQ2FsY3VsYXRlIHRoZSBmZWUgZm9yIGEgZ2l2ZW4gcHJpY2UuCiAgICAvLy8gQHBhcmFtIF9wcmljZSBUaGUgcHJpY2UgdG8gY2FsY3VsYXRlIHRoZSBmZWUgZm9yLgogICAgZnVuY3Rpb24gX2NhbGN1bGF0ZUZlZSh1aW50MjU2IF9wcmljZSkgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgLy8gX3ByaWNlIGlzIGd1YXJhbnRlZWQgdG8gZml0IGluIGEgdWludDEyOCBkdWUgdG8gdGhlIGNyZWF0ZUF1Y3Rpb24gZW50cnkKICAgICAgICAvLyBtb2RpZmllcnMsIHNvIHRoaXMgY2Fubm90IG92ZXJmbG93LgogICAgICAgIHJldHVybiBfcHJpY2UgKiBmZWUgLyAxMDAwMDA7CiAgICB9Cn0KCgpjb250cmFjdCBDbG9ja0F1Y3Rpb24gaXMgQ2xvY2tBdWN0aW9uQmFzZSwgUGF1c2FibGUgewogICAgZnVuY3Rpb24gQ2xvY2tBdWN0aW9uKGFkZHJlc3MgX2RlZWRDb250cmFjdEFkZHJlc3MsIHVpbnQyNTYgX2ZlZSkgCiAgICAgICAgQ2xvY2tBdWN0aW9uQmFzZShfZGVlZENvbnRyYWN0QWRkcmVzcywgX2ZlZSkKICAgICAgICBwdWJsaWMKICAgIHt9CiAgICAKICAgIC8vLyBAbm90aWNlIFVwZGF0ZSB0aGUgYXVjdGlvbiBmZWUuCiAgICAvLy8gQHBhcmFtIF9mZWUgVGhlIG5ldyBmZWUuCiAgICBmdW5jdGlvbiBzZXRGZWUodWludDI1NiBfZmVlKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoMCA8PSBfZmVlICYmIF9mZWUgPD0gMTAwMDAwKTsKICAgIAogICAgICAgIGZlZSA9IF9mZWU7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIEdldCB0aGUgYXVjdGlvbiBmb3IgdGhlIGdpdmVuIGRlZWQuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWQgVGhlIGlkZW50aWZpZXIgb2YgdGhlIGRlZWQgdG8gZ2V0IHRoZSBhdWN0aW9uIGZvci4KICAgIC8vLyBAZGV2IFRocm93cyBpZiB0aGVyZSBpcyBubyBhdWN0aW9uIGZvciB0aGUgZ2l2ZW4gZGVlZC4KICAgIGZ1bmN0aW9uIGdldEF1Y3Rpb24odWludDI1NiBfZGVlZElkKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKAogICAgICAgICAgICBhZGRyZXNzIHNlbGxlciwKICAgICAgICAgICAgdWludDI1NiBzdGFydFByaWNlLAogICAgICAgICAgICB1aW50MjU2IGVuZFByaWNlLAogICAgICAgICAgICB1aW50MjU2IGR1cmF0aW9uLAogICAgICAgICAgICB1aW50MjU2IHN0YXJ0ZWRBdAogICAgICAgICkKICAgIHsKICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IGlkZW50aWZpZXJUb0F1Y3Rpb25bX2RlZWRJZF07CiAgICAgICAgCiAgICAgICAgLy8gVGhlIGF1Y3Rpb24gbXVzdCBiZSBhY3RpdmUKICAgICAgICByZXF1aXJlKF9hY3RpdmVBdWN0aW9uKGF1Y3Rpb24pKTsKICAgICAgICAKICAgICAgICByZXR1cm4gKAogICAgICAgICAgICBhdWN0aW9uLnNlbGxlciwKICAgICAgICAgICAgYXVjdGlvbi5zdGFydFByaWNlLAogICAgICAgICAgICBhdWN0aW9uLmVuZFByaWNlLAogICAgICAgICAgICBhdWN0aW9uLmR1cmF0aW9uLAogICAgICAgICAgICBhdWN0aW9uLnN0YXJ0ZWRBdAogICAgICAgICk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQ3JlYXRlIGFuIGF1Y3Rpb24gZm9yIGEgZ2l2ZW4gZGVlZC4KICAgIC8vLyBNdXN0IHByZXZpb3VzbHkgaGF2ZSBiZWVuIGdpdmVuIGFwcHJvdmFsIHRvIHRha2Ugb3duZXJzaGlwIG9mIHRoZSBkZWVkLgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBkZWVkIHRvIGNyZWF0ZSBhbiBhdWN0aW9uIGZvci4KICAgIC8vLyBAcGFyYW0gX3N0YXJ0UHJpY2UgVGhlIHN0YXJ0aW5nIHByaWNlIG9mIHRoZSBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZW5kUHJpY2UgVGhlIGVuZGluZyBwcmljZSBvZiB0aGUgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2R1cmF0aW9uIFRoZSBkdXJhdGlvbiBpbiBzZWNvbmRzIG9mIHRoZSBkeW5hbWljIHByaWNpbmcgcGFydCBvZiB0aGUgYXVjdGlvbi4KICAgIGZ1bmN0aW9uIGNyZWF0ZUF1Y3Rpb24odWludDI1NiBfZGVlZElkLCB1aW50MjU2IF9zdGFydFByaWNlLCB1aW50MjU2IF9lbmRQcmljZSwgdWludDI1NiBfZHVyYXRpb24pCiAgICAgICAgcHVibGljCiAgICAgICAgZml0c0luMTI4Qml0cyhfc3RhcnRQcmljZSkKICAgICAgICBmaXRzSW4xMjhCaXRzKF9lbmRQcmljZSkKICAgICAgICBmaXRzSW42NEJpdHMoX2R1cmF0aW9uKQogICAgICAgIHdoZW5Ob3RQYXVzZWQKICAgIHsKICAgICAgICAvLyBHZXQgdGhlIG93bmVyIG9mIHRoZSBkZWVkIHRvIGJlIGF1Y3Rpb25lZAogICAgICAgIGFkZHJlc3MgZGVlZE93bmVyID0gZGVlZENvbnRyYWN0Lm93bmVyT2YoX2RlZWRJZCk7CiAgICAKICAgICAgICAvLyBDYWxsZXIgbXVzdCBlaXRoZXIgYmUgdGhlIGRlZWQgY29udHJhY3Qgb3IgdGhlIG93bmVyIG9mIHRoZSBkZWVkCiAgICAgICAgLy8gdG8gcHJldmVudCBhYnVzZS4KICAgICAgICByZXF1aXJlKAogICAgICAgICAgICBtc2cuc2VuZGVyID09IGFkZHJlc3MoZGVlZENvbnRyYWN0KSB8fAogICAgICAgICAgICBtc2cuc2VuZGVyID09IGRlZWRPd25lcgogICAgICAgICk7CiAgICAKICAgICAgICAvLyBUaGUgZHVyYXRpb24gb2YgdGhlIGF1Y3Rpb24gbXVzdCBiZSBhdCBsZWFzdCA2MCBzZWNvbmRzLgogICAgICAgIHJlcXVpcmUoX2R1cmF0aW9uID49IDYwKTsKICAgIAogICAgICAgIC8vIFRocm93cyBpZiBwbGFjaW5nIHRoZSBkZWVkIGluIGVzY3JvdyBmYWlscyAodGhlIGNvbnRyYWN0IHJlcXVpcmVzCiAgICAgICAgLy8gdHJhbnNmZXIgYXBwcm92YWwgcHJpb3IgdG8gY3JlYXRpbmcgdGhlIGF1Y3Rpb24pLgogICAgICAgIF9lc2Nyb3coX2RlZWRJZCk7CiAgICAgICAgCiAgICAgICAgLy8gQXVjdGlvbiBzdHJ1Y3QKICAgICAgICBBdWN0aW9uIG1lbW9yeSBhdWN0aW9uID0gQXVjdGlvbigKICAgICAgICAgICAgZGVlZE93bmVyLAogICAgICAgICAgICB1aW50MTI4KF9zdGFydFByaWNlKSwKICAgICAgICAgICAgdWludDEyOChfZW5kUHJpY2UpLAogICAgICAgICAgICB1aW50NjQoX2R1cmF0aW9uKSwKICAgICAgICAgICAgdWludDY0KG5vdykKICAgICAgICApOwogICAgICAgIAogICAgICAgIF9jcmVhdGVBdWN0aW9uKF9kZWVkSWQsIGF1Y3Rpb24pOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBDYW5jZWwgYW4gYXVjdGlvbgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBkZWVkIHRvIGNhbmNlbCB0aGUgYXVjdGlvbiBmb3IuCiAgICBmdW5jdGlvbiBjYW5jZWxBdWN0aW9uKHVpbnQyNTYgX2RlZWRJZCkgZXh0ZXJuYWwgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgQXVjdGlvbiBzdG9yYWdlIGF1Y3Rpb24gPSBpZGVudGlmaWVyVG9BdWN0aW9uW19kZWVkSWRdOwogICAgICAgIAogICAgICAgIC8vIFRoZSBhdWN0aW9uIG11c3QgYmUgYWN0aXZlLgogICAgICAgIHJlcXVpcmUoX2FjdGl2ZUF1Y3Rpb24oYXVjdGlvbikpOwogICAgICAgIAogICAgICAgIC8vIFRoZSBhdWN0aW9uIGNhbiBvbmx5IGJlIGNhbmNlbGxlZCBieSB0aGUgc2VsbGVyCiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGF1Y3Rpb24uc2VsbGVyKTsKICAgICAgICAKICAgICAgICBfY2FuY2VsQXVjdGlvbihfZGVlZElkLCBhdWN0aW9uKTsKICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgQmlkIG9uIGFuIGF1Y3Rpb24uCiAgICAvLy8gQHBhcmFtIF9kZWVkSWQgVGhlIGlkZW50aWZpZXIgb2YgdGhlIGRlZWQgdG8gYmlkIG9uLgogICAgZnVuY3Rpb24gYmlkKHVpbnQyNTYgX2RlZWRJZCkgZXh0ZXJuYWwgcGF5YWJsZSB3aGVuTm90UGF1c2VkIHsKICAgICAgICAvLyBUaHJvd3MgaWYgdGhlIGJpZCBkb2VzIG5vdCBzdWNjZWVkLgogICAgICAgIF9iaWQobXNnLnNlbmRlciwgbXNnLnZhbHVlLCBfZGVlZElkKTsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgUmV0dXJucyB0aGUgY3VycmVudCBwcmljZSBvZiBhbiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBkZWVkIHRvIGdldCB0aGUgY3VycmVuY3kgcHJpY2UgZm9yLgogICAgZnVuY3Rpb24gZ2V0Q3VycmVudFByaWNlKHVpbnQyNTYgX2RlZWRJZCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgQXVjdGlvbiBzdG9yYWdlIGF1Y3Rpb24gPSBpZGVudGlmaWVyVG9BdWN0aW9uW19kZWVkSWRdOwogICAgICAgIAogICAgICAgIC8vIFRoZSBhdWN0aW9uIG11c3QgYmUgYWN0aXZlLgogICAgICAgIHJlcXVpcmUoX2FjdGl2ZUF1Y3Rpb24oYXVjdGlvbikpOwogICAgICAgIAogICAgICAgIHJldHVybiBfY3VycmVudFByaWNlKGF1Y3Rpb24pOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBXaXRoZHJhdyBldGhlciBvd2VkIHRvIGEgYmVuZWZpY2lhcnkuCiAgICAvLy8gQHBhcmFtIGJlbmVmaWNpYXJ5IFRoZSBhZGRyZXNzIHRvIHdpdGhkcmF3IHRoZSBhdWN0aW9uIGJhbGFuY2UgZm9yLgogICAgZnVuY3Rpb24gd2l0aGRyYXdBdWN0aW9uQmFsYW5jZShhZGRyZXNzIGJlbmVmaWNpYXJ5KSBleHRlcm5hbCB7CiAgICAgICAgLy8gVGhlIHNlbmRlciBtdXN0IGVpdGhlciBiZSB0aGUgYmVuZWZpY2lhcnkgb3IgdGhlIGNvcmUgZGVlZCBjb250cmFjdC4KICAgICAgICByZXF1aXJlKAogICAgICAgICAgICBtc2cuc2VuZGVyID09IGJlbmVmaWNpYXJ5IHx8CiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhkZWVkQ29udHJhY3QpCiAgICAgICAgKTsKICAgICAgICAKICAgICAgICB1aW50MjU2IGV0aGVyT3dlZCA9IGFkZHJlc3NUb0V0aGVyT3dlZFtiZW5lZmljaWFyeV07CiAgICAgICAgCiAgICAgICAgLy8gRW5zdXJlIGV0aGVyIGlzIG93ZWQgdG8gdGhlIGJlbmVmaWNpYXJ5LgogICAgICAgIHJlcXVpcmUoZXRoZXJPd2VkID4gMCk7CiAgICAgICAgIAogICAgICAgIC8vIFNldCBldGhlciBvd2VkIHRvIDAgICAKICAgICAgICBkZWxldGUgYWRkcmVzc1RvRXRoZXJPd2VkW2JlbmVmaWNpYXJ5XTsKICAgICAgICAKICAgICAgICAvLyBTdWJ0cmFjdCBmcm9tIHRvdGFsIG91dHN0YW5kaW5nIGJhbGFuY2UuIGV0aGVyT3dlZCBpcyBndWFyYW50ZWVkCiAgICAgICAgLy8gdG8gYmUgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIG91dHN0YW5kaW5nRXRoZXIsIHNvIHRoaXMgY2Fubm90CiAgICAgICAgLy8gdW5kZXJmbG93LgogICAgICAgIG91dHN0YW5kaW5nRXRoZXIgLT0gZXRoZXJPd2VkOwogICAgICAgIAogICAgICAgIC8vIFRyYW5zZmVyIGV0aGVyIG93ZWQgdG8gdGhlIGJlbmVmaWNpYXJ5IChub3Qgc3VzY2VwdGlibGUgdG8gcmUtZW50cnkKICAgICAgICAvLyBhdHRhY2ssIGFzIHRoZSBldGhlciBvd2VkIGlzIHNldCB0byAwIGJlZm9yZSB0aGUgdHJhbnNmZXIgdGFrZXMgcGxhY2UpLgogICAgICAgIGJlbmVmaWNpYXJ5LnRyYW5zZmVyKGV0aGVyT3dlZCk7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFdpdGhkcmF3ICh1bm93ZWQpIGNvbnRyYWN0IGJhbGFuY2UuCiAgICBmdW5jdGlvbiB3aXRoZHJhd0ZyZWVCYWxhbmNlKCkgZXh0ZXJuYWwgewogICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgZnJlZSAodW5vd2VkKSBiYWxhbmNlLiBUaGlzIG5ldmVyIHVuZGVyZmxvd3MsIGFzCiAgICAgICAgLy8gb3V0c3RhbmRpbmdFdGhlciBpcyBndWFyYW50ZWVkIHRvIGJlIGxlc3MgdGhhbiBvciBlcXVhbCB0byB0aGUKICAgICAgICAvLyBjb250cmFjdCBiYWxhbmNlLgogICAgICAgIHVpbnQyNTYgZnJlZUJhbGFuY2UgPSB0aGlzLmJhbGFuY2UgLSBvdXRzdGFuZGluZ0V0aGVyOwogICAgICAgIAogICAgICAgIGFkZHJlc3MgZGVlZENvbnRyYWN0QWRkcmVzcyA9IGFkZHJlc3MoZGVlZENvbnRyYWN0KTsKCiAgICAgICAgcmVxdWlyZSgKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBvd25lciB8fAogICAgICAgICAgICBtc2cuc2VuZGVyID09IGRlZWRDb250cmFjdEFkZHJlc3MKICAgICAgICApOwogICAgICAgIAogICAgICAgIGRlZWRDb250cmFjdEFkZHJlc3MudHJhbnNmZXIoZnJlZUJhbGFuY2UpOwogICAgfQp9CgoKLy8vIEBkZXYgRGVmaW5lcyBiYXNlIGRhdGEgc3RydWN0dXJlcyBmb3IgRFdvcmxkLgpjb250cmFjdCBPcmlnaW5hbERXb3JsZEJhc2UgaXMgRFdvcmxkQWNjZXNzQ29udHJvbCB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKICAgIAogICAgLy8vIEBkZXYgQWxsIG1pbnRlZCBwbG90cyAoYXJyYXkgb2YgcGxvdCBpZGVudGlmaWVycykuIFRoZXJlIGFyZQogICAgLy8vIDJeMTYgKiAyXjE2IHBvc3NpYmxlIHBsb3RzIChjb3ZlcmluZyB0aGUgZW50aXJlIHdvcmxkKSwgdGh1cwogICAgLy8vIDMyIGJpdHMgYXJlIHJlcXVpcmVkLiBUaGlzIGZpdHMgaW4gYSB1aW50MzIuIFN0b3JpbmcKICAgIC8vLyB0aGUgaWRlbnRpZmllcnMgYXMgdWludDMyIGluc3RlYWQgb2YgdWludDI1NiBtYWtlcyBzdG9yYWdlCiAgICAvLy8gY2hlYXBlci4gKFRoZSBpbXBhY3Qgb2YgdGhpcyBpbiBtYXBwaW5ncyBpcyBsZXNzIG5vdGljZWFibGUsCiAgICAvLy8gYW5kIHVzaW5nIHVpbnQzMiBpbiB0aGUgbWFwcGluZ3MgYmVsb3cgYWN0dWFsbHkgKmluY3JlYXNlcyoKICAgIC8vLyBnYXMgY29zdCBmb3IgbWludGluZykuCiAgICB1aW50MzJbXSBwdWJsaWMgcGxvdHM7CiAgICAKICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gYWRkcmVzcykgaWRlbnRpZmllclRvT3duZXI7CiAgICBtYXBwaW5nICh1aW50MjU2ID0+IGFkZHJlc3MpIGlkZW50aWZpZXJUb0FwcHJvdmVkOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBvd25lcnNoaXBEZWVkQ291bnQ7CiAgICAKICAgIC8vLyBAZGV2IEV2ZW50IGZpcmVkIHdoZW4gYSBwbG90J3MgZGF0YSBhcmUgY2hhbmdlZC4gVGhlIHBsb3QKICAgIC8vLyBkYXRhIGFyZSBub3Qgc3RvcmVkIGluIHRoZSBjb250cmFjdCBkaXJlY3RseSwgaW5zdGVhZCB0aGUKICAgIC8vLyBkYXRhIGFyZSBsb2dnZWQgdG8gdGhlIGJsb2NrLiBUaGlzIGdpdmVzIHNpZ25pZmljYW50CiAgICAvLy8gcmVkdWN0aW9ucyBpbiBnYXMgcmVxdWlyZW1lbnRzICh+NzVrIGZvciBtaW50aW5nIHdpdGggZGF0YQogICAgLy8vIGluc3RlYWQgb2YgfjE4MGspLiBIb3dldmVyLCBpdCBhbHNvIG1lYW5zIHBsb3QgZGF0YSBhcmUKICAgIC8vLyBub3QgYXZhaWxhYmxlIGZyb20gKndpdGhpbiogb3RoZXIgY29udHJhY3RzLgogICAgZXZlbnQgU2V0RGF0YSh1aW50MjU2IGluZGV4ZWQgZGVlZElkLCBzdHJpbmcgbmFtZSwgc3RyaW5nIGRlc2NyaXB0aW9uLCBzdHJpbmcgaW1hZ2VVcmwsIHN0cmluZyBpbmZvVXJsKTsKICAgIAogICAgLy8vIEBub3RpY2UgR2V0IGFsbCBtaW50ZWQgcGxvdHMuCiAgICBmdW5jdGlvbiBnZXRBbGxQbG90cygpIGV4dGVybmFsIHZpZXcgcmV0dXJucyh1aW50MzJbXSkgewogICAgICAgIHJldHVybiBwbG90czsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgUmVwcmVzZW50IGEgMkQgY29vcmRpbmF0ZSBhcyBhIHNpbmdsZSB1aW50LgogICAgLy8vIEBwYXJhbSB4IFRoZSB4LWNvb3JkaW5hdGUuCiAgICAvLy8gQHBhcmFtIHkgVGhlIHktY29vcmRpbmF0ZS4KICAgIGZ1bmN0aW9uIGNvb3JkaW5hdGVUb0lkZW50aWZpZXIodWludDI1NiB4LCB1aW50MjU2IHkpIHB1YmxpYyBwdXJlIHJldHVybnModWludDI1NikgewogICAgICAgIHJlcXVpcmUodmFsaWRDb29yZGluYXRlKHgsIHkpKTsKICAgICAgICAKICAgICAgICByZXR1cm4gKHkgPDwgMTYpICsgeDsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgVHVybiBhIHNpbmdsZSB1aW50IHJlcHJlc2VudGF0aW9uIG9mIGEgY29vcmRpbmF0ZSBpbnRvIGl0cyB4IGFuZCB5IHBhcnRzLgogICAgLy8vIEBwYXJhbSBpZGVudGlmaWVyIFRoZSB1aW50IHJlcHJlc2VudGF0aW9uIG9mIGEgY29vcmRpbmF0ZS4KICAgIGZ1bmN0aW9uIGlkZW50aWZpZXJUb0Nvb3JkaW5hdGUodWludDI1NiBpZGVudGlmaWVyKSBwdWJsaWMgcHVyZSByZXR1cm5zKHVpbnQyNTYgeCwgdWludDI1NiB5KSB7CiAgICAgICAgcmVxdWlyZSh2YWxpZElkZW50aWZpZXIoaWRlbnRpZmllcikpOwogICAgCiAgICAgICAgeSA9IGlkZW50aWZpZXIgPj4gMTY7CiAgICAgICAgeCA9IGlkZW50aWZpZXIgLSAoeSA8PCAxNik7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IFRlc3Qgd2hldGhlciB0aGUgY29vcmRpbmF0ZSBpcyB2YWxpZC4KICAgIC8vLyBAcGFyYW0geCBUaGUgeC1wYXJ0IG9mIHRoZSBjb29yZGluYXRlIHRvIHRlc3QuCiAgICAvLy8gQHBhcmFtIHkgVGhlIHktcGFydCBvZiB0aGUgY29vcmRpbmF0ZSB0byB0ZXN0LgogICAgZnVuY3Rpb24gdmFsaWRDb29yZGluYXRlKHVpbnQyNTYgeCwgdWludDI1NiB5KSBwdWJsaWMgcHVyZSByZXR1cm5zKGJvb2wpIHsKICAgICAgICByZXR1cm4geCA8IDY1NTM2ICYmIHkgPCA2NTUzNjsgLy8gMl4xNgogICAgfQogICAgCiAgICAvLy8gQGRldiBUZXN0IHdoZXRoZXIgYW4gaWRlbnRpZmllciBpcyB2YWxpZC4KICAgIC8vLyBAcGFyYW0gaWRlbnRpZmllciBUaGUgaWRlbnRpZmllciB0byB0ZXN0LgogICAgZnVuY3Rpb24gdmFsaWRJZGVudGlmaWVyKHVpbnQyNTYgaWRlbnRpZmllcikgcHVibGljIHB1cmUgcmV0dXJucyhib29sKSB7CiAgICAgICAgcmV0dXJuIGlkZW50aWZpZXIgPCA0Mjk0OTY3Mjk2OyAvLyAyXjE2ICogMl4xNgogICAgfQogICAgCiAgICAvLy8gQGRldiBTZXQgYSBwbG90J3MgZGF0YS4KICAgIC8vLyBAcGFyYW0gaWRlbnRpZmllciBUaGUgaWRlbnRpZmllciBvZiB0aGUgcGxvdCB0byBzZXQgZGF0YSBmb3IuCiAgICBmdW5jdGlvbiBfc2V0UGxvdERhdGEodWludDI1NiBpZGVudGlmaWVyLCBzdHJpbmcgbmFtZSwgc3RyaW5nIGRlc2NyaXB0aW9uLCBzdHJpbmcgaW1hZ2VVcmwsIHN0cmluZyBpbmZvVXJsKSBpbnRlcm5hbCB7CiAgICAgICAgU2V0RGF0YShpZGVudGlmaWVyLCBuYW1lLCBkZXNjcmlwdGlvbiwgaW1hZ2VVcmwsIGluZm9VcmwpOwogICAgfQp9CgoKLy8vIEBkZXYgSG9sZHMgZGVlZCBmdW5jdGlvbmFsaXR5IHN1Y2ggYXMgYXBwcm92aW5nIGFuZCB0cmFuc2ZlcnJpbmcuIEltcGxlbWVudHMgRVJDNzIxLgpjb250cmFjdCBPcmlnaW5hbERXb3JsZERlZWQgaXMgT3JpZ2luYWxEV29ybGRCYXNlLCBFUkM3MjEsIEVSQzcyMU1ldGFkYXRhIHsKICAgIAogICAgLy8vIEBub3RpY2UgTmFtZSBvZiB0aGUgY29sbGVjdGlvbiBvZiBkZWVkcyAobm9uLWZ1bmdpYmxlIHRva2VuKSwgYXMgZGVmaW5lZCBpbiBFUkM3MjFNZXRhZGF0YS4KICAgIGZ1bmN0aW9uIG5hbWUoKSBwdWJsaWMgcHVyZSByZXR1cm5zIChzdHJpbmcgX2RlZWROYW1lKSB7CiAgICAgICAgX2RlZWROYW1lID0gIkRXb3JsZCBQbG90cyI7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFN5bWJvbCBvZiB0aGUgY29sbGVjdGlvbiBvZiBkZWVkcyAobm9uLWZ1bmdpYmxlIHRva2VuKSwgYXMgZGVmaW5lZCBpbiBFUkM3MjFNZXRhZGF0YS4KICAgIGZ1bmN0aW9uIHN5bWJvbCgpIHB1YmxpYyBwdXJlIHJldHVybnMgKHN0cmluZyBfZGVlZFN5bWJvbCkgewogICAgICAgIF9kZWVkU3ltYm9sID0gIkRXUCI7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IEVSQy0xNjUgKGRyYWZ0KSBpbnRlcmZhY2Ugc2lnbmF0dXJlIGZvciBpdHNlbGYKICAgIGJ5dGVzNCBpbnRlcm5hbCBjb25zdGFudCBJTlRFUkZBQ0VfU0lHTkFUVVJFX0VSQzE2NSA9IC8vIDB4MDFmZmM5YTcKICAgICAgICBieXRlczQoa2VjY2FrMjU2KCdzdXBwb3J0c0ludGVyZmFjZShieXRlczQpJykpOwoKICAgIC8vLyBAZGV2IEVSQy0xNjUgKGRyYWZ0KSBpbnRlcmZhY2Ugc2lnbmF0dXJlIGZvciBFUkM3MjEKICAgIGJ5dGVzNCBpbnRlcm5hbCBjb25zdGFudCBJTlRFUkZBQ0VfU0lHTkFUVVJFX0VSQzcyMSA9IC8vIDB4ZGE2NzFiOWIKICAgICAgICBieXRlczQoa2VjY2FrMjU2KCdvd25lck9mKHVpbnQyNTYpJykpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCdjb3VudE9mRGVlZHMoKScpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NignY291bnRPZkRlZWRzQnlPd25lcihhZGRyZXNzKScpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NignZGVlZE9mT3duZXJCeUluZGV4KGFkZHJlc3MsdWludDI1NiknKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ2FwcHJvdmUoYWRkcmVzcyx1aW50MjU2KScpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NigndGFrZU93bmVyc2hpcCh1aW50MjU2KScpKTsKICAgICAgICAKICAgIC8vLyBAZGV2IEVSQy0xNjUgKGRyYWZ0KSBpbnRlcmZhY2Ugc2lnbmF0dXJlIGZvciBFUkM3MjEKICAgIGJ5dGVzNCBpbnRlcm5hbCBjb25zdGFudCBJTlRFUkZBQ0VfU0lHTkFUVVJFX0VSQzcyMU1ldGFkYXRhID0gLy8gMHgyYTc4NmYxMQogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ25hbWUoKScpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1Nignc3ltYm9sKCknKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ2RlZWRVcmkodWludDI1NiknKSk7CiAgICAKICAgIC8vLyBAbm90aWNlIEludHJvc3BlY3Rpb24gaW50ZXJmYWNlIGFzIHBlciBFUkMtMTY1IChodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTY1KS4KICAgIC8vLyBSZXR1cm5zIHRydWUgZm9yIGFueSBzdGFuZGFyZGl6ZWQgaW50ZXJmYWNlcyBpbXBsZW1lbnRlZCBieSB0aGlzIGNvbnRyYWN0LgogICAgLy8vIChFUkMtMTY1IGFuZCBFUkMtNzIxLikKICAgIGZ1bmN0aW9uIHN1cHBvcnRzSW50ZXJmYWNlKGJ5dGVzNCBfaW50ZXJmYWNlSUQpIGV4dGVybmFsIHB1cmUgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAoCiAgICAgICAgICAgIChfaW50ZXJmYWNlSUQgPT0gSU5URVJGQUNFX1NJR05BVFVSRV9FUkMxNjUpCiAgICAgICAgICAgIHx8IChfaW50ZXJmYWNlSUQgPT0gSU5URVJGQUNFX1NJR05BVFVSRV9FUkM3MjEpCiAgICAgICAgICAgIHx8IChfaW50ZXJmYWNlSUQgPT0gSU5URVJGQUNFX1NJR05BVFVSRV9FUkM3MjFNZXRhZGF0YSkKICAgICAgICApOwogICAgfQogICAgCiAgICAvLy8gQGRldiBDaGVja3MgaWYgYSBnaXZlbiBhZGRyZXNzIG93bnMgYSBwYXJ0aWN1bGFyIHBsb3QuCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgb3duZXIgdG8gY2hlY2sgZm9yLgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBwbG90IGlkZW50aWZpZXIgdG8gY2hlY2sgZm9yLgogICAgZnVuY3Rpb24gX293bnMoYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX2RlZWRJZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGlkZW50aWZpZXJUb093bmVyW19kZWVkSWRdID09IF9vd25lcjsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgQXBwcm92ZSBhIGdpdmVuIGFkZHJlc3MgdG8gdGFrZSBvd25lcnNoaXAgb2YgYSBkZWVkLgogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBhcHByb3ZpbmcgdGFraW5nIG93bmVyc2hpcC4KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIGFwcHJvdmUgdGFraW5nIG93bmVyc2hpcC4KICAgIC8vLyBAcGFyYW0gX2RlZWRJZCBUaGUgaWRlbnRpZmllciBvZiB0aGUgZGVlZCB0byBnaXZlIGFwcHJvdmFsIGZvci4KICAgIGZ1bmN0aW9uIF9hcHByb3ZlKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF9kZWVkSWQpIGludGVybmFsIHsKICAgICAgICBpZGVudGlmaWVyVG9BcHByb3ZlZFtfZGVlZElkXSA9IF90bzsKICAgICAgICAKICAgICAgICAvLyBFbWl0IGV2ZW50LgogICAgICAgIEFwcHJvdmFsKF9mcm9tLCBfdG8sIF9kZWVkSWQpOwogICAgfQogICAgCiAgICAvLy8gQGRldiBDaGVja3MgaWYgYSBnaXZlbiBhZGRyZXNzIGhhcyBhcHByb3ZhbCB0byB0YWtlIG93bmVyc2hpcCBvZiBhIGRlZWQuCiAgICAvLy8gQHBhcmFtIF9jbGFpbWFudCBUaGUgYWRkcmVzcyBvZiB0aGUgY2xhaW1hbnQgdG8gY2hlY2sgZm9yLgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBkZWVkIHRvIGNoZWNrIGZvci4KICAgIGZ1bmN0aW9uIF9hcHByb3ZlZEZvcihhZGRyZXNzIF9jbGFpbWFudCwgdWludDI1NiBfZGVlZElkKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gaWRlbnRpZmllclRvQXBwcm92ZWRbX2RlZWRJZF0gPT0gX2NsYWltYW50OwogICAgfQogICAgCiAgICAvLy8gQGRldiBBc3NpZ25zIG93bmVyc2hpcCBvZiBhIHNwZWNpZmljIGRlZWQgdG8gYW4gYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdGhlIGRlZWQgZnJvbS4KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRoZSBkZWVkIHRvLgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBkZWVkIHRvIHRyYW5zZmVyLgogICAgZnVuY3Rpb24gX3RyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF9kZWVkSWQpIGludGVybmFsIHsKICAgICAgICAvLyBUaGUgbnVtYmVyIG9mIHBsb3RzIGlzIGNhcHBlZCBhdCAyXjE2ICogMl4xNiwgc28gdGhpcyBjYW5ub3QKICAgICAgICAvLyBiZSBvdmVyZmxvd2VkLgogICAgICAgIG93bmVyc2hpcERlZWRDb3VudFtfdG9dKys7CiAgICAgICAgCiAgICAgICAgLy8gVHJhbnNmZXIgb3duZXJzaGlwLgogICAgICAgIGlkZW50aWZpZXJUb093bmVyW19kZWVkSWRdID0gX3RvOwogICAgICAgIAogICAgICAgIC8vIFdoZW4gYSBuZXcgZGVlZCBpcyBtaW50ZWQsIHRoZSBfZnJvbSBhZGRyZXNzIGlzIDB4MCwgYnV0IHdlCiAgICAgICAgLy8gZG8gbm90IHRyYWNrIGRlZWQgb3duZXJzaGlwIG9mIDB4MC4KICAgICAgICBpZiAoX2Zyb20gIT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICBvd25lcnNoaXBEZWVkQ291bnRbX2Zyb21dLS07CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBDbGVhciB0YWtpbmcgb3duZXJzaGlwIGFwcHJvdmFsLgogICAgICAgICAgICBkZWxldGUgaWRlbnRpZmllclRvQXBwcm92ZWRbX2RlZWRJZF07CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIEVtaXQgdGhlIHRyYW5zZmVyIGV2ZW50LgogICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF9kZWVkSWQpOwogICAgfQogICAgCiAgICAvLyBFUkMgNzIxIGltcGxlbWVudGF0aW9uCiAgICAKICAgIC8vLyBAbm90aWNlIFJldHVybnMgdGhlIHRvdGFsIG51bWJlciBvZiBkZWVkcyBjdXJyZW50bHkgaW4gZXhpc3RlbmNlLgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIGZ1bmN0aW9uIGNvdW50T2ZEZWVkcygpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gcGxvdHMubGVuZ3RoOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIHRoZSBudW1iZXIgb2YgZGVlZHMgb3duZWQgYnkgYSBzcGVjaWZpYyBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIG93bmVyIGFkZHJlc3MgdG8gY2hlY2suCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlCiAgICBmdW5jdGlvbiBjb3VudE9mRGVlZHNCeU93bmVyKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIG93bmVyc2hpcERlZWRDb3VudFtfb3duZXJdOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIHRoZSBhZGRyZXNzIGN1cnJlbnRseSBhc3NpZ25lZCBvd25lcnNoaXAgb2YgYSBnaXZlbiBkZWVkLgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIGZ1bmN0aW9uIG93bmVyT2YodWludDI1NiBfZGVlZElkKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGFkZHJlc3MgX293bmVyKSB7CiAgICAgICAgX293bmVyID0gaWRlbnRpZmllclRvT3duZXJbX2RlZWRJZF07CgogICAgICAgIHJlcXVpcmUoX293bmVyICE9IGFkZHJlc3MoMCkpOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBBcHByb3ZlIGEgZ2l2ZW4gYWRkcmVzcyB0byB0YWtlIG93bmVyc2hpcCBvZiBhIGRlZWQuCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0byBhcHByb3ZlIHRha2luZyBvd2VybnNoaXAuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWQgVGhlIGlkZW50aWZpZXIgb2YgdGhlIGRlZWQgdG8gZ2l2ZSBhcHByb3ZhbCBmb3IuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF90bywgdWludDI1NiBfZGVlZElkKSBleHRlcm5hbCB3aGVuTm90UGF1c2VkIHsKICAgICAgICB1aW50MjU2W10gbWVtb3J5IF9kZWVkSWRzID0gbmV3IHVpbnQyNTZbXSgxKTsKICAgICAgICBfZGVlZElkc1swXSA9IF9kZWVkSWQ7CiAgICAgICAgCiAgICAgICAgYXBwcm92ZU11bHRpcGxlKF90bywgX2RlZWRJZHMpOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBBcHByb3ZlIGEgZ2l2ZW4gYWRkcmVzcyB0byB0YWtlIG93bmVyc2hpcCBvZiBtdWx0aXBsZSBkZWVkcy4KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIGFwcHJvdmUgdGFraW5nIG93bmVyc2hpcC4KICAgIC8vLyBAcGFyYW0gX2RlZWRJZHMgVGhlIGlkZW50aWZpZXJzIG9mIHRoZSBkZWVkcyB0byBnaXZlIGFwcHJvdmFsIGZvci4KICAgIGZ1bmN0aW9uIGFwcHJvdmVNdWx0aXBsZShhZGRyZXNzIF90bywgdWludDI1NltdIF9kZWVkSWRzKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgLy8gRW5zdXJlIHRoZSBzZW5kZXIgaXMgbm90IGFwcHJvdmluZyB0aGVtc2VsdmVzLgogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciAhPSBfdG8pOwogICAgCiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgX2RlZWRJZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdWludDI1NiBfZGVlZElkID0gX2RlZWRJZHNbaV07CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBSZXF1aXJlIHRoZSBzZW5kZXIgaXMgdGhlIG93bmVyIG9mIHRoZSBkZWVkLgogICAgICAgICAgICByZXF1aXJlKF9vd25zKG1zZy5zZW5kZXIsIF9kZWVkSWQpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFBlcmZvcm0gdGhlIGFwcHJvdmFsLgogICAgICAgICAgICBfYXBwcm92ZShtc2cuc2VuZGVyLCBfdG8sIF9kZWVkSWQpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgVHJhbnNmZXIgYSBkZWVkIHRvIGFub3RoZXIgYWRkcmVzcy4gSWYgdHJhbnNmZXJyaW5nIHRvIGEgc21hcnQKICAgIC8vLyBjb250cmFjdCBiZSBWRVJZIENBUkVGVUwgdG8gZW5zdXJlIHRoYXQgaXQgaXMgYXdhcmUgb2YgRVJDLTcyMSwgb3IgeW91cgogICAgLy8vIGRlZWQgbWF5IGJlIGxvc3QgZm9yZXZlci4KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQsIGNhbiBiZSBhIHVzZXIgb3IgY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWQgVGhlIGlkZW50aWZpZXIgb2YgdGhlIGRlZWQgdG8gdHJhbnNmZXIuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2RlZWRJZCkgZXh0ZXJuYWwgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgdWludDI1NltdIG1lbW9yeSBfZGVlZElkcyA9IG5ldyB1aW50MjU2W10oMSk7CiAgICAgICAgX2RlZWRJZHNbMF0gPSBfZGVlZElkOwogICAgICAgIAogICAgICAgIHRyYW5zZmVyTXVsdGlwbGUoX3RvLCBfZGVlZElkcyk7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFRyYW5zZmVycyBtdWx0aXBsZSBkZWVkcyB0byBhbm90aGVyIGFkZHJlc3MuIElmIHRyYW5zZmVycmluZyB0bwogICAgLy8vIGEgc21hcnQgY29udHJhY3QgYmUgVkVSWSBDQVJFRlVMIHRvIGVuc3VyZSB0aGF0IGl0IGlzIGF3YXJlIG9mIEVSQy03MjEsCiAgICAvLy8gb3IgeW91ciBkZWVkcyBtYXkgYmUgbG9zdCBmb3JldmVyLgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudCwgY2FuIGJlIGEgdXNlciBvciBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX2RlZWRJZHMgVGhlIGlkZW50aWZpZXJzIG9mIHRoZSBkZWVkcyB0byB0cmFuc2Zlci4KICAgIGZ1bmN0aW9uIHRyYW5zZmVyTXVsdGlwbGUoYWRkcmVzcyBfdG8sIHVpbnQyNTZbXSBfZGVlZElkcykgcHVibGljIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIC8vIFNhZmV0eSBjaGVjayB0byBwcmV2ZW50IGFnYWluc3QgYW4gdW5leHBlY3RlZCAweDAgZGVmYXVsdC4KICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgICAgICAKICAgICAgICAvLyBEaXNhbGxvdyB0cmFuc2ZlcnMgdG8gdGhpcyBjb250cmFjdCB0byBwcmV2ZW50IGFjY2lkZW50YWwgbWlzdXNlLgogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3ModGhpcykpOwogICAgCiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgX2RlZWRJZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdWludDI1NiBfZGVlZElkID0gX2RlZWRJZHNbaV07CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBPbmUgY2FuIG9ubHkgdHJhbnNmZXIgdGhlaXIgb3duIHBsb3RzLgogICAgICAgICAgICByZXF1aXJlKF9vd25zKG1zZy5zZW5kZXIsIF9kZWVkSWQpKTsKCiAgICAgICAgICAgIC8vIFRyYW5zZmVyIG93bmVyc2hpcAogICAgICAgICAgICBfdHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfZGVlZElkKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFRyYW5zZmVyIGEgZGVlZCBvd25lZCBieSBhbm90aGVyIGFkZHJlc3MsIGZvciB3aGljaCB0aGUgY2FsbGluZwogICAgLy8vIGFkZHJlc3MgaGFzIHByZXZpb3VzbHkgYmVlbiBncmFudGVkIHRyYW5zZmVyIGFwcHJvdmFsIGJ5IHRoZSBvd25lci4KICAgIC8vLyBAcGFyYW0gX2RlZWRJZCBUaGUgaWRlbnRpZmllciBvZiB0aGUgZGVlZCB0byBiZSB0cmFuc2ZlcnJlZC4KICAgIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UuCiAgICBmdW5jdGlvbiB0YWtlT3duZXJzaGlwKHVpbnQyNTYgX2RlZWRJZCkgZXh0ZXJuYWwgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgdWludDI1NltdIG1lbW9yeSBfZGVlZElkcyA9IG5ldyB1aW50MjU2W10oMSk7CiAgICAgICAgX2RlZWRJZHNbMF0gPSBfZGVlZElkOwogICAgICAgIAogICAgICAgIHRha2VPd25lcnNoaXBNdWx0aXBsZShfZGVlZElkcyk7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFRyYW5zZmVyIG11bHRpcGxlIGRlZWRzIG93bmVkIGJ5IGFub3RoZXIgYWRkcmVzcywgZm9yIHdoaWNoIHRoZQogICAgLy8vIGNhbGxpbmcgYWRkcmVzcyBoYXMgcHJldmlvdXNseSBiZWVuIGdyYW50ZWQgdHJhbnNmZXIgYXBwcm92YWwgYnkgdGhlIG93bmVyLgogICAgLy8vIEBwYXJhbSBfZGVlZElkcyBUaGUgaWRlbnRpZmllciBvZiB0aGUgZGVlZCB0byBiZSB0cmFuc2ZlcnJlZC4KICAgIGZ1bmN0aW9uIHRha2VPd25lcnNoaXBNdWx0aXBsZSh1aW50MjU2W10gX2RlZWRJZHMpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHsKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBfZGVlZElkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB1aW50MjU2IF9kZWVkSWQgPSBfZGVlZElkc1tpXTsKICAgICAgICAgICAgYWRkcmVzcyBfZnJvbSA9IGlkZW50aWZpZXJUb093bmVyW19kZWVkSWRdOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQ2hlY2sgZm9yIHRyYW5zZmVyIGFwcHJvdmFsCiAgICAgICAgICAgIHJlcXVpcmUoX2FwcHJvdmVkRm9yKG1zZy5zZW5kZXIsIF9kZWVkSWQpKTsKCiAgICAgICAgICAgIC8vIFJlYXNzaWduIG93bmVyc2hpcCAoYWxzbyBjbGVhcnMgcGVuZGluZyBhcHByb3ZhbHMgYW5kIGVtaXRzIFRyYW5zZmVyIGV2ZW50KS4KICAgICAgICAgICAgX3RyYW5zZmVyKF9mcm9tLCBtc2cuc2VuZGVyLCBfZGVlZElkKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFJldHVybnMgYSBsaXN0IG9mIGFsbCBkZWVkIGlkZW50aWZpZXJzIGFzc2lnbmVkIHRvIGFuIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgb3duZXIgd2hvc2UgZGVlZHMgd2UgYXJlIGludGVyZXN0ZWQgaW4uCiAgICAvLy8gQGRldiBUaGlzIG1ldGhvZCBNVVNUIE5FVkVSIGJlIGNhbGxlZCBieSBzbWFydCBjb250cmFjdCBjb2RlLiBJdCdzIHZlcnkKICAgIC8vLyBleHBlbnNpdmUgYW5kIGlzIG5vdCBzdXBwb3J0ZWQgaW4gY29udHJhY3QtdG8tY29udHJhY3QgY2FsbHMgYXMgaXQgcmV0dXJucwogICAgLy8vIGEgZHluYW1pYyBhcnJheSAob25seSBzdXBwb3J0ZWQgZm9yIHdlYjMgY2FsbHMpLgogICAgZnVuY3Rpb24gZGVlZHNPZk93bmVyKGFkZHJlc3MgX293bmVyKSBleHRlcm5hbCB2aWV3IHJldHVybnModWludDI1NltdKSB7CiAgICAgICAgdWludDI1NiBkZWVkQ291bnQgPSBjb3VudE9mRGVlZHNCeU93bmVyKF9vd25lcik7CgogICAgICAgIGlmIChkZWVkQ291bnQgPT0gMCkgewogICAgICAgICAgICAvLyBSZXR1cm4gYW4gZW1wdHkgYXJyYXkuCiAgICAgICAgICAgIHJldHVybiBuZXcgdWludDI1NltdKDApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHVpbnQyNTZbXSBtZW1vcnkgcmVzdWx0ID0gbmV3IHVpbnQyNTZbXShkZWVkQ291bnQpOwogICAgICAgICAgICB1aW50MjU2IHRvdGFsRGVlZHMgPSBjb3VudE9mRGVlZHMoKTsKICAgICAgICAgICAgdWludDI1NiByZXN1bHRJbmRleCA9IDA7CiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IgKHVpbnQyNTYgZGVlZE51bWJlciA9IDA7IGRlZWROdW1iZXIgPCB0b3RhbERlZWRzOyBkZWVkTnVtYmVyKyspIHsKICAgICAgICAgICAgICAgIHVpbnQyNTYgaWRlbnRpZmllciA9IHBsb3RzW2RlZWROdW1iZXJdOwogICAgICAgICAgICAgICAgaWYgKGlkZW50aWZpZXJUb093bmVyW2lkZW50aWZpZXJdID09IF9vd25lcikgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdFtyZXN1bHRJbmRleF0gPSBpZGVudGlmaWVyOwogICAgICAgICAgICAgICAgICAgIHJlc3VsdEluZGV4Kys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIGEgZGVlZCBpZGVudGlmaWVyIG9mIHRoZSBvd25lciBhdCB0aGUgZ2l2ZW4gaW5kZXguCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgb3duZXIgd2Ugd2FudCB0byBnZXQgYSBkZWVkIGZvci4KICAgIC8vLyBAcGFyYW0gX2luZGV4IFRoZSBpbmRleCBvZiB0aGUgZGVlZCB3ZSB3YW50LgogICAgZnVuY3Rpb24gZGVlZE9mT3duZXJCeUluZGV4KGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF9pbmRleCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgLy8gVGhlIGluZGV4IHNob3VsZCBiZSB2YWxpZC4KICAgICAgICByZXF1aXJlKF9pbmRleCA8IGNvdW50T2ZEZWVkc0J5T3duZXIoX293bmVyKSk7CgogICAgICAgIC8vIExvb3AgdGhyb3VnaCBhbGwgcGxvdHMsIGFjY291bnRpbmcgdGhlIG51bWJlciBvZiBwbG90cyBvZiB0aGUgb3duZXIgd2UndmUgc2Vlbi4KICAgICAgICB1aW50MjU2IHNlZW4gPSAwOwogICAgICAgIHVpbnQyNTYgdG90YWxEZWVkcyA9IGNvdW50T2ZEZWVkcygpOwogICAgICAgIAogICAgICAgIGZvciAodWludDI1NiBkZWVkTnVtYmVyID0gMDsgZGVlZE51bWJlciA8IHRvdGFsRGVlZHM7IGRlZWROdW1iZXIrKykgewogICAgICAgICAgICB1aW50MjU2IGlkZW50aWZpZXIgPSBwbG90c1tkZWVkTnVtYmVyXTsKICAgICAgICAgICAgaWYgKGlkZW50aWZpZXJUb093bmVyW2lkZW50aWZpZXJdID09IF9vd25lcikgewogICAgICAgICAgICAgICAgaWYgKHNlZW4gPT0gX2luZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlkZW50aWZpZXI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNlZW4rKzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgUmV0dXJucyBhbiAob2ZmLWNoYWluKSBtZXRhZGF0YSB1cmwgZm9yIHRoZSBnaXZlbiBkZWVkLgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBkZWVkIHRvIGdldCB0aGUgbWV0YWRhdGEKICAgIC8vLyB1cmwgZm9yLgogICAgLy8vIEBkZXYgSW1wbGVtZW50YXRpb24gb2Ygb3B0aW9uYWwgRVJDLTcyMSBmdW5jdGlvbmFsaXR5LgogICAgZnVuY3Rpb24gZGVlZFVyaSh1aW50MjU2IF9kZWVkSWQpIGV4dGVybmFsIHB1cmUgcmV0dXJucyAoc3RyaW5nIHVyaSkgewogICAgICAgIHJlcXVpcmUodmFsaWRJZGVudGlmaWVyKF9kZWVkSWQpKTsKICAgIAogICAgICAgIHZhciAoeCwgeSkgPSBpZGVudGlmaWVyVG9Db29yZGluYXRlKF9kZWVkSWQpOwogICAgCiAgICAgICAgLy8gTWF4aW11bSBjb29yZGluYXRlIGxlbmd0aCBpbiBkZWNpbWFscyBpcyA1ICg2NTUzNSkKICAgICAgICB1cmkgPSAiaHR0cHM6Ly9kd29ybGQuaW8vcGxvdC94eHh4eC94eHh4eCI7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF91cmkgPSBieXRlcyh1cmkpOwogICAgICAgIAogICAgICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IDU7IGkrKykgewogICAgICAgICAgICBfdXJpWzI3IC0gaV0gPSBieXRlKDQ4ICsgKHggLyAxMCAqKiBpKSAlIDEwKTsKICAgICAgICAgICAgX3VyaVszMyAtIGldID0gYnl0ZSg0OCArICh5IC8gMTAgKiogaSkgJSAxMCk7CiAgICAgICAgfQogICAgfQp9CgoKLy8vIEBkZXYgTWlncmF0ZSBvcmlnaW5hbCBkYXRhIGZyb20gdGhlIG9sZCBjb250cmFjdC4KY29udHJhY3QgRFdvcmxkVXBncmFkZSBpcyBEV29ybGRNaW50aW5nIHsKICAgIE9yaWdpbmFsRFdvcmxkRGVlZCBvcmlnaW5hbENvbnRyYWN0OwogICAgQ2xvY2tBdWN0aW9uIG9yaWdpbmFsU2FsZUF1Y3Rpb247CiAgICBDbG9ja0F1Y3Rpb24gb3JpZ2luYWxSZW50QXVjdGlvbjsKICAgIAogICAgLy8vIEBub3RpY2UgS2VlcCB0cmFjayBvZiB3aGV0aGVyIHdlIGhhdmUgZmluaXNoZWQgbWlncmF0aW5nLgogICAgYm9vbCBwdWJsaWMgbWlncmF0aW9uRmluaXNoZWQgPSBmYWxzZTsKICAgIAogICAgLy8vIEBkZXYgS2VlcCB0cmFjayBvZiBob3cgbWFueSBwbG90cyBoYXZlIGJlZW4gdHJhbnNmZXJyZWQgc28gZmFyLgogICAgdWludDI1NiBtaWdyYXRpb25OdW1QbG90c1RyYW5zZmVycmVkID0gMDsKICAgIAogICAgZnVuY3Rpb24gRFdvcmxkVXBncmFkZSgKICAgICAgICBhZGRyZXNzIG9yaWdpbmFsQ29udHJhY3RBZGRyZXNzLAogICAgICAgIGFkZHJlc3Mgb3JpZ2luYWxTYWxlQXVjdGlvbkFkZHJlc3MsCiAgICAgICAgYWRkcmVzcyBvcmlnaW5hbFJlbnRBdWN0aW9uQWRkcmVzcwogICAgKQogICAgICAgIHB1YmxpYwogICAgewogICAgICAgIGlmIChvcmlnaW5hbENvbnRyYWN0QWRkcmVzcyAhPSAwKSB7CiAgICAgICAgICAgIF9zdGFydE1pZ3JhdGlvbihvcmlnaW5hbENvbnRyYWN0QWRkcmVzcywgb3JpZ2luYWxTYWxlQXVjdGlvbkFkZHJlc3MsIG9yaWdpbmFsUmVudEF1Y3Rpb25BZGRyZXNzKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBtaWdyYXRpb25GaW5pc2hlZCA9IHRydWU7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLy8gQGRldiBNaWdyYXRlIGRhdGEgZnJvbSB0aGUgb3JpZ2luYWwgY29udHJhY3QuIEFzc3VtZXMgdGhlIG9yaWdpbmFsCiAgICAvLy8gY29udHJhY3QgaXMgcGF1c2VkLCBhbmQgcmVtYWlucyBwYXVzZWQgZm9yIHRoZSBkdXJhdGlvbiBvZiB0aGUKICAgIC8vLyBtaWdyYXRpb24uCiAgICAvLy8gQHBhcmFtIG9yaWdpbmFsQ29udHJhY3RBZGRyZXNzIFRoZSBhZGRyZXNzIG9mIHRoZSBvcmlnaW5hbCBjb250cmFjdC4KICAgIGZ1bmN0aW9uIF9zdGFydE1pZ3JhdGlvbigKICAgICAgICBhZGRyZXNzIG9yaWdpbmFsQ29udHJhY3RBZGRyZXNzLAogICAgICAgIGFkZHJlc3Mgb3JpZ2luYWxTYWxlQXVjdGlvbkFkZHJlc3MsCiAgICAgICAgYWRkcmVzcyBvcmlnaW5hbFJlbnRBdWN0aW9uQWRkcmVzcwogICAgKQogICAgICAgIGludGVybmFsCiAgICB7CiAgICAgICAgLy8gU2V0IGNvbnRyYWN0cy4KICAgICAgICBvcmlnaW5hbENvbnRyYWN0ID0gT3JpZ2luYWxEV29ybGREZWVkKG9yaWdpbmFsQ29udHJhY3RBZGRyZXNzKTsKICAgICAgICBvcmlnaW5hbFNhbGVBdWN0aW9uID0gQ2xvY2tBdWN0aW9uKG9yaWdpbmFsU2FsZUF1Y3Rpb25BZGRyZXNzKTsKICAgICAgICBvcmlnaW5hbFJlbnRBdWN0aW9uID0gQ2xvY2tBdWN0aW9uKG9yaWdpbmFsUmVudEF1Y3Rpb25BZGRyZXNzKTsKICAgICAgICAKICAgICAgICAvLyBTdGFydCBwYXVzZWQuCiAgICAgICAgcGF1c2VkID0gdHJ1ZTsKICAgICAgICAKICAgICAgICAvLyBHZXQgY291bnQgb2Ygb3JpZ2luYWwgcGxvdHMuCiAgICAgICAgdWludDI1NiBudW1QbG90cyA9IG9yaWdpbmFsQ29udHJhY3QuY291bnRPZkRlZWRzKCk7CiAgICAgICAgCiAgICAgICAgLy8gQWxsb2NhdGUgc3RvcmFnZSBmb3IgdGhlIHBsb3RzIGFycmF5ICh0aGlzIGlzIG1vcmUKICAgICAgICAvLyBlZmZpY2llbnQgdGhhbiAucHVzaC1pbmcgZWFjaCBpbmRpdmlkdWFsIHBsb3QsIGFzCiAgICAgICAgLy8gdGhhdCByZXF1aXJlcyBtdWx0aXBsZSBkeW5hbWljIGFsbG9jYXRpb25zKS4KICAgICAgICBwbG90cy5sZW5ndGggPSBudW1QbG90czsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gbWlncmF0aW9uU3RlcCh1aW50MjU2IG51bVBsb3RzVHJhbnNmZXIpIGV4dGVybmFsIG9ubHlPd25lciB3aGVuUGF1c2VkIHsKICAgICAgICAvLyBNaWdyYXRpb24gbXVzdCBub3QgYmUgZmluaXNoZWQgeWV0LgogICAgICAgIHJlcXVpcmUoIW1pZ3JhdGlvbkZpbmlzaGVkKTsKICAgIAogICAgICAgIC8vIEdldCBjb3VudCBvZiBvcmlnaW5hbCBwbG90cy4KICAgICAgICB1aW50MjU2IG51bVBsb3RzID0gb3JpZ2luYWxDb250cmFjdC5jb3VudE9mRGVlZHMoKTsKICAgIAogICAgICAgIC8vIExvb3AgdGhyb3VnaCBwbG90cyBhbmQgYXNzaWduIHRvIG9yaWdpbmFsIG93bmVyLgogICAgICAgIHVpbnQyNTYgaTsKICAgICAgICBmb3IgKGkgPSBtaWdyYXRpb25OdW1QbG90c1RyYW5zZmVycmVkOyBpIDwgbnVtUGxvdHMgJiYgaSA8IG1pZ3JhdGlvbk51bVBsb3RzVHJhbnNmZXJyZWQgKyBudW1QbG90c1RyYW5zZmVyOyBpKyspIHsKICAgICAgICAgICAgdWludDMyIF9kZWVkSWQgPSBvcmlnaW5hbENvbnRyYWN0LnBsb3RzKGkpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU2V0IHBsb3QuCiAgICAgICAgICAgIHBsb3RzW2ldID0gX2RlZWRJZDsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEdldCB0aGUgb3JpZ2luYWwgb3duZXIgYW5kIHRyYW5zZmVyLgogICAgICAgICAgICBhZGRyZXNzIG93bmVyID0gb3JpZ2luYWxDb250cmFjdC5vd25lck9mKF9kZWVkSWQpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gSWYgdGhlIG93bmVyIG9mIHRoZSBwbG90IGlzIGFuIGF1Y3Rpb24gY29udHJhY3QsCiAgICAgICAgICAgIC8vIGdldCB0aGUgYWN0dWFsIG93bmVyIG9mIHRoZSBwbG90LgogICAgICAgICAgICBhZGRyZXNzIHNlbGxlcjsKICAgICAgICAgICAgaWYgKG93bmVyID09IGFkZHJlc3Mob3JpZ2luYWxTYWxlQXVjdGlvbikpIHsKICAgICAgICAgICAgICAgIChzZWxsZXIsICkgPSBvcmlnaW5hbFNhbGVBdWN0aW9uLmdldEF1Y3Rpb24oX2RlZWRJZCk7CiAgICAgICAgICAgICAgICBvd25lciA9IHNlbGxlcjsKICAgICAgICAgICAgfSBlbHNlIGlmIChvd25lciA9PSBhZGRyZXNzKG9yaWdpbmFsUmVudEF1Y3Rpb24pKSB7CiAgICAgICAgICAgICAgICAoc2VsbGVyLCApID0gb3JpZ2luYWxSZW50QXVjdGlvbi5nZXRBdWN0aW9uKF9kZWVkSWQpOwogICAgICAgICAgICAgICAgb3duZXIgPSBzZWxsZXI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIF90cmFuc2ZlcihhZGRyZXNzKDApLCBvd25lciwgX2RlZWRJZCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTZXQgdGhlIGluaXRpYWwgcHJpY2UgcGFpZCBmb3IgdGhlIHBsb3QuCiAgICAgICAgICAgIGluaXRpYWxQcmljZVBhaWRbX2RlZWRJZF0gPSAwLjAxMjUgZXRoZXI7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBUaGUgaW5pdGlhbCBidXlvdXQgcHJpY2UuCiAgICAgICAgICAgIHVpbnQyNTYgX2luaXRpYWxCdXlvdXRQcmljZSA9IDAuMDUwIGV0aGVyOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU2V0IHRoZSBpbml0aWFsIGJ1eW91dCBwcmljZS4KICAgICAgICAgICAgaWRlbnRpZmllclRvQnV5b3V0UHJpY2VbX2RlZWRJZF0gPSBfaW5pdGlhbEJ1eW91dFByaWNlOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gVHJpZ2dlciB0aGUgYnV5b3V0IHByaWNlIGV2ZW50LgogICAgICAgICAgICBTZXRCdXlvdXRQcmljZShfZGVlZElkLCBfaW5pdGlhbEJ1eW91dFByaWNlKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIE1hcmsgdGhlIHBsb3QgYXMgYmVpbmcgYW4gb3JpZ2luYWwuCiAgICAgICAgICAgIGlkZW50aWZpZXJJc09yaWdpbmFsW19kZWVkSWRdID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgbWlncmF0aW9uTnVtUGxvdHNUcmFuc2ZlcnJlZCArPSBpOwogICAgICAgIAogICAgICAgIC8vIEZpbmlzaGVkIG1pZ3JhdGlvbi4KICAgICAgICBpZiAoaSA9PSBudW1QbG90cykgewogICAgICAgICAgICBtaWdyYXRpb25GaW5pc2hlZCA9IHRydWU7CiAgICAgICAgfQogICAgfQp9CgoKLy8vIEBkZXYgSW1wbGVtZW50cyBoaWdoZXN0LWxldmVsIERXb3JsZCBmdW5jdGlvbmFsaXR5Lgpjb250cmFjdCBEV29ybGRDb3JlIGlzIERXb3JsZFVwZ3JhZGUgewogICAgLy8vIElmIHRoaXMgY29udHJhY3QgaXMgYnJva2VuLCB0aGlzIHdpbGwgYmUgdXNlZCB0byBwdWJsaXNoIHRoZSBhZGRyZXNzIGF0IHdoaWNoIGFuIHVwZ3JhZGVkIGNvbnRyYWN0IGNhbiBiZSBmb3VuZAogICAgYWRkcmVzcyBwdWJsaWMgdXBncmFkZWRDb250cmFjdEFkZHJlc3M7CiAgICBldmVudCBDb250cmFjdFVwZ3JhZGUoYWRkcmVzcyB1cGdyYWRlZENvbnRyYWN0QWRkcmVzcyk7CgogICAgZnVuY3Rpb24gRFdvcmxkQ29yZSgKICAgICAgICBhZGRyZXNzIG9yaWdpbmFsQ29udHJhY3RBZGRyZXNzLAogICAgICAgIGFkZHJlc3Mgb3JpZ2luYWxTYWxlQXVjdGlvbkFkZHJlc3MsCiAgICAgICAgYWRkcmVzcyBvcmlnaW5hbFJlbnRBdWN0aW9uQWRkcmVzcywKICAgICAgICB1aW50MjU2IGJ1eW91dHNFbmFibGVkQWZ0ZXJIb3VycwogICAgKQogICAgICAgIERXb3JsZFVwZ3JhZGUob3JpZ2luYWxDb250cmFjdEFkZHJlc3MsIG9yaWdpbmFsU2FsZUF1Y3Rpb25BZGRyZXNzLCBvcmlnaW5hbFJlbnRBdWN0aW9uQWRkcmVzcykKICAgICAgICBwdWJsaWMgCiAgICB7CiAgICAgICAgYnV5b3V0c0VuYWJsZWRGcm9tVGltZXN0YW1wID0gYmxvY2sudGltZXN0YW1wICsgYnV5b3V0c0VuYWJsZWRBZnRlckhvdXJzICogMzYwMDsKICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgT25seSB0byBiZSB1c2VkIHdoZW4gdGhpcyBjb250cmFjdCBpcyBzaWduaWZpY2FudGx5IGJyb2tlbiwKICAgIC8vLyBhbmQgYW4gdXBncmFkZSBpcyByZXF1aXJlZC4KICAgIGZ1bmN0aW9uIHNldFVwZ3JhZGVkQ29udHJhY3RBZGRyZXNzKGFkZHJlc3MgX3VwZ3JhZGVkQ29udHJhY3RBZGRyZXNzKSBleHRlcm5hbCBvbmx5T3duZXIgd2hlblBhdXNlZCB7CiAgICAgICAgdXBncmFkZWRDb250cmFjdEFkZHJlc3MgPSBfdXBncmFkZWRDb250cmFjdEFkZHJlc3M7CiAgICAgICAgQ29udHJhY3RVcGdyYWRlKF91cGdyYWRlZENvbnRyYWN0QWRkcmVzcyk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgU2V0IHRoZSBkYXRhIGFzc29jaWF0ZWQgd2l0aCBhIHBsb3QuCiAgICBmdW5jdGlvbiBzZXRQbG90RGF0YSh1aW50MjU2IF9kZWVkSWQsIHN0cmluZyBuYW1lLCBzdHJpbmcgZGVzY3JpcHRpb24sIHN0cmluZyBpbWFnZVVybCwgc3RyaW5nIGluZm9VcmwpCiAgICAgICAgcHVibGljCiAgICAgICAgd2hlbk5vdFBhdXNlZAogICAgewogICAgICAgIC8vIFRoZSBzZW5kZXIgcmVxdWVzdGluZyB0aGUgZGF0YSB1cGRhdGUgc2hvdWxkIGJlCiAgICAgICAgLy8gdGhlIG93bmVyLgogICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX2RlZWRJZCkpOwogICAgCiAgICAgICAgLy8gU2V0IHRoZSBkYXRhCiAgICAgICAgX3NldFBsb3REYXRhKF9kZWVkSWQsIG5hbWUsIGRlc2NyaXB0aW9uLCBpbWFnZVVybCwgaW5mb1VybCk7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFNldCB0aGUgZGF0YSBhc3NvY2lhdGVkIHdpdGggbXVsdGlwbGUgcGxvdHMuCiAgICBmdW5jdGlvbiBzZXRQbG90RGF0YU11bHRpcGxlKHVpbnQyNTZbXSBfZGVlZElkcywgc3RyaW5nIG5hbWUsIHN0cmluZyBkZXNjcmlwdGlvbiwgc3RyaW5nIGltYWdlVXJsLCBzdHJpbmcgaW5mb1VybCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHdoZW5Ob3RQYXVzZWQKICAgIHsKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBfZGVlZElkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB1aW50MjU2IF9kZWVkSWQgPSBfZGVlZElkc1tpXTsKICAgICAgICAKICAgICAgICAgICAgc2V0UGxvdERhdGEoX2RlZWRJZCwgbmFtZSwgZGVzY3JpcHRpb24sIGltYWdlVXJsLCBpbmZvVXJsKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFdpdGhkcmF3IEV0aGVyIG93ZWQgdG8gdGhlIHNlbmRlci4KICAgIGZ1bmN0aW9uIHdpdGhkcmF3QmFsYW5jZSgpIGV4dGVybmFsIHsKICAgICAgICB1aW50MjU2IGV0aGVyT3dlZCA9IGFkZHJlc3NUb0V0aGVyT3dlZFttc2cuc2VuZGVyXTsKICAgICAgICAKICAgICAgICAvLyBFbnN1cmUgRXRoZXIgaXMgb3dlZCB0byB0aGUgc2VuZGVyLgogICAgICAgIHJlcXVpcmUoZXRoZXJPd2VkID4gMCk7CiAgICAgICAgIAogICAgICAgIC8vIFNldCBFdGhlciBvd2VkIHRvIDAuCiAgICAgICAgZGVsZXRlIGFkZHJlc3NUb0V0aGVyT3dlZFttc2cuc2VuZGVyXTsKICAgICAgICAKICAgICAgICAvLyBTdWJ0cmFjdCBmcm9tIHRvdGFsIG91dHN0YW5kaW5nIGJhbGFuY2UuIGV0aGVyT3dlZCBpcyBndWFyYW50ZWVkCiAgICAgICAgLy8gdG8gYmUgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIG91dHN0YW5kaW5nRXRoZXIsIHNvIHRoaXMgY2Fubm90CiAgICAgICAgLy8gdW5kZXJmbG93LgogICAgICAgIG91dHN0YW5kaW5nRXRoZXIgLT0gZXRoZXJPd2VkOwogICAgICAgIAogICAgICAgIC8vIFRyYW5zZmVyIEV0aGVyIG93ZWQgdG8gdGhlIHNlbmRlciAobm90IHN1c2NlcHRpYmxlIHRvIHJlLWVudHJ5CiAgICAgICAgLy8gYXR0YWNrLCBhcyB0aGUgRXRoZXIgb3dlZCBpcyBzZXQgdG8gMCBiZWZvcmUgdGhlIHRyYW5zZmVyIHRha2VzIHBsYWNlKS4KICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGV0aGVyT3dlZCk7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFdpdGhkcmF3ICh1bm93ZWQpIGNvbnRyYWN0IGJhbGFuY2UuCiAgICBmdW5jdGlvbiB3aXRoZHJhd0ZyZWVCYWxhbmNlKCkgZXh0ZXJuYWwgb25seUNGTyB7CiAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSBmcmVlICh1bm93ZWQpIGJhbGFuY2UuIFRoaXMgbmV2ZXIgdW5kZXJmbG93cywgYXMKICAgICAgICAvLyBvdXRzdGFuZGluZ0V0aGVyIGlzIGd1YXJhbnRlZWQgdG8gYmUgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIHRoZQogICAgICAgIC8vIGNvbnRyYWN0IGJhbGFuY2UuCiAgICAgICAgdWludDI1NiBmcmVlQmFsYW5jZSA9IHRoaXMuYmFsYW5jZSAtIG91dHN0YW5kaW5nRXRoZXI7CiAgICAgICAgCiAgICAgICAgY2ZvQWRkcmVzcy50cmFuc2ZlcihmcmVlQmFsYW5jZSk7CiAgICB9Cn0='.
	

]
