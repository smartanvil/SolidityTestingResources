Class {
	#name : #SRTb110e378eA8B83DD52d1c5a810A5Dcf99bBC96ae,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTb110e378eA8B83DD52d1c5a810A5Dcf99bBC96ae >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4KICovCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKCiAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIHByZXZpb3VzT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBuZXdPd25lcik7CgoKICAvKioKICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgKiBhY2NvdW50LgogICAqLwogIGZ1bmN0aW9uIE93bmFibGUoKSB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KCgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOwogICAgb3duZXIgPSBuZXdPd25lcjsKICB9Cgp9CgovKioKICogQHRpdGxlIFBhdXNhYmxlT25jZQogKiBAZGV2IFRoZSBQYXVzYWJsZU9uY2UgY29udHJhY3QgcHJvdmlkZXMgYW4gb3B0aW9uIGZvciB0aGUgInBhdXNlTWFzdGVyIgogKiB0byBwYXVzZSBvbmNlIHRoZSB0cmFuc2FjdGlvbnMgZm9yIHR3byB3ZWVrcy4KICoKICovCgpjb250cmFjdCBQYXVzYWJsZU9uY2UgaXMgT3duYWJsZSB7CgogICAgLyoqIEFkZHJlc3MgdGhhdCBjYW4gc3RhcnQgdGhlIHBhdXNlICovCiAgICBhZGRyZXNzIHB1YmxpYyBwYXVzZU1hc3RlcjsKCiAgICB1aW50IGNvbnN0YW50IGludGVybmFsIFBBVVNFX0RVUkFUSU9OID0gMTQgZGF5czsKICAgIHVpbnQ2NCBwdWJsaWMgcGF1c2VFbmQgPSAwOwoKICAgIGV2ZW50IFBhdXNlZCgpOwoKICAgIC8qKgogICAgICogQGRldiBTZXQgdGhlIHBhdXNlTWFzdGVyIChjYWxsYWJsZSBieSB0aGUgb3duZXIgb25seSkuCiAgICAgKiBAcGFyYW0gX3BhdXNlTWFzdGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBwYXVzZU1hc3RlcgogICAgICovCiAgICBmdW5jdGlvbiBzZXRQYXVzZU1hc3RlcihhZGRyZXNzIF9wYXVzZU1hc3Rlcikgb25seU93bmVyIGV4dGVybmFsIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUoX3BhdXNlTWFzdGVyICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHBhdXNlTWFzdGVyID0gX3BhdXNlTWFzdGVyOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBTdGFydCB0aGUgcGF1c2UgKGJ5IHRoZSBwYXVzZU1hc3RlciwgT05DRSBvbmx5KS4KICAgICAqLwogICAgZnVuY3Rpb24gcGF1c2UoKSBvbmx5UGF1c2VNYXN0ZXIgZXh0ZXJuYWwgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmVxdWlyZShwYXVzZUVuZCA9PSAwKTsKICAgICAgICBwYXVzZUVuZCA9IHVpbnQ2NChub3cgKyBQQVVTRV9EVVJBVElPTik7CiAgICAgICAgUGF1c2VkKCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIG5vdCBwYXVzZWQuCiAgICAgKi8KICAgIG1vZGlmaWVyIHdoZW5Ob3RQYXVzZWQoKSB7CiAgICAgICAgcmVxdWlyZShub3cgPiBwYXVzZUVuZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBwYXVzZU1hc3Rlci4KICAgICAqLwogICAgbW9kaWZpZXIgb25seVBhdXNlTWFzdGVyKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBwYXVzZU1hc3Rlcik7CiAgICAgICAgXzsKICAgIH0KCn0KCi8qKgogKiBAdGl0bGUgRVJDMjBCYXNpYwogKiBAZGV2IFNpbXBsZXIgdmVyc2lvbiBvZiBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE3OQogKi8KY29udHJhY3QgRVJDMjBCYXNpYyB7CiAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwp9CgovKioKICogQHRpdGxlIEJhc2ljIHRva2VuCiAqIEBkZXYgQmFzaWMgdmVyc2lvbiBvZiBTdGFuZGFyZFRva2VuLCB3aXRoIG5vIGFsbG93YW5jZXMuCiAqLwpjb250cmFjdCBCYXNpY1Rva2VuIGlzIEVSQzIwQmFzaWMgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CgogIC8qKgogICogQGRldiB0cmFuc2ZlciB0b2tlbiBmb3IgYSBzcGVjaWZpZWQgYWRkcmVzcwogICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0by4KICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCB0byBiZSB0cmFuc2ZlcnJlZC4KICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwoKICAgIC8vIFNhZmVNYXRoLnN1YiB3aWxsIHRocm93IGlmIHRoZXJlIGlzIG5vdCBlbm91Z2ggYmFsYW5jZS4KICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgKiBAZGV2IEdldHMgdGhlIGJhbGFuY2Ugb2YgdGhlIHNwZWNpZmllZCBhZGRyZXNzLgogICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0byBxdWVyeSB0aGUgdGhlIGJhbGFuY2Ugb2YuCiAgKiBAcmV0dXJuIEFuIHVpbnQyNTYgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb3duZWQgYnkgdGhlIHBhc3NlZCBhZGRyZXNzLgogICovCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICB9Cgp9CgovKioKICogQHRpdGxlIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKfQoKLyoqCiAqIEB0aXRsZSBTdGFuZGFyZCBFUkMyMCB0b2tlbgogKgogKiBAZGV2IEltcGxlbWVudGF0aW9uIG9mIHRoZSBiYXNpYyBzdGFuZGFyZCB0b2tlbi4KICogQGRldiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICogQGRldiBCYXNlZCBvbiBjb2RlIGJ5IEZpcnN0Qmxvb2Q6IGh0dHBzOi8vZ2l0aHViLmNvbS9GaXJzdGJsb29kaW8vdG9rZW4vYmxvYi9tYXN0ZXIvc21hcnRfY29udHJhY3QvRmlyc3RCbG9vZFRva2VuLnNvbAogKi8KY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBFUkMyMCwgQmFzaWNUb2tlbiB7CgogIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKCgogIC8qKgogICAqIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlcgogICAqIEBwYXJhbSBfZnJvbSBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20KICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gdHJhbnNmZXIgdG8KICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgdGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CgogICAgdWludDI1NiBfYWxsb3dhbmNlID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl07CgogICAgLy8gQ2hlY2sgaXMgbm90IG5lZWRlZCBiZWNhdXNlIHN1YihfYWxsb3dhbmNlLCBfdmFsdWUpIHdpbGwgYWxyZWFkeSB0aHJvdyBpZiB0aGlzIGNvbmRpdGlvbiBpcyBub3QgbWV0CiAgICAvLyByZXF1aXJlIChfdmFsdWUgPD0gX2FsbG93YW5jZSk7CgogICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IF9hbGxvd2FuY2Uuc3ViKF92YWx1ZSk7CiAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEFwcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWhhbGYgb2YgbXNnLnNlbmRlci4KICAgKgogICAqIEJld2FyZSB0aGF0IGNoYW5naW5nIGFuIGFsbG93YW5jZSB3aXRoIHRoaXMgbWV0aG9kIGJyaW5ncyB0aGUgcmlzayB0aGF0IHNvbWVvbmUgbWF5IHVzZSBib3RoIHRoZSBvbGQKICAgKiBhbmQgdGhlIG5ldyBhbGxvd2FuY2UgYnkgdW5mb3J0dW5hdGUgdHJhbnNhY3Rpb24gb3JkZXJpbmcuIE9uZSBwb3NzaWJsZSBzb2x1dGlvbiB0byBtaXRpZ2F0ZSB0aGlzCiAgICogcmFjZSBjb25kaXRpb24gaXMgdG8gZmlyc3QgcmVkdWNlIHRoZSBzcGVuZGVyJ3MgYWxsb3dhbmNlIHRvIDAgYW5kIHNldCB0aGUgZGVzaXJlZCB2YWx1ZSBhZnRlcndhcmRzOgogICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICovCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF9zcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHJldHVybiBBIHVpbnQyNTYgc3BlY2lmeWluZyB0aGUgYW1vdW50IG9mIHRva2VucyBzdGlsbCBhdmFpbGFibGUgZm9yIHRoZSBzcGVuZGVyLgogICAqLwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICB9CgogIC8qKgogICAqIGFwcHJvdmUgc2hvdWxkIGJlIGNhbGxlZCB3aGVuIGFsbG93ZWRbX3NwZW5kZXJdID09IDAuIFRvIGluY3JlbWVudAogICAqIGFsbG93ZWQgdmFsdWUgaXMgYmV0dGVyIHRvIHVzZSB0aGlzIGZ1bmN0aW9uIHRvIGF2b2lkIDIgY2FsbHMgKGFuZCB3YWl0IHVudGlsCiAgICogdGhlIGZpcnN0IHRyYW5zYWN0aW9uIGlzIG1pbmVkKQogICAqIEZyb20gTW9ub2xpdGhEQU8gVG9rZW4uc29sCiAgICovCiAgZnVuY3Rpb24gaW5jcmVhc2VBcHByb3ZhbCAoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYWRkZWRWYWx1ZSkKICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXS5hZGQoX2FkZGVkVmFsdWUpOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gZGVjcmVhc2VBcHByb3ZhbCAoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfc3VidHJhY3RlZFZhbHVlKQogICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICB1aW50IG9sZFZhbHVlID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl07CiAgICBpZiAoX3N1YnRyYWN0ZWRWYWx1ZSA+IG9sZFZhbHVlKSB7CiAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gMDsKICAgIH0gZWxzZSB7CiAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gb2xkVmFsdWUuc3ViKF9zdWJ0cmFjdGVkVmFsdWUpOwogICAgfQogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgIHJldHVybiB0cnVlOwogIH0KCn0KCi8qKgoqIEB0aXRsZSBVcGdyYWRlIGFnZW50IGludGVyZmFjZQoqLwpjb250cmFjdCBJbnRlcmZhY2VVcGdyYWRlQWdlbnQgewoKICAgIHVpbnQzMiBwdWJsaWMgcmV2aXNpb247CiAgICB1aW50MjU2IHB1YmxpYyBvcmlnaW5hbFN1cHBseTsKCiAgICAvKioKICAgICAqIEBkZXYgUmVpc3N1ZSB0aGUgdG9rZW5zIG9udG8gdGhlIG5ldyBjb250cmFjdCByZXZpc2lvbi4KICAgICAqIEBwYXJhbSBob2xkZXIgSG9sZGVyIChvd25lcikgb2YgdGhlIHRva2VucwogICAgICogQHBhcmFtIHRva2VuUXR5IEhvdyBtYW55IHRva2VucyB0byBiZSBpc3N1ZWQKICAgICAqLwogICAgZnVuY3Rpb24gdXBncmFkZUZyb20oYWRkcmVzcyBob2xkZXIsIHVpbnQyNTYgdG9rZW5RdHkpIHB1YmxpYzsKfQoKLyoqCiAqIEB0aXRsZSBVcGdyYWRhYmxlVG9rZW4KICogQGRldiBUaGUgVXBncmFkYWJsZVRva2VuIGNvbnRyYWN0IHByb3ZpZGVzIGFuIG9wdGlvbiBvZiB1cGdyYWRpbmcgdGhlIHRva2VucyB0byBhIG5ldyByZXZpc2lvbi4KICogVGhlICJ1cGdyYWRlTWFzdGVyIiBtYXkgcHJvcG9zZSB0aGUgdXBncmFkZS4gVG9rZW4gaG9sZGVycyBjYW4gb3B0LWluIGFtb3VudCBvZiB0b2tlbnMgdG8gdXBncmFkZS4KICovCgpjb250cmFjdCBVcGdyYWRhYmxlVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiwgT3duYWJsZSB7CgogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogICAgdWludDMyIHB1YmxpYyBSRVZJU0lPTjsKCiAgICAvKiogQWRkcmVzcyB0aGF0IGNhbiBzZXQgdGhlIHVwZ3JhZGUgYWdlbnQgdGh1cyBlbmFibGluZyB0aGUgdXBncmFkZS4gKi8KICAgIGFkZHJlc3MgcHVibGljIHVwZ3JhZGVNYXN0ZXIgPSBhZGRyZXNzKDApOwoKICAgIC8qKiBBZGRyZXNzIG9mIHRoZSBjb250cmFjdCB0aGF0IGlzc3VlcyB0aGUgbmV3IHJldmlzaW9uIHRva2Vucy4gKi8KICAgIGFkZHJlc3MgcHVibGljIHVwZ3JhZGVBZ2VudCA9IGFkZHJlc3MoMCk7CgogICAgLyoqIEhvdyBtYW55IHRva2VucyBhcmUgdXBncmFkZWQuICovCiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFVwZ3JhZGVkOwoKICAgIGV2ZW50IFVwZ3JhZGUoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCB1aW50MjU2IF92YWx1ZSk7CiAgICBldmVudCBVcGdyYWRlRW5hYmxlZChhZGRyZXNzIGFnZW50KTsKCiAgICAvKioKICAgICAqIEBkZXYgU2V0IHRoZSB1cGdyYWRlIG1hc3Rlci4KICAgICAqIHBhcmFtZXRlciBfdXBncmFkZU1hc3RlciBVcGdyYWRlIG1hc3RlcgogICAgICovCiAgICBmdW5jdGlvbiBzZXRVcGdyYWRlTWFzdGVyKGFkZHJlc3MgX3VwZ3JhZGVNYXN0ZXIpIG9ubHlPd25lciBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShfdXBncmFkZU1hc3RlciAhPSBhZGRyZXNzKDApKTsKICAgICAgICB1cGdyYWRlTWFzdGVyID0gX3VwZ3JhZGVNYXN0ZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFNldCB0aGUgdXBncmFkZSBhZ2VudCAob25jZSBvbmx5KSB0aHVzIGVuYWJsaW5nIHRoZSB1cGdyYWRlLgogICAgICogQHBhcmFtIF91cGdyYWRlQWdlbnQgVXBncmFkZSBhZ2VudCBjb250cmFjdCBhZGRyZXNzCiAgICAgKiBAcGFyYW0gX3JldmlzaW9uIFVuaXF1ZSBJRCB0aGF0IGFnZW50IGNvbnRyYWN0IG11c3QgcmV0dXJuIG9uICIucmV2aXNpb24oKSIKICAgICAqLwogICAgZnVuY3Rpb24gc2V0VXBncmFkZUFnZW50KGFkZHJlc3MgX3VwZ3JhZGVBZ2VudCwgdWludDMyIF9yZXZpc2lvbikKICAgICAgICBvbmx5VXBncmFkZU1hc3RlciB3aGVuVXBncmFkZURpc2FibGVkIGV4dGVybmFsCiAgICB7CiAgICAgICAgcmVxdWlyZSgoX3VwZ3JhZGVBZ2VudCAhPSBhZGRyZXNzKDApKSAmJiAoX3JldmlzaW9uICE9IDApKTsKCiAgICAgICAgSW50ZXJmYWNlVXBncmFkZUFnZW50IGFnZW50ID0gSW50ZXJmYWNlVXBncmFkZUFnZW50KF91cGdyYWRlQWdlbnQpOwoKICAgICAgICByZXF1aXJlKGFnZW50LnJldmlzaW9uKCkgPT0gX3JldmlzaW9uKTsKICAgICAgICByZXF1aXJlKGFnZW50Lm9yaWdpbmFsU3VwcGx5KCkgPT0gdG90YWxTdXBwbHkpOwoKICAgICAgICB1cGdyYWRlQWdlbnQgPSBfdXBncmFkZUFnZW50OwogICAgICAgIFVwZ3JhZGVFbmFibGVkKF91cGdyYWRlQWdlbnQpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBVcGdyYWRlIHRva2VucyB0byB0aGUgbmV3IHJldmlzaW9uLgogICAgICogQHBhcmFtIHZhbHVlIEhvdyBtYW55IHRva2VucyB0byBiZSB1cGdyYWRlZAogICAgICovCiAgICBmdW5jdGlvbiB1cGdyYWRlKHVpbnQyNTYgdmFsdWUpIHdoZW5VcGdyYWRlRW5hYmxlZCBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZSh2YWx1ZSA+IDApOwoKICAgICAgICB1aW50MjU2IGJhbGFuY2UgPSBiYWxhbmNlc1ttc2cuc2VuZGVyXTsKICAgICAgICByZXF1aXJlKGJhbGFuY2UgPiAwKTsKCiAgICAgICAgLy8gVGFrZSB0b2tlbnMgb3V0IGZyb20gdGhlIG9sZCBjb250cmFjdAogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZS5zdWIodmFsdWUpOwogICAgICAgIHRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkuc3ViKHZhbHVlKTsKICAgICAgICB0b3RhbFVwZ3JhZGVkID0gdG90YWxVcGdyYWRlZC5hZGQodmFsdWUpOwogICAgICAgIC8vIElzc3VlIHRoZSBuZXcgcmV2aXNpb24gdG9rZW5zCiAgICAgICAgSW50ZXJmYWNlVXBncmFkZUFnZW50IGFnZW50ID0gSW50ZXJmYWNlVXBncmFkZUFnZW50KHVwZ3JhZGVBZ2VudCk7CiAgICAgICAgYWdlbnQudXBncmFkZUZyb20obXNnLnNlbmRlciwgdmFsdWUpOwoKICAgICAgICBVcGdyYWRlKG1zZy5zZW5kZXIsIHZhbHVlKTsKICAgIH0KCiAgICAvKioKICAgICogQGRldiBNb2RpZmllciB0byBtYWtlIGEgZnVuY3Rpb24gY2FsbGFibGUgb25seSB3aGVuIHRoZSB1cGdyYWRlIGlzIGVuYWJsZWQuCiAgICAqLwogICAgbW9kaWZpZXIgd2hlblVwZ3JhZGVFbmFibGVkKCkgewogICAgICAgIHJlcXVpcmUodXBncmFkZUFnZW50ICE9IGFkZHJlc3MoMCkpOwogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgTW9kaWZpZXIgdG8gbWFrZSBhIGZ1bmN0aW9uIGNhbGxhYmxlIG9ubHkgd2hlbiB0aGUgdXBncmFkZSBpcyBpbXBvc3NpYmxlLgogICAgKi8KICAgIG1vZGlmaWVyIHdoZW5VcGdyYWRlRGlzYWJsZWQoKSB7CiAgICAgICAgcmVxdWlyZSh1cGdyYWRlQWdlbnQgPT0gYWRkcmVzcygwKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKioKICAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIHVwZ3JhZGVNYXN0ZXIuCiAgICAqLwogICAgbW9kaWZpZXIgb25seVVwZ3JhZGVNYXN0ZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHVwZ3JhZGVNYXN0ZXIpOwogICAgICAgIF87CiAgICB9Cgp9CgovKioKICogQHRpdGxlIFdpdGhkcmF3YWJsZQogKiBAZGV2IFRoZSBXaXRoZHJhd2FibGUgY29udHJhY3QgcHJvdmlkZXMgYSBtZWNoYW5pc20gb2Ygd2l0aGRyYXdhbChzKS4KICogIldpdGhkcmF3YWxzIiBhcmUgcGVybWlzc2lvbnMgZm9yIHNwZWNpZmllZCBhZGRyZXNzZXMgdG8gcHVsbCAod2l0aGRyYXcpIHBheW1lbnRzIGZyb20gdGhlIGNvbnRyYWN0IGJhbGFuY2UuCiAqLwoKY29udHJhY3QgV2l0aGRyYXdhYmxlIHsKCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIHBlbmRpbmdXaXRoZHJhd2FsczsKCiAgICAvKgogICAgICogQGRldiBMb2dnZWQgdXBvbiBhIGdyYW50ZWQgYWxsb3dhbmNlIHRvIHRoZSBzcGVjaWZpZWQgZHJhd2VyIG9uIHdpdGhkcmF3YWwuCiAgICAgKiBAcGFyYW0gZHJhd2VyIFRoZSBhZGRyZXNzIG9mIHRoZSBkcmF3ZXIuCiAgICAgKiBAcGFyYW0gd2VpQW1vdW50IFRoZSB2YWx1ZSBpbiBXZWkgd2hpY2ggbWF5IGJlIHdpdGhkcmF3bi4KICAgICAqLwogICAgZXZlbnQgV2l0aGRyYXdhbChhZGRyZXNzIGluZGV4ZWQgZHJhd2VyLCB1aW50MjU2IHdlaUFtb3VudCk7CgogICAgLyoKICAgICAqIEBkZXYgTG9nZ2VkIHVwb24gYSB3aXRoZHJhd24gdmFsdWUuCiAgICAgKiBAcGFyYW0gZHJhd2VyIFRoZSBhZGRyZXNzIG9mIHRoZSBkcmF3ZXIuCiAgICAgKiBAcGFyYW0gd2VpQW1vdW50IFRoZSB2YWx1ZSBpbiBXZWkgd2hpY2ggaGFzIGJlZW4gd2l0aGRyYXduLgogICAgICovCiAgICBldmVudCBXaXRoZHJhd24oYWRkcmVzcyBpbmRleGVkIGRyYXdlciwgdWludDI1NiB3ZWlBbW91bnQpOwoKICAgIC8qCiAgICAgKiBAZGV2IEFsbG93IHRoZSBzcGVjaWZpZWQgZHJhd2VyIHRvIHdpdGhkcmF3IHRoZSBzcGVjaWZpZWQgdmFsdWUgZnJvbSB0aGUgY29udHJhY3QgYmFsYW5jZS4KICAgICAqIEBwYXJhbSBkcmF3ZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGRyYXdlci4KICAgICAqIEBwYXJhbSB3ZWlBbW91bnQgVGhlIHZhbHVlIGluIFdlaSBhbGxvd2VkIHRvIHdpdGhkcmF3LgogICAgICogQHJldHVybiBzdWNjZXNzCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldFdpdGhkcmF3YWwoYWRkcmVzcyBkcmF3ZXIsIHVpbnQyNTYgd2VpQW1vdW50KSBpbnRlcm5hbCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBpZiAoKGRyYXdlciAhPSBhZGRyZXNzKDApKSAmJiAod2VpQW1vdW50ID4gMCkpIHsKICAgICAgICAgICAgdWludDI1NiBvbGRCYWxhbmNlID0gcGVuZGluZ1dpdGhkcmF3YWxzW2RyYXdlcl07CiAgICAgICAgICAgIHVpbnQyNTYgbmV3QmFsYW5jZSA9IG9sZEJhbGFuY2UgKyB3ZWlBbW91bnQ7CiAgICAgICAgICAgIGlmIChuZXdCYWxhbmNlID4gb2xkQmFsYW5jZSkgewogICAgICAgICAgICAgICAgcGVuZGluZ1dpdGhkcmF3YWxzW2RyYXdlcl0gPSBuZXdCYWxhbmNlOwogICAgICAgICAgICAgICAgV2l0aGRyYXdhbChkcmF3ZXIsIHdlaUFtb3VudCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgV2l0aGRyYXcgdGhlIGFsbG93ZWQgdmFsdWUgZnJvbSB0aGUgY29udHJhY3QgYmFsYW5jZS4KICAgICAqIEByZXR1cm4gc3VjY2VzcwogICAgICovCiAgICBmdW5jdGlvbiB3aXRoZHJhdygpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICB1aW50MjU2IHdlaUFtb3VudCA9IHBlbmRpbmdXaXRoZHJhd2Fsc1ttc2cuc2VuZGVyXTsKICAgICAgICByZXF1aXJlKHdlaUFtb3VudCA+IDApOwoKICAgICAgICBwZW5kaW5nV2l0aGRyYXdhbHNbbXNnLnNlbmRlcl0gPSAwOwogICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIod2VpQW1vdW50KTsKICAgICAgICBXaXRoZHJhd24obXNnLnNlbmRlciwgd2VpQW1vdW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCn0KCi8qKgogKiBAdGl0bGUgU2F2aW9yIFRva2VuCiAqIEBkZXYgU2F2aW9yIFRva2VuIChTQVZJKSBhbmQgVG9rZW4gU2FsZSAoSUNPKS4KICovCgpjb250cmFjdCBTYXZpb3JUb2tlbiBpcyBVcGdyYWRhYmxlVG9rZW4sIFBhdXNhYmxlT25jZSwgV2l0aGRyYXdhYmxlIHsKCiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IG5hbWUgPSAiU2F2aW9yIFRva2VuIjsKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gIlNBVkkiOwogICAgLyoqIE51bWJlciBvZiAiQXRvbSIgaW4gMSBTQVZJICgxIFNBVkkgPSAxeDE4XmRlY2ltYWxzIEF0b20pICovCiAgICB1aW50OCAgcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gMTg7CgogICAgLyoqIEhvbGRlciBvZiBib3VudHkgdG9rZW5zICovCiAgICBhZGRyZXNzIHB1YmxpYyBib3VudHk7CgogICAgLyoqIExpbWl0IChpbiBBdG9tKSBpc3N1ZWQsIGluY2x1c2l2ZSBvd25lcidzIGFuZCBib3VudHkgc2hhcmVzICovCiAgICB1aW50MjU2IGNvbnN0YW50IGludGVybmFsIFRPVEFMX0xJTUlUICAgPSAxMDAwMDAwMDAgKiAoMTAgKiogdWludDI1NihkZWNpbWFscykpOwogICAgLyoqIExpbWl0IChpbiBBdG9tKSBmb3IgUHJlLUlDTyBQaGFzZSBBLCBCIGFuZCBDLCBpbmNsLiBvd25lcidzIGFuZCBib3VudHkgc2hhcmVzICovCiAgICB1aW50MjU2IGNvbnN0YW50IGludGVybmFsIFBSRV9JQ09fTElNSVQgPSAxMDAwMDAwMCAqICgxMCAqKiB1aW50MjU2KGRlY2ltYWxzKSk7CgogICAgLyoqCiAgICAqIElDTyBQaGFzZXMuCiAgICAqCiAgICAqIC0gUHJlU3RhcnQ6IHRva2VucyBhcmUgbm90IHlldCBzb2xkL2lzc3VlZAogICAgKiAtIFByZUljb0E6ICBuZXcgdG9rZW5zIHNvbGQvaXNzdWVkIHdpdGggYSBib251cyByYXRlIG9mIDQwJQogICAgKiAtIFByZUljb0I6ICBuZXcgdG9rZW5zIHNvbGQvaXNzdWVkIHdpdGggYSBib251cyByYXRlIG9mIDMwJQogICAgKiAtIFByZUljb0M6ICBuZXcgdG9rZW5zIHNvbGQvaXNzdWVkIHdpdGggYSBib251cyByYXRlIG9mIDIwJQogICAgKiAtIE1haW5JY29BICAgbmV3IHRva2VucyBzb2xkL2lzc3VlZCB3aXRoIGEgYm9udXMgcmF0ZSBvZiAxMCUKICAgICogLSBNYWluSWNvQiAgIG5ldyB0b2tlbnMgc29sZC9pc3N1ZWQgd2l0aCBhIGJvbnVzIHJhdGUgb2YgNSUKICAgICogLSBNYWluSWNvQyAgIG5ldyB0b2tlbnMgc29sZC9pc3N1ZWQgd2l0aCBhIGJvbnVzIHJhdGUgb2YgMCUKICAgICogLSBBZnRlckljbzogbmV3IHRva2VucyBjYW4gbm90IGJlIG5vdCBiZSBzb2xkL2lzc3VlZCBhbnkgbG9uZ2VyCiAgICAqLwogICAgCiAgICBlbnVtIFBoYXNlcyB7UHJlU3RhcnQsIFByZUljb0EsIFByZUljb0IsIFByZUljb0MsIE1haW5JY29BLCBNYWluSWNvQiwgTWFpbkljb0MsIEFmdGVySWNvfQoKICAgIHVpbnQ2NCBjb25zdGFudCBpbnRlcm5hbCBQUkVfSUNPX0RVUkFUSU9OX0EgPSA3MiBob3VyczsKICAgIHVpbnQ2NCBjb25zdGFudCBpbnRlcm5hbCBQUkVfSUNPX0RVUkFUSU9OX0IgPSAyNDAgaG91cnM7CiAgICB1aW50NjQgY29uc3RhbnQgaW50ZXJuYWwgUFJFX0lDT19EVVJBVElPTl9DID0gNDA4IGhvdXJzOwogICAgdWludDY0IGNvbnN0YW50IGludGVybmFsIElDT19EVVJBVElPTl9BID0gMTY4IGhvdXJzOwogICAgdWludDY0IGNvbnN0YW50IGludGVybmFsIElDT19EVVJBVElPTl9CID0gMTY4IGhvdXJzOwogICAgdWludDY0IGNvbnN0YW50IGludGVybmFsIElDT19EVVJBVElPTl9DID0gMTEwNCBob3VyczsKCiAgICB1aW50NjQgY29uc3RhbnQgaW50ZXJuYWwgUFJFX0lDT19EVVJBVElPTiA9IDcyMCBob3VyczsKICAgIHVpbnQ2NCBjb25zdGFudCBpbnRlcm5hbCBJQ09fRFVSQVRJT04gPSAxNDQwIGhvdXJzOwogICAgdWludDY0IGNvbnN0YW50IGludGVybmFsIFJFVFVSTl9XRUlfUEFVU0UgPSAzMCBkYXlzOwoKICAgIC8vIFByZS1JQ08gUGhhc2UgQSByYXRlCiAgICB1aW50MjU2IGNvbnN0YW50IGludGVybmFsIFByZUlDT19TRU5ERVJfUkFURV9BID0gMTQwOwogICAgdWludDI1NiBjb25zdGFudCBpbnRlcm5hbCBQcmVJQ09fT1dORVJfUkFURV9BICA9ICAxMDsKICAgIHVpbnQyNTYgY29uc3RhbnQgaW50ZXJuYWwgUHJlSUNPX0JPVU5UWV9SQVRFX0EgPSAgMTA7CiAgICB1aW50MjU2IGNvbnN0YW50IGludGVybmFsIFByZUlDT19UT1RBTF9SQVRFX0EgID0gICBQcmVJQ09fU0VOREVSX1JBVEVfQSArIFByZUlDT19PV05FUl9SQVRFX0EgKyBQcmVJQ09fQk9VTlRZX1JBVEVfQTsKICAgIC8vIFByZS1JQ08gUGhhc2UgQiByYXRlCiAgICB1aW50MjU2IGNvbnN0YW50IGludGVybmFsIFByZUlDT19TRU5ERVJfUkFURV9CID0gMTMwOwogICAgdWludDI1NiBjb25zdGFudCBpbnRlcm5hbCBQcmVJQ09fT1dORVJfUkFURV9CICA9ICAxMDsKICAgIHVpbnQyNTYgY29uc3RhbnQgaW50ZXJuYWwgUHJlSUNPX0JPVU5UWV9SQVRFX0IgPSAgMTA7CiAgICB1aW50MjU2IGNvbnN0YW50IGludGVybmFsIFByZUlDT19UT1RBTF9SQVRFX0IgID0gICBQcmVJQ09fU0VOREVSX1JBVEVfQiArIFByZUlDT19PV05FUl9SQVRFX0IgKyBQcmVJQ09fQk9VTlRZX1JBVEVfQjsKICAgIC8vIFByZS1JQ08gUGhhc2UgQyByYXRlCiAgICB1aW50MjU2IGNvbnN0YW50IGludGVybmFsIFByZUlDT19TRU5ERVJfUkFURV9DID0gMTIwOwogICAgdWludDI1NiBjb25zdGFudCBpbnRlcm5hbCBQcmVJQ09fT1dORVJfUkFURV9DICA9ICAxMDsKICAgIHVpbnQyNTYgY29uc3RhbnQgaW50ZXJuYWwgUHJlSUNPX0JPVU5UWV9SQVRFX0MgPSAgMTA7CiAgICB1aW50MjU2IGNvbnN0YW50IGludGVybmFsIFByZUlDT19UT1RBTF9SQVRFX0MgID0gICBQcmVJQ09fU0VOREVSX1JBVEVfQyArIFByZUlDT19PV05FUl9SQVRFX0MgKyBQcmVJQ09fQk9VTlRZX1JBVEVfQzsKCiAgICAvLyBQcmUtSUNPIFBoYXNlIEEgcmF0ZQogICAgdWludDI1NiBjb25zdGFudCBpbnRlcm5hbCBJQ09fU0VOREVSX1JBVEVfQSA9IDExMDsKICAgIHVpbnQyNTYgY29uc3RhbnQgaW50ZXJuYWwgSUNPX09XTkVSX1JBVEVfQSAgPSAgMTA7CiAgICB1aW50MjU2IGNvbnN0YW50IGludGVybmFsIElDT19CT1VOVFlfUkFURV9BID0gIDEwOwogICAgdWludDI1NiBjb25zdGFudCBpbnRlcm5hbCBJQ09fVE9UQUxfUkFURV9BICA9ICAgSUNPX1NFTkRFUl9SQVRFX0EgKyBJQ09fT1dORVJfUkFURV9BICsgSUNPX0JPVU5UWV9SQVRFX0E7CiAgICAvLyBQcmUtSUNPIFBoYXNlIEIgcmF0ZQogICAgdWludDI1NiBjb25zdGFudCBpbnRlcm5hbCBJQ09fU0VOREVSX1JBVEVfQiA9IDEwNTsKICAgIHVpbnQyNTYgY29uc3RhbnQgaW50ZXJuYWwgSUNPX09XTkVSX1JBVEVfQiAgPSAgMTA7CiAgICB1aW50MjU2IGNvbnN0YW50IGludGVybmFsIElDT19CT1VOVFlfUkFURV9CID0gIDEwOwogICAgdWludDI1NiBjb25zdGFudCBpbnRlcm5hbCBJQ09fVE9UQUxfUkFURV9CICA9ICAgSUNPX1NFTkRFUl9SQVRFX0IgKyBJQ09fT1dORVJfUkFURV9CICsgSUNPX0JPVU5UWV9SQVRFX0I7CiAgICAvLyBQcmUtSUNPIFBoYXNlIEMgcmF0ZQogICAgdWludDI1NiBjb25zdGFudCBpbnRlcm5hbCBJQ09fU0VOREVSX1JBVEVfQyA9IDEwMDsKICAgIHVpbnQyNTYgY29uc3RhbnQgaW50ZXJuYWwgSUNPX09XTkVSX1JBVEVfQyAgPSAgMTA7CiAgICB1aW50MjU2IGNvbnN0YW50IGludGVybmFsIElDT19CT1VOVFlfUkFURV9DID0gIDEwOwogICAgdWludDI1NiBjb25zdGFudCBpbnRlcm5hbCBJQ09fVE9UQUxfUkFURV9DICA9ICAgSUNPX1NFTkRFUl9SQVRFX0MgKyBJQ09fT1dORVJfUkFURV9DICsgSUNPX0JPVU5UWV9SQVRFX0M7CgoJCiAgICBzdHJ1Y3QgUmF0ZXMgewogICAgICAgIHVpbnQyNTYgdG9TZW5kZXI7CiAgICAgICAgdWludDI1NiB0b093bmVyOwogICAgICAgIHVpbnQyNTYgdG9Cb3VudHk7CiAgICAgICAgdWludDI1NiB0b3RhbDsKICAgIH0KCiAgICBldmVudCBOZXdUb2tlbnModWludDI1NiBhbW91bnQpOwogICAgZXZlbnQgTmV3RnVuZHMoYWRkcmVzcyBmdW5kZXIsIHVpbnQyNTYgdmFsdWUpOwogICAgZXZlbnQgTmV3UGhhc2UoUGhhc2VzIHBoYXNlKTsKCiAgICAvLyBjdXJyZW50IFBoYXNlCiAgICBQaGFzZXMgcHVibGljIHBoYXNlID0gUGhhc2VzLlByZVN0YXJ0OwoKICAgIC8vIFRpbWVzdGFtcHMgbGltaXRpbmcgZHVyYXRpb24gb2YgUGhhc2VzLCBpbiBzZWNvbmRzIHNpbmNlIFVuaXggZXBvY2guCiAgICB1aW50NjQgcHVibGljIHByZUljb09wZW5pbmdUaW1lOyAgLy8gd2hlbiBQcmUtSUNPIFBoYXNlIEEgc3RhcnRzCiAgICB1aW50NjQgcHVibGljIGljb09wZW5pbmdUaW1lOyAgICAgLy8gd2hlbiBNYWluIElDTyBQaGFzZSBBIHN0YXJ0cyAoaWYgbm90IHNvbGQgb3V0IGJlZm9yZSkKICAgIHVpbnQ2NCBwdWJsaWMgY2xvc2luZ1RpbWU7ICAgICAgICAvLyBieSB3aGVuIHRoZSBJQ08gY2FtcGFpZ24gZmluaXNoZXMgaW4gYW55IHdheQogICAgdWludDY0IHB1YmxpYyByZXR1cm5BbGxvd2VkVGltZTsgIC8vIHdoZW4gb3duZXIgbWF5IHdpdGhkcmF3IEV0aCBmcm9tIGNvbnRyYWN0LCBpZiBhbnkKCiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFByb2NlZWRzOwoKICAgIC8qCiAgICAgKiBAZGV2IGNvbnN0cnVjdG9yCiAgICAgKiBAcGFyYW0gX3ByZUljb09wZW5pbmdUaW1lIFRpbWVzdGFtcCB3aGVuIHRoZSBQcmUtSUNPIChQaGFzZSBBKSBzaGFsbCBzdGFydC4KICAgICAqIG1zZy52YWx1ZSBNVVNUIGJlIGF0IGxlYXN0IHRoZSBzdW0gb2YgYXdhcmRzLgogICAgICovCiAgICBmdW5jdGlvbiBTYXZpb3JUb2tlbih1aW50NjQgX3ByZUljb09wZW5pbmdUaW1lKSBwYXlhYmxlIHsKICAgICAgICByZXF1aXJlKF9wcmVJY29PcGVuaW5nVGltZSA+IG5vdyk7CgogICAgICAgIHByZUljb09wZW5pbmdUaW1lID0gX3ByZUljb09wZW5pbmdUaW1lOwogICAgICAgIGljb09wZW5pbmdUaW1lID0gcHJlSWNvT3BlbmluZ1RpbWUgKyBQUkVfSUNPX0RVUkFUSU9OOwogICAgICAgIGNsb3NpbmdUaW1lID0gaWNvT3BlbmluZ1RpbWUgKyBJQ09fRFVSQVRJT047CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgRmFsbGJhY2sgZnVuY3Rpb24gZGVsZWdhdGVzIHRoZSByZXF1ZXN0IHRvIGNyZWF0ZSgpLgogICAgICovCiAgICBmdW5jdGlvbiAoKSBwYXlhYmxlIGV4dGVybmFsIHsKICAgICAgICBjcmVhdGUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgU2V0IHRoZSBhZGRyZXNzIG9mIHRoZSBob2xkZXIgb2YgYm91bnR5IHRva2Vucy4KICAgICAqIEBwYXJhbSBfYm91bnR5IFRoZSBhZGRyZXNzIG9mIHRoZSBib3VudHkgdG9rZW4gaG9sZGVyLgogICAgICogQHJldHVybiBzdWNjZXNzL2ZhaWx1cmUKICAgICAqLwogICAgZnVuY3Rpb24gc2V0Qm91bnR5KGFkZHJlc3MgX2JvdW50eSwgdWludDI1NiBib3VudHlUb2tlbnMpIG9ubHlPd25lciBleHRlcm5hbCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKF9ib3VudHkgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgYm91bnR5ID0gX2JvdW50eTsKICAgICAgICAKICAgICAgICB1aW50MjU2IGJvdW50aWVzID0gYm91bnR5VG9rZW5zICogMTAqKjE4OwogICAgICAgIAogICAgICAgIGJhbGFuY2VzW2JvdW50eV0gPSBiYWxhbmNlc1tib3VudHldLmFkZChib3VudGllcyk7CiAgICAgICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5hZGQoYm91bnRpZXMpOwogICAgICAgIAogICAgICAgIE5ld1Rva2Vucyhib3VudGllcyk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IE1pbnQgdG9rZW5zIGFuZCBhZGQgdGhlbSB0byB0aGUgYmFsYW5jZSBvZiB0aGUgbWVzc2FnZS5zZW5kZXIuCiAgICAgKiBBZGRpdGlvbmFsIHRva2VucyBhcmUgbWludGVkIGFuZCBhZGRlZCB0byB0aGUgb3duZXIgYW5kIHRoZSBib3VudHkgYmFsYW5jZXMuCiAgICAgKiBAcmV0dXJuIHN1Y2Nlc3MvZmFpbHVyZQogICAgICovCiAgICBmdW5jdGlvbiBjcmVhdGUoKSBwYXlhYmxlIHdoZW5Ob3RDbG9zZWQgd2hlbk5vdFBhdXNlZCBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPiAwKTsKICAgICAgICByZXF1aXJlKG5vdyA+PSBwcmVJY29PcGVuaW5nVGltZSk7CgogICAgICAgIHVpbnQyNTYgd2VpVG9QYXJ0aWNpcGF0ZSA9IG1zZy52YWx1ZTsKCiAgICAgICAgYWRqdXN0UGhhc2VCYXNlZE9uVGltZSgpOwoKICAgICAgICBpZiAocGhhc2UgIT0gUGhhc2VzLkFmdGVySWNvIHx8IHdlaVRvUGFydGljaXBhdGUgPCAoMC4wMSAqIDEwKioxOCkpIHsKCiAgICAgICAgICAgIFJhdGVzIG1lbW9yeSByYXRlcyA9IGdldFJhdGVzKCk7CiAgICAgICAgICAgIHVpbnQyNTYgbmV3VG9rZW5zID0gd2VpVG9QYXJ0aWNpcGF0ZS5tdWwocmF0ZXMudG90YWwpOwogICAgICAgICAgICB1aW50MjU2IHJlcXVlc3RlZFN1cHBseSA9IHRvdGFsU3VwcGx5LmFkZChuZXdUb2tlbnMpOwoKICAgICAgICAgICAgLy8gImVtaXNzaW9uIiBvZiBuZXcgdG9rZW5zCiAgICAgICAgICAgIHRvdGFsU3VwcGx5ID0gcmVxdWVzdGVkU3VwcGx5OwogICAgICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSAJPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5hZGQod2VpVG9QYXJ0aWNpcGF0ZS5tdWwocmF0ZXMudG9TZW5kZXIpKTsKICAgICAgICAgICAgYmFsYW5jZXNbb3duZXJdIAkJPSBiYWxhbmNlc1tvd25lcl0uYWRkKHdlaVRvUGFydGljaXBhdGUubXVsKHJhdGVzLnRvT3duZXIpKTsKICAgICAgICAgICAgYmFsYW5jZXNbYm91bnR5XSAJCT0gYmFsYW5jZXNbYm91bnR5XS5hZGQod2VpVG9QYXJ0aWNpcGF0ZS5tdWwocmF0ZXMudG9Cb3VudHkpKTsKCiAgICAgICAgICAgIC8vIEVUSCB0cmFuc2ZlcnMKICAgICAgICAgICAgdG90YWxQcm9jZWVkcyA9IHRvdGFsUHJvY2VlZHMuYWRkKHdlaVRvUGFydGljaXBhdGUpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gTG9nZ2luZwogICAgICAgICAgICBOZXdUb2tlbnMobmV3VG9rZW5zKTsKICAgICAgICAgICAgTmV3RnVuZHMobXNnLnNlbmRlciwgd2VpVG9QYXJ0aWNpcGF0ZSk7CgogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHNldFdpdGhkcmF3YWwob3duZXIsIHdlaVRvUGFydGljaXBhdGUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgU2VuZCB0aGUgdmFsdWUgKGV0aGVycykgdGhhdCB0aGUgY29udHJhY3QgaG9sZHMgdG8gdGhlIG93bmVyIGFkZHJlc3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJldHVybldlaSgpIG9ubHlPd25lciBleHRlcm5hbCB7CiAgICAgICAgb3duZXIudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBhZGp1c3RQaGFzZUJhc2VkT25UaW1lKCkgaW50ZXJuYWwgewoKICAgICAgICBpZiAobm93ID49IGNsb3NpbmdUaW1lKSB7CiAgICAgICAgICAgIGlmIChwaGFzZSAhPSBQaGFzZXMuQWZ0ZXJJY28pIHsKICAgICAgICAgICAgICAgIHBoYXNlID0gUGhhc2VzLkFmdGVySWNvOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChub3cgPj0gaWNvT3BlbmluZ1RpbWUgKyBJQ09fRFVSQVRJT05fQSArIElDT19EVVJBVElPTl9CKSB7CiAgICAgICAgICAgIGlmIChwaGFzZSAhPSBQaGFzZXMuTWFpbkljb0MpIHsKICAgICAgICAgICAgICAgIHBoYXNlID0gUGhhc2VzLk1haW5JY29DOwogICAgICAgICAgICB9CgkJfSBlbHNlIGlmIChub3cgPj0gaWNvT3BlbmluZ1RpbWUgKyBJQ09fRFVSQVRJT05fQSApIHsKICAgICAgICAgICAgaWYgKHBoYXNlICE9IFBoYXNlcy5NYWluSWNvQikgewogICAgICAgICAgICAgICAgcGhhc2UgPSBQaGFzZXMuTWFpbkljb0I7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKG5vdyA+PSBpY29PcGVuaW5nVGltZSApIHsKICAgICAgICAgICAgaWYgKHBoYXNlICE9IFBoYXNlcy5NYWluSWNvQSkgewogICAgICAgICAgICAgICAgcGhhc2UgPSBQaGFzZXMuTWFpbkljb0E7CiAgICAgICAgICAgIH0KCQl9IGVsc2UgaWYgKG5vdyA+PSBwcmVJY29PcGVuaW5nVGltZSArIFBSRV9JQ09fRFVSQVRJT05fQSArIFBSRV9JQ09fRFVSQVRJT05fQikgewogICAgICAgICAgICBpZiAocGhhc2UgIT0gUGhhc2VzLlByZUljb0MpIHsKICAgICAgICAgICAgICAgIHBoYXNlID0gUGhhc2VzLlByZUljb0M7CiAgICAgICAgICAgIH0KCQl9IGVsc2UgaWYgKG5vdyA+PSBwcmVJY29PcGVuaW5nVGltZSArIFBSRV9JQ09fRFVSQVRJT05fQSApIHsKICAgICAgICAgICAgaWYgKHBoYXNlICE9IFBoYXNlcy5QcmVJY29CKSB7CiAgICAgICAgICAgICAgICBwaGFzZSA9IFBoYXNlcy5QcmVJY29COwogICAgICAgICAgICB9CgkJfSBlbHNlIGlmIChub3cgPj0gcHJlSWNvT3BlbmluZ1RpbWUgKSB7CiAgICAgICAgICAgIGlmIChwaGFzZSAhPSBQaGFzZXMuUHJlSWNvQSkgewogICAgICAgICAgICAgICAgcGhhc2UgPSBQaGFzZXMuUHJlSWNvQTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAocGhhc2UgPT0gUGhhc2VzLlByZVN0YXJ0KSB7CiAgICAgICAgICAgIHNldERlZmF1bHRQYXJhbXNJZk5lZWRlZCgpOwogICAgICAgICAgICBwaGFzZSA9IFBoYXNlcy5QcmVJY29BOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBzZXREZWZhdWx0UGFyYW1zSWZOZWVkZWQoKSBpbnRlcm5hbCB7CiAgICAgICAgaWYgKGJvdW50eSA9PSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgIGJvdW50eSA9IG93bmVyOwogICAgICAgIH0KICAgICAgICBpZiAodXBncmFkZU1hc3RlciA9PSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgIHVwZ3JhZGVNYXN0ZXIgPSBvd25lcjsKICAgICAgICB9CiAgICAgICAgaWYgKHBhdXNlTWFzdGVyID09IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgcGF1c2VNYXN0ZXIgPSBvd25lcjsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0UmF0ZXMoKSBpbnRlcm5hbCByZXR1cm5zIChSYXRlcyByYXRlcykgewoJCWlmIChwaGFzZSA9PSBQaGFzZXMuUHJlSWNvQSkgewogICAgICAgICAgICByYXRlcy50b1NlbmRlciAJPSBQcmVJQ09fU0VOREVSX1JBVEVfQTsKICAgICAgICAgICAgcmF0ZXMudG9Pd25lciAJPSBQcmVJQ09fT1dORVJfUkFURV9BOwogICAgICAgICAgICByYXRlcy50b0JvdW50eSAJPSBQcmVJQ09fQk9VTlRZX1JBVEVfQTsKICAgICAgICAgICAgcmF0ZXMudG90YWwgCT0gUHJlSUNPX1RPVEFMX1JBVEVfQTsKICAgICAgICB9IGVsc2UgaWYgKHBoYXNlID09IFBoYXNlcy5QcmVJY29CKSB7CiAgICAgICAgICAgIHJhdGVzLnRvU2VuZGVyIAk9IFByZUlDT19TRU5ERVJfUkFURV9COwogICAgICAgICAgICByYXRlcy50b093bmVyIAk9IFByZUlDT19PV05FUl9SQVRFX0I7CiAgICAgICAgICAgIHJhdGVzLnRvQm91bnR5IAk9IFByZUlDT19CT1VOVFlfUkFURV9COwogICAgICAgICAgICByYXRlcy50b3RhbCAJPSBQcmVJQ09fVE9UQUxfUkFURV9COwogICAgICAgIH0gZWxzZSBpZiAocGhhc2UgPT0gUGhhc2VzLlByZUljb0MpIHsKICAgICAgICAgICAgcmF0ZXMudG9TZW5kZXIgCT0gUHJlSUNPX1NFTkRFUl9SQVRFX0M7CiAgICAgICAgICAgIHJhdGVzLnRvT3duZXIgCT0gUHJlSUNPX09XTkVSX1JBVEVfQzsKICAgICAgICAgICAgcmF0ZXMudG9Cb3VudHkgCT0gUHJlSUNPX0JPVU5UWV9SQVRFX0M7CiAgICAgICAgICAgIHJhdGVzLnRvdGFsIAk9IFByZUlDT19UT1RBTF9SQVRFX0M7CiAgICAgICAgfSBlbHNlIGlmIChwaGFzZSA9PSBQaGFzZXMuTWFpbkljb0EpIHsKICAgICAgICAgICAgcmF0ZXMudG9TZW5kZXIgCT0gSUNPX1NFTkRFUl9SQVRFX0E7CiAgICAgICAgICAgIHJhdGVzLnRvT3duZXIgCT0gSUNPX09XTkVSX1JBVEVfQTsKICAgICAgICAgICAgcmF0ZXMudG9Cb3VudHkgCT0gSUNPX0JPVU5UWV9SQVRFX0E7CiAgICAgICAgICAgIHJhdGVzLnRvdGFsIAk9IElDT19UT1RBTF9SQVRFX0E7CiAgICAgICAgfSBlbHNlIGlmIChwaGFzZSA9PSBQaGFzZXMuTWFpbkljb0IpIHsKICAgICAgICAgICAgcmF0ZXMudG9TZW5kZXIgCT0gSUNPX1NFTkRFUl9SQVRFX0I7CiAgICAgICAgICAgIHJhdGVzLnRvT3duZXIgCT0gSUNPX09XTkVSX1JBVEVfQjsKICAgICAgICAgICAgcmF0ZXMudG9Cb3VudHkgCT0gSUNPX0JPVU5UWV9SQVRFX0I7CiAgICAgICAgICAgIHJhdGVzLnRvdGFsIAk9IElDT19UT1RBTF9SQVRFX0I7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmF0ZXMudG9TZW5kZXIgCT0gSUNPX1NFTkRFUl9SQVRFX0M7CiAgICAgICAgICAgIHJhdGVzLnRvT3duZXIgCT0gSUNPX09XTkVSX1JBVEVfQzsKICAgICAgICAgICAgcmF0ZXMudG9Cb3VudHkgCT0gSUNPX0JPVU5UWV9SQVRFX0M7CiAgICAgICAgICAgIHJhdGVzLnRvdGFsIAk9IElDT19UT1RBTF9SQVRFX0M7CiAgICAgICAgfQogICAgICAgIHJldHVybiByYXRlczsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgVHJhbnNmZXIgdG9rZW5zIHRvIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAgICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8uCiAgICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkLgogICAgICogQHJldHVybiBzdWNjZXNzL2ZhaWx1cmUKICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKQogICAgICAgIHdoZW5Ob3RQYXVzZWQgbGltaXRGb3JPd25lciBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQogICAgewogICAgICAgIHJldHVybiBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIuCiAgICAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tLgogICAgICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHRyYW5zZmVyIHRvLgogICAgICogQHBhcmFtIF92YWx1ZSB0aGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZC4KICAgICAqIEByZXR1cm4gc3VjY2Vzcy9mYWlsdXJlCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpCiAgICAgICAgd2hlbk5vdFBhdXNlZCBsaW1pdEZvck93bmVyIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgICB7CiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBBcHByb3ZlIHRoZSBzcGVjaWZpZWQgYWRkcmVzcyB0byBzcGVuZCB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiB0b2tlbnMgb24gYmVoYWxmIG9mIHRoZSBtc2cuc2VuZGVyLgogICAgICogVXNlICJpbmNyZWFzZUFwcHJvdmFsIiBvciAiZGVjcmVhc2VBcHByb3ZhbCIgZnVuY3Rpb24gdG8gY2hhbmdlIHRoZSBhcHByb3ZhbCwgaWYgbmVlZGVkLgogICAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAgICAqIEByZXR1cm4gc3VjY2Vzcy9mYWlsdXJlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpCiAgICAgICAgd2hlbk5vdFBhdXNlZCBsaW1pdEZvck93bmVyIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgICB7CiAgICAgICAgcmVxdWlyZSgoX3ZhbHVlID09IDApIHx8IChhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9PSAwKSk7CiAgICAgICAgcmV0dXJuIHN1cGVyLmFwcHJvdmUoX3NwZW5kZXIsIF92YWx1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEluY3JlYXNlIHRoZSBhcHByb3ZhbCBmb3IgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRva2VucyBvbiBiZWhhbGYgb2YgdGhlIG1zZy5zZW5kZXIuCiAgICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICAgKiBAcGFyYW0gX2FkZGVkVmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gaW5jcmVhc2UgdGhlIGFwcHJvdmFsIHdpdGguCiAgICAgKiBAcmV0dXJuIHN1Y2Nlc3MvZmFpbHVyZQogICAgICovCiAgICBmdW5jdGlvbiBpbmNyZWFzZUFwcHJvdmFsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2FkZGVkVmFsdWUpCiAgICAgICAgd2hlbk5vdFBhdXNlZCBsaW1pdEZvck93bmVyIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgICB7CiAgICAgICAgcmV0dXJuIHN1cGVyLmluY3JlYXNlQXBwcm92YWwoX3NwZW5kZXIsIF9hZGRlZFZhbHVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgRGVjcmVhc2UgdGhlIGFwcHJvdmFsIGZvciB0aGUgcGFzc2VkIGFkZHJlc3MgdG8gc3BlbmQgdG9rZW5zIG9uIGJlaGFsZiBvZiB0aGUgbXNnLnNlbmRlci4KICAgICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgICAqIEBwYXJhbSBfc3VidHJhY3RlZFZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGRlY3JlYXNlIHRoZSBhcHByb3ZhbCB3aXRoLgogICAgICogQHJldHVybiBzdWNjZXNzL2ZhaWx1cmUKICAgICAqLwogICAgZnVuY3Rpb24gZGVjcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9zdWJ0cmFjdGVkVmFsdWUpCiAgICAgICAgd2hlbk5vdFBhdXNlZCBsaW1pdEZvck93bmVyIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgICB7CiAgICAgICAgcmV0dXJuIHN1cGVyLmRlY3JlYXNlQXBwcm92YWwoX3NwZW5kZXIsIF9zdWJ0cmFjdGVkVmFsdWUpOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFdpdGhkcmF3IHRoZSBhbGxvd2VkIHZhbHVlIChldGhlcnMpIGZyb20gdGhlIGNvbnRyYWN0IGJhbGFuY2UuCiAgICAgKiBAcmV0dXJuIHN1Y2Nlc3MvZmFpbHVyZQogICAgICovCiAgICBmdW5jdGlvbiB3aXRoZHJhdygpIHdoZW5Ob3RQYXVzZWQgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJldHVybiBzdXBlci53aXRoZHJhdygpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIHdoZW4gSUNPIGlzIGFjdGl2ZS4KICAgICAqLwogICAgbW9kaWZpZXIgd2hlbkNsb3NlZCgpIHsKICAgICAgICByZXF1aXJlKHBoYXNlID09IFBoYXNlcy5BZnRlckljbyk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCB3aGVuIElDTyBpcyBjb21wbGV0ZWQuCiAgICAgKi8KICAgIG1vZGlmaWVyIHdoZW5Ob3RDbG9zZWQoKSB7CiAgICAgICAgcmVxdWlyZShwaGFzZSAhPSBQaGFzZXMuQWZ0ZXJJY28pOwogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgdGhlIG93bmVyIGJlZm9yZSBJQ08gaXMgY29tcGxldGVkLgogICAgICovCiAgICBtb2RpZmllciBsaW1pdEZvck93bmVyKCkgewogICAgICAgIHJlcXVpcmUoKG1zZy5zZW5kZXIgIT0gb3duZXIpIHx8IChwaGFzZSA9PSBQaGFzZXMuQWZ0ZXJJY28pKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJlZm9yZSByZXR1cm5BbGxvd2VkVGltZS4KICAgICAqLwogICAgbW9kaWZpZXIgYWZ0ZXJXaXRoZHJhd1BhdXNlKCkgewogICAgICAgIHJlcXVpcmUobm93ID4gcmV0dXJuQWxsb3dlZFRpbWUpOwogICAgICAgIF87CiAgICB9Cgp9'.
	

]
