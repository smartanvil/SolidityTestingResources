Class {
	#name : #SRTbb03c8c529cce73ee350a4ebb2a6f712a8e9e348,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTbb03c8c529cce73ee350a4ebb2a6f712a8e9e348 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKioKICogQHRpdGxlIEludGVyYWN0aXZlQ3Jvd2RzYWxlTGliCiAqIEBhdXRob3IgTW9kdWxhciwgSW5jCiAqCiAqIHZlcnNpb24gMS4wLjAKICogQ29weXJpZ2h0IChjKSAyMDE3IE1vZHVsYXIsIEluYwogKiBUaGUgTUlUIExpY2Vuc2UgKE1JVCkKICoKICogVGhlIEludGVyYWN0aXZlQ3Jvd2RzYWxlIExpYnJhcnkgcHJvdmlkZXMgZnVuY3Rpb25hbGl0eSB0byBjcmVhdGUgYSBjcm93ZHNhbGUKICogYmFzZWQgb24gdGhlIHdoaXRlIHBhcGVyIGluaXRpYWxseSBwcm9wb3NlZCBieSBKYXNvbiBUZXV0c2NoIGFuZCBWaXRhbGlrCiAqIEJ1dGVyaW4uIFNlZSBodHRwczovL3Blb3BsZS5jcy51Y2hpY2Fnby5lZHUvfnRldXRzY2gvcGFwZXJzL2ljby5wZGYgZm9yCiAqIGZ1cnRoZXIgaW5mb3JtYXRpb24uCiAqCiAqIFRoaXMgbGlicmFyeSB3YXMgZGV2ZWxvcGVkIGluIGEgY29sbGFib3JhdGl2ZSBlZmZvcnQgYW1vbmcgbWFueSBvcmdhbml6YXRpb25zCiAqIGluY2x1ZGluZyBUcnVlQml0LCBNb2R1bGFyLCBhbmQgQ29uc2Vuc3lzLgogKiBGb3IgZnVydGhlciBpbmZvcm1hdGlvbjogdHJ1ZWJpdC5pbywgbW9kdWxhci5uZXR3b3JrLAogKiBjb25zZW5zeXMubmV0CiAqCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTCiAqIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YKICogTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULgogKiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWQogKiBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULAogKiBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRQogKiBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KICovCgpsaWJyYXJ5IEludGVyYWN0aXZlQ3Jvd2RzYWxlTGliIHsKICB1c2luZyBCYXNpY01hdGhMaWIgZm9yIHVpbnQyNTY7CiAgdXNpbmcgVG9rZW5MaWIgZm9yIFRva2VuTGliLlRva2VuU3RvcmFnZTsKICB1c2luZyBMaW5rZWRMaXN0TGliIGZvciBMaW5rZWRMaXN0TGliLkxpbmtlZExpc3Q7CiAgdXNpbmcgQ3Jvd2RzYWxlTGliIGZvciBDcm93ZHNhbGVMaWIuQ3Jvd2RzYWxlU3RvcmFnZTsKCiAgLy8gTm9kZSBjb25zdGFudHMgZm9yIHVzZSBpbiB0aGUgbGlua2VkIGxpc3QKICB1aW50MjU2IGNvbnN0YW50IE5VTEwgPSAwOwogIHVpbnQyNTYgY29uc3RhbnQgSEVBRCA9IDA7CiAgYm9vbCBjb25zdGFudCBQUkVWID0gZmFsc2U7CiAgYm9vbCBjb25zdGFudCBORVhUID0gdHJ1ZTsKCiAgc3RydWN0IEludGVyYWN0aXZlQ3Jvd2RzYWxlU3RvcmFnZSB7CgogICAgQ3Jvd2RzYWxlTGliLkNyb3dkc2FsZVN0b3JhZ2UgYmFzZTsgLy8gYmFzZSBzdG9yYWdlIGZyb20gQ3Jvd2RzYWxlTGliCgogICAgLy8gTGlzdCBvZiBwZXJzb25hbCB2YWx1YXRpb25zLCBzb3J0ZWQgZnJvbSBzbWFsbGVzdCB0byBsYXJnZXN0IChmcm9tIExpbmtlZExpc3RMaWIpCiAgICBMaW5rZWRMaXN0TGliLkxpbmtlZExpc3QgdmFsdWF0aW9uc0xpc3Q7CgogICAgLy8gSW5mbyBob2xkZXIgZm9yIHRva2VuIGNyZWF0aW9uCiAgICBUb2tlbkxpYi5Ub2tlblN0b3JhZ2UgdG9rZW5JbmZvOwoKICAgIHVpbnQyNTYgZW5kV2l0aGRyYXdhbFRpbWU7ICAgLy8gdGltZSB3aGVuIG1hbnVhbCB3aXRoZHJhd2FscyBhcmUgbm8gbG9uZ2VyIGFsbG93ZWQKCiAgICAvLyBjdXJyZW50IHRvdGFsIHZhbHVhdGlvbiBvZiB0aGUgc2FsZQogICAgLy8gYWN0dWFsIGFtb3VudCBvZiBFVEggY29tbWl0dGVkLCB0YWtpbmcgaW50byBhY2NvdW50IHBhcnRpYWwgcHVyY2hhc2VzCiAgICB1aW50MjU2IHRvdGFsVmFsdWF0aW9uOwoKICAgIC8vIGFtb3VudCBvZiB2YWx1ZSBjb21taXR0ZWQgYXQgdGhpcyB2YWx1YXRpb24sIGNhbm5vdCByZWx5IG9uIG93bmVyIGJhbGFuY2UKICAgIC8vIGR1ZSB0byBmbHVjdGF0aW9ucyBpbiBjb21taXRtZW50IGNhbGN1bGF0aW9ucyBuZWVkZWQgYWZ0ZXIgb3duZXIgd2l0aGRyYXdzCiAgICAvLyBpbiBvdGhlciB3b3JkcywgdGhlIHRvdGFsIGFtb3VudCBvZiBFVEggY29tbWl0dGVkLCBpbmNsdWRpbmcgdG90YWwgYmlkcwogICAgLy8gdGhhdCB3aWxsIGV2ZW50dWFsbHkgZ2V0IHBhcnRpYWwgcHVyY2hhc2VzCiAgICB1aW50MjU2IHZhbHVlQ29tbWl0dGVkOwoKICAgIC8vIHRoZSBidWNrZXQgdGhhdCBzaXRzIGVpdGhlciBhdCBvciBqdXN0IGJlbG93IGN1cnJlbnQgdG90YWwgdmFsdWF0aW9uLgogICAgLy8gZGV0ZXJtaW5lcyB3aGVyZSB0aGUgY3V0b2ZmIHBvaW50IGlzIGZvciBiaWRzIGluIHRoZSBzYWxlCiAgICB1aW50MjU2IGN1cnJlbnRCdWNrZXQ7CgogICAgLy8gdGhlIGZyYWN0aW9uIG9mIGVhY2ggbWluaW1hbCB2YWx1YXRpb24gYmlkZGVyJ3MgZXRoZXIgcmVmdW5kLCAncScgaXMgZnJvbSB0aGUgcGFwZXIKICAgIC8vIGFuZCBpcyBjYWxjdWxhdGVkIHdoZW4gZmluYWxpemluZyB0aGUgc2FsZQogICAgdWludDI1NiBxOwoKICAgIC8vIG1pbmltaW0gYW1vdW50IHRoYXQgdGhlIHNhbGUgbmVlZHMgdG8gbWFrZSB0byBiZSBzdWNjZXNzZnVsbAogICAgdWludDI1NiBtaW5pbXVtUmFpc2U7CgogICAgLy8gcGVyY2VudGFnZSBvZiB0b3RhbCB0b2tlbnMgYmVpbmcgc29sZCBpbiB0aGlzIHNhbGUKICAgIHVpbnQ4IHBlcmNlbnRCZWluZ1NvbGQ7CgogICAgLy8gdGhlIGJvbnVzIGFtb3VudCBmb3IgZWFybHkgYmlkZGVycy4gIFRoaXMgaXMgYSBwZXJjZW50YWdlIG9mIHRoZSBiYXNlIHRva2VuCiAgICAvLyBwcmljZSB0aGF0IGdldHMgYWRkZWQgb24gdGhlIHRoZSBiYXNlIHRva2VuIHByaWNlIHVzZWQgaW4gZ2V0Q3VycmVudEJvbnVzKCkKICAgIHVpbnQyNTYgcHJpY2VCb251c1BlcmNlbnQ7CgogICAgLy8gSW5kaWNhdGVzIHRoYXQgdGhlIG93bmVyIGhhcyBmaW5hbGl6ZWQgdGhlIHNhbGUgYW5kIHdpdGhkcmF3biBFdGhlcgogICAgYm9vbCBpc0ZpbmFsaXplZDsKCiAgICAvLyBTZXQgdG8gdHJ1ZSBpZiB0aGUgc2FsZSBpcyBjYW5jZWxlZAogICAgYm9vbCBpc0NhbmNlbGVkOwoKICAgIC8vIHNob3dzIHRoZSBwcmljZSB0aGF0IHRoZSBhZGRyZXNzIHB1cmNoYXNlZCB0b2tlbnMgYXQKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHJpY2VQdXJjaGFzZWRBdDsKCiAgICAvLyB0aGUgc3VtcyBvZiBiaWRzIGF0IGVhY2ggdmFsdWF0aW9uLiAgVXNlZCB0byBjYWxjdWxhdGUgdGhlIGN1cnJlbnQgYnVja2V0IGZvciB0aGUgdmFsdWF0aW9uIHBvaW50ZXIKICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gdWludDI1NikgdmFsdWF0aW9uU3VtczsKCiAgICAvLyB0aGUgbnVtYmVyIG9mIGFjdGl2ZSBiaWRzIGF0IGEgY2VydGFpbiB2YWx1YXRpb24gY2FwCiAgICBtYXBwaW5nICh1aW50MjU2ID0+IHVpbnQyNTYpIG51bUJpZHNBdFZhbHVhdGlvbjsKCiAgICAvLyB0aGUgdmFsdWF0aW9uIGNhcCB0aGF0IGVhY2ggYWRkcmVzcyBoYXMgc3VibWl0dGVkCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHBlcnNvbmFsQ2FwczsKCiAgICAvLyBzaG93cyBpZiBhbiBhZGRyZXNzIGhhcyBkb25lIGEgbWFudWFsIHdpdGhkcmF3YWwuIG1hbnVhbCB3aXRoZHJhd2FscyBhcmUgb25seSBhbGxvd2VkIG9uY2UKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgaGFzTWFudWFsbHlXaXRoZHJhd247CiAgfQoKICAvLyBJbmRpY2F0ZXMgd2hlbiBhIGJpZGRlciBzdWJtaXRzIGEgYmlkIHRvIHRoZSBjcm93ZHNhbGUKICBldmVudCBMb2dCaWRBY2NlcHRlZChhZGRyZXNzIGluZGV4ZWQgYmlkZGVyLCB1aW50MjU2IGFtb3VudCwgdWludDI1NiBwZXJzb25hbFZhbHVhdGlvbik7CgogIC8vIEluZGljYXRlcyB3aGVuIGEgYmlkZGVyIG1hbnVhbGx5IHdpdGhkcmF3cyB0aGVpciBiaWQgZnJvbSB0aGUgY3Jvd2RzYWxlCiAgZXZlbnQgTG9nQmlkV2l0aGRyYXduKGFkZHJlc3MgaW5kZXhlZCBiaWRkZXIsIHVpbnQyNTYgYW1vdW50LCB1aW50MjU2IHBlcnNvbmFsVmFsdWF0aW9uKTsKCiAgLy8gSW5kaWNhdGVzIHdoZW4gYSBiaWQgaXMgcmVtb3ZlZCBieSB0aGUgYXV0b21hdGVkIGJpZCByZW1vdmFsIHByb2Nlc3MKICBldmVudCBMb2dCaWRSZW1vdmVkKGFkZHJlc3MgaW5kZXhlZCBiaWRkZXIsIHVpbnQyNTYgcGVyc29uYWxWYWx1YXRpb24pOwoKICAvLyBHZW5lcmljIEVycm9yIE1zZyBFdmVudAogIGV2ZW50IExvZ0Vycm9yTXNnKHVpbnQyNTYgYW1vdW50LCBzdHJpbmcgTXNnKTsKCiAgLy8gSW5kaWNhdGVzIHdoZW4gdGhlIHByaWNlIG9mIHRoZSB0b2tlbiBjaGFuZ2VzCiAgZXZlbnQgTG9nVG9rZW5QcmljZUNoYW5nZSh1aW50MjU2IGFtb3VudCwgc3RyaW5nIE1zZyk7CgogIC8vIExvZ3MgdGhlIGN1cnJlbnQgYnVja2V0IHRoYXQgdGhlIHZhbHVhdGlvbiBwb2ludHMgdG8sIHRoZSB0b3RhbCB2YWx1YXRpb24gb2YKICAvLyB0aGUgc2FsZSwgYW5kIHRoZSBhbW91bnQgb2YgRVRIIGNvbW1pdHRlZCwgaW5jbHVkaW5nIHRvdGFsIGJpZHMgdGhhdCB3aWxsIGV2ZW50dWFsbHkgZ2V0IHBhcnRpYWwgcHVyY2hhc2VzCiAgZXZlbnQgQnVja2V0QW5kVmFsdWF0aW9uQW5kQ29tbWl0dGVkKHVpbnQyNTYgYnVja2V0LCB1aW50MjU2IHZhbHVhdGlvbiwgdWludDI1NiBjb21taXR0ZWQpOwoKICAvLy8gQGRldiBDYWxsZWQgYnkgYSBjcm93ZHNhbGUgY29udHJhY3QgdXBvbiBjcmVhdGlvbi4KICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcGFyYW0gX293bmVyIEFkZHJlc3Mgb2YgY3Jvd2RzYWxlIG93bmVyCiAgLy8vIEBwYXJhbSBfc2FsZURhdGEgQXJyYXkgb2YgMyBpdGVtIGFycmF5cyBzdWNoIHRoYXQsIGluIGVhY2ggMyBlbGVtZW50CiAgLy8vIGFycmF5IGluZGV4LTAgaXMgYSB0aW1lc3RhbXAsIGluZGV4LTEgaXMgcHJpY2UgaW4gdG9rZW5zL0VUSAogIC8vLyBpbmRleC0yIGlzIGFkZHJlc3MgcHVyY2hhc2UgY2FwIGF0IHRoYXQgdGltZSwgMCBpZiBubyBhZGRyZXNzIGNhcAogIC8vLyBAcGFyYW0gX3ByaWNlQm9udXNQZXJjZW50IHRoZSBib251cyBhbW91bnQgZm9yIGVhcmx5IGJpZGRlcnMKICAvLy8gQHBhcmFtIF9taW5pbXVtUmFpc2UgbWluaW1pbSBhbW91bnQgdGhhdCB0aGUgc2FsZSBuZWVkcyB0byBtYWtlIHRvIGJlIHN1Y2Nlc3NmdWxsCiAgLy8vIEBwYXJhbSBfZW5kV2l0aGRyYXdhbFRpbWUgdGltZXN0YW1wIHRoYXQgaW5kaWNhdGVzIHRoYXQgbWFudWFsIHdpdGhkcmF3YWxzIGFyZSBubyBsb25nZXIgYWxsb3dlZAogIC8vLyBAcGFyYW0gX2VuZFRpbWUgVGltZXN0YW1wIG9mIHNhbGUgZW5kIHRpbWUKICAvLy8gQHBhcmFtIF9wZXJjZW50QmVpbmdTb2xkIHBlcmNlbnRhZ2Ugb2YgdG90YWwgdG9rZW5zIGJlaW5nIHNvbGQgaW4gdGhlIHNhbGUKICAvLy8gQHBhcmFtIF90b2tlbk5hbWUgbmFtZSBvZiB0aGUgdG9rZW4gYmVpbmcgc29sZC4gZXg6ICJKYXNvbiBOZXR3b3JrIFRva2VuIgogIC8vLyBAcGFyYW0gX3Rva2VuU3ltYm9sIHN5bWJvbCBvZiB0aGUgdG9rZW4uIGV4OiAiSk5UIgogIC8vLyBAcGFyYW0gX3Rva2VuRGVjaW1hbHMgbnVtYmVyIG9mIGRlY2ltYWxzIGluIHRoZSB0b2tlbgogIC8vLyBAcGFyYW0gX2FsbG93TWludGluZyB3aGV0aGVyIG9yIG5vdCB0byBhbGxvdyBtaW50aW5nIG9mIHRoZSB0b2tlbiBhZnRlciB0aGUgc2FsZQogIGZ1bmN0aW9uIGluaXQoSW50ZXJhY3RpdmVDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZiwKICAgICAgICAgICAgICAgIGFkZHJlc3MgX293bmVyLAogICAgICAgICAgICAgICAgdWludDI1NltdIF9zYWxlRGF0YSwKICAgICAgICAgICAgICAgIHVpbnQyNTYgX3ByaWNlQm9udXNQZXJjZW50LAogICAgICAgICAgICAgICAgdWludDI1NiBfbWluaW11bVJhaXNlLAogICAgICAgICAgICAgICAgdWludDI1NiBfZW5kV2l0aGRyYXdhbFRpbWUsCiAgICAgICAgICAgICAgICB1aW50MjU2IF9lbmRUaW1lLAogICAgICAgICAgICAgICAgdWludDggX3BlcmNlbnRCZWluZ1NvbGQsCiAgICAgICAgICAgICAgICBzdHJpbmcgX3Rva2VuTmFtZSwKICAgICAgICAgICAgICAgIHN0cmluZyBfdG9rZW5TeW1ib2wsCiAgICAgICAgICAgICAgICB1aW50OCBfdG9rZW5EZWNpbWFscywKICAgICAgICAgICAgICAgIGJvb2wgX2FsbG93TWludGluZykgcHVibGljCiAgewogICAgc2VsZi5iYXNlLmluaXQoX293bmVyLAogICAgICAgICAgICAgICAgX3NhbGVEYXRhLAogICAgICAgICAgICAgICAgX2VuZFRpbWUsCiAgICAgICAgICAgICAgICAwLCAvLyBubyB0b2tlbiBidXJuaW5nIGZvciBpaWNvCiAgICAgICAgICAgICAgICBDcm93ZHNhbGVUb2tlbigwKSk7IC8vIG5vIHRva2VucyBjcmVhdGVkIHByaW9yIHRvIGlpY28KCiAgICByZXF1aXJlKF9lbmRXaXRoZHJhd2FsVGltZSA8IF9lbmRUaW1lKTsKICAgIHJlcXVpcmUoX2VuZFdpdGhkcmF3YWxUaW1lID4gX3NhbGVEYXRhWzBdKTsKICAgIHJlcXVpcmUoX21pbmltdW1SYWlzZSA+IDApOwogICAgcmVxdWlyZShfcGVyY2VudEJlaW5nU29sZCA+IDApOwogICAgcmVxdWlyZShfcGVyY2VudEJlaW5nU29sZCA8PSAxMDApOwogICAgcmVxdWlyZShfcHJpY2VCb251c1BlcmNlbnQgPiAwKTsKCiAgICBzZWxmLm1pbmltdW1SYWlzZSA9IF9taW5pbXVtUmFpc2U7CiAgICBzZWxmLmVuZFdpdGhkcmF3YWxUaW1lID0gX2VuZFdpdGhkcmF3YWxUaW1lOwogICAgc2VsZi5wZXJjZW50QmVpbmdTb2xkID0gX3BlcmNlbnRCZWluZ1NvbGQ7CiAgICBzZWxmLnByaWNlQm9udXNQZXJjZW50ID0gX3ByaWNlQm9udXNQZXJjZW50OwoKICAgIHNlbGYudG9rZW5JbmZvLm5hbWUgPSBfdG9rZW5OYW1lOwogICAgc2VsZi50b2tlbkluZm8uc3ltYm9sID0gX3Rva2VuU3ltYm9sOwogICAgc2VsZi50b2tlbkluZm8uZGVjaW1hbHMgPSBfdG9rZW5EZWNpbWFsczsKICAgIHNlbGYudG9rZW5JbmZvLnN0aWxsTWludGluZyA9IF9hbGxvd01pbnRpbmc7CiAgfQoKICAvLy8gQGRldiBjYWxjdWxhdGVzIHRoZSBudW1iZXIgb2YgZGlnaXRzIGluIGEgZ2l2ZW4gbnVtYmVyCiAgLy8vIEBwYXJhbSBfbnVtYmVyIHRoZSBudW1iZXIgZm9yIHdoaWNoIHdlJ3JlIGNhbHVjbGF0aW5nIGRpZ2l0cwogIC8vLyBAcmV0dXJuIF9kaWdpdHMgdGhlIG51bWJlciBvZiBkaWdpdHMgaW4gX251bWJlcgogIGZ1bmN0aW9uIG51bURpZ2l0cyh1aW50MjU2IF9udW1iZXIpIHB1YmxpYyBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgX2RpZ2l0cyA9IDA7CiAgICB3aGlsZSAoX251bWJlciAhPSAwKSB7CiAgICAgIF9udW1iZXIgLz0gMTA7CiAgICAgIF9kaWdpdHMrKzsKICAgIH0KICAgIHJldHVybiBfZGlnaXRzOwogIH0KCiAgLy8vIEBkZXYgY2FsY3VsYXRlcyB0aGUgbnVtYmVyIG9mIHRva2VucyBwdXJjaGFzZWQgYmFzZWQgb24gdGhlIGFtb3VudCBvZiB3ZWkKICAvLy8gICAgICBzcGVudCBhbmQgdGhlIHByaWNlIG9mIHRva2VucwogIC8vLyBAcGFyYW0gX2Ftb3VudCBhbW91bmQgb2Ygd2VpIHRoYXQgdGhlIGJ1eWVyIHNlbnQKICAvLy8gQHBhcmFtIF9wcmljZSBwcmljZSBvZiB0b2tlbnMgaW4gdGhlIHNhbGUsIGluIHRva2Vucy9FVEgKICAvLy8gQHJldHVybiB1aW50MjU2IG51bVRva2VucyB0aGUgbnVtYmVyIG9mIHRva2VucyBwdXJjaGFzZWQKICAvLy8gQHJldHVybiByZW1haW5kZXIgIGFueSByZW1haW5pbmcgd2VpIGxlZnRvdmVyIGZyb20gaW50ZWdlciBkaXZpc2lvbgogIGZ1bmN0aW9uIGNhbGN1bGF0ZVRva2VuUHVyY2hhc2UodWludDI1NiBfYW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDI1NiBfcHJpY2UpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlcm5hbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVyZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJucyAodWludDI1Nix1aW50MjU2KQogIHsKICAgIHVpbnQyNTYgcmVtYWluZGVyID0gMDsgLy90ZW1wIGNhbGMgaG9sZGVyIGZvciBkaXZpc2lvbiByZW1haW5kZXIgZm9yIGxlZnRvdmVyIHdlaQoKICAgIGJvb2wgZXJyOwogICAgdWludDI1NiBudW1Ub2tlbnM7CiAgICB1aW50MjU2IHdlaVRva2VuczsgLy90ZW1wIGNhbGMgaG9sZGVyCgogICAgLy8gRmluZCB0aGUgbnVtYmVyIG9mIHRva2VucyBhcyBhIGZ1bmN0aW9uIGluIHdlaQogICAgKGVycix3ZWlUb2tlbnMpID0gX2Ftb3VudC50aW1lcyhfcHJpY2UpOwogICAgcmVxdWlyZSghZXJyKTsKCiAgICBudW1Ub2tlbnMgPSB3ZWlUb2tlbnMgLyAxMDAwMDAwMDAwMDAwMDAwMDAwOwogICAgcmVtYWluZGVyID0gd2VpVG9rZW5zICUgMTAwMDAwMDAwMDAwMDAwMDAwMDsKICAgIHJlbWFpbmRlciA9IHJlbWFpbmRlciAvIF9wcmljZTsKCiAgICByZXR1cm4gKG51bVRva2VucyxyZW1haW5kZXIpOwogIH0KCiAgLy8vIEBkZXYgQ2FsbGVkIHdoZW4gYW4gYWRkcmVzcyB3YW50cyB0byBzdWJtaXQgYSBiaWQgdG8gdGhlIHNhbGUKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcmV0dXJuIGN1cnJlbnRCb251cyBwZXJjZW50YWdlIG9mIHRoZSBib251cyB0aGF0IGlzIGFwcGxpZWQgZm9yIHRoZSBwdXJjaGFzZQogIGZ1bmN0aW9uIGdldEN1cnJlbnRCb251cyhJbnRlcmFjdGl2ZUNyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpewogICAgLy8gY2FuJ3QgdW5kZXJmbG93IGJlY3Vhc2UgZW5kV2l0aGRyYXdhbFRpbWUgPiBzdGFydFRpbWUKICAgIHVpbnQyNTYgYm9udXNUaW1lID0gc2VsZi5lbmRXaXRoZHJhd2FsVGltZSAtIHNlbGYuYmFzZS5zdGFydFRpbWU7CiAgICAvLyBjYW4ndCB1bmRlcmZsb3cgYmVjYXVzZSBub3cgPiBzdGFydFRpbWUKICAgIHVpbnQyNTYgZWxhcHNlZCA9IG5vdyAtIHNlbGYuYmFzZS5zdGFydFRpbWU7CiAgICB1aW50MjU2IHBlcmNlbnRFbGFwc2VkID0gKGVsYXBzZWQgKiAxMDApL2JvbnVzVGltZTsKCiAgICBib29sIGVycjsKICAgIHVpbnQyNTYgY3VycmVudEJvbnVzOwogICAgKGVycixjdXJyZW50Qm9udXMpID0gc2VsZi5wcmljZUJvbnVzUGVyY2VudC5taW51cygoKHBlcmNlbnRFbGFwc2VkICogc2VsZi5wcmljZUJvbnVzUGVyY2VudCkvMTAwKSk7CiAgICByZXF1aXJlKCFlcnIpOwoKICAgIHJldHVybiBjdXJyZW50Qm9udXM7CiAgfQoKICAvLy8gQGRldiBDYWxsZWQgd2hlbiBhbiBhZGRyZXNzIHdhbnRzIHRvIHN1Ym1pdCBiaWQgdG8gdGhlIHNhbGUKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcGFyYW0gX2Ftb3VudCBhbW91bmQgb2Ygd2VpIHRoYXQgdGhlIGJ1eWVyIGlzIHNlbmRpbmcKICAvLy8gQHBhcmFtIF9wZXJzb25hbENhcCB0aGUgdG90YWwgY3Jvd2RzYWxlIHZhbHVhdGlvbiAod2VpKSB0aGF0IHRoZSBiaWRkZXIgaXMgY29tZm9ydGFibGUgd2l0aAogIC8vLyBAcGFyYW0gX3ZhbHVlUHJlZGljdCBwcmVkaWN0aW9uIG9mIHdoZXJlIHRoZSB2YWx1YXRpb24gd2lsbCBnbyBpbiB0aGUgbGlua2VkIGxpc3QuIHNhdmVzIG9uIHNlYXJjaGluZyB0aW1lCiAgLy8vIEByZXR1cm4gdHJ1ZSBvbiBzdWNjZXNmdWwgYmlkCiAgZnVuY3Rpb24gc3VibWl0QmlkKEludGVyYWN0aXZlQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYsCiAgICAgICAgICAgICAgICAgICAgICB1aW50MjU2IF9hbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICB1aW50MjU2IF9wZXJzb25hbENhcCwKICAgICAgICAgICAgICAgICAgICAgIHVpbnQyNTYgX3ZhbHVlUHJlZGljdCkgcHVibGljIHJldHVybnMgKGJvb2wpCiAgewogICAgcmVxdWlyZShtc2cuc2VuZGVyICE9IHNlbGYuYmFzZS5vd25lcik7CiAgICByZXF1aXJlKHNlbGYuYmFzZS52YWxpZFB1cmNoYXNlKCkpOwogICAgLy8gYmlkZGVyIGNhbid0IGhhdmUgYWxyZWFkeSBiaWQKICAgIHJlcXVpcmUoKHNlbGYucGVyc29uYWxDYXBzW21zZy5zZW5kZXJdID09IDApICYmIChzZWxmLmJhc2UuaGFzQ29udHJpYnV0ZWRbbXNnLnNlbmRlcl0gPT0gMCkpOwoKICAgIHVpbnQyNTYgX2JvbnVzUGVyY2VudDsKICAgIC8vIHRva2VuIHB1cmNoYXNlIGJvbnVzIG9ubHkgYXBwbGllcyBiZWZvcmUgdGhlIHdpdGhkcmF3YWwgbG9jawogICAgaWYgKG5vdyA8IHNlbGYuZW5kV2l0aGRyYXdhbFRpbWUpIHsKICAgICAgcmVxdWlyZShfcGVyc29uYWxDYXAgPiBfYW1vdW50KTsKICAgICAgX2JvbnVzUGVyY2VudCA9IGdldEN1cnJlbnRCb251cyhzZWxmKTsKICAgIH0gZWxzZSB7CiAgICAgIC8vIFRoZSBwZXJzb25hbCB2YWx1YXRpb24gc3VibWl0dGVkIG11c3QgYmUgZ3JlYXRlciB0aGFuIHRoZSBjdXJyZW50CiAgICAgIC8vIHZhbHVhdGlvbiBwbHVzIHRoZSBiaWQgaWYgYWZ0ZXIgdGhlIHdpdGhkcmF3YWwgbG9jay4KICAgICAgcmVxdWlyZShfcGVyc29uYWxDYXAgPj0gc2VsZi50b3RhbFZhbHVhdGlvbiArIF9hbW91bnQpOwogICAgfQoKICAgIC8vIHBlcnNvbmFsIHZhbHVhdGlvbiBhbmQgbWluaW11bSBzaG91bGQgYmUgc2V0IHRvIHRoZSBwcm9wZXIgZ3JhbnVsYXJpdHksCiAgICAvLyBvbmx5IHRocmVlIG1vc3Qgc2lnbmlmaWNhbnQgdmFsdWVzIGNhbiBiZSBub24temVyby4gcmVkdWNlcyB0aGUgbnVtYmVyIG9mIHBvc3NpYmxlCiAgICAvLyB2YWx1YXRpb24gYnVja2V0cyBpbiB0aGUgbGlua2VkIGxpc3QKICAgIHVpbnQyNTYgZGlnaXRzID0gbnVtRGlnaXRzKF9wZXJzb25hbENhcCk7CiAgICBpZihkaWdpdHMgPiAzKSB7CiAgICAgIHJlcXVpcmUoKF9wZXJzb25hbENhcCAlICgxMCoqKGRpZ2l0cyAtIDMpKSkgPT0gMCk7CiAgICB9CgogICAgLy8gYWRkIHRoZSBiaWQgdG8gdGhlIHNvcnRlZCB2YWx1YXRpb25zIGxpc3QKICAgIC8vIGR1cGxpY2F0ZSBwZXJzb25hbCB2YWx1YXRpb24gY2FwcyBzaGFyZSBhIHNwb3QgaW4gdGhlIGxpbmtlZCBsaXN0CiAgICB1aW50MjU2IF9saXN0U3BvdDsKICAgIGlmKCFzZWxmLnZhbHVhdGlvbnNMaXN0Lm5vZGVFeGlzdHMoX3BlcnNvbmFsQ2FwKSl7CiAgICAgICAgX2xpc3RTcG90ID0gc2VsZi52YWx1YXRpb25zTGlzdC5nZXRTb3J0ZWRTcG90KF92YWx1ZVByZWRpY3QsX3BlcnNvbmFsQ2FwLE5FWFQpOwogICAgICAgIHNlbGYudmFsdWF0aW9uc0xpc3QuaW5zZXJ0KF9saXN0U3BvdCxfcGVyc29uYWxDYXAsUFJFVik7CiAgICB9CgogICAgLy8gYWRkIHRoZSBiaWQgdG8gdGhlIGFkZHJlc3MgPT4gY2FwIG1hcHBpbmcKICAgIHNlbGYucGVyc29uYWxDYXBzW21zZy5zZW5kZXJdID0gX3BlcnNvbmFsQ2FwOwoKICAgIC8vIGFkZCB0aGUgYmlkIHRvIHRoZSBzdW0gb2YgYmlkcyBhdCB0aGlzIHZhbHVhdGlvbi4gTmVlZGVkIGZvciBjYWxjdWxhdGluZyBjb3JyZWN0IHZhbHVhdGlvbiBwb2ludGVyCiAgICBzZWxmLnZhbHVhdGlvblN1bXNbX3BlcnNvbmFsQ2FwXSArPSBfYW1vdW50OwogICAgc2VsZi5udW1CaWRzQXRWYWx1YXRpb25bX3BlcnNvbmFsQ2FwXSArPSAxOwoKICAgIC8vIGFkZCB0aGUgYmlkIHRvIGJpZGRlcidzIGNvbnRyaWJ1dGlvbiBhbW91bnQKICAgIHNlbGYuYmFzZS5oYXNDb250cmlidXRlZFttc2cuc2VuZGVyXSArPSBfYW1vdW50OwoKICAgIC8vIHRlbXAgdmFyaWFibGVzIGZvciBjYWxjdWxhdGlvbgogICAgdWludDI1NiBfcHJvcG9zZWRDb21taXQ7CiAgICB1aW50MjU2IF9jdXJyZW50QnVja2V0OwogICAgYm9vbCBsb29wOwogICAgYm9vbCBleGlzdHM7CgogICAgLy8gd2Ugb25seSBhZmZlY3QgdGhlIHBvaW50ZXIgaWYgd2UgYXJlIGNvbWluZyBpbiBhYm92ZSBpdAogICAgaWYoX3BlcnNvbmFsQ2FwID4gc2VsZi5jdXJyZW50QnVja2V0KXsKCiAgICAgIC8vIGlmIG91ciB2YWx1YXRpb24gaXMgc2l0dGluZyBhdCB0aGUgY3VycmVudCBidWNrZXQgdGhlbiB3ZSBhcmUgdXNpbmcKICAgICAgLy8gY29tbWl0bWVudHMgcmlnaHQgYXQgdGhlaXIgY2FwCiAgICAgIGlmIChzZWxmLnRvdGFsVmFsdWF0aW9uID09IHNlbGYuY3VycmVudEJ1Y2tldCkgewogICAgICAgIC8vIHdlIGFyZSBnb2luZyB0byBkcm9wIHRob3NlIGNvbW1pdG1lbnRzIHRvIHNlZSBpZiB3ZSBhcmUgZ29pbmcgdG8gYmUKICAgICAgICAvLyBncmVhdGVyIHRoYW4gdGhlIGN1cnJlbnQgYnVja2V0IHdpdGhvdXQgdGhlbQogICAgICAgIF9wcm9wb3NlZENvbW1pdCA9IChzZWxmLnZhbHVlQ29tbWl0dGVkIC0gc2VsZi52YWx1YXRpb25TdW1zW3NlbGYuY3VycmVudEJ1Y2tldF0pICsgX2Ftb3VudDsKICAgICAgICBpZihfcHJvcG9zZWRDb21taXQgPiBzZWxmLmN1cnJlbnRCdWNrZXQpeyBsb29wID0gdHJ1ZTsgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIGVsc2Ugd2UncmUgc2l0dGluZyBpbiBiZXR3ZWVuIGJ1Y2tldHMgYW5kIGhhdmUgYWxyZWFkeSBkcm9wcGVkIHRoZQogICAgICAgIC8vIHByZXZpb3VzIGNvbW1pdG1lbnRzCiAgICAgICAgX3Byb3Bvc2VkQ29tbWl0ID0gc2VsZi50b3RhbFZhbHVhdGlvbiArIF9hbW91bnQ7CiAgICAgICAgbG9vcCA9IHRydWU7CiAgICAgIH0KCiAgICAgIGlmKGxvb3ApewogICAgICAgIC8vIGlmIHdlJ3JlIGdvaW5nIHRvIGxvb3Agd2UgbW92ZSB0byB0aGUgbmV4dCBidWNrZXQKICAgICAgICAoZXhpc3RzLF9jdXJyZW50QnVja2V0KSA9IHNlbGYudmFsdWF0aW9uc0xpc3QuZ2V0QWRqYWNlbnQoc2VsZi5jdXJyZW50QnVja2V0LCBORVhUKTsKCiAgICAgICAgd2hpbGUoX3Byb3Bvc2VkQ29tbWl0ID49IF9jdXJyZW50QnVja2V0KXsKICAgICAgICAgIC8vIHdoaWxlIHdlIGFyZSBwcm9wb3NlZCBoaWdoZXIgdGhhbiB0aGUgbmV4dCBidWNrZXQgd2UgZHJvcCBjb21taXRtZW50cwogICAgICAgICAgLy8gYW5kIGl0ZXJhdGUgdG8gdGhlIG5leHQKICAgICAgICAgIF9wcm9wb3NlZENvbW1pdCA9IF9wcm9wb3NlZENvbW1pdCAtIHNlbGYudmFsdWF0aW9uU3Vtc1tfY3VycmVudEJ1Y2tldF07CiAgICAgICAgICAoZXhpc3RzLF9jdXJyZW50QnVja2V0KSA9IHNlbGYudmFsdWF0aW9uc0xpc3QuZ2V0QWRqYWNlbnQoX2N1cnJlbnRCdWNrZXQsIE5FWFQpOwogICAgICAgIH0KICAgICAgICAvLyBvbmNlIHdlJ3ZlIHJlYWNoZWQgYSBidWNrZXQgdG9vIGhpZ2ggd2UgbW92ZSBiYWNrIHRvIHRoZSBsYXN0IGJ1Y2tldCBhbmQgc2V0IGl0CiAgICAgICAgKGV4aXN0cywgX2N1cnJlbnRCdWNrZXQpID0gc2VsZi52YWx1YXRpb25zTGlzdC5nZXRBZGphY2VudChfY3VycmVudEJ1Y2tldCwgUFJFVik7CiAgICAgICAgc2VsZi5jdXJyZW50QnVja2V0ID0gX2N1cnJlbnRCdWNrZXQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gZWxzZSB3ZSdyZSBzdGF5aW5nIGF0IHRoZSBjdXJyZW50IGJ1Y2tldAogICAgICAgIF9jdXJyZW50QnVja2V0ID0gc2VsZi5jdXJyZW50QnVja2V0OwogICAgICB9CiAgICAgIC8vIGlmIG91ciBwcm9wb3NlZCBjb21taXRtZW50IGlzIGxlc3MgdGhhbiBvciBlcXVhbCB0byB0aGUgYnVja2V0CiAgICAgIGlmKF9wcm9wb3NlZENvbW1pdCA8PSBfY3VycmVudEJ1Y2tldCl7CiAgICAgICAgLy8gd2UgYWRkIHRoZSBjb21taXRtZW50cyBpbiB0aGF0IGJ1Y2tldAogICAgICAgIF9wcm9wb3NlZENvbW1pdCArPSBzZWxmLnZhbHVhdGlvblN1bXNbX2N1cnJlbnRCdWNrZXRdOwogICAgICAgIC8vIGFuZCBvdXIgdmFsdWUgaXMgY2FwcGVkIGF0IHRoYXQgYnVja2V0CiAgICAgICAgc2VsZi50b3RhbFZhbHVhdGlvbiA9IF9jdXJyZW50QnVja2V0OwogICAgICB9IGVsc2UgewogICAgICAgIC8vIGVsc2Ugb3VyIHRvdGFsIHZhbHVlIGlzIGluIGJldHdlZW4gYnVja2V0cyBhbmQgaXQgZXF1YWxzIHRoZSB0b3RhbCBjb21taXRlbWVudHMKICAgICAgICBzZWxmLnRvdGFsVmFsdWF0aW9uID0gX3Byb3Bvc2VkQ29tbWl0OwogICAgICB9CgogICAgICBzZWxmLnZhbHVlQ29tbWl0dGVkID0gX3Byb3Bvc2VkQ29tbWl0OwogICAgfSBlbHNlIGlmKF9wZXJzb25hbENhcCA9PSBzZWxmLnRvdGFsVmFsdWF0aW9uKXsKICAgICAgc2VsZi52YWx1ZUNvbW1pdHRlZCArPSBfYW1vdW50OwogICAgfQoKICAgIHNlbGYucHJpY2VQdXJjaGFzZWRBdFttc2cuc2VuZGVyXSA9IChzZWxmLmJhc2UudG9rZW5zUGVyRXRoICogKDEwMCArIF9ib251c1BlcmNlbnQpKS8xMDA7CiAgICBMb2dCaWRBY2NlcHRlZChtc2cuc2VuZGVyLCBfYW1vdW50LCBfcGVyc29uYWxDYXApOwogICAgQnVja2V0QW5kVmFsdWF0aW9uQW5kQ29tbWl0dGVkKHNlbGYuY3VycmVudEJ1Y2tldCwgc2VsZi50b3RhbFZhbHVhdGlvbiwgc2VsZi52YWx1ZUNvbW1pdHRlZCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgoKICAvLy8gQGRldiBDYWxsZWQgd2hlbiBhbiBhZGRyZXNzIHdhbnRzIHRvIG1hbnVhbGx5IHdpdGhkcmF3IHRoZWlyIGJpZCBmcm9tIHRoZQogIC8vLyAgICAgIHNhbGUuIHB1dHMgdGhlaXIgd2VpIGluIHRoZSBMZWZ0b3ZlcldlaSBtYXBwaW5nCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBjcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHJldHVybiB0cnVlIG9uIHN1Y2Nlc2Z1bAogIGZ1bmN0aW9uIHdpdGhkcmF3QmlkKEludGVyYWN0aXZlQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAvLyBUaGUgc2VuZGVyIGhhcyB0byBoYXZlIGFscmVhZHkgYmlkIG9uIHRoZSBzYWxlCiAgICByZXF1aXJlKHNlbGYucGVyc29uYWxDYXBzW21zZy5zZW5kZXJdID4gMCk7CgogICAgdWludDI1NiByZWZ1bmRXZWk7CiAgICAvLyBjYW5ub3Qgd2l0aGRyYXcgYWZ0ZXIgY29tcHVsc29yeSB3aXRoZHJhdyBwZXJpb2QgaXMgb3ZlciB1bmxlc3MgdGhlIGJpZCdzCiAgICAvLyB2YWx1YXRpb24gaXMgYmVsb3cgdGhlIGN1dG9mZgogICAgaWYgKG5vdyA+PSBzZWxmLmVuZFdpdGhkcmF3YWxUaW1lKSB7CiAgICAgIHJlcXVpcmUoc2VsZi5wZXJzb25hbENhcHNbbXNnLnNlbmRlcl0gPCBzZWxmLnRvdGFsVmFsdWF0aW9uKTsKCiAgICAgIC8vIGZ1bGwgcmVmdW5kIGJlY2F1c2UgdGhlaXIgYmlkIG5vIGxvbmdlciBhZmZlY3RzIHRoZSB0b3RhbCBzYWxlIHZhbHVhdGlvbgogICAgICByZWZ1bmRXZWkgPSBzZWxmLmJhc2UuaGFzQ29udHJpYnV0ZWRbbXNnLnNlbmRlcl07CgogICAgfSBlbHNlIHsKICAgICAgcmVxdWlyZSghc2VsZi5oYXNNYW51YWxseVdpdGhkcmF3blttc2cuc2VuZGVyXSk7ICAvLyBtYW51YWwgd2l0aGRyYXdhbHMgYXJlIG9ubHkgYWxsb3dlZCBvbmNlCiAgICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgICBUaGUgZm9sbG93aW5nIGxpbmVzIHdlcmUgY29tbWVudGVkIG91dCBkdWUgdG8gc3RhY2sgZGVwdGgsIGJ1dCB0aGV5IHJlcHJlc2VudAogICAgICB0aGUgdmFyaWFibGVzIGFuZCBjYWxjdWxhdGlvbnMgZnJvbSB0aGUgcGFwZXIuIFRoZSBhY3R1YWwgY29kZSBpcyB0aGUgc2FtZQogICAgICB0aGluZyBzcGVsbGVkIG91dCB1c2luZyBjdXJyZW50IHZhcmlhYmxlcy4gIFNlZSBzZWN0aW9uIDQgb2YgdGhlIHdoaXRlIHBhcGVyIGZvciBmb3JtdWxhIHVzZWQKICAgICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwogICAgICAvL3VpbnQyNTYgdCA9IHNlbGYuZW5kV2l0aGRyYXdhbFRpbWUgLSBzZWxmLmJhc2Uuc3RhcnRUaW1lOwogICAgICAvL3VpbnQyNTYgcyA9IG5vdyAtIHNlbGYuYmFzZS5zdGFydFRpbWU7CiAgICAgIC8vdWludDI1NiBwYSA9IHNlbGYucHJpY2VQdXJjaGFzZWRBdFttc2cuc2VuZGVyXTsKICAgICAgLy91aW50MjU2IHB1ID0gc2VsZi5iYXNlLnRva2Vuc1BlckV0aDsKICAgICAgLy91aW50MjU2IG11bHRpcGxpZXJQZXJjZW50ID0gICgxMDAqKHQgLSBzKSkvdDsKICAgICAgLy9zZWxmLnByaWNlUHVyY2hhc2VkQXQgPSBwYS0oKHBhLXB1KS8zKQoKICAgICAgdWludDI1NiBtdWx0aXBsaWVyUGVyY2VudCA9ICgxMDAgKiAoc2VsZi5lbmRXaXRoZHJhd2FsVGltZSAtIG5vdykpIC8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChzZWxmLmVuZFdpdGhkcmF3YWxUaW1lIC0gc2VsZi5iYXNlLnN0YXJ0VGltZSk7CiAgICAgIHJlZnVuZFdlaSA9IChtdWx0aXBsaWVyUGVyY2VudCAqIHNlbGYuYmFzZS5oYXNDb250cmlidXRlZFttc2cuc2VuZGVyXSkgLyAxMDA7CgogICAgICBzZWxmLnZhbHVhdGlvblN1bXNbc2VsZi5wZXJzb25hbENhcHNbbXNnLnNlbmRlcl1dIC09IHJlZnVuZFdlaTsKICAgICAgc2VsZi5udW1CaWRzQXRWYWx1YXRpb25bc2VsZi5wZXJzb25hbENhcHNbbXNnLnNlbmRlcl1dIC09IDE7CgogICAgICBzZWxmLnByaWNlUHVyY2hhc2VkQXRbbXNnLnNlbmRlcl0gPSBzZWxmLnByaWNlUHVyY2hhc2VkQXRbbXNnLnNlbmRlcl0gLQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoKHNlbGYucHJpY2VQdXJjaGFzZWRBdFttc2cuc2VuZGVyXSAtIHNlbGYuYmFzZS50b2tlbnNQZXJFdGgpIC8gMyk7CgogICAgICBzZWxmLmhhc01hbnVhbGx5V2l0aGRyYXduW21zZy5zZW5kZXJdID0gdHJ1ZTsKCiAgICB9CgogICAgLy8gUHV0IHRoZSBzZW5kZXIncyBjb250cmlidXRlZCB3ZWkgaW50byB0aGUgbGVmdG92ZXJXZWkgbWFwcGluZyBmb3IgbGF0ZXIgd2l0aGRyYXdhbAogICAgc2VsZi5iYXNlLmxlZnRvdmVyV2VpW21zZy5zZW5kZXJdICs9IHJlZnVuZFdlaTsKCiAgICAvLyBzdWJ0cmFjdCB0aGUgYmlkZGVyJ3MgcmVmdW5kIGZyb20gaXRzIHRvdGFsIGNvbnRyaWJ1dGlvbgogICAgc2VsZi5iYXNlLmhhc0NvbnRyaWJ1dGVkW21zZy5zZW5kZXJdIC09IHJlZnVuZFdlaTsKCgogICAgdWludDI1NiBfcHJvcG9zZWRDb21taXQ7CiAgICB1aW50MjU2IF9wcm9wb3NlZFZhbHVlOwogICAgdWludDI1NiBfY3VycmVudEJ1Y2tldDsKICAgIGJvb2wgbG9vcDsKICAgIGJvb2wgZXhpc3RzOwoKICAgIC8vIGJpZGRlcidzIHdpdGhkcmF3YWwgb25seSBhZmZlY3RzIHRoZSBwb2ludGVyIGlmIHRoZSBwZXJzb25hbCBjYXAgaXMgYXQgb3IKICAgIC8vIGFib3ZlIHRoZSBjdXJyZW50IHZhbHVhdGlvbgogICAgaWYoc2VsZi5wZXJzb25hbENhcHNbbXNnLnNlbmRlcl0gPj0gc2VsZi50b3RhbFZhbHVhdGlvbil7CgogICAgICAvLyBmaXJzdCB3ZSByZW1vdmUgdGhlIHJlZnVuZFdlaSBmcm9tIHRoZSBjb21taXR0ZWQgdmFsdWUKICAgICAgX3Byb3Bvc2VkQ29tbWl0ID0gc2VsZi52YWx1ZUNvbW1pdHRlZCAtIHJlZnVuZFdlaTsKCiAgICAgIC8vIGlmIHdlJ3ZlIGRyb3BwZWQgYmVsb3cgdGhlIGN1cnJlbnQgYnVja2V0CiAgICAgIGlmKF9wcm9wb3NlZENvbW1pdCA8PSBzZWxmLmN1cnJlbnRCdWNrZXQpewogICAgICAgIC8vIGFuZCBjdXJyZW50IHZhbHVhdGlvbiBpcyBhYm92ZSB0aGUgYnVja2V0CiAgICAgICAgaWYoc2VsZi50b3RhbFZhbHVhdGlvbiA+IHNlbGYuY3VycmVudEJ1Y2tldCl7CiAgICAgICAgICBfcHJvcG9zZWRDb21taXQgKz0gc2VsZi52YWx1YXRpb25TdW1zW3NlbGYuY3VycmVudEJ1Y2tldF07CiAgICAgICAgfQoKICAgICAgICBpZihfcHJvcG9zZWRDb21taXQgPj0gc2VsZi5jdXJyZW50QnVja2V0KXsKICAgICAgICAgIF9wcm9wb3NlZFZhbHVlID0gc2VsZi5jdXJyZW50QnVja2V0OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyBpZiB3ZSBhcmUgc3RpbGwgYmVsb3cgdGhlIGN1cnJlbnQgYnVja2V0IHRoZW4gd2UgbmVlZCB0byBpdGVyYXRlCiAgICAgICAgICBsb29wID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYoc2VsZi50b3RhbFZhbHVhdGlvbiA9PSBzZWxmLmN1cnJlbnRCdWNrZXQpewogICAgICAgICAgX3Byb3Bvc2VkVmFsdWUgPSBzZWxmLnRvdGFsVmFsdWF0aW9uOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBfcHJvcG9zZWRWYWx1ZSA9IF9wcm9wb3NlZENvbW1pdDsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmKGxvb3ApewogICAgICAgIC8vIGlmIHdlJ3JlIGdvaW5nIHRvIGxvb3Agd2UgbW92ZSB0byB0aGUgcHJldmlvdXMgYnVja2V0CiAgICAgICAgKGV4aXN0cyxfY3VycmVudEJ1Y2tldCkgPSBzZWxmLnZhbHVhdGlvbnNMaXN0LmdldEFkamFjZW50KHNlbGYuY3VycmVudEJ1Y2tldCwgUFJFVik7CiAgICAgICAgd2hpbGUoX3Byb3Bvc2VkQ29tbWl0IDw9IF9jdXJyZW50QnVja2V0KXsKICAgICAgICAgIC8vIHdoaWxlIHdlIGFyZSBwcm9wb3NlZCBsb3dlciB0aGFuIHRoZSBwcmV2aW91cyBidWNrZXQgd2UgYWRkIGNvbW1pdG1lbnRzCiAgICAgICAgICBfcHJvcG9zZWRDb21taXQgKz0gc2VsZi52YWx1YXRpb25TdW1zW19jdXJyZW50QnVja2V0XTsKICAgICAgICAgIC8vIGFuZCBpdGVyYXRlIHRvIHRoZSBwcmV2aW91cwogICAgICAgICAgaWYoX3Byb3Bvc2VkQ29tbWl0ID49IF9jdXJyZW50QnVja2V0KXsKICAgICAgICAgICAgX3Byb3Bvc2VkVmFsdWUgPSBfY3VycmVudEJ1Y2tldDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIChleGlzdHMsX2N1cnJlbnRCdWNrZXQpID0gc2VsZi52YWx1YXRpb25zTGlzdC5nZXRBZGphY2VudChfY3VycmVudEJ1Y2tldCwgUFJFVik7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZihfcHJvcG9zZWRWYWx1ZSA9PSAwKSB7IF9wcm9wb3NlZFZhbHVlID0gX3Byb3Bvc2VkQ29tbWl0OyB9CgogICAgICAgIHNlbGYuY3VycmVudEJ1Y2tldCA9IF9jdXJyZW50QnVja2V0OwogICAgICB9CgogICAgICBzZWxmLnRvdGFsVmFsdWF0aW9uID0gX3Byb3Bvc2VkVmFsdWU7CiAgICAgIHNlbGYudmFsdWVDb21taXR0ZWQgPSBfcHJvcG9zZWRDb21taXQ7CiAgICB9CgogICAgTG9nQmlkV2l0aGRyYXduKG1zZy5zZW5kZXIsIHJlZnVuZFdlaSwgc2VsZi5wZXJzb25hbENhcHNbbXNnLnNlbmRlcl0pOwogICAgQnVja2V0QW5kVmFsdWF0aW9uQW5kQ29tbWl0dGVkKHNlbGYuY3VycmVudEJ1Y2tldCwgc2VsZi50b3RhbFZhbHVhdGlvbiwgc2VsZi52YWx1ZUNvbW1pdHRlZCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IFRoaXMgc2hvdWxkIGJlIGNhbGxlZCBvbmNlIHRoZSBzYWxlIGlzIG92ZXIgdG8gY29tbWl0IGFsbCBiaWRzIGludG8KICAvLy8gICAgICB0aGUgb3duZXIncyBidWNrZXQuCiAgLy8vIEBwYXJhbSBzZWxmIHN0b3JlZCBjcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICBmdW5jdGlvbiBmaW5hbGl6ZVNhbGUoSW50ZXJhY3RpdmVDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUobm93ID49IHNlbGYuYmFzZS5lbmRUaW1lKTsKICAgIHJlcXVpcmUoIXNlbGYuaXNGaW5hbGl6ZWQpOyAvLyBjYW4gb25seSBiZSBjYWxsZWQgb25jZQogICAgcmVxdWlyZShzZXRDYW5jZWxlZChzZWxmKSk7CgogICAgc2VsZi5pc0ZpbmFsaXplZCA9IHRydWU7CiAgICByZXF1aXJlKGxhdW5jaFRva2VuKHNlbGYpKTsKICAgIC8vIG1heSBuZWVkIHRvIGJlIGNvbXB1dGVkIGR1ZSB0byBFVk0gcm91bmRpbmcgZXJyb3JzCiAgICB1aW50MjU2IGNvbXB1dGVkVmFsdWU7CgogICAgaWYoIXNlbGYuaXNDYW5jZWxlZCl7CiAgICAgIGlmKHNlbGYudG90YWxWYWx1YXRpb24gPT0gc2VsZi5jdXJyZW50QnVja2V0KXsKICAgICAgICAvLyBjYWxjdWxhdGUgdGhlIGZyYWN0aW9uIG9mIGVhY2ggbWluaW1hbCB2YWx1YXRpb24gYmlkZGVycyBldGhlciBhbmQgdG9rZW5zIHRvIHJlZnVuZAogICAgICAgIHNlbGYucSA9ICgxMDAqKHNlbGYudmFsdWVDb21taXR0ZWQgLSBzZWxmLnRvdGFsVmFsdWF0aW9uKS8oc2VsZi52YWx1YXRpb25TdW1zW3NlbGYudG90YWxWYWx1YXRpb25dKSkgKyAxOwogICAgICAgIGNvbXB1dGVkVmFsdWUgPSBzZWxmLnZhbHVlQ29tbWl0dGVkIC0gc2VsZi52YWx1YXRpb25TdW1zW3NlbGYudG90YWxWYWx1YXRpb25dOwogICAgICAgIGNvbXB1dGVkVmFsdWUgKz0gKHNlbGYucSAqIHNlbGYudmFsdWF0aW9uU3Vtc1tzZWxmLnRvdGFsVmFsdWF0aW9uXSkvMTAwOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIG5vIGNvbXB1dGF0aW9uIG5lY2Vzc2FyeQogICAgICAgIGNvbXB1dGVkVmFsdWUgPSBzZWxmLnRvdGFsVmFsdWF0aW9uOwogICAgICB9CiAgICAgIHNlbGYuYmFzZS5vd25lckJhbGFuY2UgPSBjb21wdXRlZFZhbHVlOyAgLy8gc2V0cyBFVEggcmFpc2VkIGluIHRoZSBzYWxlIHRvIGJlIHJlYWR5IGZvciB3aXRoZHJhd2FsCiAgICB9CiAgfQoKICAvLy8gQGRldiBNaW50cyB0aGUgdG9rZW4gYmVpbmcgc29sZCBieSB0YWtpbmcgdGhlIHBlcmNlbnRhZ2Ugb2YgdGhlIHRva2VuIHN1cHBseQogIC8vLyAgICAgIGJlaW5nIHNvbGQgaW4gdGhpcyBzYWxlIGFsb25nIHdpdGggdGhlIHZhbHVhdGlvbiwgZGVyaXZlcyBhbGwgbmVjZXNzYXJ5CiAgLy8vICAgICAgdmFsdWVzIGFuZCB0aGVuIHRyYW5zZmVycyBvd25lciB0b2tlbnMgdG8gdGhlIG93bmVyLgogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgY3Jvd2RzYWxlIGZyb20gY3Jvd2RzYWxlIGNvbnRyYWN0CiAgZnVuY3Rpb24gbGF1bmNoVG9rZW4oSW50ZXJhY3RpdmVDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgLy8gdG90YWwgdmFsdWF0aW9uIG9mIGFsbCB0aGUgdG9rZW5zIG5vdCBpbmNsdWRpbmcgdGhlIGJvbnVzCiAgICB1aW50MjU2IF9mdWxsVmFsdWUgPSAoc2VsZi50b3RhbFZhbHVhdGlvbioxMDApL3VpbnQyNTYoc2VsZi5wZXJjZW50QmVpbmdTb2xkKTsKICAgIC8vIHRvdGFsIHZhbHVhdGlvbiBvZiBib251cyB0b2tlbnMKICAgIHVpbnQyNTYgX2JvbnVzVmFsdWUgPSAoKHNlbGYudG90YWxWYWx1YXRpb24gKiAoMTAwICsgc2VsZi5wcmljZUJvbnVzUGVyY2VudCkpLzEwMCkgLSBzZWxmLnRvdGFsVmFsdWF0aW9uOwogICAgLy8gdG90YWwgc3VwcGx5IG9mIGFsbCB0b2tlbnMgbm90IGluY2x1ZGluZyB0aGUgYm9udXMKICAgIHVpbnQyNTYgX3N1cHBseSA9IChfZnVsbFZhbHVlICogc2VsZi5iYXNlLnRva2Vuc1BlckV0aCkvMTAwMDAwMDAwMDAwMDAwMDAwMDsKICAgIC8vIHRvdGFsIG51bWJlciBvZiBib251cyB0b2tlbnMKICAgIHVpbnQyNTYgX2JvbnVzVG9rZW5zID0gKF9ib251c1ZhbHVlICogc2VsZi5iYXNlLnRva2Vuc1BlckV0aCkvMTAwMDAwMDAwMDAwMDAwMDAwMDsKICAgIC8vIHRva2VucyBhbGxvY2F0ZWQgdG8gdGhlIG93bmVyIG9mIHRoZSBzYWxlCiAgICB1aW50MjU2IF9vd25lclRva2VucyA9IF9zdXBwbHkgLSAoKF9zdXBwbHkgKiB1aW50MjU2KHNlbGYucGVyY2VudEJlaW5nU29sZCkpLzEwMCk7CiAgICAvLyB0b3RhbCBzdXBwbHkgb2YgdG9rZW5zIG5vdCBpbmNsdWRpbmcgdGhlIGJvbnVzIHRva2VucwogICAgdWludDI1NiBfdG90YWxTdXBwbHkgPSBfc3VwcGx5ICsgX2JvbnVzVG9rZW5zOwoKICAgIC8vIGRlcGxveSBuZXcgdG9rZW4gY29udHJhY3Qgd2l0aCB0b3RhbCBudW1iZXIgb2YgdG9rZW5zCiAgICBzZWxmLmJhc2UudG9rZW4gPSBuZXcgQ3Jvd2RzYWxlVG9rZW4oYWRkcmVzcyh0aGlzKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRva2VuSW5mby5uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudG9rZW5JbmZvLnN5bWJvbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRva2VuSW5mby5kZWNpbWFscywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdG90YWxTdXBwbHksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50b2tlbkluZm8uc3RpbGxNaW50aW5nKTsKCiAgICAvLyBpZiB0aGUgc2FsZSBnb3QgY2FuY2VsZWQsIHRoZW4gYWxsIHRoZSB0b2tlbnMgZ28gdG8gdGhlIG93bmVyIGFuZCBib251cyB0b2tlbnMgYXJlIGJ1cm5lZAogICAgaWYoIXNlbGYuaXNDYW5jZWxlZCl7CiAgICAgIHNlbGYuYmFzZS50b2tlbi50cmFuc2ZlcihzZWxmLmJhc2Uub3duZXIsIF9vd25lclRva2Vucyk7CiAgICB9IGVsc2UgewogICAgICBzZWxmLmJhc2UudG9rZW4udHJhbnNmZXIoc2VsZi5iYXNlLm93bmVyLCBfc3VwcGx5KTsKICAgICAgc2VsZi5iYXNlLnRva2VuLmJ1cm5Ub2tlbihfYm9udXNUb2tlbnMpOwogICAgfQogICAgLy8gdGhlIG93bmVyIG9mIHRoZSBjcm93ZHNhbGUgYmVjb21lcyB0aGUgbmV3IG93bmVyIG9mIHRoZSB0b2tlbiBjb250cmFjdAogICAgc2VsZi5iYXNlLnRva2VuLmNoYW5nZU93bmVyKHNlbGYuYmFzZS5vd25lcik7CiAgICBzZWxmLmJhc2Uuc3RhcnRpbmdUb2tlbkJhbGFuY2UgPSBfc3VwcGx5IC0gX293bmVyVG9rZW5zOwoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgcmV0dXJucyBhIGJvb2xlYW4gaW5kaWNhdGluZyBpZiB0aGUgc2FsZSBpcyBjYW5jZWxlZC4KICAvLy8gICAgICBUaGlzIGNhbiBlaXRoZXIgYmUgaWYgdGhlIG1pbmltdW0gcmFpc2UgaGFzbid0IGJlZW4gbWV0CiAgLy8vICAgICAgb3IgaWYgaXQgaXMgMzAgZGF5cyBhZnRlciB0aGUgc2FsZSBhbmQgdGhlIG93bmVyIGhhc24ndCBmaW5hbGl6ZWQgdGhlIHNhbGUuCiAgLy8vIEByZXR1cm4gYm9vbCBjYW5jZWxlZCBpbmRpY2F0aW5nIGlmIHRoZSBzYWxlIGlzIGNhbmNlbGVkIG9yIG5vdAogIGZ1bmN0aW9uIHNldENhbmNlbGVkKEludGVyYWN0aXZlQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIGludGVybmFsIHJldHVybnMoYm9vbCl7CiAgICBib29sIGNhbmNlbGVkID0gKHNlbGYudG90YWxWYWx1YXRpb24gPCBzZWxmLm1pbmltdW1SYWlzZSkgfHwKICAgICAgICAgICAgICAgICAgICAoKG5vdyA+IChzZWxmLmJhc2UuZW5kVGltZSArIDMwIGRheXMpKSAmJiAhc2VsZi5pc0ZpbmFsaXplZCk7CgogICAgaWYoY2FuY2VsZWQpIHtzZWxmLmlzQ2FuY2VsZWQgPSB0cnVlO30KCiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IElmIHRoZSBhZGRyZXNzJyBwZXJzb25hbCBjYXAgaXMgYmVsb3cgdGhlIHBvaW50ZXIsIHJlZnVuZCB0aGVtIGFsbCB0aGVpciBFVEguCiAgLy8vICAgICAgaWYgaXQgaXMgYWJvdmUgdGhlIHBvaW50ZXIsIGNhbGN1bGF0ZSB0b2tlbnMgcHVyY2hhc2VkIGFuZCByZWZ1bmQgbGVmdG9ldmVyIEVUSAogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgY3Jvd2RzYWxlIGZyb20gY3Jvd2RzYWxlIGNvbnRyYWN0CiAgLy8vIEByZXR1cm4gYm9vbCBzdWNjZXNzIGlmIHRoZSBjb250cmFjdCBydW5zIHN1Y2Nlc3NmdWxseQogIGZ1bmN0aW9uIHJldHJlaXZlRmluYWxSZXN1bHQoSW50ZXJhY3RpdmVDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUobm93ID4gc2VsZi5iYXNlLmVuZFRpbWUpOwogICAgcmVxdWlyZShzZWxmLnBlcnNvbmFsQ2Fwc1ttc2cuc2VuZGVyXSA+IDApOwoKICAgIHVpbnQyNTYgbnVtVG9rZW5zOwogICAgdWludDI1NiByZW1haW5kZXI7CgogICAgaWYoIXNlbGYuaXNGaW5hbGl6ZWQpewogICAgICByZXF1aXJlKHNldENhbmNlbGVkKHNlbGYpKTsKICAgICAgcmVxdWlyZShzZWxmLmlzQ2FuY2VsZWQpOwogICAgfQoKICAgIGlmIChzZWxmLmlzQ2FuY2VsZWQpIHsKICAgICAgLy8gaWYgdGhlIHNhbGUgd2FzIGNhbmNlbGVkLCBldmVyeW9uZSBnZXRzIGEgZnVsbCByZWZ1bmQKICAgICAgc2VsZi5iYXNlLmxlZnRvdmVyV2VpW21zZy5zZW5kZXJdICs9IHNlbGYuYmFzZS5oYXNDb250cmlidXRlZFttc2cuc2VuZGVyXTsKICAgICAgc2VsZi5iYXNlLmhhc0NvbnRyaWJ1dGVkW21zZy5zZW5kZXJdID0gMDsKICAgICAgTG9nRXJyb3JNc2coc2VsZi50b3RhbFZhbHVhdGlvbiwgIlNhbGUgaXMgY2FuY2VsZWQsIGFsbCBiaWRzIGhhdmUgYmVlbiByZWZ1bmRlZCEiKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgaWYgKHNlbGYucGVyc29uYWxDYXBzW21zZy5zZW5kZXJdIDwgc2VsZi50b3RhbFZhbHVhdGlvbikgewoKICAgICAgLy8gZnVsbCByZWZ1bmQgaWYgcGVyc29uYWwgY2FwIGlzIGxlc3MgdGhhbiB0b3RhbCB2YWx1YXRpb24KICAgICAgc2VsZi5iYXNlLmxlZnRvdmVyV2VpW21zZy5zZW5kZXJdICs9IHNlbGYuYmFzZS5oYXNDb250cmlidXRlZFttc2cuc2VuZGVyXTsKCiAgICAgIC8vIHNldCBoYXNDb250cmlidXRlZCB0byAwIHRvIHByZXZlbnQgcGFydGljaXBhbnQgZnJvbSBjYWxsaW5nIHRoaXMgb3ZlciBhbmQgb3ZlcgogICAgICBzZWxmLmJhc2UuaGFzQ29udHJpYnV0ZWRbbXNnLnNlbmRlcl0gPSAwOwoKICAgICAgcmV0dXJuIHNlbGYuYmFzZS53aXRoZHJhd0xlZnRvdmVyV2VpKCk7CgogICAgfSBlbHNlIGlmIChzZWxmLnBlcnNvbmFsQ2Fwc1ttc2cuc2VuZGVyXSA9PSBzZWxmLnRvdGFsVmFsdWF0aW9uKSB7CgogICAgICAvLyBjYWxjdWxhdGUgdGhlIHBvcnRpb24gdGhhdCB0aGlzIGFkZHJlc3MgaGFzIHRvIHRha2Ugb3V0IG9mIHRoZWlyIGJpZAogICAgICB1aW50MjU2IHJlZnVuZEFtb3VudCA9IChzZWxmLnEqc2VsZi5iYXNlLmhhc0NvbnRyaWJ1dGVkW21zZy5zZW5kZXJdKS8xMDA7CgogICAgICAvLyByZWZ1bmQgdGhhdCBhbW91bnQgb2Ygd2VpIHRvIHRoZSBhZGRyZXNzCiAgICAgIHNlbGYuYmFzZS5sZWZ0b3ZlcldlaVttc2cuc2VuZGVyXSArPSByZWZ1bmRBbW91bnQ7CgogICAgICAvLyBzdWJ0cmFjdCB0aGF0IGFtb3VudCB0aGUgYWRkcmVzcycgY29udHJpYnV0aW9uCiAgICAgIHNlbGYuYmFzZS5oYXNDb250cmlidXRlZFttc2cuc2VuZGVyXSAtPSByZWZ1bmRBbW91bnQ7CiAgICB9CgogICAgTG9nRXJyb3JNc2coc2VsZi5iYXNlLmhhc0NvbnRyaWJ1dGVkW21zZy5zZW5kZXJdLCJjb250cmlidXRpb24iKTsKICAgIExvZ0Vycm9yTXNnKHNlbGYucHJpY2VQdXJjaGFzZWRBdFttc2cuc2VuZGVyXSwicHJpY2UiKTsKICAgIExvZ0Vycm9yTXNnKHNlbGYucSwicGVyY2VudGFnZSIpOwogICAgLy8gY2FsY3VsYXRlIHRoZSBudW1iZXIgb2YgdG9rZW5zIHRoYXQgdGhlIGJpZGRlciBwdXJjaGFzZWQKICAgIChudW1Ub2tlbnMsIHJlbWFpbmRlcikgPSBjYWxjdWxhdGVUb2tlblB1cmNoYXNlKHNlbGYuYmFzZS5oYXNDb250cmlidXRlZFttc2cuc2VuZGVyXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYucHJpY2VQdXJjaGFzZWRBdFttc2cuc2VuZGVyXSk7CgogICAgLy8gYWRkIHRva2VucyB0byB0aGUgYmlkZGVycyBwdXJjaGFzZS4gIGNhbid0IG92ZXJmbG93IGJlY2F1c2UgaXQgd2lsbCBiZSB1bmRlciB0aGUgY2FwCiAgICBzZWxmLmJhc2Uud2l0aGRyYXdUb2tlbnNNYXBbbXNnLnNlbmRlcl0gKz0gbnVtVG9rZW5zOwogICAgc2VsZi52YWx1ZUNvbW1pdHRlZCA9IHNlbGYudmFsdWVDb21taXR0ZWQgLSByZW1haW5kZXI7CiAgICBzZWxmLmJhc2UubGVmdG92ZXJXZWlbbXNnLnNlbmRlcl0gKz0gcmVtYWluZGVyOwoKICAgIC8vIGJ1cm4gYW55IGV4dHJhIGJvbnVzIHRva2VucwogICAgdWludDI1NiBfZnVsbEJvbnVzOwogICAgdWludDI1NiBfZnVsbEJvbnVzUHJpY2UgPSAoc2VsZi5iYXNlLnRva2Vuc1BlckV0aCooMTAwICsgc2VsZi5wcmljZUJvbnVzUGVyY2VudCkpLzEwMDsKICAgIChfZnVsbEJvbnVzLCByZW1haW5kZXIpID0gY2FsY3VsYXRlVG9rZW5QdXJjaGFzZShzZWxmLmJhc2UuaGFzQ29udHJpYnV0ZWRbbXNnLnNlbmRlcl0sIF9mdWxsQm9udXNQcmljZSk7CiAgICB1aW50MjU2IF9sZWZ0b3ZlckJvbnVzID0gX2Z1bGxCb251cyAtIG51bVRva2VuczsKICAgIHNlbGYuYmFzZS50b2tlbi5idXJuVG9rZW4oX2xlZnRvdmVyQm9udXMpOwoKICAgIHNlbGYuYmFzZS5oYXNDb250cmlidXRlZFttc2cuc2VuZGVyXSA9IDA7CgogICAgLy8gc2VuZCB0b2tlbnMgYW5kIGxlZnRvdmVyV2VpIHRvIHRoZSBhZGRyZXNzIGNhbGxpbmcgdGhlIGZ1bmN0aW9uCiAgICBzZWxmLmJhc2Uud2l0aGRyYXdUb2tlbnMoKTsKCiAgICBzZWxmLmJhc2Uud2l0aGRyYXdMZWZ0b3ZlcldlaSgpOwoKICB9CgoKCiAgIC8qRnVuY3Rpb25zICJpbmhlcml0ZWQiIGZyb20gQ3Jvd2RzYWxlTGliIGxpYnJhcnkqLwoKICBmdW5jdGlvbiB3aXRoZHJhd0xlZnRvdmVyV2VpKEludGVyYWN0aXZlQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKCiAgICByZXR1cm4gc2VsZi5iYXNlLndpdGhkcmF3TGVmdG92ZXJXZWkoKTsKICB9CgogIGZ1bmN0aW9uIHdpdGhkcmF3T3duZXJFdGgoSW50ZXJhY3RpdmVDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewoKICAgIHJldHVybiBzZWxmLmJhc2Uud2l0aGRyYXdPd25lckV0aCgpOwogIH0KCiAgZnVuY3Rpb24gY3Jvd2RzYWxlQWN0aXZlKEludGVyYWN0aXZlQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHNlbGYuYmFzZS5jcm93ZHNhbGVBY3RpdmUoKTsKICB9CgogIGZ1bmN0aW9uIGNyb3dkc2FsZUVuZGVkKEludGVyYWN0aXZlQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHNlbGYuYmFzZS5jcm93ZHNhbGVFbmRlZCgpOwogIH0KCiAgZnVuY3Rpb24gZ2V0UGVyc29uYWxDYXAoSW50ZXJhY3RpdmVDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZiwgYWRkcmVzcyBfYmlkZGVyKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBzZWxmLnBlcnNvbmFsQ2Fwc1tfYmlkZGVyXTsKICB9CgogIGZ1bmN0aW9uIGdldFRva2Vuc1NvbGQoSW50ZXJhY3RpdmVDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gc2VsZi5iYXNlLmdldFRva2Vuc1NvbGQoKTsKICB9Cgp9CgpsaWJyYXJ5IENyb3dkc2FsZUxpYiB7CiAgdXNpbmcgQmFzaWNNYXRoTGliIGZvciB1aW50MjU2OwoKICBzdHJ1Y3QgQ3Jvd2RzYWxlU3RvcmFnZSB7CiAgCWFkZHJlc3Mgb3duZXI7ICAgICAvL293bmVyIG9mIHRoZSBjcm93ZHNhbGUKCiAgCXVpbnQyNTYgdG9rZW5zUGVyRXRoOyAgLy9udW1iZXIgb2YgdG9rZW5zIHJlY2VpdmVkIHBlciBldGhlcgogIAl1aW50MjU2IHN0YXJ0VGltZTsgLy9JQ08gc3RhcnQgdGltZSwgdGltZXN0YW1wCiAgCXVpbnQyNTYgZW5kVGltZTsgLy9JQ08gZW5kIHRpbWUsIHRpbWVzdGFtcCBhdXRvbWF0aWNhbGx5IGNhbGN1bGF0ZWQKICAgIHVpbnQyNTYgb3duZXJCYWxhbmNlOyAvL293bmVyIHdlaSBCYWxhbmNlCiAgICB1aW50MjU2IHN0YXJ0aW5nVG9rZW5CYWxhbmNlOyAvL2luaXRpYWwgYW1vdW50IG9mIHRva2VucyBmb3Igc2FsZQogICAgdWludDI1NltdIG1pbGVzdG9uZVRpbWVzOyAvL0FycmF5IG9mIHRpbWVzdGFtcHMgd2hlbiB0b2tlbiBwcmljZSBhbmQgYWRkcmVzcyBjYXAgY2hhbmdlcwogICAgdWludDggY3VycmVudE1pbGVzdG9uZTsgLy9Qb2ludGVyIHRvIHRoZSBjdXJyZW50IG1pbGVzdG9uZQogICAgdWludDggcGVyY2VudEJ1cm47IC8vcGVyY2VudGFnZSBvZiBleHRyYSB0b2tlbnMgdG8gYnVybgogICAgYm9vbCB0b2tlbnNTZXQ7IC8vdHJ1ZSBpZiB0b2tlbnMgaGF2ZSBiZWVuIHByZXBhcmVkIGZvciBjcm93ZHNhbGUKCiAgICAvL01hcHMgdGltZXN0YW1wIHRvIHRva2VuIHByaWNlIGFuZCBhZGRyZXNzIHB1cmNoYXNlIGNhcCBzdGFydGluZyBhdCB0aGF0IHRpbWUKICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gdWludDI1NlsyXSkgc2FsZURhdGE7CgogICAgLy9zaG93cyBob3cgbXVjaCB3ZWkgYW4gYWRkcmVzcyBoYXMgY29udHJpYnV0ZWQKICAJbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBoYXNDb250cmlidXRlZDsKCiAgICAvL0ZvciB0b2tlbiB3aXRoZHJhdyBmdW5jdGlvbiwgbWFwcyBhIHVzZXIgYWRkcmVzcyB0byB0aGUgYW1vdW50IG9mIHRva2VucyB0aGV5IGNhbiB3aXRoZHJhdwogIAltYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHdpdGhkcmF3VG9rZW5zTWFwOwoKICAgIC8vIGFueSBsZWZ0b3ZlciB3ZWkgdGhhdCBidXllcnMgY29udHJpYnV0ZWQgdGhhdCBkaWRuJ3QgYWRkIHVwIHRvIGEgd2hvbGUgdG9rZW4gYW1vdW50CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIGxlZnRvdmVyV2VpOwoKICAJQ3Jvd2RzYWxlVG9rZW4gdG9rZW47IC8vdG9rZW4gYmVpbmcgc29sZAogIH0KCiAgLy8gSW5kaWNhdGVzIHdoZW4gYW4gYWRkcmVzcyBoYXMgd2l0aGRyYXduIHRoZWlyIHN1cHBseSBvZiB0b2tlbnMKICBldmVudCBMb2dUb2tlbnNXaXRoZHJhd24oYWRkcmVzcyBpbmRleGVkIF9iaWRkZXIsIHVpbnQyNTYgQW1vdW50KTsKCiAgLy8gSW5kaWNhdGVzIHdoZW4gYW4gYWRkcmVzcyBoYXMgd2l0aGRyYXduIHRoZWlyIHN1cHBseSBvZiBleHRyYSB3ZWkKICBldmVudCBMb2dXZWlXaXRoZHJhd24oYWRkcmVzcyBpbmRleGVkIF9iaWRkZXIsIHVpbnQyNTYgQW1vdW50KTsKCiAgLy8gTG9ncyB3aGVuIG93bmVyIGhhcyBwdWxsZWQgZXRoCiAgZXZlbnQgTG9nT3duZXJFdGhXaXRoZHJhd24oYWRkcmVzcyBpbmRleGVkIG93bmVyLCB1aW50MjU2IGFtb3VudCwgc3RyaW5nIE1zZyk7CgogIC8vIEdlbmVyaWMgTm90aWNlIG1lc3NhZ2UgdGhhdCBpbmNsdWRlcyBhbmQgYWRkcmVzcyBhbmQgbnVtYmVyCiAgZXZlbnQgTG9nTm90aWNlTXNnKGFkZHJlc3MgX2J1eWVyLCB1aW50MjU2IHZhbHVlLCBzdHJpbmcgTXNnKTsKCiAgLy8gSW5kaWNhdGVzIHdoZW4gYW4gZXJyb3IgaGFzIG9jY3VycmVkIGluIHRoZSBleGVjdXRpb24gb2YgYSBmdW5jdGlvbgogIGV2ZW50IExvZ0Vycm9yTXNnKHVpbnQyNTYgYW1vdW50LCBzdHJpbmcgTXNnKTsKCiAgLy8vIEBkZXYgQ2FsbGVkIGJ5IGEgY3Jvd2RzYWxlIGNvbnRyYWN0IHVwb24gY3JlYXRpb24uCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBjcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHBhcmFtIF9vd25lciBBZGRyZXNzIG9mIGNyb3dkc2FsZSBvd25lcgogIC8vLyBAcGFyYW0gX3NhbGVEYXRhIEFycmF5IG9mIDMgaXRlbSBzZXRzIHN1Y2ggdGhhdCwgaW4gZWFjaCAzIGVsZW1lbnQKICAvLy8gc2V0LCAxIGlzIHRpbWVzdGFtcCwgMiBpcyBwcmljZSBpbiB0b2tlbnMvZXRoIGF0IHRoYXQgdGltZSwKICAvLy8gMyBpcyBhZGRyZXNzIHRva2VuIHB1cmNoYXNlIGNhcCBhdCB0aGF0IHRpbWUsIDAgaWYgbm8gYWRkcmVzcyBjYXAKICAvLy8gQHBhcmFtIF9lbmRUaW1lIFRpbWVzdGFtcCBvZiBzYWxlIGVuZCB0aW1lCiAgLy8vIEBwYXJhbSBfcGVyY2VudEJ1cm4gUGVyY2VudGFnZSBvZiBleHRyYSB0b2tlbnMgdG8gYnVybgogIC8vLyBAcGFyYW0gX3Rva2VuIFRva2VuIGJlaW5nIHNvbGQKICBmdW5jdGlvbiBpbml0KENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmLAogICAgICAgICAgICAgICAgYWRkcmVzcyBfb3duZXIsCiAgICAgICAgICAgICAgICB1aW50MjU2W10gX3NhbGVEYXRhLAogICAgICAgICAgICAgICAgdWludDI1NiBfZW5kVGltZSwKICAgICAgICAgICAgICAgIHVpbnQ4IF9wZXJjZW50QnVybiwKICAgICAgICAgICAgICAgIENyb3dkc2FsZVRva2VuIF90b2tlbikKICAgICAgICAgICAgICAgIHB1YmxpYwogIHsKICAJcmVxdWlyZShzZWxmLm93bmVyID09IDApOwogICAgcmVxdWlyZShfc2FsZURhdGEubGVuZ3RoID4gMCk7CiAgICByZXF1aXJlKChfc2FsZURhdGEubGVuZ3RoJTMpID09IDApOyAvLyBlbnN1cmUgc2FsZURhdGEgaXMgMy1pdGVtIHNldHMKICAgIHJlcXVpcmUoX3NhbGVEYXRhWzBdID4gKG5vdyArIDIgaG91cnMpKTsKICAgIHJlcXVpcmUoX2VuZFRpbWUgPiBfc2FsZURhdGFbMF0pOwogICAgcmVxdWlyZShfb3duZXIgPiAwKTsKICAgIHJlcXVpcmUoX3BlcmNlbnRCdXJuIDw9IDEwMCk7CiAgICBzZWxmLm93bmVyID0gX293bmVyOwogICAgc2VsZi5zdGFydFRpbWUgPSBfc2FsZURhdGFbMF07CiAgICBzZWxmLmVuZFRpbWUgPSBfZW5kVGltZTsKICAgIHNlbGYudG9rZW4gPSBfdG9rZW47CiAgICBzZWxmLnBlcmNlbnRCdXJuID0gX3BlcmNlbnRCdXJuOwoKICAgIHVpbnQyNTYgX3RlbXBUaW1lOwogICAgZm9yKHVpbnQyNTYgaSA9IDA7IGkgPCBfc2FsZURhdGEubGVuZ3RoOyBpICs9IDMpewogICAgICByZXF1aXJlKF9zYWxlRGF0YVtpXSA+IF90ZW1wVGltZSk7CiAgICAgIHJlcXVpcmUoX3NhbGVEYXRhW2kgKyAxXSA+IDApOwogICAgICByZXF1aXJlKChfc2FsZURhdGFbaSArIDJdID09IDApIHx8IChfc2FsZURhdGFbaSArIDJdID49IDEwMCkpOwogICAgICBzZWxmLm1pbGVzdG9uZVRpbWVzLnB1c2goX3NhbGVEYXRhW2ldKTsKICAgICAgc2VsZi5zYWxlRGF0YVtfc2FsZURhdGFbaV1dWzBdID0gX3NhbGVEYXRhW2kgKyAxXTsKICAgICAgc2VsZi5zYWxlRGF0YVtfc2FsZURhdGFbaV1dWzFdID0gX3NhbGVEYXRhW2kgKyAyXTsKICAgICAgX3RlbXBUaW1lID0gX3NhbGVEYXRhW2ldOwogICAgfQogICAgY2hhbmdlVG9rZW5QcmljZShzZWxmLCBfc2FsZURhdGFbMV0pOwogIH0KCiAgLy8vIEBkZXYgZnVuY3Rpb24gdG8gY2hlY2sgaWYgdGhlIGNyb3dkc2FsZSBpcyBjdXJyZW50bHkgYWN0aXZlCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBjcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHJldHVybiBzdWNjZXNzCiAgZnVuY3Rpb24gY3Jvd2RzYWxlQWN0aXZlKENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgCXJldHVybiAobm93ID49IHNlbGYuc3RhcnRUaW1lICYmIG5vdyA8PSBzZWxmLmVuZFRpbWUpOwogIH0KCiAgLy8vIEBkZXYgZnVuY3Rpb24gdG8gY2hlY2sgaWYgdGhlIGNyb3dkc2FsZSBoYXMgZW5kZWQKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcmV0dXJuIHN1Y2Nlc3MKICBmdW5jdGlvbiBjcm93ZHNhbGVFbmRlZChDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogIAlyZXR1cm4gbm93ID4gc2VsZi5lbmRUaW1lOwogIH0KCiAgLy8vIEBkZXYgZnVuY3Rpb24gdG8gY2hlY2sgaWYgYSBwdXJjaGFzZSBpcyB2YWxpZAogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgY3Jvd2RzYWxlIGZyb20gY3Jvd2RzYWxlIGNvbnRyYWN0CiAgLy8vIEByZXR1cm4gdHJ1ZSBpZiB0aGUgdHJhbnNhY3Rpb24gY2FuIGJ1eSB0b2tlbnMKICBmdW5jdGlvbiB2YWxpZFB1cmNoYXNlKENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICBib29sIG5vblplcm9QdXJjaGFzZSA9IG1zZy52YWx1ZSAhPSAwOwogICAgaWYgKGNyb3dkc2FsZUFjdGl2ZShzZWxmKSAmJiBub25aZXJvUHVyY2hhc2UpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9IGVsc2UgewogICAgICBMb2dFcnJvck1zZyhtc2cudmFsdWUsICJJbnZhbGlkIFB1cmNoYXNlISBDaGVjayBzdGFydCB0aW1lIGFuZCBhbW91bnQgb2YgZXRoZXIuIik7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9CgogIC8vLyBAZGV2IEZ1bmN0aW9uIGNhbGxlZCBieSBwdXJjaGFzZXJzIHRvIHB1bGwgdG9rZW5zCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBjcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHJldHVybiB0cnVlIGlmIHRva2VucyB3ZXJlIHdpdGhkcmF3bgogIGZ1bmN0aW9uIHdpdGhkcmF3VG9rZW5zKENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgYm9vbCBvazsKCiAgICBpZiAoc2VsZi53aXRoZHJhd1Rva2Vuc01hcFttc2cuc2VuZGVyXSA9PSAwKSB7CiAgICAgIExvZ0Vycm9yTXNnKDAsICJTZW5kZXIgaGFzIG5vIHRva2VucyB0byB3aXRoZHJhdyEiKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGlmIChtc2cuc2VuZGVyID09IHNlbGYub3duZXIpIHsKICAgICAgaWYoIWNyb3dkc2FsZUVuZGVkKHNlbGYpKXsKICAgICAgICBMb2dFcnJvck1zZygwLCAiT3duZXIgY2Fubm90IHdpdGhkcmF3IGV4dHJhIHRva2VucyB1bnRpbCBhZnRlciB0aGUgc2FsZSEiKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYoc2VsZi5wZXJjZW50QnVybiA+IDApewogICAgICAgICAgdWludDI1NiBfYnVybkFtb3VudCA9IChzZWxmLndpdGhkcmF3VG9rZW5zTWFwW21zZy5zZW5kZXJdICogc2VsZi5wZXJjZW50QnVybikvMTAwOwogICAgICAgICAgc2VsZi53aXRoZHJhd1Rva2Vuc01hcFttc2cuc2VuZGVyXSA9IHNlbGYud2l0aGRyYXdUb2tlbnNNYXBbbXNnLnNlbmRlcl0gLSBfYnVybkFtb3VudDsKICAgICAgICAgIG9rID0gc2VsZi50b2tlbi5idXJuVG9rZW4oX2J1cm5BbW91bnQpOwogICAgICAgICAgcmVxdWlyZShvayk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgdmFyIHRvdGFsID0gc2VsZi53aXRoZHJhd1Rva2Vuc01hcFttc2cuc2VuZGVyXTsKICAgIHNlbGYud2l0aGRyYXdUb2tlbnNNYXBbbXNnLnNlbmRlcl0gPSAwOwogICAgb2sgPSBzZWxmLnRva2VuLnRyYW5zZmVyKG1zZy5zZW5kZXIsIHRvdGFsKTsKICAgIHJlcXVpcmUob2spOwogICAgTG9nVG9rZW5zV2l0aGRyYXduKG1zZy5zZW5kZXIsIHRvdGFsKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgRnVuY3Rpb24gY2FsbGVkIGJ5IHB1cmNoYXNlcnMgdG8gcHVsbCBsZWZ0b3ZlciB3ZWkgZnJvbSB0aGVpciBwdXJjaGFzZXMKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcmV0dXJuIHRydWUgaWYgd2VpIHdhcyB3aXRoZHJhd24KICBmdW5jdGlvbiB3aXRoZHJhd0xlZnRvdmVyV2VpKENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgaWYgKHNlbGYubGVmdG92ZXJXZWlbbXNnLnNlbmRlcl0gPT0gMCkgewogICAgICBMb2dFcnJvck1zZygwLCAiU2VuZGVyIGhhcyBubyBleHRyYSB3ZWkgdG8gd2l0aGRyYXchIik7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICB2YXIgdG90YWwgPSBzZWxmLmxlZnRvdmVyV2VpW21zZy5zZW5kZXJdOwogICAgc2VsZi5sZWZ0b3ZlcldlaVttc2cuc2VuZGVyXSA9IDA7CiAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKHRvdGFsKTsKICAgIExvZ1dlaVdpdGhkcmF3bihtc2cuc2VuZGVyLCB0b3RhbCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IHNlbmQgZXRoZXIgZnJvbSB0aGUgY29tcGxldGVkIGNyb3dkc2FsZSB0byB0aGUgb3duZXJzIHdhbGxldCBhZGRyZXNzCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBjcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHJldHVybiB0cnVlIGlmIG93bmVyIHdpdGhkcmV3IGV0aAogIGZ1bmN0aW9uIHdpdGhkcmF3T3duZXJFdGgoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBpZiAoKCFjcm93ZHNhbGVFbmRlZChzZWxmKSkgJiYgKHNlbGYudG9rZW4uYmFsYW5jZU9mKHRoaXMpPjApKSB7CiAgICAgIExvZ0Vycm9yTXNnKDAsICJDYW5ub3Qgd2l0aGRyYXcgb3duZXIgZXRoZXIgdW50aWwgYWZ0ZXIgdGhlIHNhbGUhIik7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gc2VsZi5vd25lcik7CiAgICByZXF1aXJlKHNlbGYub3duZXJCYWxhbmNlID4gMCk7CgogICAgdWludDI1NiBhbW91bnQgPSBzZWxmLm93bmVyQmFsYW5jZTsKICAgIHNlbGYub3duZXJCYWxhbmNlID0gMDsKICAgIHNlbGYub3duZXIudHJhbnNmZXIoYW1vdW50KTsKICAgIExvZ093bmVyRXRoV2l0aGRyYXduKG1zZy5zZW5kZXIsYW1vdW50LCJDcm93ZHNhbGUgb3duZXIgaGFzIHdpdGhkcmF3biBhbGwgZnVuZHMhIik7CgogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBGdW5jdGlvbiB0byBjaGFuZ2UgdGhlIHByaWNlIG9mIHRoZSB0b2tlbgogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgY3Jvd2RzYWxlIGZyb20gY3Jvd2RzYWxlIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfdG9rZW5zUGVyRXRoIG5ldyB0b2tlbiBwcmljZSAoYW1vdW50IG9mIHRva2VucyBwZXIgZXRoZXIpCiAgLy8vIEByZXR1cm4gdHJ1ZSBpZiB0aGUgdG9rZW4gcHJpY2UgY2hhbmdlZCBzdWNjZXNzZnVsbHkKICBmdW5jdGlvbiBjaGFuZ2VUb2tlblByaWNlKENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDI1NiBfdG9rZW5zUGVyRXRoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJuYWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybnMgKGJvb2wpCiAgewogIAlyZXF1aXJlKF90b2tlbnNQZXJFdGggPiAwKTsKCiAgICBzZWxmLnRva2Vuc1BlckV0aCA9IF90b2tlbnNQZXJFdGg7CgogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBmdW5jdGlvbiB0byBzZXQgdG9rZW5zIGZvciB0aGUgc2FsZQogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgQ3Jvd2RzYWxlIGZyb20gY3Jvd2RzYWxlIGNvbnRyYWN0CiAgLy8vIEByZXR1cm4gdHJ1ZSBpZiB0b2tlbnMgc2V0IHN1Y2Nlc3NmdWxseQogIGZ1bmN0aW9uIHNldFRva2VucyhDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBzZWxmLm93bmVyKTsKICAgIHJlcXVpcmUoIXNlbGYudG9rZW5zU2V0KTsKICAgIHJlcXVpcmUobm93IDwgc2VsZi5lbmRUaW1lKTsKCiAgICB1aW50MjU2IF90b2tlbkJhbGFuY2U7CgogICAgX3Rva2VuQmFsYW5jZSA9IHNlbGYudG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgc2VsZi53aXRoZHJhd1Rva2Vuc01hcFttc2cuc2VuZGVyXSA9IF90b2tlbkJhbGFuY2U7CiAgICBzZWxmLnN0YXJ0aW5nVG9rZW5CYWxhbmNlID0gX3Rva2VuQmFsYW5jZTsKICAgIHNlbGYudG9rZW5zU2V0ID0gdHJ1ZTsKCiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IEdldHMgdGhlIHByaWNlIGFuZCBidXkgY2FwIGZvciBpbmRpdmlkdWFsIGFkZHJlc3NlcyBhdCB0aGUgZ2l2ZW4gbWlsZXN0b25lIGluZGV4CiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBDcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHBhcmFtIHRpbWVzdGFtcCBUaW1lIGR1cmluZyBzYWxlIGZvciB3aGljaCBkYXRhIGlzIHJlcXVlc3RlZAogIC8vLyBAcmV0dXJuIEEgMy1lbGVtZW50IGFycmF5IHdpdGggMCB0aGUgdGltZXN0YW1wLCAxIHRoZSBwcmljZSBpbiBjZW50cywgMiB0aGUgYWRkcmVzcyBjYXAKICBmdW5jdGlvbiBnZXRTYWxlRGF0YShDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZiwgdWludDI1NiB0aW1lc3RhbXApCiAgICAgICAgICAgICAgICAgICAgICAgcHVibGljCiAgICAgICAgICAgICAgICAgICAgICAgdmlldwogICAgICAgICAgICAgICAgICAgICAgIHJldHVybnMgKHVpbnQyNTZbM10pCiAgewogICAgdWludDI1NlszXSBtZW1vcnkgX3RoaXNEYXRhOwogICAgdWludDI1NiBpbmRleDsKCiAgICB3aGlsZSgoaW5kZXggPCBzZWxmLm1pbGVzdG9uZVRpbWVzLmxlbmd0aCkgJiYgKHNlbGYubWlsZXN0b25lVGltZXNbaW5kZXhdIDwgdGltZXN0YW1wKSkgewogICAgICBpbmRleCsrOwogICAgfQogICAgaWYoaW5kZXggPT0gMCkKICAgICAgaW5kZXgrKzsKCiAgICBfdGhpc0RhdGFbMF0gPSBzZWxmLm1pbGVzdG9uZVRpbWVzW2luZGV4IC0gMV07CiAgICBfdGhpc0RhdGFbMV0gPSBzZWxmLnNhbGVEYXRhW190aGlzRGF0YVswXV1bMF07CiAgICBfdGhpc0RhdGFbMl0gPSBzZWxmLnNhbGVEYXRhW190aGlzRGF0YVswXV1bMV07CiAgICByZXR1cm4gX3RoaXNEYXRhOwogIH0KCiAgLy8vIEBkZXYgR2V0cyB0aGUgbnVtYmVyIG9mIHRva2VucyBzb2xkIHRodXMgZmFyCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBDcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHJldHVybiBOdW1iZXIgb2YgdG9rZW5zIHNvbGQKICBmdW5jdGlvbiBnZXRUb2tlbnNTb2xkKENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gc2VsZi5zdGFydGluZ1Rva2VuQmFsYW5jZSAtIHNlbGYud2l0aGRyYXdUb2tlbnNNYXBbc2VsZi5vd25lcl07CiAgfQp9CgpsaWJyYXJ5IExpbmtlZExpc3RMaWIgewoKICAgIHVpbnQyNTYgY29uc3RhbnQgTlVMTCA9IDA7CiAgICB1aW50MjU2IGNvbnN0YW50IEhFQUQgPSAwOwogICAgYm9vbCBjb25zdGFudCBQUkVWID0gZmFsc2U7CiAgICBib29sIGNvbnN0YW50IE5FWFQgPSB0cnVlOwogICAgCiAgICBzdHJ1Y3QgTGlua2VkTGlzdHsKICAgICAgICBtYXBwaW5nICh1aW50MjU2ID0+IG1hcHBpbmcgKGJvb2wgPT4gdWludDI1NikpIGxpc3Q7CiAgICB9CgogICAgLy8vIEBkZXYgcmV0dXJucyB0cnVlIGlmIHRoZSBsaXN0IGV4aXN0cwogICAgLy8vIEBwYXJhbSBzZWxmIHN0b3JlZCBsaW5rZWQgbGlzdCBmcm9tIGNvbnRyYWN0CiAgICBmdW5jdGlvbiBsaXN0RXhpc3RzKExpbmtlZExpc3Qgc3RvcmFnZSBzZWxmKQogICAgICAgIGludGVybmFsCiAgICAgICAgdmlldyByZXR1cm5zIChib29sKQogICAgewogICAgICAgIC8vIGlmIHRoZSBoZWFkIG5vZGVzIHByZXZpb3VzIG9yIG5leHQgcG9pbnRlcnMgYm90aCBwb2ludCB0byBpdHNlbGYsIHRoZW4gdGhlcmUgYXJlIG5vIGl0ZW1zIGluIHRoZSBsaXN0CiAgICAgICAgaWYgKHNlbGYubGlzdFtIRUFEXVtQUkVWXSAhPSBIRUFEIHx8IHNlbGYubGlzdFtIRUFEXVtORVhUXSAhPSBIRUFEKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgcmV0dXJucyB0cnVlIGlmIHRoZSBub2RlIGV4aXN0cwogICAgLy8vIEBwYXJhbSBzZWxmIHN0b3JlZCBsaW5rZWQgbGlzdCBmcm9tIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF9ub2RlIGEgbm9kZSB0byBzZWFyY2ggZm9yCiAgICBmdW5jdGlvbiBub2RlRXhpc3RzKExpbmtlZExpc3Qgc3RvcmFnZSBzZWxmLCB1aW50MjU2IF9ub2RlKSAKICAgICAgICBpbnRlcm5hbAogICAgICAgIHZpZXcgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBpZiAoc2VsZi5saXN0W19ub2RlXVtQUkVWXSA9PSBIRUFEICYmIHNlbGYubGlzdFtfbm9kZV1bTkVYVF0gPT0gSEVBRCkgewogICAgICAgICAgICBpZiAoc2VsZi5saXN0W0hFQURdW05FWFRdID09IF9ub2RlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8vIEBkZXYgUmV0dXJucyB0aGUgbnVtYmVyIG9mIGVsZW1lbnRzIGluIHRoZSBsaXN0CiAgICAvLy8gQHBhcmFtIHNlbGYgc3RvcmVkIGxpbmtlZCBsaXN0IGZyb20gY29udHJhY3QKICAgIGZ1bmN0aW9uIHNpemVPZihMaW5rZWRMaXN0IHN0b3JhZ2Ugc2VsZikgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2IG51bUVsZW1lbnRzKSB7CiAgICAgICAgYm9vbCBleGlzdHM7CiAgICAgICAgdWludDI1NiBpOwogICAgICAgIChleGlzdHMsaSkgPSBnZXRBZGphY2VudChzZWxmLCBIRUFELCBORVhUKTsKICAgICAgICB3aGlsZSAoaSAhPSBIRUFEKSB7CiAgICAgICAgICAgIChleGlzdHMsaSkgPSBnZXRBZGphY2VudChzZWxmLCBpLCBORVhUKTsKICAgICAgICAgICAgbnVtRWxlbWVudHMrKzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgdGhlIGxpbmtzIG9mIGEgbm9kZSBhcyBhIHR1cGxlCiAgICAvLy8gQHBhcmFtIHNlbGYgc3RvcmVkIGxpbmtlZCBsaXN0IGZyb20gY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX25vZGUgaWQgb2YgdGhlIG5vZGUgdG8gZ2V0CiAgICBmdW5jdGlvbiBnZXROb2RlKExpbmtlZExpc3Qgc3RvcmFnZSBzZWxmLCB1aW50MjU2IF9ub2RlKQogICAgICAgIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCx1aW50MjU2LHVpbnQyNTYpCiAgICB7CiAgICAgICAgaWYgKCFub2RlRXhpc3RzKHNlbGYsX25vZGUpKSB7CiAgICAgICAgICAgIHJldHVybiAoZmFsc2UsMCwwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gKHRydWUsc2VsZi5saXN0W19ub2RlXVtQUkVWXSwgc2VsZi5saXN0W19ub2RlXVtORVhUXSk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgdGhlIGxpbmsgb2YgYSBub2RlIGBfbm9kZWAgaW4gZGlyZWN0aW9uIGBfZGlyZWN0aW9uYC4KICAgIC8vLyBAcGFyYW0gc2VsZiBzdG9yZWQgbGlua2VkIGxpc3QgZnJvbSBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfbm9kZSBpZCBvZiB0aGUgbm9kZSB0byBzdGVwIGZyb20KICAgIC8vLyBAcGFyYW0gX2RpcmVjdGlvbiBkaXJlY3Rpb24gdG8gc3RlcCBpbgogICAgZnVuY3Rpb24gZ2V0QWRqYWNlbnQoTGlua2VkTGlzdCBzdG9yYWdlIHNlbGYsIHVpbnQyNTYgX25vZGUsIGJvb2wgX2RpcmVjdGlvbikKICAgICAgICBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wsdWludDI1NikKICAgIHsKICAgICAgICBpZiAoIW5vZGVFeGlzdHMoc2VsZixfbm9kZSkpIHsKICAgICAgICAgICAgcmV0dXJuIChmYWxzZSwwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gKHRydWUsc2VsZi5saXN0W19ub2RlXVtfZGlyZWN0aW9uXSk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IENhbiBiZSB1c2VkIGJlZm9yZSBgaW5zZXJ0YCB0byBidWlsZCBhbiBvcmRlcmVkIGxpc3QKICAgIC8vLyBAcGFyYW0gc2VsZiBzdG9yZWQgbGlua2VkIGxpc3QgZnJvbSBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfbm9kZSBhbiBleGlzdGluZyBub2RlIHRvIHNlYXJjaCBmcm9tLCBlLmcuIEhFQUQuCiAgICAvLy8gQHBhcmFtIF92YWx1ZSB2YWx1ZSB0byBzZWVrCiAgICAvLy8gQHBhcmFtIF9kaXJlY3Rpb24gZGlyZWN0aW9uIHRvIHNlZWsgaW4KICAgIC8vICBAcmV0dXJuIG5leHQgZmlyc3Qgbm9kZSBiZXlvbmQgJ19ub2RlJyBpbiBkaXJlY3Rpb24gYF9kaXJlY3Rpb25gCiAgICBmdW5jdGlvbiBnZXRTb3J0ZWRTcG90KExpbmtlZExpc3Qgc3RvcmFnZSBzZWxmLCB1aW50MjU2IF9ub2RlLCB1aW50MjU2IF92YWx1ZSwgYm9vbCBfZGlyZWN0aW9uKQogICAgICAgIGludGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICBpZiAoc2l6ZU9mKHNlbGYpID09IDApIHsgcmV0dXJuIDA7IH0KICAgICAgICByZXF1aXJlKChfbm9kZSA9PSAwKSB8fCBub2RlRXhpc3RzKHNlbGYsX25vZGUpKTsKICAgICAgICBib29sIGV4aXN0czsKICAgICAgICB1aW50MjU2IG5leHQ7CiAgICAgICAgKGV4aXN0cyxuZXh0KSA9IGdldEFkamFjZW50KHNlbGYsIF9ub2RlLCBfZGlyZWN0aW9uKTsKICAgICAgICB3aGlsZSAgKChuZXh0ICE9IDApICYmIChfdmFsdWUgIT0gbmV4dCkgJiYgKChfdmFsdWUgPCBuZXh0KSAhPSBfZGlyZWN0aW9uKSkgbmV4dCA9IHNlbGYubGlzdFtuZXh0XVtfZGlyZWN0aW9uXTsKICAgICAgICByZXR1cm4gbmV4dDsKICAgIH0KCiAgICAvLy8gQGRldiBDcmVhdGVzIGEgYmlkaXJlY3Rpb25hbCBsaW5rIGJldHdlZW4gdHdvIG5vZGVzIG9uIGRpcmVjdGlvbiBgX2RpcmVjdGlvbmAKICAgIC8vLyBAcGFyYW0gc2VsZiBzdG9yZWQgbGlua2VkIGxpc3QgZnJvbSBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfbm9kZSBmaXJzdCBub2RlIGZvciBsaW5raW5nCiAgICAvLy8gQHBhcmFtIF9saW5rICBub2RlIHRvIGxpbmsgdG8gaW4gdGhlIF9kaXJlY3Rpb24KICAgIGZ1bmN0aW9uIGNyZWF0ZUxpbmsoTGlua2VkTGlzdCBzdG9yYWdlIHNlbGYsIHVpbnQyNTYgX25vZGUsIHVpbnQyNTYgX2xpbmssIGJvb2wgX2RpcmVjdGlvbikgaW50ZXJuYWwgIHsKICAgICAgICBzZWxmLmxpc3RbX2xpbmtdWyFfZGlyZWN0aW9uXSA9IF9ub2RlOwogICAgICAgIHNlbGYubGlzdFtfbm9kZV1bX2RpcmVjdGlvbl0gPSBfbGluazsKICAgIH0KCiAgICAvLy8gQGRldiBJbnNlcnQgbm9kZSBgX25ld2AgYmVzaWRlIGV4aXN0aW5nIG5vZGUgYF9ub2RlYCBpbiBkaXJlY3Rpb24gYF9kaXJlY3Rpb25gLgogICAgLy8vIEBwYXJhbSBzZWxmIHN0b3JlZCBsaW5rZWQgbGlzdCBmcm9tIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF9ub2RlIGV4aXN0aW5nIG5vZGUKICAgIC8vLyBAcGFyYW0gX25ldyAgbmV3IG5vZGUgdG8gaW5zZXJ0CiAgICAvLy8gQHBhcmFtIF9kaXJlY3Rpb24gZGlyZWN0aW9uIHRvIGluc2VydCBub2RlIGluCiAgICBmdW5jdGlvbiBpbnNlcnQoTGlua2VkTGlzdCBzdG9yYWdlIHNlbGYsIHVpbnQyNTYgX25vZGUsIHVpbnQyNTYgX25ldywgYm9vbCBfZGlyZWN0aW9uKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgaWYoIW5vZGVFeGlzdHMoc2VsZixfbmV3KSAmJiBub2RlRXhpc3RzKHNlbGYsX25vZGUpKSB7CiAgICAgICAgICAgIHVpbnQyNTYgYyA9IHNlbGYubGlzdFtfbm9kZV1bX2RpcmVjdGlvbl07CiAgICAgICAgICAgIGNyZWF0ZUxpbmsoc2VsZiwgX25vZGUsIF9uZXcsIF9kaXJlY3Rpb24pOwogICAgICAgICAgICBjcmVhdGVMaW5rKHNlbGYsIF9uZXcsIGMsIF9kaXJlY3Rpb24pOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLy8gQGRldiByZW1vdmVzIGFuIGVudHJ5IGZyb20gdGhlIGxpbmtlZCBsaXN0CiAgICAvLy8gQHBhcmFtIHNlbGYgc3RvcmVkIGxpbmtlZCBsaXN0IGZyb20gY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX25vZGUgbm9kZSB0byByZW1vdmUgZnJvbSB0aGUgbGlzdAogICAgZnVuY3Rpb24gcmVtb3ZlKExpbmtlZExpc3Qgc3RvcmFnZSBzZWxmLCB1aW50MjU2IF9ub2RlKSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgaWYgKChfbm9kZSA9PSBOVUxMKSB8fCAoIW5vZGVFeGlzdHMoc2VsZixfbm9kZSkpKSB7IHJldHVybiAwOyB9CiAgICAgICAgY3JlYXRlTGluayhzZWxmLCBzZWxmLmxpc3RbX25vZGVdW1BSRVZdLCBzZWxmLmxpc3RbX25vZGVdW05FWFRdLCBORVhUKTsKICAgICAgICBkZWxldGUgc2VsZi5saXN0W19ub2RlXVtQUkVWXTsKICAgICAgICBkZWxldGUgc2VsZi5saXN0W19ub2RlXVtORVhUXTsKICAgICAgICByZXR1cm4gX25vZGU7CiAgICB9CgogICAgLy8vIEBkZXYgcHVzaGVzIGFuIGVucnR5IHRvIHRoZSBoZWFkIG9mIHRoZSBsaW5rZWQgbGlzdAogICAgLy8vIEBwYXJhbSBzZWxmIHN0b3JlZCBsaW5rZWQgbGlzdCBmcm9tIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF9ub2RlIG5ldyBlbnRyeSB0byBwdXNoIHRvIHRoZSBoZWFkCiAgICAvLy8gQHBhcmFtIF9kaXJlY3Rpb24gcHVzaCB0byB0aGUgaGVhZCAoTkVYVCkgb3IgdGFpbCAoUFJFVikKICAgIGZ1bmN0aW9uIHB1c2goTGlua2VkTGlzdCBzdG9yYWdlIHNlbGYsIHVpbnQyNTYgX25vZGUsIGJvb2wgX2RpcmVjdGlvbikgaW50ZXJuYWwgIHsKICAgICAgICBpbnNlcnQoc2VsZiwgSEVBRCwgX25vZGUsIF9kaXJlY3Rpb24pOwogICAgfQogICAgCiAgICAvLy8gQGRldiBwb3BzIHRoZSBmaXJzdCBlbnRyeSBmcm9tIHRoZSBsaW5rZWQgbGlzdAogICAgLy8vIEBwYXJhbSBzZWxmIHN0b3JlZCBsaW5rZWQgbGlzdCBmcm9tIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF9kaXJlY3Rpb24gcG9wIGZyb20gdGhlIGhlYWQgKE5FWFQpIG9yIHRoZSB0YWlsIChQUkVWKQogICAgZnVuY3Rpb24gcG9wKExpbmtlZExpc3Qgc3RvcmFnZSBzZWxmLCBib29sIF9kaXJlY3Rpb24pIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICBib29sIGV4aXN0czsKICAgICAgICB1aW50MjU2IGFkajsKCiAgICAgICAgKGV4aXN0cyxhZGopID0gZ2V0QWRqYWNlbnQoc2VsZiwgSEVBRCwgX2RpcmVjdGlvbik7CgogICAgICAgIHJldHVybiByZW1vdmUoc2VsZiwgYWRqKTsKICAgIH0KfQoKbGlicmFyeSBUb2tlbkxpYiB7CiAgdXNpbmcgQmFzaWNNYXRoTGliIGZvciB1aW50MjU2OwoKICBzdHJ1Y3QgVG9rZW5TdG9yYWdlIHsKICAgIGJvb2wgaW5pdGlhbGl6ZWQ7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwoKICAgIHN0cmluZyBuYW1lOwogICAgc3RyaW5nIHN5bWJvbDsKICAgIHVpbnQyNTYgdG90YWxTdXBwbHk7CiAgICB1aW50MjU2IGluaXRpYWxTdXBwbHk7CiAgICBhZGRyZXNzIG93bmVyOwogICAgdWludDggZGVjaW1hbHM7CiAgICBib29sIHN0aWxsTWludGluZzsKICB9CgogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwogIGV2ZW50IE93bmVyQ2hhbmdlKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0byk7CiAgZXZlbnQgQnVybihhZGRyZXNzIGluZGV4ZWQgYnVybmVyLCB1aW50MjU2IHZhbHVlKTsKICBldmVudCBNaW50aW5nQ2xvc2VkKGJvb2wgbWludGluZ0Nsb3NlZCk7CgogIC8vLyBAZGV2IENhbGxlZCBieSB0aGUgU3RhbmRhcmQgVG9rZW4gdXBvbiBjcmVhdGlvbi4KICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIHRva2VuIGZyb20gdG9rZW4gY29udHJhY3QKICAvLy8gQHBhcmFtIF9uYW1lIE5hbWUgb2YgdGhlIG5ldyB0b2tlbgogIC8vLyBAcGFyYW0gX3N5bWJvbCBTeW1ib2wgb2YgdGhlIG5ldyB0b2tlbgogIC8vLyBAcGFyYW0gX2RlY2ltYWxzIERlY2ltYWwgcGxhY2VzIGZvciB0aGUgdG9rZW4gcmVwcmVzZW50ZWQKICAvLy8gQHBhcmFtIF9pbml0aWFsX3N1cHBseSBUaGUgaW5pdGlhbCB0b2tlbiBzdXBwbHkKICAvLy8gQHBhcmFtIF9hbGxvd01pbnRpbmcgVHJ1ZSBpZiBhZGRpdGlvbmFsIHRva2VucyBjYW4gYmUgY3JlYXRlZCwgZmFsc2Ugb3RoZXJ3aXNlCiAgZnVuY3Rpb24gaW5pdChUb2tlblN0b3JhZ2Ugc3RvcmFnZSBzZWxmLAogICAgICAgICAgICAgICAgYWRkcmVzcyBfb3duZXIsCiAgICAgICAgICAgICAgICBzdHJpbmcgX25hbWUsCiAgICAgICAgICAgICAgICBzdHJpbmcgX3N5bWJvbCwKICAgICAgICAgICAgICAgIHVpbnQ4IF9kZWNpbWFscywKICAgICAgICAgICAgICAgIHVpbnQyNTYgX2luaXRpYWxfc3VwcGx5LAogICAgICAgICAgICAgICAgYm9vbCBfYWxsb3dNaW50aW5nKQogICAgICAgICAgICAgICAgcHVibGljCiAgewogICAgcmVxdWlyZSghc2VsZi5pbml0aWFsaXplZCk7CiAgICBzZWxmLmluaXRpYWxpemVkID0gdHJ1ZTsKICAgIHNlbGYubmFtZSA9IF9uYW1lOwogICAgc2VsZi5zeW1ib2wgPSBfc3ltYm9sOwogICAgc2VsZi50b3RhbFN1cHBseSA9IF9pbml0aWFsX3N1cHBseTsKICAgIHNlbGYuaW5pdGlhbFN1cHBseSA9IF9pbml0aWFsX3N1cHBseTsKICAgIHNlbGYuZGVjaW1hbHMgPSBfZGVjaW1hbHM7CiAgICBzZWxmLm93bmVyID0gX293bmVyOwogICAgc2VsZi5zdGlsbE1pbnRpbmcgPSBfYWxsb3dNaW50aW5nOwogICAgc2VsZi5iYWxhbmNlc1tfb3duZXJdID0gX2luaXRpYWxfc3VwcGx5OwogIH0KCiAgLy8vIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gY2FsbGVyJ3MgYWNjb3VudCB0byBhbm90aGVyIGFjY291bnQuCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCB0b2tlbiBmcm9tIHRva2VuIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfdG8gQWRkcmVzcyB0byBzZW5kIHRva2VucwogIC8vLyBAcGFyYW0gX3ZhbHVlIE51bWJlciBvZiB0b2tlbnMgdG8gc2VuZAogIC8vLyBAcmV0dXJuIFRydWUgaWYgY29tcGxldGVkCiAgZnVuY3Rpb24gdHJhbnNmZXIoVG9rZW5TdG9yYWdlIHN0b3JhZ2Ugc2VsZiwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICBib29sIGVycjsKICAgIHVpbnQyNTYgYmFsYW5jZTsKCiAgICAoZXJyLGJhbGFuY2UpID0gc2VsZi5iYWxhbmNlc1ttc2cuc2VuZGVyXS5taW51cyhfdmFsdWUpOwogICAgcmVxdWlyZSghZXJyKTsKICAgIHNlbGYuYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlOwogICAgLy9JdCdzIG5vdCBwb3NzaWJsZSB0byBvdmVyZmxvdyB0b2tlbiBzdXBwbHkKICAgIHNlbGYuYmFsYW5jZXNbX3RvXSA9IHNlbGYuYmFsYW5jZXNbX3RvXSArIF92YWx1ZTsKICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgQXV0aG9yaXplZCBjYWxsZXIgdHJhbnNmZXJzIHRva2VucyBmcm9tIG9uZSBhY2NvdW50IHRvIGFub3RoZXIKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIHRva2VuIGZyb20gdG9rZW4gY29udHJhY3QKICAvLy8gQHBhcmFtIF9mcm9tIEFkZHJlc3MgdG8gc2VuZCB0b2tlbnMgZnJvbQogIC8vLyBAcGFyYW0gX3RvIEFkZHJlc3MgdG8gc2VuZCB0b2tlbnMgdG8KICAvLy8gQHBhcmFtIF92YWx1ZSBOdW1iZXIgb2YgdG9rZW5zIHRvIHNlbmQKICAvLy8gQHJldHVybiBUcnVlIGlmIGNvbXBsZXRlZAogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShUb2tlblN0b3JhZ2Ugc3RvcmFnZSBzZWxmLAogICAgICAgICAgICAgICAgICAgICAgICBhZGRyZXNzIF9mcm9tLAogICAgICAgICAgICAgICAgICAgICAgICBhZGRyZXNzIF90bywKICAgICAgICAgICAgICAgICAgICAgICAgdWludDI1NiBfdmFsdWUpCiAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5zIChib29sKQogIHsKICAgIHZhciBfYWxsb3dhbmNlID0gc2VsZi5hbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsKICAgIGJvb2wgZXJyOwogICAgdWludDI1NiBiYWxhbmNlT3duZXI7CiAgICB1aW50MjU2IGJhbGFuY2VTcGVuZGVyOwoKICAgIChlcnIsYmFsYW5jZU93bmVyKSA9IHNlbGYuYmFsYW5jZXNbX2Zyb21dLm1pbnVzKF92YWx1ZSk7CiAgICByZXF1aXJlKCFlcnIpOwoKICAgIChlcnIsYmFsYW5jZVNwZW5kZXIpID0gX2FsbG93YW5jZS5taW51cyhfdmFsdWUpOwogICAgcmVxdWlyZSghZXJyKTsKCiAgICBzZWxmLmJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VPd25lcjsKICAgIHNlbGYuYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBiYWxhbmNlU3BlbmRlcjsKICAgIHNlbGYuYmFsYW5jZXNbX3RvXSA9IHNlbGYuYmFsYW5jZXNbX3RvXSArIF92YWx1ZTsKCiAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBSZXRyaWV2ZSB0b2tlbiBiYWxhbmNlIGZvciBhbiBhY2NvdW50CiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCB0b2tlbiBmcm9tIHRva2VuIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfb3duZXIgQWRkcmVzcyB0byByZXRyaWV2ZSBiYWxhbmNlIG9mCiAgLy8vIEByZXR1cm4gYmFsYW5jZSBUaGUgbnVtYmVyIG9mIHRva2VucyBpbiB0aGUgc3ViamVjdCBhY2NvdW50CiAgZnVuY3Rpb24gYmFsYW5jZU9mKFRva2VuU3RvcmFnZSBzdG9yYWdlIHNlbGYsIGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgIHJldHVybiBzZWxmLmJhbGFuY2VzW19vd25lcl07CiAgfQoKICAvLy8gQGRldiBBdXRob3JpemUgYW4gYWNjb3VudCB0byBzZW5kIHRva2VucyBvbiBjYWxsZXIncyBiZWhhbGYKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIHRva2VuIGZyb20gdG9rZW4gY29udHJhY3QKICAvLy8gQHBhcmFtIF9zcGVuZGVyIEFkZHJlc3MgdG8gYXV0aG9yaXplCiAgLy8vIEBwYXJhbSBfdmFsdWUgTnVtYmVyIG9mIHRva2VucyBhdXRob3JpemVkIGFjY291bnQgbWF5IHNlbmQKICAvLy8gQHJldHVybiBUcnVlIGlmIGNvbXBsZXRlZAogIGZ1bmN0aW9uIGFwcHJvdmUoVG9rZW5TdG9yYWdlIHN0b3JhZ2Ugc2VsZiwgYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAvLyBtdXN0IHNldCB0byB6ZXJvIGJlZm9yZSBjaGFuZ2luZyBhcHByb3ZhbCBhbW91bnQgaW4gYWNjb3JkYW5jZSB3aXRoIHNwZWMKICAgIHJlcXVpcmUoKF92YWx1ZSA9PSAwKSB8fCAoc2VsZi5hbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9PSAwKSk7CgogICAgc2VsZi5hbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBSZW1haW5pbmcgdG9rZW5zIHRoaXJkIHBhcnR5IHNwZW5kZXIgaGFzIHRvIHNlbmQKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIHRva2VuIGZyb20gdG9rZW4gY29udHJhY3QKICAvLy8gQHBhcmFtIF9vd25lciBBZGRyZXNzIG9mIHRva2VuIGhvbGRlcgogIC8vLyBAcGFyYW0gX3NwZW5kZXIgQWRkcmVzcyBvZiBhdXRob3JpemVkIHNwZW5kZXIKICAvLy8gQHJldHVybiByZW1haW5pbmcgTnVtYmVyIG9mIHRva2VucyBzcGVuZGVyIGhhcyBsZWZ0IGluIG93bmVyJ3MgYWNjb3VudAogIGZ1bmN0aW9uIGFsbG93YW5jZShUb2tlblN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCBhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikKICAgICAgICAgICAgICAgICAgICAgcHVibGljCiAgICAgICAgICAgICAgICAgICAgIHZpZXcKICAgICAgICAgICAgICAgICAgICAgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgIHJldHVybiBzZWxmLmFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgfQoKICAvLy8gQGRldiBBdXRob3JpemUgdGhpcmQgcGFydHkgdHJhbnNmZXIgYnkgaW5jcmVhc2luZy9kZWNyZWFzaW5nIGFsbG93ZWQgcmF0aGVyIHRoYW4gc2V0dGluZyBpdAogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgdG9rZW4gZnJvbSB0b2tlbiBjb250cmFjdAogIC8vLyBAcGFyYW0gX3NwZW5kZXIgQWRkcmVzcyB0byBhdXRob3JpemUKICAvLy8gQHBhcmFtIF92YWx1ZUNoYW5nZSBJbmNyZWFzZSBvciBkZWNyZWFzZSBpbiBudW1iZXIgb2YgdG9rZW5zIGF1dGhvcml6ZWQgYWNjb3VudCBtYXkgc2VuZAogIC8vLyBAcGFyYW0gX2luY3JlYXNlIFRydWUgaWYgaW5jcmVhc2luZyBhbGxvd2FuY2UsIGZhbHNlIGlmIGRlY3JlYXNpbmcgYWxsb3dhbmNlCiAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBjb21wbGV0ZWQKICBmdW5jdGlvbiBhcHByb3ZlQ2hhbmdlIChUb2tlblN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCBhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZUNoYW5nZSwgYm9vbCBfaW5jcmVhc2UpCiAgICAgICAgICAgICAgICAgICAgICAgICAgcHVibGljIHJldHVybnMgKGJvb2wpCiAgewogICAgdWludDI1NiBfbmV3QWxsb3dlZDsKICAgIGJvb2wgZXJyOwoKICAgIGlmKF9pbmNyZWFzZSkgewogICAgICAoZXJyLCBfbmV3QWxsb3dlZCkgPSBzZWxmLmFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdLnBsdXMoX3ZhbHVlQ2hhbmdlKTsKICAgICAgcmVxdWlyZSghZXJyKTsKCiAgICAgIHNlbGYuYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfbmV3QWxsb3dlZDsKICAgIH0gZWxzZSB7CiAgICAgIGlmIChfdmFsdWVDaGFuZ2UgPiBzZWxmLmFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKSB7CiAgICAgICAgc2VsZi5hbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgX25ld0FsbG93ZWQgPSBzZWxmLmFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdIC0gX3ZhbHVlQ2hhbmdlOwogICAgICAgIHNlbGYuYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfbmV3QWxsb3dlZDsKICAgICAgfQogICAgfQoKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfbmV3QWxsb3dlZCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IENoYW5nZSBvd25pbmcgYWRkcmVzcyBvZiB0aGUgdG9rZW4gY29udHJhY3QsIHNwZWNpZmljYWxseSBmb3IgbWludGluZwogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgdG9rZW4gZnJvbSB0b2tlbiBjb250cmFjdAogIC8vLyBAcGFyYW0gX25ld093bmVyIEFkZHJlc3MgZm9yIHRoZSBuZXcgb3duZXIKICAvLy8gQHJldHVybiBUcnVlIGlmIGNvbXBsZXRlZAogIGZ1bmN0aW9uIGNoYW5nZU93bmVyKFRva2VuU3RvcmFnZSBzdG9yYWdlIHNlbGYsIGFkZHJlc3MgX25ld093bmVyKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZSgoc2VsZi5vd25lciA9PSBtc2cuc2VuZGVyKSAmJiAoX25ld093bmVyID4gMCkpOwoKICAgIHNlbGYub3duZXIgPSBfbmV3T3duZXI7CiAgICBPd25lckNoYW5nZShtc2cuc2VuZGVyLCBfbmV3T3duZXIpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBNaW50cyBhZGRpdGlvbmFsIHRva2VucywgbmV3IHRva2VucyBnbyB0byBvd25lcgogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgdG9rZW4gZnJvbSB0b2tlbiBjb250cmFjdAogIC8vLyBAcGFyYW0gX2Ftb3VudCBOdW1iZXIgb2YgdG9rZW5zIHRvIG1pbnQKICAvLy8gQHJldHVybiBUcnVlIGlmIGNvbXBsZXRlZAogIGZ1bmN0aW9uIG1pbnRUb2tlbihUb2tlblN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKChzZWxmLm93bmVyID09IG1zZy5zZW5kZXIpICYmIHNlbGYuc3RpbGxNaW50aW5nKTsKICAgIHVpbnQyNTYgX25ld0Ftb3VudDsKICAgIGJvb2wgZXJyOwoKICAgIChlcnIsIF9uZXdBbW91bnQpID0gc2VsZi50b3RhbFN1cHBseS5wbHVzKF9hbW91bnQpOwogICAgcmVxdWlyZSghZXJyKTsKCiAgICBzZWxmLnRvdGFsU3VwcGx5ID0gIF9uZXdBbW91bnQ7CiAgICBzZWxmLmJhbGFuY2VzW3NlbGYub3duZXJdID0gc2VsZi5iYWxhbmNlc1tzZWxmLm93bmVyXSArIF9hbW91bnQ7CiAgICBUcmFuc2ZlcigweDAsIHNlbGYub3duZXIsIF9hbW91bnQpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBQZXJtYW5lbnQgc3RvcHMgbWludGluZwogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgdG9rZW4gZnJvbSB0b2tlbiBjb250cmFjdAogIC8vLyBAcmV0dXJuIFRydWUgaWYgY29tcGxldGVkCiAgZnVuY3Rpb24gY2xvc2VNaW50KFRva2VuU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKHNlbGYub3duZXIgPT0gbXNnLnNlbmRlcik7CgogICAgc2VsZi5zdGlsbE1pbnRpbmcgPSBmYWxzZTsKICAgIE1pbnRpbmdDbG9zZWQodHJ1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IFBlcm1hbmVudGx5IGJ1cm4gdG9rZW5zCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCB0b2tlbiBmcm9tIHRva2VuIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfYW1vdW50IEFtb3VudCBvZiB0b2tlbnMgdG8gYnVybgogIC8vLyBAcmV0dXJuIFRydWUgaWYgY29tcGxldGVkCiAgZnVuY3Rpb24gYnVyblRva2VuKFRva2VuU3RvcmFnZSBzdG9yYWdlIHNlbGYsIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgdWludDI1NiBfbmV3QmFsYW5jZTsKICAgICAgYm9vbCBlcnI7CgogICAgICAoZXJyLCBfbmV3QmFsYW5jZSkgPSBzZWxmLmJhbGFuY2VzW21zZy5zZW5kZXJdLm1pbnVzKF9hbW91bnQpOwogICAgICByZXF1aXJlKCFlcnIpOwoKICAgICAgc2VsZi5iYWxhbmNlc1ttc2cuc2VuZGVyXSA9IF9uZXdCYWxhbmNlOwogICAgICBzZWxmLnRvdGFsU3VwcGx5ID0gc2VsZi50b3RhbFN1cHBseSAtIF9hbW91bnQ7CiAgICAgIEJ1cm4obXNnLnNlbmRlciwgX2Ftb3VudCk7CiAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIDB4MCwgX2Ftb3VudCk7CiAgICAgIHJldHVybiB0cnVlOwogIH0KfQoKY29udHJhY3QgQ3Jvd2RzYWxlVG9rZW4gewogIHVzaW5nIFRva2VuTGliIGZvciBUb2tlbkxpYi5Ub2tlblN0b3JhZ2U7CgogIFRva2VuTGliLlRva2VuU3RvcmFnZSBwdWJsaWMgdG9rZW47CgogIGZ1bmN0aW9uIENyb3dkc2FsZVRva2VuKGFkZHJlc3Mgb3duZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nIG5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nIHN5bWJvbCwKICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50OCBkZWNpbWFscywKICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MjU2IGluaXRpYWxTdXBwbHksCiAgICAgICAgICAgICAgICAgICAgICAgICAgYm9vbCBhbGxvd01pbnRpbmcpIHB1YmxpYwogIHsKICAgIHRva2VuLmluaXQob3duZXIsIG5hbWUsIHN5bWJvbCwgZGVjaW1hbHMsIGluaXRpYWxTdXBwbHksIGFsbG93TWludGluZyk7CiAgfQoKICBmdW5jdGlvbiBuYW1lKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nKSB7CiAgICByZXR1cm4gdG9rZW4ubmFtZTsKICB9CgogIGZ1bmN0aW9uIHN5bWJvbCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZykgewogICAgcmV0dXJuIHRva2VuLnN5bWJvbDsKICB9CgogIGZ1bmN0aW9uIGRlY2ltYWxzKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDgpIHsKICAgIHJldHVybiB0b2tlbi5kZWNpbWFsczsKICB9CgogIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHRva2VuLnRvdGFsU3VwcGx5OwogIH0KCiAgZnVuY3Rpb24gaW5pdGlhbFN1cHBseSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiB0b2tlbi5pbml0aWFsU3VwcGx5OwogIH0KCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gdG9rZW4uYmFsYW5jZU9mKHdobyk7CiAgfQoKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gdG9rZW4uYWxsb3dhbmNlKG93bmVyLCBzcGVuZGVyKTsKICB9CgogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIG9rKSB7CiAgICByZXR1cm4gdG9rZW4udHJhbnNmZXIodG8sIHZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIG9rKSB7CiAgICByZXR1cm4gdG9rZW4udHJhbnNmZXJGcm9tKGZyb20sIHRvLCB2YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludCB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgb2spIHsKICAgIHJldHVybiB0b2tlbi5hcHByb3ZlKHNwZW5kZXIsIHZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIGFwcHJvdmVDaGFuZ2UoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlQ2hhbmdlLCBib29sIGluY3JlYXNlKQogICAgICAgICAgICAgICAgICAgICAgICAgcHVibGljIHJldHVybnMgKGJvb2wgb2spCiAgewogICAgcmV0dXJuIHRva2VuLmFwcHJvdmVDaGFuZ2Uoc3BlbmRlciwgdmFsdWVDaGFuZ2UsIGluY3JlYXNlKTsKICB9CgogIGZ1bmN0aW9uIGNoYW5nZU93bmVyKGFkZHJlc3MgbmV3T3duZXIpIHB1YmxpYyByZXR1cm5zIChib29sIG9rKSB7CiAgICByZXR1cm4gdG9rZW4uY2hhbmdlT3duZXIobmV3T3duZXIpOwogIH0KCiAgZnVuY3Rpb24gbWludFRva2VuKHVpbnQyNTYgYW1vdW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCBvaykgewogICAgcmV0dXJuIHRva2VuLm1pbnRUb2tlbihhbW91bnQpOwogIH0KCiAgZnVuY3Rpb24gY2xvc2VNaW50KCkgcHVibGljIHJldHVybnMgKGJvb2wgb2spIHsKICAgIHJldHVybiB0b2tlbi5jbG9zZU1pbnQoKTsKICB9CgogIGZ1bmN0aW9uIGJ1cm5Ub2tlbih1aW50MjU2IGFtb3VudCkgcHVibGljIHJldHVybnMgKGJvb2wgb2spIHsKICAgIHJldHVybiB0b2tlbi5idXJuVG9rZW4oYW1vdW50KTsKICB9Cn0KCmxpYnJhcnkgQmFzaWNNYXRoTGliIHsKICAvLy8gQGRldiBNdWx0aXBsaWVzIHR3byBudW1iZXJzIGFuZCBjaGVja3MgZm9yIG92ZXJmbG93IGJlZm9yZSByZXR1cm5pbmcuCiAgLy8vIERvZXMgbm90IHRocm93LgogIC8vLyBAcGFyYW0gYSBGaXJzdCBudW1iZXIKICAvLy8gQHBhcmFtIGIgU2Vjb25kIG51bWJlcgogIC8vLyBAcmV0dXJuIGVyciBGYWxzZSBub3JtYWxseSwgb3IgdHJ1ZSBpZiB0aGVyZSBpcyBvdmVyZmxvdwogIC8vLyBAcmV0dXJuIHJlcyBUaGUgcHJvZHVjdCBvZiBhIGFuZCBiLCBvciAwIGlmIHRoZXJlIGlzIG92ZXJmbG93CiAgZnVuY3Rpb24gdGltZXModWludDI1NiBhLCB1aW50MjU2IGIpIHB1YmxpYyBwdXJlIHJldHVybnMgKGJvb2wgZXJyLHVpbnQyNTYgcmVzKSB7CiAgICBhc3NlbWJseXsKICAgICAgcmVzIDo9IG11bChhLGIpCiAgICAgIHN3aXRjaCBvcihpc3plcm8oYiksIGVxKGRpdihyZXMsYiksIGEpKQogICAgICBjYXNlIDAgewogICAgICAgIGVyciA6PSAxCiAgICAgICAgcmVzIDo9IDAKICAgICAgfQogICAgfQogIH0KCiAgLy8vIEBkZXYgRGl2aWRlcyB0d28gbnVtYmVycyBidXQgY2hlY2tzIGZvciAwIGluIHRoZSBkaXZpc29yIGZpcnN0LgogIC8vLyBEb2VzIG5vdCB0aHJvdy4KICAvLy8gQHBhcmFtIGEgRmlyc3QgbnVtYmVyCiAgLy8vIEBwYXJhbSBiIFNlY29uZCBudW1iZXIKICAvLy8gQHJldHVybiBlcnIgRmFsc2Ugbm9ybWFsbHksIG9yIHRydWUgaWYgYGJgIGlzIDAKICAvLy8gQHJldHVybiByZXMgVGhlIHF1b3RpZW50IG9mIGEgYW5kIGIsIG9yIDAgaWYgYGJgIGlzIDAKICBmdW5jdGlvbiBkaXZpZGVkQnkodWludDI1NiBhLCB1aW50MjU2IGIpIHB1YmxpYyBwdXJlIHJldHVybnMgKGJvb2wgZXJyLHVpbnQyNTYgaSkgewogICAgdWludDI1NiByZXM7CiAgICBhc3NlbWJseXsKICAgICAgc3dpdGNoIGlzemVybyhiKQogICAgICBjYXNlIDAgewogICAgICAgIHJlcyA6PSBkaXYoYSxiKQogICAgICAgIGxldCBsb2MgOj0gbWxvYWQoMHg0MCkKICAgICAgICBtc3RvcmUoYWRkKGxvYywweDIwKSxyZXMpCiAgICAgICAgaSA6PSBtbG9hZChhZGQobG9jLDB4MjApKQogICAgICB9CiAgICAgIGRlZmF1bHQgewogICAgICAgIGVyciA6PSAxCiAgICAgICAgaSA6PSAwCiAgICAgIH0KICAgIH0KICB9CgogIC8vLyBAZGV2IEFkZHMgdHdvIG51bWJlcnMgYW5kIGNoZWNrcyBmb3Igb3ZlcmZsb3cgYmVmb3JlIHJldHVybmluZy4KICAvLy8gRG9lcyBub3QgdGhyb3cuCiAgLy8vIEBwYXJhbSBhIEZpcnN0IG51bWJlcgogIC8vLyBAcGFyYW0gYiBTZWNvbmQgbnVtYmVyCiAgLy8vIEByZXR1cm4gZXJyIEZhbHNlIG5vcm1hbGx5LCBvciB0cnVlIGlmIHRoZXJlIGlzIG92ZXJmbG93CiAgLy8vIEByZXR1cm4gcmVzIFRoZSBzdW0gb2YgYSBhbmQgYiwgb3IgMCBpZiB0aGVyZSBpcyBvdmVyZmxvdwogIGZ1bmN0aW9uIHBsdXModWludDI1NiBhLCB1aW50MjU2IGIpIHB1YmxpYyBwdXJlIHJldHVybnMgKGJvb2wgZXJyLCB1aW50MjU2IHJlcykgewogICAgYXNzZW1ibHl7CiAgICAgIHJlcyA6PSBhZGQoYSxiKQogICAgICBzd2l0Y2ggYW5kKGVxKHN1YihyZXMsYiksIGEpLCBvcihndChyZXMsYiksZXEocmVzLGIpKSkKICAgICAgY2FzZSAwIHsKICAgICAgICBlcnIgOj0gMQogICAgICAgIHJlcyA6PSAwCiAgICAgIH0KICAgIH0KICB9CgogIC8vLyBAZGV2IFN1YnRyYWN0cyB0d28gbnVtYmVycyBhbmQgY2hlY2tzIGZvciB1bmRlcmZsb3cgYmVmb3JlIHJldHVybmluZy4KICAvLy8gRG9lcyBub3QgdGhyb3cgYnV0IHJhdGhlciBsb2dzIGFuIEVyciBldmVudCBpZiB0aGVyZSBpcyB1bmRlcmZsb3cuCiAgLy8vIEBwYXJhbSBhIEZpcnN0IG51bWJlcgogIC8vLyBAcGFyYW0gYiBTZWNvbmQgbnVtYmVyCiAgLy8vIEByZXR1cm4gZXJyIEZhbHNlIG5vcm1hbGx5LCBvciB0cnVlIGlmIHRoZXJlIGlzIHVuZGVyZmxvdwogIC8vLyBAcmV0dXJuIHJlcyBUaGUgZGlmZmVyZW5jZSBiZXR3ZWVuIGEgYW5kIGIsIG9yIDAgaWYgdGhlcmUgaXMgdW5kZXJmbG93CiAgZnVuY3Rpb24gbWludXModWludDI1NiBhLCB1aW50MjU2IGIpIHB1YmxpYyBwdXJlIHJldHVybnMgKGJvb2wgZXJyLHVpbnQyNTYgcmVzKSB7CiAgICBhc3NlbWJseXsKICAgICAgcmVzIDo9IHN1YihhLGIpCiAgICAgIHN3aXRjaCBlcShhbmQoZXEoYWRkKHJlcyxiKSwgYSksIG9yKGx0KHJlcyxhKSwgZXEocmVzLGEpKSksIDEpCiAgICAgIGNhc2UgMCB7CiAgICAgICAgZXJyIDo9IDEKICAgICAgICByZXMgOj0gMAogICAgICB9CiAgICB9CiAgfQp9'.
	

]
