Class {
	#name : #SRT89ac2485449303a67dac802631d5cea8cb2c856c,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT89ac2485449303a67dac802631d5cea8cb2c856c >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKLyoqCiAqIEB0aXRsZSBFUkMyMEJhc2ljCiAqIEBkZXYgU2ltcGxlciB2ZXJzaW9uIG9mIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTc5CiAqLwpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwp9CgovKioKICogQHRpdGxlIEJhc2ljIHRva2VuCiAqIEBkZXYgQmFzaWMgdmVyc2lvbiBvZiBTdGFuZGFyZFRva2VuLCB3aXRoIG5vIGFsbG93YW5jZXMuCiAqLwpjb250cmFjdCBCYXNpY1Rva2VuIGlzIEVSQzIwQmFzaWMgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CgogIC8qKgogICogQGRldiB0cmFuc2ZlciB0b2tlbiBmb3IgYSBzcGVjaWZpZWQgYWRkcmVzcwogICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0by4KICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCB0byBiZSB0cmFuc2ZlcnJlZC4KICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CgogICAgLy8gU2FmZU1hdGguc3ViIHdpbGwgdGhyb3cgaWYgdGhlcmUgaXMgbm90IGVub3VnaCBiYWxhbmNlLgogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAqIEBkZXYgR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuCiAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSB0aGUgYmFsYW5jZSBvZi4KICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgKi8KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgfQoKfQoKLyoqCiAqIEB0aXRsZSBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqLwpjb250cmFjdCBFUkMyMCBpcyBFUkMyMEJhc2ljIHsKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSByZXR1cm5zIChib29sKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7Cn0KCi8qKgogKiBAdGl0bGUgU3RhbmRhcmQgRVJDMjAgdG9rZW4KICoKICogQGRldiBJbXBsZW1lbnRhdGlvbiBvZiB0aGUgYmFzaWMgc3RhbmRhcmQgdG9rZW4uCiAqIEBkZXYgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqIEBkZXYgQmFzZWQgb24gY29kZSBieSBGaXJzdEJsb29kOiBodHRwczovL2dpdGh1Yi5jb20vRmlyc3RibG9vZGlvL3Rva2VuL2Jsb2IvbWFzdGVyL3NtYXJ0X2NvbnRyYWN0L0ZpcnN0Qmxvb2RUb2tlbi5zb2wKICovCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgRVJDMjAsIEJhc2ljVG9rZW4gewoKICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CgoKICAvKioKICAgKiBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIKICAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tCiAgICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHRyYW5zZmVyIHRvCiAgICogQHBhcmFtIF92YWx1ZSB1aW50MjU2IHRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CgogICAgdmFyIF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsKCiAgICAvLyBDaGVjayBpcyBub3QgbmVlZGVkIGJlY2F1c2Ugc3ViKF9hbGxvd2FuY2UsIF92YWx1ZSkgd2lsbCBhbHJlYWR5IHRocm93IGlmIHRoaXMgY29uZGl0aW9uIGlzIG5vdCBtZXQKICAgIC8vIHJlcXVpcmUgKF92YWx1ZSA8PSBfYWxsb3dhbmNlKTsKCiAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gX2FsbG93YW5jZS5zdWIoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgQXBwcm92ZSB0aGUgcGFzc2VkIGFkZHJlc3MgdG8gc3BlbmQgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIG9uIGJlaGFsZiBvZiBtc2cuc2VuZGVyLgogICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHNwZW50LgogICAqLwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wpIHsKCiAgICAvLyBUbyBjaGFuZ2UgdGhlIGFwcHJvdmUgYW1vdW50IHlvdSBmaXJzdCBoYXZlIHRvIHJlZHVjZSB0aGUgYWRkcmVzc2VzYAogICAgLy8gIGFsbG93YW5jZSB0byB6ZXJvIGJ5IGNhbGxpbmcgYGFwcHJvdmUoX3NwZW5kZXIsIDApYCBpZiBpdCBpcyBub3QKICAgIC8vICBhbHJlYWR5IDAgdG8gbWl0aWdhdGUgdGhlIHJhY2UgY29uZGl0aW9uIGRlc2NyaWJlZCBoZXJlOgogICAgLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICByZXF1aXJlKChfdmFsdWUgPT0gMCkgfHwgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID09IDApKTsKCiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIGNoZWNrIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgYW4gb3duZXIgYWxsb3dlZCB0byBhIHNwZW5kZXIuCiAgICogQHBhcmFtIF9vd25lciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIG93bnMgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfc3BlbmRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEByZXR1cm4gQSB1aW50MjU2IHNwZWNpZnlpbmcgdGhlIGFtb3VudCBvZiB0b2tlbnMgc3RpbGwgYXZhaWxhYmxlIGZvciB0aGUgc3BlbmRlci4KICAgKi8KICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICB9CgogIC8qKgogICAqIGFwcHJvdmUgc2hvdWxkIGJlIGNhbGxlZCB3aGVuIGFsbG93ZWRbX3NwZW5kZXJdID09IDAuIFRvIGluY3JlbWVudAogICAqIGFsbG93ZWQgdmFsdWUgaXMgYmV0dGVyIHRvIHVzZSB0aGlzIGZ1bmN0aW9uIHRvIGF2b2lkIDIgY2FsbHMgKGFuZCB3YWl0IHVudGlsCiAgICogdGhlIGZpcnN0IHRyYW5zYWN0aW9uIGlzIG1pbmVkKQogICAqIEZyb20gTW9ub2xpdGhEQU8gVG9rZW4uc29sCiAgICovCiAgZnVuY3Rpb24gaW5jcmVhc2VBcHByb3ZhbCAoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYWRkZWRWYWx1ZSkKICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXS5hZGQoX2FkZGVkVmFsdWUpOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gZGVjcmVhc2VBcHByb3ZhbCAoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfc3VidHJhY3RlZFZhbHVlKQogICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICB1aW50IG9sZFZhbHVlID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl07CiAgICBpZiAoX3N1YnRyYWN0ZWRWYWx1ZSA+IG9sZFZhbHVlKSB7CiAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gMDsKICAgIH0gZWxzZSB7CiAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gb2xkVmFsdWUuc3ViKF9zdWJ0cmFjdGVkVmFsdWUpOwogICAgfQogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgIHJldHVybiB0cnVlOwogIH0KCn0KCi8qKgogKiBAdGl0bGUgU2ltcGxlVG9rZW4KICogQGRldiBWZXJ5IHNpbXBsZSBFUkMyMCBUb2tlbiBleGFtcGxlLCB3aGVyZSBhbGwgdG9rZW5zIGFyZSBwcmUtYXNzaWduZWQgdG8gdGhlIGNyZWF0b3IuCiAqIE5vdGUgdGhleSBjYW4gbGF0ZXIgZGlzdHJpYnV0ZSB0aGVzZSB0b2tlbnMgYXMgdGhleSB3aXNoIHVzaW5nIGB0cmFuc2ZlcmAgYW5kIG90aGVyCiAqIGBTdGFuZGFyZFRva2VuYCBmdW5jdGlvbnMuCiAqLwpjb250cmFjdCBPcHBvcnR5VG9rZW4gaXMgU3RhbmRhcmRUb2tlbiB7CgogIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJPcHBvcnR5VG9rZW4iOwogIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gIk9QUCI7CiAgdWludDggcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gMTg7CgogIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IElOSVRJQUxfU1VQUExZID0gMTAwMDAwMDAwMCAqICgxMCAqKiB1aW50MjU2KGRlY2ltYWxzKSk7CgogIC8qKgogICAqIEBkZXYgQ29udHJ1Y3RvciB0aGF0IGdpdmVzIG1zZy5zZW5kZXIgYWxsIG9mIGV4aXN0aW5nIHRva2Vucy4KICAgKi8KICBmdW5jdGlvbiBPcHBvcnR5VG9rZW4oKSB7CiAgICB0b3RhbFN1cHBseSA9IElOSVRJQUxfU1VQUExZOwogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBJTklUSUFMX1NVUFBMWTsKICB9Cgp9CgoKLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4KICovCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKCiAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIHByZXZpb3VzT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBuZXdPd25lcik7CgoKICAvKioKICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgKiBhY2NvdW50LgogICAqLwogIGZ1bmN0aW9uIE93bmFibGUoKSB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KCgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOwogICAgb3duZXIgPSBuZXdPd25lcjsKICB9Cgp9CgovKioKICogQHRpdGxlIFBhdXNhYmxlCiAqIEBkZXYgQmFzZSBjb250cmFjdCB3aGljaCBhbGxvd3MgY2hpbGRyZW4gdG8gaW1wbGVtZW50IGFuIGVtZXJnZW5jeSBzdG9wIG1lY2hhbmlzbS4KICovCmNvbnRyYWN0IFBhdXNhYmxlIGlzIE93bmFibGUgewogIGV2ZW50IFBhdXNlKCk7CiAgZXZlbnQgVW5wYXVzZSgpOwoKICBib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKCgogIC8qKgogICAqIEBkZXYgTW9kaWZpZXIgdG8gbWFrZSBhIGZ1bmN0aW9uIGNhbGxhYmxlIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgaXMgbm90IHBhdXNlZC4KICAgKi8KICBtb2RpZmllciB3aGVuTm90UGF1c2VkKCkgewogICAgcmVxdWlyZSghcGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIHBhdXNlZC4KICAgKi8KICBtb2RpZmllciB3aGVuUGF1c2VkKCkgewogICAgcmVxdWlyZShwYXVzZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byBwYXVzZSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHBhdXNlKCkgb25seU93bmVyIHdoZW5Ob3RQYXVzZWQgcHVibGljIHsKICAgIHBhdXNlZCA9IHRydWU7CiAgICBQYXVzZSgpOwogIH0KCiAgLyoqCiAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHVucGF1c2UsIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgICovCiAgZnVuY3Rpb24gdW5wYXVzZSgpIG9ubHlPd25lciB3aGVuUGF1c2VkIHB1YmxpYyB7CiAgICBwYXVzZWQgPSBmYWxzZTsKICAgIFVucGF1c2UoKTsKICB9Cn0KCmNvbnRyYWN0IEhvbGRQcmVzYWxlQ29udHJhY3QgaXMgT3duYWJsZSB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CiAgLy8gQWRkcmVzc2VzIGFuZCBjb250cmFjdHMKICBPcHBvcnR5VG9rZW4gcHVibGljIE9wcFRva2VuOwogIGFkZHJlc3MgcHJpdmF0ZSBwcmVzYWxlQ29udDsKCiAgc3RydWN0IEhvbGRlciB7CiAgICBib29sIGlzQWN0aXZlOwogICAgdWludCB0b2tlbnM7CiAgICB1aW50OCBob2xkUGVyaW9kOwogICAgdWludCBob2xkUGVyaW9kVGltZXN0YW1wOwogICAgYm9vbCB3aXRoZHJhd2VkOwogIH0KCiAgbWFwcGluZyhhZGRyZXNzID0+IEhvbGRlcikgcHVibGljIGhvbGRlckxpc3Q7CiAgbWFwcGluZyh1aW50ID0+IGFkZHJlc3MpIHByaXZhdGUgaG9sZGVySW5kZXhlczsKCiAgbWFwcGluZyAodWludCA9PiBhZGRyZXNzKSBwcml2YXRlIGFzc2V0T3duZXJzOwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkgcHJpdmF0ZSBhc3NldE93bmVyc0luZGV4OwogIHVpbnQgcHVibGljIGFzc2V0T3duZXJzSW5kZXhlczsKCiAgdWludCBwcml2YXRlIGhvbGRlckluZGV4OwoKICBldmVudCBUb2tlbnNUcmFuc2ZlcmVkKGFkZHJlc3MgY29udHJpYnV0b3IgLCB1aW50IGFtb3VudCk7CiAgZXZlbnQgSG9sZChhZGRyZXNzIHNlbmRlciwgYWRkcmVzcyBjb250cmlidXRvciwgdWludCBhbW91bnQsIHVpbnQ4IGhvbGRQZXJpb2QpOwoKICBtb2RpZmllciBvbmx5QXNzZXRzT3duZXJzKCkgewogICAgcmVxdWlyZShhc3NldE93bmVyc0luZGV4W21zZy5zZW5kZXJdID4gMCk7CiAgICBfOwogIH0KCiAgLyogY29uc3RydWN0b3IgKi8KICBmdW5jdGlvbiBIb2xkUHJlc2FsZUNvbnRyYWN0KGFkZHJlc3MgX09wcFRva2VuKSB7CiAgICBPcHBUb2tlbiA9IE9wcG9ydHlUb2tlbihfT3BwVG9rZW4pOwogIH0KCiAgZnVuY3Rpb24gc2V0UHJlc2FsZUNvbnQoYWRkcmVzcyBwcmVzKSAgcHVibGljIG9ubHlPd25lcgogIHsKICAgIHByZXNhbGVDb250ID0gcHJlczsKICB9CgogIGZ1bmN0aW9uIGFkZEhvbGRlcihhZGRyZXNzIGhvbGRlciwgdWludCB0b2tlbnMsIHVpbnQ4IHRpbWVkLCB1aW50IHRpbWVzdCkgb25seUFzc2V0c093bmVycyBleHRlcm5hbCB7CiAgICBpZiAoaG9sZGVyTGlzdFtob2xkZXJdLmlzQWN0aXZlID09IGZhbHNlKSB7CiAgICAgIGhvbGRlckxpc3RbaG9sZGVyXS5pc0FjdGl2ZSA9IHRydWU7CiAgICAgIGhvbGRlckxpc3RbaG9sZGVyXS50b2tlbnMgPSB0b2tlbnM7CiAgICAgIGhvbGRlckxpc3RbaG9sZGVyXS5ob2xkUGVyaW9kID0gdGltZWQ7CiAgICAgIGhvbGRlckxpc3RbaG9sZGVyXS5ob2xkUGVyaW9kVGltZXN0YW1wID0gdGltZXN0OwogICAgICBob2xkZXJJbmRleGVzW2hvbGRlckluZGV4XSA9IGhvbGRlcjsKICAgICAgaG9sZGVySW5kZXgrKzsKICAgIH0gZWxzZSB7CiAgICAgIGhvbGRlckxpc3RbaG9sZGVyXS50b2tlbnMgKz0gdG9rZW5zOwogICAgICBob2xkZXJMaXN0W2hvbGRlcl0uaG9sZFBlcmlvZCA9IHRpbWVkOwogICAgICBob2xkZXJMaXN0W2hvbGRlcl0uaG9sZFBlcmlvZFRpbWVzdGFtcCA9IHRpbWVzdDsKICAgIH0KICAgIEhvbGQobXNnLnNlbmRlciwgaG9sZGVyLCB0b2tlbnMsIHRpbWVkKTsKICB9CgogIGZ1bmN0aW9uIGdldEJhbGFuY2UoKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gT3BwVG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogIH0KCiAgZnVuY3Rpb24gdW5sb2NrVG9rZW5zKCkgZXh0ZXJuYWwgewogICAgYWRkcmVzcyBjb250cmlidXRvciA9IG1zZy5zZW5kZXI7CgogICAgaWYgKGhvbGRlckxpc3RbY29udHJpYnV0b3JdLmlzQWN0aXZlICYmICFob2xkZXJMaXN0W2NvbnRyaWJ1dG9yXS53aXRoZHJhd2VkKSB7CiAgICAgIGlmIChub3cgPj0gaG9sZGVyTGlzdFtjb250cmlidXRvcl0uaG9sZFBlcmlvZFRpbWVzdGFtcCkgewogICAgICAgIGlmICggT3BwVG9rZW4udHJhbnNmZXIoIG1zZy5zZW5kZXIsIGhvbGRlckxpc3RbY29udHJpYnV0b3JdLnRva2VucyApICkgewogICAgICAgICAgaG9sZGVyTGlzdFtjb250cmlidXRvcl0ud2l0aGRyYXdlZCA9IHRydWU7CiAgICAgICAgICBUb2tlbnNUcmFuc2ZlcmVkKGNvbnRyaWJ1dG9yLCAgaG9sZGVyTGlzdFtjb250cmlidXRvcl0udG9rZW5zKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV2ZXJ0KCk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHJldmVydCgpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gYWRkQXNzZXRzT3duZXIoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgYXNzZXRPd25lcnNJbmRleGVzKys7CiAgICBhc3NldE93bmVyc1thc3NldE93bmVyc0luZGV4ZXNdID0gX293bmVyOwogICAgYXNzZXRPd25lcnNJbmRleFtfb3duZXJdID0gYXNzZXRPd25lcnNJbmRleGVzOwogIH0KICBmdW5jdGlvbiByZW1vdmVBc3NldHNPd25lcihhZGRyZXNzIF9vd25lcikgcHVibGljIG9ubHlPd25lciB7CiAgICB1aW50IGluZGV4ID0gYXNzZXRPd25lcnNJbmRleFtfb3duZXJdOwogICAgZGVsZXRlIGFzc2V0T3duZXJzSW5kZXhbX293bmVyXTsKICAgIGRlbGV0ZSBhc3NldE93bmVyc1tpbmRleF07CiAgICBhc3NldE93bmVyc0luZGV4ZXMtLTsKICB9CiAgZnVuY3Rpb24gZ2V0QXNzZXRzT3duZXJzKHVpbnQgX2luZGV4KSBvbmx5T3duZXIgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MpIHsKICAgIHJldHVybiBhc3NldE93bmVyc1tfaW5kZXhdOwogIH0KfQoKY29udHJhY3QgT3Bwb3J0eVByZXNhbGUgaXMgUGF1c2FibGUgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICBPcHBvcnR5VG9rZW4gcHVibGljIHRva2VuOwoKICBIb2xkUHJlc2FsZUNvbnRyYWN0IHB1YmxpYyBob2xkQ29udHJhY3Q7CgogIGVudW0gU2FsZVN0YXRlICB7IE5FVywgU0FMRSwgRU5ERUQgfQogIFNhbGVTdGF0ZSBwdWJsaWMgc3RhdGU7CgogIHVpbnQgcHVibGljIGVuZERhdGU7CiAgdWludCBwdWJsaWMgZW5kU2FsZURhdGU7CgogIC8vIGFkZHJlc3Mgd2hlcmUgZnVuZHMgYXJlIGNvbGxlY3RlZAogIGFkZHJlc3MgcHJpdmF0ZSB3YWxsZXQ7CgogIC8vIHRvdGFsIEVUSCBjb2xsZWN0ZWQKICB1aW50IHB1YmxpYyBldGhSYWlzZWQ7CgogIHVpbnQgcHJpdmF0ZSBwcmljZTsKCiAgdWludCBwdWJsaWMgdG9rZW5SYWlzZWQ7CiAgYm9vbCBwdWJsaWMgdG9rZW5zVHJhbnNmZXJyZWRUb0hvbGQ7CgogIC8qIEV2ZW50cyAqLwogIGV2ZW50IFNhbGVTdGFydGVkKHVpbnQgYmxvY2tOdW1iZXIpOwogIGV2ZW50IFNhbGVFbmRlZCh1aW50IGJsb2NrTnVtYmVyKTsKICBldmVudCBGdW5kVHJhbnNmZXJlZChhZGRyZXNzIGNvbnRyaWIsIHVpbnQgYW1vdW50KTsKICBldmVudCBXaXRoZHJhd2VkRXRoVG9XYWxsZXQodWludCBhbW91bnQpOwogIGV2ZW50IE1hbnVhbENoYW5nZUVuZERhdGUodWludCBiZWZvcmVEYXRlLCB1aW50IGFmdGVyRGF0ZSk7CiAgZXZlbnQgVG9rZW5zVHJhbnNmZXJlZFRvSG9sZChhZGRyZXNzIGhvbGQsIHVpbnQgYW1vdW50KTsKICBldmVudCBBZGRlZFRvV2hpdGVMaXN0KGFkZHJlc3MgaW52LCB1aW50IGFtb3VudCwgdWludDggaG9sZFBlcmlvZCwgdWludDggYm9udXMpOwogIGV2ZW50IEFkZGVkVG9Ib2xkZXIoIGFkZHJlc3Mgc2VuZGVyLCB1aW50IHRva2VuQW1vdW50LCB1aW50OCBob2xkUGVyaW9kLCB1aW50IGhvbGRUaW1lc3RhbXApOwoKICBzdHJ1Y3QgV2hpdGVsaXN0Q29udHJpYnV0b3IgewogICAgYm9vbCBpc0FjdGl2ZTsKICAgIHVpbnQgaW52QW1vdW50OwogICAgdWludDggaG9sZFBlcmlvZDsKICAgIHVpbnQgaG9sZFRpbWVzdGFtcDsKICAgIHVpbnQ4IGJvbnVzOwogICAgYm9vbCBwYXllZDsKICB9CgogIG1hcHBpbmcoYWRkcmVzcyA9PiBXaGl0ZWxpc3RDb250cmlidXRvcikgcHVibGljIHdoaXRlTGlzdDsKICBtYXBwaW5nKHVpbnQgPT4gYWRkcmVzcykgcHJpdmF0ZSB3aGl0ZWxpc3RJbmRleGVzOwogIHVpbnQgcHJpdmF0ZSB3aGl0ZWxpc3RJbmRleDsKCiAgLyogY29uc3RydWN0b3IgKi8KICBmdW5jdGlvbiBPcHBvcnR5UHJlc2FsZSgKICAgIGFkZHJlc3MgdG9rZW5BZGRyZXNzLAogICAgYWRkcmVzcyB3YWxsZXRBZGRyZXNzLAogICAgdWludCBlbmQsCiAgICB1aW50IGVuZFNhbGUsCiAgICBhZGRyZXNzIGhvbGRDb250ICkKICB7CiAgICB0b2tlbiA9IE9wcG9ydHlUb2tlbih0b2tlbkFkZHJlc3MpOwogICAgc3RhdGUgPSBTYWxlU3RhdGUuTkVXOwoKICAgIGVuZERhdGUgICAgID0gZW5kOwogICAgZW5kU2FsZURhdGUgPSBlbmRTYWxlOwogICAgcHJpY2UgICAgICAgPSAwLjAwMDIgKiAxIGV0aGVyOwogICAgd2FsbGV0ICAgICAgPSB3YWxsZXRBZGRyZXNzOwoKICAgIGhvbGRDb250cmFjdCA9IEhvbGRQcmVzYWxlQ29udHJhY3QoaG9sZENvbnQpOwogIH0KCiAgZnVuY3Rpb24gc3RhcnRQcmVzYWxlKCkgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlKHN0YXRlID09IFNhbGVTdGF0ZS5ORVcpOwogICAgc3RhdGUgPSBTYWxlU3RhdGUuU0FMRTsKICAgIFNhbGVTdGFydGVkKGJsb2NrLm51bWJlcik7CiAgfQoKICBmdW5jdGlvbiBlbmRQcmVzYWxlKCkgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlKHN0YXRlID09IFNhbGVTdGF0ZS5TQUxFKTsKICAgIHN0YXRlID0gU2FsZVN0YXRlLkVOREVEOwogICAgU2FsZUVuZGVkKGJsb2NrLm51bWJlcik7CiAgfQoKICBmdW5jdGlvbiBhZGRUb1doaXRlbGlzdChhZGRyZXNzIGludiwgdWludCBhbW91bnQsIHVpbnQ4IGhvbGRQZXJpb2QsIHVpbnQ4IGJvbnVzKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmUoc3RhdGUgPT0gU2FsZVN0YXRlLk5FVyB8fCBzdGF0ZSA9PSBTYWxlU3RhdGUuU0FMRSk7CiAgICByZXF1aXJlKGhvbGRQZXJpb2QgPT0gMSB8fCBob2xkUGVyaW9kID09IDMgfHwgaG9sZFBlcmlvZCA9PSA2IHx8IGhvbGRQZXJpb2QgPT0gMTIpOwoKICAgIGFtb3VudCA9IGFtb3VudCAqICgxMCAqKiAxOCk7CgogICAgaWYgKHdoaXRlTGlzdFtpbnZdLmlzQWN0aXZlID09IGZhbHNlKSB7CiAgICAgIHdoaXRlTGlzdFtpbnZdLmlzQWN0aXZlID0gdHJ1ZTsKICAgICAgd2hpdGVMaXN0W2ludl0ucGF5ZWQgICAgPSBmYWxzZTsKICAgICAgd2hpdGVsaXN0SW5kZXhlc1t3aGl0ZWxpc3RJbmRleF0gPSBpbnY7CiAgICAgIHdoaXRlbGlzdEluZGV4Kys7CiAgICB9CgogICAgd2hpdGVMaXN0W2ludl0uaW52QW1vdW50ICA9IGFtb3VudDsKICAgIHdoaXRlTGlzdFtpbnZdLmhvbGRQZXJpb2QgPSBob2xkUGVyaW9kOwogICAgd2hpdGVMaXN0W2ludl0uYm9udXMgPSBib251czsKCiAgICBpZiAod2hpdGVMaXN0W2ludl0uaG9sZFBlcmlvZD09MSkgIHdoaXRlTGlzdFtpbnZdLmhvbGRUaW1lc3RhbXAgPSBlbmRTYWxlRGF0ZS5hZGQoMzAgZGF5cyk7IGVsc2UKICAgIGlmICh3aGl0ZUxpc3RbaW52XS5ob2xkUGVyaW9kPT0zKSAgd2hpdGVMaXN0W2ludl0uaG9sZFRpbWVzdGFtcCA9IGVuZFNhbGVEYXRlLmFkZCg5MiBkYXlzKTsgZWxzZQogICAgaWYgKHdoaXRlTGlzdFtpbnZdLmhvbGRQZXJpb2Q9PTYpICB3aGl0ZUxpc3RbaW52XS5ob2xkVGltZXN0YW1wID0gZW5kU2FsZURhdGUuYWRkKDE4MiBkYXlzKTsgZWxzZQogICAgaWYgKHdoaXRlTGlzdFtpbnZdLmhvbGRQZXJpb2Q9PTEyKSB3aGl0ZUxpc3RbaW52XS5ob2xkVGltZXN0YW1wID0gZW5kU2FsZURhdGUuYWRkKDEgeWVhcnMpOwoKICAgIEFkZGVkVG9XaGl0ZUxpc3QoaW52LCB3aGl0ZUxpc3RbaW52XS5pbnZBbW91bnQsIHdoaXRlTGlzdFtpbnZdLmhvbGRQZXJpb2QsICB3aGl0ZUxpc3RbaW52XS5ib251cyk7CiAgfQoKICBmdW5jdGlvbigpIHdoZW5Ob3RQYXVzZWQgcHVibGljIHBheWFibGUgewogICAgcmVxdWlyZShzdGF0ZSA9PSBTYWxlU3RhdGUuU0FMRSk7CiAgICByZXF1aXJlKG1zZy52YWx1ZSA+PSAwLjMgZXRoZXIpOwogICAgcmVxdWlyZSh3aGl0ZUxpc3RbbXNnLnNlbmRlcl0uaXNBY3RpdmUpOwoKICAgIGlmIChub3cgPiBlbmREYXRlKSB7CiAgICAgIHN0YXRlID0gU2FsZVN0YXRlLkVOREVEOwogICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKG1zZy52YWx1ZSk7CiAgICAgIHJldHVybiA7CiAgICB9CgogICAgV2hpdGVsaXN0Q29udHJpYnV0b3IgbWVtb3J5IGNvbnRyaWIgPSB3aGl0ZUxpc3RbbXNnLnNlbmRlcl07CiAgICByZXF1aXJlKGNvbnRyaWIuaW52QW1vdW50IDw9IG1zZy52YWx1ZSB8fCBjb250cmliLnBheWVkKTsKCiAgICBpZih3aGl0ZUxpc3RbbXNnLnNlbmRlcl0ucGF5ZWQgPT0gZmFsc2UpIHsKICAgICAgd2hpdGVMaXN0W21zZy5zZW5kZXJdLnBheWVkID0gdHJ1ZTsKICAgIH0KCiAgICBldGhSYWlzZWQgKz0gbXNnLnZhbHVlOwoKICAgIHVpbnQgdG9rZW5BbW91bnQgID0gbXNnLnZhbHVlLmRpdihwcmljZSk7CiAgICB0b2tlbkFtb3VudCArPSB0b2tlbkFtb3VudC5tdWwoY29udHJpYi5ib251cykuZGl2KDEwMCk7CiAgICB0b2tlbkFtb3VudCAqPSAxMCAqKiAxODsKCiAgICB0b2tlblJhaXNlZCArPSB0b2tlbkFtb3VudDsKCiAgICBob2xkQ29udHJhY3QuYWRkSG9sZGVyKG1zZy5zZW5kZXIsIHRva2VuQW1vdW50LCBjb250cmliLmhvbGRQZXJpb2QsIGNvbnRyaWIuaG9sZFRpbWVzdGFtcCk7CiAgICBBZGRlZFRvSG9sZGVyKG1zZy5zZW5kZXIsIHRva2VuQW1vdW50LCBjb250cmliLmhvbGRQZXJpb2QsIGNvbnRyaWIuaG9sZFRpbWVzdGFtcCk7CiAgICBGdW5kVHJhbnNmZXJlZChtc2cuc2VuZGVyLCBtc2cudmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gZ2V0QmFsYW5jZUNvbnRyYWN0KCkgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIHRva2VuLmJhbGFuY2VPZih0aGlzKTsKICB9CgogIGZ1bmN0aW9uIHNlbmRUb2tlbnNUb0hvbGQoKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmUoc3RhdGUgPT0gU2FsZVN0YXRlLkVOREVEKTsKCiAgICByZXF1aXJlKGdldEJhbGFuY2VDb250cmFjdCgpID49IHRva2VuUmFpc2VkKTsKCiAgICBpZiAodG9rZW4udHJhbnNmZXIoaG9sZENvbnRyYWN0LCB0b2tlblJhaXNlZCApKSB7CiAgICAgIHRva2Vuc1RyYW5zZmVycmVkVG9Ib2xkID0gdHJ1ZTsKICAgICAgVG9rZW5zVHJhbnNmZXJlZFRvSG9sZChob2xkQ29udHJhY3QsIHRva2VuUmFpc2VkICk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBnZXRUb2tlbnNCYWNrKCkgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlKHN0YXRlID09IFNhbGVTdGF0ZS5FTkRFRCk7CiAgICByZXF1aXJlKHRva2Vuc1RyYW5zZmVycmVkVG9Ib2xkID09IHRydWUpOwogICAgdWludCBiYWxhbmNlOwogICAgYmFsYW5jZSA9IGdldEJhbGFuY2VDb250cmFjdCgpIDsKICAgIHRva2VuLnRyYW5zZmVyKG1zZy5zZW5kZXIsIGJhbGFuY2UpOwogIH0KCiAgZnVuY3Rpb24gd2l0aGRyYXdFdGgoKSB7CiAgICByZXF1aXJlKHRoaXMuYmFsYW5jZSAhPSAwKTsKICAgIHJlcXVpcmUoc3RhdGUgPT0gU2FsZVN0YXRlLkVOREVEKTsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSB3YWxsZXQpOwogICAgcmVxdWlyZSh0b2tlbnNUcmFuc2ZlcnJlZFRvSG9sZCA9PSB0cnVlKTsKICAgIHVpbnQgYmFsID0gdGhpcy5iYWxhbmNlOwogICAgd2FsbGV0LnRyYW5zZmVyKGJhbCk7CiAgICBXaXRoZHJhd2VkRXRoVG9XYWxsZXQoYmFsKTsKICB9CgogIGZ1bmN0aW9uIHNldEVuZFNhbGVEYXRlKHVpbnQgZGF0ZSkgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlKHN0YXRlID09IFNhbGVTdGF0ZS5ORVcpOwogICAgcmVxdWlyZShkYXRlID4gbm93KTsKICAgIHVpbnQgb2xkRW5kRGF0ZSA9IGVuZFNhbGVEYXRlOwogICAgZW5kU2FsZURhdGUgPSBkYXRlOwogICAgTWFudWFsQ2hhbmdlRW5kRGF0ZShvbGRFbmREYXRlLCBkYXRlKTsKICB9CgogIGZ1bmN0aW9uIHNldEVuZERhdGUodWludCBkYXRlKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmUoc3RhdGUgPT0gU2FsZVN0YXRlLk5FVyB8fCBzdGF0ZSA9PSBTYWxlU3RhdGUuU0FMRSk7CiAgICByZXF1aXJlKGRhdGUgPiBub3cpOwogICAgdWludCBvbGRFbmREYXRlID0gZW5kRGF0ZTsKICAgIGVuZERhdGUgPSBkYXRlOwogICAgTWFudWFsQ2hhbmdlRW5kRGF0ZShvbGRFbmREYXRlLCBkYXRlKTsKICB9CgogIGZ1bmN0aW9uIGdldFRva2VuQmFsYW5jZSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiB0b2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgfQoKICBmdW5jdGlvbiBnZXRFdGhSYWlzZWQoKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gZXRoUmFpc2VkOwogIH0KfQoKCgpjb250cmFjdCBPcHBvcnR5U2FsZUJvbnVzIGlzIE93bmFibGUgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICB1aW50IHByaXZhdGUgc3RhcnREYXRlOwoKICAvKiBib251cyBmcm9tIHRpbWUgKi8KICB1aW50IHByaXZhdGUgZmlyc3RCb251c1BoYXNlOwogIHVpbnQgcHJpdmF0ZSBmaXJzdEV4dHJhQm9udXM7CiAgdWludCBwcml2YXRlIHNlY29uZEJvbnVzUGhhc2U7CiAgdWludCBwcml2YXRlIHNlY29uZEV4dHJhQm9udXM7CiAgdWludCBwcml2YXRlIHRoaXJkQm9udXNQaGFzZTsKICB1aW50IHByaXZhdGUgdGhpcmRFeHRyYUJvbnVzOwogIHVpbnQgcHJpdmF0ZSBmb3VyQm9udXNQaGFzZTsKICB1aW50IHByaXZhdGUgZm91ckV4dHJhQm9udXM7CiAgdWludCBwcml2YXRlIGZpZnRoQm9udXNQaGFzZTsKICB1aW50IHByaXZhdGUgZmlmdGhFeHRyYUJvbnVzOwogIHVpbnQgcHJpdmF0ZSBzaXh0aEJvbnVzUGhhc2U7CiAgdWludCBwcml2YXRlIHNpeHRoRXh0cmFCb251czsKCiAgLyoqCiAgKiBAZGV2IGNvbnN0cnVjdG9yCiAgKiAyMCUgJzFzdCAyNCBob3VycycKICAqIDE1JSAnMi00IGRheXMnCiAgKiAxMiUgJzUtOSBkYXlzJwogICogMTAlICcxMC0xNCBkYXlzJwogICogOCUgICcxNS0xOSBkYXlzJwogICogNSUgICcyMC0yNCBkYXlzJwogICogMCUgICcyNS0yOCBkYXlzJwogICovCiAgZnVuY3Rpb24gT3Bwb3J0eVNhbGVCb251cyh1aW50IF9zdGFydERhdGUpIHsKICAgIHN0YXJ0RGF0ZSA9IF9zdGFydERhdGU7CgogICAgZmlyc3RCb251c1BoYXNlICAgPSBzdGFydERhdGUuYWRkKDEgZGF5cyk7CiAgICBmaXJzdEV4dHJhQm9udXMgICA9IDIwOwogICAgc2Vjb25kQm9udXNQaGFzZSAgPSBzdGFydERhdGUuYWRkKDQgZGF5cyk7CiAgICBzZWNvbmRFeHRyYUJvbnVzICA9IDE1OwogICAgdGhpcmRCb251c1BoYXNlICAgPSBzdGFydERhdGUuYWRkKDkgZGF5cyk7CiAgICB0aGlyZEV4dHJhQm9udXMgICA9IDEyOwogICAgZm91ckJvbnVzUGhhc2UgICAgPSBzdGFydERhdGUuYWRkKDE0IGRheXMpOwogICAgZm91ckV4dHJhQm9udXMgICAgPSAxMDsKICAgIGZpZnRoQm9udXNQaGFzZSAgID0gc3RhcnREYXRlLmFkZCgxOSBkYXlzKTsKICAgIGZpZnRoRXh0cmFCb251cyAgID0gODsKICAgIHNpeHRoQm9udXNQaGFzZSAgID0gc3RhcnREYXRlLmFkZCgyNCBkYXlzKTsKICAgIHNpeHRoRXh0cmFCb251cyAgID0gNTsKICB9CgogIC8qKgogKiBAZGV2IENhbGN1bGF0ZSBib251cyBmb3IgaG91cnMKICogQHJldHVybiB0b2tlbiBib251cwogKi8KICBmdW5jdGlvbiBjYWxjdWxhdGVCb251c0ZvckhvdXJzKHVpbnQyNTYgX3Rva2VucykgcmV0dXJucyh1aW50MjU2KSB7CiAgICBpZiAobm93ID49IHN0YXJ0RGF0ZSAmJiBub3cgPD0gZmlyc3RCb251c1BoYXNlICkgewogICAgICByZXR1cm4gX3Rva2Vucy5tdWwoZmlyc3RFeHRyYUJvbnVzKS5kaXYoMTAwKTsKICAgIH0gZWxzZQogICAgaWYgKG5vdyA8PSBzZWNvbmRCb251c1BoYXNlICkgewogICAgICByZXR1cm4gX3Rva2Vucy5tdWwoc2Vjb25kRXh0cmFCb251cykuZGl2KDEwMCk7CiAgICB9IGVsc2UKICAgIGlmIChub3cgPD0gdGhpcmRCb251c1BoYXNlICkgewogICAgICByZXR1cm4gX3Rva2Vucy5tdWwodGhpcmRFeHRyYUJvbnVzKS5kaXYoMTAwKTsKICAgIH0gZWxzZQogICAgaWYgKG5vdyA8PSBmb3VyQm9udXNQaGFzZSApIHsKICAgICAgcmV0dXJuIF90b2tlbnMubXVsKGZvdXJFeHRyYUJvbnVzKS5kaXYoMTAwKTsKICAgIH0gZWxzZQogICAgaWYgKG5vdyA8PSBmaWZ0aEJvbnVzUGhhc2UgKSB7CiAgICAgIHJldHVybiBfdG9rZW5zLm11bChmaWZ0aEV4dHJhQm9udXMpLmRpdigxMDApOwogICAgfSBlbHNlCiAgICBpZiAobm93IDw9IHNpeHRoQm9udXNQaGFzZSApIHsKICAgICAgcmV0dXJuIF90b2tlbnMubXVsKHNpeHRoRXh0cmFCb251cykuZGl2KDEwMCk7CiAgICB9IGVsc2UKICAgIHJldHVybiAwOwogIH0KCiAgZnVuY3Rpb24gY2hhbmdlU3RhcnREYXRlKHVpbnQgX2RhdGUpIG9ubHlPd25lciB7CiAgICBzdGFydERhdGUgPSBfZGF0ZTsKICAgIGZpcnN0Qm9udXNQaGFzZSAgID0gc3RhcnREYXRlLmFkZCgxIGRheXMpOwogICAgc2Vjb25kQm9udXNQaGFzZSAgPSBzdGFydERhdGUuYWRkKDQgZGF5cyk7CiAgICB0aGlyZEJvbnVzUGhhc2UgICA9IHN0YXJ0RGF0ZS5hZGQoOSBkYXlzKTsKICAgIGZvdXJCb251c1BoYXNlICAgID0gc3RhcnREYXRlLmFkZCgxNCBkYXlzKTsKICAgIGZpZnRoQm9udXNQaGFzZSAgID0gc3RhcnREYXRlLmFkZCgxOSBkYXlzKTsKICAgIHNpeHRoQm9udXNQaGFzZSAgID0gc3RhcnREYXRlLmFkZCgyNCBkYXlzKTsKICB9CgogIC8qKgogKiBAZGV2IHJldHVybiBjdXJyZW50IGJvbnVzIHBlcmNlbnQKICovCiAgZnVuY3Rpb24gZ2V0Qm9udXMoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgaWYgKG5vdyA+PSBzdGFydERhdGUgJiYgbm93IDw9IGZpcnN0Qm9udXNQaGFzZSApIHsKICAgICAgcmV0dXJuIGZpcnN0RXh0cmFCb251czsKICAgIH0gZWxzZQogICAgaWYgKCBub3cgPD0gc2Vjb25kQm9udXNQaGFzZSApIHsKICAgICAgcmV0dXJuIHNlY29uZEV4dHJhQm9udXM7CiAgICB9IGVsc2UKICAgIGlmICggbm93IDw9IHRoaXJkQm9udXNQaGFzZSApIHsKICAgICAgcmV0dXJuIHRoaXJkRXh0cmFCb251czsKICAgIH0gZWxzZQogICAgaWYgKCBub3cgPD0gZm91ckJvbnVzUGhhc2UgKSB7CiAgICAgIHJldHVybiBmb3VyRXh0cmFCb251czsKICAgIH0gZWxzZQogICAgaWYgKCBub3cgPD0gZmlmdGhCb251c1BoYXNlICkgewogICAgICByZXR1cm4gZmlmdGhFeHRyYUJvbnVzOwogICAgfSBlbHNlCiAgICBpZiAoIG5vdyA8PSBzaXh0aEJvbnVzUGhhc2UgKSB7CiAgICAgIHJldHVybiBzaXh0aEV4dHJhQm9udXM7CiAgICB9IGVsc2UKICAgIHJldHVybiAwOwogIH0KCn0KCmNvbnRyYWN0IE9wcG9ydHlTYWxlIGlzIFBhdXNhYmxlIHsKCiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIE9wcG9ydHlUb2tlbiBwdWJsaWMgdG9rZW47CgogIC8vIG1pbmltdW0gZ29hbCBFVEgKICB1aW50IHByaXZhdGUgU09GVENBUDsKICAvLyBtYXhpbXVtIGdvYWwgRVRICiAgdWludCBwcml2YXRlIEhBUkRDQVA7CgogIC8vIHN0YXJ0IGFuZCBlbmQgdGltZXN0YW1wcyB3aGVyZSBpbnZlc3RtZW50cyBhcmUgYWxsb3dlZAogIHVpbnQgcHJpdmF0ZSBzdGFydERhdGU7CiAgdWludCBwcml2YXRlIGVuZERhdGU7CgogIHVpbnQgcHJpdmF0ZSBwcmljZTsKCiAgLy8gdG90YWwgRVRIIGNvbGxlY3RlZAogIHVpbnQgcHJpdmF0ZSBldGhSYWlzZWQ7CiAgLy8gdG90YWwgdG9rZW4gc2FsZXMKICB1aW50IHByaXZhdGUgdG90YWxUb2tlbnM7CiAgLy8gaG93IG1hbnkgdG9rZW5zIHNlbnQgdG8gaW52ZXN0b3JzCiAgdWludCBwcml2YXRlIHdpdGhkcmF3ZWRUb2tlbnM7CiAgLy8gbWluaW11bSBFVEggaW52ZXN0bWVudCBhbW91bnQKICB1aW50IHByaXZhdGUgbWluaW1hbENvbnRyaWJ1dGlvbjsKCiAgYm9vbCByZWxlYXNlZFRva2VuczsKCiAgLy8gYWRkcmVzcyB3aGVyZSBmdW5kcyBhcmUgY29sbGVjdGVkCiAgYWRkcmVzcyBwdWJsaWMgd2FsbGV0OwogIC8vIGFkZHJlc3Mgd2hlcmUgZnVuZHMgd2lsbCBiZSBmcm96ZW4KICBIb2xkUHJlc2FsZUNvbnRyYWN0IHB1YmxpYyBob2xkQ29udHJhY3Q7CiAgT3Bwb3J0eVByZXNhbGUgcHJpdmF0ZSBwcmVzYWxlOwogIE9wcG9ydHlTYWxlQm9udXMgcHJpdmF0ZSBib251czsKCiAgLy9taW5pbXVtIG9mIHRva2VucyB0aGF0IG11c3QgYmUgb24gdGhlIGNvbnRyYWN0IGZvciB0aGUgc3RhcnQKICB1aW50IHByaXZhdGUgbWluaW11bVRva2Vuc1RvU3RhcnQgPSAxNTAwMDAwMDAgKiAoMTAgKiogMTgpOwoKICBzdHJ1Y3QgQ29udHJpYnV0b3JEYXRhIHsKICAgIGJvb2wgaXNBY3RpdmU7CiAgICB1aW50IGNvbnRyaWJ1dGlvbkFtb3VudDsvLyB0b3RhbCBFVEgKICAgIHVpbnQgdG9rZW5zSXNzdWVkOy8vIHRvdGFsIHRva2VuCiAgICB1aW50IGJvbnVzQW1vdW50Oy8vIHRvdGFsIGJvbnVzIHRva2VuCiAgfQoKICBlbnVtIFNhbGVTdGF0ZSAgeyBORVcsIFNBTEUsIEVOREVEIH0KICBTYWxlU3RhdGUgcHJpdmF0ZSBzdGF0ZTsKCiAgbWFwcGluZyhhZGRyZXNzID0+IENvbnRyaWJ1dG9yRGF0YSkgcHVibGljIGNvbnRyaWJ1dG9yTGlzdDsKICB1aW50IHByaXZhdGUgbmV4dENvbnRyaWJ1dG9ySW5kZXg7CiAgdWludCBwcml2YXRlIG5leHRDb250cmlidXRvclRvQ2xhaW07CiAgdWludCBwcml2YXRlIG5leHRDb250cmlidXRvclRvVHJhbnNmZXJUb2tlbnM7CgogIG1hcHBpbmcodWludCA9PiBhZGRyZXNzKSBwcml2YXRlIGNvbnRyaWJ1dG9ySW5kZXhlczsKICBtYXBwaW5nKGFkZHJlc3MgPT4gYm9vbCkgcHJpdmF0ZSBoYXNDbGFpbWVkRXRoV2hlbkZhaWw7IC8vYWRkcmVzcyB3aG8gZ290IGEgcmVmdW5kCiAgbWFwcGluZyhhZGRyZXNzID0+IGJvb2wpIHByaXZhdGUgaGFzV2l0aGRyYXdlZFRva2VuczsgLy9hZGRyZXNzIHdobyBnb3QgYSB0b2tlbnMKCiAgLyogRXZlbnRzICovCiAgZXZlbnQgQ3Jvd2RzYWxlU3RhcnRlZCh1aW50IGJsb2NrTnVtYmVyKTsKICBldmVudCBDcm93ZHNhbGVFbmRlZCh1aW50IGJsb2NrTnVtYmVyKTsKICBldmVudCBTb2Z0Q2FwUmVhY2hlZCh1aW50IGJsb2NrTnVtYmVyKTsKICBldmVudCBIYXJkQ2FwUmVhY2hlZCh1aW50IGJsb2NrTnVtYmVyKTsKICBldmVudCBGdW5kVHJhbnNmZXJlZChhZGRyZXNzIGNvbnRyaWIsIHVpbnQgYW1vdW50KTsKICBldmVudCBUb2tlbnNUcmFuc2ZlcmVkKGFkZHJlc3MgY29udHJpYnV0b3IgLCB1aW50IGFtb3VudCk7CiAgZXZlbnQgUmVmdW5kZWQoYWRkcmVzcyByZWYsIHVpbnQgYW1vdW50KTsKICBldmVudCBFcnJvclNlbmRpbmdFVEgoYWRkcmVzcyB0bywgdWludCBhbW91bnQpOwogIGV2ZW50IFdpdGhkcmF3ZWRFdGhUb1dhbGxldCh1aW50IGFtb3VudCk7CiAgZXZlbnQgTWFudWFsQ2hhbmdlU3RhcnREYXRlKHVpbnQgYmVmb3JlRGF0ZSwgdWludCBhZnRlckRhdGUpOwogIGV2ZW50IE1hbnVhbENoYW5nZUVuZERhdGUodWludCBiZWZvcmVEYXRlLCB1aW50IGFmdGVyRGF0ZSk7CiAgZXZlbnQgVG9rZW5zVHJhbnNmZXJlZFRvSG9sZChhZGRyZXNzIGhvbGQsIHVpbnQgYW1vdW50KTsKICBldmVudCBUb2tlbnNUcmFuc2ZlcmVkVG9Pd25lcihhZGRyZXNzIGhvbGQsIHVpbnQgYW1vdW50KTsKCiAgZnVuY3Rpb24gT3Bwb3J0eVNhbGUoCiAgICBhZGRyZXNzIHRva2VuQWRkcmVzcywKICAgIGFkZHJlc3Mgd2FsbGV0QWRkcmVzcywKICAgIHVpbnQgc3RhcnQsCiAgICB1aW50IGVuZCwKICAgIGFkZHJlc3MgaG9sZENvbnQsCiAgICBhZGRyZXNzIHByZXNhbGVDb250ICkKICB7CiAgICB0b2tlbiA9IE9wcG9ydHlUb2tlbih0b2tlbkFkZHJlc3MpOwogICAgc3RhdGUgPSBTYWxlU3RhdGUuTkVXOwogICAgU09GVENBUCAgID0gMTAwMCAqIDEgZXRoZXI7CiAgICBIQVJEQ0FQICAgPSA1MDAwMCAqIDEgZXRoZXI7CiAgICBwcmljZSAgICAgPSAwLjAwMDIgKiAxIGV0aGVyOwogICAgc3RhcnREYXRlID0gc3RhcnQ7CiAgICBlbmREYXRlICAgPSBlbmQ7CiAgICBtaW5pbWFsQ29udHJpYnV0aW9uID0gMC4zICogMSBldGhlcjsKICAgIHJlbGVhc2VkVG9rZW5zID0gZmFsc2U7CgogICAgd2FsbGV0ID0gd2FsbGV0QWRkcmVzczsKICAgIGhvbGRDb250cmFjdCA9IEhvbGRQcmVzYWxlQ29udHJhY3QoaG9sZENvbnQpOwogICAgcHJlc2FsZSA9IE9wcG9ydHlQcmVzYWxlKHByZXNhbGVDb250KTsKICAgIGJvbnVzICAgPSBuZXcgT3Bwb3J0eVNhbGVCb251cyhzdGFydCk7CiAgfQoKICAvKiBTZXR0ZXJzICovCgogIGZ1bmN0aW9uIHNldFN0YXJ0RGF0ZSh1aW50IGRhdGUpIG9ubHlPd25lciB7CiAgICByZXF1aXJlKHN0YXRlID09IFNhbGVTdGF0ZS5ORVcpOwogICAgcmVxdWlyZShkYXRlIDwgZW5kRGF0ZSk7CiAgICB1aW50IG9sZFN0YXJ0RGF0ZSA9IHN0YXJ0RGF0ZTsKICAgIHN0YXJ0RGF0ZSA9IGRhdGU7CiAgICBib251cy5jaGFuZ2VTdGFydERhdGUoZGF0ZSk7CiAgICBNYW51YWxDaGFuZ2VTdGFydERhdGUob2xkU3RhcnREYXRlLCBkYXRlKTsKICB9CiAgZnVuY3Rpb24gc2V0RW5kRGF0ZSh1aW50IGRhdGUpIG9ubHlPd25lciB7CiAgICByZXF1aXJlKHN0YXRlID09IFNhbGVTdGF0ZS5ORVcgfHwgc3RhdGUgPT0gU2FsZVN0YXRlLlNBTEUpOwogICAgcmVxdWlyZShkYXRlID4gbm93ICYmIGRhdGUgPiBzdGFydERhdGUpOwogICAgdWludCBvbGRFbmREYXRlID0gZW5kRGF0ZTsKICAgIGVuZERhdGUgPSBkYXRlOwogICAgTWFudWFsQ2hhbmdlRW5kRGF0ZShvbGRFbmREYXRlLCBkYXRlKTsKICB9CiAgZnVuY3Rpb24gc2V0U29mdENhcCh1aW50IHNvZnRDYXApIG9ubHlPd25lciB7CiAgICByZXF1aXJlKHN0YXRlID09IFNhbGVTdGF0ZS5ORVcpOwogICAgU09GVENBUCA9IHNvZnRDYXA7CiAgfQogIGZ1bmN0aW9uIHNldEhhcmRDYXAodWludCBoYXJkQ2FwKSBvbmx5T3duZXIgewogICAgcmVxdWlyZShzdGF0ZSA9PSBTYWxlU3RhdGUuTkVXKTsKICAgIEhBUkRDQVAgPSBoYXJkQ2FwOwogIH0KCiAgLyogVGhlIGZ1bmN0aW9uIHdpdGhvdXQgbmFtZSBpcyB0aGUgZGVmYXVsdCBmdW5jdGlvbiB0aGF0IGlzIGNhbGxlZCB3aGVuZXZlciBhbnlvbmUgc2VuZHMgZnVuZHMgdG8gYSBjb250cmFjdCAqLwogIGZ1bmN0aW9uKCkgd2hlbk5vdFBhdXNlZCBwdWJsaWMgcGF5YWJsZSB7CiAgICByZXF1aXJlKG1zZy52YWx1ZSAhPSAwKTsKCiAgICBpZiAoc3RhdGUgPT0gU2FsZVN0YXRlLkVOREVEKSB7CiAgICAgIHJldmVydCgpOwogICAgfQoKICAgIGJvb2wgY2hzdGF0ZSA9IGNoZWNrQ3Jvd2RzYWxlU3RhdGUoKTsKCiAgICBpZiAoc3RhdGUgPT0gU2FsZVN0YXRlLlNBTEUpIHsKICAgICAgcHJvY2Vzc1RyYW5zYWN0aW9uKG1zZy5zZW5kZXIsIG1zZy52YWx1ZSk7CiAgICB9CiAgICBlbHNlIHsKICAgICAgcmVmdW5kVHJhbnNhY3Rpb24oY2hzdGF0ZSk7CiAgICB9CiAgfQoKICAvKioKICAgKiBAZGV2IENoZWNrcyBpZiB0aGUgZ29hbCBvciB0aW1lIGxpbWl0IGhhcyBiZWVuIHJlYWNoZWQgYW5kIGVuZHMgdGhlIGNhbXBhaWduCiAgICogQHJldHVybiBmYWxzZSB3aGVuIGNvbnRyYWN0IGRvZXMgbm90IGFjY2VwdCB0b2tlbnMKICAgKi8KICBmdW5jdGlvbiBjaGVja0Nyb3dkc2FsZVN0YXRlKCkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCl7CiAgICBpZiAoZ2V0RXRoUmFpc2VkKCkgPj0gSEFSRENBUCAmJiBzdGF0ZSAhPSBTYWxlU3RhdGUuRU5ERUQpIHsKICAgICAgc3RhdGUgPSBTYWxlU3RhdGUuRU5ERUQ7CiAgICAgIEhhcmRDYXBSZWFjaGVkKGJsb2NrLm51bWJlcik7IC8vIENsb3NlIHRoZSBjcm93ZHNhbGUKICAgICAgQ3Jvd2RzYWxlRW5kZWQoYmxvY2subnVtYmVyKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgaWYobm93ID4gc3RhcnREYXRlICYmIG5vdyA8PSBlbmREYXRlKSB7CiAgICAgIGlmIChzdGF0ZSA9PSBTYWxlU3RhdGUuU0FMRSAmJiBjaGVja0JhbGFuY2VDb250cmFjdCgpID49IG1pbmltdW1Ub2tlbnNUb1N0YXJ0ICkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBpZiAoc3RhdGUgIT0gU2FsZVN0YXRlLkVOREVEICYmIG5vdyA+IGVuZERhdGUpIHsKICAgICAgICBzdGF0ZSA9IFNhbGVTdGF0ZS5FTkRFRDsKICAgICAgICBDcm93ZHNhbGVFbmRlZChibG9jay5udW1iZXIpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICAvKioKICAgKiBAZGV2IFRva2VuIHB1cmNoYXNlCiAgICovCiAgZnVuY3Rpb24gcHJvY2Vzc1RyYW5zYWN0aW9uKGFkZHJlc3MgX2NvbnRyaWJ1dG9yLCB1aW50IF9hbW91bnQpIGludGVybmFsIHsKCiAgICByZXF1aXJlKG1zZy52YWx1ZSA+PSBtaW5pbWFsQ29udHJpYnV0aW9uKTsKCiAgICB1aW50IG1heENvbnRyaWJ1dGlvbiA9IGNhbGN1bGF0ZU1heENvbnRyaWJ1dGlvbigpOwogICAgdWludCBjb250cmlidXRpb25BbW91bnQgPSBfYW1vdW50OwogICAgdWludCByZXR1cm5BbW91bnQgPSAwOwoKICAgIGlmIChtYXhDb250cmlidXRpb24gPCBfYW1vdW50KSB7CiAgICAgIGNvbnRyaWJ1dGlvbkFtb3VudCA9IG1heENvbnRyaWJ1dGlvbjsKICAgICAgcmV0dXJuQW1vdW50ID0gX2Ftb3VudCAtIG1heENvbnRyaWJ1dGlvbjsKICAgIH0KICAgIHVpbnQgZXRocmFpID0gZ2V0RXRoUmFpc2VkKCkgOwogICAgaWYgKGV0aHJhaSArIGNvbnRyaWJ1dGlvbkFtb3VudCA+PSBTT0ZUQ0FQICYmIFNPRlRDQVAgPiBldGhyYWkpIHsKICAgICAgU29mdENhcFJlYWNoZWQoYmxvY2subnVtYmVyKTsKICAgIH0KCiAgICBpZiAoY29udHJpYnV0b3JMaXN0W19jb250cmlidXRvcl0uaXNBY3RpdmUgPT0gZmFsc2UpIHsKICAgICAgY29udHJpYnV0b3JMaXN0W19jb250cmlidXRvcl0uaXNBY3RpdmUgPSB0cnVlOwogICAgICBjb250cmlidXRvckxpc3RbX2NvbnRyaWJ1dG9yXS5jb250cmlidXRpb25BbW91bnQgPSBjb250cmlidXRpb25BbW91bnQ7CiAgICAgIGNvbnRyaWJ1dG9ySW5kZXhlc1tuZXh0Q29udHJpYnV0b3JJbmRleF0gPSBfY29udHJpYnV0b3I7CiAgICAgIG5leHRDb250cmlidXRvckluZGV4Kys7CiAgICB9IGVsc2UgewogICAgICBjb250cmlidXRvckxpc3RbX2NvbnRyaWJ1dG9yXS5jb250cmlidXRpb25BbW91bnQgKz0gY29udHJpYnV0aW9uQW1vdW50OwogICAgfQoKICAgIGV0aFJhaXNlZCArPSBjb250cmlidXRpb25BbW91bnQ7CgogICAgRnVuZFRyYW5zZmVyZWQoX2NvbnRyaWJ1dG9yLCBjb250cmlidXRpb25BbW91bnQpOwoKICAgIHVpbnQgdG9rZW5BbW91bnQgID0gY29udHJpYnV0aW9uQW1vdW50LmRpdihwcmljZSk7CiAgICB1aW50IHRpbWVCb251cyAgICA9IGJvbnVzLmNhbGN1bGF0ZUJvbnVzRm9ySG91cnModG9rZW5BbW91bnQpOwoKICAgIGlmICh0b2tlbkFtb3VudCA+IDApIHsKICAgICAgY29udHJpYnV0b3JMaXN0W19jb250cmlidXRvcl0udG9rZW5zSXNzdWVkICs9IHRva2VuQW1vdW50LmFkZCh0aW1lQm9udXMpOwogICAgICBjb250cmlidXRvckxpc3RbX2NvbnRyaWJ1dG9yXS5ib251c0Ftb3VudCArPSB0aW1lQm9udXM7CiAgICAgIHRvdGFsVG9rZW5zICs9IHRva2VuQW1vdW50LmFkZCh0aW1lQm9udXMpOwogICAgfQoKICAgIGlmIChyZXR1cm5BbW91bnQgIT0gMCkgewogICAgICBfY29udHJpYnV0b3IudHJhbnNmZXIocmV0dXJuQW1vdW50KTsKICAgIH0KICB9CgogIC8qKgogICAqIEBkZXYgSXQgaXMgbmVjZXNzYXJ5IGZvciBhIGNvcnJlY3QgY2hhbmdlIG9mIHN0YXR1cyBpbiB0aGUgZXZlbnQgb2YgY29tcGxldGlvbiBvZiB0aGUgY2FtcGFpZ24uCiAgICogQHBhcmFtIF9zdGF0ZUNoYW5nZWQgaWYgdHJ1ZSB0cmFuc2ZlciBFVEggYmFjawogICAqLwogIGZ1bmN0aW9uIHJlZnVuZFRyYW5zYWN0aW9uKGJvb2wgX3N0YXRlQ2hhbmdlZCkgaW50ZXJuYWwgewogICAgaWYgKF9zdGF0ZUNoYW5nZWQpIHsKICAgICAgbXNnLnNlbmRlci50cmFuc2Zlcihtc2cudmFsdWUpOwogICAgfSBlbHNlewogICAgICByZXZlcnQoKTsKICAgIH0KICB9CgogIC8qKgogICAqIEBkZXYgdHJhbnNmZXIgcmVtYWlucyB0b2tlbnMgYWZ0ZXIgdGhlIGNvbXBsZXRpb24gb2YgY3Jvd2RzYWxlCiAgICovCiAgZnVuY3Rpb24gcmVsZWFzZVRva2VucygpIG9ubHlPd25lciB7CiAgICByZXF1aXJlIChzdGF0ZSA9PSBTYWxlU3RhdGUuRU5ERUQpOwoKICAgIHVpbnQgY2JhbGFuY2UgPSBjaGVja0JhbGFuY2VDb250cmFjdCgpOwoKICAgIHJlcXVpcmUgKGNiYWxhbmNlICE9IDApOwogICAgcmVxdWlyZSAod2l0aGRyYXdlZFRva2VucyA+PSB0b3RhbFRva2VucyB8fCBnZXRFdGhSYWlzZWQoKSA8IFNPRlRDQVApOwoKICAgIGlmIChnZXRFdGhSYWlzZWQoKSA+PSBTT0ZUQ0FQKSB7CiAgICAgIGlmIChyZWxlYXNlZFRva2VucyA9PSB0cnVlKSB7CiAgICAgICAgaWYgKHRva2VuLnRyYW5zZmVyKG1zZy5zZW5kZXIsIGNiYWxhbmNlICkgKSB7CiAgICAgICAgICBUb2tlbnNUcmFuc2ZlcmVkVG9Pd25lcihtc2cuc2VuZGVyICwgY2JhbGFuY2UgKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHRva2VuLnRyYW5zZmVyKGhvbGRDb250cmFjdCwgY2JhbGFuY2UgKSApIHsKICAgICAgICAgIGhvbGRDb250cmFjdC5hZGRIb2xkZXIobXNnLnNlbmRlciwgY2JhbGFuY2UsIDEsIGVuZERhdGUuYWRkKDE4MiBkYXlzKSApOwogICAgICAgICAgcmVsZWFzZWRUb2tlbnMgPSB0cnVlOwogICAgICAgICAgVG9rZW5zVHJhbnNmZXJlZFRvSG9sZChob2xkQ29udHJhY3QgLCBjYmFsYW5jZSApOwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgaWYgKHRva2VuLnRyYW5zZmVyKG1zZy5zZW5kZXIsIGNiYWxhbmNlKSApIHsKICAgICAgICBUb2tlbnNUcmFuc2ZlcmVkVG9Pd25lcihtc2cuc2VuZGVyICwgY2JhbGFuY2UgKTsKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gY2hlY2tCYWxhbmNlQ29udHJhY3QoKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gdG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogIH0KCiAgLyoqCiAgICogQGRldiBpZiBjcm93ZHNhbGUgaXMgc3VjY2Vzc2Z1bCwgaW52ZXN0b3JzIGNhbiBjbGFpbSB0b2tlbiBoZXJlCiAgICovCiAgZnVuY3Rpb24gZ2V0VG9rZW5zKCkgd2hlbk5vdFBhdXNlZCB7CiAgICB1aW50IGVyID0gIGdldEV0aFJhaXNlZCgpOwogICAgcmVxdWlyZSgobm93ID4gZW5kRGF0ZSAmJiBlciA+PSBTT0ZUQ0FQICkgIHx8ICggZXIgPj0gSEFSRENBUCkgICk7CiAgICByZXF1aXJlKHN0YXRlID09IFNhbGVTdGF0ZS5FTkRFRCk7CiAgICByZXF1aXJlKGNvbnRyaWJ1dG9yTGlzdFttc2cuc2VuZGVyXS50b2tlbnNJc3N1ZWQgPiAwKTsKICAgIHJlcXVpcmUoIWhhc1dpdGhkcmF3ZWRUb2tlbnNbbXNnLnNlbmRlcl0pOwoKICAgIHVpbnQgdG9rZW5Db3VudCA9IGNvbnRyaWJ1dG9yTGlzdFttc2cuc2VuZGVyXS50b2tlbnNJc3N1ZWQ7CgogICAgaWYgKHRva2VuLnRyYW5zZmVyKG1zZy5zZW5kZXIsIHRva2VuQ291bnQgKiAoMTAgKiogMTgpICkpIHsKICAgICAgVG9rZW5zVHJhbnNmZXJlZChtc2cuc2VuZGVyICwgdG9rZW5Db3VudCAqICgxMCAqKiAxOCkgKTsKICAgICAgd2l0aGRyYXdlZFRva2VucyArPSB0b2tlbkNvdW50OwogICAgICBoYXNXaXRoZHJhd2VkVG9rZW5zW21zZy5zZW5kZXJdID0gdHJ1ZTsKICAgIH0KCiAgfQogIGZ1bmN0aW9uIGJhdGNoUmV0dXJuVG9rZW5zKHVpbnQgX251bWJlck9mUmV0dXJucykgb25seU93bmVyIHdoZW5Ob3RQYXVzZWQgewogICAgdWludCBlciA9IGdldEV0aFJhaXNlZCgpOwogICAgcmVxdWlyZSgobm93ID4gZW5kRGF0ZSAmJiBlciA+PSBTT0ZUQ0FQICkgIHx8IChlciA+PSBIQVJEQ0FQKSAgKTsKICAgIHJlcXVpcmUoc3RhdGUgPT0gU2FsZVN0YXRlLkVOREVEKTsKCiAgICBhZGRyZXNzIGN1cnJlbnRQYXJ0aWNpcGFudEFkZHJlc3M7CiAgICB1aW50IHRva2Vuc0NvdW50OwoKICAgIGZvciAodWludCBjbnQgPSAwOyBjbnQgPCBfbnVtYmVyT2ZSZXR1cm5zOyBjbnQrKykgewogICAgICBjdXJyZW50UGFydGljaXBhbnRBZGRyZXNzID0gY29udHJpYnV0b3JJbmRleGVzW25leHRDb250cmlidXRvclRvVHJhbnNmZXJUb2tlbnNdOwogICAgICBpZiAoY3VycmVudFBhcnRpY2lwYW50QWRkcmVzcyA9PSAweDApIHJldHVybjsKICAgICAgaWYgKCFoYXNXaXRoZHJhd2VkVG9rZW5zW2N1cnJlbnRQYXJ0aWNpcGFudEFkZHJlc3NdKSB7CiAgICAgICAgdG9rZW5zQ291bnQgPSBjb250cmlidXRvckxpc3RbY3VycmVudFBhcnRpY2lwYW50QWRkcmVzc10udG9rZW5zSXNzdWVkOwogICAgICAgIGhhc1dpdGhkcmF3ZWRUb2tlbnNbY3VycmVudFBhcnRpY2lwYW50QWRkcmVzc10gPSB0cnVlOwogICAgICAgIGlmICh0b2tlbi50cmFuc2ZlcihjdXJyZW50UGFydGljaXBhbnRBZGRyZXNzLCB0b2tlbnNDb3VudCAqICgxMCAqKiAxOCkpKSB7CiAgICAgICAgICBUb2tlbnNUcmFuc2ZlcmVkKGN1cnJlbnRQYXJ0aWNpcGFudEFkZHJlc3MsIHRva2Vuc0NvdW50ICogKDEwICoqIDE4KSk7CiAgICAgICAgICB3aXRoZHJhd2VkVG9rZW5zICs9IHRva2Vuc0NvdW50OwogICAgICAgICAgaGFzV2l0aGRyYXdlZFRva2Vuc1ttc2cuc2VuZGVyXSA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIG5leHRDb250cmlidXRvclRvVHJhbnNmZXJUb2tlbnMgKz0gMTsKICAgIH0KCiAgfQoKICAvKioKICAgKiBAZGV2IGlmIGNyb3dkc2FsZSBpcyB1bnN1Y2Nlc3NmdWwsIGludmVzdG9ycyBjYW4gY2xhaW0gcmVmdW5kcyBoZXJlCiAgICovCiAgZnVuY3Rpb24gcmVmdW5kKCkgd2hlbk5vdFBhdXNlZCB7CiAgICByZXF1aXJlKG5vdyA+IGVuZERhdGUgJiYgZ2V0RXRoUmFpc2VkKCkgPCBTT0ZUQ0FQKTsKICAgIHJlcXVpcmUoY29udHJpYnV0b3JMaXN0W21zZy5zZW5kZXJdLmNvbnRyaWJ1dGlvbkFtb3VudCA+IDApOwogICAgcmVxdWlyZSghaGFzQ2xhaW1lZEV0aFdoZW5GYWlsW21zZy5zZW5kZXJdKTsKCiAgICB1aW50IGV0aENvbnRyaWJ1dGVkID0gY29udHJpYnV0b3JMaXN0W21zZy5zZW5kZXJdLmNvbnRyaWJ1dGlvbkFtb3VudDsKICAgIGhhc0NsYWltZWRFdGhXaGVuRmFpbFttc2cuc2VuZGVyXSA9IHRydWU7CiAgICBpZiAoIW1zZy5zZW5kZXIuc2VuZChldGhDb250cmlidXRlZCkpIHsKICAgICAgRXJyb3JTZW5kaW5nRVRIKG1zZy5zZW5kZXIsIGV0aENvbnRyaWJ1dGVkKTsKICAgIH0gZWxzZSB7CiAgICAgIFJlZnVuZGVkKG1zZy5zZW5kZXIsIGV0aENvbnRyaWJ1dGVkKTsKICAgIH0KICB9CiAgZnVuY3Rpb24gYmF0Y2hSZXR1cm5FdGhJZkZhaWxlZCh1aW50IF9udW1iZXJPZlJldHVybnMpIG9ubHlPd25lciB3aGVuTm90UGF1c2VkIHsKICAgIHJlcXVpcmUobm93ID4gZW5kRGF0ZSAmJiBnZXRFdGhSYWlzZWQoKSA8IFNPRlRDQVApOwogICAgYWRkcmVzcyBjdXJyZW50UGFydGljaXBhbnRBZGRyZXNzOwogICAgdWludCBjb250cmlidXRpb247CiAgICBmb3IgKHVpbnQgY250ID0gMDsgY250IDwgX251bWJlck9mUmV0dXJuczsgY250KyspIHsKICAgICAgY3VycmVudFBhcnRpY2lwYW50QWRkcmVzcyA9IGNvbnRyaWJ1dG9ySW5kZXhlc1tuZXh0Q29udHJpYnV0b3JUb0NsYWltXTsKICAgICAgaWYgKGN1cnJlbnRQYXJ0aWNpcGFudEFkZHJlc3MgPT0gMHgwKSByZXR1cm47CiAgICAgIGlmICghaGFzQ2xhaW1lZEV0aFdoZW5GYWlsW2N1cnJlbnRQYXJ0aWNpcGFudEFkZHJlc3NdKSB7CiAgICAgICAgY29udHJpYnV0aW9uID0gY29udHJpYnV0b3JMaXN0W2N1cnJlbnRQYXJ0aWNpcGFudEFkZHJlc3NdLmNvbnRyaWJ1dGlvbkFtb3VudDsKICAgICAgICBoYXNDbGFpbWVkRXRoV2hlbkZhaWxbY3VycmVudFBhcnRpY2lwYW50QWRkcmVzc10gPSB0cnVlOwoKICAgICAgICBpZiAoIWN1cnJlbnRQYXJ0aWNpcGFudEFkZHJlc3Muc2VuZChjb250cmlidXRpb24pKXsKICAgICAgICAgIEVycm9yU2VuZGluZ0VUSChjdXJyZW50UGFydGljaXBhbnRBZGRyZXNzLCBjb250cmlidXRpb24pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBSZWZ1bmRlZChjdXJyZW50UGFydGljaXBhbnRBZGRyZXNzLCBjb250cmlidXRpb24pOwogICAgICAgIH0KICAgICAgfQogICAgICBuZXh0Q29udHJpYnV0b3JUb0NsYWltICs9IDE7CiAgICB9CiAgfQoKICAvKioKICAgKiBAZGV2IHRyYW5zZmVyIGZ1bmRzIEVUSCB0byBtdWx0aXNpZyB3YWxsZXQgaWYgcmVhY2hlZCBtaW5pbXVtIGdvYWwKICAgKi8KICBmdW5jdGlvbiB3aXRoZHJhd0V0aCgpIHsKICAgIHJlcXVpcmUodGhpcy5iYWxhbmNlICE9IDApOwogICAgcmVxdWlyZShnZXRFdGhSYWlzZWQoKSA+PSBTT0ZUQ0FQKTsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSB3YWxsZXQpOwogICAgdWludCBiYWwgPSB0aGlzLmJhbGFuY2U7CiAgICB3YWxsZXQudHJhbnNmZXIoYmFsKTsKICAgIFdpdGhkcmF3ZWRFdGhUb1dhbGxldChiYWwpOwogIH0KCiAgZnVuY3Rpb24gd2l0aGRyYXdSZW1haW5pbmdCYWxhbmNlRm9yTWFudWFsUmVjb3ZlcnkoKSBvbmx5T3duZXIgewogICAgcmVxdWlyZSh0aGlzLmJhbGFuY2UgIT0gMCk7CiAgICByZXF1aXJlKG5vdyA+IGVuZERhdGUpOwogICAgcmVxdWlyZShjb250cmlidXRvckluZGV4ZXNbbmV4dENvbnRyaWJ1dG9yVG9DbGFpbV0gPT0gMHgwKTsKICAgIG1zZy5zZW5kZXIudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKICB9CgogIC8qKgogICAqIEBkZXYgTWFudWFsIHN0YXJ0IGNyb3dkc2FsZS4KICAgKi8KICBmdW5jdGlvbiBzdGFydENyb3dkc2FsZSgpIG9ubHlPd25lciAgewogICAgcmVxdWlyZShub3cgPiBzdGFydERhdGUgJiYgbm93IDw9IGVuZERhdGUpOwogICAgcmVxdWlyZShzdGF0ZSA9PSBTYWxlU3RhdGUuTkVXKTsKICAgIHJlcXVpcmUoY2hlY2tCYWxhbmNlQ29udHJhY3QoKSA+PSBtaW5pbXVtVG9rZW5zVG9TdGFydCk7CgogICAgc3RhdGUgPSBTYWxlU3RhdGUuU0FMRTsKICAgIENyb3dkc2FsZVN0YXJ0ZWQoYmxvY2subnVtYmVyKTsKICB9CgogIC8qIEdldHRlcnMgKi8KCiAgZnVuY3Rpb24gZ2V0QWNjb3VudHNOdW1iZXIoKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gbmV4dENvbnRyaWJ1dG9ySW5kZXg7CiAgfQoKICBmdW5jdGlvbiBnZXRFdGhSYWlzZWQoKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IHByZSA9IHByZXNhbGUuZ2V0RXRoUmFpc2VkKCk7CiAgICByZXR1cm4gcHJlICsgZXRoUmFpc2VkOwogIH0KCiAgZnVuY3Rpb24gZ2V0VG9rZW5zVG90YWwoKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gdG90YWxUb2tlbnM7CiAgfQoKICBmdW5jdGlvbiBnZXRXaXRoZHJhd2VkVG9rZW4oKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gd2l0aGRyYXdlZFRva2VuczsKICB9CgogIGZ1bmN0aW9uIGNhbGN1bGF0ZU1heENvbnRyaWJ1dGlvbigpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiBIQVJEQ0FQIC0gZ2V0RXRoUmFpc2VkKCk7CiAgfQoKICBmdW5jdGlvbiBnZXRTb2Z0Q2FwKCkgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7CiAgICByZXR1cm4gU09GVENBUDsKICB9CgogIGZ1bmN0aW9uIGdldEhhcmRDYXAoKSBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsKICAgIHJldHVybiBIQVJEQ0FQOwogIH0KCiAgZnVuY3Rpb24gZ2V0U2FsZVN0YXR1cygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiB1aW50KHN0YXRlKTsKICB9CgogIGZ1bmN0aW9uIGdldFN0YXJ0RGF0ZSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiBzdGFydERhdGU7CiAgfQoKICBmdW5jdGlvbiBnZXRFbmREYXRlKCkgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIGVuZERhdGU7CiAgfQoKICAvLyBAcmV0dXJuIHRydWUgaWYgY3Jvd2RzYWxlIGV2ZW50IGhhcyBlbmRlZAogIGZ1bmN0aW9uIGhhc0VuZGVkKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBub3cgPiBlbmREYXRlIHx8IHN0YXRlID09IFNhbGVTdGF0ZS5FTkRFRDsKICB9CgogIGZ1bmN0aW9uIGdldFRva2VuQmFsYW5jZSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiB0b2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgfQoKICAvKioKICAgKiBAZGV2IHJldHVybiBjdXJyZW50IGJvbnVzIHBlcmNlbnQKICAgKi8KICBmdW5jdGlvbiBnZXRDdXJyZW50Qm9udXMoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgaWYobm93ID4gZW5kRGF0ZSB8fCBzdGF0ZSA9PSBTYWxlU3RhdGUuRU5ERUQpIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICByZXR1cm4gYm9udXMuZ2V0Qm9udXMoKTsKICB9Cn0='.
	

]
