Class {
	#name : #SRTf12ead6b76562f4a76d5c10802a73465e43a30b1,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTf12ead6b76562f4a76d5c10802a73465e43a30b1 >> base64 [
	^ 'LyoKCiAgQ29weXJpZ2h0IDIwMTcgTG9vcHJpbmcgUHJvamVjdCBMdGQgKExvb3ByaW5nIEZvdW5kYXRpb24pLgoKICBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgogIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoKICBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKICBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgoqLwpwcmFnbWEgc29saWRpdHkgXjAuNC4xNTsKCi8qKgogKiBAdGl0bGUgU2FmZU1hdGgKICogQGRldiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzIHRoYXQgdGhyb3cgb24gZXJyb3IKICovCmxpYnJhcnkgU2FmZU1hdGggewogIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSAqIGI7CiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQp9CgovKioKICogQHRpdGxlIE1hdGgKICogQGRldiBBc3NvcnRlZCBtYXRoIG9wZXJhdGlvbnMKICovCgpsaWJyYXJ5IE1hdGggewogIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtaW42NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtYXgyNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQp9CgovKioKICogQHRpdGxlIEVSQzIwQmFzaWMKICogQGRldiBTaW1wbGVyIHZlcnNpb24gb2YgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8xNzkKICovCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KCi8qKgogKiBAdGl0bGUgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcmV0dXJucyAoYm9vbCk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwp9CgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciB7CiAgICBpZiAobmV3T3duZXIgIT0gYWRkcmVzcygwKSkgewogICAgICBvd25lciA9IG5ld093bmVyOwogICAgfQogIH0KCn0KCi8vLyBAdGl0bGUgVWludFV0aWwKLy8vIEBhdXRob3IgRGFuaWVsIFdhbmcgLSA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjlkZjlmY2YzZjRmOGYxZGRmMWYyZjJlZGVmZjRmM2ZhYjNmMmVmZmEiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+PgovLy8gQGRldiB1aW50IHV0aWxpdHkgZnVuY3Rpb25zCmxpYnJhcnkgVWludExpYiB7CiAgICB1c2luZyBTYWZlTWF0aCAgZm9yIHVpbnQ7CgogICAgZnVuY3Rpb24gdG9sZXJhbnRTdWIodWludCB4LCB1aW50IHkpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgeikgewogICAgICAgIGlmICh4ID49IHkpIHogPSB4IC0geTsKICAgICAgICBlbHNlIHogPSAwOwogICAgfQoKICAgIGZ1bmN0aW9uIG5leHQodWludCBpLCB1aW50IHNpemUpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gKGkgKyAxKSAlIHNpemU7CiAgICB9CgogICAgZnVuY3Rpb24gcHJldih1aW50IGksIHVpbnQgc2l6ZSkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiAoaSArIHNpemUgLSAxKSAlIHNpemU7CiAgICB9CgogICAgLy8vIEBkZXYgY2FsY3VsYXRlIHRoZSBzcXVhcmUgb2YgQ29lZmZpY2llbnQgb2YgVmFyaWF0aW9uIChDVikKICAgIC8vLyBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Db2VmZmljaWVudF9vZl92YXJpYXRpb24KICAgIGZ1bmN0aW9uIGN2c3F1YXJlKAogICAgICAgIHVpbnRbXSBhcnIsCiAgICAgICAgdWludCBzY2FsZQogICAgICAgICkKICAgICAgICBpbnRlcm5hbAogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCkgewoKICAgICAgICB1aW50IGxlbiA9IGFyci5sZW5ndGg7CiAgICAgICAgcmVxdWlyZShsZW4gPiAxKTsKICAgICAgICByZXF1aXJlKHNjYWxlID4gMCk7CgogICAgICAgIHVpbnQgYXZnID0gMDsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICBhdmcgKz0gYXJyW2ldOwogICAgICAgIH0KCiAgICAgICAgYXZnID0gYXZnLmRpdihsZW4pOwoKICAgICAgICBpZiAoYXZnID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICB1aW50IGN2cyA9IDA7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgIHVpbnQgc3ViID0gMDsKICAgICAgICAgICAgaWYgKGFycltpXSA+IGF2ZykgewogICAgICAgICAgICAgICAgc3ViID0gYXJyW2ldIC0gYXZnOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc3ViID0gYXZnIC0gYXJyW2ldOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGN2cyArPSBzdWIubXVsKHN1Yik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBjdnMKICAgICAgICAgICAgLm11bChzY2FsZSkKICAgICAgICAgICAgLmRpdihhdmcpCiAgICAgICAgICAgIC5tdWwoc2NhbGUpCiAgICAgICAgICAgIC5kaXYoYXZnKQogICAgICAgICAgICAuZGl2KGxlbiAtIDEpOwogICAgfQp9CgovLy8gQHRpdGxlIFRva2VuIFJlZ2lzdGVyIENvbnRyYWN0Ci8vLyBAYXV0aG9yIEtvbmdsaWFuZyBaaG9uZyAtIDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iMTU3ZTdhN2I3Mjc5N2M3NDdiNzI1NTc5N2E3YTY1Njc3YzdiNzIzYjdhNjc3MiI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+LAovLy8gQGF1dGhvciBEYW5pZWwgV2FuZyAtIDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iMDc2MzY2Njk2ZTYyNmI0NzZiNjg2ODc3NzU2ZTY5NjAyOTY4NzU2MCI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+LgpsaWJyYXJ5IFVpbnQ4TGliIHsKICAgIGZ1bmN0aW9uIHhvclJlZHVjZSgKICAgICAgICB1aW50OFtdIGFyciwKICAgICAgICB1aW50ICAgIGxlbgogICAgICAgICkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQ4IHJlcykgewoKICAgICAgICByZXMgPSBhcnJbMF07CiAgICAgICAgZm9yICh1aW50IGkgPSAxOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICByZXMgXj0gYXJyW2ldOwogICAgICAgIH0KICAgIH0KfQoKLy8vIEB0aXRsZSBUb2tlbiBSZWdpc3RlciBDb250cmFjdAovLy8gQGF1dGhvciBEYW5pZWwgV2FuZyAtIDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iYjZkMmQ3ZDhkZmQzZGFmNmRhZDlkOWM2YzRkZmQ4ZDE5OGQ5YzRkMSI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+LgpsaWJyYXJ5IEVycm9yTGliIHsKCiAgICBldmVudCBFcnJvcihzdHJpbmcgbWVzc2FnZSk7CgogICAgLy8vIEBkZXYgQ2hlY2sgaWYgY29uZGl0aW9uIGhvbGQsIGlmIG5vdCwgbG9nIGFuIGV4Y2VwdGlvbiBhbmQgcmV2ZXJ0LgogICAgZnVuY3Rpb24gb3JUaHJvdyhib29sIGNvbmRpdGlvbiwgc3RyaW5nIG1lc3NhZ2UpIHB1YmxpYyBjb25zdGFudCB7CiAgICAgICAgaWYgKCFjb25kaXRpb24pIHsKICAgICAgICAgICAgZXJyb3IobWVzc2FnZSk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGVycm9yKHN0cmluZyBtZXNzYWdlKSBwdWJsaWMgY29uc3RhbnQgewogICAgICAgIEVycm9yKG1lc3NhZ2UpOwogICAgICAgIHJldmVydCgpOwogICAgfQp9CgovLy8gQHRpdGxlIFRva2VuIFJlZ2lzdGVyIENvbnRyYWN0Ci8vLyBAYXV0aG9yIEtvbmdsaWFuZyBaaG9uZyAtIDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iOThmM2Y3ZjZmZmY0ZjFmOWY2ZmZkOGY0ZjdmN2U4ZWFmMWY2ZmZiNmY3ZWFmZiI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+LAovLy8gQGF1dGhvciBEYW5pZWwgV2FuZyAtIDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iMmI0ZjRhNDU0MjRlNDc2YjQ3NDQ0NDViNTk0MjQ1NGMwNTQ0NTk0YyI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+LgpsaWJyYXJ5IEJ5dGVzMzJMaWIgewoKICAgIGZ1bmN0aW9uIHhvclJlZHVjZSgKICAgICAgICBieXRlczMyW10gICBhcnIsCiAgICAgICAgdWludCAgICAgICAgbGVuCiAgICAgICAgKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoYnl0ZXMzMiByZXMpIHsKCiAgICAgICAgcmVzID0gYXJyWzBdOwogICAgICAgIGZvciAodWludCBpID0gMTsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgIHJlcyA9IF94b3IocmVzLCBhcnJbaV0pOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBfeG9yKAogICAgICAgIGJ5dGVzMzIgYnMxLAogICAgICAgIGJ5dGVzMzIgYnMyCiAgICAgICAgKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoYnl0ZXMzMiByZXMpIHsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IHRlbXAgPSBuZXcgYnl0ZXMoMzIpOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IDMyOyBpKyspIHsKICAgICAgICAgICAgdGVtcFtpXSA9IGJzMVtpXSBeIGJzMltpXTsKICAgICAgICB9CiAgICAgICAgc3RyaW5nIG1lbW9yeSBzdHIgPSBzdHJpbmcodGVtcCk7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICByZXMgOj0gbWxvYWQoYWRkKHN0ciwgMzIpKQogICAgICAgIH0KICAgIH0KfQoKLy8vIEB0aXRsZSBUb2tlbiBSZWdpc3RlciBDb250cmFjdAovLy8gQGF1dGhvciBLb25nbGlhbmcgWmhvbmcgLSA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImI5ZDJkNmQ3ZGVkNWQwZDhkN2RlZjlkNWQ2ZDZjOWNiZDBkN2RlOTdkNmNiZGUiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+PiwKLy8vIEBhdXRob3IgRGFuaWVsIFdhbmcgLSA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjA0NjA2NTZhNmQ2MTY4NDQ2ODZiNmI3NDc2NmQ2YTYzMmE2Yjc2NjMiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+Pi4KY29udHJhY3QgVG9rZW5SZWdpc3RyeSBpcyBPd25hYmxlIHsKCiAgICBhZGRyZXNzW10gcHVibGljIHRva2VuczsKCiAgICBtYXBwaW5nIChzdHJpbmcgPT4gYWRkcmVzcykgdG9rZW5TeW1ib2xNYXA7CgogICAgZnVuY3Rpb24gcmVnaXN0ZXJUb2tlbihhZGRyZXNzIF90b2tlbiwgc3RyaW5nIF9zeW1ib2wpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKF90b2tlbiAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKCFpc1Rva2VuUmVnaXN0ZXJlZEJ5U3ltYm9sKF9zeW1ib2wpKTsKICAgICAgICByZXF1aXJlKCFpc1Rva2VuUmVnaXN0ZXJlZChfdG9rZW4pKTsKICAgICAgICB0b2tlbnMucHVzaChfdG9rZW4pOwogICAgICAgIHRva2VuU3ltYm9sTWFwW19zeW1ib2xdID0gX3Rva2VuOwogICAgfQoKICAgIGZ1bmN0aW9uIHVucmVnaXN0ZXJUb2tlbihhZGRyZXNzIF90b2tlbiwgc3RyaW5nIF9zeW1ib2wpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKHRva2VuU3ltYm9sTWFwW19zeW1ib2xdID09IF90b2tlbik7CiAgICAgICAgZGVsZXRlIHRva2VuU3ltYm9sTWFwW19zeW1ib2xdOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHRva2Vucy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAodG9rZW5zW2ldID09IF90b2tlbikgewogICAgICAgICAgICAgICAgdG9rZW5zW2ldID09IHRva2Vuc1t0b2tlbnMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgICAgICB0b2tlbnMubGVuZ3RoIC0tOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gaXNUb2tlblJlZ2lzdGVyZWRCeVN5bWJvbChzdHJpbmcgc3ltYm9sKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiB0b2tlblN5bWJvbE1hcFtzeW1ib2xdICE9IGFkZHJlc3MoMCk7CiAgICB9CgogICAgZnVuY3Rpb24gaXNUb2tlblJlZ2lzdGVyZWQoYWRkcmVzcyBfdG9rZW4pCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zIChib29sKSB7CgogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHRva2Vucy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAodG9rZW5zW2ldID09IF90b2tlbikgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEFkZHJlc3NCeVN5bWJvbChzdHJpbmcgc3ltYm9sKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoYWRkcmVzcykgewogICAgICAgIHJldHVybiB0b2tlblN5bWJvbE1hcFtzeW1ib2xdOwogICAgfQp9CgovLy8gQHRpdGxlIFRva2VuVHJhbnNmZXJEZWxlZ2F0ZSAtIEFjdHMgYXMgYSBtaWRkbGUgbWFuIHRvIHRyYW5zZmVyIEVSQzIwIHRva2VucwovLy8gb24gYmVoYWxmIG9mIGRpZmZlcmVudCB2ZXJzaW9uZWQgb2YgTG9vcHJpbmcgcHJvdG9jb2wgdG8gYXZvaWQgRVJDMjAKLy8vIHJlLWF1dGhvcml6YXRpb24uCi8vLyBAYXV0aG9yIERhbmllbCBXYW5nIC0gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSIzYzU4NWQ1MjU1NTk1MDdjNTA1MzUzNGM0ZTU1NTI1YjEyNTM0ZTViIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4uCmNvbnRyYWN0IFRva2VuVHJhbnNmZXJEZWxlZ2F0ZSBpcyBPd25hYmxlIHsKICAgIHVzaW5nIE1hdGggZm9yIHVpbnQ7CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIFZhcmlhYmxlcyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vLwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIHVpbnQgbGFzdFZlcnNpb24gPSAwOwogICAgYWRkcmVzc1tdIHB1YmxpYyB2ZXJzaW9uczsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkgcHVibGljIHZlcnNpb25lZDsKCgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIE1vZGlmaWVycyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vLwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIG1vZGlmaWVyIGlzVmVyc2lvbmVkKGFkZHJlc3MgYWRkcikgewogICAgICAgIGlmICh2ZXJzaW9uZWRbYWRkcl0gPT0gMCkgewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBub3RWZXJzaW9uZWQoYWRkcmVzcyBhZGRyKSB7CiAgICAgICAgaWYgKHZlcnNpb25lZFthZGRyXSA+IDApIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQogICAgICAgIF87CiAgICB9CgoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBFdmVudHMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLy8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBldmVudCBWZXJzaW9uQWRkZWQoYWRkcmVzcyBpbmRleGVkIGFkZHIsIHVpbnQgdmVyc2lvbik7CgogICAgZXZlbnQgVmVyc2lvblJlbW92ZWQoYWRkcmVzcyBpbmRleGVkIGFkZHIsIHVpbnQgdmVyc2lvbik7CgoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBQdWJsaWMgRnVuY3Rpb25zICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLy8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQGRldiBBZGQgYSBMb29wcmluZyBwcm90b2NvbCBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBhZGRyIEEgbG9vcHJpbmcgcHJvdG9jb2wgYWRkcmVzcy4KICAgIGZ1bmN0aW9uIGFkZFZlcnNpb24oYWRkcmVzcyBhZGRyKQogICAgICAgIG9ubHlPd25lcgogICAgICAgIG5vdFZlcnNpb25lZChhZGRyKQogICAgICAgIHsKICAgICAgICB2ZXJzaW9uZWRbYWRkcl0gPSArK2xhc3RWZXJzaW9uOwogICAgICAgIHZlcnNpb25zLnB1c2goYWRkcik7CiAgICAgICAgVmVyc2lvbkFkZGVkKGFkZHIsIGxhc3RWZXJzaW9uKTsKICAgIH0KCiAgICAvLy8gQGRldiBSZW1vdmUgYSBMb29wcmluZyBwcm90b2NvbCBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBhZGRyIEEgbG9vcHJpbmcgcHJvdG9jb2wgYWRkcmVzcy4KICAgIGZ1bmN0aW9uIHJlbW92ZVZlcnNpb24oYWRkcmVzcyBhZGRyKQogICAgICAgIG9ubHlPd25lcgogICAgICAgIGlzVmVyc2lvbmVkKGFkZHIpCiAgICAgICAgewogICAgICAgIHVpbnQgdmVyc2lvbiA9IHZlcnNpb25lZFthZGRyXTsKICAgICAgICBkZWxldGUgdmVyc2lvbmVkW2FkZHJdOwoKICAgICAgICB1aW50IGxlbmd0aCA9IHZlcnNpb25zLmxlbmd0aDsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAodmVyc2lvbnNbaV0gPT0gYWRkcikgewogICAgICAgICAgICAgICAgdmVyc2lvbnNbaV0gPSB2ZXJzaW9uc1tsZW5ndGggLSAxXTsKICAgICAgICAgICAgICAgIHZlcnNpb25zLmxlbmd0aCAtPSAxOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgVmVyc2lvblJlbW92ZWQoYWRkciwgdmVyc2lvbik7CiAgICB9CgoKICAgIC8vLyBAcmV0dXJuIEFtb3VudCBvZiBFUkMyMCB0b2tlbiB0aGF0IGNhbiBiZSBzcGVudCBieSB0aGlzIGNvbnRyYWN0LgogICAgLy8vIEBwYXJhbSB0b2tlbkFkZHJlc3MgQWRkcmVzcyBvZiB0b2tlbiB0byB0cmFuc2Zlci4KICAgIC8vLyBAcGFyYW0gX293bmVyIEFkZHJlc3Mgb2YgdGhlIHRva2VuIG93bmVyLgogICAgZnVuY3Rpb24gZ2V0U3BlbmRhYmxlKAogICAgICAgIGFkZHJlc3MgdG9rZW5BZGRyZXNzLAogICAgICAgIGFkZHJlc3MgX293bmVyCiAgICAgICAgKQogICAgICAgIGlzVmVyc2lvbmVkKG1zZy5zZW5kZXIpCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50KSB7CgogICAgICAgIHZhciB0b2tlbiA9IEVSQzIwKHRva2VuQWRkcmVzcyk7CiAgICAgICAgcmV0dXJuIHRva2VuCiAgICAgICAgICAgIC5hbGxvd2FuY2UoX293bmVyLCBhZGRyZXNzKHRoaXMpKQogICAgICAgICAgICAubWluMjU2KHRva2VuLmJhbGFuY2VPZihfb3duZXIpKTsKICAgIH0KCgogICAgLy8vIEBkZXYgSW52b2tlIEVSQzIwIHRyYW5zZmVyRnJvbSBtZXRob2QuCiAgICAvLy8gQHBhcmFtIHRva2VuIEFkZHJlc3Mgb2YgdG9rZW4gdG8gdHJhbnNmZXIuCiAgICAvLy8gQHBhcmFtIGZyb20gQWRkcmVzcyB0byB0cmFuc2ZlciB0b2tlbiBmcm9tLgogICAgLy8vIEBwYXJhbSB0byBBZGRyZXNzIHRvIHRyYW5zZmVyIHRva2VuIHRvLgogICAgLy8vIEBwYXJhbSB2YWx1ZSBBbW91bnQgb2YgdG9rZW4gdG8gdHJhbnNmZXIuCiAgICAvLy8gQHJldHVybiBUYW5zZmVyIHJlc3VsdC4KICAgIGZ1bmN0aW9uIHRyYW5zZmVyVG9rZW4oCiAgICAgICAgYWRkcmVzcyB0b2tlbiwKICAgICAgICBhZGRyZXNzIGZyb20sCiAgICAgICAgYWRkcmVzcyB0bywKICAgICAgICB1aW50IHZhbHVlKQogICAgICAgIGlzVmVyc2lvbmVkKG1zZy5zZW5kZXIpCiAgICAgICAgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBFUkMyMCh0b2tlbikudHJhbnNmZXJGcm9tKGZyb20sIHRvLCB2YWx1ZSk7CiAgICB9CgogICAgLy8vIEBkZXYgR2V0cyBhbGwgdmVyc2lvbmVkIGFkZHJlc3Nlcy4KICAgIC8vLyBAcmV0dXJuIEFycmF5IG9mIHZlcnNpb25lZCBhZGRyZXNzZXMuCiAgICBmdW5jdGlvbiBnZXRWZXJzaW9ucygpCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zIChhZGRyZXNzW10pIHsKICAgICAgICByZXR1cm4gdmVyc2lvbnM7CiAgICB9Cn0KCmNvbnRyYWN0IFJpbmdoYXNoUmVnaXN0cnkgewogICAgdXNpbmcgQnl0ZXMzMkxpYiAgICBmb3IgYnl0ZXMzMltdOwogICAgdXNpbmcgRXJyb3JMaWIgICAgICBmb3IgYm9vbDsKICAgIHVzaW5nIFVpbnQ4TGliICAgICAgZm9yIHVpbnQ4W107CgogICAgdWludCBwdWJsaWMgYmxvY2tzVG9MaXZlOwoKICAgIHN0cnVjdCBTdWJtaXNzaW9uIHsKICAgICAgICBhZGRyZXNzIGZlZVJlY2VwaWVudDsKICAgICAgICB1aW50IGJsb2NrOwogICAgfQoKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gU3VibWlzc2lvbikgc3VibWlzc2lvbnM7CgogICAgZnVuY3Rpb24gUmluZ2hhc2hSZWdpc3RyeSh1aW50IF9ibG9ja3NUb0xpdmUpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShfYmxvY2tzVG9MaXZlID4gMCk7CiAgICAgICAgYmxvY2tzVG9MaXZlID0gX2Jsb2Nrc1RvTGl2ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdWJtaXRSaW5naGFzaCgKICAgICAgICB1aW50ICAgICAgICByaW5nU2l6ZSwKICAgICAgICBhZGRyZXNzICAgICBmZWVSZWNlcGllbnQsCiAgICAgICAgLy8gYm9vbCAgICAgICAgdGhyb3dJZkxSQ0lzSW5zdWZmY2llbnQsCiAgICAgICAgdWludDhbXSAgICAgdkxpc3QsCiAgICAgICAgYnl0ZXMzMltdICAgckxpc3QsCiAgICAgICAgYnl0ZXMzMltdICAgc0xpc3QpCiAgICAgICAgcHVibGljIHsKICAgICAgICBieXRlczMyIHJpbmdoYXNoID0gY2FsY3VsYXRlUmluZ2hhc2goCiAgICAgICAgICAgIHJpbmdTaXplLAogICAgICAgICAgICAvLyBmZWVSZWNlcGllbnQsCiAgICAgICAgICAgIC8vIHRocm93SWZMUkNJc0luc3VmZmNpZW50LAogICAgICAgICAgICB2TGlzdCwKICAgICAgICAgICAgckxpc3QsCiAgICAgICAgICAgIHNMaXN0KTsKCiAgICAgICAgY2FuU3VibWl0KHJpbmdoYXNoLCBmZWVSZWNlcGllbnQpCiAgICAgICAgICAgIC5vclRocm93KCJSaW5naGFzaCBzdWJtaXR0ZWQiKTsKCiAgICAgICAgc3VibWlzc2lvbnNbcmluZ2hhc2hdID0gU3VibWlzc2lvbihmZWVSZWNlcGllbnQsIGJsb2NrLm51bWJlcik7CiAgICB9CgogICAgZnVuY3Rpb24gY2FuU3VibWl0KAogICAgICAgIGJ5dGVzMzIgcmluZ2hhc2gsCiAgICAgICAgYWRkcmVzcyBmZWVSZWNlcGllbnQKICAgICAgICApCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zIChib29sKSB7CgogICAgICAgIHZhciBzdWJtaXNzaW9uID0gc3VibWlzc2lvbnNbcmluZ2hhc2hdOwogICAgICAgIHJldHVybiAoc3VibWlzc2lvbi5mZWVSZWNlcGllbnQgPT0gYWRkcmVzcygwKQogICAgICAgICAgICB8fCBzdWJtaXNzaW9uLmJsb2NrICsgYmxvY2tzVG9MaXZlIDwgYmxvY2subnVtYmVyCiAgICAgICAgICAgIHx8IHN1Ym1pc3Npb24uZmVlUmVjZXBpZW50ID09IGZlZVJlY2VwaWVudCk7CiAgICB9CgogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBhIHJpbmcncyBoYXNoIGhhcyBldmVyIGJlZW4gc3VibWl0dGVkOyBmYWxzZSBvdGhlcndpc2UuCiAgICBmdW5jdGlvbiByaW5naGFzaEZvdW5kKGJ5dGVzMzIgcmluZ2hhc2gpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zIChib29sKSB7CgogICAgICAgIHJldHVybiBzdWJtaXNzaW9uc1tyaW5naGFzaF0uZmVlUmVjZXBpZW50ICE9IGFkZHJlc3MoMCk7CiAgICB9CgogICAgLy8vIEBkZXYgQ2FsY3VsYXRlIHRoZSBoYXNoIG9mIGEgcmluZy4KICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZVJpbmdoYXNoKAogICAgICAgIHVpbnQgICAgICAgIHJpbmdTaXplLAogICAgICAgIC8vIGFkZHJlc3MgICAgIGZlZVJlY2VwaWVudCwKICAgICAgICAvLyBib29sICAgICAgICB0aHJvd0lmTFJDSXNJbnN1ZmZjaWVudCwKICAgICAgICB1aW50OFtdICAgICB2TGlzdCwKICAgICAgICBieXRlczMyW10gICByTGlzdCwKICAgICAgICBieXRlczMyW10gICBzTGlzdAogICAgICAgICkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKGJ5dGVzMzIpIHsKCiAgICAgICAgKHJpbmdTaXplID09IHZMaXN0Lmxlbmd0aCAtIDEKICAgICAgICAgICAgJiYgcmluZ1NpemUgPT0gckxpc3QubGVuZ3RoIC0gMQogICAgICAgICAgICAmJiByaW5nU2l6ZSA9PSBzTGlzdC5sZW5ndGggLSAxKQogICAgICAgICAgICAub3JUaHJvdygiaW52YWxpZCByaW5nIGRhdGEiKTsKCiAgICAgICAgcmV0dXJuIGtlY2NhazI1NigKICAgICAgICAgICAgLy8gZmVlUmVjZXBpZW50LAogICAgICAgICAgICAvLyB0aHJvd0lmTFJDSXNJbnN1ZmZjaWVudCwKICAgICAgICAgICAgdkxpc3QueG9yUmVkdWNlKHJpbmdTaXplKSwKICAgICAgICAgICAgckxpc3QueG9yUmVkdWNlKHJpbmdTaXplKSwKICAgICAgICAgICAgc0xpc3QueG9yUmVkdWNlKHJpbmdTaXplKSk7CiAgICB9Cn0KCi8vLyBAdGl0bGUgTG9vcHJpbmcgVG9rZW4gRXhjaGFuZ2UgUHJvdG9jb2wgQ29udHJhY3QgSW50ZXJmYWNlCi8vLyBAYXV0aG9yIERhbmllbCBXYW5nIC0gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSJkZmJiYmViMWI2YmFiMzlmYjNiMGIwYWZhZGI2YjFiOGYxYjBhZGI4Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4KLy8vIEBhdXRob3IgS29uZ2xpYW5nIFpob25nIC0gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI1YzM3MzMzMjNiMzAzNTNkMzIzYjFjMzAzMzMzMmMyZTM1MzIzYjcyMzMyZTNiIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4KY29udHJhY3QgTG9vcHJpbmdQcm90b2NvbCB7CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIENvbnN0YW50cyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vLwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgdWludCAgICBwdWJsaWMgY29uc3RhbnQgRkVFX1NFTEVDVF9MUkMgICAgICAgICAgICAgICA9IDA7CiAgICB1aW50ICAgIHB1YmxpYyBjb25zdGFudCBGRUVfU0VMRUNUX01BUkdJTl9TUExJVCAgICAgID0gMTsKICAgIHVpbnQgICAgcHVibGljIGNvbnN0YW50IEZFRV9TRUxFQ1RfTUFYX1ZBTFVFICAgICAgICAgPSAxOwoKICAgIHVpbnQgICAgcHVibGljIGNvbnN0YW50IE1BUkdJTl9TUExJVF9QRVJDRU5UQUdFX0JBU0UgPSAxMDAwMDsKCgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIFN0cnVjdHMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vLwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAcGFyYW0gdG9rZW5TICAgICAgIFRva2VuIHRvIHNlbGwuCiAgICAvLy8gQHBhcmFtIHRva2VuQiAgICAgICBUb2tlbiB0byBidXkuCiAgICAvLy8gQHBhcmFtIGFtb3VudFMgICAgICBNYXhpbXVtIGFtb3VudCBvZiB0b2tlblMgdG8gc2VsbC4KICAgIC8vLyBAcGFyYW0gYW1vdW50QiAgICAgIE1pbmltdW0gYW1vdW50IG9mIHRva2VuQiB0byBidXkgaWYgYWxsIGFtb3VudFMgc29sZC4KICAgIC8vLyBAcGFyYW0gdGltZXN0YW1wICAgIEluZGljYXRpbmcgd2h0biB0aGlzIG9yZGVyIGlzIGNyZWF0ZWQvc2lnbmVkLgogICAgLy8vIEBwYXJhbSB0dGwgICAgICAgICAgSW5kaWNhdGluZyBhZnRlciBob3cgbWFueSBzZWNvbmRzIGZyb20gYHRpbWVzdGFtcGAKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIHRoaXMgb3JkZXIgd2lsbCBleHBpcmUuCiAgICAvLy8gQHBhcmFtIHNhbHQgICAgICAgICBBIHJhbmRvbSBudW1iZXIgdG8gbWFrZSB0aGlzIG9yZGVyJ3MgaGFzaCB1bmlxdWUuCiAgICAvLy8gQHBhcmFtIGxyY0ZlZSAgICAgICBNYXggYW1vdW50IG9mIExSQyB0byBwYXkgZm9yIG1pbmVyLiBUaGUgcmVhbCBhbW91bnQKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIHRvIHBheSBpcyBwcm9wb3J0aW9uYWwgdG8gZmlsbCBhbW91bnQuCiAgICAvLy8gQHBhcmFtIGJ1eU5vTW9yZVRoYW5BbW91bnRCIC0KICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIElmIHRydWUsIHRoaXMgb3JkZXIgZG9lcyBub3QgYWNjZXB0IGJ1eWluZyBtb3JlCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICB0aGFuIGBhbW91bnRCYC4KICAgIC8vLyBAcGFyYW0gbWFyZ2luU3BsaXRQZXJjZW50YWdlIC0KICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIFRoZSBwZXJjZW50YWdlIG9mIG1hcmdpbiBwYWlkIHRvIG1pbmVyLgogICAgLy8vIEBwYXJhbSB2ICAgICAgICAgICAgRUNEU0Egc2lnbmF0dXJlIHBhcmFtZXRlciB2LgogICAgLy8vIEBwYXJhbSByICAgICAgICAgICAgRUNEU0Egc2lnbmF0dXJlIHBhcmFtZXRlcnMgci4KICAgIC8vLyBAcGFyYW0gcyAgICAgICAgICAgIEVDRFNBIHNpZ25hdHVyZSBwYXJhbWV0ZXJzIHMuCiAgICBzdHJ1Y3QgT3JkZXIgewogICAgICAgIGFkZHJlc3Mgb3duZXI7CiAgICAgICAgYWRkcmVzcyB0b2tlblM7CiAgICAgICAgYWRkcmVzcyB0b2tlbkI7CiAgICAgICAgdWludCAgICBhbW91bnRTOwogICAgICAgIHVpbnQgICAgYW1vdW50QjsKICAgICAgICB1aW50ICAgIHRpbWVzdGFtcDsKICAgICAgICB1aW50ICAgIHR0bDsKICAgICAgICB1aW50ICAgIHNhbHQ7CiAgICAgICAgdWludCAgICBscmNGZWU7CiAgICAgICAgYm9vbCAgICBidXlOb01vcmVUaGFuQW1vdW50QjsKICAgICAgICB1aW50OCAgIG1hcmdpblNwbGl0UGVyY2VudGFnZTsKICAgICAgICB1aW50OCAgIHY7CiAgICAgICAgYnl0ZXMzMiByOwogICAgICAgIGJ5dGVzMzIgczsKICAgIH0KCgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIFB1YmxpYyBGdW5jdGlvbnMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vLwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAZGV2IFN1Ym1pdCBhIG9yZGVyLXJpbmcgZm9yIHZhbGlkYXRpb24gYW5kIHNldHRsZW1lbnQuCiAgICAvLy8gQHBhcmFtIGFkZHJlc3NMaXN0ICBMaXN0IG9mIGVhY2ggb3JkZXIncyBvd25lciBhbmQgdG9rZW5TLiBOb3RlIHRoYXQgbmV4dAogICAgLy8vICAgICAgICAgICAgICAgICAgICAgb3JkZXIncyBgdG9rZW5TYCBlcXVhbHMgdGhpcyBvcmRlcidzIGB0b2tlbkJgLgogICAgLy8vIEBwYXJhbSB1aW50QXJnc0xpc3QgTGlzdCBvZiB1aW50LXR5cGUgYXJndW1lbnRzIGluIHRoaXMgb3JkZXI6CiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBhbW91bnRTLCBBbW91bnRCLCByYXRlQW1vdW50UywgdGltZXN0YW1wLCB0dGwsIHNhbHQsCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBhbmQgbHJjRmVlLgogICAgLy8vIEBwYXJhbSB1aW50OEFyZ3NMaXN0IC0KICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIExpc3Qgb2YgdW5pdDgtdHlwZSBhcmd1bWVudHMsIGluIHRoaXMgb3JkZXI6CiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBtYXJnaW5TcGxpdFBlcmNlbnRhZ2VMaXN0LCBmZWVTZWxlY3Rpb25MaXN0LgogICAgLy8vIEBwYXJhbSB2TGlzdCAgICAgICAgTGlzdCBvZiB2IGZvciBlYWNoIG9yZGVyLiBUaGlzIGxpc3QgaXMgMS1sYXJnZXIgdGhhbgogICAgLy8vICAgICAgICAgICAgICAgICAgICAgdGhlIHByZXZpb3VzIGxpc3RzLCB3aXRoIHRoZSBsYXN0IGVsZW1lbnQgYmVpbmcgdGhlCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICB2IHZhbHVlIG9mIHRoZSByaW5nIHNpZ25hdHVyZS4KICAgIC8vLyBAcGFyYW0gckxpc3QgICAgICAgIExpc3Qgb2YgciBmb3IgZWFjaCBvcmRlci4gVGhpcyBsaXN0IGlzIDEtbGFyZ2VyIHRoYW4KICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIHRoZSBwcmV2aW91cyBsaXN0cywgd2l0aCB0aGUgbGFzdCBlbGVtZW50IGJlaW5nIHRoZQogICAgLy8vICAgICAgICAgICAgICAgICAgICAgciB2YWx1ZSBvZiB0aGUgcmluZyBzaWduYXR1cmUuCiAgICAvLy8gQHBhcmFtIHNMaXN0ICAgICAgICBMaXN0IG9mIHMgZm9yIGVhY2ggb3JkZXIuIFRoaXMgbGlzdCBpcyAxLWxhcmdlciB0aGFuCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICB0aGUgcHJldmlvdXMgbGlzdHMsIHdpdGggdGhlIGxhc3QgZWxlbWVudCBiZWluZyB0aGUKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIHMgdmFsdWUgb2YgdGhlIHJpbmcgc2lnbmF0dXJlLgogICAgLy8vIEBwYXJhbSByaW5nbWluZXIgICAgVGhlIGFkZHJlc3MgdGhhdCBzaWduZWQgdGhpcyB0eC4KICAgIC8vLyBAcGFyYW0gZmVlUmVjZXBpZW50IFRoZSByZWNlcGllbnQgYWRkcmVzcyBmb3IgZmVlIGNvbGxlY3Rpb24uIElmIHRoaXMgaXMKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgICcweDAnLCBhbGwgZmVlcyB3aWxsIGJlIHBhaWQgdG8gdGhlIGFkZHJlc3Mgd2hvIGhhZAogICAgLy8vICAgICAgICAgICAgICAgICAgICAgc2lnbmVkIHRoaXMgdHJhbnNhY3Rpb24sIG5vdCBgbXNnLnNlbmRlcmAuIE5vdGVkIGlmCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBMUkMgbmVlZCB0byBiZSBwYWlkIGJhY2sgdG8gb3JkZXIgb3duZXIgYXMgdGhlIHJlc3VsdAogICAgLy8vICAgICAgICAgICAgICAgICAgICAgb2YgZmVlIHNlbGVjdGlvbiBtb2RlbCwgTFJDIHdpbGwgYWxzbyBiZSBzZW50IGZyb20KICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIHRoaXMgYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gdGhyb3dJZkxSQ0lzSW5zdWZmY2llbnQgLQogICAgLy8vICAgICAgICAgICAgICAgICAgICAgSWYgdHJ1ZSwgdGhyb3cgZXhjZXB0aW9uIGlmIGFueSBvcmRlcidzIHNwZW5kYWJsZQogICAgLy8vICAgICAgICAgICAgICAgICAgICAgTFJDIGFtb3VudCBpcyBzbWFsbGVyIHRoYW4gcmVxdXJpZWQ7IGlmIGZhbHNlLCByaW5nLQogICAgLy8vICAgICAgICAgICAgICAgICAgICAgbWlub3Igd2lsbCBnaXZlIHVwIGNvbGxlY3Rpb24gdGhlIExSQyBmZWUuCiAgICBmdW5jdGlvbiBzdWJtaXRSaW5nKAogICAgICAgIGFkZHJlc3NbMl1bXSAgICBhZGRyZXNzTGlzdCwKICAgICAgICB1aW50WzddW10gICAgICAgdWludEFyZ3NMaXN0LAogICAgICAgIHVpbnQ4WzJdW10gICAgICB1aW50OEFyZ3NMaXN0LAogICAgICAgIGJvb2xbXSAgICAgICAgICBidXlOb01vcmVUaGFuQW1vdW50Qkxpc3QsCiAgICAgICAgdWludDhbXSAgICAgICAgIHZMaXN0LAogICAgICAgIGJ5dGVzMzJbXSAgICAgICByTGlzdCwKICAgICAgICBieXRlczMyW10gICAgICAgc0xpc3QsCiAgICAgICAgYWRkcmVzcyAgICAgICAgIHJpbmdtaW5lciwKICAgICAgICBhZGRyZXNzICAgICAgICAgZmVlUmVjZXBpZW50LAogICAgICAgIGJvb2wgICAgICAgICAgICB0aHJvd0lmTFJDSXNJbnN1ZmZjaWVudAogICAgICAgICkgcHVibGljOwoKICAgIC8vLyBAZGV2IENhbmNlbCBhIG9yZGVyLiBjYW5jZWwgYW1vdW50KGFtb3VudFMgb3IgYW1vdW50QikgY2FuIGJlIHNwZWNpZmllZAogICAgLy8vICAgICAgaW4gb3JkZXJWYWx1ZXMuCiAgICAvLy8gQHBhcmFtIGFkZHJlc3NlcyAgICAgICAgICBvd25lciwgdG9rZW5TLCB0b2tlbkIKICAgIC8vLyBAcGFyYW0gb3JkZXJWYWx1ZXMgICAgICAgIGFtb3VudFMsIGFtb3VudEIsIHRpbWVzdGFtcCwgdHRsLCBzYWx0LCBscmNGZWUsCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICAgICAgICBjYW5jZWxBbW91bnRTLCBhbmQgY2FuY2VsQW1vdW50Qi4KICAgIC8vLyBAcGFyYW0gbWFyZ2luU3BsaXRQZXJjZW50YWdlIC0KICAgIC8vLyBAcGFyYW0gYnV5Tm9Nb3JlVGhhbkFtb3VudEIgLQogICAgLy8vIEBwYXJhbSB2ICAgICAgICAgICAgICAgICAgT3JkZXIgRUNEU0Egc2lnbmF0dXJlIHBhcmFtZXRlciB2LgogICAgLy8vIEBwYXJhbSByICAgICAgICAgICAgICAgICAgT3JkZXIgRUNEU0Egc2lnbmF0dXJlIHBhcmFtZXRlcnMgci4KICAgIC8vLyBAcGFyYW0gcyAgICAgICAgICAgICAgICAgIE9yZGVyIEVDRFNBIHNpZ25hdHVyZSBwYXJhbWV0ZXJzIHMuCiAgICBmdW5jdGlvbiBjYW5jZWxPcmRlcigKICAgICAgICBhZGRyZXNzWzNdIGFkZHJlc3NlcywKICAgICAgICB1aW50WzddICAgIG9yZGVyVmFsdWVzLAogICAgICAgIGJvb2wgICAgICAgYnV5Tm9Nb3JlVGhhbkFtb3VudEIsCiAgICAgICAgdWludDggICAgICBtYXJnaW5TcGxpdFBlcmNlbnRhZ2UsCiAgICAgICAgdWludDggICAgICB2LAogICAgICAgIGJ5dGVzMzIgICAgciwKICAgICAgICBieXRlczMyICAgIHMKICAgICAgICApIHB1YmxpYzsKCiAgICAvLy8gQGRldiAgIFNldCBhIGN1dG9mZiB0aW1lc3RhbXAgdG8gaW52YWxpZGF0ZSBhbGwgb3JkZXJzIHdob3NlIHRpbWVzdGFtcAogICAgLy8vICAgICAgICBpcyBzbWFsbGVyIHRoYW4gb3IgZXF1YWwgdG8gdGhlIG5ldyB2YWx1ZSBvZiB0aGUgYWRkcmVzcydzIGN1dG9mZgogICAgLy8vICAgICAgICB0aW1lc3RhbXAuCiAgICAvLy8gQHBhcmFtIGN1dG9mZiBUaGUgY3V0b2ZmIHRpbWVzdGFtcCwgd2lsbCBkZWZhdWx0IHRvIGBibG9jay50aW1lc3RhbXBgCiAgICAvLy8gICAgICAgIGlmIGl0IGlzIDAuCiAgICBmdW5jdGlvbiBzZXRDdXRvZmYodWludCBjdXRvZmYpIHB1YmxpYzsKfQoKLy8vIEB0aXRsZSBMb29wcmluZyBUb2tlbiBFeGNoYW5nZSBQcm90b2NvbCBJbXBsZW1lbnRhdGlvbiBDb250cmFjdCB2MQovLy8gQGF1dGhvciBEYW5pZWwgV2FuZyAtIDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iZTM4NzgyOGQ4YTg2OGZhMzhmOGM4YzkzOTE4YThkODRjZDhjOTE4NCI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+LAovLy8gQGF1dGhvciBLb25nbGlhbmcgWmhvbmcgLSA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImI3ZGNkOGQ5ZDBkYmRlZDZkOWQwZjdkYmQ4ZDhjN2M1ZGVkOWQwOTlkOGM1ZDAiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+Pgpjb250cmFjdCBMb29wcmluZ1Byb3RvY29sSW1wbCBpcyBMb29wcmluZ1Byb3RvY29sIHsKICAgIHVzaW5nIEVycm9yTGliICBmb3IgYm9vbDsKICAgIHVzaW5nIE1hdGggICAgICBmb3IgdWludDsKICAgIHVzaW5nIFNhZmVNYXRoICBmb3IgdWludDsKICAgIHVzaW5nIFVpbnRMaWIgICBmb3IgdWludDsKCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gVmFyaWFibGVzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8vCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgYWRkcmVzcyBwdWJsaWMgIGxyY1Rva2VuQWRkcmVzcyAgICAgICAgICAgICA9IGFkZHJlc3MoMCk7CiAgICBhZGRyZXNzIHB1YmxpYyAgdG9rZW5SZWdpc3RyeUFkZHJlc3MgICAgICAgID0gYWRkcmVzcygwKTsKICAgIGFkZHJlc3MgcHVibGljICByaW5naGFzaFJlZ2lzdHJ5QWRkcmVzcyAgICAgPSBhZGRyZXNzKDApOwogICAgYWRkcmVzcyBwdWJsaWMgIGRlbGVnYXRlQWRkcmVzcyAgICAgICAgICAgICA9IGFkZHJlc3MoMCk7CgogICAgdWludCAgICBwdWJsaWMgIG1heFJpbmdTaXplICAgICAgICAgICAgICAgICA9IDA7CiAgICB1aW50ICAgIHB1YmxpYyAgcmluZ0luZGV4ICAgICAgICAgICAgICAgICAgID0gMDsKICAgIGJvb2wgICAgcHJpdmF0ZSBlbnRlcmVkICAgICAgICAgICAgICAgICAgICAgPSBmYWxzZTsKCiAgICAvLyBFeGNoYW5nZSByYXRlIChyYXRlKSBpcyB0aGUgYW1vdW50IHRvIHNlbGwgb3Igc29sZCBkaXZpZGVkIGJ5IHRoZSBhbW91bnQKICAgIC8vIHRvIGJ1eSBvciBib3VnaHQuCiAgICAvLwogICAgLy8gUmF0ZSByYXRpbyBpcyB0aGUgcmF0aW8gYmV0d2VlbiBleGVjdXRlZCByYXRlIGFuZCBhbiBvcmRlcidzIG9yaWdpbmFsCiAgICAvLyByYXRlLgogICAgLy8KICAgIC8vIFRvIHJlcXVpcmUgYWxsIG9yZGVycycgcmF0ZSByYXRpb3MgdG8gaGF2ZSBjb2VmZmljaWVudCBvZnZhcmlhdGlvbiAoQ1YpCiAgICAvLyBzbWFsbGVyIHRoYW4gMi41JSwgZm9yIGFuIGV4YW1wbGUgLCByYXRlUmF0aW9DVlNUaHJlc2hvbGQgc2hvdWxkIGJlOgogICAgLy8gICAgIGAoMC4wMjUgKiBSQVRFX1JBVElPX1NDQUxFKV4yYCBvciA2MjUwMC4KICAgIHVpbnQgICAgcHVibGljICByYXRlUmF0aW9DVlNUaHJlc2hvbGQgICAgICAgPSAwOwoKICAgIHVpbnQgICAgcHVibGljIGNvbnN0YW50IFJBVEVfUkFUSU9fU0NBTEUgICAgPSAxMDAwMDsKCiAgICAvLyBUaGUgZm9sbG93aW5nIHR3byBtYXBzIGFyZSB1c2VkIHRvIGtlZXAgdHJhY2Ugb2Ygb3JkZXIgZmlsbCBhbmQKICAgIC8vIGNhbmNlbGxhdGlvbiBoaXN0b3J5LgogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiB1aW50KSBwdWJsaWMgZmlsbGVkOwogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiB1aW50KSBwdWJsaWMgY2FuY2VsbGVkOwoKICAgIC8vIEEgbWFwIGZyb20gYWRkcmVzcyB0byBpdHMgY3V0b2ZmIHRpbWVzdGFtcC4KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkgcHVibGljIGN1dG9mZnM7CgoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBTdHJ1Y3RzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLy8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQHBhcmFtIG9yZGVyICAgICAgICBUaGUgb3JpZ2luYWwgb3JkZXIKICAgIC8vLyBAcGFyYW0gZmVlU2VsZWN0aW9uIC0KICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIEEgbWluZXItc3VwcGxpZWQgdmFsdWUgaW5kaWNhdGluZyBpZiBMUkMgKHZhbHVlID0gMCkKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIG9yIG1hcmdpbiBzcGxpdCBpcyBjaG9vc2VuIGJ5IHRoZSBtaW5lciAodmFsdWUgPSAxKS4KICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIFdlIG1heSBzdXBwb3J0IG1vcmUgZmVlIG1vZGVsIGluIHRoZSBmdXR1cmUuCiAgICAvLy8gQHBhcmFtIGZpbGxBbW91bnRTICBBbW91bnQgb2YgdG9rZW5TIHRvIHNlbGwsIGNhbGN1bGF0ZWQgYnkgcHJvdG9jb2wuCiAgICAvLy8gQHBhcmFtIHJhdGVBbW91bnRTICBUaGlzIHZhbHVlIGlzIGluaXRpYWxseSBwcm92aWRlZCBieSBtaW5lciBhbmQgaXMKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIGNhbGN1bGF0ZWQgYnkgYmFzZWQgb24gdGhlIG9yaWdpbmFsIGluZm9ybWF0aW9uIG9mCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBhbGwgb3JkZXJzIG9mIHRoZSBvcmRlci1yaW5nLCBpbiBvdGhlciBvcmRlcnMsIHRoaXMKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIHZhbHVlIGlzIGluZGVwZW5kZW50IG9mIHRoZSBvcmRlcidzIGN1cnJlbnQgc3RhdGUuCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBUaGlzIHZhbHVlIGFuZCBgcmF0ZUFtb3VudEJgIGNhbiBiZSB1c2VkIHRvIGNhbGN1bGF0ZQogICAgLy8vICAgICAgICAgICAgICAgICAgICAgdGhlIHByb3Bvc2VkIGV4Y2hhbmdlIHJhdGUgY2FsY3VsYXRlZCBieSBtaW5lci4KICAgIC8vLyBAcGFyYW0gbHJjUmV3YXJkICAgIFRoZSBhbW91bnQgb2YgTFJDIHBhaWQgYnkgbWluZXIgdG8gb3JkZXIgb3duZXIgaW4KICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlIGZvciBtYXJnaW4gc3BsaXQuCiAgICAvLy8gQHBhcmFtIGxyY0ZlZSAgICAgICBUaGUgYW1vdW50IG9mIExSIHBhaWQgYnkgb3JkZXIgb3duZXIgdG8gbWluZXIuCiAgICAvLy8gQHBhcmFtIHNwbGl0UyAgICAgIFRva2VuUyBwYWlkIHRvIG1pbmVyLgogICAgLy8vIEBwYXJhbSBzcGxpdEIgICAgICBUb2tlbkIgcGFpZCB0byBtaW5lci4KICAgIHN0cnVjdCBPcmRlclN0YXRlIHsKICAgICAgICBPcmRlciAgIG9yZGVyOwogICAgICAgIGJ5dGVzMzIgb3JkZXJIYXNoOwogICAgICAgIHVpbnQ4ICAgZmVlU2VsZWN0aW9uOwogICAgICAgIHVpbnQgICAgcmF0ZUFtb3VudFM7CiAgICAgICAgdWludCAgICBhdmFpbGFibGVBbW91bnRTOwogICAgICAgIHVpbnQgICAgZmlsbEFtb3VudFM7CiAgICAgICAgdWludCAgICBscmNSZXdhcmQ7CiAgICAgICAgdWludCAgICBscmNGZWU7CiAgICAgICAgdWludCAgICBzcGxpdFM7CiAgICAgICAgdWludCAgICBzcGxpdEI7CiAgICB9CgogICAgc3RydWN0IFJpbmcgewogICAgICAgIGJ5dGVzMzIgICAgICByaW5naGFzaDsKICAgICAgICBPcmRlclN0YXRlW10gb3JkZXJzOwogICAgICAgIGFkZHJlc3MgICAgICBtaW5lcjsKICAgICAgICBhZGRyZXNzICAgICAgZmVlUmVjZXBpZW50OwogICAgICAgIGJvb2wgICAgICAgICB0aHJvd0lmTFJDSXNJbnN1ZmZjaWVudDsKICAgIH0KCgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIEV2ZW50cyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vLwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIGV2ZW50IFJpbmdNaW5lZCgKICAgICAgICB1aW50ICAgICAgICAgICAgICAgIF9yaW5nSW5kZXgsCiAgICAgICAgdWludCAgICAgICAgICAgICAgICBfdGltZSwKICAgICAgICB1aW50ICAgICAgICAgICAgICAgIF9ibG9ja251bWJlciwKICAgICAgICBieXRlczMyICAgICBpbmRleGVkIF9yaW5naGFzaCwKICAgICAgICBhZGRyZXNzICAgICBpbmRleGVkIF9taW5lciwKICAgICAgICBhZGRyZXNzICAgICBpbmRleGVkIF9mZWVSZWNlcGllbnQsCiAgICAgICAgYm9vbCAgICAgICAgICAgICAgICBfcmluZ2hhc2hGb3VuZCk7CgogICAgZXZlbnQgT3JkZXJGaWxsZWQoCiAgICAgICAgdWludCAgICAgICAgICAgICAgICBfcmluZ0luZGV4LAogICAgICAgIHVpbnQgICAgICAgICAgICAgICAgX3RpbWUsCiAgICAgICAgdWludCAgICAgICAgICAgICAgICBfYmxvY2tudW1iZXIsCiAgICAgICAgYnl0ZXMzMiAgICAgaW5kZXhlZCBfcmluZ2hhc2gsCiAgICAgICAgYnl0ZXMzMiAgICAgICAgICAgICBfcHJldk9yZGVySGFzaCwKICAgICAgICBieXRlczMyICAgICBpbmRleGVkIF9vcmRlckhhc2gsCiAgICAgICAgYnl0ZXMzMiAgICAgICAgICAgICAgX25leHRPcmRlckhhc2gsCiAgICAgICAgdWludCAgICAgICAgICAgICAgICBfYW1vdW50UywKICAgICAgICB1aW50ICAgICAgICAgICAgICAgIF9hbW91bnRCLAogICAgICAgIHVpbnQgICAgICAgICAgICAgICAgX2xyY1Jld2FyZCwKICAgICAgICB1aW50ICAgICAgICAgICAgICAgIF9scmNGZWUpOwoKICAgIGV2ZW50IE9yZGVyQ2FuY2VsbGVkKAogICAgICAgIHVpbnQgICAgICAgICAgICAgICAgX3RpbWUsCiAgICAgICAgdWludCAgICAgICAgICAgICAgICBfYmxvY2tudW1iZXIsCiAgICAgICAgYnl0ZXMzMiAgICAgaW5kZXhlZCBfb3JkZXJIYXNoLAogICAgICAgIHVpbnQgICAgICAgICAgICAgICAgX2Ftb3VudENhbmNlbGxlZCk7CgogICAgZXZlbnQgQ3V0b2ZmVGltZXN0YW1wQ2hhbmdlZCgKICAgICAgICB1aW50ICAgICAgICAgICAgICAgIF90aW1lLAogICAgICAgIHVpbnQgICAgICAgICAgICAgICAgX2Jsb2NrbnVtYmVyLAogICAgICAgIGFkZHJlc3MgICAgIGluZGV4ZWQgX2FkZHJlc3MsCiAgICAgICAgdWludCAgICAgICAgICAgICAgICBfY3V0b2ZmKTsKCgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIENvbnN0cnVjdG9yICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vLwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIGZ1bmN0aW9uIExvb3ByaW5nUHJvdG9jb2xJbXBsKAogICAgICAgIGFkZHJlc3MgX2xyY1Rva2VuQWRkcmVzcywKICAgICAgICBhZGRyZXNzIF90b2tlblJlZ2lzdHJ5QWRkcmVzcywKICAgICAgICBhZGRyZXNzIF9yaW5naGFzaFJlZ2lzdHJ5QWRkcmVzcywKICAgICAgICBhZGRyZXNzIF9kZWxlZ2F0ZUFkZHJlc3MsCiAgICAgICAgdWludCAgICBfbWF4UmluZ1NpemUsCiAgICAgICAgdWludCAgICBfcmF0ZVJhdGlvQ1ZTVGhyZXNob2xkCiAgICAgICAgKQogICAgICAgIHB1YmxpYyB7CgogICAgICAgIHJlcXVpcmUoYWRkcmVzcygwKSAhPSBfbHJjVG9rZW5BZGRyZXNzKTsKICAgICAgICByZXF1aXJlKGFkZHJlc3MoMCkgIT0gX3Rva2VuUmVnaXN0cnlBZGRyZXNzKTsKICAgICAgICByZXF1aXJlKGFkZHJlc3MoMCkgIT0gX2RlbGVnYXRlQWRkcmVzcyk7CgogICAgICAgIHJlcXVpcmUoX21heFJpbmdTaXplID4gMSk7CiAgICAgICAgcmVxdWlyZShfcmF0ZVJhdGlvQ1ZTVGhyZXNob2xkID4gMCk7CgogICAgICAgIGxyY1Rva2VuQWRkcmVzcyAgICAgICAgICAgICA9IF9scmNUb2tlbkFkZHJlc3M7CiAgICAgICAgdG9rZW5SZWdpc3RyeUFkZHJlc3MgICAgICAgID0gX3Rva2VuUmVnaXN0cnlBZGRyZXNzOwogICAgICAgIHJpbmdoYXNoUmVnaXN0cnlBZGRyZXNzICAgICA9IF9yaW5naGFzaFJlZ2lzdHJ5QWRkcmVzczsKICAgICAgICBkZWxlZ2F0ZUFkZHJlc3MgICAgICAgICAgICAgPSBfZGVsZWdhdGVBZGRyZXNzOwogICAgICAgIG1heFJpbmdTaXplICAgICAgICAgICAgICAgICA9IF9tYXhSaW5nU2l6ZTsKICAgICAgICByYXRlUmF0aW9DVlNUaHJlc2hvbGQgICAgICAgPSBfcmF0ZVJhdGlvQ1ZTVGhyZXNob2xkOwogICAgfQoKCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gUHVibGljIEZ1bmN0aW9ucyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8vCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBkZXYgRGlzYWJsZSBkZWZhdWx0IGZ1bmN0aW9uLgogICAgZnVuY3Rpb24gKCkgcGF5YWJsZSB7CiAgICAgICAgcmV2ZXJ0KCk7CiAgICB9CgogICAgLy8vIEBkZXYgU3VibWl0IGEgb3JkZXItcmluZyBmb3IgdmFsaWRhdGlvbiBhbmQgc2V0dGxlbWVudC4KICAgIC8vLyBAcGFyYW0gYWRkcmVzc0xpc3QgIExpc3Qgb2YgZWFjaCBvcmRlcidzIHRva2VuUy4gTm90ZSB0aGF0IG5leHQgb3JkZXIncwogICAgLy8vICAgICAgICAgICAgICAgICAgICAgYHRva2VuU2AgZXF1YWxzIHRoaXMgb3JkZXIncyBgdG9rZW5CYC4KICAgIC8vLyBAcGFyYW0gdWludEFyZ3NMaXN0IExpc3Qgb2YgdWludC10eXBlIGFyZ3VtZW50cyBpbiB0aGlzIG9yZGVyOgogICAgLy8vICAgICAgICAgICAgICAgICAgICAgYW1vdW50UywgYW1vdW50QiwgdGltZXN0YW1wLCB0dGwsIHNhbHQsIGxyY0ZlZSwKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIHJhdGVBbW91bnRTLgogICAgLy8vIEBwYXJhbSB1aW50OEFyZ3NMaXN0IC0KICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIExpc3Qgb2YgdW5pdDgtdHlwZSBhcmd1bWVudHMsIGluIHRoaXMgb3JkZXI6CiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBtYXJnaW5TcGxpdFBlcmNlbnRhZ2VMaXN0LGZlZVNlbGVjdGlvbkxpc3QuCiAgICAvLy8gQHBhcmFtIHZMaXN0ICAgICAgICBMaXN0IG9mIHYgZm9yIGVhY2ggb3JkZXIuIFRoaXMgbGlzdCBpcyAxLWxhcmdlciB0aGFuCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICB0aGUgcHJldmlvdXMgbGlzdHMsIHdpdGggdGhlIGxhc3QgZWxlbWVudCBiZWluZyB0aGUKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIHYgdmFsdWUgb2YgdGhlIHJpbmcgc2lnbmF0dXJlLgogICAgLy8vIEBwYXJhbSByTGlzdCAgICAgICAgTGlzdCBvZiByIGZvciBlYWNoIG9yZGVyLiBUaGlzIGxpc3QgaXMgMS1sYXJnZXIgdGhhbgogICAgLy8vICAgICAgICAgICAgICAgICAgICAgdGhlIHByZXZpb3VzIGxpc3RzLCB3aXRoIHRoZSBsYXN0IGVsZW1lbnQgYmVpbmcgdGhlCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICByIHZhbHVlIG9mIHRoZSByaW5nIHNpZ25hdHVyZS4KICAgIC8vLyBAcGFyYW0gc0xpc3QgICAgICAgIExpc3Qgb2YgcyBmb3IgZWFjaCBvcmRlci4gVGhpcyBsaXN0IGlzIDEtbGFyZ2VyIHRoYW4KICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIHRoZSBwcmV2aW91cyBsaXN0cywgd2l0aCB0aGUgbGFzdCBlbGVtZW50IGJlaW5nIHRoZQogICAgLy8vICAgICAgICAgICAgICAgICAgICAgcyB2YWx1ZSBvZiB0aGUgcmluZyBzaWduYXR1cmUuCiAgICAvLy8gQHBhcmFtIHJpbmdtaW5lciAgICBUaGUgYWRkcmVzcyB0aGF0IHNpZ25lZCB0aGlzIHR4LgogICAgLy8vIEBwYXJhbSBmZWVSZWNlcGllbnQgVGhlIHJlY2VwaWVudCBhZGRyZXNzIGZvciBmZWUgY29sbGVjdGlvbi4gSWYgdGhpcyBpcwogICAgLy8vICAgICAgICAgICAgICAgICAgICAgJzB4MCcsIGFsbCBmZWVzIHdpbGwgYmUgcGFpZCB0byB0aGUgYWRkcmVzcyB3aG8gaGFkCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBzaWduZWQgdGhpcyB0cmFuc2FjdGlvbiwgbm90IGBtc2cuc2VuZGVyYC4gTm90ZWQgaWYKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIExSQyBuZWVkIHRvIGJlIHBhaWQgYmFjayB0byBvcmRlciBvd25lciBhcyB0aGUgcmVzdWx0CiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBvZiBmZWUgc2VsZWN0aW9uIG1vZGVsLCBMUkMgd2lsbCBhbHNvIGJlIHNlbnQgZnJvbQogICAgLy8vICAgICAgICAgICAgICAgICAgICAgdGhpcyBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSB0aHJvd0lmTFJDSXNJbnN1ZmZjaWVudCAtCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBJZiB0cnVlLCB0aHJvdyBleGNlcHRpb24gaWYgYW55IG9yZGVyJ3Mgc3BlbmRhYmxlCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBMUkMgYW1vdW50IGlzIHNtYWxsZXIgdGhhbiByZXF1cmllZDsgaWYgZmFsc2UsIHJpbmctCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBtaW5vciB3aWxsIGdpdmUgdXAgY29sbGVjdGlvbiB0aGUgTFJDIGZlZS4KICAgIGZ1bmN0aW9uIHN1Ym1pdFJpbmcoCiAgICAgICAgYWRkcmVzc1syXVtdICAgIGFkZHJlc3NMaXN0LAogICAgICAgIHVpbnRbN11bXSAgICAgICB1aW50QXJnc0xpc3QsCiAgICAgICAgdWludDhbMl1bXSAgICAgIHVpbnQ4QXJnc0xpc3QsCiAgICAgICAgYm9vbFtdICAgICAgICAgIGJ1eU5vTW9yZVRoYW5BbW91bnRCTGlzdCwKICAgICAgICB1aW50OFtdICAgICAgICAgdkxpc3QsCiAgICAgICAgYnl0ZXMzMltdICAgICAgIHJMaXN0LAogICAgICAgIGJ5dGVzMzJbXSAgICAgICBzTGlzdCwKICAgICAgICBhZGRyZXNzICAgICAgICAgcmluZ21pbmVyLAogICAgICAgIGFkZHJlc3MgICAgICAgICBmZWVSZWNlcGllbnQsCiAgICAgICAgYm9vbCAgICAgICAgICAgIHRocm93SWZMUkNJc0luc3VmZmNpZW50CiAgICAgICAgKQogICAgICAgIHB1YmxpYyB7CgogICAgICAgICghZW50ZXJlZCkub3JUaHJvdygiYXR0ZXB0ZWQgdG8gcmUtZW50IHN1Ym1pdFJpbmcgZnVuY3Rpb24iKTsKICAgICAgICBlbnRlcmVkID0gdHJ1ZTsKCiAgICAgICAgLy9DaGVjayByaW5nIHNpemUKICAgICAgICB1aW50IHJpbmdTaXplID0gYWRkcmVzc0xpc3QubGVuZ3RoOwogICAgICAgIChyaW5nU2l6ZSA+IDEgJiYgcmluZ1NpemUgPD0gbWF4UmluZ1NpemUpCiAgICAgICAgICAgIC5vclRocm93KCJpbnZhbGlkIHJpbmcgc2l6ZSIpOwoKICAgICAgICB2ZXJpZnlJbnB1dERhdGFJbnRlZ3JpdHkoCiAgICAgICAgICAgIHJpbmdTaXplLAogICAgICAgICAgICBhZGRyZXNzTGlzdCwKICAgICAgICAgICAgdWludEFyZ3NMaXN0LAogICAgICAgICAgICB1aW50OEFyZ3NMaXN0LAogICAgICAgICAgICBidXlOb01vcmVUaGFuQW1vdW50Qkxpc3QsCiAgICAgICAgICAgIHZMaXN0LAogICAgICAgICAgICByTGlzdCwKICAgICAgICAgICAgc0xpc3QpOwoKICAgICAgICB2ZXJpZnlUb2tlbnNSZWdpc3RlcmVkKGFkZHJlc3NMaXN0KTsKCgogICAgICAgIHZhciByaW5naGFzaFJlZ2lzdHJ5ID0gUmluZ2hhc2hSZWdpc3RyeShyaW5naGFzaFJlZ2lzdHJ5QWRkcmVzcyk7CgogICAgICAgIGJ5dGVzMzIgcmluZ2hhc2ggPSByaW5naGFzaFJlZ2lzdHJ5LmNhbGN1bGF0ZVJpbmdoYXNoKAogICAgICAgICAgICByaW5nU2l6ZSwKICAgICAgICAgICAgLy8gZmVlUmVjZXBpZW50LAogICAgICAgICAgICAvLyB0aHJvd0lmTFJDSXNJbnN1ZmZjaWVudCwKICAgICAgICAgICAgdkxpc3QsCiAgICAgICAgICAgIHJMaXN0LAogICAgICAgICAgICBzTGlzdAogICAgICAgICk7CgogICAgICAgIHJpbmdoYXNoUmVnaXN0cnkuY2FuU3VibWl0KHJpbmdoYXNoLCBmZWVSZWNlcGllbnQpCiAgICAgICAgICAgIC5vclRocm93KCJSaW5nIGNsYWltZWQgYnkgb3RoZXJzIik7CgogICAgICAgIHZlcmlmeVNpZ25hdHVyZSgKICAgICAgICAgICAgcmluZ21pbmVyLAogICAgICAgICAgICByaW5naGFzaCwKICAgICAgICAgICAgdkxpc3RbcmluZ1NpemVdLAogICAgICAgICAgICByTGlzdFtyaW5nU2l6ZV0sCiAgICAgICAgICAgIHNMaXN0W3JpbmdTaXplXQogICAgICAgICk7CgogICAgICAgIC8vIEFzc2VtYmxlIGlucHV0IGRhdGEgaW50byBhIHN0cnVjdCBzbyB3ZSBjYW4gcGFzcyBpdCB0byBmdW5jdGlvbnMuCiAgICAgICAgdmFyIG9yZGVycyA9IGFzc2VtYmxlT3JkZXJzKAogICAgICAgICAgICByaW5nU2l6ZSwKICAgICAgICAgICAgYWRkcmVzc0xpc3QsCiAgICAgICAgICAgIHVpbnRBcmdzTGlzdCwKICAgICAgICAgICAgdWludDhBcmdzTGlzdCwKICAgICAgICAgICAgYnV5Tm9Nb3JlVGhhbkFtb3VudEJMaXN0LAogICAgICAgICAgICB2TGlzdCwKICAgICAgICAgICAgckxpc3QsCiAgICAgICAgICAgIHNMaXN0KTsKCiAgICAgICAgaWYgKGZlZVJlY2VwaWVudCA9PSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgIGZlZVJlY2VwaWVudCA9IHJpbmdtaW5lcjsKICAgICAgICB9CgogICAgICAgIGhhbmRsZVJpbmcoCiAgICAgICAgICAgIHJpbmdoYXNoLAogICAgICAgICAgICBvcmRlcnMsCiAgICAgICAgICAgIHJpbmdtaW5lciwKICAgICAgICAgICAgZmVlUmVjZXBpZW50LAogICAgICAgICAgICB0aHJvd0lmTFJDSXNJbnN1ZmZjaWVudAogICAgICAgICk7CgogICAgICAgIGVudGVyZWQgPSB0cnVlOwogICAgfQoKICAgIC8vLyBAZGV2IENhbmNlbCBhIG9yZGVyLiBBbW91bnQgKGFtb3VudFMgb3IgYW1vdW50QikgdG8gY2FuY2VsIGNhbiBiZQogICAgLy8vICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BlY2lmaWVkIHVzaW5nIG9yZGVyVmFsdWVzLgogICAgLy8vIEBwYXJhbSBhZGRyZXNzZXMgICAgICAgICAgb3duZXIsIHRva2VuUywgdG9rZW5CCiAgICAvLy8gQHBhcmFtIG9yZGVyVmFsdWVzICAgICAgICBhbW91bnRTLCBhbW91bnRCLCB0aW1lc3RhbXAsIHR0bCwgc2FsdCwKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgICAgICAgIGxyY0ZlZSwgYW5kIGNhbmNlbEFtb3VudAogICAgLy8vIEBwYXJhbSBidXlOb01vcmVUaGFuQW1vdW50QiAtCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICAgICAgICBJZiB0cnVlLCB0aGlzIG9yZGVyIGRvZXMgbm90IGFjY2VwdCBidXlpbmcKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vcmUgdGhhbiBgYW1vdW50QmAuCiAgICAvLy8gQHBhcmFtIG1hcmdpblNwbGl0UGVyY2VudGFnZSAtCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICAgICAgICBUaGUgcGVyY2VudGFnZSBvZiBtYXJnaW4gcGFpZCB0byBtaW5lci4KICAgIC8vLyBAcGFyYW0gdiAgICAgICAgICAgICAgICAgIE9yZGVyIEVDRFNBIHNpZ25hdHVyZSBwYXJhbWV0ZXIgdi4KICAgIC8vLyBAcGFyYW0gciAgICAgICAgICAgICAgICAgIE9yZGVyIEVDRFNBIHNpZ25hdHVyZSBwYXJhbWV0ZXJzIHIuCiAgICAvLy8gQHBhcmFtIHMgICAgICAgICAgICAgICAgICBPcmRlciBFQ0RTQSBzaWduYXR1cmUgcGFyYW1ldGVycyBzLgogICAgZnVuY3Rpb24gY2FuY2VsT3JkZXIoCiAgICAgICAgYWRkcmVzc1szXSBhZGRyZXNzZXMsCiAgICAgICAgdWludFs3XSAgICBvcmRlclZhbHVlcywKICAgICAgICBib29sICAgICAgIGJ1eU5vTW9yZVRoYW5BbW91bnRCLAogICAgICAgIHVpbnQ4ICAgICAgbWFyZ2luU3BsaXRQZXJjZW50YWdlLAogICAgICAgIHVpbnQ4ICAgICAgdiwKICAgICAgICBieXRlczMyICAgIHIsCiAgICAgICAgYnl0ZXMzMiAgICBzCiAgICAgICAgKQogICAgICAgIHB1YmxpYyB7CgogICAgICAgIHVpbnQgY2FuY2VsQW1vdW50ID0gb3JkZXJWYWx1ZXNbNl07CiAgICAgICAgKGNhbmNlbEFtb3VudCA+IDApLm9yVGhyb3coImFtb3VudCB0byBjYW5jZWwgaXMgemVybyIpOwoKICAgICAgICB2YXIgb3JkZXIgPSBPcmRlcigKICAgICAgICAgICAgYWRkcmVzc2VzWzBdLAogICAgICAgICAgICBhZGRyZXNzZXNbMV0sCiAgICAgICAgICAgIGFkZHJlc3Nlc1syXSwKICAgICAgICAgICAgb3JkZXJWYWx1ZXNbMF0sCiAgICAgICAgICAgIG9yZGVyVmFsdWVzWzFdLAogICAgICAgICAgICBvcmRlclZhbHVlc1syXSwKICAgICAgICAgICAgb3JkZXJWYWx1ZXNbM10sCiAgICAgICAgICAgIG9yZGVyVmFsdWVzWzRdLAogICAgICAgICAgICBvcmRlclZhbHVlc1s1XSwKICAgICAgICAgICAgYnV5Tm9Nb3JlVGhhbkFtb3VudEIsCiAgICAgICAgICAgIG1hcmdpblNwbGl0UGVyY2VudGFnZSwKICAgICAgICAgICAgdiwKICAgICAgICAgICAgciwKICAgICAgICAgICAgcwogICAgICAgICk7CgogICAgICAgIGJ5dGVzMzIgb3JkZXJIYXNoID0gY2FsY3VsYXRlT3JkZXJIYXNoKG9yZGVyKTsKICAgICAgICBjYW5jZWxsZWRbb3JkZXJIYXNoXSA9IGNhbmNlbGxlZFtvcmRlckhhc2hdLmFkZChjYW5jZWxBbW91bnQpOwoKICAgICAgICBPcmRlckNhbmNlbGxlZCgKICAgICAgICAgICAgYmxvY2sudGltZXN0YW1wLAogICAgICAgICAgICBibG9jay5udW1iZXIsCiAgICAgICAgICAgIG9yZGVySGFzaCwKICAgICAgICAgICAgY2FuY2VsQW1vdW50CiAgICAgICAgKTsKICAgIH0KCgogICAgLy8vIEBkZXYgICBTZXQgYSBjdXRvZmYgdGltZXN0YW1wIHRvIGludmFsaWRhdGUgYWxsIG9yZGVycyB3aG9zZSB0aW1lc3RhbXAKICAgIC8vLyAgICAgICAgaXMgc21hbGxlciB0aGFuIG9yIGVxdWFsIHRvIHRoZSBuZXcgdmFsdWUgb2YgdGhlIGFkZHJlc3MncyBjdXRvZmYKICAgIC8vLyAgICAgICAgdGltZXN0YW1wLgogICAgLy8vIEBwYXJhbSBjdXRvZmYgVGhlIGN1dG9mZiB0aW1lc3RhbXAsIHdpbGwgZGVmYXVsdCB0byBgYmxvY2sudGltZXN0YW1wYAogICAgLy8vICAgICAgICBpZiBpdCBpcyAwLgogICAgZnVuY3Rpb24gc2V0Q3V0b2ZmKHVpbnQgY3V0b2ZmKSBwdWJsaWMgewogICAgICAgIHVpbnQgdCA9IGN1dG9mZjsKICAgICAgICBpZiAodCA9PSAwKSB7CiAgICAgICAgICAgIHQgPSBibG9jay50aW1lc3RhbXA7CiAgICAgICAgfQoKICAgICAgICAoY3V0b2Zmc1ttc2cuc2VuZGVyXSA8IHQpCiAgICAgICAgICAgIC5vclRocm93KCJhdHRlbXB0ZWQgdG8gc2V0IGN1dG9mZiB0byBhIHNtYWxsZXIgdmFsdWUiKTsKCiAgICAgICAgY3V0b2Zmc1ttc2cuc2VuZGVyXSA9IHQ7CgogICAgICAgIEN1dG9mZlRpbWVzdGFtcENoYW5nZWQoCiAgICAgICAgICAgIGJsb2NrLnRpbWVzdGFtcCwKICAgICAgICAgICAgYmxvY2subnVtYmVyLAogICAgICAgICAgICBtc2cuc2VuZGVyLAogICAgICAgICAgICB0CiAgICAgICAgKTsKICAgIH0KCgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIEludGVybmFsICYgUHJpdmF0ZSBGdW5jdGlvbnMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vLwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAZGV2IFZhbGlkYXRlIGEgcmluZy4KICAgIGZ1bmN0aW9uIHZlcmlmeVJpbmdIYXNOb1N1YlJpbmcoUmluZyByaW5nKQogICAgICAgIGludGVybmFsCiAgICAgICAgY29uc3RhbnQgewoKICAgICAgICB1aW50IHJpbmdTaXplID0gcmluZy5vcmRlcnMubGVuZ3RoOwogICAgICAgIC8vIENoZWNrIHRoZSByaW5nIGhhcyBubyBzdWItcmluZy4KICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCByaW5nU2l6ZSAtMTsgaSsrKSB7CiAgICAgICAgICAgIGFkZHJlc3MgdG9rZW5TID0gcmluZy5vcmRlcnNbaV0ub3JkZXIudG9rZW5TOwogICAgICAgICAgICBmb3IgKHVpbnQgaiA9IGkgKyAxOyBqIDwgcmluZ1NpemU7IGorKyl7CiAgICAgICAgICAgICAgICAgKHRva2VuUyAhPSByaW5nLm9yZGVyc1tqXS5vcmRlci50b2tlblMpCiAgICAgICAgICAgICAgICAgICAgLm9yVGhyb3coImZvdW5kIHN1Yi1yaW5nIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gdmVyaWZ5VG9rZW5zUmVnaXN0ZXJlZChhZGRyZXNzWzJdW10gYWRkcmVzc0xpc3QpIGludGVybmFsIGNvbnN0YW50IHsKICAgICAgICB2YXIgcmVnaXN0cnlDb250cmFjdCA9IFRva2VuUmVnaXN0cnkodG9rZW5SZWdpc3RyeUFkZHJlc3MpOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGFkZHJlc3NMaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHJlZ2lzdHJ5Q29udHJhY3QuaXNUb2tlblJlZ2lzdGVyZWQoYWRkcmVzc0xpc3RbaV1bMV0pCiAgICAgICAgICAgICAgICAub3JUaHJvdygidG9rZW4gbm90IHJlZ2lzdGVyZWQiKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gaGFuZGxlUmluZygKICAgICAgICBieXRlczMyIHJpbmdoYXNoLAogICAgICAgIE9yZGVyU3RhdGVbXSBvcmRlcnMsCiAgICAgICAgYWRkcmVzcyBtaW5lciwKICAgICAgICBhZGRyZXNzIGZlZVJlY2VwaWVudCwKICAgICAgICBib29sIHRocm93SWZMUkNJc0luc3VmZmNpZW50CiAgICAgICAgKQogICAgICAgIGludGVybmFsIHsKICAgICAgICB2YXIgcmluZyA9IFJpbmcoCiAgICAgICAgICAgIHJpbmdoYXNoLAogICAgICAgICAgICBvcmRlcnMsCiAgICAgICAgICAgIG1pbmVyLAogICAgICAgICAgICBmZWVSZWNlcGllbnQsCiAgICAgICAgICAgIHRocm93SWZMUkNJc0luc3VmZmNpZW50KTsKCiAgICAgICAgLy8gRG8gdGhlIGhhcmQgd29yay4KICAgICAgICB2ZXJpZnlSaW5nSGFzTm9TdWJSaW5nKHJpbmcpOwoKICAgICAgICAvLyBFeGNoYW5nZSByYXRlcyBjYWxjdWxhdGlvbiBhcmUgcGVyZm9ybWVkIGJ5IHJpbmctbWluZXJzIGFzIHNvbGlkaXR5CiAgICAgICAgLy8gY2Fubm90IGdldCBwb3dlci1vZi0xL24gb3BlcmF0aW9uLCB0aGVyZWZvcmUgd2UgaGF2ZSB0byB2ZXJpZnkKICAgICAgICAvLyB0aGVzZSByYXRlcyBhcmUgY29ycmVjdC4KICAgICAgICB2ZXJpZnlNaW5lclN1cHBsaWVkRmlsbFJhdGVzKHJpbmcpOwoKICAgICAgICAvLyBTY2FsZSBkb3duIGVhY2ggb3JkZXIgaW5kZXBlbmRlbnRseSBieSBzdWJzdHJhY3RpbmcgYW1vdW50LWZpbGxlZCBhbmQKICAgICAgICAvLyBhbW91bnQtY2FuY2VsbGVkLiBPcmRlciBvd25lcidzIGN1cnJlbnQgYmFsYW5jZSBhbmQgYWxsb3dhbmNlIGFyZQogICAgICAgIC8vIG5vdCB0YWtlbiBpbnRvIGNvbnNpZGVyYXRpb24gaW4gdGhlc2Ugb3BlcmF0aW9ucy4KICAgICAgICBzY2FsZVJpbmdCYXNlZE9uSGlzdG9yaWNhbFJlY29yZHMocmluZyk7CgogICAgICAgIC8vIEJhc2VkIG9uIHRoZSBhbHJlYWR5IHZlcmlmaWVkIGV4Y2hhbmdlIHJhdGUgcHJvdmlkZWQgYnkgcmluZy1taW5lcnMsCiAgICAgICAgLy8gd2UgY2FuIGZ1cnRodXIgc2NhbGUgZG93biBvcmRlcnMgYmFzZWQgb24gdG9rZW4gYmFsYW5jZSBhbmQgYWxsb3dhbmNlLAogICAgICAgIC8vIHRoZW4gZmluZCB0aGUgc21hbGxlc3Qgb3JkZXIgb2YgdGhlIHJpbmcsIHRoZW4gY2FsY3VsYXRlIGVhY2ggb3JkZXIncwogICAgICAgIC8vIGBmaWxsQW1vdW50U2AuCiAgICAgICAgY2FsY3VsYXRlUmluZ0ZpbGxBbW91bnQocmluZyk7CgogICAgICAgIC8vIENhbGN1bGF0ZSBlYWNoIG9yZGVyJ3MgYGxyY0ZlZWAgYW5kIGBscmNSZXdyYXJkYCBhbmQgc3BsaWN0IGhvdyBtdWNoCiAgICAgICAgLy8gb2YgYGZpbGxBbW91bnRTYCBzaGFsbCBiZSBwYWlkIHRvIG1hdGNoaW5nIG9yZGVyIG9yIG1pbmVyIGFzIG1hcmdpbgogICAgICAgIC8vIHNwbGl0LgogICAgICAgIGNhbGN1bGF0ZVJpbmdGZWVzKHJpbmcpOwoKICAgICAgICAvLy8gTWFrZSBwYXltZW50cy4KICAgICAgICBzZXR0bGVSaW5nKHJpbmcpOwoKICAgICAgICBSaW5nTWluZWQoCiAgICAgICAgICAgIHJpbmdJbmRleCsrLAogICAgICAgICAgICBibG9jay50aW1lc3RhbXAsCiAgICAgICAgICAgIGJsb2NrLm51bWJlciwKICAgICAgICAgICAgcmluZy5yaW5naGFzaCwKICAgICAgICAgICAgcmluZy5taW5lciwKICAgICAgICAgICAgcmluZy5mZWVSZWNlcGllbnQsCiAgICAgICAgICAgIFJpbmdoYXNoUmVnaXN0cnkocmluZ2hhc2hSZWdpc3RyeUFkZHJlc3MpLnJpbmdoYXNoRm91bmQocmluZy5yaW5naGFzaCkKICAgICAgICAgICAgKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXR0bGVSaW5nKFJpbmcgcmluZykgaW50ZXJuYWwgewogICAgICAgIHVpbnQgcmluZ1NpemUgPSByaW5nLm9yZGVycy5sZW5ndGg7CiAgICAgICAgdmFyIGRlbGVnYXRlID0gVG9rZW5UcmFuc2ZlckRlbGVnYXRlKGRlbGVnYXRlQWRkcmVzcyk7CgogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHJpbmdTaXplOyBpKyspIHsKICAgICAgICAgICAgdmFyIHN0YXRlID0gcmluZy5vcmRlcnNbaV07CiAgICAgICAgICAgIHZhciBwcmV2ID0gcmluZy5vcmRlcnNbaS5wcmV2KHJpbmdTaXplKV07CiAgICAgICAgICAgIHZhciBuZXh0ID0gcmluZy5vcmRlcnNbaS5uZXh0KHJpbmdTaXplKV07CgogICAgICAgICAgICAvLyBQYXkgdG9rZW5TIHRvIHByZXZpb3VzIG9yZGVyLCBvciB0byBtaW5lciBhcyBwcmV2aW91cyBvcmRlcidzCiAgICAgICAgICAgIC8vIG1hcmdpbiBzcGxpdCBvci9hbmQgdGhpcyBvcmRlcidzIG1hcmdpbiBzcGxpdC4KCiAgICAgICAgICAgIGRlbGVnYXRlLnRyYW5zZmVyVG9rZW4oCiAgICAgICAgICAgICAgICBzdGF0ZS5vcmRlci50b2tlblMsCiAgICAgICAgICAgICAgICBzdGF0ZS5vcmRlci5vd25lciwKICAgICAgICAgICAgICAgIHByZXYub3JkZXIub3duZXIsCiAgICAgICAgICAgICAgICBzdGF0ZS5maWxsQW1vdW50UyAtIHByZXYuc3BsaXRCKTsKCiAgICAgICAgICAgIGlmIChwcmV2LnNwbGl0QiArIHN0YXRlLnNwbGl0UyA+IDApIHsKICAgICAgICAgICAgICAgIGRlbGVnYXRlLnRyYW5zZmVyVG9rZW4oCiAgICAgICAgICAgICAgICAgICAgc3RhdGUub3JkZXIudG9rZW5TLAogICAgICAgICAgICAgICAgICAgIHN0YXRlLm9yZGVyLm93bmVyLAogICAgICAgICAgICAgICAgICAgIHJpbmcuZmVlUmVjZXBpZW50LAogICAgICAgICAgICAgICAgICAgIHByZXYuc3BsaXRCICsgc3RhdGUuc3BsaXRTKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gUGF5IExSQwogICAgICAgICAgICBpZiAoc3RhdGUubHJjUmV3YXJkID4gMCkgewogICAgICAgICAgICAgICAgZGVsZWdhdGUudHJhbnNmZXJUb2tlbigKICAgICAgICAgICAgICAgICAgICBscmNUb2tlbkFkZHJlc3MsCiAgICAgICAgICAgICAgICAgICAgcmluZy5mZWVSZWNlcGllbnQsCiAgICAgICAgICAgICAgICAgICAgc3RhdGUub3JkZXIub3duZXIsCiAgICAgICAgICAgICAgICAgICAgc3RhdGUubHJjUmV3YXJkKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHN0YXRlLmxyY0ZlZSA+IDApIHsKICAgICAgICAgICAgICAgICBkZWxlZ2F0ZS50cmFuc2ZlclRva2VuKAogICAgICAgICAgICAgICAgICAgIGxyY1Rva2VuQWRkcmVzcywKICAgICAgICAgICAgICAgICAgICBzdGF0ZS5vcmRlci5vd25lciwKICAgICAgICAgICAgICAgICAgICByaW5nLmZlZVJlY2VwaWVudCwKICAgICAgICAgICAgICAgICAgICBzdGF0ZS5scmNGZWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBVcGRhdGUgZmlsbCByZWNvcmRzCiAgICAgICAgICAgIGlmIChzdGF0ZS5vcmRlci5idXlOb01vcmVUaGFuQW1vdW50QikgewogICAgICAgICAgICAgICAgZmlsbGVkW3N0YXRlLm9yZGVySGFzaF0gKz0gbmV4dC5maWxsQW1vdW50UzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGZpbGxlZFtzdGF0ZS5vcmRlckhhc2hdICs9IHN0YXRlLmZpbGxBbW91bnRTOwogICAgICAgICAgICB9CgogICAgICAgICAgICBPcmRlckZpbGxlZCgKICAgICAgICAgICAgICAgIHJpbmdJbmRleCwKICAgICAgICAgICAgICAgIGJsb2NrLnRpbWVzdGFtcCwKICAgICAgICAgICAgICAgIGJsb2NrLm51bWJlciwKICAgICAgICAgICAgICAgIHJpbmcucmluZ2hhc2gsCiAgICAgICAgICAgICAgICBwcmV2Lm9yZGVySGFzaCwKICAgICAgICAgICAgICAgIHN0YXRlLm9yZGVySGFzaCwKICAgICAgICAgICAgICAgIG5leHQub3JkZXJIYXNoLAogICAgICAgICAgICAgICAgc3RhdGUuZmlsbEFtb3VudFMgKyBzdGF0ZS5zcGxpdFMsCiAgICAgICAgICAgICAgICBuZXh0LmZpbGxBbW91bnRTIC0gc3RhdGUuc3BsaXRCLAogICAgICAgICAgICAgICAgc3RhdGUubHJjUmV3YXJkLAogICAgICAgICAgICAgICAgc3RhdGUubHJjRmVlCiAgICAgICAgICAgICAgICApOwogICAgICAgIH0KCiAgICB9CgogICAgZnVuY3Rpb24gdmVyaWZ5TWluZXJTdXBwbGllZEZpbGxSYXRlcyhSaW5nIHJpbmcpIGludGVybmFsIGNvbnN0YW50IHsKICAgICAgICB2YXIgb3JkZXJzID0gcmluZy5vcmRlcnM7CiAgICAgICAgdWludCByaW5nU2l6ZSA9IG9yZGVycy5sZW5ndGg7CiAgICAgICAgdWludFtdIG1lbW9yeSByYXRlUmF0aW9zID0gbmV3IHVpbnRbXShyaW5nU2l6ZSk7CgogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHJpbmdTaXplOyBpKyspIHsKICAgICAgICAgICAgdWludCByYXRlQW1vdW50QiA9IG9yZGVyc1tpLm5leHQocmluZ1NpemUpXS5yYXRlQW1vdW50UzsKCiAgICAgICAgICAgIHVpbnQgczFiMCA9IG9yZGVyc1tpXS5yYXRlQW1vdW50Uy5tdWwob3JkZXJzW2ldLm9yZGVyLmFtb3VudEIpOwogICAgICAgICAgICB1aW50IHMwYjEgPSBvcmRlcnNbaV0ub3JkZXIuYW1vdW50Uy5tdWwocmF0ZUFtb3VudEIpOwoKICAgICAgICAgICAgKHMxYjAgPD0gczBiMSkKICAgICAgICAgICAgICAgIC5vclRocm93KCJtaW5lciBzdXBwbGllZCBleGNoYW5nZSByYXRlIHByb3ZpZGVzIGludmFsaWQgZGlzY291bnQiKTsKCiAgICAgICAgICAgIHJhdGVSYXRpb3NbaV0gPSBSQVRFX1JBVElPX1NDQUxFLm11bChzMWIwKS5kaXYoczBiMSk7CiAgICAgICAgfQoKICAgICAgICB1aW50IGN2cyA9IFVpbnRMaWIuY3ZzcXVhcmUocmF0ZVJhdGlvcywgUkFURV9SQVRJT19TQ0FMRSk7CgogICAgICAgIChjdnMgPD0gcmF0ZVJhdGlvQ1ZTVGhyZXNob2xkKQogICAgICAgICAgICAub3JUaHJvdygibWluZXIgc3VwcGxpZWQgZXhjaGFuZ2UgcmF0ZSBpcyBub3QgZXZlbmx5IGRpc2NvdW50ZWQiKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVSaW5nRmVlcyhSaW5nIHJpbmcpIGludGVybmFsIGNvbnN0YW50IHsKICAgICAgICB1aW50IG1pbmVyTHJjU3BlbmRhYmxlID0gZ2V0TFJDU3BlbmRhYmxlKHJpbmcuZmVlUmVjZXBpZW50KTsKICAgICAgICB1aW50IHJpbmdTaXplID0gcmluZy5vcmRlcnMubGVuZ3RoOwoKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCByaW5nU2l6ZTsgaSsrKSB7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IHJpbmcub3JkZXJzW2ldOwogICAgICAgICAgICB2YXIgbmV4dCA9IHJpbmcub3JkZXJzW2kubmV4dChyaW5nU2l6ZSldOwoKICAgICAgICAgICAgaWYgKHN0YXRlLmZlZVNlbGVjdGlvbiA9PSBGRUVfU0VMRUNUX0xSQykgewoKICAgICAgICAgICAgICAgIHVpbnQgbHJjU3BlbmRhYmxlID0gZ2V0TFJDU3BlbmRhYmxlKHN0YXRlLm9yZGVyLm93bmVyKTsKCiAgICAgICAgICAgICAgICBpZiAobHJjU3BlbmRhYmxlIDwgc3RhdGUubHJjRmVlKSB7CiAgICAgICAgICAgICAgICAgICAgKCFyaW5nLnRocm93SWZMUkNJc0luc3VmZmNpZW50KQogICAgICAgICAgICAgICAgICAgICAgICAub3JUaHJvdygib3JkZXIgTFJDIGJhbGFuY2UgaW5zdWZmY2llbnQiKTsKCiAgICAgICAgICAgICAgICAgICAgc3RhdGUubHJjRmVlID0gbHJjU3BlbmRhYmxlOwogICAgICAgICAgICAgICAgICAgIG1pbmVyTHJjU3BlbmRhYmxlICs9IGxyY1NwZW5kYWJsZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdGUuZmVlU2VsZWN0aW9uID09IEZFRV9TRUxFQ1RfTUFSR0lOX1NQTElUKSB7CiAgICAgICAgICAgICAgICBpZiAobWluZXJMcmNTcGVuZGFibGUgPj0gc3RhdGUubHJjRmVlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLm9yZGVyLmJ1eU5vTW9yZVRoYW5BbW91bnRCKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgc3BsaXRTID0gbmV4dC5maWxsQW1vdW50UwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLm11bChzdGF0ZS5vcmRlci5hbW91bnRTKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmRpdihzdGF0ZS5vcmRlci5hbW91bnRCKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnN1YihzdGF0ZS5maWxsQW1vdW50Uyk7CgogICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5zcGxpdFMgPSBzcGxpdFMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5tdWwoc3RhdGUub3JkZXIubWFyZ2luU3BsaXRQZXJjZW50YWdlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmRpdihNQVJHSU5fU1BMSVRfUEVSQ0VOVEFHRV9CQVNFKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB1aW50IHNwbGl0QiA9IG5leHQuZmlsbEFtb3VudFMuc3ViKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUuZmlsbEFtb3VudFMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAubXVsKHN0YXRlLm9yZGVyLmFtb3VudEIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmRpdihzdGF0ZS5vcmRlci5hbW91bnRTKSk7CgogICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5zcGxpdEIgPSBzcGxpdEIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5tdWwoc3RhdGUub3JkZXIubWFyZ2luU3BsaXRQZXJjZW50YWdlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmRpdihNQVJHSU5fU1BMSVRfUEVSQ0VOVEFHRV9CQVNFKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaW1wbGljaXRzIG9yZGVyIHdpdGggc21hbGxlciBpbmRleCBpbiB0aGUgcmluZyB3aWxsCiAgICAgICAgICAgICAgICAgICAgLy8gYmUgcGFpZCBMUkMgcmV3YXJkIGZpcnN0LCBzbyB0aGUgb3JkZXJzIGluIHRoZSByaW5nIGRvZXMKICAgICAgICAgICAgICAgICAgICAvLyBtYXRlci4KICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdGUuc3BsaXRTID4gMCB8fCBzdGF0ZS5zcGxpdEIgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1pbmVyTHJjU3BlbmRhYmxlID0gbWluZXJMcmNTcGVuZGFibGUuc3ViKHN0YXRlLmxyY0ZlZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLmxyY1Jld2FyZCA9IHN0YXRlLmxyY0ZlZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgc3RhdGUubHJjRmVlID0gMDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIEVycm9yTGliLmVycm9yKCJ1bnN1cHBvcnRlZCBmZWUgc2VsZWN0aW9uIHZhbHVlIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgfQoKICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZVJpbmdGaWxsQW1vdW50KFJpbmcgcmluZykgaW50ZXJuYWwgY29uc3RhbnQgewoKICAgICAgICB1aW50IHJpbmdTaXplID0gcmluZy5vcmRlcnMubGVuZ3RoOwogICAgICAgIHVpbnQgc21hbGxlc3RJZHggPSAwOwogICAgICAgIHVpbnQgaTsKICAgICAgICB1aW50IGo7CgogICAgICAgIGZvciAoaSA9IDA7IGkgPCByaW5nU2l6ZTsgaSsrKSB7CiAgICAgICAgICAgIGogPSBpLm5leHQocmluZy5vcmRlcnMubGVuZ3RoKTsKCiAgICAgICAgICAgIHVpbnQgcmVzID0gY2FsY3VsYXRlT3JkZXJGaWxsQW1vdW50KAogICAgICAgICAgICAgICAgcmluZy5vcmRlcnNbaV0sCiAgICAgICAgICAgICAgICByaW5nLm9yZGVyc1tqXSk7CgogICAgICAgICAgICBpZiAocmVzID09IDEpIHNtYWxsZXN0SWR4ID0gaTsKICAgICAgICAgICAgZWxzZSBpZiAocmVzID09IDIpIHNtYWxsZXN0SWR4ID0gajsKICAgICAgICB9CgogICAgICAgIGZvciAoaSA9IDA7IGkgPCBzbWFsbGVzdElkeDsgaSsrKSB7CiAgICAgICAgICAgIGogPSBpLm5leHQocmluZy5vcmRlcnMubGVuZ3RoKTsKICAgICAgICAgICAgKGNhbGN1bGF0ZU9yZGVyRmlsbEFtb3VudChyaW5nLm9yZGVyc1tpXSwgcmluZy5vcmRlcnNbal0pID09IDApCiAgICAgICAgICAgICAgICAub3JUaHJvdygidW5leHBlY3RlZCBleGNlcHRpb24gaW4gY2FsY3VsYXRlUmluZ0ZpbGxBbW91bnQiKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEByZXR1cm4gMCBpZiBuZWl0aGVyIG9yZGVyIGlzIHRoZSBzbWFsbGVzdCBvbmU7CiAgICAvLy8gICAgICAgICAxIGlmICdzdGF0ZScgaXMgdGhlIHNtYWxsZXN0IG9yZGVyOwogICAgLy8vICAgICAgICAgMiBpZiAnbmV4dCcgaXMgdGhlIHNtYWxsZXN0IG9yZGVyLgogICAgZnVuY3Rpb24gY2FsY3VsYXRlT3JkZXJGaWxsQW1vdW50KAogICAgICAgIE9yZGVyU3RhdGUgc3RhdGUsCiAgICAgICAgT3JkZXJTdGF0ZSBuZXh0CiAgICAgICAgKQogICAgICAgIGludGVybmFsCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50IHN0YXRlMklzU21hbGxlcikgewoKICAgICAgICAvLyBVcGRhdGUgdGhlIGFtb3VudCBvZiB0b2tlbkIgdGhpcyBvcmRlciBjYW4gYnV5LCB3aG9zZSBsb2dpYyBjb3VsZCBiZQogICAgICAgIC8vIGEgYnJhaW4tYnVybmVyOgogICAgICAgIC8vIFdlIGhhdmUgYGZpbGxBbW91bnRCIC8gc3RhdGUuZmlsbEFtb3VudFMgPSBzdGF0ZS5yYXRlQW1vdW50QiAvIHN0YXRlLnJhdGVBbW91bnRTYCwKICAgICAgICAvLyB0aGVyZWZvcmUsIGBmaWxsQW1vdW50QiA9IHN0YXRlLnJhdGVBbW91bnRCICogc3RhdGUuZmlsbEFtb3VudFMgLyBzdGF0ZS5yYXRlQW1vdW50U2AsCiAgICAgICAgLy8gdGhlcmVmb3JlICBgZmlsbEFtb3VudEIgPSBuZXh0LnJhdGVBbW91bnRTICogc3RhdGUuZmlsbEFtb3VudFMgLyBzdGF0ZS5yYXRlQW1vdW50U2AsCiAgICAgICAgdWludCBmaWxsQW1vdW50QiAgPSBuZXh0LnJhdGVBbW91bnRTCiAgICAgICAgICAgIC5tdWwoc3RhdGUuZmlsbEFtb3VudFMpCiAgICAgICAgICAgIC5kaXYoc3RhdGUucmF0ZUFtb3VudFMpOwoKICAgICAgICBpZiAoc3RhdGUub3JkZXIuYnV5Tm9Nb3JlVGhhbkFtb3VudEIpIHsKICAgICAgICAgICAgaWYgKGZpbGxBbW91bnRCID4gc3RhdGUub3JkZXIuYW1vdW50QikgewogICAgICAgICAgICAgICAgZmlsbEFtb3VudEIgPSBzdGF0ZS5vcmRlci5hbW91bnRCOwoKICAgICAgICAgICAgICAgIHN0YXRlLmZpbGxBbW91bnRTID0gc3RhdGUucmF0ZUFtb3VudFMKICAgICAgICAgICAgICAgICAgICAubXVsKGZpbGxBbW91bnRCKQogICAgICAgICAgICAgICAgICAgIC5kaXYobmV4dC5yYXRlQW1vdW50Uyk7CgogICAgICAgICAgICAgICAgc3RhdGUySXNTbWFsbGVyID0gMTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc3RhdGUubHJjRmVlID0gc3RhdGUub3JkZXIubHJjRmVlCiAgICAgICAgICAgICAgICAubXVsKGZpbGxBbW91bnRCKQogICAgICAgICAgICAgICAgLmRpdihuZXh0Lm9yZGVyLmFtb3VudFMpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN0YXRlLmxyY0ZlZSA9IHN0YXRlLm9yZGVyLmxyY0ZlZQogICAgICAgICAgICAgICAgLm11bChzdGF0ZS5maWxsQW1vdW50UykKICAgICAgICAgICAgICAgIC5kaXYoc3RhdGUub3JkZXIuYW1vdW50Uyk7CiAgICAgICAgfQoKICAgICAgICBpZiAoZmlsbEFtb3VudEIgPD0gbmV4dC5maWxsQW1vdW50UykgewogICAgICAgICAgICBuZXh0LmZpbGxBbW91bnRTID0gZmlsbEFtb3VudEI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3RhdGUySXNTbWFsbGVyID0gMjsKICAgICAgICB9CiAgICB9CgoKICAgIC8vLyBAZGV2IFNjYWxlIGRvd24gYWxsIG9yZGVycyBiYXNlZCBvbiBoaXN0b3JpY2FsIGZpbGwgb3IgY2FuY2VsbGF0aW9uCiAgICAvLy8gICAgICBzdGF0cyBidXQga2V5IHRoZSBvcmRlcidzIG9yaWdpbmFsIGV4Y2hhbmdlIHJhdGUuCiAgICBmdW5jdGlvbiBzY2FsZVJpbmdCYXNlZE9uSGlzdG9yaWNhbFJlY29yZHMoUmluZyByaW5nKSBpbnRlcm5hbCBjb25zdGFudCB7CgogICAgICAgIHVpbnQgcmluZ1NpemUgPSByaW5nLm9yZGVycy5sZW5ndGg7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgcmluZ1NpemU7IGkrKykgewogICAgICAgICAgICB2YXIgc3RhdGUgPSByaW5nLm9yZGVyc1tpXTsKICAgICAgICAgICAgdmFyIG9yZGVyID0gc3RhdGUub3JkZXI7CgogICAgICAgICAgICBpZiAob3JkZXIuYnV5Tm9Nb3JlVGhhbkFtb3VudEIpIHsKICAgICAgICAgICAgICAgIHVpbnQgYW1vdW50QiA9IG9yZGVyLmFtb3VudEIKICAgICAgICAgICAgICAgICAgICAuc3ViKGZpbGxlZFtzdGF0ZS5vcmRlckhhc2hdKQogICAgICAgICAgICAgICAgICAgIC50b2xlcmFudFN1YihjYW5jZWxsZWRbc3RhdGUub3JkZXJIYXNoXSk7CgogICAgICAgICAgICAgICAgb3JkZXIuYW1vdW50UyA9IGFtb3VudEIubXVsKG9yZGVyLmFtb3VudFMpLmRpdihvcmRlci5hbW91bnRCKTsKICAgICAgICAgICAgICAgIG9yZGVyLmxyY0ZlZSA9IGFtb3VudEIubXVsKG9yZGVyLmxyY0ZlZSkuZGl2KG9yZGVyLmFtb3VudEIpOwoKICAgICAgICAgICAgICAgIG9yZGVyLmFtb3VudEIgPSBhbW91bnRCOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdWludCBhbW91bnRTID0gb3JkZXIuYW1vdW50UwogICAgICAgICAgICAgICAgICAgIC5zdWIoZmlsbGVkW3N0YXRlLm9yZGVySGFzaF0pCiAgICAgICAgICAgICAgICAgICAgLnRvbGVyYW50U3ViKGNhbmNlbGxlZFtzdGF0ZS5vcmRlckhhc2hdKTsKCiAgICAgICAgICAgICAgICBvcmRlci5hbW91bnRCID0gYW1vdW50Uy5tdWwob3JkZXIuYW1vdW50QikuZGl2KG9yZGVyLmFtb3VudFMpOwogICAgICAgICAgICAgICAgb3JkZXIubHJjRmVlID0gYW1vdW50Uy5tdWwob3JkZXIubHJjRmVlKS5kaXYob3JkZXIuYW1vdW50Uyk7CgogICAgICAgICAgICAgICAgb3JkZXIuYW1vdW50UyA9IGFtb3VudFM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIChvcmRlci5hbW91bnRTID4gMCkub3JUaHJvdygiYW1vdW50UyBpcyB6ZXJvIik7CiAgICAgICAgICAgIChvcmRlci5hbW91bnRCID4gMCkub3JUaHJvdygiYW1vdW50QiBpcyB6ZXJvIik7CgogICAgICAgICAgICBzdGF0ZS5maWxsQW1vdW50UyA9IG9yZGVyLmFtb3VudFMubWluMjU2KHN0YXRlLmF2YWlsYWJsZUFtb3VudFMpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQHJldHVybiBBbW91bnQgb2YgRVJDMjAgdG9rZW4gdGhhdCBjYW4gYmUgc3BlbnQgYnkgdGhpcyBjb250cmFjdC4KICAgIGZ1bmN0aW9uIGdldFNwZW5kYWJsZSgKICAgICAgICBhZGRyZXNzIHRva2VuQWRkcmVzcywKICAgICAgICBhZGRyZXNzIHRva2VuT3duZXIKICAgICAgICApCiAgICAgICAgaW50ZXJuYWwKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQpIHsKCiAgICAgICAgcmV0dXJuIFRva2VuVHJhbnNmZXJEZWxlZ2F0ZShkZWxlZ2F0ZUFkZHJlc3MpCiAgICAgICAgICAgIC5nZXRTcGVuZGFibGUodG9rZW5BZGRyZXNzLCB0b2tlbk93bmVyKTsKICAgIH0KCiAgICAvLy8gQHJldHVybiBBbW91bnQgb2YgTFJDIHRva2VuIHRoYXQgY2FuIGJlIHNwZW50IGJ5IHRoaXMgY29udHJhY3QuCiAgICBmdW5jdGlvbiBnZXRMUkNTcGVuZGFibGUoYWRkcmVzcyB0b2tlbk93bmVyKQogICAgICAgIGludGVybmFsCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50KSB7CgogICAgICAgIHJldHVybiBnZXRTcGVuZGFibGUobHJjVG9rZW5BZGRyZXNzLCB0b2tlbk93bmVyKTsKICAgIH0KCiAgICAvLy8gQGRldiB2ZXJpZnkgaW5wdXQgZGF0YSdzIGJhc2ljIGludGVncml0eS4KICAgIGZ1bmN0aW9uIHZlcmlmeUlucHV0RGF0YUludGVncml0eSgKICAgICAgICB1aW50IHJpbmdTaXplLAogICAgICAgIGFkZHJlc3NbMl1bXSAgICBhZGRyZXNzTGlzdCwKICAgICAgICB1aW50WzddW10gICAgICAgdWludEFyZ3NMaXN0LAogICAgICAgIHVpbnQ4WzJdW10gICAgICB1aW50OEFyZ3NMaXN0LAogICAgICAgIGJvb2xbXSAgICAgICAgICBidXlOb01vcmVUaGFuQW1vdW50Qkxpc3QsCiAgICAgICAgdWludDhbXSAgICAgICAgIHZMaXN0LAogICAgICAgIGJ5dGVzMzJbXSAgICAgICByTGlzdCwKICAgICAgICBieXRlczMyW10gICAgICAgc0xpc3QKICAgICAgICApCiAgICAgICAgaW50ZXJuYWwKICAgICAgICBjb25zdGFudCB7CgogICAgICAgIChyaW5nU2l6ZSA9PSBhZGRyZXNzTGlzdC5sZW5ndGgpCiAgICAgICAgICAgIC5vclRocm93KCJyaW5nIGRhdGEgaXMgaW5jb25zaXN0ZW50IC0gYWRkcmVzc0xpc3QiKTsKICAgICAgICAocmluZ1NpemUgPT0gdWludEFyZ3NMaXN0Lmxlbmd0aCkKICAgICAgICAgICAgLm9yVGhyb3coInJpbmcgZGF0YSBpcyBpbmNvbnNpc3RlbnQgLSB1aW50QXJnc0xpc3QiKTsKICAgICAgICAocmluZ1NpemUgPT0gdWludDhBcmdzTGlzdC5sZW5ndGgpCiAgICAgICAgICAgIC5vclRocm93KCJyaW5nIGRhdGEgaXMgaW5jb25zaXN0ZW50IC0gdWludDhBcmdzTGlzdCIpOwogICAgICAgIChyaW5nU2l6ZSA9PSBidXlOb01vcmVUaGFuQW1vdW50Qkxpc3QubGVuZ3RoKQogICAgICAgICAgICAub3JUaHJvdygicmluZyBkYXRhIGlzIGluY29uc2lzdGVudCAtIGJ1eU5vTW9yZVRoYW5BbW91bnRCTGlzdCIpOwogICAgICAgIChyaW5nU2l6ZSArIDEgPT0gdkxpc3QubGVuZ3RoKQogICAgICAgICAgICAub3JUaHJvdygicmluZyBkYXRhIGlzIGluY29uc2lzdGVudCAtIHZMaXN0Iik7CiAgICAgICAgKHJpbmdTaXplICsgMSA9PSByTGlzdC5sZW5ndGgpCiAgICAgICAgICAgIC5vclRocm93KCJyaW5nIGRhdGEgaXMgaW5jb25zaXN0ZW50IC0gckxpc3QiKTsKICAgICAgICAocmluZ1NpemUgKyAxID09IHNMaXN0Lmxlbmd0aCkKICAgICAgICAgICAgLm9yVGhyb3coInJpbmcgZGF0YSBpcyBpbmNvbnNpc3RlbnQgLSBzTGlzdCIpOwoKICAgICAgICAvLyBWYWxpZGF0ZSByaW5nLW1pbmluZyByZWxhdGVkIGFyZ3VtZW50cy4KICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCByaW5nU2l6ZTsgaSsrKSB7CiAgICAgICAgICAgICh1aW50QXJnc0xpc3RbaV1bNV0gPiAwKS5vclRocm93KCJvcmRlciByYXRlQW1vdW50UyBpcyB6ZXJvIik7CiAgICAgICAgICAgICh1aW50OEFyZ3NMaXN0W2ldWzFdIDw9IEZFRV9TRUxFQ1RfTUFYX1ZBTFVFKS5vclRocm93KCJpbnZhbGlkIG9yZGVyIGZlZSBzZWxlY3Rpb24gIik7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2ICAgICAgICBhc3NtYmxlIG9yZGVyIHBhcmFtZXRlcnMgaW50byBPcmRlciBzdHJ1Y3QuCiAgICAvLy8gQHJldHVybiAgICAgQSBsaXN0IG9mIG9yZGVycy4KICAgIGZ1bmN0aW9uIGFzc2VtYmxlT3JkZXJzKAogICAgICAgIHVpbnQgICAgICAgICAgICByaW5nU2l6ZSwKICAgICAgICBhZGRyZXNzWzJdW10gICAgYWRkcmVzc0xpc3QsCiAgICAgICAgdWludFs3XVtdICAgICAgIHVpbnRBcmdzTGlzdCwKICAgICAgICB1aW50OFsyXVtdICAgICAgdWludDhBcmdzTGlzdCwKICAgICAgICBib29sW10gICAgICAgICAgYnV5Tm9Nb3JlVGhhbkFtb3VudEJMaXN0LAogICAgICAgIHVpbnQ4W10gICAgICAgICB2TGlzdCwKICAgICAgICBieXRlczMyW10gICAgICAgckxpc3QsCiAgICAgICAgYnl0ZXMzMltdICAgICAgIHNMaXN0CiAgICAgICAgKQogICAgICAgIGludGVybmFsCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zIChPcmRlclN0YXRlW10pIHsKCiAgICAgICAgdmFyIG9yZGVycyA9IG5ldyBPcmRlclN0YXRlW10ocmluZ1NpemUpOwoKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCByaW5nU2l6ZTsgaSsrKSB7CiAgICAgICAgICAgIHVpbnQgaiA9IGkucHJldihyaW5nU2l6ZSk7CgogICAgICAgICAgICB2YXIgb3JkZXIgPSBPcmRlcigKICAgICAgICAgICAgICAgIGFkZHJlc3NMaXN0W2ldWzBdLAogICAgICAgICAgICAgICAgYWRkcmVzc0xpc3RbaV1bMV0sCiAgICAgICAgICAgICAgICBhZGRyZXNzTGlzdFtqXVsxXSwKICAgICAgICAgICAgICAgIHVpbnRBcmdzTGlzdFtpXVswXSwKICAgICAgICAgICAgICAgIHVpbnRBcmdzTGlzdFtpXVsxXSwKICAgICAgICAgICAgICAgIHVpbnRBcmdzTGlzdFtpXVsyXSwKICAgICAgICAgICAgICAgIHVpbnRBcmdzTGlzdFtpXVszXSwKICAgICAgICAgICAgICAgIHVpbnRBcmdzTGlzdFtpXVs0XSwKICAgICAgICAgICAgICAgIHVpbnRBcmdzTGlzdFtpXVs1XSwKICAgICAgICAgICAgICAgIGJ1eU5vTW9yZVRoYW5BbW91bnRCTGlzdFtpXSwKICAgICAgICAgICAgICAgIHVpbnQ4QXJnc0xpc3RbaV1bMF0sCiAgICAgICAgICAgICAgICB2TGlzdFtpXSwKICAgICAgICAgICAgICAgIHJMaXN0W2ldLAogICAgICAgICAgICAgICAgc0xpc3RbaV0pOwoKICAgICAgICAgICAgYnl0ZXMzMiBvcmRlckhhc2ggPSBjYWxjdWxhdGVPcmRlckhhc2gob3JkZXIpOwoKICAgICAgICAgICAgdmVyaWZ5U2lnbmF0dXJlKAogICAgICAgICAgICAgICAgb3JkZXIub3duZXIsCiAgICAgICAgICAgICAgICBvcmRlckhhc2gsCiAgICAgICAgICAgICAgICBvcmRlci52LAogICAgICAgICAgICAgICAgb3JkZXIuciwKICAgICAgICAgICAgICAgIG9yZGVyLnMpOwoKICAgICAgICAgICAgdmFsaWRhdGVPcmRlcihvcmRlcik7CgogICAgICAgICAgICBvcmRlcnNbaV0gPSBPcmRlclN0YXRlKAogICAgICAgICAgICAgICAgb3JkZXIsCiAgICAgICAgICAgICAgICBvcmRlckhhc2gsCiAgICAgICAgICAgICAgICB1aW50OEFyZ3NMaXN0W2ldWzFdLCAgLy8gZmVlU2VsZWN0aW9uCiAgICAgICAgICAgICAgICB1aW50QXJnc0xpc3RbaV1bNl0sICAgLy8gcmF0ZUFtb3VudFMKICAgICAgICAgICAgICAgIGdldFNwZW5kYWJsZShvcmRlci50b2tlblMsIG9yZGVyLm93bmVyKSwKICAgICAgICAgICAgICAgIDAsICAgLy8gZmlsbEFtb3VudFMKICAgICAgICAgICAgICAgIDAsICAgLy8gbHJjUmV3YXJkCiAgICAgICAgICAgICAgICAwLCAgIC8vIGxyY0ZlZQogICAgICAgICAgICAgICAgMCwgICAvLyBzcGxpdFMKICAgICAgICAgICAgICAgIDAgICAgLy8gc3BsaXRCCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgLyogKG9yZGVyc1tpXS5hdmFpbGFibGVBbW91bnRTID4gMCkgKi8KICAgICAgICAgICAgLyogICAgIC5vclRocm93KCJvcmRlciBiYWxhbmNlIGlzIHplcm8iKTsgKi8KICAgICAgICB9CgogICAgICAgIHJldHVybiBvcmRlcnM7CiAgICB9CgogICAgLy8vIEBkZXYgdmFsaWRhdGUgb3JkZXIncyBwYXJhbWV0ZXJzIGFyZSBPSy4KICAgIGZ1bmN0aW9uIHZhbGlkYXRlT3JkZXIoT3JkZXIgb3JkZXIpIGludGVybmFsIGNvbnN0YW50IHsKICAgICAgICAob3JkZXIub3duZXIgIT0gYWRkcmVzcygwKSkKICAgICAgICAgICAgLm9yVGhyb3coImludmFsaWQgb3JkZXIgb3duZXIiKTsKICAgICAgICAob3JkZXIudG9rZW5TICE9IGFkZHJlc3MoMCkpCiAgICAgICAgICAgIC5vclRocm93KCJpbnZhbGlkIG9yZGVyIHRva2VuUyIpOwogICAgICAgIChvcmRlci50b2tlbkIgIT0gYWRkcmVzcygwKSkKICAgICAgICAgICAgLm9yVGhyb3coImludmFsaWQgb3JkZXIgdG9rZW5CIik7CiAgICAgICAgKG9yZGVyLmFtb3VudFMgPiAwKQogICAgICAgICAgICAub3JUaHJvdygiaW52YWxpZCBvcmRlciBhbW91bnRTIik7CiAgICAgICAgKG9yZGVyLmFtb3VudEIgPiAwKQogICAgICAgICAgICAub3JUaHJvdygiaW52YWxpZCBvcmRlciBhbW91bnRCIik7CiAgICAgICAgKG9yZGVyLnRpbWVzdGFtcCA+IGN1dG9mZnNbb3JkZXIub3duZXJdKQogICAgICAgICAgICAub3JUaHJvdygib3JkZXIgaXMgY3V0IG9mZiIpOwogICAgICAgIChvcmRlci50dGwgPiAwKQogICAgICAgICAgICAub3JUaHJvdygib3JkZXIgdHRsIGlzIDAiKTsKICAgICAgICAob3JkZXIudGltZXN0YW1wICsgb3JkZXIudHRsID4gYmxvY2sudGltZXN0YW1wKQogICAgICAgICAgICAub3JUaHJvdygib3JkZXIgaXMgZXhwaXJlZCIpOwogICAgICAgIChvcmRlci5zYWx0ID4gMCkKICAgICAgICAgICAgLm9yVGhyb3coImludmFsaWQgb3JkZXIgc2FsdCIpOwogICAgICAgIChvcmRlci5tYXJnaW5TcGxpdFBlcmNlbnRhZ2UgPD0gTUFSR0lOX1NQTElUX1BFUkNFTlRBR0VfQkFTRSkKICAgICAgICAgICAgLm9yVGhyb3coImludmFsaWQgb3JkZXIgbWFyZ2luU3BsaXRQZXJjZW50YWdlIik7CiAgICB9CgogICAgLy8vIEBkZXYgR2V0IHRoZSBLZWNjYWstMjU2IGhhc2ggb2Ygb3JkZXIgd2l0aCBzcGVjaWZpZWQgcGFyYW1ldGVycy4KICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZU9yZGVySGFzaChPcmRlciBvcmRlcikKICAgICAgICBpbnRlcm5hbAogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoYnl0ZXMzMikgewoKICAgICAgICByZXR1cm4ga2VjY2FrMjU2KAogICAgICAgICAgICBhZGRyZXNzKHRoaXMpLAogICAgICAgICAgICBvcmRlci50b2tlblMsCiAgICAgICAgICAgIG9yZGVyLnRva2VuQiwKICAgICAgICAgICAgb3JkZXIuYW1vdW50UywKICAgICAgICAgICAgb3JkZXIuYW1vdW50QiwKICAgICAgICAgICAgb3JkZXIudGltZXN0YW1wLAogICAgICAgICAgICBvcmRlci50dGwsCiAgICAgICAgICAgIG9yZGVyLnNhbHQsCiAgICAgICAgICAgIG9yZGVyLmxyY0ZlZSwKICAgICAgICAgICAgb3JkZXIuYnV5Tm9Nb3JlVGhhbkFtb3VudEIsCiAgICAgICAgICAgIG9yZGVyLm1hcmdpblNwbGl0UGVyY2VudGFnZSk7CiAgICB9CgogICAgLy8vIEByZXR1cm4gVGhlIHNpZ25lcidzIGFkZHJlc3MuCiAgICBmdW5jdGlvbiB2ZXJpZnlTaWduYXR1cmUoCiAgICAgICAgYWRkcmVzcyBzaWduZXIsCiAgICAgICAgYnl0ZXMzMiBoYXNoLAogICAgICAgIHVpbnQ4ICAgdiwKICAgICAgICBieXRlczMyIHIsCiAgICAgICAgYnl0ZXMzMiBzKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgewoKICAgICAgICBhZGRyZXNzIGFkZHIgPSBlY3JlY292ZXIoCiAgICAgICAgICAgIGtlY2NhazI1NigiXHgxOUV0aGVyZXVtIFNpZ25lZCBNZXNzYWdlOlxuMzIiLCBoYXNoKSwKICAgICAgICAgICAgdiwKICAgICAgICAgICAgciwKICAgICAgICAgICAgcyk7CiAgICAgICAgKHNpZ25lciA9PSBhZGRyKS5vclRocm93KCJpbnZhbGlkIHNpZ25hdHVyZSIpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldE9yZGVyRmlsbGVkKGJ5dGVzMzIgb3JkZXJIYXNoKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBmaWxsZWRbb3JkZXJIYXNoXTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRPcmRlckNhbmNlbGxlZChieXRlczMyIG9yZGVySGFzaCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gY2FuY2VsbGVkW29yZGVySGFzaF07CiAgICB9Cn0='.
	

]
