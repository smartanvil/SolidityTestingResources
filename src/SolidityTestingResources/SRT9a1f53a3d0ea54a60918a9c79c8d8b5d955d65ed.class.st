Class {
	#name : #SRT9a1f53a3d0ea54a60918a9c79c8d8b5d955d65ed,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT9a1f53a3d0ea54a60918a9c79c8d8b5d955d65ed >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7Cgpjb250cmFjdCBPd25lZCB7CiAgICAvKioKICAgICAqIENvbnRyYWN0IG93bmVyIGFkZHJlc3MKICAgICAqLwogICAgYWRkcmVzcyBwdWJsaWMgY29udHJhY3RPd25lcjsKCiAgICAvKioKICAgICAqIENvbnRyYWN0IG93bmVyIGFkZHJlc3MKICAgICAqLwogICAgYWRkcmVzcyBwdWJsaWMgcGVuZGluZ0NvbnRyYWN0T3duZXI7CgogICAgZnVuY3Rpb24gT3duZWQoKSB7CiAgICAgICAgY29udHJhY3RPd25lciA9IG1zZy5zZW5kZXI7CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgT3duZXIgY2hlY2sgbW9kaWZpZXIKICAgICovCiAgICBtb2RpZmllciBvbmx5Q29udHJhY3RPd25lcigpIHsKICAgICAgICBpZiAoY29udHJhY3RPd25lciA9PSBtc2cuc2VuZGVyKSB7CiAgICAgICAgICAgIF87CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQGRldiBEZXN0cm95IGNvbnRyYWN0IGFuZCBzY3J1YiBhIGRhdGEKICAgICAqIEBub3RpY2UgT25seSBvd25lciBjYW4gY2FsbCBpdAogICAgICovCiAgICBmdW5jdGlvbiBkZXN0cm95KCkgb25seUNvbnRyYWN0T3duZXIgewogICAgICAgIHN1aWNpZGUobXNnLnNlbmRlcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBQcmVwYXJlcyBvd25lcnNoaXAgcGFzcy4KICAgICAqCiAgICAgKiBDYW4gb25seSBiZSBjYWxsZWQgYnkgY3VycmVudCBvd25lci4KICAgICAqCiAgICAgKiBAcGFyYW0gX3RvIGFkZHJlc3Mgb2YgdGhlIG5leHQgb3duZXIuIDB4MCBpcyBub3QgYWxsb3dlZC4KICAgICAqCiAgICAgKiBAcmV0dXJuIHN1Y2Nlc3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNoYW5nZUNvbnRyYWN0T3duZXJzaGlwKGFkZHJlc3MgX3RvKSBvbmx5Q29udHJhY3RPd25lciBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGlmIChfdG8gPT0gMHgwKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHBlbmRpbmdDb250cmFjdE93bmVyID0gX3RvOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogRmluYWxpemUgb3duZXJzaGlwIHBhc3MuCiAgICAgKgogICAgICogQ2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHBlbmRpbmcgb3duZXIuCiAgICAgKgogICAgICogQHJldHVybiBzdWNjZXNzLgogICAgICovCiAgICBmdW5jdGlvbiBjbGFpbUNvbnRyYWN0T3duZXJzaGlwKCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBpZiAocGVuZGluZ0NvbnRyYWN0T3duZXIgIT0gbXNnLnNlbmRlcikgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBjb250cmFjdE93bmVyID0gcGVuZGluZ0NvbnRyYWN0T3duZXI7CiAgICAgICAgZGVsZXRlIHBlbmRpbmdDb250cmFjdE93bmVyOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICogQGRldiBEaXJlY3Qgb3duZXJzaGlwIHBhc3Mgd2l0aG91dCBjaGFuZ2UvY2xhaW0gcGF0dGVybi4gQ2FuIGJlIGludm9rZWQgb25seSBieSBjdXJyZW50IGNvbnRyYWN0IG93bmVyCiAgICAqCiAgICAqIEBwYXJhbSBfdG8gdGhlIG5leHQgY29udHJhY3Qgb3duZXIKICAgICoKICAgICogQHJldHVybiBgdHJ1ZWAgaWYgc3VjY2VzcywgYGZhbHNlYCBvdGhlcndpc2UKICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlckNvbnRyYWN0T3duZXJzaGlwKGFkZHJlc3MgX3RvKSBvbmx5Q29udHJhY3RPd25lciBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGlmIChfdG8gPT0gMHgwKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIGlmIChwZW5kaW5nQ29udHJhY3RPd25lciAhPSAweDApIHsKICAgICAgICAgICAgcGVuZGluZ0NvbnRyYWN0T3duZXIgPSAweDA7CiAgICAgICAgfQoKICAgICAgICBjb250cmFjdE93bmVyID0gX3RvOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQp9CgoKY29udHJhY3QgRVJDMjBJbnRlcmZhY2UgewogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7CgogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHN1cHBseSk7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpOwp9Cgpjb250cmFjdCBPYmplY3QgaXMgT3duZWQgewogICAgLyoqCiAgICAqICBDb21tb24gcmVzdWx0IGNvZGUuIE1lYW5zIGV2ZXJ5dGhpbmcgaXMgZmluZS4KICAgICovCiAgICB1aW50IGNvbnN0YW50IE9LID0gMTsKCiAgICBmdW5jdGlvbiB3aXRoZHJhd25Ub2tlbnMoYWRkcmVzc1tdIHRva2VucywgYWRkcmVzcyBfdG8pIG9ubHlDb250cmFjdE93bmVyIHJldHVybnModWludCkgewogICAgICAgIGZvcih1aW50IGk9MDtpPHRva2Vucy5sZW5ndGg7aSsrKSB7CiAgICAgICAgICAgIGFkZHJlc3MgdG9rZW4gPSB0b2tlbnNbaV07CiAgICAgICAgICAgIHVpbnQgYmFsYW5jZSA9IEVSQzIwSW50ZXJmYWNlKHRva2VuKS5iYWxhbmNlT2YodGhpcyk7CiAgICAgICAgICAgIGlmKGJhbGFuY2UgIT0gMCkKICAgICAgICAgICAgICAgIEVSQzIwSW50ZXJmYWNlKHRva2VuKS50cmFuc2ZlcihfdG8sYmFsYW5jZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBPSzsKICAgIH0KfQoKY29udHJhY3QgTXVsdGlFdmVudHNIaXN0b3J5QWRhcHRlciB7CgogICAgLyoqCiAgICAqICAgQGRldiBJdCBpcyBhZGRyZXNzIG9mIE11bHRpRXZlbnRzSGlzdG9yeSBjYWxsZXIgYXNzdW1pbmcgd2UgYXJlIGluc2lkZSBvZiBkZWxlZ2F0ZSBjYWxsLgogICAgKi8KICAgIGZ1bmN0aW9uIF9zZWxmKCkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAoYWRkcmVzcykgewogICAgICAgIHJldHVybiBtc2cuc2VuZGVyOwogICAgfQp9Cgpjb250cmFjdCBDaHJvbm9CYW5rUGxhdGZvcm1FbWl0dGVyIGlzIE11bHRpRXZlbnRzSGlzdG9yeUFkYXB0ZXIgewogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgYnl0ZXMzMiBpbmRleGVkIHN5bWJvbCwgdWludCB2YWx1ZSwgc3RyaW5nIHJlZmVyZW5jZSk7CiAgICBldmVudCBJc3N1ZShieXRlczMyIGluZGV4ZWQgc3ltYm9sLCB1aW50IHZhbHVlLCBhZGRyZXNzIGluZGV4ZWQgYnkpOwogICAgZXZlbnQgUmV2b2tlKGJ5dGVzMzIgaW5kZXhlZCBzeW1ib2wsIHVpbnQgdmFsdWUsIGFkZHJlc3MgaW5kZXhlZCBieSk7CiAgICBldmVudCBPd25lcnNoaXBDaGFuZ2UoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgYnl0ZXMzMiBpbmRleGVkIHN5bWJvbCk7CiAgICBldmVudCBBcHByb3ZlKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgYnl0ZXMzMiBpbmRleGVkIHN5bWJvbCwgdWludCB2YWx1ZSk7CiAgICBldmVudCBSZWNvdmVyeShhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCBhZGRyZXNzIGJ5KTsKICAgIGV2ZW50IEVycm9yKHVpbnQgZXJyb3JDb2RlKTsKCiAgICBmdW5jdGlvbiBlbWl0VHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIGJ5dGVzMzIgX3N5bWJvbCwgdWludCBfdmFsdWUsIHN0cmluZyBfcmVmZXJlbmNlKSB7CiAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3N5bWJvbCwgX3ZhbHVlLCBfcmVmZXJlbmNlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBlbWl0SXNzdWUoYnl0ZXMzMiBfc3ltYm9sLCB1aW50IF92YWx1ZSwgYWRkcmVzcyBfYnkpIHsKICAgICAgICBJc3N1ZShfc3ltYm9sLCBfdmFsdWUsIF9ieSk7CiAgICB9CgogICAgZnVuY3Rpb24gZW1pdFJldm9rZShieXRlczMyIF9zeW1ib2wsIHVpbnQgX3ZhbHVlLCBhZGRyZXNzIF9ieSkgewogICAgICAgIFJldm9rZShfc3ltYm9sLCBfdmFsdWUsIF9ieSk7CiAgICB9CgogICAgZnVuY3Rpb24gZW1pdE93bmVyc2hpcENoYW5nZShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgYnl0ZXMzMiBfc3ltYm9sKSB7CiAgICAgICAgT3duZXJzaGlwQ2hhbmdlKF9mcm9tLCBfdG8sIF9zeW1ib2wpOwogICAgfQoKICAgIGZ1bmN0aW9uIGVtaXRBcHByb3ZlKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3NwZW5kZXIsIGJ5dGVzMzIgX3N5bWJvbCwgdWludCBfdmFsdWUpIHsKICAgICAgICBBcHByb3ZlKF9mcm9tLCBfc3BlbmRlciwgX3N5bWJvbCwgX3ZhbHVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBlbWl0UmVjb3ZlcnkoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIGFkZHJlc3MgX2J5KSB7CiAgICAgICAgUmVjb3ZlcnkoX2Zyb20sIF90bywgX2J5KTsKICAgIH0KCiAgICBmdW5jdGlvbiBlbWl0RXJyb3IodWludCBfZXJyb3JDb2RlKSB7CiAgICAgICAgRXJyb3IoX2Vycm9yQ29kZSk7CiAgICB9Cn0KCgpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKY29udHJhY3QgUHJveHlFdmVudHNFbWl0dGVyIHsKICAgIGZ1bmN0aW9uIGVtaXRUcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpOwogICAgZnVuY3Rpb24gZW1pdEFwcHJvdmUoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfc3BlbmRlciwgdWludCBfdmFsdWUpOwp9CgoKY29udHJhY3QgQXNzZXRPd25pbmdMaXN0ZW5lciB7CiAgICBmdW5jdGlvbiBhc3NldE93bmVyQWRkZWQoYnl0ZXMzMiBfc3ltYm9sLCBhZGRyZXNzIF9wbGF0Zm9ybSwgYWRkcmVzcyBfb3duZXIpOwogICAgZnVuY3Rpb24gYXNzZXRPd25lclJlbW92ZWQoYnl0ZXMzMiBfc3ltYm9sLCBhZGRyZXNzIF9wbGF0Zm9ybSwgYWRkcmVzcyBfb3duZXIpOwp9CgovKioKICogQHRpdGxlIENocm9ub0JhbmsgUGxhdGZvcm0uCiAqCiAqIFRoZSBvZmZpY2lhbCBDaHJvbm9CYW5rIGFzc2V0cyBwbGF0Zm9ybSBwb3dlcmluZyBUSU1FIGFuZCBMSFQgdG9rZW5zLCBhbmQgcG9zc2libHkKICogb3RoZXIgdW5rbm93biB0b2tlbnMgbmVlZGVkIGxhdGVyLgogKiBQbGF0Zm9ybSB1c2VzIE11bHRpRXZlbnRzSGlzdG9yeSBjb250cmFjdCB0byBrZWVwIGV2ZW50cywgc28gdGhhdCBpbiBjYXNlIGl0IG5lZWRzIHRvIGJlIHJlZGVwbG95ZWQKICogYXQgc29tZSBwb2ludCwgYWxsIHRoZSBldmVudHMga2VlcCBhcHBlYXJpbmcgYXQgdGhlIHNhbWUgcGxhY2UuCiAqCiAqIEV2ZXJ5IGFzc2V0IGlzIG1lYW50IHRvIGJlIHVzZWQgdGhyb3VnaCBhIHByb3h5IGNvbnRyYWN0LiBPbmx5IG9uZSBwcm94eSBjb250cmFjdCBoYXZlIGFjY2VzcwogKiByaWdodHMgZm9yIGEgcGFydGljdWxhciBhc3NldC4KICoKICogRmVhdHVyZXM6IHRyYW5zZmVycywgYWxsb3dhbmNlcywgc3VwcGx5IGFkanVzdG1lbnRzLCBsb3N0IHdhbGxldCBhY2Nlc3MgcmVjb3ZlcnkuCiAqCiAqIE5vdGU6IGFsbCB0aGUgbm9uIGNvbnN0YW50IGZ1bmN0aW9ucyByZXR1cm4gZmFsc2UgaW5zdGVhZCBvZiB0aHJvd2luZyBpbiBjYXNlIGlmIHN0YXRlIGNoYW5nZQogKiBkaWRuJ3QgaGFwcGVuIHlldC4KICovCmNvbnRyYWN0IENocm9ub0JhbmtQbGF0Zm9ybSBpcyBPYmplY3QsIENocm9ub0JhbmtQbGF0Zm9ybUVtaXR0ZXIgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7CgogICAgdWludCBjb25zdGFudCBDSFJPTk9CQU5LX1BMQVRGT1JNX1NDT1BFID0gMTUwMDA7CiAgICB1aW50IGNvbnN0YW50IENIUk9OT0JBTktfUExBVEZPUk1fUFJPWFlfQUxSRUFEWV9FWElTVFMgPSBDSFJPTk9CQU5LX1BMQVRGT1JNX1NDT1BFICsgMDsKICAgIHVpbnQgY29uc3RhbnQgQ0hST05PQkFOS19QTEFURk9STV9DQU5OT1RfQVBQTFlfVE9fT05FU0VMRiA9IENIUk9OT0JBTktfUExBVEZPUk1fU0NPUEUgKyAxOwogICAgdWludCBjb25zdGFudCBDSFJPTk9CQU5LX1BMQVRGT1JNX0lOVkFMSURfVkFMVUUgPSBDSFJPTk9CQU5LX1BMQVRGT1JNX1NDT1BFICsgMjsKICAgIHVpbnQgY29uc3RhbnQgQ0hST05PQkFOS19QTEFURk9STV9JTlNVRkZJQ0lFTlRfQkFMQU5DRSA9IENIUk9OT0JBTktfUExBVEZPUk1fU0NPUEUgKyAzOwogICAgdWludCBjb25zdGFudCBDSFJPTk9CQU5LX1BMQVRGT1JNX05PVF9FTk9VR0hfQUxMT1dBTkNFID0gQ0hST05PQkFOS19QTEFURk9STV9TQ09QRSArIDQ7CiAgICB1aW50IGNvbnN0YW50IENIUk9OT0JBTktfUExBVEZPUk1fQVNTRVRfQUxSRUFEWV9JU1NVRUQgPSBDSFJPTk9CQU5LX1BMQVRGT1JNX1NDT1BFICsgNTsKICAgIHVpbnQgY29uc3RhbnQgQ0hST05PQkFOS19QTEFURk9STV9DQU5OT1RfSVNTVUVfRklYRURfQVNTRVRfV0lUSF9JTlZBTElEX1ZBTFVFID0gQ0hST05PQkFOS19QTEFURk9STV9TQ09QRSArIDY7CiAgICB1aW50IGNvbnN0YW50IENIUk9OT0JBTktfUExBVEZPUk1fQ0FOTk9UX1JFSVNTVUVfRklYRURfQVNTRVQgPSBDSFJPTk9CQU5LX1BMQVRGT1JNX1NDT1BFICsgNzsKICAgIHVpbnQgY29uc3RhbnQgQ0hST05PQkFOS19QTEFURk9STV9TVVBQTFlfT1ZFUkZMT1cgPSBDSFJPTk9CQU5LX1BMQVRGT1JNX1NDT1BFICsgODsKICAgIHVpbnQgY29uc3RhbnQgQ0hST05PQkFOS19QTEFURk9STV9OT1RfRU5PVUdIX1RPS0VOUyA9IENIUk9OT0JBTktfUExBVEZPUk1fU0NPUEUgKyA5OwogICAgdWludCBjb25zdGFudCBDSFJPTk9CQU5LX1BMQVRGT1JNX0lOVkFMSURfTkVXX09XTkVSID0gQ0hST05PQkFOS19QTEFURk9STV9TQ09QRSArIDEwOwogICAgdWludCBjb25zdGFudCBDSFJPTk9CQU5LX1BMQVRGT1JNX0FMUkVBRFlfVFJVU1RFRCA9IENIUk9OT0JBTktfUExBVEZPUk1fU0NPUEUgKyAxMTsKICAgIHVpbnQgY29uc3RhbnQgQ0hST05PQkFOS19QTEFURk9STV9TSE9VTERfUkVDT1ZFUl9UT19ORVdfQUREUkVTUyA9IENIUk9OT0JBTktfUExBVEZPUk1fU0NPUEUgKyAxMjsKICAgIHVpbnQgY29uc3RhbnQgQ0hST05PQkFOS19QTEFURk9STV9BU1NFVF9JU19OT1RfSVNTVUVEID0gQ0hST05PQkFOS19QTEFURk9STV9TQ09QRSArIDEzOwogICAgdWludCBjb25zdGFudCBDSFJPTk9CQU5LX1BMQVRGT1JNX0lOVkFMSURfSU5WT0NBVElPTiA9IENIUk9OT0JBTktfUExBVEZPUk1fU0NPUEUgKyAxNzsKCiAgICAvLyBTdHJ1Y3R1cmUgb2YgYSBwYXJ0aWN1bGFyIGFzc2V0LgogICAgc3RydWN0IEFzc2V0IHsKICAgICAgICB1aW50IG93bmVyOyAgICAgICAgICAgICAgICAgICAgICAgLy8gQXNzZXQncyBvd25lciBpZC4KICAgICAgICB1aW50IHRvdGFsU3VwcGx5OyAgICAgICAgICAgICAgICAgLy8gQXNzZXQncyB0b3RhbCBzdXBwbHkuCiAgICAgICAgc3RyaW5nIG5hbWU7ICAgICAgICAgICAgICAgICAgICAgIC8vIEFzc2V0J3MgbmFtZSwgZm9yIGluZm9ybWF0aW9uIHB1cnBvc2VzLgogICAgICAgIHN0cmluZyBkZXNjcmlwdGlvbjsgICAgICAgICAgICAgICAvLyBBc3NldCdzIGRlc2NyaXB0aW9uLCBmb3IgaW5mb3JtYXRpb24gcHVycG9zZXMuCiAgICAgICAgYm9vbCBpc1JlaXNzdWFibGU7ICAgICAgICAgICAgICAgIC8vIEluZGljYXRlcyBpZiBhc3NldCBoYXZlIGR5bmFtaWMgb3IgZml4ZWQgc3VwcGx5LgogICAgICAgIHVpbnQ4IGJhc2VVbml0OyAgICAgICAgICAgICAgICAgICAvLyBQcm9wb3NlZCBudW1iZXIgb2YgZGVjaW1hbHMuCiAgICAgICAgbWFwcGluZyh1aW50ID0+IFdhbGxldCkgd2FsbGV0czsgIC8vIEhvbGRlcnMgd2FsbGV0cy4KICAgICAgICBtYXBwaW5nKHVpbnQgPT4gYm9vbCkgcGFydG93bmVyczsgLy8gUGFydC1vd25lcnMgb2YgYW4gYXNzZXQ7IGhhdmUgbGVzcyBhY2Nlc3MgcmlnaHRzIHRoYW4gb3duZXIKICAgIH0KCiAgICAvLyBTdHJ1Y3R1cmUgb2YgYW4gYXNzZXQgaG9sZGVyIHdhbGxldCBmb3IgcGFydGljdWxhciBhc3NldC4KICAgIHN0cnVjdCBXYWxsZXQgewogICAgICAgIHVpbnQgYmFsYW5jZTsKICAgICAgICBtYXBwaW5nKHVpbnQgPT4gdWludCkgYWxsb3dhbmNlOwogICAgfQoKICAgIC8vIFN0cnVjdHVyZSBvZiBhbiBhc3NldCBob2xkZXIuCiAgICBzdHJ1Y3QgSG9sZGVyIHsKICAgICAgICBhZGRyZXNzIGFkZHI7ICAgICAgICAgICAgICAgICAgICAvLyBDdXJyZW50IGFkZHJlc3Mgb2YgdGhlIGhvbGRlci4KICAgICAgICBtYXBwaW5nKGFkZHJlc3MgPT4gYm9vbCkgdHJ1c3Q7ICAvLyBBZGRyZXNzZXMgdGhhdCBhcmUgdHJ1c3RlZCB3aXRoIHJlY292ZXJ5IHByb29jZWR1cmUuCiAgICB9CgogICAgLy8gSXRlcmFibGUgbWFwcGluZyBwYXR0ZXJuIGlzIHVzZWQgZm9yIGhvbGRlcnMuCiAgICB1aW50IHB1YmxpYyBob2xkZXJzQ291bnQ7CiAgICBtYXBwaW5nKHVpbnQgPT4gSG9sZGVyKSBwdWJsaWMgaG9sZGVyczsKCiAgICAvLyBUaGlzIGlzIGFuIGFjY2VzcyBhZGRyZXNzIG1hcHBpbmcuIE1hbnkgYWRkcmVzc2VzIG1heSBoYXZlIGFjY2VzcyB0byBhIHNpbmdsZSBob2xkZXIuCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgaG9sZGVySW5kZXg7CgogICAgLy8gTGlzdCBvZiBzeW1ib2xzIHRoYXQgZXhpc3QgaW4gYSBwbGF0Zm9ybQogICAgYnl0ZXMzMltdIHB1YmxpYyBzeW1ib2xzOwoKICAgIC8vIEFzc2V0IHN5bWJvbCB0byBhc3NldCBtYXBwaW5nLgogICAgbWFwcGluZyhieXRlczMyID0+IEFzc2V0KSBwdWJsaWMgYXNzZXRzOwoKICAgIC8vIEFzc2V0IHN5bWJvbCB0byBhc3NldCBwcm94eSBtYXBwaW5nLgogICAgbWFwcGluZyhieXRlczMyID0+IGFkZHJlc3MpIHB1YmxpYyBwcm94aWVzOwoKICAgIC8qKiBDby1vd25lcnMgb2YgYSBwbGF0Zm9ybS4gSGFzIGxlc3MgYWNjZXNzIHJpZ2h0cyB0aGFuIGEgcm9vdCBjb250cmFjdCBvd25lciAqLwogICAgbWFwcGluZyhhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBwYXJ0b3duZXJzOwoKICAgIC8vIFNob3VsZCB1c2UgaW50ZXJmYWNlIG9mIHRoZSBlbWl0dGVyLCBidXQgYWRkcmVzcyBvZiBldmVudHMgaGlzdG9yeS4KICAgIGFkZHJlc3MgcHVibGljIGV2ZW50c0hpc3Rvcnk7CiAgICBhZGRyZXNzIHB1YmxpYyBldmVudHNBZG1pbjsKCiAgICBhZGRyZXNzIG93bmluZ0xpc3RlbmVyOwoKICAgIC8qKgogICAgICogRW1pdHMgRXJyb3IgZXZlbnQgd2l0aCBzcGVjaWZpZWQgZXJyb3IgbWVzc2FnZS4KICAgICAqCiAgICAgKiBTaG91bGQgb25seSBiZSB1c2VkIGlmIG5vIHN0YXRlIGNoYW5nZXMgaGFwcGVuZWQuCiAgICAgKgogICAgICogQHBhcmFtIF9lcnJvckNvZGUgY29kZSBvZiBhbiBlcnJvcgogICAgICovCiAgICBmdW5jdGlvbiBfZXJyb3IodWludCBfZXJyb3JDb2RlKSBpbnRlcm5hbCByZXR1cm5zKHVpbnQpIHsKICAgICAgICBDaHJvbm9CYW5rUGxhdGZvcm1FbWl0dGVyKGV2ZW50c0hpc3RvcnkpLmVtaXRFcnJvcihfZXJyb3JDb2RlKTsKICAgICAgICByZXR1cm4gX2Vycm9yQ29kZTsKICAgIH0KCiAgICAvKioKICAgICAqIEVtaXRzIEVycm9yIGlmIGNhbGxlZCBub3QgYnkgYXNzZXQgb3duZXIuCiAgICAgKi8KICAgIG1vZGlmaWVyIG9ubHlPd25lcihieXRlczMyIF9zeW1ib2wpIHsKICAgICAgICBpZiAoaXNPd25lcihtc2cuc2VuZGVyLCBfc3ltYm9sKSkgewogICAgICAgICAgICBfOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEVtaXRzIEVycm9yIGlmIGNhbGxlZCBub3QgYnkgYXNzZXQgb3duZXIuCiAgICAgKi8KICAgIG1vZGlmaWVyIG9ubHlFdmVudHNBZG1pbigpIHsKICAgICAgICBpZiAoZXZlbnRzQWRtaW4gPT0gbXNnLnNlbmRlciB8fCBjb250cmFjdE93bmVyID09IG1zZy5zZW5kZXIpIHsKICAgICAgICAgICAgXzsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgVU5BVVRIT1JJWkVEIGlmIGNhbGxlZCBub3QgYnkgb25lIG9mIHN5bWJvbCdzIHBhcnRvd25lcnMgb3Igb3duZXIKICAgICovCiAgICBtb2RpZmllciBvbmx5T25lT2ZPd25lcnMoYnl0ZXMzMiBfc3ltYm9sKSB7CiAgICAgICAgaWYgKGhhc0Fzc2V0UmlnaHRzKG1zZy5zZW5kZXIsIF9zeW1ib2wpKSB7CiAgICAgICAgICAgIF87CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IFVOQVVUSE9SSVpFRCBpZiBjYWxsZWQgbm90IGJ5IG9uZSBvZiBwYXJ0b3duZXJzIG9yIGNvbnRyYWN0J3Mgb3duZXIKICAgICovCiAgICBtb2RpZmllciBvbmx5T25lT2ZDb250cmFjdE93bmVycygpIHsKICAgICAgICBpZiAoY29udHJhY3RPd25lciA9PSBtc2cuc2VuZGVyIHx8IHBhcnRvd25lcnNbbXNnLnNlbmRlcl0pIHsKICAgICAgICAgICAgXzsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBFbWl0cyBFcnJvciBpZiBjYWxsZWQgbm90IGJ5IGFzc2V0IHByb3h5LgogICAgICovCiAgICBtb2RpZmllciBvbmx5UHJveHkoYnl0ZXMzMiBfc3ltYm9sKSB7CiAgICAgICAgaWYgKHByb3hpZXNbX3N5bWJvbF0gPT0gbXNnLnNlbmRlcikgewogICAgICAgICAgICBfOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEVtaXRzIEVycm9yIGlmIF9mcm9tIGRvZXNuJ3QgdHJ1c3QgX3RvLgogICAgICovCiAgICBtb2RpZmllciBjaGVja1RydXN0KGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvKSB7CiAgICAgICAgaWYgKGlzVHJ1c3RlZChfZnJvbSwgX3RvKSkgewogICAgICAgICAgICBfOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICogQWRkcyBhIGNvLW93bmVyIG9mIGEgY29udHJhY3QuIE1pZ2h0IGJlIG1vcmUgdGhhbiBvbmUgY28tb3duZXIKICAgICogQGRldiBBbGxvd2VkIHRvIG9ubHkgY29udHJhY3Qgb253ZXIKICAgICoKICAgICogQHBhcmFtIF9wYXJ0b3duZXIgYSBjby1vd25lciBvZiBhIGNvbnRyYWN0CiAgICAqCiAgICAqIEByZXR1cm4gcmVzdWx0IGNvZGUgb2YgYW4gb3BlcmF0aW9uCiAgICAqLwogICAgZnVuY3Rpb24gYWRkUGFydE93bmVyKGFkZHJlc3MgX3BhcnRvd25lcikgb25seUNvbnRyYWN0T3duZXIgcmV0dXJucyAodWludCkgewogICAgICAgIHBhcnRvd25lcnNbX3BhcnRvd25lcl0gPSB0cnVlOwogICAgICAgIHJldHVybiBPSzsKICAgIH0KCiAgICAvKioKICAgICogUmVtb3ZlcyBhIGNvLW93bmVyIG9mIGEgY29udHJhY3QKICAgICogQGRldiBTaG91bGQgYmUgcGVyZm9ybWVkIG9ubHkgYnkgcm9vdCBjb250cmFjdCBvd25lcgogICAgKgogICAgKiBAcGFyYW0gX3BhcnRvd25lciBhIGNvLW93bmVyIG9mIGEgY29udHJhY3QKICAgICoKICAgICogQHJldHVybiByZXN1bHQgY29kZSBvZiBhbiBvcGVyYXRpb24KICAgICovCiAgICBmdW5jdGlvbiByZW1vdmVQYXJ0T3duZXIoYWRkcmVzcyBfcGFydG93bmVyKSBvbmx5Q29udHJhY3RPd25lciByZXR1cm5zICh1aW50KSB7CiAgICAgICAgZGVsZXRlIHBhcnRvd25lcnNbX3BhcnRvd25lcl07CiAgICAgICAgcmV0dXJuIE9LOwogICAgfQoKICAgIC8qKgogICAgICogU2V0cyBFdmVudHNIc3RvcnkgY29udHJhY3QgYWRkcmVzcy4KICAgICAqCiAgICAgKiBDYW4gYmUgc2V0IG9ubHkgYnkgZXZlbnRzIGhpc3RvcnkgYWRtb24gb3Igb3duZXIuCiAgICAgKgogICAgICogQHBhcmFtIF9ldmVudHNIaXN0b3J5IE11bHRpRXZlbnRzSGlzdG9yeSBjb250cmFjdCBhZGRyZXNzLgogICAgICoKICAgICAqIEByZXR1cm4gc3VjY2Vzcy4KICAgICAqLwogICAgZnVuY3Rpb24gc2V0dXBFdmVudHNIaXN0b3J5KGFkZHJlc3MgX2V2ZW50c0hpc3RvcnkpIG9ubHlFdmVudHNBZG1pbiByZXR1cm5zICh1aW50IGVycm9yQ29kZSkgewogICAgICAgIGV2ZW50c0hpc3RvcnkgPSBfZXZlbnRzSGlzdG9yeTsKICAgICAgICByZXR1cm4gT0s7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXRzIEV2ZW50c0hzdG9yeSBjb250cmFjdCBhZG1pbiBhZGRyZXNzLgogICAgICoKICAgICAqIENhbiBiZSBzZXQgb25seSBieSBjb250cmFjdCBvd25lci4KICAgICAqCiAgICAgKiBAcGFyYW0gX2V2ZW50c0FkbWluIGFkbWluIGNvbnRyYWN0IGFkZHJlc3MuCiAgICAgKgogICAgICogQHJldHVybiBzdWNjZXNzLgogICAgICovCiAgICBmdW5jdGlvbiBzZXR1cEV2ZW50c0FkbWluKGFkZHJlc3MgX2V2ZW50c0FkbWluKSBvbmx5Q29udHJhY3RPd25lciByZXR1cm5zICh1aW50IGVycm9yQ29kZSkgewogICAgICAgIGV2ZW50c0FkbWluID0gX2V2ZW50c0FkbWluOwogICAgICAgIHJldHVybiBPSzsKICAgIH0KCiAgICAvKioKICAgICogQGRldiBUT0RPCiAgICAqLwogICAgZnVuY3Rpb24gc2V0dXBBc3NldE93bmluZ0xpc3RlbmVyKGFkZHJlc3MgX2xpc3RlbmVyKSBvbmx5RXZlbnRzQWRtaW4gcHVibGljIHJldHVybnMgKHVpbnQpIHsKICAgICAgICBvd25pbmdMaXN0ZW5lciA9IF9saXN0ZW5lcjsKICAgICAgICByZXR1cm4gT0s7CiAgICB9CgogICAgLyoqCiAgICAqIFByb3ZpZGVzIGEgY2hlYXAgd2F5IHRvIGdldCBudW1iZXIgb2Ygc3ltYm9scyByZWdpc3RlcmVkIGluIGEgcGxhdGZvcm0KICAgICoKICAgICogQHJldHVybiBudW1iZXIgb2Ygc3ltYm9scwogICAgKi8KICAgIGZ1bmN0aW9uIHN5bWJvbHNDb3VudCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHN5bWJvbHMubGVuZ3RoOwogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgYXNzZXQgZXhpc3RhbmNlLgogICAgICoKICAgICAqIEBwYXJhbSBfc3ltYm9sIGFzc2V0IHN5bWJvbC4KICAgICAqCiAgICAgKiBAcmV0dXJuIGFzc2V0IGV4aXN0YW5jZS4KICAgICAqLwogICAgZnVuY3Rpb24gaXNDcmVhdGVkKGJ5dGVzMzIgX3N5bWJvbCkgY29uc3RhbnQgcmV0dXJucyhib29sKSB7CiAgICAgICAgcmV0dXJuIGFzc2V0c1tfc3ltYm9sXS5vd25lciAhPSAwOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyBhc3NldCBkZWNpbWFscy4KICAgICAqCiAgICAgKiBAcGFyYW0gX3N5bWJvbCBhc3NldCBzeW1ib2wuCiAgICAgKgogICAgICogQHJldHVybiBhc3NldCBkZWNpbWFscy4KICAgICAqLwogICAgZnVuY3Rpb24gYmFzZVVuaXQoYnl0ZXMzMiBfc3ltYm9sKSBjb25zdGFudCByZXR1cm5zKHVpbnQ4KSB7CiAgICAgICAgcmV0dXJuIGFzc2V0c1tfc3ltYm9sXS5iYXNlVW5pdDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYXNzZXQgbmFtZS4KICAgICAqCiAgICAgKiBAcGFyYW0gX3N5bWJvbCBhc3NldCBzeW1ib2wuCiAgICAgKgogICAgICogQHJldHVybiBhc3NldCBuYW1lLgogICAgICovCiAgICBmdW5jdGlvbiBuYW1lKGJ5dGVzMzIgX3N5bWJvbCkgY29uc3RhbnQgcmV0dXJucyhzdHJpbmcpIHsKICAgICAgICByZXR1cm4gYXNzZXRzW19zeW1ib2xdLm5hbWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFzc2V0IGRlc2NyaXB0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSBfc3ltYm9sIGFzc2V0IHN5bWJvbC4KICAgICAqCiAgICAgKiBAcmV0dXJuIGFzc2V0IGRlc2NyaXB0aW9uLgogICAgICovCiAgICBmdW5jdGlvbiBkZXNjcmlwdGlvbihieXRlczMyIF9zeW1ib2wpIGNvbnN0YW50IHJldHVybnMoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIGFzc2V0c1tfc3ltYm9sXS5kZXNjcmlwdGlvbjsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYXNzZXQgcmVpc3N1YWJpbGl0eS4KICAgICAqCiAgICAgKiBAcGFyYW0gX3N5bWJvbCBhc3NldCBzeW1ib2wuCiAgICAgKgogICAgICogQHJldHVybiBhc3NldCByZWlzc3VhYmlsaXR5LgogICAgICovCiAgICBmdW5jdGlvbiBpc1JlaXNzdWFibGUoYnl0ZXMzMiBfc3ltYm9sKSBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsKICAgICAgICByZXR1cm4gYXNzZXRzW19zeW1ib2xdLmlzUmVpc3N1YWJsZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYXNzZXQgb3duZXIgYWRkcmVzcy4KICAgICAqCiAgICAgKiBAcGFyYW0gX3N5bWJvbCBhc3NldCBzeW1ib2wuCiAgICAgKgogICAgICogQHJldHVybiBhc3NldCBvd25lciBhZGRyZXNzLgogICAgICovCiAgICBmdW5jdGlvbiBvd25lcihieXRlczMyIF9zeW1ib2wpIGNvbnN0YW50IHJldHVybnMoYWRkcmVzcykgewogICAgICAgIHJldHVybiBob2xkZXJzW2Fzc2V0c1tfc3ltYm9sXS5vd25lcl0uYWRkcjsKICAgIH0KCiAgICAvKioKICAgICAqIENoZWNrIGlmIHNwZWNpZmllZCBhZGRyZXNzIGhhcyBhc3NldCBvd25lciByaWdodHMuCiAgICAgKgogICAgICogQHBhcmFtIF9vd25lciBhZGRyZXNzIHRvIGNoZWNrLgogICAgICogQHBhcmFtIF9zeW1ib2wgYXNzZXQgc3ltYm9sLgogICAgICoKICAgICAqIEByZXR1cm4gb3duZXIgcmlnaHRzIGF2YWlsYWJpbGl0eS4KICAgICAqLwogICAgZnVuY3Rpb24gaXNPd25lcihhZGRyZXNzIF9vd25lciwgYnl0ZXMzMiBfc3ltYm9sKSBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsKICAgICAgICByZXR1cm4gaXNDcmVhdGVkKF9zeW1ib2wpICYmIChhc3NldHNbX3N5bWJvbF0ub3duZXIgPT0gZ2V0SG9sZGVySWQoX293bmVyKSk7CiAgICB9CgogICAgLyoqCiAgICAqIENoZWNrcyBpZiBhIHNwZWNpZmllZCBhZGRyZXNzIGhhcyBhc3NldCBvd25lciBvciBjby1vd25lciByaWdodHMuCiAgICAqCiAgICAqIEBwYXJhbSBfb3duZXIgYWRkcmVzcyB0byBjaGVjay4KICAgICogQHBhcmFtIF9zeW1ib2wgYXNzZXQgc3ltYm9sLgogICAgKgogICAgKiBAcmV0dXJuIG93bmVyIHJpZ2h0cyBhdmFpbGFiaWxpdHkuCiAgICAqLwogICAgZnVuY3Rpb24gaGFzQXNzZXRSaWdodHMoYWRkcmVzcyBfb3duZXIsIGJ5dGVzMzIgX3N5bWJvbCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHVpbnQgaG9sZGVySWQgPSBnZXRIb2xkZXJJZChfb3duZXIpOwogICAgICAgIHJldHVybiBpc0NyZWF0ZWQoX3N5bWJvbCkgJiYgKGFzc2V0c1tfc3ltYm9sXS5vd25lciA9PSBob2xkZXJJZCB8fCBhc3NldHNbX3N5bWJvbF0ucGFydG93bmVyc1tob2xkZXJJZF0pOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyBhc3NldCB0b3RhbCBzdXBwbHkuCiAgICAgKgogICAgICogQHBhcmFtIF9zeW1ib2wgYXNzZXQgc3ltYm9sLgogICAgICoKICAgICAqIEByZXR1cm4gYXNzZXQgdG90YWwgc3VwcGx5LgogICAgICovCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseShieXRlczMyIF9zeW1ib2wpIGNvbnN0YW50IHJldHVybnModWludCkgewogICAgICAgIHJldHVybiBhc3NldHNbX3N5bWJvbF0udG90YWxTdXBwbHk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFzc2V0IGJhbGFuY2UgZm9yIGEgcGFydGljdWxhciBob2xkZXIuCiAgICAgKgogICAgICogQHBhcmFtIF9ob2xkZXIgaG9sZGVyIGFkZHJlc3MuCiAgICAgKiBAcGFyYW0gX3N5bWJvbCBhc3NldCBzeW1ib2wuCiAgICAgKgogICAgICogQHJldHVybiBob2xkZXIgYmFsYW5jZS4KICAgICAqLwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX2hvbGRlciwgYnl0ZXMzMiBfc3ltYm9sKSBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXR1cm4gX2JhbGFuY2VPZihnZXRIb2xkZXJJZChfaG9sZGVyKSwgX3N5bWJvbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFzc2V0IGJhbGFuY2UgZm9yIGEgcGFydGljdWxhciBob2xkZXIgaWQuCiAgICAgKgogICAgICogQHBhcmFtIF9ob2xkZXJJZCBob2xkZXIgaWQuCiAgICAgKiBAcGFyYW0gX3N5bWJvbCBhc3NldCBzeW1ib2wuCiAgICAgKgogICAgICogQHJldHVybiBob2xkZXIgYmFsYW5jZS4KICAgICAqLwogICAgZnVuY3Rpb24gX2JhbGFuY2VPZih1aW50IF9ob2xkZXJJZCwgYnl0ZXMzMiBfc3ltYm9sKSBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXR1cm4gYXNzZXRzW19zeW1ib2xdLndhbGxldHNbX2hvbGRlcklkXS5iYWxhbmNlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyBjdXJyZW50IGFkZHJlc3MgZm9yIGEgcGFydGljdWxhciBob2xkZXIgaWQuCiAgICAgKgogICAgICogQHBhcmFtIF9ob2xkZXJJZCBob2xkZXIgaWQuCiAgICAgKgogICAgICogQHJldHVybiBob2xkZXIgYWRkcmVzcy4KICAgICAqLwogICAgZnVuY3Rpb24gX2FkZHJlc3ModWludCBfaG9sZGVySWQpIGNvbnN0YW50IHJldHVybnMoYWRkcmVzcykgewogICAgICAgIHJldHVybiBob2xkZXJzW19ob2xkZXJJZF0uYWRkcjsKICAgIH0KCiAgICAvKioKICAgICogQWRkcyBhIGNvLW93bmVyIGZvciBhbiBhc3NldCB3aXRoIHByb3ZpZGVkIHN5bWJvbC4KICAgICogQGRldiBTaG91bGQgYmUgcGVyZm9ybWVkIGJ5IGEgY29udHJhY3Qgb3duZXIgb3IgaXRzIGNvLW93bmVycwogICAgKgogICAgKiBAcGFyYW0gX3N5bWJvbCBhc3NldCdzIHN5bWJvbAogICAgKiBAcGFyYW0gX3BhcnRvd25lciBhIGNvLW93bmVyIG9mIGFuIGFzc2V0CiAgICAqCiAgICAqIEByZXR1cm4gZXJyb3JDb2RlIHJlc3VsdCBjb2RlIG9mIGFuIG9wZXJhdGlvbgogICAgKi8KICAgIGZ1bmN0aW9uIGFkZEFzc2V0UGFydE93bmVyKGJ5dGVzMzIgX3N5bWJvbCwgYWRkcmVzcyBfcGFydG93bmVyKSBvbmx5T25lT2ZPd25lcnMoX3N5bWJvbCkgcHVibGljIHJldHVybnMgKHVpbnQpIHsKICAgICAgICB1aW50IGhvbGRlcklkID0gX2NyZWF0ZUhvbGRlcklkKF9wYXJ0b3duZXIpOwogICAgICAgIGFzc2V0c1tfc3ltYm9sXS5wYXJ0b3duZXJzW2hvbGRlcklkXSA9IHRydWU7CiAgICAgICAgX2RlbGVnYXRlQXNzZXRPd25lckFkZGVkKF9zeW1ib2wsIF9wYXJ0b3duZXIpOwogICAgICAgIENocm9ub0JhbmtQbGF0Zm9ybUVtaXR0ZXIoZXZlbnRzSGlzdG9yeSkuZW1pdE93bmVyc2hpcENoYW5nZSgweDAsIF9wYXJ0b3duZXIsIF9zeW1ib2wpOwogICAgICAgIHJldHVybiBPSzsKICAgIH0KCiAgICAvKioKICAgICogUmVtb3ZlcyBhIGNvLW93bmVyIGZvciBhbiBhc3NldCB3aXRoIHByb3ZpZGVkIHN5bWJvbC4KICAgICogQGRldiBTaG91bGQgYmUgcGVyZm9ybWVkIGJ5IGEgY29udHJhY3Qgb3duZXIgb3IgaXRzIGNvLW93bmVycwogICAgKgogICAgKiBAcGFyYW0gX3N5bWJvbCBhc3NldCdzIHN5bWJvbAogICAgKiBAcGFyYW0gX3BhcnRvd25lciBhIGNvLW93bmVyIG9mIGFuIGFzc2V0CiAgICAqCiAgICAqIEByZXR1cm4gZXJyb3JDb2RlIHJlc3VsdCBjb2RlIG9mIGFuIG9wZXJhdGlvbgogICAgKi8KICAgIGZ1bmN0aW9uIHJlbW92ZUFzc2V0UGFydE93bmVyKGJ5dGVzMzIgX3N5bWJvbCwgYWRkcmVzcyBfcGFydG93bmVyKSBvbmx5T25lT2ZPd25lcnMoX3N5bWJvbCkgcHVibGljIHJldHVybnMgKHVpbnQpIHsKICAgICAgICB1aW50IGhvbGRlcklkID0gZ2V0SG9sZGVySWQoX3BhcnRvd25lcik7CiAgICAgICAgZGVsZXRlIGFzc2V0c1tfc3ltYm9sXS5wYXJ0b3duZXJzW2hvbGRlcklkXTsKICAgICAgICBfZGVsZWdhdGVBc3NldE93bmVyUmVtb3ZlZChfc3ltYm9sLCBfcGFydG93bmVyKTsKICAgICAgICBDaHJvbm9CYW5rUGxhdGZvcm1FbWl0dGVyKGV2ZW50c0hpc3RvcnkpLmVtaXRPd25lcnNoaXBDaGFuZ2UoX3BhcnRvd25lciwgMHgwLCBfc3ltYm9sKTsKICAgICAgICByZXR1cm4gT0s7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXRzIFByb3h5IGNvbnRyYWN0IGFkZHJlc3MgZm9yIGEgcGFydGljdWxhciBhc3NldC4KICAgICAqCiAgICAgKiBDYW4gYmUgc2V0IG9ubHkgb25jZSBmb3IgZWFjaCBhc3NldCwgYW5kIG9ubHkgYnkgY29udHJhY3Qgb3duZXIuCiAgICAgKgogICAgICogQHBhcmFtIF9wcm94eUFkZHJlc3MgUHJveHkgY29udHJhY3QgYWRkcmVzcy4KICAgICAqIEBwYXJhbSBfc3ltYm9sIGFzc2V0IHN5bWJvbC4KICAgICAqCiAgICAgKiBAcmV0dXJuIHN1Y2Nlc3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldFByb3h5KGFkZHJlc3MgX3Byb3h5QWRkcmVzcywgYnl0ZXMzMiBfc3ltYm9sKSBvbmx5T25lT2ZDb250cmFjdE93bmVycyByZXR1cm5zKHVpbnQpIHsKICAgICAgICBpZiAocHJveGllc1tfc3ltYm9sXSAhPSAweDApIHsKICAgICAgICAgICAgcmV0dXJuIENIUk9OT0JBTktfUExBVEZPUk1fUFJPWFlfQUxSRUFEWV9FWElTVFM7CiAgICAgICAgfQoKICAgICAgICBwcm94aWVzW19zeW1ib2xdID0gX3Byb3h5QWRkcmVzczsKICAgICAgICByZXR1cm4gT0s7CiAgICB9CgogICAgLyoqCiAgICAgKiBUcmFuc2ZlcnMgYXNzZXQgYmFsYW5jZSBiZXR3ZWVuIGhvbGRlcnMgd2FsbGV0cy4KICAgICAqCiAgICAgKiBAcGFyYW0gX2Zyb21JZCBob2xkZXIgaWQgdG8gdGFrZSBmcm9tLgogICAgICogQHBhcmFtIF90b0lkIGhvbGRlciBpZCB0byBnaXZlIHRvLgogICAgICogQHBhcmFtIF92YWx1ZSBhbW91bnQgdG8gdHJhbnNmZXIuCiAgICAgKiBAcGFyYW0gX3N5bWJvbCBhc3NldCBzeW1ib2wuCiAgICAgKi8KICAgIGZ1bmN0aW9uIF90cmFuc2ZlckRpcmVjdCh1aW50IF9mcm9tSWQsIHVpbnQgX3RvSWQsIHVpbnQgX3ZhbHVlLCBieXRlczMyIF9zeW1ib2wpIGludGVybmFsIHsKICAgICAgICBhc3NldHNbX3N5bWJvbF0ud2FsbGV0c1tfZnJvbUlkXS5iYWxhbmNlID0gYXNzZXRzW19zeW1ib2xdLndhbGxldHNbX2Zyb21JZF0uYmFsYW5jZS5zdWIoX3ZhbHVlKTsKICAgICAgICBhc3NldHNbX3N5bWJvbF0ud2FsbGV0c1tfdG9JZF0uYmFsYW5jZSA9IGFzc2V0c1tfc3ltYm9sXS53YWxsZXRzW190b0lkXS5iYWxhbmNlLmFkZChfdmFsdWUpOwogICAgfQoKICAgIC8qKgogICAgICogVHJhbnNmZXJzIGFzc2V0IGJhbGFuY2UgYmV0d2VlbiBob2xkZXJzIHdhbGxldHMuCiAgICAgKgogICAgICogUGVyZm9ybXMgc2FuaXR5IGNoZWNrcyBhbmQgdGFrZXMgY2FyZSBvZiBhbGxvd2FuY2VzIGFkanVzdG1lbnQuCiAgICAgKgogICAgICogQHBhcmFtIF9mcm9tSWQgaG9sZGVyIGlkIHRvIHRha2UgZnJvbS4KICAgICAqIEBwYXJhbSBfdG9JZCBob2xkZXIgaWQgdG8gZ2l2ZSB0by4KICAgICAqIEBwYXJhbSBfdmFsdWUgYW1vdW50IHRvIHRyYW5zZmVyLgogICAgICogQHBhcmFtIF9zeW1ib2wgYXNzZXQgc3ltYm9sLgogICAgICogQHBhcmFtIF9yZWZlcmVuY2UgdHJhbnNmZXIgY29tbWVudCB0byBiZSBpbmNsdWRlZCBpbiBhIFRyYW5zZmVyIGV2ZW50LgogICAgICogQHBhcmFtIF9zZW5kZXJJZCB0cmFuc2ZlciBpbml0aWF0b3IgaG9sZGVyIGlkLgogICAgICoKICAgICAqIEByZXR1cm4gc3VjY2Vzcy4KICAgICAqLwogICAgZnVuY3Rpb24gX3RyYW5zZmVyKHVpbnQgX2Zyb21JZCwgdWludCBfdG9JZCwgdWludCBfdmFsdWUsIGJ5dGVzMzIgX3N5bWJvbCwgc3RyaW5nIF9yZWZlcmVuY2UsIHVpbnQgX3NlbmRlcklkKSBpbnRlcm5hbCByZXR1cm5zKHVpbnQpIHsKICAgICAgICAvLyBTaG91bGQgbm90IGFsbG93IHRvIHNlbmQgdG8gb25lc2VsZi4KICAgICAgICBpZiAoX2Zyb21JZCA9PSBfdG9JZCkgewogICAgICAgICAgICByZXR1cm4gX2Vycm9yKENIUk9OT0JBTktfUExBVEZPUk1fQ0FOTk9UX0FQUExZX1RPX09ORVNFTEYpOwogICAgICAgIH0KICAgICAgICAvLyBTaG91bGQgaGF2ZSBwb3NpdGl2ZSB2YWx1ZS4KICAgICAgICBpZiAoX3ZhbHVlID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIF9lcnJvcihDSFJPTk9CQU5LX1BMQVRGT1JNX0lOVkFMSURfVkFMVUUpOwogICAgICAgIH0KICAgICAgICAvLyBTaG91bGQgaGF2ZSBlbm91Z2ggYmFsYW5jZS4KICAgICAgICBpZiAoX2JhbGFuY2VPZihfZnJvbUlkLCBfc3ltYm9sKSA8IF92YWx1ZSkgewogICAgICAgICAgICByZXR1cm4gX2Vycm9yKENIUk9OT0JBTktfUExBVEZPUk1fSU5TVUZGSUNJRU5UX0JBTEFOQ0UpOwogICAgICAgIH0KICAgICAgICAvLyBTaG91bGQgaGF2ZSBlbm91Z2ggYWxsb3dhbmNlLgogICAgICAgIGlmIChfZnJvbUlkICE9IF9zZW5kZXJJZCAmJiBfYWxsb3dhbmNlKF9mcm9tSWQsIF9zZW5kZXJJZCwgX3N5bWJvbCkgPCBfdmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuIF9lcnJvcihDSFJPTk9CQU5LX1BMQVRGT1JNX05PVF9FTk9VR0hfQUxMT1dBTkNFKTsKICAgICAgICB9CgogICAgICAgIF90cmFuc2ZlckRpcmVjdChfZnJvbUlkLCBfdG9JZCwgX3ZhbHVlLCBfc3ltYm9sKTsKICAgICAgICAvLyBBZGp1c3QgYWxsb3dhbmNlLgogICAgICAgIGlmIChfZnJvbUlkICE9IF9zZW5kZXJJZCkgewogICAgICAgICAgICBhc3NldHNbX3N5bWJvbF0ud2FsbGV0c1tfZnJvbUlkXS5hbGxvd2FuY2VbX3NlbmRlcklkXSA9IGFzc2V0c1tfc3ltYm9sXS53YWxsZXRzW19mcm9tSWRdLmFsbG93YW5jZVtfc2VuZGVySWRdLnN1YihfdmFsdWUpOwogICAgICAgIH0KICAgICAgICAvLyBJbnRlcm5hbCBPdXQgT2YgR2FzL1Rocm93OiByZXZlcnQgdGhpcyB0cmFuc2FjdGlvbiB0b287CiAgICAgICAgLy8gQ2FsbCBTdGFjayBEZXB0aCBMaW1pdCByZWFjaGVkOiBuL2EgYWZ0ZXIgSEYgNDsKICAgICAgICAvLyBSZWN1cnNpdmUgQ2FsbDogc2FmZSwgYWxsIGNoYW5nZXMgYWxyZWFkeSBtYWRlLgogICAgICAgIENocm9ub0JhbmtQbGF0Zm9ybUVtaXR0ZXIoZXZlbnRzSGlzdG9yeSkuZW1pdFRyYW5zZmVyKF9hZGRyZXNzKF9mcm9tSWQpLCBfYWRkcmVzcyhfdG9JZCksIF9zeW1ib2wsIF92YWx1ZSwgX3JlZmVyZW5jZSk7CiAgICAgICAgX3Byb3h5VHJhbnNmZXJFdmVudChfZnJvbUlkLCBfdG9JZCwgX3ZhbHVlLCBfc3ltYm9sKTsKICAgICAgICByZXR1cm4gT0s7CiAgICB9CgogICAgLyoqCiAgICAgKiBUcmFuc2ZlcnMgYXNzZXQgYmFsYW5jZSBiZXR3ZWVuIGhvbGRlcnMgd2FsbGV0cy4KICAgICAqCiAgICAgKiBDYW4gb25seSBiZSBjYWxsZWQgYnkgYXNzZXQgcHJveHkuCiAgICAgKgogICAgICogQHBhcmFtIF90byBob2xkZXIgYWRkcmVzcyB0byBnaXZlIHRvLgogICAgICogQHBhcmFtIF92YWx1ZSBhbW91bnQgdG8gdHJhbnNmZXIuCiAgICAgKiBAcGFyYW0gX3N5bWJvbCBhc3NldCBzeW1ib2wuCiAgICAgKiBAcGFyYW0gX3JlZmVyZW5jZSB0cmFuc2ZlciBjb21tZW50IHRvIGJlIGluY2x1ZGVkIGluIGEgVHJhbnNmZXIgZXZlbnQuCiAgICAgKiBAcGFyYW0gX3NlbmRlciB0cmFuc2ZlciBpbml0aWF0b3IgYWRkcmVzcy4KICAgICAqCiAgICAgKiBAcmV0dXJuIHN1Y2Nlc3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHByb3h5VHJhbnNmZXJXaXRoUmVmZXJlbmNlKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSwgYnl0ZXMzMiBfc3ltYm9sLCBzdHJpbmcgX3JlZmVyZW5jZSwgYWRkcmVzcyBfc2VuZGVyKSBvbmx5UHJveHkoX3N5bWJvbCkgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmV0dXJuIF90cmFuc2ZlcihnZXRIb2xkZXJJZChfc2VuZGVyKSwgX2NyZWF0ZUhvbGRlcklkKF90byksIF92YWx1ZSwgX3N5bWJvbCwgX3JlZmVyZW5jZSwgZ2V0SG9sZGVySWQoX3NlbmRlcikpOwogICAgfQoKICAgIC8qKgogICAgICogQXNrIGFzc2V0IFByb3h5IGNvbnRyYWN0IHRvIGVtaXQgRVJDMjAgY29tcGxpYW50IFRyYW5zZmVyIGV2ZW50LgogICAgICoKICAgICAqIEBwYXJhbSBfZnJvbUlkIGhvbGRlciBpZCB0byB0YWtlIGZyb20uCiAgICAgKiBAcGFyYW0gX3RvSWQgaG9sZGVyIGlkIHRvIGdpdmUgdG8uCiAgICAgKiBAcGFyYW0gX3ZhbHVlIGFtb3VudCB0byB0cmFuc2Zlci4KICAgICAqIEBwYXJhbSBfc3ltYm9sIGFzc2V0IHN5bWJvbC4KICAgICAqLwogICAgZnVuY3Rpb24gX3Byb3h5VHJhbnNmZXJFdmVudCh1aW50IF9mcm9tSWQsIHVpbnQgX3RvSWQsIHVpbnQgX3ZhbHVlLCBieXRlczMyIF9zeW1ib2wpIGludGVybmFsIHsKICAgICAgICBpZiAocHJveGllc1tfc3ltYm9sXSAhPSAweDApIHsKICAgICAgICAgICAgLy8gSW50ZXJuYWwgT3V0IE9mIEdhcy9UaHJvdzogcmV2ZXJ0IHRoaXMgdHJhbnNhY3Rpb24gdG9vOwogICAgICAgICAgICAvLyBDYWxsIFN0YWNrIERlcHRoIExpbWl0IHJlYWNoZWQ6IG4vYSBhZnRlciBIRiA0OwogICAgICAgICAgICAvLyBSZWN1cnNpdmUgQ2FsbDogc2FmZSwgYWxsIGNoYW5nZXMgYWxyZWFkeSBtYWRlLgogICAgICAgICAgICBQcm94eUV2ZW50c0VtaXR0ZXIocHJveGllc1tfc3ltYm9sXSkuZW1pdFRyYW5zZmVyKF9hZGRyZXNzKF9mcm9tSWQpLCBfYWRkcmVzcyhfdG9JZCksIF92YWx1ZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyBob2xkZXIgaWQgZm9yIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAgICAqCiAgICAgKiBAcGFyYW0gX2hvbGRlciBob2xkZXIgYWRkcmVzcy4KICAgICAqCiAgICAgKiBAcmV0dXJuIGhvbGRlciBpZC4KICAgICAqLwogICAgZnVuY3Rpb24gZ2V0SG9sZGVySWQoYWRkcmVzcyBfaG9sZGVyKSBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXR1cm4gaG9sZGVySW5kZXhbX2hvbGRlcl07CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGhvbGRlciBpZCBmb3IgdGhlIHNwZWNpZmllZCBhZGRyZXNzLCBjcmVhdGVzIGl0IGlmIG5lZWRlZC4KICAgICAqCiAgICAgKiBAcGFyYW0gX2hvbGRlciBob2xkZXIgYWRkcmVzcy4KICAgICAqCiAgICAgKiBAcmV0dXJuIGhvbGRlciBpZC4KICAgICAqLwogICAgZnVuY3Rpb24gX2NyZWF0ZUhvbGRlcklkKGFkZHJlc3MgX2hvbGRlcikgaW50ZXJuYWwgcmV0dXJucyh1aW50KSB7CiAgICAgICAgdWludCBob2xkZXJJZCA9IGhvbGRlckluZGV4W19ob2xkZXJdOwogICAgICAgIGlmIChob2xkZXJJZCA9PSAwKSB7CiAgICAgICAgICAgIGhvbGRlcklkID0gKytob2xkZXJzQ291bnQ7CiAgICAgICAgICAgIGhvbGRlcnNbaG9sZGVySWRdLmFkZHIgPSBfaG9sZGVyOwogICAgICAgICAgICBob2xkZXJJbmRleFtfaG9sZGVyXSA9IGhvbGRlcklkOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaG9sZGVySWQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBJc3N1ZXMgbmV3IGFzc2V0IHRva2VuIG9uIHRoZSBwbGF0Zm9ybS4KICAgICAqCiAgICAgKiBUb2tlbnMgaXNzdWVkIHdpdGggdGhpcyBjYWxsIGdvIHN0cmFpZ2h0IHRvIGNvbnRyYWN0IG93bmVyLgogICAgICogRWFjaCBzeW1ib2wgY2FuIGJlIGlzc3VlZCBvbmx5IG9uY2UsIGFuZCBvbmx5IGJ5IGNvbnRyYWN0IG93bmVyLgogICAgICoKICAgICAqIEBwYXJhbSBfc3ltYm9sIGFzc2V0IHN5bWJvbC4KICAgICAqIEBwYXJhbSBfdmFsdWUgYW1vdW50IG9mIHRva2VucyB0byBpc3N1ZSBpbW1lZGlhdGVseS4KICAgICAqIEBwYXJhbSBfbmFtZSBuYW1lIG9mIHRoZSBhc3NldC4KICAgICAqIEBwYXJhbSBfZGVzY3JpcHRpb24gZGVzY3JpcHRpb24gZm9yIHRoZSBhc3NldC4KICAgICAqIEBwYXJhbSBfYmFzZVVuaXQgbnVtYmVyIG9mIGRlY2ltYWxzLgogICAgICogQHBhcmFtIF9pc1JlaXNzdWFibGUgZHluYW1pYyBvciBmaXhlZCBzdXBwbHkuCiAgICAgKgogICAgICogQHJldHVybiBzdWNjZXNzLgogICAgICovCiAgICBmdW5jdGlvbiBpc3N1ZUFzc2V0KGJ5dGVzMzIgX3N5bWJvbCwgdWludCBfdmFsdWUsIHN0cmluZyBfbmFtZSwgc3RyaW5nIF9kZXNjcmlwdGlvbiwgdWludDggX2Jhc2VVbml0LCBib29sIF9pc1JlaXNzdWFibGUpIHB1YmxpYyByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXR1cm4gaXNzdWVBc3NldChfc3ltYm9sLCBfdmFsdWUsIF9uYW1lLCBfZGVzY3JpcHRpb24sIF9iYXNlVW5pdCwgX2lzUmVpc3N1YWJsZSwgbXNnLnNlbmRlcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBJc3N1ZXMgbmV3IGFzc2V0IHRva2VuIG9uIHRoZSBwbGF0Zm9ybS4KICAgICAqCiAgICAgKiBUb2tlbnMgaXNzdWVkIHdpdGggdGhpcyBjYWxsIGdvIHN0cmFpZ2h0IHRvIGNvbnRyYWN0IG93bmVyLgogICAgICogRWFjaCBzeW1ib2wgY2FuIGJlIGlzc3VlZCBvbmx5IG9uY2UsIGFuZCBvbmx5IGJ5IGNvbnRyYWN0IG93bmVyLgogICAgICoKICAgICAqIEBwYXJhbSBfc3ltYm9sIGFzc2V0IHN5bWJvbC4KICAgICAqIEBwYXJhbSBfdmFsdWUgYW1vdW50IG9mIHRva2VucyB0byBpc3N1ZSBpbW1lZGlhdGVseS4KICAgICAqIEBwYXJhbSBfbmFtZSBuYW1lIG9mIHRoZSBhc3NldC4KICAgICAqIEBwYXJhbSBfZGVzY3JpcHRpb24gZGVzY3JpcHRpb24gZm9yIHRoZSBhc3NldC4KICAgICAqIEBwYXJhbSBfYmFzZVVuaXQgbnVtYmVyIG9mIGRlY2ltYWxzLgogICAgICogQHBhcmFtIF9pc1JlaXNzdWFibGUgZHluYW1pYyBvciBmaXhlZCBzdXBwbHkuCiAgICAgKiBAcGFyYW0gX2FjY291bnQgYWRkcmVzcyB3aGVyZSBpc3N1ZWQgYmFsYW5jZSB3aWxsIGJlIGhlbGQKICAgICAqCiAgICAgKiBAcmV0dXJuIHN1Y2Nlc3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGlzc3VlQXNzZXQoYnl0ZXMzMiBfc3ltYm9sLCB1aW50IF92YWx1ZSwgc3RyaW5nIF9uYW1lLCBzdHJpbmcgX2Rlc2NyaXB0aW9uLCB1aW50OCBfYmFzZVVuaXQsIGJvb2wgX2lzUmVpc3N1YWJsZSwgYWRkcmVzcyBfYWNjb3VudCkgb25seU9uZU9mQ29udHJhY3RPd25lcnMgcHVibGljIHJldHVybnModWludCkgewogICAgICAgIC8vIFNob3VsZCBoYXZlIHBvc2l0aXZlIHZhbHVlIGlmIHN1cHBseSBpcyBnb2luZyB0byBiZSBmaXhlZC4KICAgICAgICBpZiAoX3ZhbHVlID09IDAgJiYgIV9pc1JlaXNzdWFibGUpIHsKICAgICAgICAgICAgcmV0dXJuIF9lcnJvcihDSFJPTk9CQU5LX1BMQVRGT1JNX0NBTk5PVF9JU1NVRV9GSVhFRF9BU1NFVF9XSVRIX0lOVkFMSURfVkFMVUUpOwogICAgICAgIH0KICAgICAgICAvLyBTaG91bGQgbm90IGJlIGlzc3VlZCB5ZXQuCiAgICAgICAgaWYgKGlzQ3JlYXRlZChfc3ltYm9sKSkgewogICAgICAgICAgICByZXR1cm4gX2Vycm9yKENIUk9OT0JBTktfUExBVEZPUk1fQVNTRVRfQUxSRUFEWV9JU1NVRUQpOwogICAgICAgIH0KICAgICAgICB1aW50IGhvbGRlcklkID0gX2NyZWF0ZUhvbGRlcklkKF9hY2NvdW50KTsKICAgICAgICB1aW50IGNyZWF0b3JJZCA9IF9hY2NvdW50ID09IG1zZy5zZW5kZXIgPyBob2xkZXJJZCA6IF9jcmVhdGVIb2xkZXJJZChtc2cuc2VuZGVyKTsKCiAgICAgICAgc3ltYm9scy5wdXNoKF9zeW1ib2wpOwogICAgICAgIGFzc2V0c1tfc3ltYm9sXSA9IEFzc2V0KGNyZWF0b3JJZCwgX3ZhbHVlLCBfbmFtZSwgX2Rlc2NyaXB0aW9uLCBfaXNSZWlzc3VhYmxlLCBfYmFzZVVuaXQpOwogICAgICAgIGFzc2V0c1tfc3ltYm9sXS53YWxsZXRzW2hvbGRlcklkXS5iYWxhbmNlID0gX3ZhbHVlOwogICAgICAgIC8vIEludGVybmFsIE91dCBPZiBHYXMvVGhyb3c6IHJldmVydCB0aGlzIHRyYW5zYWN0aW9uIHRvbzsKICAgICAgICAvLyBDYWxsIFN0YWNrIERlcHRoIExpbWl0IHJlYWNoZWQ6IG4vYSBhZnRlciBIRiA0OwogICAgICAgIC8vIFJlY3Vyc2l2ZSBDYWxsOiBzYWZlLCBhbGwgY2hhbmdlcyBhbHJlYWR5IG1hZGUuCiAgICAgICAgX2RlbGVnYXRlQXNzZXRPd25lckFkZGVkKF9zeW1ib2wsIF9hZGRyZXNzKGNyZWF0b3JJZCkpOwogICAgICAgIENocm9ub0JhbmtQbGF0Zm9ybUVtaXR0ZXIoZXZlbnRzSGlzdG9yeSkuZW1pdElzc3VlKF9zeW1ib2wsIF92YWx1ZSwgX2FkZHJlc3MoaG9sZGVySWQpKTsKICAgICAgICByZXR1cm4gT0s7CiAgICB9CgogICAgLyoqCiAgICAgKiBJc3N1ZXMgYWRkaXRpb25hbCBhc3NldCB0b2tlbnMgaWYgdGhlIGFzc2V0IGhhdmUgZHluYW1pYyBzdXBwbHkuCiAgICAgKgogICAgICogVG9rZW5zIGlzc3VlZCB3aXRoIHRoaXMgY2FsbCBnbyBzdHJhaWdodCB0byBhc3NldCBvd25lci4KICAgICAqIENhbiBvbmx5IGJlIGNhbGxlZCBieSBhc3NldCBvd25lci4KICAgICAqCiAgICAgKiBAcGFyYW0gX3N5bWJvbCBhc3NldCBzeW1ib2wuCiAgICAgKiBAcGFyYW0gX3ZhbHVlIGFtb3VudCBvZiBhZGRpdGlvbmFsIHRva2VucyB0byBpc3N1ZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIHN1Y2Nlc3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJlaXNzdWVBc3NldChieXRlczMyIF9zeW1ib2wsIHVpbnQgX3ZhbHVlKSBvbmx5T25lT2ZPd25lcnMoX3N5bWJvbCkgcHVibGljIHJldHVybnModWludCkgewogICAgICAgIC8vIFNob3VsZCBoYXZlIHBvc2l0aXZlIHZhbHVlLgogICAgICAgIGlmIChfdmFsdWUgPT0gMCkgewogICAgICAgICAgICByZXR1cm4gX2Vycm9yKENIUk9OT0JBTktfUExBVEZPUk1fSU5WQUxJRF9WQUxVRSk7CiAgICAgICAgfQogICAgICAgIEFzc2V0IHN0b3JhZ2UgYXNzZXQgPSBhc3NldHNbX3N5bWJvbF07CiAgICAgICAgLy8gU2hvdWxkIGhhdmUgZHluYW1pYyBzdXBwbHkuCiAgICAgICAgaWYgKCFhc3NldC5pc1JlaXNzdWFibGUpIHsKICAgICAgICAgICAgcmV0dXJuIF9lcnJvcihDSFJPTk9CQU5LX1BMQVRGT1JNX0NBTk5PVF9SRUlTU1VFX0ZJWEVEX0FTU0VUKTsKICAgICAgICB9CiAgICAgICAgLy8gUmVzdWx0aW5nIHRvdGFsIHN1cHBseSBzaG91bGQgbm90IG92ZXJmbG93LgogICAgICAgIGlmIChhc3NldC50b3RhbFN1cHBseSArIF92YWx1ZSA8IGFzc2V0LnRvdGFsU3VwcGx5KSB7CiAgICAgICAgICAgIHJldHVybiBfZXJyb3IoQ0hST05PQkFOS19QTEFURk9STV9TVVBQTFlfT1ZFUkZMT1cpOwogICAgICAgIH0KICAgICAgICB1aW50IGhvbGRlcklkID0gZ2V0SG9sZGVySWQobXNnLnNlbmRlcik7CiAgICAgICAgYXNzZXQud2FsbGV0c1tob2xkZXJJZF0uYmFsYW5jZSA9IGFzc2V0LndhbGxldHNbaG9sZGVySWRdLmJhbGFuY2UuYWRkKF92YWx1ZSk7CiAgICAgICAgYXNzZXQudG90YWxTdXBwbHkgPSBhc3NldC50b3RhbFN1cHBseS5hZGQoX3ZhbHVlKTsKICAgICAgICAvLyBJbnRlcm5hbCBPdXQgT2YgR2FzL1Rocm93OiByZXZlcnQgdGhpcyB0cmFuc2FjdGlvbiB0b287CiAgICAgICAgLy8gQ2FsbCBTdGFjayBEZXB0aCBMaW1pdCByZWFjaGVkOiBuL2EgYWZ0ZXIgSEYgNDsKICAgICAgICAvLyBSZWN1cnNpdmUgQ2FsbDogc2FmZSwgYWxsIGNoYW5nZXMgYWxyZWFkeSBtYWRlLgogICAgICAgIENocm9ub0JhbmtQbGF0Zm9ybUVtaXR0ZXIoZXZlbnRzSGlzdG9yeSkuZW1pdElzc3VlKF9zeW1ib2wsIF92YWx1ZSwgX2FkZHJlc3MoaG9sZGVySWQpKTsKICAgICAgICBfcHJveHlUcmFuc2ZlckV2ZW50KDAsIGhvbGRlcklkLCBfdmFsdWUsIF9zeW1ib2wpOwogICAgICAgIHJldHVybiBPSzsKICAgIH0KCiAgICAvKioKICAgICAqIERlc3Ryb3lzIHNwZWNpZmllZCBhbW91bnQgb2Ygc2VuZGVycyBhc3NldCB0b2tlbnMuCiAgICAgKgogICAgICogQHBhcmFtIF9zeW1ib2wgYXNzZXQgc3ltYm9sLgogICAgICogQHBhcmFtIF92YWx1ZSBhbW91bnQgb2YgdG9rZW5zIHRvIGRlc3Ryb3kuCiAgICAgKgogICAgICogQHJldHVybiBzdWNjZXNzLgogICAgICovCiAgICBmdW5jdGlvbiByZXZva2VBc3NldChieXRlczMyIF9zeW1ib2wsIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyh1aW50KSB7CiAgICAgICAgLy8gU2hvdWxkIGhhdmUgcG9zaXRpdmUgdmFsdWUuCiAgICAgICAgaWYgKF92YWx1ZSA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBfZXJyb3IoQ0hST05PQkFOS19QTEFURk9STV9JTlZBTElEX1ZBTFVFKTsKICAgICAgICB9CiAgICAgICAgQXNzZXQgc3RvcmFnZSBhc3NldCA9IGFzc2V0c1tfc3ltYm9sXTsKICAgICAgICB1aW50IGhvbGRlcklkID0gZ2V0SG9sZGVySWQobXNnLnNlbmRlcik7CiAgICAgICAgLy8gU2hvdWxkIGhhdmUgZW5vdWdoIHRva2Vucy4KICAgICAgICBpZiAoYXNzZXQud2FsbGV0c1tob2xkZXJJZF0uYmFsYW5jZSA8IF92YWx1ZSkgewogICAgICAgICAgICByZXR1cm4gX2Vycm9yKENIUk9OT0JBTktfUExBVEZPUk1fTk9UX0VOT1VHSF9UT0tFTlMpOwogICAgICAgIH0KICAgICAgICBhc3NldC53YWxsZXRzW2hvbGRlcklkXS5iYWxhbmNlID0gYXNzZXQud2FsbGV0c1tob2xkZXJJZF0uYmFsYW5jZS5zdWIoX3ZhbHVlKTsKICAgICAgICBhc3NldC50b3RhbFN1cHBseSA9IGFzc2V0LnRvdGFsU3VwcGx5LnN1YihfdmFsdWUpOwogICAgICAgIC8vIEludGVybmFsIE91dCBPZiBHYXMvVGhyb3c6IHJldmVydCB0aGlzIHRyYW5zYWN0aW9uIHRvbzsKICAgICAgICAvLyBDYWxsIFN0YWNrIERlcHRoIExpbWl0IHJlYWNoZWQ6IG4vYSBhZnRlciBIRiA0OwogICAgICAgIC8vIFJlY3Vyc2l2ZSBDYWxsOiBzYWZlLCBhbGwgY2hhbmdlcyBhbHJlYWR5IG1hZGUuCiAgICAgICAgQ2hyb25vQmFua1BsYXRmb3JtRW1pdHRlcihldmVudHNIaXN0b3J5KS5lbWl0UmV2b2tlKF9zeW1ib2wsIF92YWx1ZSwgX2FkZHJlc3MoaG9sZGVySWQpKTsKICAgICAgICBfcHJveHlUcmFuc2ZlckV2ZW50KGhvbGRlcklkLCAwLCBfdmFsdWUsIF9zeW1ib2wpOwogICAgICAgIHJldHVybiBPSzsKICAgIH0KCiAgICAvKioKICAgICAqIFBhc3NlcyBhc3NldCBvd25lcnNoaXAgdG8gc3BlY2lmaWVkIGFkZHJlc3MuCiAgICAgKgogICAgICogT25seSBvd25lcnNoaXAgaXMgY2hhbmdlZCwgYmFsYW5jZXMgYXJlIG5vdCB0b3VjaGVkLgogICAgICogQ2FuIG9ubHkgYmUgY2FsbGVkIGJ5IGFzc2V0IG93bmVyLgogICAgICoKICAgICAqIEBwYXJhbSBfc3ltYm9sIGFzc2V0IHN5bWJvbC4KICAgICAqIEBwYXJhbSBfbmV3T3duZXIgYWRkcmVzcyB0byBiZWNvbWUgYSBuZXcgb3duZXIuCiAgICAgKgogICAgICogQHJldHVybiBzdWNjZXNzLgogICAgICovCiAgICBmdW5jdGlvbiBjaGFuZ2VPd25lcnNoaXAoYnl0ZXMzMiBfc3ltYm9sLCBhZGRyZXNzIF9uZXdPd25lcikgb25seU93bmVyKF9zeW1ib2wpIHB1YmxpYyByZXR1cm5zKHVpbnQpIHsKICAgICAgICBpZiAoX25ld093bmVyID09IDB4MCkgewogICAgICAgICAgICByZXR1cm4gX2Vycm9yKENIUk9OT0JBTktfUExBVEZPUk1fSU5WQUxJRF9ORVdfT1dORVIpOwogICAgICAgIH0KCiAgICAgICAgQXNzZXQgc3RvcmFnZSBhc3NldCA9IGFzc2V0c1tfc3ltYm9sXTsKICAgICAgICB1aW50IG5ld093bmVySWQgPSBfY3JlYXRlSG9sZGVySWQoX25ld093bmVyKTsKICAgICAgICAvLyBTaG91bGQgcGFzcyBvd25lcnNoaXAgdG8gYW5vdGhlciBob2xkZXIuCiAgICAgICAgaWYgKGFzc2V0Lm93bmVyID09IG5ld093bmVySWQpIHsKICAgICAgICAgICAgcmV0dXJuIF9lcnJvcihDSFJPTk9CQU5LX1BMQVRGT1JNX0NBTk5PVF9BUFBMWV9UT19PTkVTRUxGKTsKICAgICAgICB9CiAgICAgICAgYWRkcmVzcyBvbGRPd25lciA9IF9hZGRyZXNzKGFzc2V0Lm93bmVyKTsKICAgICAgICBhc3NldC5vd25lciA9IG5ld093bmVySWQ7CiAgICAgICAgLy8gSW50ZXJuYWwgT3V0IE9mIEdhcy9UaHJvdzogcmV2ZXJ0IHRoaXMgdHJhbnNhY3Rpb24gdG9vOwogICAgICAgIC8vIENhbGwgU3RhY2sgRGVwdGggTGltaXQgcmVhY2hlZDogbi9hIGFmdGVyIEhGIDQ7CiAgICAgICAgLy8gUmVjdXJzaXZlIENhbGw6IHNhZmUsIGFsbCBjaGFuZ2VzIGFscmVhZHkgbWFkZS4KICAgICAgICBfZGVsZWdhdGVBc3NldE93bmVyUmVtb3ZlZChfc3ltYm9sLCBvbGRPd25lcik7CiAgICAgICAgX2RlbGVnYXRlQXNzZXRPd25lckFkZGVkKF9zeW1ib2wsIF9uZXdPd25lcik7CiAgICAgICAgQ2hyb25vQmFua1BsYXRmb3JtRW1pdHRlcihldmVudHNIaXN0b3J5KS5lbWl0T3duZXJzaGlwQ2hhbmdlKG9sZE93bmVyLCBfbmV3T3duZXIsIF9zeW1ib2wpOwogICAgICAgIHJldHVybiBPSzsKICAgIH0KCiAgICAvKioKICAgICAqIENoZWNrIGlmIHNwZWNpZmllZCBob2xkZXIgdHJ1c3RzIGFuIGFkZHJlc3Mgd2l0aCByZWNvdmVyeSBwcm9jZWR1cmUuCiAgICAgKgogICAgICogQHBhcmFtIF9mcm9tIHRydXN0ZXIuCiAgICAgKiBAcGFyYW0gX3RvIHRydXN0ZWUuCiAgICAgKgogICAgICogQHJldHVybiB0cnVzdCBleGlzdGFuY2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGlzVHJ1c3RlZChhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bykgY29uc3RhbnQgcmV0dXJucyhib29sKSB7CiAgICAgICAgcmV0dXJuIGhvbGRlcnNbZ2V0SG9sZGVySWQoX2Zyb20pXS50cnVzdFtfdG9dOwogICAgfQoKICAgIC8qKgogICAgICogVHJ1c3QgYW4gYWRkcmVzcyB0byBwZXJmb3JtIHJlY292ZXJ5IHByb2NlZHVyZSBmb3IgdGhlIGNhbGxlci4KICAgICAqCiAgICAgKiBAcGFyYW0gX3RvIHRydXN0ZWUuCiAgICAgKgogICAgICogQHJldHVybiBzdWNjZXNzLgogICAgICovCiAgICBmdW5jdGlvbiB0cnVzdChhZGRyZXNzIF90bykgcmV0dXJucyh1aW50KSB7CiAgICAgICAgdWludCBmcm9tSWQgPSBfY3JlYXRlSG9sZGVySWQobXNnLnNlbmRlcik7CiAgICAgICAgLy8gU2hvdWxkIHRydXN0IHRvIGFub3RoZXIgYWRkcmVzcy4KICAgICAgICBpZiAoZnJvbUlkID09IGdldEhvbGRlcklkKF90bykpIHsKICAgICAgICAgICAgcmV0dXJuIF9lcnJvcihDSFJPTk9CQU5LX1BMQVRGT1JNX0NBTk5PVF9BUFBMWV9UT19PTkVTRUxGKTsKICAgICAgICB9CiAgICAgICAgLy8gU2hvdWxkIHRydXN0IHRvIHlldCB1bnRydXN0ZWQuCiAgICAgICAgaWYgKGlzVHJ1c3RlZChtc2cuc2VuZGVyLCBfdG8pKSB7CiAgICAgICAgICAgIHJldHVybiBfZXJyb3IoQ0hST05PQkFOS19QTEFURk9STV9BTFJFQURZX1RSVVNURUQpOwogICAgICAgIH0KCiAgICAgICAgaG9sZGVyc1tmcm9tSWRdLnRydXN0W190b10gPSB0cnVlOwogICAgICAgIHJldHVybiBPSzsKICAgIH0KCiAgICAvKioKICAgICAqIFJldm9rZSB0cnVzdCB0byBwZXJmb3JtIHJlY292ZXJ5IHByb2NlZHVyZSBmcm9tIGFuIGFkZHJlc3MuCiAgICAgKgogICAgICogQHBhcmFtIF90byB0cnVzdGVlLgogICAgICoKICAgICAqIEByZXR1cm4gc3VjY2Vzcy4KICAgICAqLwogICAgZnVuY3Rpb24gZGlzdHJ1c3QoYWRkcmVzcyBfdG8pIGNoZWNrVHJ1c3QobXNnLnNlbmRlciwgX3RvKSBwdWJsaWMgcmV0dXJucyAodWludCkgewogICAgICAgIGhvbGRlcnNbZ2V0SG9sZGVySWQobXNnLnNlbmRlcildLnRydXN0W190b10gPSBmYWxzZTsKICAgICAgICByZXR1cm4gT0s7CiAgICB9CgogICAgLyoqCiAgICAgKiBQZXJmb3JtIHJlY292ZXJ5IHByb2NlZHVyZS4KICAgICAqCiAgICAgKiBUaGlzIGZ1bmN0aW9uIGxvZ2ljIGlzIGFjdHVhbGx5IG1vcmUgb2YgYW4gYWRkQWNjZXNzKHVpbnQgX2hvbGRlcklkLCBhZGRyZXNzIF90bykuCiAgICAgKiBJdCBncmFudHMgYW5vdGhlciBhZGRyZXNzIGFjY2VzcyB0byByZWNvdmVyeSBzdWJqZWN0IHdhbGxldHMuCiAgICAgKiBDYW4gb25seSBiZSBjYWxsZWQgYnkgdHJ1c3RlZSBvZiByZWNvdmVyeSBzdWJqZWN0LgogICAgICoKICAgICAqIEBwYXJhbSBfZnJvbSBob2xkZXIgYWRkcmVzcyB0byByZWNvdmVyIGZyb20uCiAgICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgdG8gZ3JhbnQgYWNjZXNzIHRvLgogICAgICoKICAgICAqIEByZXR1cm4gc3VjY2Vzcy4KICAgICAqLwogICAgZnVuY3Rpb24gcmVjb3ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bykgY2hlY2tUcnVzdChfZnJvbSwgbXNnLnNlbmRlcikgcHVibGljIHJldHVybnMgKHVpbnQgZXJyb3JDb2RlKSB7CiAgICAgICAgLy8gU2hvdWxkIHJlY292ZXIgdG8gcHJldmlvdXNseSB1bnVzZWQgYWRkcmVzcy4KICAgICAgICBpZiAoZ2V0SG9sZGVySWQoX3RvKSAhPSAwKSB7CiAgICAgICAgICAgIHJldHVybiBfZXJyb3IoQ0hST05PQkFOS19QTEFURk9STV9TSE9VTERfUkVDT1ZFUl9UT19ORVdfQUREUkVTUyk7CiAgICAgICAgfQogICAgICAgIC8vIFdlIHRha2UgY3VycmVudCBob2xkZXIgYWRkcmVzcyBiZWNhdXNlIGl0IG1pZ2h0IG5vdCBlcXVhbCBfZnJvbS4KICAgICAgICAvLyBJdCBpcyBwb3NzaWJsZSB0byByZWNvdmVyIGZyb20gYW55IG9sZCBob2xkZXIgYWRkcmVzcywgYnV0IGV2ZW50IHNob3VsZCBoYXZlIHRoZSBjdXJyZW50IG9uZS4KICAgICAgICBhZGRyZXNzIGZyb20gPSBob2xkZXJzW2dldEhvbGRlcklkKF9mcm9tKV0uYWRkcjsKICAgICAgICBob2xkZXJzW2dldEhvbGRlcklkKF9mcm9tKV0uYWRkciA9IF90bzsKICAgICAgICBob2xkZXJJbmRleFtfdG9dID0gZ2V0SG9sZGVySWQoX2Zyb20pOwogICAgICAgIC8vIEludGVybmFsIE91dCBPZiBHYXMvVGhyb3c6IHJldmVydCB0aGlzIHRyYW5zYWN0aW9uIHRvbzsKICAgICAgICAvLyBDYWxsIFN0YWNrIERlcHRoIExpbWl0IHJlYWNoZWQ6IHJldmVydCB0aGlzIHRyYW5zYWN0aW9uIHRvbzsKICAgICAgICAvLyBSZWN1cnNpdmUgQ2FsbDogc2FmZSwgYWxsIGNoYW5nZXMgYWxyZWFkeSBtYWRlLgogICAgICAgIENocm9ub0JhbmtQbGF0Zm9ybUVtaXR0ZXIoZXZlbnRzSGlzdG9yeSkuZW1pdFJlY292ZXJ5KGZyb20sIF90bywgbXNnLnNlbmRlcik7CiAgICAgICAgcmV0dXJuIE9LOwogICAgfQoKICAgIC8qKgogICAgICogU2V0cyBhc3NldCBzcGVuZGluZyBhbGxvd2FuY2UgZm9yIGEgc3BlY2lmaWVkIHNwZW5kZXIuCiAgICAgKgogICAgICogTm90ZTogdG8gcmV2b2tlIGFsbG93YW5jZSwgb25lIG5lZWRzIHRvIHNldCBhbGxvd2FuY2UgdG8gMC4KICAgICAqCiAgICAgKiBAcGFyYW0gX3NwZW5kZXJJZCBob2xkZXIgaWQgdG8gc2V0IGFsbG93YW5jZSBmb3IuCiAgICAgKiBAcGFyYW0gX3ZhbHVlIGFtb3VudCB0byBhbGxvdy4KICAgICAqIEBwYXJhbSBfc3ltYm9sIGFzc2V0IHN5bWJvbC4KICAgICAqIEBwYXJhbSBfc2VuZGVySWQgYXBwcm92ZSBpbml0aWF0b3IgaG9sZGVyIGlkLgogICAgICoKICAgICAqIEByZXR1cm4gc3VjY2Vzcy4KICAgICAqLwogICAgZnVuY3Rpb24gX2FwcHJvdmUodWludCBfc3BlbmRlcklkLCB1aW50IF92YWx1ZSwgYnl0ZXMzMiBfc3ltYm9sLCB1aW50IF9zZW5kZXJJZCkgaW50ZXJuYWwgcmV0dXJucyh1aW50KSB7CiAgICAgICAgLy8gQXNzZXQgc2hvdWxkIGV4aXN0LgogICAgICAgIGlmICghaXNDcmVhdGVkKF9zeW1ib2wpKSB7CiAgICAgICAgICAgIHJldHVybiBfZXJyb3IoQ0hST05PQkFOS19QTEFURk9STV9BU1NFVF9JU19OT1RfSVNTVUVEKTsKICAgICAgICB9CiAgICAgICAgLy8gU2hvdWxkIGFsbG93IHRvIGFub3RoZXIgaG9sZGVyLgogICAgICAgIGlmIChfc2VuZGVySWQgPT0gX3NwZW5kZXJJZCkgewogICAgICAgICAgICByZXR1cm4gX2Vycm9yKENIUk9OT0JBTktfUExBVEZPUk1fQ0FOTk9UX0FQUExZX1RPX09ORVNFTEYpOwogICAgICAgIH0KCiAgICAgICAgLy8gRG91YmxlIFNwZW5kIEF0dGFjayBjaGVja3BvaW50CiAgICAgICAgaWYgKGFzc2V0c1tfc3ltYm9sXS53YWxsZXRzW19zZW5kZXJJZF0uYWxsb3dhbmNlW19zcGVuZGVySWRdICE9IDAgJiYgX3ZhbHVlICE9IDApIHsKICAgICAgICAgICAgcmV0dXJuIF9lcnJvcihDSFJPTk9CQU5LX1BMQVRGT1JNX0lOVkFMSURfSU5WT0NBVElPTik7CiAgICAgICAgfQoKICAgICAgICBhc3NldHNbX3N5bWJvbF0ud2FsbGV0c1tfc2VuZGVySWRdLmFsbG93YW5jZVtfc3BlbmRlcklkXSA9IF92YWx1ZTsKCiAgICAgICAgLy8gSW50ZXJuYWwgT3V0IE9mIEdhcy9UaHJvdzogcmV2ZXJ0IHRoaXMgdHJhbnNhY3Rpb24gdG9vOwogICAgICAgIC8vIENhbGwgU3RhY2sgRGVwdGggTGltaXQgcmVhY2hlZDogcmV2ZXJ0IHRoaXMgdHJhbnNhY3Rpb24gdG9vOwogICAgICAgIC8vIFJlY3Vyc2l2ZSBDYWxsOiBzYWZlLCBhbGwgY2hhbmdlcyBhbHJlYWR5IG1hZGUuCiAgICAgICAgQ2hyb25vQmFua1BsYXRmb3JtRW1pdHRlcihldmVudHNIaXN0b3J5KS5lbWl0QXBwcm92ZShfYWRkcmVzcyhfc2VuZGVySWQpLCBfYWRkcmVzcyhfc3BlbmRlcklkKSwgX3N5bWJvbCwgX3ZhbHVlKTsKICAgICAgICBpZiAocHJveGllc1tfc3ltYm9sXSAhPSAweDApIHsKICAgICAgICAgICAgLy8gSW50ZXJuYWwgT3V0IE9mIEdhcy9UaHJvdzogcmV2ZXJ0IHRoaXMgdHJhbnNhY3Rpb24gdG9vOwogICAgICAgICAgICAvLyBDYWxsIFN0YWNrIERlcHRoIExpbWl0IHJlYWNoZWQ6IG4vYSBhZnRlciBIRiA0OwogICAgICAgICAgICAvLyBSZWN1cnNpdmUgQ2FsbDogc2FmZSwgYWxsIGNoYW5nZXMgYWxyZWFkeSBtYWRlLgogICAgICAgICAgICBQcm94eUV2ZW50c0VtaXR0ZXIocHJveGllc1tfc3ltYm9sXSkuZW1pdEFwcHJvdmUoX2FkZHJlc3MoX3NlbmRlcklkKSwgX2FkZHJlc3MoX3NwZW5kZXJJZCksIF92YWx1ZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBPSzsKICAgIH0KCiAgICAvKioKICAgICAqIFNldHMgYXNzZXQgc3BlbmRpbmcgYWxsb3dhbmNlIGZvciBhIHNwZWNpZmllZCBzcGVuZGVyLgogICAgICoKICAgICAqIENhbiBvbmx5IGJlIGNhbGxlZCBieSBhc3NldCBwcm94eS4KICAgICAqCiAgICAgKiBAcGFyYW0gX3NwZW5kZXIgaG9sZGVyIGFkZHJlc3MgdG8gc2V0IGFsbG93YW5jZSB0by4KICAgICAqIEBwYXJhbSBfdmFsdWUgYW1vdW50IHRvIGFsbG93LgogICAgICogQHBhcmFtIF9zeW1ib2wgYXNzZXQgc3ltYm9sLgogICAgICogQHBhcmFtIF9zZW5kZXIgYXBwcm92ZSBpbml0aWF0b3IgYWRkcmVzcy4KICAgICAqCiAgICAgKiBAcmV0dXJuIHN1Y2Nlc3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHByb3h5QXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF92YWx1ZSwgYnl0ZXMzMiBfc3ltYm9sLCBhZGRyZXNzIF9zZW5kZXIpIG9ubHlQcm94eShfc3ltYm9sKSBwdWJsaWMgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBfYXBwcm92ZShfY3JlYXRlSG9sZGVySWQoX3NwZW5kZXIpLCBfdmFsdWUsIF9zeW1ib2wsIF9jcmVhdGVIb2xkZXJJZChfc2VuZGVyKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFzc2V0IGFsbG93YW5jZSBmcm9tIG9uZSBob2xkZXIgdG8gYW5vdGhlci4KICAgICAqCiAgICAgKiBAcGFyYW0gX2Zyb20gaG9sZGVyIHRoYXQgYWxsb3dlZCBzcGVuZGluZy4KICAgICAqIEBwYXJhbSBfc3BlbmRlciBob2xkZXIgdGhhdCBpcyBhbGxvd2VkIHRvIHNwZW5kLgogICAgICogQHBhcmFtIF9zeW1ib2wgYXNzZXQgc3ltYm9sLgogICAgICoKICAgICAqIEByZXR1cm4gaG9sZGVyIHRvIHNwZW5kZXIgYWxsb3dhbmNlLgogICAgICovCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfc3BlbmRlciwgYnl0ZXMzMiBfc3ltYm9sKSBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXR1cm4gX2FsbG93YW5jZShnZXRIb2xkZXJJZChfZnJvbSksIGdldEhvbGRlcklkKF9zcGVuZGVyKSwgX3N5bWJvbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFzc2V0IGFsbG93YW5jZSBmcm9tIG9uZSBob2xkZXIgdG8gYW5vdGhlci4KICAgICAqCiAgICAgKiBAcGFyYW0gX2Zyb21JZCBob2xkZXIgaWQgdGhhdCBhbGxvd2VkIHNwZW5kaW5nLgogICAgICogQHBhcmFtIF90b0lkIGhvbGRlciBpZCB0aGF0IGlzIGFsbG93ZWQgdG8gc3BlbmQuCiAgICAgKiBAcGFyYW0gX3N5bWJvbCBhc3NldCBzeW1ib2wuCiAgICAgKgogICAgICogQHJldHVybiBob2xkZXIgdG8gc3BlbmRlciBhbGxvd2FuY2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIF9hbGxvd2FuY2UodWludCBfZnJvbUlkLCB1aW50IF90b0lkLCBieXRlczMyIF9zeW1ib2wpIGNvbnN0YW50IGludGVybmFsIHJldHVybnModWludCkgewogICAgICAgIHJldHVybiBhc3NldHNbX3N5bWJvbF0ud2FsbGV0c1tfZnJvbUlkXS5hbGxvd2FuY2VbX3RvSWRdOwogICAgfQoKICAgIC8qKgogICAgICogUHJmb3JtcyBhbGxvd2FuY2UgdHJhbnNmZXIgb2YgYXNzZXQgYmFsYW5jZSBiZXR3ZWVuIGhvbGRlcnMgd2FsbGV0cy4KICAgICAqCiAgICAgKiBDYW4gb25seSBiZSBjYWxsZWQgYnkgYXNzZXQgcHJveHkuCiAgICAgKgogICAgICogQHBhcmFtIF9mcm9tIGhvbGRlciBhZGRyZXNzIHRvIHRha2UgZnJvbS4KICAgICAqIEBwYXJhbSBfdG8gaG9sZGVyIGFkZHJlc3MgdG8gZ2l2ZSB0by4KICAgICAqIEBwYXJhbSBfdmFsdWUgYW1vdW50IHRvIHRyYW5zZmVyLgogICAgICogQHBhcmFtIF9zeW1ib2wgYXNzZXQgc3ltYm9sLgogICAgICogQHBhcmFtIF9yZWZlcmVuY2UgdHJhbnNmZXIgY29tbWVudCB0byBiZSBpbmNsdWRlZCBpbiBhIFRyYW5zZmVyIGV2ZW50LgogICAgICogQHBhcmFtIF9zZW5kZXIgYWxsb3dhbmNlIHRyYW5zZmVyIGluaXRpYXRvciBhZGRyZXNzLgogICAgICoKICAgICAqIEByZXR1cm4gc3VjY2Vzcy4KICAgICAqLwogICAgZnVuY3Rpb24gcHJveHlUcmFuc2ZlckZyb21XaXRoUmVmZXJlbmNlKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSwgYnl0ZXMzMiBfc3ltYm9sLCBzdHJpbmcgX3JlZmVyZW5jZSwgYWRkcmVzcyBfc2VuZGVyKSBvbmx5UHJveHkoX3N5bWJvbCkgcHVibGljIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gX3RyYW5zZmVyKGdldEhvbGRlcklkKF9mcm9tKSwgX2NyZWF0ZUhvbGRlcklkKF90byksIF92YWx1ZSwgX3N5bWJvbCwgX3JlZmVyZW5jZSwgZ2V0SG9sZGVySWQoX3NlbmRlcikpOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IFRPRE8KICAgICovCiAgICBmdW5jdGlvbiBfZGVsZWdhdGVBc3NldE93bmVyQWRkZWQoYnl0ZXMzMiBfc3ltYm9sLCBhZGRyZXNzIF9vd25lcikgcHJpdmF0ZSB7CiAgICAgICAgaWYgKG93bmluZ0xpc3RlbmVyICE9IDB4MCkgewogICAgICAgICAgICBBc3NldE93bmluZ0xpc3RlbmVyKG93bmluZ0xpc3RlbmVyKS5hc3NldE93bmVyQWRkZWQoX3N5bWJvbCwgdGhpcywgX293bmVyKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgVE9ETwogICAgKi8KICAgIGZ1bmN0aW9uIF9kZWxlZ2F0ZUFzc2V0T3duZXJSZW1vdmVkKGJ5dGVzMzIgX3N5bWJvbCwgYWRkcmVzcyBfb3duZXIpIHByaXZhdGUgewogICAgICAgIGlmIChvd25pbmdMaXN0ZW5lciAhPSAweDApIHsKICAgICAgICAgICAgQXNzZXRPd25pbmdMaXN0ZW5lcihvd25pbmdMaXN0ZW5lcikuYXNzZXRPd25lclJlbW92ZWQoX3N5bWJvbCwgdGhpcywgX293bmVyKTsKICAgICAgICB9CiAgICB9Cn0='.
	

]
