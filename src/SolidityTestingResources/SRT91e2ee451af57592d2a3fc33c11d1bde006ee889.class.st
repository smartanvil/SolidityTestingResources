Class {
	#name : #SRT91e2ee451af57592d2a3fc33c11d1bde006ee889,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT91e2ee451af57592d2a3fc33c11d1bde006ee889 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovLyBBYnN0cmFjdCBjb250cmFjdCBmb3IgdGhlIGZ1bGwgRVJDIDIwIFRva2VuIHN0YW5kYXJkCi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAoKY29udHJhY3QgRVJDMjBUb2tlbiB7CiAgICAvKiBUaGlzIGlzIGEgc2xpZ2h0IGNoYW5nZSB0byB0aGUgRVJDMjAgYmFzZSBzdGFuZGFyZC4KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBzdXBwbHkpOwogICAgaXMgcmVwbGFjZWQgd2l0aDoKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwogICAgVGhpcyBhdXRvbWF0aWNhbGx5IGNyZWF0ZXMgYSBnZXR0ZXIgZnVuY3Rpb24gZm9yIHRoZSB0b3RhbFN1cHBseS4KICAgIFRoaXMgaXMgbW92ZWQgdG8gdGhlIGJhc2UgY29udHJhY3Qgc2luY2UgcHVibGljIGdldHRlciBmdW5jdGlvbnMgYXJlIG5vdAogICAgY3VycmVudGx5IHJlY29nbmlzZWQgYXMgYW4gaW1wbGVtZW50YXRpb24gb2YgdGhlIG1hdGNoaW5nIGFic3RyYWN0CiAgICBmdW5jdGlvbiBieSB0aGUgY29tcGlsZXIuCiAgICAqLwogICAgLy8vIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwoKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIGZyb20gd2hpY2ggdGhlIGJhbGFuY2Ugd2lsbCBiZSByZXRyaWV2ZWQKICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSk7CgogICAgLy8vIEBub3RpY2Ugc2VuZCBgX3ZhbHVlYCB0b2tlbiB0byBgX3RvYCBmcm9tIGBtc2cuc2VuZGVyYAogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbiB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLy8vIEBub3RpY2Ugc2VuZCBgX3ZhbHVlYCB0b2tlbiB0byBgX3RvYCBmcm9tIGBfZnJvbWAgb24gdGhlIGNvbmRpdGlvbiBpdCBpcyBhcHByb3ZlZCBieSBgX2Zyb21gCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIG9mIHRoZSBzZW5kZXIKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvLy8gQG5vdGljZSBgbXNnLnNlbmRlcmAgYXBwcm92ZXMgYF9zcGVuZGVyYCB0byBzcGVuZCBgX3ZhbHVlYCB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBhcHByb3ZlZCBmb3IgdHJhbnNmZXIKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIGFwcHJvdmFsIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBvd25pbmcgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2VucwogICAgLy8vIEByZXR1cm4gQW1vdW50IG9mIHJlbWFpbmluZyB0b2tlbnMgYWxsb3dlZCB0byBzcGVudAogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZyk7CgogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKTsKfQoKLyoKICAgIENvcHlyaWdodCAyMDE2LCBKb3JkaSBCYXlsaW5hCgogICAgVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKICAgIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5CiAgICB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvcgogICAgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KCiAgICBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKICAgIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCiAgICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCiAgICBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgoKICAgIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCiAgICBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KICovCgovLy8gQHRpdGxlIE1pbmlNZVRva2VuIENvbnRyYWN0CgovLy8gQGF1dGhvciBKb3JkaSBCYXlsaW5hCi8vLyBAZGV2IFRoaXMgdG9rZW4gY29udHJhY3QncyBnb2FsIGlzIHRvIG1ha2UgaXQgZWFzeSBmb3IgYW55b25lIHRvIGNsb25lIHRoaXMKLy8vICB0b2tlbiB1c2luZyB0aGUgdG9rZW4gZGlzdHJpYnV0aW9uIGF0IGEgZ2l2ZW4gYmxvY2ssIHRoaXMgd2lsbCBhbGxvdyBEQU8ncwovLy8gIGFuZCBEQXBwcyB0byB1cGdyYWRlIHRoZWlyIGZlYXR1cmVzIGluIGEgZGVjZW50cmFsaXplZCBtYW5uZXIgd2l0aG91dAovLy8gIGFmZmVjdGluZyB0aGUgb3JpZ2luYWwgdG9rZW4KLy8vIEBkZXYgSXQgaXMgRVJDMjAgY29tcGxpYW50LCBidXQgc3RpbGwgbmVlZHMgdG8gdW5kZXIgZ28gZnVydGhlciB0ZXN0aW5nLgoKCi8vLyBAZGV2IFRoZSB0b2tlbiBjb250cm9sbGVyIGNvbnRyYWN0IG11c3QgaW1wbGVtZW50IHRoZXNlIGZ1bmN0aW9ucwpjb250cmFjdCBUb2tlbkNvbnRyb2xsZXIgewogICAgLy8vIEBub3RpY2UgQ2FsbGVkIHdoZW4gYF9vd25lcmAgc2VuZHMgZXRoZXIgdG8gdGhlIE1pbmlNZSBUb2tlbiBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCBzZW50IHRoZSBldGhlciB0byBjcmVhdGUgdG9rZW5zCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSBldGhlciBpcyBhY2NlcHRlZCwgZmFsc2UgaWYgaXQgdGhyb3dzCiAgICBmdW5jdGlvbiBwcm94eVBheW1lbnQoYWRkcmVzcyBfb3duZXIpIHBheWFibGUgcmV0dXJucyhib29sKTsKCiAgICAvLy8gQG5vdGljZSBOb3RpZmllcyB0aGUgY29udHJvbGxlciBhYm91dCBhIHRva2VuIHRyYW5zZmVyIGFsbG93aW5nIHRoZQogICAgLy8vICBjb250cm9sbGVyIHRvIHJlYWN0IGlmIGRlc2lyZWQKICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIG9yaWdpbiBvZiB0aGUgdHJhbnNmZXIKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBkZXN0aW5hdGlvbiBvZiB0aGUgdHJhbnNmZXIKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRoZSB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gRmFsc2UgaWYgdGhlIGNvbnRyb2xsZXIgZG9lcyBub3QgYXV0aG9yaXplIHRoZSB0cmFuc2ZlcgogICAgZnVuY3Rpb24gb25UcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfYW1vdW50KSByZXR1cm5zKGJvb2wpOwoKICAgIC8vLyBAbm90aWNlIE5vdGlmaWVzIHRoZSBjb250cm9sbGVyIGFib3V0IGFuIGFwcHJvdmFsIGFsbG93aW5nIHRoZQogICAgLy8vICBjb250cm9sbGVyIHRvIHJlYWN0IGlmIGRlc2lyZWQKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgY2FsbHMgYGFwcHJvdmUoKWAKICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIHNwZW5kZXIgaW4gdGhlIGBhcHByb3ZlKClgIGNhbGwKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IGluIHRoZSBgYXBwcm92ZSgpYCBjYWxsCiAgICAvLy8gQHJldHVybiBGYWxzZSBpZiB0aGUgY29udHJvbGxlciBkb2VzIG5vdCBhdXRob3JpemUgdGhlIGFwcHJvdmFsCiAgICBmdW5jdGlvbiBvbkFwcHJvdmUoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2Ftb3VudCkKICAgICAgICByZXR1cm5zKGJvb2wpOwp9Cgpjb250cmFjdCBDb250cm9sbGVkIHsKICAgIC8vLyBAbm90aWNlIFRoZSBhZGRyZXNzIG9mIHRoZSBjb250cm9sbGVyIGlzIHRoZSBvbmx5IGFkZHJlc3MgdGhhdCBjYW4gY2FsbAogICAgLy8vICBhIGZ1bmN0aW9uIHdpdGggdGhpcyBtb2RpZmllcgogICAgbW9kaWZpZXIgb25seUNvbnRyb2xsZXIgeyBpZiAobXNnLnNlbmRlciAhPSBjb250cm9sbGVyKSB0aHJvdzsgXzsgfQoKICAgIGFkZHJlc3MgcHVibGljIGNvbnRyb2xsZXI7CgogICAgZnVuY3Rpb24gQ29udHJvbGxlZCgpIHsgY29udHJvbGxlciA9IG1zZy5zZW5kZXI7fQoKICAgIC8vLyBAbm90aWNlIENoYW5nZXMgdGhlIGNvbnRyb2xsZXIgb2YgdGhlIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF9uZXdDb250cm9sbGVyIFRoZSBuZXcgY29udHJvbGxlciBvZiB0aGUgY29udHJhY3QKICAgIGZ1bmN0aW9uIGNoYW5nZUNvbnRyb2xsZXIoYWRkcmVzcyBfbmV3Q29udHJvbGxlcikgb25seUNvbnRyb2xsZXIgewogICAgICAgIGNvbnRyb2xsZXIgPSBfbmV3Q29udHJvbGxlcjsKICAgIH0KfQoKY29udHJhY3QgQXBwcm92ZUFuZENhbGxGYWxsQmFjayB7CiAgICBmdW5jdGlvbiByZWNlaXZlQXBwcm92YWwoYWRkcmVzcyBmcm9tLCB1aW50MjU2IF9hbW91bnQsIGFkZHJlc3MgX3Rva2VuLCBieXRlcyBfZGF0YSk7Cn0KCi8vLyBAZGV2IFRoZSBhY3R1YWwgdG9rZW4gY29udHJhY3QsIHRoZSBkZWZhdWx0IGNvbnRyb2xsZXIgaXMgdGhlIG1zZy5zZW5kZXIKLy8vICB0aGF0IGRlcGxveXMgdGhlIGNvbnRyYWN0LCBzbyB1c3VhbGx5IHRoaXMgdG9rZW4gd2lsbCBiZSBkZXBsb3llZCBieSBhCi8vLyAgdG9rZW4gY29udHJvbGxlciBjb250cmFjdCwgd2hpY2ggR2l2ZXRoIHdpbGwgY2FsbCBhICJDYW1wYWlnbiIKY29udHJhY3QgTWluaU1lVG9rZW4gaXMgQ29udHJvbGxlZCB7CgogICAgc3RyaW5nIHB1YmxpYyBuYW1lOyAgICAgICAgICAgICAgICAvL1RoZSBUb2tlbidzIG5hbWU6IGUuZy4gRGlnaXhEQU8gVG9rZW5zCiAgICB1aW50OCBwdWJsaWMgZGVjaW1hbHM7ICAgICAgICAgICAgIC8vTnVtYmVyIG9mIGRlY2ltYWxzIG9mIHRoZSBzbWFsbGVzdCB1bml0CiAgICBzdHJpbmcgcHVibGljIHN5bWJvbDsgICAgICAgICAgICAgIC8vQW4gaWRlbnRpZmllcjogZS5nLiBSRVAKICAgIHN0cmluZyBwdWJsaWMgdmVyc2lvbiA9ICdNTVRfMC4xJzsgLy9BbiBhcmJpdHJhcnkgdmVyc2lvbmluZyBzY2hlbWUKCgogICAgLy8vIEBkZXYgYENoZWNrcG9pbnRgIGlzIHRoZSBzdHJ1Y3R1cmUgdGhhdCBhdHRhY2hlcyBhIGJsb2NrIG51bWJlciB0byBhCiAgICAvLy8gIGdpdmVuIHZhbHVlLCB0aGUgYmxvY2sgbnVtYmVyIGF0dGFjaGVkIGlzIHRoZSBvbmUgdGhhdCBsYXN0IGNoYW5nZWQgdGhlCiAgICAvLy8gIHZhbHVlCiAgICBzdHJ1Y3QgIENoZWNrcG9pbnQgewoKICAgICAgICAvLyBgZnJvbUJsb2NrYCBpcyB0aGUgYmxvY2sgbnVtYmVyIHRoYXQgdGhlIHZhbHVlIHdhcyBnZW5lcmF0ZWQgZnJvbQogICAgICAgIHVpbnQxMjggZnJvbUJsb2NrOwoKICAgICAgICAvLyBgdmFsdWVgIGlzIHRoZSBhbW91bnQgb2YgdG9rZW5zIGF0IGEgc3BlY2lmaWMgYmxvY2sgbnVtYmVyCiAgICAgICAgdWludDEyOCB2YWx1ZTsKICAgIH0KCiAgICAvLyBgcGFyZW50VG9rZW5gIGlzIHRoZSBUb2tlbiBhZGRyZXNzIHRoYXQgd2FzIGNsb25lZCB0byBwcm9kdWNlIHRoaXMgdG9rZW47CiAgICAvLyAgaXQgd2lsbCBiZSAweDAgZm9yIGEgdG9rZW4gdGhhdCB3YXMgbm90IGNsb25lZAogICAgTWluaU1lVG9rZW4gcHVibGljIHBhcmVudFRva2VuOwoKICAgIC8vIGBwYXJlbnRTbmFwU2hvdEJsb2NrYCBpcyB0aGUgYmxvY2sgbnVtYmVyIGZyb20gdGhlIFBhcmVudCBUb2tlbiB0aGF0IHdhcwogICAgLy8gIHVzZWQgdG8gZGV0ZXJtaW5lIHRoZSBpbml0aWFsIGRpc3RyaWJ1dGlvbiBvZiB0aGUgQ2xvbmUgVG9rZW4KICAgIHVpbnQgcHVibGljIHBhcmVudFNuYXBTaG90QmxvY2s7CgogICAgLy8gYGNyZWF0aW9uQmxvY2tgIGlzIHRoZSBibG9jayBudW1iZXIgdGhhdCB0aGUgQ2xvbmUgVG9rZW4gd2FzIGNyZWF0ZWQKICAgIHVpbnQgcHVibGljIGNyZWF0aW9uQmxvY2s7CgogICAgLy8gYGJhbGFuY2VzYCBpcyB0aGUgbWFwIHRoYXQgdHJhY2tzIHRoZSBiYWxhbmNlIG9mIGVhY2ggYWRkcmVzcywgaW4gdGhpcwogICAgLy8gIGNvbnRyYWN0IHdoZW4gdGhlIGJhbGFuY2UgY2hhbmdlcyB0aGUgYmxvY2sgbnVtYmVyIHRoYXQgdGhlIGNoYW5nZQogICAgLy8gIG9jY3VycmVkIGlzIGFsc28gaW5jbHVkZWQgaW4gdGhlIG1hcAogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBDaGVja3BvaW50W10pIGJhbGFuY2VzOwoKICAgIC8vIGBhbGxvd2VkYCB0cmFja3MgYW55IGV4dHJhIHRyYW5zZmVyIHJpZ2h0cyBhcyBpbiBhbGwgRVJDMjAgdG9rZW5zCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CgogICAgLy8gVHJhY2tzIHRoZSBoaXN0b3J5IG9mIHRoZSBgdG90YWxTdXBwbHlgIG9mIHRoZSB0b2tlbgogICAgQ2hlY2twb2ludFtdIHRvdGFsU3VwcGx5SGlzdG9yeTsKCiAgICAvLyBGbGFnIHRoYXQgZGV0ZXJtaW5lcyBpZiB0aGUgdG9rZW4gaXMgdHJhbnNmZXJhYmxlIG9yIG5vdC4KICAgIGJvb2wgcHVibGljIHRyYW5zZmVyc0VuYWJsZWQ7CgogICAgLy8gVGhlIGZhY3RvcnkgdXNlZCB0byBjcmVhdGUgbmV3IGNsb25lIHRva2VucwogICAgTWluaU1lVG9rZW5GYWN0b3J5IHB1YmxpYyB0b2tlbkZhY3Rvcnk7CgovLy8vLy8vLy8vLy8vLy8vCi8vIENvbnN0cnVjdG9yCi8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBDb25zdHJ1Y3RvciB0byBjcmVhdGUgYSBNaW5pTWVUb2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5GYWN0b3J5IFRoZSBhZGRyZXNzIG9mIHRoZSBNaW5pTWVUb2tlbkZhY3RvcnkgY29udHJhY3QgdGhhdAogICAgLy8vICB3aWxsIGNyZWF0ZSB0aGUgQ2xvbmUgdG9rZW4gY29udHJhY3RzLCB0aGUgdG9rZW4gZmFjdG9yeSBuZWVkcyB0byBiZQogICAgLy8vICBkZXBsb3llZCBmaXJzdAogICAgLy8vIEBwYXJhbSBfcGFyZW50VG9rZW4gQWRkcmVzcyBvZiB0aGUgcGFyZW50IHRva2VuLCBzZXQgdG8gMHgwIGlmIGl0IGlzIGEKICAgIC8vLyAgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF9wYXJlbnRTbmFwU2hvdEJsb2NrIEJsb2NrIG9mIHRoZSBwYXJlbnQgdG9rZW4gdGhhdCB3aWxsCiAgICAvLy8gIGRldGVybWluZSB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gb2YgdGhlIGNsb25lIHRva2VuLCBzZXQgdG8gMCBpZiBpdAogICAgLy8vICBpcyBhIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5OYW1lIE5hbWUgb2YgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfZGVjaW1hbFVuaXRzIE51bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF90b2tlblN5bWJvbCBUb2tlbiBTeW1ib2wgZm9yIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgSWYgdHJ1ZSwgdG9rZW5zIHdpbGwgYmUgYWJsZSB0byBiZSB0cmFuc2ZlcnJlZAogICAgZnVuY3Rpb24gTWluaU1lVG9rZW4oCiAgICAgICAgYWRkcmVzcyBfdG9rZW5GYWN0b3J5LAogICAgICAgIGFkZHJlc3MgX3BhcmVudFRva2VuLAogICAgICAgIHVpbnQgX3BhcmVudFNuYXBTaG90QmxvY2ssCiAgICAgICAgc3RyaW5nIF90b2tlbk5hbWUsCiAgICAgICAgdWludDggX2RlY2ltYWxVbml0cywKICAgICAgICBzdHJpbmcgX3Rva2VuU3ltYm9sLAogICAgICAgIGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQKICAgICkgewogICAgICAgIHRva2VuRmFjdG9yeSA9IE1pbmlNZVRva2VuRmFjdG9yeShfdG9rZW5GYWN0b3J5KTsKICAgICAgICBuYW1lID0gX3Rva2VuTmFtZTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIG5hbWUKICAgICAgICBkZWNpbWFscyA9IF9kZWNpbWFsVW5pdHM7ICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIGRlY2ltYWxzCiAgICAgICAgc3ltYm9sID0gX3Rva2VuU3ltYm9sOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBzeW1ib2wKICAgICAgICBwYXJlbnRUb2tlbiA9IE1pbmlNZVRva2VuKF9wYXJlbnRUb2tlbik7CiAgICAgICAgcGFyZW50U25hcFNob3RCbG9jayA9IF9wYXJlbnRTbmFwU2hvdEJsb2NrOwogICAgICAgIHRyYW5zZmVyc0VuYWJsZWQgPSBfdHJhbnNmZXJzRW5hYmxlZDsKICAgICAgICBjcmVhdGlvbkJsb2NrID0gZ2V0QmxvY2tOdW1iZXIoKTsKICAgIH0KCgovLy8vLy8vLy8vLy8vLy8vLy8vCi8vIEVSQzIwIE1ldGhvZHMKLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIFNlbmQgYF9hbW91bnRgIHRva2VucyB0byBgX3RvYCBmcm9tIGBtc2cuc2VuZGVyYAogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCBvciBub3QKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGlmICghdHJhbnNmZXJzRW5hYmxlZCkgdGhyb3c7CiAgICAgICAgcmV0dXJuIGRvVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfYW1vdW50KTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBTZW5kIGBfYW1vdW50YCB0b2tlbnMgdG8gYF90b2AgZnJvbSBgX2Zyb21gIG9uIHRoZSBjb25kaXRpb24gaXQKICAgIC8vLyAgaXMgYXBwcm92ZWQgYnkgYF9mcm9tYAogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBob2xkaW5nIHRoZSB0b2tlbnMgYmVpbmcgdHJhbnNmZXJyZWQKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50CiAgICApIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewoKICAgICAgICAvLyBUaGUgY29udHJvbGxlciBvZiB0aGlzIGNvbnRyYWN0IGNhbiBtb3ZlIHRva2VucyBhcm91bmQgYXQgd2lsbCwKICAgICAgICAvLyAgdGhpcyBpcyBpbXBvcnRhbnQgdG8gcmVjb2duaXplISBDb25maXJtIHRoYXQgeW91IHRydXN0IHRoZQogICAgICAgIC8vICBjb250cm9sbGVyIG9mIHRoaXMgY29udHJhY3QsIHdoaWNoIGluIG1vc3Qgc2l0dWF0aW9ucyBzaG91bGQgYmUKICAgICAgICAvLyAgYW5vdGhlciBvcGVuIHNvdXJjZSBzbWFydCBjb250cmFjdCBvciAweDAKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBjb250cm9sbGVyKSB7CiAgICAgICAgICAgIGlmICghdHJhbnNmZXJzRW5hYmxlZCkgdGhyb3c7CgogICAgICAgICAgICAvLyBUaGUgc3RhbmRhcmQgRVJDIDIwIHRyYW5zZmVyRnJvbSBmdW5jdGlvbmFsaXR5CiAgICAgICAgICAgIGlmIChhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA8IF9hbW91bnQpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gLT0gX2Ftb3VudDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRvVHJhbnNmZXIoX2Zyb20sIF90bywgX2Ftb3VudCk7CiAgICB9CgogICAgLy8vIEBkZXYgVGhpcyBpcyB0aGUgYWN0dWFsIHRyYW5zZmVyIGZ1bmN0aW9uIGluIHRoZSB0b2tlbiBjb250cmFjdCwgaXQgY2FuCiAgICAvLy8gIG9ubHkgYmUgY2FsbGVkIGJ5IG90aGVyIGZ1bmN0aW9ucyBpbiB0aGlzIGNvbnRyYWN0LgogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBob2xkaW5nIHRoZSB0b2tlbnMgYmVpbmcgdHJhbnNmZXJyZWQKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIGRvVHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX2Ftb3VudAogICAgKSBpbnRlcm5hbCByZXR1cm5zKGJvb2wpIHsKCiAgICAgICAgICAgaWYgKF9hbW91bnQgPT0gMCkgewogICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICB9CgogICAgICAgICAgIGlmIChwYXJlbnRTbmFwU2hvdEJsb2NrID49IGdldEJsb2NrTnVtYmVyKCkpIHRocm93OwoKICAgICAgICAgICAvLyBEbyBub3QgYWxsb3cgdHJhbnNmZXIgdG8gMHgwIG9yIHRoZSB0b2tlbiBjb250cmFjdCBpdHNlbGYKICAgICAgICAgICBpZiAoKF90byA9PSAwKSB8fCAoX3RvID09IGFkZHJlc3ModGhpcykpKSB0aHJvdzsKCiAgICAgICAgICAgLy8gSWYgdGhlIGFtb3VudCBiZWluZyB0cmFuc2ZlcmVkIGlzIG1vcmUgdGhhbiB0aGUgYmFsYW5jZSBvZiB0aGUKICAgICAgICAgICAvLyAgYWNjb3VudCB0aGUgdHJhbnNmZXIgcmV0dXJucyBmYWxzZQogICAgICAgICAgIHZhciBwcmV2aW91c0JhbGFuY2VGcm9tID0gYmFsYW5jZU9mQXQoX2Zyb20sIGdldEJsb2NrTnVtYmVyKCkpOwogICAgICAgICAgIGlmIChwcmV2aW91c0JhbGFuY2VGcm9tIDwgX2Ftb3VudCkgewogICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgfQoKICAgICAgICAgICAvLyBBbGVydHMgdGhlIHRva2VuIGNvbnRyb2xsZXIgb2YgdGhlIHRyYW5zZmVyCiAgICAgICAgICAgaWYgKGlzQ29udHJhY3QoY29udHJvbGxlcikpIHsKICAgICAgICAgICAgICAgaWYgKCFUb2tlbkNvbnRyb2xsZXIoY29udHJvbGxlcikub25UcmFuc2ZlcihfZnJvbSwgX3RvLCBfYW1vdW50KSkKICAgICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgICAgfQoKICAgICAgICAgICAvLyBGaXJzdCB1cGRhdGUgdGhlIGJhbGFuY2UgYXJyYXkgd2l0aCB0aGUgbmV3IHZhbHVlIGZvciB0aGUgYWRkcmVzcwogICAgICAgICAgIC8vICBzZW5kaW5nIHRoZSB0b2tlbnMKICAgICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KGJhbGFuY2VzW19mcm9tXSwgcHJldmlvdXNCYWxhbmNlRnJvbSAtIF9hbW91bnQpOwoKICAgICAgICAgICAvLyBUaGVuIHVwZGF0ZSB0aGUgYmFsYW5jZSBhcnJheSB3aXRoIHRoZSBuZXcgdmFsdWUgZm9yIHRoZSBhZGRyZXNzCiAgICAgICAgICAgLy8gIHJlY2VpdmluZyB0aGUgdG9rZW5zCiAgICAgICAgICAgdmFyIHByZXZpb3VzQmFsYW5jZVRvID0gYmFsYW5jZU9mQXQoX3RvLCBnZXRCbG9ja051bWJlcigpKTsKICAgICAgICAgICBpZiAocHJldmlvdXNCYWxhbmNlVG8gKyBfYW1vdW50IDwgcHJldmlvdXNCYWxhbmNlVG8pIHRocm93OyAvLyBDaGVjayBmb3Igb3ZlcmZsb3cKICAgICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KGJhbGFuY2VzW190b10sIHByZXZpb3VzQmFsYW5jZVRvICsgX2Ftb3VudCk7CgogICAgICAgICAgIC8vIEFuIGV2ZW50IHRvIG1ha2UgdGhlIHRyYW5zZmVyIGVhc3kgdG8gZmluZCBvbiB0aGUgYmxvY2tjaGFpbgogICAgICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF9hbW91bnQpOwoKICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0J3MgYmFsYW5jZSBpcyBiZWluZyByZXF1ZXN0ZWQKICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlIG9mIGBfb3duZXJgIGF0IHRoZSBjdXJyZW50IGJsb2NrCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgICAgIHJldHVybiBiYWxhbmNlT2ZBdChfb3duZXIsIGdldEJsb2NrTnVtYmVyKCkpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgX3NwZW5kZXJgIHRvIHNwZW5kIGBfYW1vdW50YCB0b2tlbnMgb24KICAgIC8vLyAgaXRzIGJlaGFsZi4gVGhpcyBpcyBhIG1vZGlmaWVkIHZlcnNpb24gb2YgdGhlIEVSQzIwIGFwcHJvdmUgZnVuY3Rpb24KICAgIC8vLyAgdG8gYmUgYSBsaXR0bGUgYml0IHNhZmVyCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2VucwogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgYXBwcm92YWwgd2FzIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfYW1vdW50KSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBpZiAoIXRyYW5zZmVyc0VuYWJsZWQpIHRocm93OwoKICAgICAgICAvLyBUbyBjaGFuZ2UgdGhlIGFwcHJvdmUgYW1vdW50IHlvdSBmaXJzdCBoYXZlIHRvIHJlZHVjZSB0aGUgYWRkcmVzc2VzYAogICAgICAgIC8vICBhbGxvd2FuY2UgdG8gemVybyBieSBjYWxsaW5nIGBhcHByb3ZlKF9zcGVuZGVyLDApYCBpZiBpdCBpcyBub3QKICAgICAgICAvLyAgYWxyZWFkeSAwIHRvIG1pdGlnYXRlIHRoZSByYWNlIGNvbmRpdGlvbiBkZXNjcmliZWQgaGVyZToKICAgICAgICAvLyAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgICAgICBpZiAoKF9hbW91bnQhPTApICYmIChhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSAhPTApKSB0aHJvdzsKCiAgICAgICAgLy8gQWxlcnRzIHRoZSB0b2tlbiBjb250cm9sbGVyIG9mIHRoZSBhcHByb3ZlIGZ1bmN0aW9uIGNhbGwKICAgICAgICBpZiAoaXNDb250cmFjdChjb250cm9sbGVyKSkgewogICAgICAgICAgICBpZiAoIVRva2VuQ29udHJvbGxlcihjb250cm9sbGVyKS5vbkFwcHJvdmUobXNnLnNlbmRlciwgX3NwZW5kZXIsIF9hbW91bnQpKQogICAgICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgfQoKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF9hbW91bnQ7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF9hbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAZGV2IFRoaXMgZnVuY3Rpb24gbWFrZXMgaXQgZWFzeSB0byByZWFkIHRoZSBgYWxsb3dlZFtdYCBtYXAKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IHRoYXQgb3ducyB0aGUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHJldHVybiBBbW91bnQgb2YgcmVtYWluaW5nIHRva2VucyBvZiBfb3duZXIgdGhhdCBfc3BlbmRlciBpcyBhbGxvd2VkCiAgICAvLy8gIHRvIHNwZW5kCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIKICAgICkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBgbXNnLnNlbmRlcmAgYXBwcm92ZXMgYF9zcGVuZGVyYCB0byBzZW5kIGBfYW1vdW50YCB0b2tlbnMgb24KICAgIC8vLyAgaXRzIGJlaGFsZiwgYW5kIHRoZW4gYSBmdW5jdGlvbiBpcyB0cmlnZ2VyZWQgaW4gdGhlIGNvbnRyYWN0IHRoYXQgaXMKICAgIC8vLyAgYmVpbmcgYXBwcm92ZWQsIGBfc3BlbmRlcmAuIFRoaXMgYWxsb3dzIHVzZXJzIHRvIHVzZSB0aGVpciB0b2tlbnMgdG8KICAgIC8vLyAgaW50ZXJhY3Qgd2l0aCBjb250cmFjdHMgaW4gb25lIGZ1bmN0aW9uIGNhbGwgaW5zdGVhZCBvZiB0d28KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGNvbnRyYWN0IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2VucwogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgZnVuY3Rpb24gY2FsbCB3YXMgc3VjY2Vzc2Z1bAogICAgZnVuY3Rpb24gYXBwcm92ZUFuZENhbGwoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfYW1vdW50LCBieXRlcyBfZXh0cmFEYXRhCiAgICApIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGlmICghYXBwcm92ZShfc3BlbmRlciwgX2Ftb3VudCkpIHRocm93OwoKICAgICAgICBBcHByb3ZlQW5kQ2FsbEZhbGxCYWNrKF9zcGVuZGVyKS5yZWNlaXZlQXBwcm92YWwoCiAgICAgICAgICAgIG1zZy5zZW5kZXIsCiAgICAgICAgICAgIF9hbW91bnQsCiAgICAgICAgICAgIHRoaXMsCiAgICAgICAgICAgIF9leHRyYURhdGEKICAgICAgICApOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBUaGlzIGZ1bmN0aW9uIG1ha2VzIGl0IGVhc3kgdG8gZ2V0IHRoZSB0b3RhbCBudW1iZXIgb2YgdG9rZW5zCiAgICAvLy8gQHJldHVybiBUaGUgdG90YWwgbnVtYmVyIG9mIHRva2VucwogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHRvdGFsU3VwcGx5QXQoZ2V0QmxvY2tOdW1iZXIoKSk7CiAgICB9CgoKLy8vLy8vLy8vLy8vLy8vLwovLyBRdWVyeSBiYWxhbmNlIGFuZCB0b3RhbFN1cHBseSBpbiBIaXN0b3J5Ci8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQGRldiBRdWVyaWVzIHRoZSBiYWxhbmNlIG9mIGBfb3duZXJgIGF0IGEgc3BlY2lmaWMgYF9ibG9ja051bWJlcmAKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIGZyb20gd2hpY2ggdGhlIGJhbGFuY2Ugd2lsbCBiZSByZXRyaWV2ZWQKICAgIC8vLyBAcGFyYW0gX2Jsb2NrTnVtYmVyIFRoZSBibG9jayBudW1iZXIgd2hlbiB0aGUgYmFsYW5jZSBpcyBxdWVyaWVkCiAgICAvLy8gQHJldHVybiBUaGUgYmFsYW5jZSBhdCBgX2Jsb2NrTnVtYmVyYAogICAgZnVuY3Rpb24gYmFsYW5jZU9mQXQoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2Jsb2NrTnVtYmVyKSBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQpIHsKCiAgICAgICAgLy8gVGhlc2UgbmV4dCBmZXcgbGluZXMgYXJlIHVzZWQgd2hlbiB0aGUgYmFsYW5jZSBvZiB0aGUgdG9rZW4gaXMKICAgICAgICAvLyAgcmVxdWVzdGVkIGJlZm9yZSBhIGNoZWNrIHBvaW50IHdhcyBldmVyIGNyZWF0ZWQgZm9yIHRoaXMgdG9rZW4sIGl0CiAgICAgICAgLy8gIHJlcXVpcmVzIHRoYXQgdGhlIGBwYXJlbnRUb2tlbi5iYWxhbmNlT2ZBdGAgYmUgcXVlcmllZCBhdCB0aGUKICAgICAgICAvLyAgZ2VuZXNpcyBibG9jayBmb3IgdGhhdCB0b2tlbiBhcyB0aGlzIGNvbnRhaW5zIGluaXRpYWwgYmFsYW5jZSBvZgogICAgICAgIC8vICB0aGlzIHRva2VuCiAgICAgICAgaWYgKChiYWxhbmNlc1tfb3duZXJdLmxlbmd0aCA9PSAwKQogICAgICAgICAgICB8fCAoYmFsYW5jZXNbX293bmVyXVswXS5mcm9tQmxvY2sgPiBfYmxvY2tOdW1iZXIpKSB7CiAgICAgICAgICAgIGlmIChhZGRyZXNzKHBhcmVudFRva2VuKSAhPSAwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcGFyZW50VG9rZW4uYmFsYW5jZU9mQXQoX293bmVyLCBtaW4oX2Jsb2NrTnVtYmVyLCBwYXJlbnRTbmFwU2hvdEJsb2NrKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBIYXMgbm8gcGFyZW50CiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgfQoKICAgICAgICAvLyBUaGlzIHdpbGwgcmV0dXJuIHRoZSBleHBlY3RlZCBiYWxhbmNlIGR1cmluZyBub3JtYWwgc2l0dWF0aW9ucwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBnZXRWYWx1ZUF0KGJhbGFuY2VzW19vd25lcl0sIF9ibG9ja051bWJlcik7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAbm90aWNlIFRvdGFsIGFtb3VudCBvZiB0b2tlbnMgYXQgYSBzcGVjaWZpYyBgX2Jsb2NrTnVtYmVyYC4KICAgIC8vLyBAcGFyYW0gX2Jsb2NrTnVtYmVyIFRoZSBibG9jayBudW1iZXIgd2hlbiB0aGUgdG90YWxTdXBwbHkgaXMgcXVlcmllZAogICAgLy8vIEByZXR1cm4gVGhlIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMgYXQgYF9ibG9ja051bWJlcmAKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5QXQodWludCBfYmxvY2tOdW1iZXIpIGNvbnN0YW50IHJldHVybnModWludCkgewoKICAgICAgICAvLyBUaGVzZSBuZXh0IGZldyBsaW5lcyBhcmUgdXNlZCB3aGVuIHRoZSB0b3RhbFN1cHBseSBvZiB0aGUgdG9rZW4gaXMKICAgICAgICAvLyAgcmVxdWVzdGVkIGJlZm9yZSBhIGNoZWNrIHBvaW50IHdhcyBldmVyIGNyZWF0ZWQgZm9yIHRoaXMgdG9rZW4sIGl0CiAgICAgICAgLy8gIHJlcXVpcmVzIHRoYXQgdGhlIGBwYXJlbnRUb2tlbi50b3RhbFN1cHBseUF0YCBiZSBxdWVyaWVkIGF0IHRoZQogICAgICAgIC8vICBnZW5lc2lzIGJsb2NrIGZvciB0aGlzIHRva2VuIGFzIHRoYXQgY29udGFpbnMgdG90YWxTdXBwbHkgb2YgdGhpcwogICAgICAgIC8vICB0b2tlbiBhdCB0aGlzIGJsb2NrIG51bWJlci4KICAgICAgICBpZiAoKHRvdGFsU3VwcGx5SGlzdG9yeS5sZW5ndGggPT0gMCkKICAgICAgICAgICAgfHwgKHRvdGFsU3VwcGx5SGlzdG9yeVswXS5mcm9tQmxvY2sgPiBfYmxvY2tOdW1iZXIpKSB7CiAgICAgICAgICAgIGlmIChhZGRyZXNzKHBhcmVudFRva2VuKSAhPSAwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcGFyZW50VG9rZW4udG90YWxTdXBwbHlBdChtaW4oX2Jsb2NrTnVtYmVyLCBwYXJlbnRTbmFwU2hvdEJsb2NrKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgfQoKICAgICAgICAvLyBUaGlzIHdpbGwgcmV0dXJuIHRoZSBleHBlY3RlZCB0b3RhbFN1cHBseSBkdXJpbmcgbm9ybWFsIHNpdHVhdGlvbnMKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZ2V0VmFsdWVBdCh0b3RhbFN1cHBseUhpc3RvcnksIF9ibG9ja051bWJlcik7CiAgICAgICAgfQogICAgfQoKLy8vLy8vLy8vLy8vLy8vLwovLyBDbG9uZSBUb2tlbiBNZXRob2QKLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIENyZWF0ZXMgYSBuZXcgY2xvbmUgdG9rZW4gd2l0aCB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gYmVpbmcKICAgIC8vLyAgdGhpcyB0b2tlbiBhdCBgX3NuYXBzaG90QmxvY2tgCiAgICAvLy8gQHBhcmFtIF9jbG9uZVRva2VuTmFtZSBOYW1lIG9mIHRoZSBjbG9uZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfY2xvbmVEZWNpbWFsVW5pdHMgTnVtYmVyIG9mIGRlY2ltYWxzIG9mIHRoZSBzbWFsbGVzdCB1bml0CiAgICAvLy8gQHBhcmFtIF9jbG9uZVRva2VuU3ltYm9sIFN5bWJvbCBvZiB0aGUgY2xvbmUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3NuYXBzaG90QmxvY2sgQmxvY2sgd2hlbiB0aGUgZGlzdHJpYnV0aW9uIG9mIHRoZSBwYXJlbnQgdG9rZW4gaXMKICAgIC8vLyAgY29waWVkIHRvIHNldCB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gb2YgdGhlIG5ldyBjbG9uZSB0b2tlbjsKICAgIC8vLyAgaWYgdGhlIGJsb2NrIGlzIHplcm8gdGhhbiB0aGUgYWN0dWFsIGJsb2NrLCB0aGUgY3VycmVudCBibG9jayBpcyB1c2VkCiAgICAvLy8gQHBhcmFtIF90cmFuc2ZlcnNFbmFibGVkIFRydWUgaWYgdHJhbnNmZXJzIGFyZSBhbGxvd2VkIGluIHRoZSBjbG9uZQogICAgLy8vIEByZXR1cm4gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBNaW5pTWVUb2tlbiBDb250cmFjdAogICAgZnVuY3Rpb24gY3JlYXRlQ2xvbmVUb2tlbigKICAgICAgICBzdHJpbmcgX2Nsb25lVG9rZW5OYW1lLAogICAgICAgIHVpbnQ4IF9jbG9uZURlY2ltYWxVbml0cywKICAgICAgICBzdHJpbmcgX2Nsb25lVG9rZW5TeW1ib2wsCiAgICAgICAgdWludCBfc25hcHNob3RCbG9jaywKICAgICAgICBib29sIF90cmFuc2ZlcnNFbmFibGVkCiAgICAgICAgKSByZXR1cm5zKGFkZHJlc3MpIHsKICAgICAgICBpZiAoX3NuYXBzaG90QmxvY2sgPT0gMCkgX3NuYXBzaG90QmxvY2sgPSBnZXRCbG9ja051bWJlcigpOwogICAgICAgIE1pbmlNZVRva2VuIGNsb25lVG9rZW4gPSB0b2tlbkZhY3RvcnkuY3JlYXRlQ2xvbmVUb2tlbigKICAgICAgICAgICAgdGhpcywKICAgICAgICAgICAgX3NuYXBzaG90QmxvY2ssCiAgICAgICAgICAgIF9jbG9uZVRva2VuTmFtZSwKICAgICAgICAgICAgX2Nsb25lRGVjaW1hbFVuaXRzLAogICAgICAgICAgICBfY2xvbmVUb2tlblN5bWJvbCwKICAgICAgICAgICAgX3RyYW5zZmVyc0VuYWJsZWQKICAgICAgICAgICAgKTsKCiAgICAgICAgY2xvbmVUb2tlbi5jaGFuZ2VDb250cm9sbGVyKG1zZy5zZW5kZXIpOwoKICAgICAgICAvLyBBbiBldmVudCB0byBtYWtlIHRoZSB0b2tlbiBlYXN5IHRvIGZpbmQgb24gdGhlIGJsb2NrY2hhaW4KICAgICAgICBOZXdDbG9uZVRva2VuKGFkZHJlc3MoY2xvbmVUb2tlbiksIF9zbmFwc2hvdEJsb2NrKTsKICAgICAgICByZXR1cm4gYWRkcmVzcyhjbG9uZVRva2VuKTsKICAgIH0KCi8vLy8vLy8vLy8vLy8vLy8KLy8gR2VuZXJhdGUgYW5kIGRlc3Ryb3kgdG9rZW5zCi8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBHZW5lcmF0ZXMgYF9hbW91bnRgIHRva2VucyB0aGF0IGFyZSBhc3NpZ25lZCB0byBgX293bmVyYAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIGJlIGFzc2lnbmVkIHRoZSBuZXcgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIHF1YW50aXR5IG9mIHRva2VucyBnZW5lcmF0ZWQKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIHRva2VucyBhcmUgZ2VuZXJhdGVkIGNvcnJlY3RseQogICAgZnVuY3Rpb24gZ2VuZXJhdGVUb2tlbnMoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2Ftb3VudAogICAgKSBvbmx5Q29udHJvbGxlciByZXR1cm5zIChib29sKSB7CiAgICAgICAgdWludCBjdXJUb3RhbFN1cHBseSA9IGdldFZhbHVlQXQodG90YWxTdXBwbHlIaXN0b3J5LCBnZXRCbG9ja051bWJlcigpKTsKICAgICAgICBpZiAoY3VyVG90YWxTdXBwbHkgKyBfYW1vdW50IDwgY3VyVG90YWxTdXBwbHkpIHRocm93OyAvLyBDaGVjayBmb3Igb3ZlcmZsb3cKICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KHRvdGFsU3VwcGx5SGlzdG9yeSwgY3VyVG90YWxTdXBwbHkgKyBfYW1vdW50KTsKICAgICAgICB2YXIgcHJldmlvdXNCYWxhbmNlVG8gPSBiYWxhbmNlT2YoX293bmVyKTsKICAgICAgICBpZiAocHJldmlvdXNCYWxhbmNlVG8gKyBfYW1vdW50IDwgcHJldmlvdXNCYWxhbmNlVG8pIHRocm93OyAvLyBDaGVjayBmb3Igb3ZlcmZsb3cKICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KGJhbGFuY2VzW19vd25lcl0sIHByZXZpb3VzQmFsYW5jZVRvICsgX2Ftb3VudCk7CiAgICAgICAgVHJhbnNmZXIoMCwgX293bmVyLCBfYW1vdW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCgogICAgLy8vIEBub3RpY2UgQnVybnMgYF9hbW91bnRgIHRva2VucyBmcm9tIGBfb3duZXJgCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgbG9zZSB0aGUgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIHF1YW50aXR5IG9mIHRva2VucyB0byBidXJuCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSB0b2tlbnMgYXJlIGJ1cm5lZCBjb3JyZWN0bHkKICAgIGZ1bmN0aW9uIGRlc3Ryb3lUb2tlbnMoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2Ftb3VudAogICAgKSBvbmx5Q29udHJvbGxlciByZXR1cm5zIChib29sKSB7CiAgICAgICAgdWludCBjdXJUb3RhbFN1cHBseSA9IGdldFZhbHVlQXQodG90YWxTdXBwbHlIaXN0b3J5LCBnZXRCbG9ja051bWJlcigpKTsKICAgICAgICBpZiAoY3VyVG90YWxTdXBwbHkgPCBfYW1vdW50KSB0aHJvdzsKICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KHRvdGFsU3VwcGx5SGlzdG9yeSwgY3VyVG90YWxTdXBwbHkgLSBfYW1vdW50KTsKICAgICAgICB2YXIgcHJldmlvdXNCYWxhbmNlRnJvbSA9IGJhbGFuY2VPZihfb3duZXIpOwogICAgICAgIGlmIChwcmV2aW91c0JhbGFuY2VGcm9tIDwgX2Ftb3VudCkgdGhyb3c7CiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfb3duZXJdLCBwcmV2aW91c0JhbGFuY2VGcm9tIC0gX2Ftb3VudCk7CiAgICAgICAgVHJhbnNmZXIoX293bmVyLCAwLCBfYW1vdW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCi8vLy8vLy8vLy8vLy8vLy8KLy8gRW5hYmxlIHRva2VucyB0cmFuc2ZlcnMKLy8vLy8vLy8vLy8vLy8vLwoKCiAgICAvLy8gQG5vdGljZSBFbmFibGVzIHRva2VuIGhvbGRlcnMgdG8gdHJhbnNmZXIgdGhlaXIgdG9rZW5zIGZyZWVseSBpZiB0cnVlCiAgICAvLy8gQHBhcmFtIF90cmFuc2ZlcnNFbmFibGVkIFRydWUgaWYgdHJhbnNmZXJzIGFyZSBhbGxvd2VkIGluIHRoZSBjbG9uZQogICAgZnVuY3Rpb24gZW5hYmxlVHJhbnNmZXJzKGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQpIG9ubHlDb250cm9sbGVyIHsKICAgICAgICB0cmFuc2ZlcnNFbmFibGVkID0gX3RyYW5zZmVyc0VuYWJsZWQ7CiAgICB9CgovLy8vLy8vLy8vLy8vLy8vCi8vIEludGVybmFsIGhlbHBlciBmdW5jdGlvbnMgdG8gcXVlcnkgYW5kIHNldCBhIHZhbHVlIGluIGEgc25hcHNob3QgYXJyYXkKLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAZGV2IGBnZXRWYWx1ZUF0YCByZXRyaWV2ZXMgdGhlIG51bWJlciBvZiB0b2tlbnMgYXQgYSBnaXZlbiBibG9jayBudW1iZXIKICAgIC8vLyBAcGFyYW0gY2hlY2twb2ludHMgVGhlIGhpc3Rvcnkgb2YgdmFsdWVzIGJlaW5nIHF1ZXJpZWQKICAgIC8vLyBAcGFyYW0gX2Jsb2NrIFRoZSBibG9jayBudW1iZXIgdG8gcmV0cmlldmUgdGhlIHZhbHVlIGF0CiAgICAvLy8gQHJldHVybiBUaGUgbnVtYmVyIG9mIHRva2VucyBiZWluZyBxdWVyaWVkCiAgICBmdW5jdGlvbiBnZXRWYWx1ZUF0KENoZWNrcG9pbnRbXSBzdG9yYWdlIGNoZWNrcG9pbnRzLCB1aW50IF9ibG9jawogICAgKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgaWYgKGNoZWNrcG9pbnRzLmxlbmd0aCA9PSAwKSByZXR1cm4gMDsKCiAgICAgICAgLy8gU2hvcnRjdXQgZm9yIHRoZSBhY3R1YWwgdmFsdWUKICAgICAgICBpZiAoX2Jsb2NrID49IGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aC0xXS5mcm9tQmxvY2spCiAgICAgICAgICAgIHJldHVybiBjaGVja3BvaW50c1tjaGVja3BvaW50cy5sZW5ndGgtMV0udmFsdWU7CiAgICAgICAgaWYgKF9ibG9jayA8IGNoZWNrcG9pbnRzWzBdLmZyb21CbG9jaykgcmV0dXJuIDA7CgogICAgICAgIC8vIEJpbmFyeSBzZWFyY2ggb2YgdGhlIHZhbHVlIGluIHRoZSBhcnJheQogICAgICAgIHVpbnQgbWluID0gMDsKICAgICAgICB1aW50IG1heCA9IGNoZWNrcG9pbnRzLmxlbmd0aC0xOwogICAgICAgIHdoaWxlIChtYXggPiBtaW4pIHsKICAgICAgICAgICAgdWludCBtaWQgPSAobWF4ICsgbWluICsgMSkvIDI7CiAgICAgICAgICAgIGlmIChjaGVja3BvaW50c1ttaWRdLmZyb21CbG9jazw9X2Jsb2NrKSB7CiAgICAgICAgICAgICAgICBtaW4gPSBtaWQ7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtYXggPSBtaWQtMTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gY2hlY2twb2ludHNbbWluXS52YWx1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBgdXBkYXRlVmFsdWVBdE5vd2AgdXNlZCB0byB1cGRhdGUgdGhlIGBiYWxhbmNlc2AgbWFwIGFuZCB0aGUKICAgIC8vLyAgYHRvdGFsU3VwcGx5SGlzdG9yeWAKICAgIC8vLyBAcGFyYW0gY2hlY2twb2ludHMgVGhlIGhpc3Rvcnkgb2YgZGF0YSBiZWluZyB1cGRhdGVkCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgbmV3IG51bWJlciBvZiB0b2tlbnMKICAgIGZ1bmN0aW9uIHVwZGF0ZVZhbHVlQXROb3coQ2hlY2twb2ludFtdIHN0b3JhZ2UgY2hlY2twb2ludHMsIHVpbnQgX3ZhbHVlCiAgICApIGludGVybmFsICB7CiAgICAgICAgaWYgKChjaGVja3BvaW50cy5sZW5ndGggPT0gMCkKICAgICAgICB8fCAoY2hlY2twb2ludHNbY2hlY2twb2ludHMubGVuZ3RoIC0xXS5mcm9tQmxvY2sgPCBnZXRCbG9ja051bWJlcigpKSkgewogICAgICAgICAgICAgICBDaGVja3BvaW50IG5ld0NoZWNrUG9pbnQgPSBjaGVja3BvaW50c1sgY2hlY2twb2ludHMubGVuZ3RoKysgXTsKICAgICAgICAgICAgICAgbmV3Q2hlY2tQb2ludC5mcm9tQmxvY2sgPSAgdWludDEyOChnZXRCbG9ja051bWJlcigpKTsKICAgICAgICAgICAgICAgbmV3Q2hlY2tQb2ludC52YWx1ZSA9IHVpbnQxMjgoX3ZhbHVlKTsKICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICBDaGVja3BvaW50IG9sZENoZWNrUG9pbnQgPSBjaGVja3BvaW50c1tjaGVja3BvaW50cy5sZW5ndGgtMV07CiAgICAgICAgICAgICAgIG9sZENoZWNrUG9pbnQudmFsdWUgPSB1aW50MTI4KF92YWx1ZSk7CiAgICAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IEludGVybmFsIGZ1bmN0aW9uIHRvIGRldGVybWluZSBpZiBhbiBhZGRyZXNzIGlzIGEgY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX2FkZHIgVGhlIGFkZHJlc3MgYmVpbmcgcXVlcmllZAogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBgX2FkZHJgIGlzIGEgY29udHJhY3QKICAgIGZ1bmN0aW9uIGlzQ29udHJhY3QoYWRkcmVzcyBfYWRkcikgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyhib29sKSB7CiAgICAgICAgdWludCBzaXplOwogICAgICAgIGlmIChfYWRkciA9PSAwKSByZXR1cm4gZmFsc2U7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBzaXplIDo9IGV4dGNvZGVzaXplKF9hZGRyKQogICAgICAgIH0KICAgICAgICByZXR1cm4gc2l6ZT4wOwogICAgfQoKICAgIC8vLyBAZGV2IEhlbHBlciBmdW5jdGlvbiB0byByZXR1cm4gYSBtaW4gYmV0d2VuIHRoZSB0d28gdWludHMKICAgIGZ1bmN0aW9uIG1pbih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFRoZSBmYWxsYmFjayBmdW5jdGlvbjogSWYgdGhlIGNvbnRyYWN0J3MgY29udHJvbGxlciBoYXMgbm90IGJlZW4KICAgIC8vLyAgc2V0IHRvIDAsIHRoZW4gdGhlIGBwcm94eVBheW1lbnRgIG1ldGhvZCBpcyBjYWxsZWQgd2hpY2ggcmVsYXlzIHRoZQogICAgLy8vICBldGhlciBhbmQgY3JlYXRlcyB0b2tlbnMgYXMgZGVzY3JpYmVkIGluIHRoZSB0b2tlbiBjb250cm9sbGVyIGNvbnRyYWN0CiAgICBmdW5jdGlvbiAoKSAgcGF5YWJsZSB7CiAgICAgICAgaWYgKGlzQ29udHJhY3QoY29udHJvbGxlcikpIHsKICAgICAgICAgICAgaWYgKCEgVG9rZW5Db250cm9sbGVyKGNvbnRyb2xsZXIpLnByb3h5UGF5bWVudC52YWx1ZShtc2cudmFsdWUpKG1zZy5zZW5kZXIpKQogICAgICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgfQogICAgfQoKCi8vLy8vLy8vLy8KLy8gVGVzdGluZyBzcGVjaWZpYyBtZXRob2RzCi8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBUaGlzIGZ1bmN0aW9uIGlzIG92ZXJyaWRkZW4gYnkgdGhlIHRlc3QgTW9ja3MuCiAgICBmdW5jdGlvbiBnZXRCbG9ja051bWJlcigpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gYmxvY2subnVtYmVyOwogICAgfQoKLy8vLy8vLy8vLwovLyBTYWZldHkgTWV0aG9kcwovLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgVGhpcyBtZXRob2QgY2FuIGJlIHVzZWQgYnkgdGhlIGNvbnRyb2xsZXIgdG8gZXh0cmFjdCBtaXN0YWtlbmx5CiAgICAvLy8gIHNlbnQgdG9rZW5zIHRvIHRoaXMgY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIF90b2tlbiBUaGUgYWRkcmVzcyBvZiB0aGUgdG9rZW4gY29udHJhY3QgdGhhdCB5b3Ugd2FudCB0byByZWNvdmVyCiAgICAvLy8gIHNldCB0byAwIGluIGNhc2UgeW91IHdhbnQgdG8gZXh0cmFjdCBldGhlci4KICAgIGZ1bmN0aW9uIGNsYWltVG9rZW5zKGFkZHJlc3MgX3Rva2VuKSBvbmx5Q29udHJvbGxlciB7CiAgICAgICAgaWYgKF90b2tlbiA9PSAweDApIHsKICAgICAgICAgICAgY29udHJvbGxlci50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBFUkMyMFRva2VuIHRva2VuID0gRVJDMjBUb2tlbihfdG9rZW4pOwogICAgICAgIHVpbnQgYmFsYW5jZSA9IHRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgICAgICB0b2tlbi50cmFuc2Zlcihjb250cm9sbGVyLCBiYWxhbmNlKTsKICAgICAgICBDbGFpbWVkVG9rZW5zKF90b2tlbiwgY29udHJvbGxlciwgYmFsYW5jZSk7CiAgICB9CgovLy8vLy8vLy8vLy8vLy8vCi8vIEV2ZW50cwovLy8vLy8vLy8vLy8vLy8vCgogICAgZXZlbnQgQ2xhaW1lZFRva2VucyhhZGRyZXNzIGluZGV4ZWQgX3Rva2VuLCBhZGRyZXNzIGluZGV4ZWQgX2NvbnRyb2xsZXIsIHVpbnQgX2Ftb3VudCk7CiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX2Ftb3VudCk7CiAgICBldmVudCBOZXdDbG9uZVRva2VuKGFkZHJlc3MgaW5kZXhlZCBfY2xvbmVUb2tlbiwgdWludCBfc25hcHNob3RCbG9jayk7CiAgICBldmVudCBBcHByb3ZhbCgKICAgICAgICBhZGRyZXNzIGluZGV4ZWQgX293bmVyLAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwKICAgICAgICB1aW50MjU2IF9hbW91bnQKICAgICAgICApOwoKfQoKCi8vLy8vLy8vLy8vLy8vLy8KLy8gTWluaU1lVG9rZW5GYWN0b3J5Ci8vLy8vLy8vLy8vLy8vLy8KCi8vLyBAZGV2IFRoaXMgY29udHJhY3QgaXMgdXNlZCB0byBnZW5lcmF0ZSBjbG9uZSBjb250cmFjdHMgZnJvbSBhIGNvbnRyYWN0LgovLy8gIEluIHNvbGlkaXR5IHRoaXMgaXMgdGhlIHdheSB0byBjcmVhdGUgYSBjb250cmFjdCBmcm9tIGEgY29udHJhY3Qgb2YgdGhlCi8vLyAgc2FtZSBjbGFzcwpjb250cmFjdCBNaW5pTWVUb2tlbkZhY3RvcnkgewoKICAgIC8vLyBAbm90aWNlIFVwZGF0ZSB0aGUgREFwcCBieSBjcmVhdGluZyBhIG5ldyB0b2tlbiB3aXRoIG5ldyBmdW5jdGlvbmFsaXRpZXMKICAgIC8vLyAgdGhlIG1zZy5zZW5kZXIgYmVjb21lcyB0aGUgY29udHJvbGxlciBvZiB0aGlzIGNsb25lIHRva2VuCiAgICAvLy8gQHBhcmFtIF9wYXJlbnRUb2tlbiBBZGRyZXNzIG9mIHRoZSB0b2tlbiBiZWluZyBjbG9uZWQKICAgIC8vLyBAcGFyYW0gX3NuYXBzaG90QmxvY2sgQmxvY2sgb2YgdGhlIHBhcmVudCB0b2tlbiB0aGF0IHdpbGwKICAgIC8vLyAgZGV0ZXJtaW5lIHRoZSBpbml0aWFsIGRpc3RyaWJ1dGlvbiBvZiB0aGUgY2xvbmUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3Rva2VuTmFtZSBOYW1lIG9mIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX2RlY2ltYWxVbml0cyBOdW1iZXIgb2YgZGVjaW1hbHMgb2YgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5TeW1ib2wgVG9rZW4gU3ltYm9sIGZvciB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF90cmFuc2ZlcnNFbmFibGVkIElmIHRydWUsIHRva2VucyB3aWxsIGJlIGFibGUgdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcmV0dXJuIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgdG9rZW4gY29udHJhY3QKICAgIGZ1bmN0aW9uIGNyZWF0ZUNsb25lVG9rZW4oCiAgICAgICAgYWRkcmVzcyBfcGFyZW50VG9rZW4sCiAgICAgICAgdWludCBfc25hcHNob3RCbG9jaywKICAgICAgICBzdHJpbmcgX3Rva2VuTmFtZSwKICAgICAgICB1aW50OCBfZGVjaW1hbFVuaXRzLAogICAgICAgIHN0cmluZyBfdG9rZW5TeW1ib2wsCiAgICAgICAgYm9vbCBfdHJhbnNmZXJzRW5hYmxlZAogICAgKSByZXR1cm5zIChNaW5pTWVUb2tlbikgewogICAgICAgIE1pbmlNZVRva2VuIG5ld1Rva2VuID0gbmV3IE1pbmlNZVRva2VuKAogICAgICAgICAgICB0aGlzLAogICAgICAgICAgICBfcGFyZW50VG9rZW4sCiAgICAgICAgICAgIF9zbmFwc2hvdEJsb2NrLAogICAgICAgICAgICBfdG9rZW5OYW1lLAogICAgICAgICAgICBfZGVjaW1hbFVuaXRzLAogICAgICAgICAgICBfdG9rZW5TeW1ib2wsCiAgICAgICAgICAgIF90cmFuc2ZlcnNFbmFibGVkCiAgICAgICAgICAgICk7CgogICAgICAgIG5ld1Rva2VuLmNoYW5nZUNvbnRyb2xsZXIobXNnLnNlbmRlcik7CiAgICAgICAgcmV0dXJuIG5ld1Rva2VuOwogICAgfQp9CgovLy8gQGRldiBgT3duZWRgIGlzIGEgYmFzZSBsZXZlbCBjb250cmFjdCB0aGF0IGFzc2lnbnMgYW4gYG93bmVyYCB0aGF0IGNhbiBiZQovLy8gIGxhdGVyIGNoYW5nZWQKY29udHJhY3QgT3duZWQgewoKICAgIC8vLyBAZGV2IGBvd25lcmAgaXMgdGhlIG9ubHkgYWRkcmVzcyB0aGF0IGNhbiBjYWxsIGEgZnVuY3Rpb24gd2l0aCB0aGlzCiAgICAvLy8gbW9kaWZpZXIKICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgICAgICBpZihtc2cuc2VuZGVyICE9IG93bmVyKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwoKICAgIC8vLyBAbm90aWNlIFRoZSBDb25zdHJ1Y3RvciBhc3NpZ25zIHRoZSBtZXNzYWdlIHNlbmRlciB0byBiZSBgb3duZXJgCiAgICBmdW5jdGlvbiBPd25lZCgpIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9CgogICAgYWRkcmVzcyBwdWJsaWMgbmV3T3duZXI7CgogICAgLy8vIEBub3RpY2UgYG93bmVyYCBjYW4gc3RlcCBkb3duIGFuZCBhc3NpZ24gc29tZSBvdGhlciBhZGRyZXNzIHRvIHRoaXMgcm9sZQogICAgLy8vIEBwYXJhbSBfbmV3T3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBvd25lci4gMHgwIGNhbiBiZSB1c2VkIHRvIGNyZWF0ZQogICAgLy8vICBhbiB1bm93bmVkIG5ldXRyYWwgdmF1bHQsIGhvd2V2ZXIgdGhhdCBjYW5ub3QgYmUgdW5kb25lCiAgICBmdW5jdGlvbiBjaGFuZ2VPd25lcihhZGRyZXNzIF9uZXdPd25lcikgb25seU93bmVyIHsKICAgICAgICBuZXdPd25lciA9IF9uZXdPd25lcjsKICAgIH0KCgogICAgZnVuY3Rpb24gYWNjZXB0T3duZXJzaGlwKCkgewogICAgICAgIGlmIChtc2cuc2VuZGVyID09IG5ld093bmVyKSB7CiAgICAgICAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICAgICAgfQogICAgfQp9CgovKioKICogTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcwogKi8KbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGRpdih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtaW42NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtYXgyNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQp9Cgpjb250cmFjdCBBVFRDb250cmlidXRpb24gaXMgT3duZWQsIFRva2VuQ29udHJvbGxlciB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICB1aW50MjU2IGNvbnN0YW50IHB1YmxpYyBleGNoYW5nZVJhdGUgPSA2MDA7ICAgLy8gd2lsbCBiZSBzZXQgYmVmb3JlIHRoZSB0b2tlbiBzYWxlLgogICAgdWludDI1NiBjb25zdGFudCBwdWJsaWMgbWF4R2FzUHJpY2UgPSA1MDAwMDAwMDAwMDsgIC8vIDUwR1dlaQoKICAgIHVpbnQyNTYgcHVibGljIG1heEZpcnN0Um91bmRUb2tlbkxpbWl0ID0gMjAwMDAwMDAgZXRoZXI7IC8vIEFUVCBoYXZlIHNhbWUgcHJlY2lzaW9uIHdpdGggRVRICgogICAgdWludDI1NiBwdWJsaWMgbWF4SXNzdWVUb2tlbkxpbWl0ID0gNzAwMDAwMDAgZXRoZXI7IC8vIEFUVCBoYXZlIHNhbWUgcHJlY2lzaW9uIHdpdGggRVRICgogICAgTWluaU1lVG9rZW4gcHVibGljICBBVFQ7ICAgICAgICAgICAgLy8gVGhlIEFUVCB0b2tlbiBpdHNlbGYKCiAgICBhZGRyZXNzIHB1YmxpYyBhdHRDb250cm9sbGVyOwoKICAgIGFkZHJlc3MgcHVibGljIGRlc3RFdGhGb3VuZGF0aW9uOwogICAgYWRkcmVzcyBwdWJsaWMgZGVzdFRva2Vuc0FuZ2VsOwoKICAgIHVpbnQyNTYgcHVibGljIHN0YXJ0VGltZTsKICAgIHVpbnQyNTYgcHVibGljIGVuZFRpbWU7CgogICAgdWludDI1NiBwdWJsaWMgdG90YWxOb3JtYWxUb2tlbkdlbmVyYXRlZDsKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsTm9ybWFsRXRoZXJDb2xsZWN0ZWQ7CgogICAgdWludDI1NiBwdWJsaWMgdG90YWxJc3N1ZVRva2VuR2VuZXJhdGVkOwoKICAgIHVpbnQyNTYgcHVibGljIGZpbmFsaXplZEJsb2NrOwogICAgdWludDI1NiBwdWJsaWMgZmluYWxpemVkVGltZTsKCiAgICBib29sIHB1YmxpYyBwYXVzZWQ7CgogICAgbW9kaWZpZXIgaW5pdGlhbGl6ZWQoKSB7CiAgICAgICAgcmVxdWlyZShhZGRyZXNzKEFUVCkgIT0gMHgwKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGNvbnRyaWJ1dGlvbk9wZW4oKSB7CiAgICAgICAgcmVxdWlyZSh0aW1lKCkgPj0gc3RhcnRUaW1lICYmCiAgICAgICAgICAgICAgdGltZSgpIDw9IGVuZFRpbWUgJiYKICAgICAgICAgICAgICBmaW5hbGl6ZWRCbG9jayA9PSAwICYmCiAgICAgICAgICAgICAgYWRkcmVzcyhBVFQpICE9IDB4MCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBub3RQYXVzZWQoKSB7CiAgICAgICAgcmVxdWlyZSghcGF1c2VkKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIEFUVENvbnRyaWJ1dGlvbigpIHsKICAgICAgICBwYXVzZWQgPSBmYWxzZTsKICAgIH0KCgogICAgLy8vIEBub3RpY2UgVGhpcyBtZXRob2Qgc2hvdWxkIGJlIGNhbGxlZCBieSB0aGUgb3duZXIgYmVmb3JlIHRoZSBjb250cmlidXRpb24KICAgIC8vLyAgcGVyaW9kIHN0YXJ0cyBUaGlzIGluaXRpYWxpemVzIG1vc3Qgb2YgdGhlIHBhcmFtZXRlcnMKICAgIC8vLyBAcGFyYW0gX2F0dCBBZGRyZXNzIG9mIHRoZSBBVFQgdG9rZW4gY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX2F0dENvbnRyb2xsZXIgVG9rZW4gY29udHJvbGxlciBmb3IgdGhlIEFUVCB0aGF0IHdpbGwgYmUgdHJhbnNmZXJyZWQgYWZ0ZXIKICAgIC8vLyAgdGhlIGNvbnRyaWJ1dGlvbiBmaW5hbGl6ZXMuCiAgICAvLy8gQHBhcmFtIF9zdGFydFRpbWUgVGltZSB3aGVuIHRoZSBjb250cmlidXRpb24gcGVyaW9kIHN0YXJ0cwogICAgLy8vIEBwYXJhbSBfZW5kVGltZSBUaGUgdGltZSB0aGF0IHRoZSBjb250cmlidXRpb24gcGVyaW9kIGVuZHMKICAgIC8vLyBAcGFyYW0gX2Rlc3RFdGhGb3VuZGF0aW9uIERlc3RpbmF0aW9uIGFkZHJlc3Mgd2hlcmUgdGhlIGNvbnRyaWJ1dGlvbiBldGhlciBpcyBzZW50CiAgICAvLy8gQHBhcmFtIF9kZXN0VG9rZW5zQW5nZWwgQWRkcmVzcyB3aGVyZSB0aGUgdG9rZW5zIGZvciB0aGUgYW5nZWxzIGFyZSBzZW50CiAgICBmdW5jdGlvbiBpbml0aWFsaXplKAogICAgICAgIGFkZHJlc3MgX2F0dCwKICAgICAgICBhZGRyZXNzIF9hdHRDb250cm9sbGVyLAogICAgICAgIHVpbnQgX3N0YXJ0VGltZSwKICAgICAgICB1aW50IF9lbmRUaW1lLAogICAgICAgIGFkZHJlc3MgX2Rlc3RFdGhGb3VuZGF0aW9uLAogICAgICAgIGFkZHJlc3MgX2Rlc3RUb2tlbnNBbmdlbAogICAgKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgLy8gSW5pdGlhbGl6ZSBvbmx5IG9uY2UKICAgICAgcmVxdWlyZShhZGRyZXNzKEFUVCkgPT0gMHgwKTsKCiAgICAgIEFUVCA9IE1pbmlNZVRva2VuKF9hdHQpOwogICAgICByZXF1aXJlKEFUVC50b3RhbFN1cHBseSgpID09IDApOwogICAgICByZXF1aXJlKEFUVC5jb250cm9sbGVyKCkgPT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgIHJlcXVpcmUoQVRULmRlY2ltYWxzKCkgPT0gMTgpOyAgLy8gU2FtZSBhbW91bnQgb2YgZGVjaW1hbHMgYXMgRVRICgogICAgICBzdGFydFRpbWUgPSBfc3RhcnRUaW1lOwogICAgICBlbmRUaW1lID0gX2VuZFRpbWU7CgogICAgICBhc3NlcnQoc3RhcnRUaW1lIDwgZW5kVGltZSk7CgogICAgICByZXF1aXJlKF9hdHRDb250cm9sbGVyICE9IDB4MCk7CiAgICAgIGF0dENvbnRyb2xsZXIgPSBfYXR0Q29udHJvbGxlcjsKCiAgICAgIHJlcXVpcmUoX2Rlc3RFdGhGb3VuZGF0aW9uICE9IDB4MCk7CiAgICAgIGRlc3RFdGhGb3VuZGF0aW9uID0gX2Rlc3RFdGhGb3VuZGF0aW9uOwoKICAgICAgcmVxdWlyZShfZGVzdFRva2Vuc0FuZ2VsICE9IDB4MCk7CiAgICAgIGRlc3RUb2tlbnNBbmdlbCA9IF9kZXN0VG9rZW5zQW5nZWw7CiAgfQoKICAvLy8gQG5vdGljZSBJZiBhbnlib2R5IHNlbmRzIEV0aGVyIGRpcmVjdGx5IHRvIHRoaXMgY29udHJhY3QsIGNvbnNpZGVyIGhlIGlzCiAgLy8vICBnZXR0aW5nIEFUVHMuCiAgZnVuY3Rpb24gKCkgcHVibGljIHBheWFibGUgbm90UGF1c2VkIHsKICAgICAgcHJveHlQYXltZW50KG1zZy5zZW5kZXIpOwogIH0KCgogIC8vLy8vLy8vLy8KICAvLyBNaW5pTWUgQ29udHJvbGxlciBmdW5jdGlvbnMKICAvLy8vLy8vLy8vCgogIC8vLyBAbm90aWNlIFRoaXMgbWV0aG9kIHdpbGwgZ2VuZXJhbGx5IGJlIGNhbGxlZCBieSB0aGUgQVRUIHRva2VuIGNvbnRyYWN0IHRvCiAgLy8vICBhY3F1aXJlIEFUVHMuIE9yIGRpcmVjdGx5IGZyb20gdGhpcmQgcGFydGllcyB0aGF0IHdhbnQgdG8gYWNxdWlyZSBBVFRzIGluCiAgLy8vICBiZWhhbGYgb2YgYSB0b2tlbiBob2xkZXIuCiAgLy8vIEBwYXJhbSBfdGggQVRUIGhvbGRlciB3aGVyZSB0aGUgQVRUcyB3aWxsIGJlIG1pbnRlZC4KICBmdW5jdGlvbiBwcm94eVBheW1lbnQoYWRkcmVzcyBfdGgpIHB1YmxpYyBwYXlhYmxlIG5vdFBhdXNlZCBpbml0aWFsaXplZCBjb250cmlidXRpb25PcGVuIHJldHVybnMgKGJvb2wpIHsKICAgICAgcmVxdWlyZShfdGggIT0gMHgwKTsKCiAgICAgIGJ1eU5vcm1hbChfdGgpOwoKICAgICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiBvblRyYW5zZmVyKGFkZHJlc3MsIGFkZHJlc3MsIHVpbnQyNTYpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICB9CgogIGZ1bmN0aW9uIG9uQXBwcm92ZShhZGRyZXNzLCBhZGRyZXNzLCB1aW50MjU2KSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgfQoKICBmdW5jdGlvbiBidXlOb3JtYWwoYWRkcmVzcyBfdGgpIGludGVybmFsIHsKICAgICAgcmVxdWlyZSh0eC5nYXNwcmljZSA8PSBtYXhHYXNQcmljZSk7CiAgICAgIAogICAgICAvLyBBbnRpc3BhbSBtZWNoYW5pc20KICAgICAgLy8gVE9ETzogSXMgdGhpcyBjaGVja2luZyB1c2VmdWw/CiAgICAgIGFkZHJlc3MgY2FsbGVyOwogICAgICBpZiAobXNnLnNlbmRlciA9PSBhZGRyZXNzKEFUVCkpIHsKICAgICAgICAgIGNhbGxlciA9IF90aDsKICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNhbGxlciA9IG1zZy5zZW5kZXI7CiAgICAgIH0KCiAgICAgIC8vIERvIG5vdCBhbGxvdyBjb250cmFjdHMgdG8gZ2FtZSB0aGUgc3lzdGVtCiAgICAgIHJlcXVpcmUoIWlzQ29udHJhY3QoY2FsbGVyKSk7CgogICAgICBkb0J1eShfdGgsIG1zZy52YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiBkb0J1eShhZGRyZXNzIF90aCwgdWludDI1NiBfdG9GdW5kKSBpbnRlcm5hbCB7CiAgICAgIHJlcXVpcmUodHguZ2FzcHJpY2UgPD0gbWF4R2FzUHJpY2UpOwoKICAgICAgYXNzZXJ0KG1zZy52YWx1ZSA+PSBfdG9GdW5kKTsgIC8vIE5vdCBuZWVkZWQsIGJ1dCBkb3VibGUgY2hlY2suCiAgICAgIGFzc2VydCh0b3RhbE5vcm1hbFRva2VuR2VuZXJhdGVkIDwgbWF4Rmlyc3RSb3VuZFRva2VuTGltaXQpOwoKICAgICAgdWludDI1NiBlbmRPZkZpcnN0V2VlayA9IHN0YXJ0VGltZS5hZGQoMSB3ZWVrcyk7CiAgICAgIHVpbnQyNTYgZW5kT2ZTZWNvbmRXZWVrID0gc3RhcnRUaW1lLmFkZCgyIHdlZWtzKTsKICAgICAgdWludDI1NiBmaW5hbEV4Y2hhbmdlUmF0ZSA9IGV4Y2hhbmdlUmF0ZTsKICAgICAgaWYgKG5vdyA8IGVuZE9mRmlyc3RXZWVrKQogICAgICB7CiAgICAgICAgICAvLyAxMCUgQm9udXMgaW4gZmlyc3Qgd2VlawogICAgICAgICAgZmluYWxFeGNoYW5nZVJhdGUgPSBleGNoYW5nZVJhdGUubXVsKDExMCkuZGl2KDEwMCk7CiAgICAgIH0gZWxzZSBpZiAobm93IDwgZW5kT2ZTZWNvbmRXZWVrKQogICAgICB7CiAgICAgICAgICAvLyA1JSBCb251cyBpbiBzZWNvbmQgd2VlawogICAgICAgICAgZmluYWxFeGNoYW5nZVJhdGUgPSBleGNoYW5nZVJhdGUubXVsKDEwNSkuZGl2KDEwMCk7CiAgICAgIH0KCiAgICAgIGlmIChfdG9GdW5kID4gMCkgewogICAgICAgICAgdWludDI1NiB0b2tlbnNHZW5lcmF0aW5nID0gX3RvRnVuZC5tdWwoZmluYWxFeGNoYW5nZVJhdGUpOwoKICAgICAgICAgIHVpbnQyNTYgdG9rZW5zVG9CZUdlbmVyYXRlZCA9IHRvdGFsTm9ybWFsVG9rZW5HZW5lcmF0ZWQuYWRkKHRva2Vuc0dlbmVyYXRpbmcpOwogICAgICAgICAgaWYgKHRva2Vuc1RvQmVHZW5lcmF0ZWQgPiBtYXhGaXJzdFJvdW5kVG9rZW5MaW1pdCkKICAgICAgICAgIHsKICAgICAgICAgICAgICB0b2tlbnNHZW5lcmF0aW5nID0gbWF4Rmlyc3RSb3VuZFRva2VuTGltaXQgLSB0b3RhbE5vcm1hbFRva2VuR2VuZXJhdGVkOwogICAgICAgICAgICAgIF90b0Z1bmQgPSB0b2tlbnNHZW5lcmF0aW5nLmRpdihmaW5hbEV4Y2hhbmdlUmF0ZSk7CiAgICAgICAgICB9CgogICAgICAgICAgYXNzZXJ0KEFUVC5nZW5lcmF0ZVRva2VucyhfdGgsIHRva2Vuc0dlbmVyYXRpbmcpKTsKICAgICAgICAgIGRlc3RFdGhGb3VuZGF0aW9uLnRyYW5zZmVyKF90b0Z1bmQpOwoKICAgICAgICAgIHRvdGFsTm9ybWFsVG9rZW5HZW5lcmF0ZWQgPSB0b3RhbE5vcm1hbFRva2VuR2VuZXJhdGVkLmFkZCh0b2tlbnNHZW5lcmF0aW5nKTsKCiAgICAgICAgICB0b3RhbE5vcm1hbEV0aGVyQ29sbGVjdGVkID0gdG90YWxOb3JtYWxFdGhlckNvbGxlY3RlZC5hZGQoX3RvRnVuZCk7CgogICAgICAgICAgTmV3U2FsZShfdGgsIF90b0Z1bmQsIHRva2Vuc0dlbmVyYXRpbmcpOwogICAgICB9CgogICAgICB1aW50MjU2IHRvUmV0dXJuID0gbXNnLnZhbHVlLnN1YihfdG9GdW5kKTsKICAgICAgaWYgKHRvUmV0dXJuID4gMCkgewogICAgICAgICAgLy8gVE9ETzogSWYgdGhlIGNhbGwgY29tZXMgZnJvbSB0aGUgVG9rZW4gY29udHJvbGxlciwKICAgICAgICAgIC8vIHRoZW4gd2UgcmV0dXJuIGl0IHRvIHRoZSB0b2tlbiBIb2xkZXIuCiAgICAgICAgICAvLyBPdGhlcndpc2Ugd2UgcmV0dXJuIHRvIHRoZSBzZW5kZXIuCiAgICAgICAgICBpZiAobXNnLnNlbmRlciA9PSBhZGRyZXNzKEFUVCkpIHsKICAgICAgICAgICAgICBfdGgudHJhbnNmZXIodG9SZXR1cm4pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKHRvUmV0dXJuKTsKICAgICAgICAgIH0KICAgICAgfQogIH0KCiAgZnVuY3Rpb24gaXNzdWVUb2tlblRvR3VhcmFudGVlZEFkZHJlc3MoYWRkcmVzcyBfdGgsIHVpbnQyNTYgX2Ftb3VudCwgYnl0ZXMgZGF0YSkgb25seU93bmVyIGluaXRpYWxpemVkIG5vdFBhdXNlZCBjb250cmlidXRpb25PcGVuIHsKICAgICAgcmVxdWlyZSh0b3RhbElzc3VlVG9rZW5HZW5lcmF0ZWQuYWRkKF9hbW91bnQpIDw9IG1heElzc3VlVG9rZW5MaW1pdCk7CgogICAgICBhc3NlcnQoQVRULmdlbmVyYXRlVG9rZW5zKF90aCwgX2Ftb3VudCkpOwoKICAgICAgdG90YWxJc3N1ZVRva2VuR2VuZXJhdGVkID0gdG90YWxJc3N1ZVRva2VuR2VuZXJhdGVkLmFkZChfYW1vdW50KTsKCiAgICAgIE5ld0lzc3VlKF90aCwgX2Ftb3VudCwgZGF0YSk7CiAgfQoKICBmdW5jdGlvbiBhZGp1c3RMaW1pdEJldHdlZW5Jc3N1ZUFuZE5vcm1hbCh1aW50MjU2IF9hbW91bnQsIGJvb2wgX2lzQWRkVG9Ob3JtYWwpIG9ubHlPd25lciBpbml0aWFsaXplZCBjb250cmlidXRpb25PcGVuIHsKICAgICAgaWYoX2lzQWRkVG9Ob3JtYWwpCiAgICAgIHsKICAgICAgICAgIHJlcXVpcmUodG90YWxJc3N1ZVRva2VuR2VuZXJhdGVkLmFkZChfYW1vdW50KSA8PSBtYXhJc3N1ZVRva2VuTGltaXQpOwogICAgICAgICAgbWF4SXNzdWVUb2tlbkxpbWl0ID0gbWF4SXNzdWVUb2tlbkxpbWl0LnN1YihfYW1vdW50KTsKICAgICAgICAgIG1heEZpcnN0Um91bmRUb2tlbkxpbWl0ID0gbWF4Rmlyc3RSb3VuZFRva2VuTGltaXQuYWRkKF9hbW91bnQpOwogICAgICB9IGVsc2UgewogICAgICAgICAgcmVxdWlyZSh0b3RhbE5vcm1hbFRva2VuR2VuZXJhdGVkLmFkZChfYW1vdW50KSA8PSBtYXhGaXJzdFJvdW5kVG9rZW5MaW1pdCk7CiAgICAgICAgICBtYXhGaXJzdFJvdW5kVG9rZW5MaW1pdCA9IG1heEZpcnN0Um91bmRUb2tlbkxpbWl0LnN1YihfYW1vdW50KTsKICAgICAgICAgIG1heElzc3VlVG9rZW5MaW1pdCA9IG1heElzc3VlVG9rZW5MaW1pdC5hZGQoX2Ftb3VudCk7CiAgICAgIH0KICB9CgogIC8vIE5PVEUgb24gUGVyY2VudGFnZSBmb3JtYXQKICAvLyBSaWdodCBub3csIFNvbGlkaXR5IGRvZXMgbm90IHN1cHBvcnQgZGVjaW1hbCBudW1iZXJzLiAoVGhpcyB3aWxsIGNoYW5nZSB2ZXJ5IHNvb24pCiAgLy8gIFNvIGluIHRoaXMgY29udHJhY3Qgd2UgdXNlIGEgcmVwcmVzZW50YXRpb24gb2YgYSBwZXJjZW50YWdlIHRoYXQgY29uc2lzdCBpbgogIC8vICBleHByZXNzaW5nIHRoZSBwZXJjZW50YWdlIGluICJ4IHBlciAxMCoqMTgiCiAgLy8gVGhpcyBmb3JtYXQgaGFzIGEgcHJlY2lzaW9uIG9mIDE2IGRpZ2l0cyBmb3IgYSBwZXJjZW50LgogIC8vIEV4YW1wbGVzOgogIC8vICAzJSAgID0gICAzKigxMCoqMTYpCiAgLy8gIDEwMCUgPSAxMDAqKDEwKioxNikgPSAxMCoqMTgKICAvLwogIC8vIFRvIGdldCBhIHBlcmNlbnRhZ2Ugb2YgYSB2YWx1ZSB3ZSBkbyBpdCBieSBmaXJzdCBtdWx0aXBseWluZyBpdCBieSB0aGUgcGVyY2VudGFnZSBpbiAgKHggcGVyIDEwXjE4KQogIC8vICBhbmQgdGhlbiBkaXZpZGUgaXQgYnkgMTAqKjE4CiAgLy8KICAvLyAgICAgICAgICAgICAgWSAqIFgoaW4geCBwZXIgMTAqKjE4KQogIC8vICBYJSBvZiBZID0gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogIC8vICAgICAgICAgICAgICAgMTAwKGluIHggcGVyIDEwKioxOCkKICAvLwoKCiAgLy8vIEBub3RpY2UgVGhpcyBtZXRob2Qgd2lsbCBjYW4gYmUgY2FsbGVkIGJ5IHRoZSBvd25lciBiZWZvcmUgdGhlIGNvbnRyaWJ1dGlvbiBwZXJpb2QKICAvLy8gIGVuZCBvciBieSBhbnlib2R5IGFmdGVyIHRoZSBgZW5kQmxvY2tgLiBUaGlzIG1ldGhvZCBmaW5hbGl6ZXMgdGhlIGNvbnRyaWJ1dGlvbiBwZXJpb2QKICAvLy8gIGJ5IGNyZWF0aW5nIHRoZSByZW1haW5pbmcgdG9rZW5zIGFuZCB0cmFuc2ZlcnJpbmcgdGhlIGNvbnRyb2xsZXIgdG8gdGhlIGNvbmZpZ3VyZWQKICAvLy8gIGNvbnRyb2xsZXIuCiAgZnVuY3Rpb24gZmluYWxpemUoKSBwdWJsaWMgb25seU93bmVyIGluaXRpYWxpemVkIHsKICAgICAgcmVxdWlyZSh0aW1lKCkgPj0gc3RhcnRUaW1lKTsKICAgICAgLy8gcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyIHx8IHRpbWUoKSA+IGVuZFRpbWUpOwogICAgICByZXF1aXJlKGZpbmFsaXplZEJsb2NrID09IDApOwoKICAgICAgZmluYWxpemVkQmxvY2sgPSBnZXRCbG9ja051bWJlcigpOwogICAgICBmaW5hbGl6ZWRUaW1lID0gbm93OwoKICAgICAgdWludDI1NiB0b2tlbnNUb1NlY29uZFJvdW5kID0gOTAwMDAwMDAgZXRoZXI7CgogICAgICB1aW50MjU2IHRva2Vuc1RvUmVzZXJ2ZSA9IDkwMDAwMDAwIGV0aGVyOwoKICAgICAgdWludDI1NiB0b2tlbnNUb0FuZ2VsQW5kT3RoZXIgPSAzMDAwMDAwMCBldGhlcjsKCiAgICAgIC8vIHRvdGFsVG9rZW5HZW5lcmF0ZWQgc2hvdWxkIGVxdWFsIHRvIEFUVC50b3RhbFN1cHBseSgpCgogICAgICAvLyBJZiB0b2tlbnMgaW4gZmlyc3Qgcm91bmQgaXMgbm90IHNvbGQgb3V0LCB0aGV5IHdpbGwgYmUgYWRkZWQgdG8gc2Vjb25kIHJvdW5kIGFuZCBmcm96ZW4gdG9nZXRoZXIKICAgICAgdG9rZW5zVG9TZWNvbmRSb3VuZCA9IHRva2Vuc1RvU2Vjb25kUm91bmQuYWRkKG1heEZpcnN0Um91bmRUb2tlbkxpbWl0KS5zdWIodG90YWxOb3JtYWxUb2tlbkdlbmVyYXRlZCk7CiAgICAgIAogICAgICB0b2tlbnNUb1NlY29uZFJvdW5kID0gdG9rZW5zVG9TZWNvbmRSb3VuZC5hZGQobWF4SXNzdWVUb2tlbkxpbWl0KS5zdWIodG90YWxJc3N1ZVRva2VuR2VuZXJhdGVkKTsKCiAgICAgIHVpbnQyNTYgdG90YWxUb2tlbnMgPSAzMDAwMDAwMDAgZXRoZXI7CgogICAgICByZXF1aXJlKHRvdGFsVG9rZW5zID09IEFUVC50b3RhbFN1cHBseSgpLmFkZCh0b2tlbnNUb1NlY29uZFJvdW5kKS5hZGQodG9rZW5zVG9SZXNlcnZlKS5hZGQodG9rZW5zVG9BbmdlbEFuZE90aGVyKSk7CgogICAgICBhc3NlcnQoQVRULmdlbmVyYXRlVG9rZW5zKDB4YjEsIHRva2Vuc1RvU2Vjb25kUm91bmQpKTsKCiAgICAgIGFzc2VydChBVFQuZ2VuZXJhdGVUb2tlbnMoMHhiMiwgdG9rZW5zVG9SZXNlcnZlKSk7CgogICAgICBhc3NlcnQoQVRULmdlbmVyYXRlVG9rZW5zKGRlc3RUb2tlbnNBbmdlbCwgdG9rZW5zVG9BbmdlbEFuZE90aGVyKSk7CgogICAgICAvLyB0b3RhbFRva2VucyBzaG91bGQgZXF1YWwgdG8gQVRULnRvdGFsU3VwcGx5KCkKCiAgICAgIEFUVC5jaGFuZ2VDb250cm9sbGVyKGF0dENvbnRyb2xsZXIpOwoKICAgICAgRmluYWxpemVkKCk7CiAgfQoKICBmdW5jdGlvbiBwZXJjZW50KHVpbnQyNTYgcCkgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NikgewogICAgICByZXR1cm4gcC5tdWwoMTAqKjE2KTsKICB9CiAgCiAgLy8vIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gZGV0ZXJtaW5lIGlmIGFuIGFkZHJlc3MgaXMgYSBjb250cmFjdAogIC8vLyBAcGFyYW0gX2FkZHIgVGhlIGFkZHJlc3MgYmVpbmcgcXVlcmllZAogIC8vLyBAcmV0dXJuIFRydWUgaWYgYF9hZGRyYCBpcyBhIGNvbnRyYWN0CiAgZnVuY3Rpb24gaXNDb250cmFjdChhZGRyZXNzIF9hZGRyKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgIGlmIChfYWRkciA9PSAwKSByZXR1cm4gZmFsc2U7CiAgICAgIHVpbnQyNTYgc2l6ZTsKICAgICAgYXNzZW1ibHkgewogICAgICAgICAgc2l6ZSA6PSBleHRjb2Rlc2l6ZShfYWRkcikKICAgICAgfQogICAgICByZXR1cm4gKHNpemUgPiAwKTsKICB9CgogIGZ1bmN0aW9uIHRpbWUoKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgIHJldHVybiBibG9jay50aW1lc3RhbXA7CiAgfQoKICAvLy8vLy8vLy8vCiAgLy8gQ29uc3RhbnQgZnVuY3Rpb25zCiAgLy8vLy8vLy8vLwoKICAvLy8gQHJldHVybiBUb3RhbCB0b2tlbnMgaXNzdWVkIGluIHdlaXMuCiAgZnVuY3Rpb24gdG9rZW5zSXNzdWVkKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgcmV0dXJuIEFUVC50b3RhbFN1cHBseSgpOwogIH0KCiAgLy8vLy8vLy8vLwogIC8vIFRlc3Rpbmcgc3BlY2lmaWMgbWV0aG9kcwogIC8vLy8vLy8vLy8KCiAgLy8vIEBub3RpY2UgVGhpcyBmdW5jdGlvbiBpcyBvdmVycmlkZGVuIGJ5IHRoZSB0ZXN0IE1vY2tzLgogIGZ1bmN0aW9uIGdldEJsb2NrTnVtYmVyKCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICByZXR1cm4gYmxvY2subnVtYmVyOwogIH0KCiAgLy8vLy8vLy8vLwogIC8vIFNhZmV0eSBNZXRob2RzCiAgLy8vLy8vLy8vLwoKICAvLy8gQG5vdGljZSBUaGlzIG1ldGhvZCBjYW4gYmUgdXNlZCBieSB0aGUgY29udHJvbGxlciB0byBleHRyYWN0IG1pc3Rha2VubHkKICAvLy8gIHNlbnQgdG9rZW5zIHRvIHRoaXMgY29udHJhY3QuCiAgLy8vIEBwYXJhbSBfdG9rZW4gVGhlIGFkZHJlc3Mgb2YgdGhlIHRva2VuIGNvbnRyYWN0IHRoYXQgeW91IHdhbnQgdG8gcmVjb3ZlcgogIC8vLyAgc2V0IHRvIDAgaW4gY2FzZSB5b3Ugd2FudCB0byBleHRyYWN0IGV0aGVyLgogIGZ1bmN0aW9uIGNsYWltVG9rZW5zKGFkZHJlc3MgX3Rva2VuKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgaWYgKEFUVC5jb250cm9sbGVyKCkgPT0gYWRkcmVzcyh0aGlzKSkgewogICAgICAgICAgQVRULmNsYWltVG9rZW5zKF90b2tlbik7CiAgICAgIH0KICAgICAgaWYgKF90b2tlbiA9PSAweDApIHsKICAgICAgICAgIG93bmVyLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIEVSQzIwVG9rZW4gdG9rZW4gPSBFUkMyMFRva2VuKF90b2tlbik7CiAgICAgIHVpbnQyNTYgYmFsYW5jZSA9IHRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgICAgdG9rZW4udHJhbnNmZXIob3duZXIsIGJhbGFuY2UpOwogICAgICBDbGFpbWVkVG9rZW5zKF90b2tlbiwgb3duZXIsIGJhbGFuY2UpOwogIH0KCiAgLy8vIEBub3RpY2UgUGF1c2VzIHRoZSBjb250cmlidXRpb24gaWYgdGhlcmUgaXMgYW55IGlzc3VlCiAgZnVuY3Rpb24gcGF1c2VDb250cmlidXRpb24oKSBvbmx5T3duZXIgewogICAgICBwYXVzZWQgPSB0cnVlOwogIH0KCiAgLy8vIEBub3RpY2UgUmVzdW1lcyB0aGUgY29udHJpYnV0aW9uCiAgZnVuY3Rpb24gcmVzdW1lQ29udHJpYnV0aW9uKCkgb25seU93bmVyIHsKICAgICAgcGF1c2VkID0gZmFsc2U7CiAgfQoKICBldmVudCBDbGFpbWVkVG9rZW5zKGFkZHJlc3MgaW5kZXhlZCBfdG9rZW4sIGFkZHJlc3MgaW5kZXhlZCBfY29udHJvbGxlciwgdWludDI1NiBfYW1vdW50KTsKICBldmVudCBOZXdTYWxlKGFkZHJlc3MgaW5kZXhlZCBfdGgsIHVpbnQyNTYgX2Ftb3VudCwgdWludDI1NiBfdG9rZW5zKTsKICBldmVudCBOZXdJc3N1ZShhZGRyZXNzIGluZGV4ZWQgX3RoLCB1aW50MjU2IF9hbW91bnQsIGJ5dGVzIGRhdGEpOwogIGV2ZW50IEZpbmFsaXplZCgpOwp9Cgpjb250cmFjdCBBVFRQbGFjZUhvbGRlciBpcyBUb2tlbkNvbnRyb2xsZXIsIE93bmVkIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAgIE1pbmlNZVRva2VuIHB1YmxpYyBhdHQ7CiAgICBBVFRDb250cmlidXRpb24gcHVibGljIGNvbnRyaWJ1dGlvbjsKICAgIHVpbnQyNTYgcHVibGljIGFjdGl2YXRpb25UaW1lOwoKICAgIC8vLyBAbm90aWNlIENvbnN0cnVjdG9yCiAgICAvLy8gQHBhcmFtIF9vd25lciBUcnVzdGVkIG93bmVyIGZvciB0aGlzIGNvbnRyYWN0LgogICAgLy8vIEBwYXJhbSBfYXR0IEFUVCB0b2tlbiBjb250cmFjdCBhZGRyZXNzCiAgICAvLy8gQHBhcmFtIF9jb250cmlidXRpb24gQVRUQ29udHJpYnV0aW9uIGNvbnRyYWN0IGFkZHJlc3MKICAgIGZ1bmN0aW9uIEFUVFBsYWNlSG9sZGVyKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9hdHQsIGFkZHJlc3MgX2NvbnRyaWJ1dGlvbikgewogICAgICAgIG93bmVyID0gX293bmVyOwogICAgICAgIGF0dCA9IE1pbmlNZVRva2VuKF9hdHQpOwogICAgICAgIGNvbnRyaWJ1dGlvbiA9IEFUVENvbnRyaWJ1dGlvbihfY29udHJpYnV0aW9uKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUaGUgb3duZXIgb2YgdGhpcyBjb250cmFjdCBjYW4gY2hhbmdlIHRoZSBjb250cm9sbGVyIG9mIHRoZSBBVFQgdG9rZW4KICAgIC8vLyAgUGxlYXNlLCBiZSBzdXJlIHRoYXQgdGhlIG93bmVyIGlzIGEgdHJ1c3RlZCBhZ2VudCBvciAweDAgYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gX25ld0NvbnRyb2xsZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBjb250cm9sbGVyCiAgICBmdW5jdGlvbiBjaGFuZ2VDb250cm9sbGVyKGFkZHJlc3MgX25ld0NvbnRyb2xsZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIGF0dC5jaGFuZ2VDb250cm9sbGVyKF9uZXdDb250cm9sbGVyKTsKICAgICAgICBDb250cm9sbGVyQ2hhbmdlZChfbmV3Q29udHJvbGxlcik7CiAgICB9CgoKICAgIC8vLy8vLy8vLy8KICAgIC8vIE1pbmlNZSBDb250cm9sbGVyIEludGVyZmFjZSBmdW5jdGlvbnMKICAgIC8vLy8vLy8vLy8KCiAgICAvLyBJbiBiZXR3ZWVuIHRoZSBvZmZlcmluZyBhbmQgdGhlIG5ldHdvcmsuIERlZmF1bHQgc2V0dGluZ3MgZm9yIGFsbG93aW5nIHRva2VuIHRyYW5zZmVycy4KICAgIGZ1bmN0aW9uIHByb3h5UGF5bWVudChhZGRyZXNzKSBwdWJsaWMgcGF5YWJsZSByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIG9uVHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcywgdWludDI1NikgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gdHJhbnNmZXJhYmxlKF9mcm9tKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvbkFwcHJvdmUoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcywgdWludDI1NikgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gdHJhbnNmZXJhYmxlKF9mcm9tKTsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlcmFibGUoYWRkcmVzcyBfZnJvbSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIC8vIEFsbG93IHRoZSBleGNoYW5nZXIgdG8gd29yayBmcm9tIHRoZSBiZWdpbm5pbmcKICAgICAgICBpZiAoYWN0aXZhdGlvblRpbWUgPT0gMCkgewogICAgICAgICAgICB1aW50MjU2IGYgPSBjb250cmlidXRpb24uZmluYWxpemVkVGltZSgpOwogICAgICAgICAgICBpZiAoZiA+IDApIHsKICAgICAgICAgICAgICAgIGFjdGl2YXRpb25UaW1lID0gZi5hZGQoMSB3ZWVrcyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGdldFRpbWUoKSA+IGFjdGl2YXRpb25UaW1lOwogICAgfQoKCiAgICAvLy8vLy8vLy8vCiAgICAvLyBUZXN0aW5nIHNwZWNpZmljIG1ldGhvZHMKICAgIC8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBUaGlzIGZ1bmN0aW9uIGlzIG92ZXJyaWRlZCBieSB0aGUgdGVzdCBNb2Nrcy4KICAgIGZ1bmN0aW9uIGdldFRpbWUoKSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIG5vdzsKICAgIH0KCgogICAgLy8vLy8vLy8vLwogICAgLy8gU2FmZXR5IE1ldGhvZHMKICAgIC8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBUaGlzIG1ldGhvZCBjYW4gYmUgdXNlZCBieSB0aGUgY29udHJvbGxlciB0byBleHRyYWN0IG1pc3Rha2VubHkKICAgIC8vLyAgc2VudCB0b2tlbnMgdG8gdGhpcyBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX3Rva2VuIFRoZSBhZGRyZXNzIG9mIHRoZSB0b2tlbiBjb250cmFjdCB0aGF0IHlvdSB3YW50IHRvIHJlY292ZXIKICAgIC8vLyAgc2V0IHRvIDAgaW4gY2FzZSB5b3Ugd2FudCB0byBleHRyYWN0IGV0aGVyLgogICAgZnVuY3Rpb24gY2xhaW1Ub2tlbnMoYWRkcmVzcyBfdG9rZW4pIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIGlmIChhdHQuY29udHJvbGxlcigpID09IGFkZHJlc3ModGhpcykpIHsKICAgICAgICAgICAgYXR0LmNsYWltVG9rZW5zKF90b2tlbik7CiAgICAgICAgfQogICAgICAgIGlmIChfdG9rZW4gPT0gMHgwKSB7CiAgICAgICAgICAgIG93bmVyLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIEVSQzIwVG9rZW4gdG9rZW4gPSBFUkMyMFRva2VuKF90b2tlbik7CiAgICAgICAgdWludDI1NiBiYWxhbmNlID0gdG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgICAgIHRva2VuLnRyYW5zZmVyKG93bmVyLCBiYWxhbmNlKTsKICAgICAgICBDbGFpbWVkVG9rZW5zKF90b2tlbiwgb3duZXIsIGJhbGFuY2UpOwogICAgfQoKICAgIGV2ZW50IENsYWltZWRUb2tlbnMoYWRkcmVzcyBpbmRleGVkIF90b2tlbiwgYWRkcmVzcyBpbmRleGVkIF9jb250cm9sbGVyLCB1aW50MjU2IF9hbW91bnQpOwogICAgZXZlbnQgQ29udHJvbGxlckNoYW5nZWQoYWRkcmVzcyBpbmRleGVkIF9uZXdDb250cm9sbGVyKTsKfQ=='.
	

]
