Class {
	#name : #SRT103c2c150a2dbcc277ee084c59881978060c8c22,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT103c2c150a2dbcc277ee084c59881978060c8c22 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTc7CgpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBzdWIodWludCBhLCB1aW50IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCkgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQogIGZ1bmN0aW9uIGFkZCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQp9Cgpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50IHB1YmxpYyB0b3RhbFN1cHBseTsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsgLy9vd25lcgogIGFkZHJlc3MgcHVibGljIGFuaW1hdG9yOyAvL2FuaW1hdG9yCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludCk7CiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcHVibGljOwogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQgdmFsdWUpOwogIGZ1bmN0aW9uIGNvbW1pdERpdmlkZW5kKGFkZHJlc3Mgd2hvKSBpbnRlcm5hbDsgLy8gcGF5cyByZW1haW5pbmcgZGl2aWRlbmQKfQoKY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQpOwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHB1YmxpYzsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludCB2YWx1ZSkgcHVibGljOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdmFsdWUpOwp9Cgpjb250cmFjdCBCYXNpY1Rva2VuIGlzIEVSQzIwQmFzaWMgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50OwogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBiYWxhbmNlczsKCiAgbW9kaWZpZXIgb25seVBheWxvYWRTaXplKHVpbnQgc2l6ZSkgewogICAgIGFzc2VydChtc2cuZGF0YS5sZW5ndGggPj0gc2l6ZSArIDQpOwogICAgIF87CiAgfQogIC8qKgogICogQGRldiB0cmFuc2ZlciB0b2tlbiBmb3IgYSBzcGVjaWZpZWQgYWRkcmVzcwogICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0by4KICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCB0byBiZSB0cmFuc2ZlcnJlZC4KICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcHVibGljIG9ubHlQYXlsb2FkU2l6ZSgyICogMzIpIHsKICAgIGNvbW1pdERpdmlkZW5kKG1zZy5zZW5kZXIpOwogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgIGlmKF90byA9PSBhZGRyZXNzKHRoaXMpKSB7CiAgICAgICAgY29tbWl0RGl2aWRlbmQob3duZXIpOwogICAgICAgIGJhbGFuY2VzW293bmVyXSA9IGJhbGFuY2VzW293bmVyXS5hZGQoX3ZhbHVlKTsKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBvd25lciwgX3ZhbHVlKTsKICAgIH0KICAgIGVsc2UgewogICAgICAgIGNvbW1pdERpdmlkZW5kKF90byk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgfQogIH0KICAvKioKICAqIEBkZXYgR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuCiAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSB0aGUgYmFsYW5jZSBvZi4gCiAgKiBAcmV0dXJuIEFuIHVpbnQgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb3duZWQgYnkgdGhlIHBhc3NlZCBhZGRyZXNzLgogICovCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludCBiYWxhbmNlKSB7CiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICB9Cn0KCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgQmFzaWNUb2tlbiwgRVJDMjAgewogIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSkgYWxsb3dlZDsKCiAgLyoqCiAgICogQGRldiBUcmFuc2ZlciB0b2tlbnMgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyCiAgICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gc2VuZCB0b2tlbnMgZnJvbQogICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAqIEBwYXJhbSBfdmFsdWUgdWludCB0aGUgYW1vdXQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVyZWQKICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBwdWJsaWMgb25seVBheWxvYWRTaXplKDMgKiAzMikgewogICAgdmFyIF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsKICAgIGNvbW1pdERpdmlkZW5kKF9mcm9tKTsKICAgIGNvbW1pdERpdmlkZW5kKF90byk7CiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IF9hbGxvd2FuY2Uuc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgfQogIC8qKgogICAqIEBkZXYgQXByb3ZlIHRoZSBwYXNzZWQgYWRkcmVzcyB0byBzcGVuZCB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiB0b2tlbnMgb24gYmVhaGxmIG9mIG1zZy5zZW5kZXIuCiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICovCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF92YWx1ZSkgcHVibGljIHsKICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgYXNzZXJ0KCEoKF92YWx1ZSAhPSAwKSAmJiAoYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gIT0gMCkpKTsKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgfQogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhbiBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF9zcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHJldHVybiBBIHVpbnQgc3BlY2lmaW5nIHRoZSBhbW91bnQgb2YgdG9rZW5zIHN0aWxsIGF2YWlibGUgZm9yIHRoZSBzcGVuZGVyLgogICAqLwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQgcmVtYWluaW5nKSB7CiAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICB9Cn0KCi8qKgogKiBAdGl0bGUgU21hcnRCaWxsaW9ucyBjb250cmFjdAogKi8KY29udHJhY3QgU21hcnRCaWxsaW9ucyBpcyBTdGFuZGFyZFRva2VuIHsKCiAgICAvLyBtZXRhZGF0YQogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBuYW1lID0gIlNtYXJ0QmlsbGlvbnMgVG9rZW4iOwogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAiUExBWSI7CiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBkZWNpbWFscyA9IDA7CgogICAgLy8gY29udHJhY3Qgc3RhdGUKICAgIHN0cnVjdCBXYWxsZXQgewogICAgICAgIHVpbnQyMDggYmFsYW5jZTsgLy8gY3VycmVudCBiYWxhbmNlIG9mIHVzZXIKICAgIAl1aW50MTYgbGFzdERpdmlkZW5kUGVyaW9kOyAvLyBsYXN0IHByb2Nlc3NlZCBkaXZpZGVuZCBwZXJpb2Qgb2YgdXNlcidzIHRva2VucwogICAgCXVpbnQzMiBuZXh0V2l0aGRyYXdCbG9jazsgLy8gbmV4dCB3aXRoZHJhd2FsIHBvc3NpYmxlIGFmdGVyIHRoaXMgYmxvY2sgbnVtYmVyCiAgICB9CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IFdhbGxldCkgd2FsbGV0czsKICAgIHN0cnVjdCBCZXQgewogICAgICAgIHVpbnQxOTIgdmFsdWU7IC8vIGJldCBzaXplCiAgICAgICAgdWludDMyIGJldEhhc2g7IC8vIHNlbGVjdGVkIG51bWJlcnMKICAgICAgICB1aW50MzIgYmxvY2tOdW07IC8vIGJsb2NrbnVtYmVyIHdoZW4gbG90dGVyeSBydW5zCiAgICB9CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IEJldCkgYmV0czsKCiAgICB1aW50IHB1YmxpYyB3YWxsZXRCYWxhbmNlID0gMDsgLy8gc3VtIG9mIGZ1bmRzIGluIHdhbGxldHMKCiAgICAvLyBpbnZlc3RtZW50IHBhcmFtZXRlcnMKICAgIHVpbnQgcHVibGljIGludmVzdFN0YXJ0ID0gMTsgLy8gaW52ZXN0bWVudCBzdGFydCBibG9jaywgMDogY2xvc2VkLCAxOiBwcmVwYXJhdGlvbgogICAgdWludCBwdWJsaWMgaW52ZXN0QmFsYW5jZSA9IDA7IC8vIGZ1bmRpbmcgZnJvbSBpbnZlc3RvcnMKICAgIHVpbnQgcHVibGljIGludmVzdEJhbGFuY2VHb3QgPSAwOyAvLyBmdW5kaW5nIGNvbGxlY3RlZAogICAgdWludCBwdWJsaWMgaW52ZXN0QmFsYW5jZU1heCA9IDIwMDAwMCBldGhlcjsgLy8gbWF4aW11bSBmdW5kaW5nCiAgICB1aW50IHB1YmxpYyBkaXZpZGVuZFBlcmlvZCA9IDE7CiAgICB1aW50W10gcHVibGljIGRpdmlkZW5kczsgLy8gZGl2aWRlbnMgY29sbGVjdGVkIHBlciBwZXJpb2QsIGdyb3dpbmcgYXJyYXkKCiAgICAvLyBiZXR0aW5nIHBhcmFtZXRlcnMKICAgIHVpbnQgcHVibGljIG1heFdpbiA9IDA7IC8vIG1heGltdW0gcHJpemUgd29uCiAgICB1aW50IHB1YmxpYyBoYXNoRmlyc3QgPSAwOyAvLyBzdGFydCB0aW1lIG9mIGJ1aWxkaW5nIGhhc2hlcyBkYXRhYmFzZQogICAgdWludCBwdWJsaWMgaGFzaExhc3QgPSAwOyAvLyBsYXN0IHNhdmVkIGJsb2NrIG9mIGhhc2hlcwogICAgdWludCBwdWJsaWMgaGFzaE5leHQgPSAwOyAvLyBuZXh0IGF2YWlsYWJsZSBiZXQgYmxvY2subnVtYmVyCiAgICB1aW50IHB1YmxpYyBoYXNoQmV0U3VtID0gMDsgLy8gdXNlZCBiZXQgdm9sdW1lIG9mIG5leHQgYmxvY2sKICAgIHVpbnQgcHVibGljIGhhc2hCZXRNYXggPSA1IGV0aGVyOyAvLyBtYXhpbXVtIGJldCBzaXplIHBlciBibG9jawogICAgdWludFtdIHB1YmxpYyBoYXNoZXM7IC8vIHNwYWNlIGZvciBzdG9yaW5nIGxvdHRlcnkgcmVzdWx0cwoKICAgIC8vIGNvbnN0YW50cwogICAgLy91aW50IHB1YmxpYyBjb25zdGFudCBoYXNoZXNTaXplID0gMTAyNCA7IC8vIERFQlVHIE9OTFkgISEhCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBoYXNoZXNTaXplID0gMTYzODQgOyAvLyAzMCBkYXlzIG9mIGJsb2NrcwogICAgdWludCBwdWJsaWMgY29sZFN0b3JlTGFzdCA9IDAgOyAvLyBibG9jayBvZiBsYXN0IGNvbGQgc3RvcmUgdHJhbnNmZXIKCiAgICAvLyBldmVudHMKICAgIGV2ZW50IExvZ0JldChhZGRyZXNzIGluZGV4ZWQgcGxheWVyLCB1aW50IGJldGhhc2gsIHVpbnQgYmxvY2tudW1iZXIsIHVpbnQgYmV0c2l6ZSk7CiAgICBldmVudCBMb2dMb3NzKGFkZHJlc3MgaW5kZXhlZCBwbGF5ZXIsIHVpbnQgYmV0aGFzaCwgdWludCBoYXNoKTsKICAgIGV2ZW50IExvZ1dpbihhZGRyZXNzIGluZGV4ZWQgcGxheWVyLCB1aW50IGJldGhhc2gsIHVpbnQgaGFzaCwgdWludCBwcml6ZSk7CiAgICBldmVudCBMb2dJbnZlc3RtZW50KGFkZHJlc3MgaW5kZXhlZCBpbnZlc3RvciwgYWRkcmVzcyBpbmRleGVkIHBhcnRuZXIsIHVpbnQgYW1vdW50KTsKICAgIGV2ZW50IExvZ1JlY29yZFdpbihhZGRyZXNzIGluZGV4ZWQgcGxheWVyLCB1aW50IGFtb3VudCk7CiAgICBldmVudCBMb2dMYXRlKGFkZHJlc3MgaW5kZXhlZCBwbGF5ZXIsdWludCBwbGF5ZXJCbG9ja051bWJlcix1aW50IGN1cnJlbnRCbG9ja051bWJlcik7CiAgICBldmVudCBMb2dEaXZpZGVuZChhZGRyZXNzIGluZGV4ZWQgaW52ZXN0b3IsIHVpbnQgYW1vdW50LCB1aW50IHBlcmlvZCk7CgogICAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgICAgIGFzc2VydChtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlBbmltYXRvcigpIHsKICAgICAgICBhc3NlcnQobXNnLnNlbmRlciA9PSBhbmltYXRvcik7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyBjb25zdHJ1Y3RvcgogICAgZnVuY3Rpb24gU21hcnRCaWxsaW9ucygpIHB1YmxpYyB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgICAgIGFuaW1hdG9yID0gbXNnLnNlbmRlcjsKICAgICAgICB3YWxsZXRzW293bmVyXS5sYXN0RGl2aWRlbmRQZXJpb2QgPSB1aW50MTYoZGl2aWRlbmRQZXJpb2QpOwogICAgICAgIGRpdmlkZW5kcy5wdXNoKDApOyAvLyBub3QgdXNlZAogICAgICAgIGRpdmlkZW5kcy5wdXNoKDApOyAvLyBjdXJyZW50IGRpdmlkZW5kCiAgICB9CgovKiBnZXR0ZXJzICovCiAgICAKICAgIC8qKgogICAgICogQGRldiBTaG93IGxlbmd0aCBvZiBhbGxvY2F0ZWQgc3dhcCBzcGFjZQogICAgICovCiAgICBmdW5jdGlvbiBoYXNoZXNMZW5ndGgoKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHVpbnQoaGFzaGVzLmxlbmd0aCk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQGRldiBTaG93IGJhbGFuY2Ugb2Ygd2FsbGV0CiAgICAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50LgogICAgICovCiAgICBmdW5jdGlvbiB3YWxsZXRCYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gdWludCh3YWxsZXRzW19vd25lcl0uYmFsYW5jZSk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQGRldiBTaG93IGxhc3QgZGl2aWRlbmQgcGVyaW9kIHByb2Nlc3NlZAogICAgICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudC4KICAgICAqLwogICAgZnVuY3Rpb24gd2FsbGV0UGVyaW9kT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gdWludCh3YWxsZXRzW19vd25lcl0ubGFzdERpdmlkZW5kUGVyaW9kKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBAZGV2IFNob3cgYmxvY2sgbnVtYmVyIHdoZW4gd2l0aGRyYXcgY2FuIGNvbnRpbnVlCiAgICAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50LgogICAgICovCiAgICBmdW5jdGlvbiB3YWxsZXRCbG9ja09mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHVpbnQod2FsbGV0c1tfb3duZXJdLm5leHRXaXRoZHJhd0Jsb2NrKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBAZGV2IFNob3cgYmV0IHNpemUuCiAgICAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBwbGF5ZXIuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGJldFZhbHVlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gdWludChiZXRzW19vd25lcl0udmFsdWUpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEBkZXYgU2hvdyBibG9jayBudW1iZXIgb2YgbG90dGVyeSBydW4gZm9yIHRoZSBiZXQuCiAgICAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBwbGF5ZXIuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGJldEhhc2hPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiB1aW50KGJldHNbX293bmVyXS5iZXRIYXNoKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBAZGV2IFNob3cgYmxvY2sgbnVtYmVyIG9mIGxvdHRlcnkgcnVuIGZvciB0aGUgYmV0LgogICAgICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgcGxheWVyLgogICAgICovCiAgICBmdW5jdGlvbiBiZXRCbG9ja051bWJlck9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHVpbnQoYmV0c1tfb3duZXJdLmJsb2NrTnVtKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBAZGV2IFByaW50IG51bWJlciBvZiBibG9jayB0aWxsIG5leHQgZXhwZWN0ZWQgZGl2aWRlbmQgcGF5bWVudAogICAgICovCiAgICBmdW5jdGlvbiBkaXZpZGVuZHNCbG9ja3MoKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgaWYoaW52ZXN0U3RhcnQgPiAwKSB7CiAgICAgICAgICAgIHJldHVybigwKTsKICAgICAgICB9CiAgICAgICAgdWludCBwZXJpb2QgPSAoYmxvY2subnVtYmVyIC0gaGFzaEZpcnN0KSAvICgxMCAqIGhhc2hlc1NpemUpOwogICAgICAgIGlmKHBlcmlvZCA+IGRpdmlkZW5kUGVyaW9kKSB7CiAgICAgICAgICAgIHJldHVybigwKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuKCgxMCAqIGhhc2hlc1NpemUpIC0gKChibG9jay5udW1iZXIgLSBoYXNoRmlyc3QpICUgKDEwICogaGFzaGVzU2l6ZSkpKTsKICAgIH0KCi8qIGFkbWluaXN0cmF0aXZlIGZ1bmN0aW9ucyAqLwoKICAgIC8qKgogICAgICogQGRldiBDaGFuZ2Ugb3duZXIuCiAgICAgKiBAcGFyYW0gX3dobyBUaGUgYWRkcmVzcyBvZiBuZXcgb3duZXIuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNoYW5nZU93bmVyKGFkZHJlc3MgX3dobykgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBhc3NlcnQoX3dobyAhPSBhZGRyZXNzKDApKTsKICAgICAgICBjb21taXREaXZpZGVuZChtc2cuc2VuZGVyKTsKICAgICAgICBjb21taXREaXZpZGVuZChfd2hvKTsKICAgICAgICBvd25lciA9IF93aG87CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IENoYW5nZSBhbmltYXRvci4KICAgICAqIEBwYXJhbSBfd2hvIFRoZSBhZGRyZXNzIG9mIG5ldyBhbmltYXRvci4KICAgICAqLwogICAgZnVuY3Rpb24gY2hhbmdlQW5pbWF0b3IoYWRkcmVzcyBfd2hvKSBleHRlcm5hbCBvbmx5QW5pbWF0b3IgewogICAgICAgIGFzc2VydChfd2hvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIGNvbW1pdERpdmlkZW5kKG1zZy5zZW5kZXIpOwogICAgICAgIGNvbW1pdERpdmlkZW5kKF93aG8pOwogICAgICAgIGFuaW1hdG9yID0gX3dobzsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgU2V0IElDTyBTdGFydCBibG9jay4KICAgICAqIEBwYXJhbSBfd2hlbiBUaGUgYmxvY2sgbnVtYmVyIG9mIHRoZSBJQ08uCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldEludmVzdFN0YXJ0KHVpbnQgX3doZW4pIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShpbnZlc3RTdGFydCA9PSAxICYmIGhhc2hGaXJzdCA+IDAgJiYgYmxvY2subnVtYmVyIDwgX3doZW4pOwogICAgICAgIGludmVzdFN0YXJ0ID0gX3doZW47CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFNldCBtYXhpbXVtIGJldCBzaXplIHBlciBibG9jawogICAgICogQHBhcmFtIF9tYXhzdW0gVGhlIG1heGltdW0gYmV0IHNpemUgaW4gd2VpLgogICAgICovCiAgICBmdW5jdGlvbiBzZXRCZXRNYXgodWludCBfbWF4c3VtKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIGhhc2hCZXRNYXggPSBfbWF4c3VtOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBSZXNldCBiZXQgc2l6ZSBhY2NvdW50aW5nLCB0byBpbmNyZWFzZSBiZXQgdm9sdW1lIGFib3ZlIHNhZmUgbGltaXRzCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJlc2V0QmV0KCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBoYXNoTmV4dCA9IGJsb2NrLm51bWJlciArIDM7CiAgICAgICAgaGFzaEJldFN1bSA9IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IE1vdmUgZnVuZHMgdG8gY29sZCBzdG9yYWdlCiAgICAgKiBAZGV2IGludmVzdEJhbGFuY2UgYW5kIHdhbGxldEJhbGFuY2UgaXMgcHJvdGVjdGVkIGZyb20gd2l0aGRyYXcgYnkgb3duZXIKICAgICAqIEBkZXYgaWYgZnVuZGluZyBpcyA+IDUwJSBhZG1pbiBjYW4gd2l0aGRyYXcgb25seSAwLjI1JSBvZiBiYWxhbmNlIHdlYWtseQogICAgICogQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB3ZWkgdG8gbW92ZSB0byBjb2xkIHN0b3JhZ2UKICAgICAqLwogICAgZnVuY3Rpb24gY29sZFN0b3JlKHVpbnQgX2Ftb3VudCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBob3VzZUtlZXBpbmcoKTsKICAgICAgICByZXF1aXJlKF9hbW91bnQgPiAwICYmIHRoaXMuYmFsYW5jZSA+PSAoaW52ZXN0QmFsYW5jZSAqIDkgLyAxMCkgKyB3YWxsZXRCYWxhbmNlICsgX2Ftb3VudCk7CiAgICAgICAgaWYoaW52ZXN0QmFsYW5jZSA+PSBpbnZlc3RCYWxhbmNlR290IC8gMil7IC8vIGFkZGl0aW9uYWwgamFja3BvdCBwcm90ZWN0aW9uCiAgICAgICAgICAgIHJlcXVpcmUoKF9hbW91bnQgPD0gdGhpcy5iYWxhbmNlIC8gNDAwKSAmJiBjb2xkU3RvcmVMYXN0ICsgNCAqIDYwICogMjQgKiA3IDw9IGJsb2NrLm51bWJlcik7CiAgICAgICAgfQogICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoX2Ftb3VudCk7CiAgICAgICAgY29sZFN0b3JlTGFzdCA9IGJsb2NrLm51bWJlcjsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgTW92ZSBmdW5kcyB0byBjb250cmFjdCBqYWNrcG90CiAgICAgKi8KICAgIGZ1bmN0aW9uIGhvdFN0b3JlKCkgcGF5YWJsZSBleHRlcm5hbCB7CiAgICAgICAgd2FsbGV0QmFsYW5jZSArPSBtc2cudmFsdWU7CiAgICAgICAgd2FsbGV0c1ttc2cuc2VuZGVyXS5iYWxhbmNlICs9IHVpbnQyMDgobXNnLnZhbHVlKTsKICAgICAgICBob3VzZUtlZXBpbmcoKTsKICAgIH0KCi8qIGhvdXNla2VlcGluZyBmdW5jdGlvbnMgKi8KCiAgICAvKioKICAgICAqIEBkZXYgVXBkYXRlIGFjY291bnRpbmcKICAgICAqLwogICAgZnVuY3Rpb24gaG91c2VLZWVwaW5nKCkgcHVibGljIHsKICAgICAgICBpZihpbnZlc3RTdGFydCA+IDEgJiYgYmxvY2subnVtYmVyID49IGludmVzdFN0YXJ0ICsgKGhhc2hlc1NpemUgKiA1KSl7IC8vIGNhLiAxNCBkYXlzCiAgICAgICAgICAgIGludmVzdFN0YXJ0ID0gMDsgLy8gc3RhcnQgZGl2aWRlbmQgcGF5bWVudHMKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmKGhhc2hGaXJzdCA+IDApewoJCSAgICAgICAgdWludCBwZXJpb2QgPSAoYmxvY2subnVtYmVyIC0gaGFzaEZpcnN0KSAvICgxMCAqIGhhc2hlc1NpemUgKTsKICAgICAgICAgICAgICAgIGlmKHBlcmlvZCA+IGRpdmlkZW5kcy5sZW5ndGggLSAyKSB7CiAgICAgICAgICAgICAgICAgICAgZGl2aWRlbmRzLnB1c2goMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZihwZXJpb2QgPiBkaXZpZGVuZFBlcmlvZCAmJiBpbnZlc3RTdGFydCA9PSAwICYmIGRpdmlkZW5kUGVyaW9kIDwgZGl2aWRlbmRzLmxlbmd0aCAtIDEpIHsKICAgICAgICAgICAgICAgICAgICBkaXZpZGVuZFBlcmlvZCsrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKLyogcGF5bWVudHMgKi8KCiAgICAvKioKICAgICAqIEBkZXYgUGF5IGJhbGFuY2UgZnJvbSB3YWxsZXQKICAgICAqLwogICAgZnVuY3Rpb24gcGF5V2FsbGV0KCkgcHVibGljIHsKICAgICAgICBpZih3YWxsZXRzW21zZy5zZW5kZXJdLmJhbGFuY2UgPiAwICYmIHdhbGxldHNbbXNnLnNlbmRlcl0ubmV4dFdpdGhkcmF3QmxvY2sgPD0gYmxvY2subnVtYmVyKXsKICAgICAgICAgICAgdWludCBiYWxhbmNlID0gd2FsbGV0c1ttc2cuc2VuZGVyXS5iYWxhbmNlOwogICAgICAgICAgICB3YWxsZXRzW21zZy5zZW5kZXJdLmJhbGFuY2UgPSAwOwogICAgICAgICAgICB3YWxsZXRCYWxhbmNlIC09IGJhbGFuY2U7CiAgICAgICAgICAgIHBheShiYWxhbmNlKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gcGF5KHVpbnQgX2Ftb3VudCkgcHJpdmF0ZSB7CiAgICAgICAgdWludCBtYXhwYXkgPSB0aGlzLmJhbGFuY2UgLyAyOwogICAgICAgIGlmKG1heHBheSA+PSBfYW1vdW50KSB7CiAgICAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoX2Ftb3VudCk7CiAgICAgICAgICAgIGlmKF9hbW91bnQgPiAxIGZpbm5leSkgewogICAgICAgICAgICAgICAgaG91c2VLZWVwaW5nKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHVpbnQga2VlcGJhbGFuY2UgPSBfYW1vdW50IC0gbWF4cGF5OwogICAgICAgICAgICB3YWxsZXRCYWxhbmNlICs9IGtlZXBiYWxhbmNlOwogICAgICAgICAgICB3YWxsZXRzW21zZy5zZW5kZXJdLmJhbGFuY2UgKz0gdWludDIwOChrZWVwYmFsYW5jZSk7CiAgICAgICAgICAgIHdhbGxldHNbbXNnLnNlbmRlcl0ubmV4dFdpdGhkcmF3QmxvY2sgPSB1aW50MzIoYmxvY2subnVtYmVyICsgNCAqIDYwICogMjQgKiAzMCk7IC8vIHdhaXQgMSBtb250aCBmb3IgbW9yZSBmdW5kcwogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKG1heHBheSk7CiAgICAgICAgfQogICAgfQoKLyogaW52ZXN0bWVudCBmdW5jdGlvbnMgKi8KCiAgICAvKioKICAgICAqIEBkZXYgQnV5IHRva2VucwogICAgICovCiAgICBmdW5jdGlvbiBpbnZlc3REaXJlY3QoKSBwYXlhYmxlIGV4dGVybmFsIHsKICAgICAgICBpbnZlc3Qob3duZXIpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBCdXkgdG9rZW5zIHdpdGggYWZmaWxpYXRlIHBhcnRuZXIKICAgICAqIEBwYXJhbSBfcGFydG5lciBBZmZpbGlhdGUgcGFydG5lcgogICAgICovCiAgICBmdW5jdGlvbiBpbnZlc3QoYWRkcmVzcyBfcGFydG5lcikgcGF5YWJsZSBwdWJsaWMgewogICAgICAgIC8vcmVxdWlyZShmcm9tVVNBKCk9PWZhbHNlKTsgLy8gZnJvbVVTQSgpIG5vdCB5ZXQgaW1wbGVtZW50ZWQgOi0oCiAgICAgICAgcmVxdWlyZShpbnZlc3RTdGFydCA+IDEgJiYgYmxvY2subnVtYmVyIDwgaW52ZXN0U3RhcnQgKyAoaGFzaGVzU2l6ZSAqIDUpICYmIGludmVzdEJhbGFuY2UgPCBpbnZlc3RCYWxhbmNlTWF4KTsKICAgICAgICB1aW50IGludmVzdGluZyA9IG1zZy52YWx1ZTsKICAgICAgICBpZihpbnZlc3RpbmcgPiBpbnZlc3RCYWxhbmNlTWF4IC0gaW52ZXN0QmFsYW5jZSkgewogICAgICAgICAgICBpbnZlc3RpbmcgPSBpbnZlc3RCYWxhbmNlTWF4IC0gaW52ZXN0QmFsYW5jZTsKICAgICAgICAgICAgaW52ZXN0QmFsYW5jZSA9IGludmVzdEJhbGFuY2VNYXg7CiAgICAgICAgICAgIGludmVzdEJhbGFuY2VHb3QgPSBpbnZlc3RCYWxhbmNlTWF4OwogICAgICAgICAgICBpbnZlc3RTdGFydCA9IDA7IC8vIGNsb3NlIGludmVzdG1lbnQgcm91bmQKICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2Zlcihtc2cudmFsdWUuc3ViKGludmVzdGluZykpOyAvLyBzZW5kIGJhY2sgZnVuZHMgaW1tZWRpYXRlbHkKICAgICAgICB9CiAgICAgICAgZWxzZXsKICAgICAgICAgICAgaW52ZXN0QmFsYW5jZSArPSBpbnZlc3Rpbmc7CiAgICAgICAgICAgIGludmVzdEJhbGFuY2VHb3QgKz0gaW52ZXN0aW5nOwogICAgICAgIH0KICAgICAgICBpZihfcGFydG5lciA9PSBhZGRyZXNzKDApIHx8IF9wYXJ0bmVyID09IG93bmVyKXsKICAgICAgICAgICAgd2FsbGV0QmFsYW5jZSArPSBpbnZlc3RpbmcgLyAxMDsKICAgICAgICAgICAgd2FsbGV0c1tvd25lcl0uYmFsYW5jZSArPSB1aW50MjA4KGludmVzdGluZyAvIDEwKTt9IC8vIDEwJSBmb3IgbWFya2V0aW5nIGlmIG5vIGFmZmlsaWF0ZXMKICAgICAgICBlbHNlewogICAgICAgICAgICB3YWxsZXRCYWxhbmNlICs9IChpbnZlc3RpbmcgKiA1IC8gMTAwKSAqIDI7CiAgICAgICAgICAgIHdhbGxldHNbb3duZXJdLmJhbGFuY2UgKz0gdWludDIwOChpbnZlc3RpbmcgKiA1IC8gMTAwKTsgLy8gNSUgaW5pdGlhbCBtYXJrZXRpbmcgZnVuZHMKICAgICAgICAgICAgd2FsbGV0c1tfcGFydG5lcl0uYmFsYW5jZSArPSB1aW50MjA4KGludmVzdGluZyAqIDUgLyAxMDApO30gLy8gNSUgZm9yIGFmZmlsaWF0ZXMKICAgICAgICB3YWxsZXRzW21zZy5zZW5kZXJdLmxhc3REaXZpZGVuZFBlcmlvZCA9IHVpbnQxNihkaXZpZGVuZFBlcmlvZCk7IC8vIGFzc2VydChkaXZpZGVuZFBlcmlvZCA9PSAxKTsKICAgICAgICB1aW50IHNlbmRlckJhbGFuY2UgPSBpbnZlc3RpbmcgLyAxMCoqMTU7CiAgICAgICAgdWludCBvd25lckJhbGFuY2UgPSBpbnZlc3RpbmcgKiAxNiAvIDEwKioxNyAgOwogICAgICAgIHVpbnQgYW5pbWF0b3JCYWxhbmNlID0gaW52ZXN0aW5nICogMTAgLyAxMCoqMTcgIDsKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSArPSBzZW5kZXJCYWxhbmNlOwogICAgICAgIGJhbGFuY2VzW293bmVyXSArPSBvd25lckJhbGFuY2UgOyAvLyAxMyUgb2Ygc2hhcmVzIGdvIHRvIGRldmVsb3BlcnMKICAgICAgICBiYWxhbmNlc1thbmltYXRvcl0gKz0gYW5pbWF0b3JCYWxhbmNlIDsgLy8gOCUgb2Ygc2hhcmVzIGdvIHRvIGFuaW1hdG9yCiAgICAgICAgdG90YWxTdXBwbHkgKz0gc2VuZGVyQmFsYW5jZSArIG93bmVyQmFsYW5jZSArIGFuaW1hdG9yQmFsYW5jZTsKICAgICAgICBUcmFuc2ZlcihhZGRyZXNzKDApLG1zZy5zZW5kZXIsc2VuZGVyQmFsYW5jZSk7IC8vIGZvciBldGhlcnNjYW4KICAgICAgICBUcmFuc2ZlcihhZGRyZXNzKDApLG93bmVyLG93bmVyQmFsYW5jZSk7IC8vIGZvciBldGhlcnNjYW4KICAgICAgICBUcmFuc2ZlcihhZGRyZXNzKDApLGFuaW1hdG9yLGFuaW1hdG9yQmFsYW5jZSk7IC8vIGZvciBldGhlcnNjYW4KICAgICAgICBMb2dJbnZlc3RtZW50KG1zZy5zZW5kZXIsX3BhcnRuZXIsaW52ZXN0aW5nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgRGVsZXRlIGFsbCB0b2tlbnMgb3duZWQgYnkgc2VuZGVyIGFuZCByZXR1cm4gdW5wYWlkIGRpdmlkZW5kcyBhbmQgOTAlIG9mIGluaXRpYWwgaW52ZXN0bWVudAogICAgICovCiAgICBmdW5jdGlvbiBkaXNpbnZlc3QoKSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShpbnZlc3RTdGFydCA9PSAwKTsKICAgICAgICBjb21taXREaXZpZGVuZChtc2cuc2VuZGVyKTsKICAgICAgICB1aW50IGluaXRpYWxJbnZlc3RtZW50ID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0gKiAxMCoqMTU7CiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlcixhZGRyZXNzKDApLGJhbGFuY2VzW21zZy5zZW5kZXJdKTsgLy8gZm9yIGV0aGVyc2NhbgogICAgICAgIGRlbGV0ZSBiYWxhbmNlc1ttc2cuc2VuZGVyXTsgLy8gdG90YWxTdXBwbHkgc3RheXMgdGhlIHNhbWUsIGludmVzdEJhbGFuY2UgaXMgcmVkdWNlZAogICAgICAgIGludmVzdEJhbGFuY2UgLT0gaW5pdGlhbEludmVzdG1lbnQ7CiAgICAgICAgd2FsbGV0c1ttc2cuc2VuZGVyXS5iYWxhbmNlICs9IHVpbnQyMDgoaW5pdGlhbEludmVzdG1lbnQgKiA5IC8gMTApOwogICAgICAgIHBheVdhbGxldCgpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBQYXkgdW5wYWlkIGRpdmlkZW5kcwogICAgICovCiAgICBmdW5jdGlvbiBwYXlEaXZpZGVuZHMoKSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShpbnZlc3RTdGFydCA9PSAwKTsKICAgICAgICBjb21taXREaXZpZGVuZChtc2cuc2VuZGVyKTsKICAgICAgICBwYXlXYWxsZXQoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQ29tbWl0IHJlbWFpbmluZyBkaXZpZGVuZHMgYmVmb3JlIHRyYW5zZmVyIG9mIHRva2VucwogICAgICovCiAgICBmdW5jdGlvbiBjb21taXREaXZpZGVuZChhZGRyZXNzIF93aG8pIGludGVybmFsIHsKICAgICAgICB1aW50IGxhc3QgPSB3YWxsZXRzW193aG9dLmxhc3REaXZpZGVuZFBlcmlvZDsKICAgICAgICBpZigoYmFsYW5jZXNbX3dob109PTApIHx8IChsYXN0PT0wKSl7CiAgICAgICAgICAgIHdhbGxldHNbX3dob10ubGFzdERpdmlkZW5kUGVyaW9kPXVpbnQxNihkaXZpZGVuZFBlcmlvZCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYobGFzdD09ZGl2aWRlbmRQZXJpb2QpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB1aW50IHNoYXJlID0gYmFsYW5jZXNbX3dob10gKiAweGZmZmZmZmZmIC8gdG90YWxTdXBwbHk7CiAgICAgICAgdWludCBiYWxhbmNlID0gMDsKICAgICAgICBmb3IoO2xhc3Q8ZGl2aWRlbmRQZXJpb2Q7bGFzdCsrKSB7CiAgICAgICAgICAgIGJhbGFuY2UgKz0gc2hhcmUgKiBkaXZpZGVuZHNbbGFzdF07CiAgICAgICAgfQogICAgICAgIGJhbGFuY2UgPSAoYmFsYW5jZSAvIDB4ZmZmZmZmZmYpOwogICAgICAgIHdhbGxldEJhbGFuY2UgKz0gYmFsYW5jZTsKICAgICAgICB3YWxsZXRzW193aG9dLmJhbGFuY2UgKz0gdWludDIwOChiYWxhbmNlKTsKICAgICAgICB3YWxsZXRzW193aG9dLmxhc3REaXZpZGVuZFBlcmlvZCA9IHVpbnQxNihsYXN0KTsKICAgICAgICBMb2dEaXZpZGVuZChfd2hvLGJhbGFuY2UsbGFzdCk7CiAgICB9CgovKiBsb3R0ZXJ5IGZ1bmN0aW9ucyAqLwoKICAgIGZ1bmN0aW9uIGJldFByaXplKEJldCBfcGxheWVyLCB1aW50MjQgX2hhc2gpIGNvbnN0YW50IHByaXZhdGUgcmV0dXJucyAodWludCkgeyAvLyBob3VzZSBmZWUgMTMuODUlCiAgICAgICAgdWludDI0IGJldGhhc2ggPSB1aW50MjQoX3BsYXllci5iZXRIYXNoKTsKICAgICAgICB1aW50MjQgaGl0ID0gYmV0aGFzaCBeIF9oYXNoOwogICAgICAgIHVpbnQyNCBtYXRjaGVzID0KICAgICAgICAgICAgKChoaXQgJiAweEYpID09IDAgPyAxIDogMCApICsKICAgICAgICAgICAgKChoaXQgJiAweEYwKSA9PSAwID8gMSA6IDAgKSArCiAgICAgICAgICAgICgoaGl0ICYgMHhGMDApID09IDAgPyAxIDogMCApICsKICAgICAgICAgICAgKChoaXQgJiAweEYwMDApID09IDAgPyAxIDogMCApICsKICAgICAgICAgICAgKChoaXQgJiAweEYwMDAwKSA9PSAwID8gMSA6IDAgKSArCiAgICAgICAgICAgICgoaGl0ICYgMHhGMDAwMDApID09IDAgPyAxIDogMCApOwogICAgICAgIGlmKG1hdGNoZXMgPT0gNil7CiAgICAgICAgICAgIHJldHVybih1aW50KF9wbGF5ZXIudmFsdWUpICogNzAwMDAwMCk7CiAgICAgICAgfQogICAgICAgIGlmKG1hdGNoZXMgPT0gNSl7CiAgICAgICAgICAgIHJldHVybih1aW50KF9wbGF5ZXIudmFsdWUpICogMjAwMDApOwogICAgICAgIH0KICAgICAgICBpZihtYXRjaGVzID09IDQpewogICAgICAgICAgICByZXR1cm4odWludChfcGxheWVyLnZhbHVlKSAqIDUwMCk7CiAgICAgICAgfQogICAgICAgIGlmKG1hdGNoZXMgPT0gMyl7CiAgICAgICAgICAgIHJldHVybih1aW50KF9wbGF5ZXIudmFsdWUpICogMjUpOwogICAgICAgIH0KICAgICAgICBpZihtYXRjaGVzID09IDIpewogICAgICAgICAgICByZXR1cm4odWludChfcGxheWVyLnZhbHVlKSAqIDMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4oMCk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQGRldiBDaGVjayBpZiB3b24gaW4gbG90dGVyeQogICAgICovCiAgICBmdW5jdGlvbiBiZXRPZihhZGRyZXNzIF93aG8pIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMgKHVpbnQpICB7CiAgICAgICAgQmV0IG1lbW9yeSBwbGF5ZXIgPSBiZXRzW193aG9dOwogICAgICAgIGlmKCAocGxheWVyLnZhbHVlPT0wKSB8fAogICAgICAgICAgICAocGxheWVyLmJsb2NrTnVtPD0xKSB8fAogICAgICAgICAgICAoYmxvY2subnVtYmVyPHBsYXllci5ibG9ja051bSkgfHwKICAgICAgICAgICAgKGJsb2NrLm51bWJlcj49cGxheWVyLmJsb2NrTnVtICsgKDEwICogaGFzaGVzU2l6ZSkpKXsKICAgICAgICAgICAgcmV0dXJuKDApOwogICAgICAgIH0KICAgICAgICBpZihibG9jay5udW1iZXI8cGxheWVyLmJsb2NrTnVtKzI1Nil7CiAgICAgICAgICAgIHJldHVybihiZXRQcml6ZShwbGF5ZXIsdWludDI0KGJsb2NrLmJsb2NraGFzaChwbGF5ZXIuYmxvY2tOdW0pKSkpOwogICAgICAgIH0KICAgICAgICBpZihoYXNoRmlyc3Q+MCl7CiAgICAgICAgICAgIHVpbnQzMiBoYXNoID0gZ2V0SGFzaChwbGF5ZXIuYmxvY2tOdW0pOwogICAgICAgICAgICBpZihoYXNoID09IDB4MTAwMDAwMCkgeyAvLyBsb2FkIGhhc2ggZmFpbGVkIDotKCwgcmV0dXJuIGZ1bmRzCiAgICAgICAgICAgICAgICByZXR1cm4odWludChwbGF5ZXIudmFsdWUpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgcmV0dXJuKGJldFByaXplKHBsYXllcix1aW50MjQoaGFzaCkpKTsKICAgICAgICAgICAgfQoJfQogICAgICAgIHJldHVybigwKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQ2hlY2sgaWYgd29uIGluIGxvdHRlcnkKICAgICAqLwogICAgZnVuY3Rpb24gd29uKCkgcHVibGljIHsKICAgICAgICBCZXQgbWVtb3J5IHBsYXllciA9IGJldHNbbXNnLnNlbmRlcl07CiAgICAgICAgaWYocGxheWVyLmJsb2NrTnVtPT0wKXsgLy8gY3JlYXRlIGEgbmV3IHBsYXllcgogICAgICAgICAgICBiZXRzW21zZy5zZW5kZXJdID0gQmV0KHt2YWx1ZTogMCwgYmV0SGFzaDogMCwgYmxvY2tOdW06IDF9KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZigocGxheWVyLnZhbHVlPT0wKSB8fCAocGxheWVyLmJsb2NrTnVtPT0xKSl7CiAgICAgICAgICAgIHBheVdhbGxldCgpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHJlcXVpcmUoYmxvY2subnVtYmVyPnBsYXllci5ibG9ja051bSk7IC8vIGlmIHRoZXJlIGlzIGFuIGFjdGl2ZSBiZXQsIHRocm93KCkKICAgICAgICBpZihwbGF5ZXIuYmxvY2tOdW0gKyAoMTAgKiBoYXNoZXNTaXplKSA8PSBibG9jay5udW1iZXIpeyAvLyBsYXN0IGJldCB0b28gbG9uZyBhZ28sIGxvc3QgIQogICAgICAgICAgICBMb2dMYXRlKG1zZy5zZW5kZXIscGxheWVyLmJsb2NrTnVtLGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgIGJldHNbbXNnLnNlbmRlcl0gPSBCZXQoe3ZhbHVlOiAwLCBiZXRIYXNoOiAwLCBibG9ja051bTogMX0pOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHVpbnQgcHJpemUgPSAwOwogICAgICAgIHVpbnQzMiBoYXNoID0gMDsKICAgICAgICBpZihibG9jay5udW1iZXI8cGxheWVyLmJsb2NrTnVtKzI1Nil7CiAgICAgICAgICAgIGhhc2ggPSB1aW50MjQoYmxvY2suYmxvY2toYXNoKHBsYXllci5ibG9ja051bSkpOwogICAgICAgICAgICBwcml6ZSA9IGJldFByaXplKHBsYXllcix1aW50MjQoaGFzaCkpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaWYoaGFzaEZpcnN0PjApeyAvLyBsb3R0ZXJ5IGlzIG9wZW4gZXZlbiBiZWZvcmUgc3dhcCBzcGFjZSAoaGFzaGVzKSBpcyByZWFkeSwgYnV0IHBsYXllciBtdXN0IGNvbGxlY3QgcmVzdWx0cyB3aXRoaW4gMjU2IGJsb2NrcyBhZnRlciBydW4KICAgICAgICAgICAgICAgIGhhc2ggPSBnZXRIYXNoKHBsYXllci5ibG9ja051bSk7CiAgICAgICAgICAgICAgICBpZihoYXNoID09IDB4MTAwMDAwMCkgeyAvLyBsb2FkIGhhc2ggZmFpbGVkIDotKAogICAgICAgICAgICAgICAgICAgIC8vcHJpemUgPSB1aW50KHBsYXllci52YWx1ZSk7IG5vIHJlZnVuZHMgYW55bW9yZQogICAgICAgICAgICAgICAgICAgIExvZ0xhdGUobXNnLnNlbmRlcixwbGF5ZXIuYmxvY2tOdW0sYmxvY2subnVtYmVyKTsKICAgICAgICAgICAgICAgICAgICBiZXRzW21zZy5zZW5kZXJdID0gQmV0KHt2YWx1ZTogMCwgYmV0SGFzaDogMCwgYmxvY2tOdW06IDF9KTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2V7CiAgICAgICAgICAgICAgICAgICAgcHJpemUgPSBiZXRQcml6ZShwbGF5ZXIsdWludDI0KGhhc2gpKTsKICAgICAgICAgICAgICAgIH0KCSAgICB9CiAgICAgICAgICAgIGVsc2V7CiAgICAgICAgICAgICAgICBMb2dMYXRlKG1zZy5zZW5kZXIscGxheWVyLmJsb2NrTnVtLGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgICAgICBiZXRzW21zZy5zZW5kZXJdID0gQmV0KHt2YWx1ZTogMCwgYmV0SGFzaDogMCwgYmxvY2tOdW06IDF9KTsKICAgICAgICAgICAgICAgIHJldHVybigpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGJldHNbbXNnLnNlbmRlcl0gPSBCZXQoe3ZhbHVlOiAwLCBiZXRIYXNoOiAwLCBibG9ja051bTogMX0pOwogICAgICAgIGlmKHByaXplPjApIHsKICAgICAgICAgICAgTG9nV2luKG1zZy5zZW5kZXIsdWludChwbGF5ZXIuYmV0SGFzaCksdWludChoYXNoKSxwcml6ZSk7CiAgICAgICAgICAgIGlmKHByaXplID4gbWF4V2luKXsKICAgICAgICAgICAgICAgIG1heFdpbiA9IHByaXplOwogICAgICAgICAgICAgICAgTG9nUmVjb3JkV2luKG1zZy5zZW5kZXIscHJpemUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHBheShwcml6ZSk7CiAgICAgICAgfQogICAgICAgIGVsc2V7CiAgICAgICAgICAgIExvZ0xvc3MobXNnLnNlbmRlcix1aW50KHBsYXllci5iZXRIYXNoKSx1aW50KGhhc2gpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFNlbmQgZXRoZXIgdG8gYnV5IHRva2VucyBkdXJpbmcgSUNPCiAgICAgKiBAZGV2IG9yIHNlbmQgbGVzcyB0aGFuIDEgZXRoZXIgdG8gY29udHJhY3QgdG8gcGxheQogICAgICogQGRldiBvciBzZW5kIDAgdG8gY29sbGVjdCBwcml6ZQogICAgICovCiAgICBmdW5jdGlvbiAoKSBwYXlhYmxlIGV4dGVybmFsIHsKICAgICAgICBpZihtc2cudmFsdWUgPiAwKXsKICAgICAgICAgICAgaWYoaW52ZXN0U3RhcnQ+MSl7IC8vIGR1cmluZyBJQ08gcGF5bWVudCB0byB0aGUgY29udHJhY3QgaXMgdHJlYXRlZCBhcyBpbnZlc3RtZW50CiAgICAgICAgICAgICAgICBpbnZlc3Qob3duZXIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2V7IC8vIGlmIG5vdCBJQ08gcnVubmluZyBwYXltZW50IHRvIGNvbnRyYWN0IGlzIHRyZWF0ZWQgYXMgcGxheQogICAgICAgICAgICAgICAgcGxheSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgLy9jaGVjayBmb3IgZGl2aWRlbmRzIGFuZCBvdGhlciBhc3NldHMKICAgICAgICBpZihpbnZlc3RTdGFydCA9PSAwICYmIGJhbGFuY2VzW21zZy5zZW5kZXJdPjApewogICAgICAgICAgICBjb21taXREaXZpZGVuZChtc2cuc2VuZGVyKTt9CiAgICAgICAgd29uKCk7IC8vIHdpbGwgcnVuIHBheVdhbGxldCgpIGlmIG5vdGhpbmcgZWxzZSBhdmFpbGFibGUKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUGxheSBpbiBsb3R0ZXJ5CiAgICAgKi8KICAgIGZ1bmN0aW9uIHBsYXkoKSBwYXlhYmxlIHB1YmxpYyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHBsYXlTeXN0ZW0odWludChrZWNjYWsyNTYobXNnLnNlbmRlcixibG9jay5udW1iZXIpKSwgYWRkcmVzcygwKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFBsYXkgaW4gbG90dGVyeSB3aXRoIHJhbmRvbSBudW1iZXJzCiAgICAgKiBAcGFyYW0gX3BhcnRuZXIgQWZmaWxpYXRlIHBhcnRuZXIKICAgICAqLwogICAgZnVuY3Rpb24gcGxheVJhbmRvbShhZGRyZXNzIF9wYXJ0bmVyKSBwYXlhYmxlIHB1YmxpYyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHBsYXlTeXN0ZW0odWludChrZWNjYWsyNTYobXNnLnNlbmRlcixibG9jay5udW1iZXIpKSwgX3BhcnRuZXIpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBQbGF5IGluIGxvdHRlcnkgd2l0aCBvd24gbnVtYmVycwogICAgICogQHBhcmFtIF9wYXJ0bmVyIEFmZmlsaWF0ZSBwYXJ0bmVyCiAgICAgKi8KICAgIGZ1bmN0aW9uIHBsYXlTeXN0ZW0odWludCBfaGFzaCwgYWRkcmVzcyBfcGFydG5lcikgcGF5YWJsZSBwdWJsaWMgcmV0dXJucyAodWludCkgewogICAgICAgIHdvbigpOyAvLyBjaGVjayBpZiBwbGF5ZXIgZGlkIG5vdCB3aW4gCiAgICAgICAgdWludDI0IGJldGhhc2ggPSB1aW50MjQoX2hhc2gpOwogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlIDw9IDEgZXRoZXIgJiYgbXNnLnZhbHVlIDwgaGFzaEJldE1heCk7CiAgICAgICAgaWYobXNnLnZhbHVlID4gMCl7CiAgICAgICAgICAgIGlmKGludmVzdFN0YXJ0PT0wKSB7IC8vIGRpdmlkZW5kcyBvbmx5IGFmdGVyIGludmVzdG1lbnQgZmluaXNoZWQKICAgICAgICAgICAgICAgIGRpdmlkZW5kc1tkaXZpZGVuZFBlcmlvZF0gKz0gbXNnLnZhbHVlIC8gMjA7IC8vIDUlIGRpdmlkZW5kCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoX3BhcnRuZXIgIT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICAgICAgdWludCBmZWUgPSBtc2cudmFsdWUgLyAxMDA7CiAgICAgICAgICAgICAgICB3YWxsZXRCYWxhbmNlICs9IGZlZTsKICAgICAgICAgICAgICAgIHdhbGxldHNbX3BhcnRuZXJdLmJhbGFuY2UgKz0gdWludDIwOChmZWUpOyAvLyAxJSBmb3IgYWZmaWxpYXRlcwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKGhhc2hOZXh0IDwgYmxvY2subnVtYmVyICsgMykgewogICAgICAgICAgICAgICAgaGFzaE5leHQgPSBibG9jay5udW1iZXIgKyAzOwogICAgICAgICAgICAgICAgaGFzaEJldFN1bSA9IG1zZy52YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgaWYoaGFzaEJldFN1bSA+IGhhc2hCZXRNYXgpIHsKICAgICAgICAgICAgICAgICAgICBoYXNoTmV4dCsrOwogICAgICAgICAgICAgICAgICAgIGhhc2hCZXRTdW0gPSBtc2cudmFsdWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgICAgIGhhc2hCZXRTdW0gKz0gbXNnLnZhbHVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGJldHNbbXNnLnNlbmRlcl0gPSBCZXQoe3ZhbHVlOiB1aW50MTkyKG1zZy52YWx1ZSksIGJldEhhc2g6IHVpbnQzMihiZXRoYXNoKSwgYmxvY2tOdW06IHVpbnQzMihoYXNoTmV4dCl9KTsKICAgICAgICAgICAgTG9nQmV0KG1zZy5zZW5kZXIsdWludChiZXRoYXNoKSxoYXNoTmV4dCxtc2cudmFsdWUpOwogICAgICAgIH0KICAgICAgICBwdXRIYXNoZXMoMjUpOyAvLyBwbGF5ZXJzIGhlbHAgY29sbGVjaW5nIGRhdGEsIG5vdyBtdWNoIG1vcmUgdGhhbiBpbiBsYXN0IGNvbnRyYWN0CiAgICAgICAgcmV0dXJuKGhhc2hOZXh0KTsKICAgIH0KCi8qIGRhdGFiYXNlIGZ1bmN0aW9ucyAqLwoKICAgIC8qKgogICAgICogQGRldiBDcmVhdGUgaGFzaCBkYXRhIHN3YXAgc3BhY2UKICAgICAqIEBwYXJhbSBfc2FkZCBOdW1iZXIgb2YgaGFzaGVzIHRvIGFkZCAoPD0yNTYpCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFkZEhhc2hlcyh1aW50IF9zYWRkKSBwdWJsaWMgcmV0dXJucyAodWludCkgewogICAgICAgIHJlcXVpcmUoaGFzaEZpcnN0ID09IDAgJiYgX3NhZGQgPiAwICYmIF9zYWRkIDw9IGhhc2hlc1NpemUpOwogICAgICAgIHVpbnQgbiA9IGhhc2hlcy5sZW5ndGg7CiAgICAgICAgaWYobiArIF9zYWRkID4gaGFzaGVzU2l6ZSl7CiAgICAgICAgICAgIGhhc2hlcy5sZW5ndGggPSBoYXNoZXNTaXplOwogICAgICAgIH0KICAgICAgICBlbHNlewogICAgICAgICAgICBoYXNoZXMubGVuZ3RoICs9IF9zYWRkOwogICAgICAgIH0KICAgICAgICBmb3IoO248aGFzaGVzLmxlbmd0aDtuKyspeyAvLyBtYWtlIHN1cmUgdG8gYnVybiBnYXMKICAgICAgICAgICAgaGFzaGVzW25dID0gMHhGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGOwogICAgICAgIH0KICAgICAgICBpZihoYXNoZXMubGVuZ3RoPj1oYXNoZXNTaXplKSB7IC8vIGFzc3VtZSBibG9jay5udW1iZXIgPiAxMAogICAgICAgICAgICBoYXNoRmlyc3QgPSBibG9jay5udW1iZXIgLSAoIGJsb2NrLm51bWJlciAlIDEwKTsKICAgICAgICAgICAgaGFzaExhc3QgPSBoYXNoRmlyc3Q7CiAgICAgICAgfQogICAgICAgIHJldHVybihoYXNoZXMubGVuZ3RoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQ3JlYXRlIGhhc2ggZGF0YSBzd2FwIHNwYWNlLCBhZGQgMTI4IGhhc2hlcwogICAgICovCiAgICBmdW5jdGlvbiBhZGRIYXNoZXMxMjgoKSBleHRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuKGFkZEhhc2hlcygxMjgpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjYWxjSGFzaGVzKHVpbnQzMiBfbGFzdGIsIHVpbnQzMiBfZGVsdGEpIGNvbnN0YW50IHByaXZhdGUgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiggKCB1aW50KGJsb2NrLmJsb2NraGFzaChfbGFzdGIgICkpICYgMHhGRkZGRkYgKQogICAgICAgICAgICB8ICggKCB1aW50KGJsb2NrLmJsb2NraGFzaChfbGFzdGIrMSkpICYgMHhGRkZGRkYgKSA8PCAyNCApCiAgICAgICAgICAgIHwgKCAoIHVpbnQoYmxvY2suYmxvY2toYXNoKF9sYXN0YisyKSkgJiAweEZGRkZGRiApIDw8IDQ4ICkKICAgICAgICAgICAgfCAoICggdWludChibG9jay5ibG9ja2hhc2goX2xhc3RiKzMpKSAmIDB4RkZGRkZGICkgPDwgNzIgKQogICAgICAgICAgICB8ICggKCB1aW50KGJsb2NrLmJsb2NraGFzaChfbGFzdGIrNCkpICYgMHhGRkZGRkYgKSA8PCA5NiApCiAgICAgICAgICAgIHwgKCAoIHVpbnQoYmxvY2suYmxvY2toYXNoKF9sYXN0Yis1KSkgJiAweEZGRkZGRiApIDw8IDEyMCApCiAgICAgICAgICAgIHwgKCAoIHVpbnQoYmxvY2suYmxvY2toYXNoKF9sYXN0Yis2KSkgJiAweEZGRkZGRiApIDw8IDE0NCApCiAgICAgICAgICAgIHwgKCAoIHVpbnQoYmxvY2suYmxvY2toYXNoKF9sYXN0Yis3KSkgJiAweEZGRkZGRiApIDw8IDE2OCApCiAgICAgICAgICAgIHwgKCAoIHVpbnQoYmxvY2suYmxvY2toYXNoKF9sYXN0Yis4KSkgJiAweEZGRkZGRiApIDw8IDE5MiApCiAgICAgICAgICAgIHwgKCAoIHVpbnQoYmxvY2suYmxvY2toYXNoKF9sYXN0Yis5KSkgJiAweEZGRkZGRiApIDw8IDIxNiApCiAgICAgICAgICAgIHwgKCAoIHVpbnQoX2RlbHRhKSAvIGhhc2hlc1NpemUpIDw8IDI0MCkpOyAKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRIYXNoKHVpbnQgX2Jsb2NrKSBjb25zdGFudCBwcml2YXRlIHJldHVybnMgKHVpbnQzMikgewogICAgICAgIHVpbnQgZGVsdGEgPSAoX2Jsb2NrIC0gaGFzaEZpcnN0KSAvIDEwOwogICAgICAgIHVpbnQgaGFzaCA9IGhhc2hlc1tkZWx0YSAlIGhhc2hlc1NpemVdOwogICAgICAgIGlmKGRlbHRhIC8gaGFzaGVzU2l6ZSAhPSBoYXNoID4+IDI0MCkgewogICAgICAgICAgICByZXR1cm4oMHgxMDAwMDAwKTsgLy8gbG9hZCBmYWlsZWQsIGluY29ycmVjdCBkYXRhIGluIGhhc2hlcwogICAgICAgIH0KICAgICAgICB1aW50IHNsb3RwID0gKF9ibG9jayAtIGhhc2hGaXJzdCkgJSAxMDsgCiAgICAgICAgcmV0dXJuKHVpbnQzMigoaGFzaCA+PiAoMjQgKiBzbG90cCkpICYgMHhGRkZGRkYpKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBAZGV2IEZpbGwgaGFzaCBkYXRhCiAgICAgKi8KICAgIGZ1bmN0aW9uIHB1dEhhc2goKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHVpbnQgbGFzdGIgPSBoYXNoTGFzdDsKICAgICAgICBpZihsYXN0YiA9PSAwIHx8IGJsb2NrLm51bWJlciA8PSBsYXN0YiArIDEwKSB7CiAgICAgICAgICAgIHJldHVybihmYWxzZSk7CiAgICAgICAgfQogICAgICAgIHVpbnQgYmxvY2tuMjU2OwogICAgICAgIGlmKGJsb2NrLm51bWJlcjwyNTYpIHsgLy8gdXNlbGVzcyB0ZXN0IGZvciB0ZXN0bmV0IDotKAogICAgICAgICAgICBibG9ja24yNTYgPSAwOwogICAgICAgIH0KICAgICAgICBlbHNlewogICAgICAgICAgICBibG9ja24yNTYgPSBibG9jay5udW1iZXIgLSAyNTU7CiAgICAgICAgfQogICAgICAgIGlmKGxhc3RiIDwgYmxvY2tuMjU2KSB7CiAgICAgICAgICAgIHVpbnQgbnVtID0gYmxvY2tuMjU2OwogICAgICAgICAgICBudW0gKz0gbnVtICUgMTA7CiAgICAgICAgICAgIGxhc3RiID0gbnVtOyAKICAgICAgICB9CiAgICAgICAgdWludCBkZWx0YSA9IChsYXN0YiAtIGhhc2hGaXJzdCkgLyAxMDsKICAgICAgICBoYXNoZXNbZGVsdGEgJSBoYXNoZXNTaXplXSA9IGNhbGNIYXNoZXModWludDMyKGxhc3RiKSx1aW50MzIoZGVsdGEpKTsKICAgICAgICBoYXNoTGFzdCA9IGxhc3RiICsgMTA7CiAgICAgICAgcmV0dXJuKHRydWUpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBGaWxsIGhhc2ggZGF0YSBtYW55IHRpbWVzCiAgICAgKiBAcGFyYW0gX251bSBOdW1iZXIgb2YgaXRlcmF0aW9ucwogICAgICovCiAgICBmdW5jdGlvbiBwdXRIYXNoZXModWludCBfbnVtKSBwdWJsaWMgewogICAgICAgIHVpbnQgbj0wOwogICAgICAgIGZvcig7bjxfbnVtO24rKyl7CiAgICAgICAgICAgIGlmKCFwdXRIYXNoKCkpewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgCn0='.
	

]
