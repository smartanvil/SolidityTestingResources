Class {
	#name : #SRT96a0599930a67f72c713e6566687960882c5f7f9,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT96a0599930a67f72c713e6566687960882c5f7f9 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7CgovLy8gQGRldiBUaGlzIGNvbnRyYWN0IGlzIHVzZWQgdG8gZ2VuZXJhdGUgY2xvbmUgY29udHJhY3RzIGZyb20gYSBjb250cmFjdC4KLy8vICBJbiBzb2xpZGl0eSB0aGlzIGlzIHRoZSB3YXkgdG8gY3JlYXRlIGEgY29udHJhY3QgZnJvbSBhIGNvbnRyYWN0IG9mIHRoZQovLy8gIHNhbWUgY2xhc3MKY29udHJhY3QgTWluaU1lVG9rZW5GYWN0b3J5IHsKCiAgICBmdW5jdGlvbiBNaW5pTWVUb2tlbkZhY3RvcnkoKSB7CiAgICB9CgogICAgLy8vIEBub3RpY2UgVXBkYXRlIHRoZSBEQXBwIGJ5IGNyZWF0aW5nIGEgbmV3IHRva2VuIHdpdGggbmV3IGZ1bmN0aW9uYWxpdGllcwogICAgLy8vICB0aGUgbXNnLnNlbmRlciBiZWNvbWVzIHRoZSBjb250cm9sbGVyIG9mIHRoaXMgY2xvbmUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3BhcmVudFRva2VuIEFkZHJlc3Mgb2YgdGhlIHRva2VuIGJlaW5nIGNsb25lZAogICAgLy8vIEBwYXJhbSBfc25hcHNob3RCbG9jayBCbG9jayBvZiB0aGUgcGFyZW50IHRva2VuIHRoYXQgd2lsbAogICAgLy8vICBkZXRlcm1pbmUgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBjbG9uZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5OYW1lIE5hbWUgb2YgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfZGVjaW1hbFVuaXRzIE51bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF90b2tlblN5bWJvbCBUb2tlbiBTeW1ib2wgZm9yIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgSWYgdHJ1ZSwgdG9rZW5zIHdpbGwgYmUgYWJsZSB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyB0b2tlbiBjb250cmFjdAogICAgZnVuY3Rpb24gY3JlYXRlQ2xvbmVUb2tlbigKICAgICAgICBhZGRyZXNzIF9wYXJlbnRUb2tlbiwKICAgICAgICB1aW50IF9zbmFwc2hvdEJsb2NrLAogICAgICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgICAgIHVpbnQ4IF9kZWNpbWFsVW5pdHMsCiAgICAgICAgc3RyaW5nIF90b2tlblN5bWJvbCwKICAgICAgICBib29sIF90cmFuc2ZlcnNFbmFibGVkCiAgICApIHJldHVybnMgKE1pbmlNZVRva2VuKSAKICAgIHsKICAgICAgICBNaW5pTWVUb2tlbiBuZXdUb2tlbiA9IG5ldyBNaW5pTWVUb2tlbigKICAgICAgICAgICAgdGhpcywKICAgICAgICAgICAgX3BhcmVudFRva2VuLAogICAgICAgICAgICBfc25hcHNob3RCbG9jaywKICAgICAgICAgICAgX3Rva2VuTmFtZSwKICAgICAgICAgICAgX2RlY2ltYWxVbml0cywKICAgICAgICAgICAgX3Rva2VuU3ltYm9sLAogICAgICAgICAgICBfdHJhbnNmZXJzRW5hYmxlZAogICAgICAgICAgICApOwoKICAgICAgICBuZXdUb2tlbi5jaGFuZ2VDb250cm9sbGVyKG1zZy5zZW5kZXIpOwogICAgICAgIHJldHVybiBuZXdUb2tlbjsKICAgIH0KfQoKLy8vIEBkZXYgVGhlIHRva2VuIGNvbnRyb2xsZXIgY29udHJhY3QgbXVzdCBpbXBsZW1lbnQgdGhlc2UgZnVuY3Rpb25zCmNvbnRyYWN0IFRva2VuQ29udHJvbGxlciB7CiAgICAvLy8gQG5vdGljZSBDYWxsZWQgd2hlbiBgX293bmVyYCBzZW5kcyBldGhlciB0byB0aGUgTWluaU1lIFRva2VuIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IHNlbnQgdGhlIGV0aGVyIHRvIGNyZWF0ZSB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIGV0aGVyIGlzIGFjY2VwdGVkLCBmYWxzZSBpZiBpdCB0aHJvd3MKICAgIGZ1bmN0aW9uIHByb3h5UGF5bWVudChhZGRyZXNzIF9vd25lcikgcGF5YWJsZSByZXR1cm5zKGJvb2wpOwoKICAgIC8vLyBAbm90aWNlIE5vdGlmaWVzIHRoZSBjb250cm9sbGVyIGFib3V0IGEgdG9rZW4gdHJhbnNmZXIgYWxsb3dpbmcgdGhlCiAgICAvLy8gIGNvbnRyb2xsZXIgdG8gcmVhY3QgaWYgZGVzaXJlZAogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgb3JpZ2luIG9mIHRoZSB0cmFuc2ZlcgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGRlc3RpbmF0aW9uIG9mIHRoZSB0cmFuc2ZlcgogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdGhlIHRyYW5zZmVyCiAgICAvLy8gQHJldHVybiBGYWxzZSBpZiB0aGUgY29udHJvbGxlciBkb2VzIG5vdCBhdXRob3JpemUgdGhlIHRyYW5zZmVyCiAgICBmdW5jdGlvbiBvblRyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF9hbW91bnQpIHJldHVybnMoYm9vbCk7CgogICAgLy8vIEBub3RpY2UgTm90aWZpZXMgdGhlIGNvbnRyb2xsZXIgYWJvdXQgYW4gYXBwcm92YWwgYWxsb3dpbmcgdGhlCiAgICAvLy8gIGNvbnRyb2xsZXIgdG8gcmVhY3QgaWYgZGVzaXJlZAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCBjYWxscyBgYXBwcm92ZSgpYAogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgc3BlbmRlciBpbiB0aGUgYGFwcHJvdmUoKWAgY2FsbAogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgaW4gdGhlIGBhcHByb3ZlKClgIGNhbGwKICAgIC8vLyBAcmV0dXJuIEZhbHNlIGlmIHRoZSBjb250cm9sbGVyIGRvZXMgbm90IGF1dGhvcml6ZSB0aGUgYXBwcm92YWwKICAgIGZ1bmN0aW9uIG9uQXBwcm92ZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYW1vdW50KQogICAgICAgIHJldHVybnMoYm9vbCk7Cn0KCgpjb250cmFjdCBDb250cm9sbGVkIHsKICAgIC8vLyBAbm90aWNlIFRoZSBhZGRyZXNzIG9mIHRoZSBjb250cm9sbGVyIGlzIHRoZSBvbmx5IGFkZHJlc3MgdGhhdCBjYW4gY2FsbAogICAgLy8vICBhIGZ1bmN0aW9uIHdpdGggdGhpcyBtb2RpZmllcgogICAgbW9kaWZpZXIgb25seUNvbnRyb2xsZXIgeyByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY29udHJvbGxlcik7IF87IH0KCiAgICBhZGRyZXNzIHB1YmxpYyBjb250cm9sbGVyOwoKICAgIGZ1bmN0aW9uIENvbnRyb2xsZWQoKSB7IGNvbnRyb2xsZXIgPSBtc2cuc2VuZGVyO30KCiAgICAvLy8gQG5vdGljZSBDaGFuZ2VzIHRoZSBjb250cm9sbGVyIG9mIHRoZSBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfbmV3Q29udHJvbGxlciBUaGUgbmV3IGNvbnRyb2xsZXIgb2YgdGhlIGNvbnRyYWN0CiAgICBmdW5jdGlvbiBjaGFuZ2VDb250cm9sbGVyKGFkZHJlc3MgX25ld0NvbnRyb2xsZXIpIG9ubHlDb250cm9sbGVyIHsKICAgICAgICBjb250cm9sbGVyID0gX25ld0NvbnRyb2xsZXI7CiAgICB9Cn0KCmNvbnRyYWN0IEFwcHJvdmVBbmRDYWxsRmFsbEJhY2sgewogICAgZnVuY3Rpb24gcmVjZWl2ZUFwcHJvdmFsKGFkZHJlc3MgZnJvbSwgdWludDI1NiBfYW1vdW50LCBhZGRyZXNzIF90b2tlbiwgYnl0ZXMgX2RhdGEpOwp9CgovKgogICAgQ29weXJpZ2h0IDIwMTYsIEpvcmRpIEJheWxpbmEKCiAgICBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQogICAgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkKICAgIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yCiAgICAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgoKICAgIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAogICAgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKICAgIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUKICAgIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCgogICAgWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UKICAgIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LgogKi8KCi8vLyBAdGl0bGUgTWluaU1lVG9rZW4gQ29udHJhY3QKLy8vIEBhdXRob3IgSm9yZGkgQmF5bGluYQovLy8gQGRldiBUaGlzIHRva2VuIGNvbnRyYWN0J3MgZ29hbCBpcyB0byBtYWtlIGl0IGVhc3kgZm9yIGFueW9uZSB0byBjbG9uZSB0aGlzCi8vLyAgdG9rZW4gdXNpbmcgdGhlIHRva2VuIGRpc3RyaWJ1dGlvbiBhdCBhIGdpdmVuIGJsb2NrLCB0aGlzIHdpbGwgYWxsb3cgREFPJ3MKLy8vICBhbmQgREFwcHMgdG8gdXBncmFkZSB0aGVpciBmZWF0dXJlcyBpbiBhIGRlY2VudHJhbGl6ZWQgbWFubmVyIHdpdGhvdXQKLy8vICBhZmZlY3RpbmcgdGhlIG9yaWdpbmFsIHRva2VuCi8vLyBAZGV2IEl0IGlzIEVSQzIwIGNvbXBsaWFudCwgYnV0IHN0aWxsIG5lZWRzIHRvIHVuZGVyIGdvIGZ1cnRoZXIgdGVzdGluZy4KCi8vLyBAZGV2IFRoZSBhY3R1YWwgdG9rZW4gY29udHJhY3QsIHRoZSBkZWZhdWx0IGNvbnRyb2xsZXIgaXMgdGhlIG1zZy5zZW5kZXIKLy8vICB0aGF0IGRlcGxveXMgdGhlIGNvbnRyYWN0LCBzbyB1c3VhbGx5IHRoaXMgdG9rZW4gd2lsbCBiZSBkZXBsb3llZCBieSBhCi8vLyAgdG9rZW4gY29udHJvbGxlciBjb250cmFjdCwgd2hpY2ggR2l2ZXRoIHdpbGwgY2FsbCBhICJDYW1wYWlnbiIKY29udHJhY3QgTWluaU1lVG9rZW4gaXMgQ29udHJvbGxlZCB7CgogICAgc3RyaW5nIHB1YmxpYyBuYW1lOyAgICAgICAgICAgICAgICAvL1RoZSBUb2tlbidzIG5hbWU6IGUuZy4gRGlnaXhEQU8gVG9rZW5zCiAgICB1aW50OCBwdWJsaWMgZGVjaW1hbHM7ICAgICAgICAgICAgIC8vTnVtYmVyIG9mIGRlY2ltYWxzIG9mIHRoZSBzbWFsbGVzdCB1bml0CiAgICBzdHJpbmcgcHVibGljIHN5bWJvbDsgICAgICAgICAgICAgIC8vQW4gaWRlbnRpZmllcjogZS5nLiBSRVAKICAgIHN0cmluZyBwdWJsaWMgdmVyc2lvbiA9ICdNTVRfMC4xJzsgLy9BbiBhcmJpdHJhcnkgdmVyc2lvbmluZyBzY2hlbWUKCgogICAgLy8vIEBkZXYgYENoZWNrcG9pbnRgIGlzIHRoZSBzdHJ1Y3R1cmUgdGhhdCBhdHRhY2hlcyBhIGJsb2NrIG51bWJlciB0byBhCiAgICAvLy8gIGdpdmVuIHZhbHVlLCB0aGUgYmxvY2sgbnVtYmVyIGF0dGFjaGVkIGlzIHRoZSBvbmUgdGhhdCBsYXN0IGNoYW5nZWQgdGhlCiAgICAvLy8gIHZhbHVlCiAgICBzdHJ1Y3QgIENoZWNrcG9pbnQgewoKICAgICAgICAvLyBgZnJvbUJsb2NrYCBpcyB0aGUgYmxvY2sgbnVtYmVyIHRoYXQgdGhlIHZhbHVlIHdhcyBnZW5lcmF0ZWQgZnJvbQogICAgICAgIHVpbnQxMjggZnJvbUJsb2NrOwoKICAgICAgICAvLyBgdmFsdWVgIGlzIHRoZSBhbW91bnQgb2YgdG9rZW5zIGF0IGEgc3BlY2lmaWMgYmxvY2sgbnVtYmVyCiAgICAgICAgdWludDEyOCB2YWx1ZTsKICAgIH0KCiAgICAvLyBgcGFyZW50VG9rZW5gIGlzIHRoZSBUb2tlbiBhZGRyZXNzIHRoYXQgd2FzIGNsb25lZCB0byBwcm9kdWNlIHRoaXMgdG9rZW47CiAgICAvLyAgaXQgd2lsbCBiZSAweDAgZm9yIGEgdG9rZW4gdGhhdCB3YXMgbm90IGNsb25lZAogICAgTWluaU1lVG9rZW4gcHVibGljIHBhcmVudFRva2VuOwoKICAgIC8vIGBwYXJlbnRTbmFwU2hvdEJsb2NrYCBpcyB0aGUgYmxvY2sgbnVtYmVyIGZyb20gdGhlIFBhcmVudCBUb2tlbiB0aGF0IHdhcwogICAgLy8gIHVzZWQgdG8gZGV0ZXJtaW5lIHRoZSBpbml0aWFsIGRpc3RyaWJ1dGlvbiBvZiB0aGUgQ2xvbmUgVG9rZW4KICAgIHVpbnQgcHVibGljIHBhcmVudFNuYXBTaG90QmxvY2s7CgogICAgLy8gYGNyZWF0aW9uQmxvY2tgIGlzIHRoZSBibG9jayBudW1iZXIgdGhhdCB0aGUgQ2xvbmUgVG9rZW4gd2FzIGNyZWF0ZWQKICAgIHVpbnQgcHVibGljIGNyZWF0aW9uQmxvY2s7CgogICAgLy8gYGJhbGFuY2VzYCBpcyB0aGUgbWFwIHRoYXQgdHJhY2tzIHRoZSBiYWxhbmNlIG9mIGVhY2ggYWRkcmVzcywgaW4gdGhpcwogICAgLy8gIGNvbnRyYWN0IHdoZW4gdGhlIGJhbGFuY2UgY2hhbmdlcyB0aGUgYmxvY2sgbnVtYmVyIHRoYXQgdGhlIGNoYW5nZQogICAgLy8gIG9jY3VycmVkIGlzIGFsc28gaW5jbHVkZWQgaW4gdGhlIG1hcAogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBDaGVja3BvaW50W10pIGJhbGFuY2VzOwoKICAgIC8vIGBhbGxvd2VkYCB0cmFja3MgYW55IGV4dHJhIHRyYW5zZmVyIHJpZ2h0cyBhcyBpbiBhbGwgRVJDMjAgdG9rZW5zCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CgogICAgLy8gVHJhY2tzIHRoZSBoaXN0b3J5IG9mIHRoZSBgdG90YWxTdXBwbHlgIG9mIHRoZSB0b2tlbgogICAgQ2hlY2twb2ludFtdIHRvdGFsU3VwcGx5SGlzdG9yeTsKCiAgICAvLyBGbGFnIHRoYXQgZGV0ZXJtaW5lcyBpZiB0aGUgdG9rZW4gaXMgdHJhbnNmZXJhYmxlIG9yIG5vdC4KICAgIGJvb2wgcHVibGljIHRyYW5zZmVyc0VuYWJsZWQ7CgogICAgLy8gVGhlIGZhY3RvcnkgdXNlZCB0byBjcmVhdGUgbmV3IGNsb25lIHRva2VucwogICAgTWluaU1lVG9rZW5GYWN0b3J5IHB1YmxpYyB0b2tlbkZhY3Rvcnk7CgovLy8vLy8vLy8vLy8vLy8vCi8vIENvbnN0cnVjdG9yCi8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBDb25zdHJ1Y3RvciB0byBjcmVhdGUgYSBNaW5pTWVUb2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5GYWN0b3J5IFRoZSBhZGRyZXNzIG9mIHRoZSBNaW5pTWVUb2tlbkZhY3RvcnkgY29udHJhY3QgdGhhdAogICAgLy8vICB3aWxsIGNyZWF0ZSB0aGUgQ2xvbmUgdG9rZW4gY29udHJhY3RzLCB0aGUgdG9rZW4gZmFjdG9yeSBuZWVkcyB0byBiZQogICAgLy8vICBkZXBsb3llZCBmaXJzdAogICAgLy8vIEBwYXJhbSBfcGFyZW50VG9rZW4gQWRkcmVzcyBvZiB0aGUgcGFyZW50IHRva2VuLCBzZXQgdG8gMHgwIGlmIGl0IGlzIGEKICAgIC8vLyAgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF9wYXJlbnRTbmFwU2hvdEJsb2NrIEJsb2NrIG9mIHRoZSBwYXJlbnQgdG9rZW4gdGhhdCB3aWxsCiAgICAvLy8gIGRldGVybWluZSB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gb2YgdGhlIGNsb25lIHRva2VuLCBzZXQgdG8gMCBpZiBpdAogICAgLy8vICBpcyBhIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5OYW1lIE5hbWUgb2YgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfZGVjaW1hbFVuaXRzIE51bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF90b2tlblN5bWJvbCBUb2tlbiBTeW1ib2wgZm9yIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgSWYgdHJ1ZSwgdG9rZW5zIHdpbGwgYmUgYWJsZSB0byBiZSB0cmFuc2ZlcnJlZAogICAgZnVuY3Rpb24gTWluaU1lVG9rZW4oCiAgICAgICAgYWRkcmVzcyBfdG9rZW5GYWN0b3J5LAogICAgICAgIGFkZHJlc3MgX3BhcmVudFRva2VuLAogICAgICAgIHVpbnQgX3BhcmVudFNuYXBTaG90QmxvY2ssCiAgICAgICAgc3RyaW5nIF90b2tlbk5hbWUsCiAgICAgICAgdWludDggX2RlY2ltYWxVbml0cywKICAgICAgICBzdHJpbmcgX3Rva2VuU3ltYm9sLAogICAgICAgIGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQKICAgICkgCiAgICBDb250cm9sbGVkKCkKICAgIHsKICAgICAgICB0b2tlbkZhY3RvcnkgPSBNaW5pTWVUb2tlbkZhY3RvcnkoX3Rva2VuRmFjdG9yeSk7CiAgICAgICAgbmFtZSA9IF90b2tlbk5hbWU7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBuYW1lCiAgICAgICAgZGVjaW1hbHMgPSBfZGVjaW1hbFVuaXRzOyAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBkZWNpbWFscwogICAgICAgIHN5bWJvbCA9IF90b2tlblN5bWJvbDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgc3ltYm9sCiAgICAgICAgcGFyZW50VG9rZW4gPSBNaW5pTWVUb2tlbihfcGFyZW50VG9rZW4pOwogICAgICAgIHBhcmVudFNuYXBTaG90QmxvY2sgPSBfcGFyZW50U25hcFNob3RCbG9jazsKICAgICAgICB0cmFuc2ZlcnNFbmFibGVkID0gX3RyYW5zZmVyc0VuYWJsZWQ7CiAgICAgICAgY3JlYXRpb25CbG9jayA9IGJsb2NrLm51bWJlcjsKICAgIH0KCgovLy8vLy8vLy8vLy8vLy8vLy8vCi8vIEVSQzIwIE1ldGhvZHMKLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIFNlbmQgYF9hbW91bnRgIHRva2VucyB0byBgX3RvYCBmcm9tIGBtc2cuc2VuZGVyYAogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCBvciBub3QKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUodHJhbnNmZXJzRW5hYmxlZCk7CiAgICAgICAgcmV0dXJuIGRvVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfYW1vdW50KTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBTZW5kIGBfYW1vdW50YCB0b2tlbnMgdG8gYF90b2AgZnJvbSBgX2Zyb21gIG9uIHRoZSBjb25kaXRpb24gaXQKICAgIC8vLyAgaXMgYXBwcm92ZWQgYnkgYF9mcm9tYAogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBob2xkaW5nIHRoZSB0b2tlbnMgYmVpbmcgdHJhbnNmZXJyZWQKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50CiAgICApIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewoKICAgICAgICAvLyBUaGUgY29udHJvbGxlciBvZiB0aGlzIGNvbnRyYWN0IGNhbiBtb3ZlIHRva2VucyBhcm91bmQgYXQgd2lsbCwKCiAgICAgICAgLy8gIGNvbnRyb2xsZXIgb2YgdGhpcyBjb250cmFjdCwgd2hpY2ggaW4gbW9zdCBzaXR1YXRpb25zIHNob3VsZCBiZQogICAgICAgIC8vICBhbm90aGVyIG9wZW4gc291cmNlIHNtYXJ0IGNvbnRyYWN0IG9yIDB4MAogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IGNvbnRyb2xsZXIpIHsKICAgICAgICAgICAgcmVxdWlyZSh0cmFuc2ZlcnNFbmFibGVkKTsKCiAgICAgICAgICAgIC8vIFRoZSBzdGFuZGFyZCBFUkMgMjAgdHJhbnNmZXJGcm9tIGZ1bmN0aW9uYWxpdHkKICAgICAgICAgICAgaWYgKGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdIDwgX2Ftb3VudCkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSAtPSBfYW1vdW50OwogICAgICAgIH0KICAgICAgICByZXR1cm4gZG9UcmFuc2ZlcihfZnJvbSwgX3RvLCBfYW1vdW50KTsKICAgIH0KCiAgICAvLy8gQGRldiBUaGlzIGlzIHRoZSBhY3R1YWwgdHJhbnNmZXIgZnVuY3Rpb24gaW4gdGhlIHRva2VuIGNvbnRyYWN0LCBpdCBjYW4KICAgIC8vLyAgb25seSBiZSBjYWxsZWQgYnkgb3RoZXIgZnVuY3Rpb25zIGluIHRoaXMgY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIGhvbGRpbmcgdGhlIHRva2VucyBiZWluZyB0cmFuc2ZlcnJlZAogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bAogICAgZnVuY3Rpb24gZG9UcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfYW1vdW50CiAgICApIGludGVybmFsIHJldHVybnMoYm9vbCkgewoKICAgICAgICAgICBpZiAoX2Ftb3VudCA9PSAwKSB7CiAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgIH0KCiAgICAgICAgICAgcmVxdWlyZShwYXJlbnRTbmFwU2hvdEJsb2NrIDwgYmxvY2subnVtYmVyKTsKCiAgICAgICAgICAgLy8gRG8gbm90IGFsbG93IHRyYW5zZmVyIHRvIDB4MCBvciB0aGUgdG9rZW4gY29udHJhY3QgaXRzZWxmCiAgICAgICAgICAgcmVxdWlyZSgoX3RvICE9IDApICYmIChfdG8gIT0gYWRkcmVzcyh0aGlzKSkpOwoKICAgICAgICAgICAvLyBJZiB0aGUgYW1vdW50IGJlaW5nIHRyYW5zZmVyZWQgaXMgbW9yZSB0aGFuIHRoZSBiYWxhbmNlIG9mIHRoZQogICAgICAgICAgIC8vICBhY2NvdW50IHRoZSB0cmFuc2ZlciByZXR1cm5zIGZhbHNlCiAgICAgICAgICAgdmFyIHByZXZpb3VzQmFsYW5jZUZyb20gPSBiYWxhbmNlT2ZBdChfZnJvbSwgYmxvY2subnVtYmVyKTsKICAgICAgICAgICBpZiAocHJldmlvdXNCYWxhbmNlRnJvbSA8IF9hbW91bnQpIHsKICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgIH0KCiAgICAgICAgICAgLy8gRmlyc3QgdXBkYXRlIHRoZSBiYWxhbmNlIGFycmF5IHdpdGggdGhlIG5ldyB2YWx1ZSBmb3IgdGhlIGFkZHJlc3MKICAgICAgICAgICAvLyAgc2VuZGluZyB0aGUgdG9rZW5zCiAgICAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfZnJvbV0sIHByZXZpb3VzQmFsYW5jZUZyb20gLSBfYW1vdW50KTsKCiAgICAgICAgICAgLy8gVGhlbiB1cGRhdGUgdGhlIGJhbGFuY2UgYXJyYXkgd2l0aCB0aGUgbmV3IHZhbHVlIGZvciB0aGUgYWRkcmVzcwogICAgICAgICAgIC8vICByZWNlaXZpbmcgdGhlIHRva2VucwogICAgICAgICAgIHZhciBwcmV2aW91c0JhbGFuY2VUbyA9IGJhbGFuY2VPZkF0KF90bywgYmxvY2subnVtYmVyKTsKICAgICAgICAgICByZXF1aXJlKHByZXZpb3VzQmFsYW5jZVRvICsgX2Ftb3VudCA+PSBwcmV2aW91c0JhbGFuY2VUbyk7IC8vIENoZWNrIGZvciBvdmVyZmxvdwogICAgICAgICAgIHVwZGF0ZVZhbHVlQXROb3coYmFsYW5jZXNbX3RvXSwgcHJldmlvdXNCYWxhbmNlVG8gKyBfYW1vdW50KTsKCiAgICAgICAgICAgLy8gQW4gZXZlbnQgdG8gbWFrZSB0aGUgdHJhbnNmZXIgZWFzeSB0byBmaW5kIG9uIHRoZSBibG9ja2NoYWluCiAgICAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX2Ftb3VudCk7CgogICAgICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQncyBiYWxhbmNlIGlzIGJlaW5nIHJlcXVlc3RlZAogICAgLy8vIEByZXR1cm4gVGhlIGJhbGFuY2Ugb2YgYF9vd25lcmAgYXQgdGhlIGN1cnJlbnQgYmxvY2sKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VPZkF0KF9vd25lciwgYmxvY2subnVtYmVyKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBgbXNnLnNlbmRlcmAgYXBwcm92ZXMgYF9zcGVuZGVyYCB0byBzcGVuZCBgX2Ftb3VudGAgdG9rZW5zIG9uCiAgICAvLy8gIGl0cyBiZWhhbGYuIFRoaXMgaXMgYSBtb2RpZmllZCB2ZXJzaW9uIG9mIHRoZSBFUkMyMCBhcHByb3ZlIGZ1bmN0aW9uCiAgICAvLy8gIHRvIGJlIGEgbGl0dGxlIGJpdCBzYWZlcgogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBhcHByb3ZlZCBmb3IgdHJhbnNmZXIKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIGFwcHJvdmFsIHdhcyBzdWNjZXNzZnVsCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX2Ftb3VudCkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmVxdWlyZSh0cmFuc2ZlcnNFbmFibGVkKTsKCiAgICAgICAgLy8gVG8gY2hhbmdlIHRoZSBhcHByb3ZlIGFtb3VudCB5b3UgZmlyc3QgaGF2ZSB0byByZWR1Y2UgdGhlIGFkZHJlc3Nlc2AKICAgICAgICAvLyAgYWxsb3dhbmNlIHRvIHplcm8gYnkgY2FsbGluZyBgYXBwcm92ZShfc3BlbmRlciwwKWAgaWYgaXQgaXMgbm90CiAgICAgICAgLy8gIGFscmVhZHkgMCB0byBtaXRpZ2F0ZSB0aGUgcmFjZSBjb25kaXRpb24gZGVzY3JpYmVkIGhlcmU6CiAgICAgICAgLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICAgICAgcmVxdWlyZSgoX2Ftb3VudCA9PSAwKSB8fCAoYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPT0gMCkpOwoKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF9hbW91bnQ7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF9hbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAZGV2IFRoaXMgZnVuY3Rpb24gbWFrZXMgaXQgZWFzeSB0byByZWFkIHRoZSBgYWxsb3dlZFtdYCBtYXAKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IHRoYXQgb3ducyB0aGUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHJldHVybiBBbW91bnQgb2YgcmVtYWluaW5nIHRva2VucyBvZiBfb3duZXIgdGhhdCBfc3BlbmRlciBpcyBhbGxvd2VkCiAgICAvLy8gIHRvIHNwZW5kCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIKICAgICkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBgbXNnLnNlbmRlcmAgYXBwcm92ZXMgYF9zcGVuZGVyYCB0byBzZW5kIGBfYW1vdW50YCB0b2tlbnMgb24KICAgIC8vLyAgaXRzIGJlaGFsZiwgYW5kIHRoZW4gYSBmdW5jdGlvbiBpcyB0cmlnZ2VyZWQgaW4gdGhlIGNvbnRyYWN0IHRoYXQgaXMKICAgIC8vLyAgYmVpbmcgYXBwcm92ZWQsIGBfc3BlbmRlcmAuIFRoaXMgYWxsb3dzIHVzZXJzIHRvIHVzZSB0aGVpciB0b2tlbnMgdG8KICAgIC8vLyAgaW50ZXJhY3Qgd2l0aCBjb250cmFjdHMgaW4gb25lIGZ1bmN0aW9uIGNhbGwgaW5zdGVhZCBvZiB0d28KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGNvbnRyYWN0IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2VucwogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgZnVuY3Rpb24gY2FsbCB3YXMgc3VjY2Vzc2Z1bAogICAgZnVuY3Rpb24gYXBwcm92ZUFuZENhbGwoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfYW1vdW50LCBieXRlcyBfZXh0cmFEYXRhCiAgICApIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUoYXBwcm92ZShfc3BlbmRlciwgX2Ftb3VudCkpOwoKICAgICAgICBBcHByb3ZlQW5kQ2FsbEZhbGxCYWNrKF9zcGVuZGVyKS5yZWNlaXZlQXBwcm92YWwoCiAgICAgICAgICAgIG1zZy5zZW5kZXIsCiAgICAgICAgICAgIF9hbW91bnQsCiAgICAgICAgICAgIHRoaXMsCiAgICAgICAgICAgIF9leHRyYURhdGEKICAgICAgICApOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBUaGlzIGZ1bmN0aW9uIG1ha2VzIGl0IGVhc3kgdG8gZ2V0IHRoZSB0b3RhbCBudW1iZXIgb2YgdG9rZW5zCiAgICAvLy8gQHJldHVybiBUaGUgdG90YWwgbnVtYmVyIG9mIHRva2VucwogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHRvdGFsU3VwcGx5QXQoYmxvY2subnVtYmVyKTsKICAgIH0KCgovLy8vLy8vLy8vLy8vLy8vCi8vIFF1ZXJ5IGJhbGFuY2UgYW5kIHRvdGFsU3VwcGx5IGluIEhpc3RvcnkKLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAZGV2IFF1ZXJpZXMgdGhlIGJhbGFuY2Ugb2YgYF9vd25lcmAgYXQgYSBzcGVjaWZpYyBgX2Jsb2NrTnVtYmVyYAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgZnJvbSB3aGljaCB0aGUgYmFsYW5jZSB3aWxsIGJlIHJldHJpZXZlZAogICAgLy8vIEBwYXJhbSBfYmxvY2tOdW1iZXIgVGhlIGJsb2NrIG51bWJlciB3aGVuIHRoZSBiYWxhbmNlIGlzIHF1ZXJpZWQKICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlIGF0IGBfYmxvY2tOdW1iZXJgCiAgICBmdW5jdGlvbiBiYWxhbmNlT2ZBdChhZGRyZXNzIF9vd25lciwgdWludCBfYmxvY2tOdW1iZXIpIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCkgewoKICAgICAgICAvLyBUaGVzZSBuZXh0IGZldyBsaW5lcyBhcmUgdXNlZCB3aGVuIHRoZSBiYWxhbmNlIG9mIHRoZSB0b2tlbiBpcwogICAgICAgIC8vICByZXF1ZXN0ZWQgYmVmb3JlIGEgY2hlY2sgcG9pbnQgd2FzIGV2ZXIgY3JlYXRlZCBmb3IgdGhpcyB0b2tlbiwgaXQKICAgICAgICAvLyAgcmVxdWlyZXMgdGhhdCB0aGUgYHBhcmVudFRva2VuLmJhbGFuY2VPZkF0YCBiZSBxdWVyaWVkIGF0IHRoZQogICAgICAgIC8vICBnZW5lc2lzIGJsb2NrIGZvciB0aGF0IHRva2VuIGFzIHRoaXMgY29udGFpbnMgaW5pdGlhbCBiYWxhbmNlIG9mCiAgICAgICAgLy8gIHRoaXMgdG9rZW4KICAgICAgICBpZiAoKGJhbGFuY2VzW19vd25lcl0ubGVuZ3RoID09IDApCiAgICAgICAgICAgIHx8IChiYWxhbmNlc1tfb3duZXJdWzBdLmZyb21CbG9jayA+IF9ibG9ja051bWJlcikpIHsKICAgICAgICAgICAgaWYgKGFkZHJlc3MocGFyZW50VG9rZW4pICE9IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwYXJlbnRUb2tlbi5iYWxhbmNlT2ZBdChfb3duZXIsIG1pbihfYmxvY2tOdW1iZXIsIHBhcmVudFNuYXBTaG90QmxvY2spKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEhhcyBubyBwYXJlbnQKICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICB9CgogICAgICAgIC8vIFRoaXMgd2lsbCByZXR1cm4gdGhlIGV4cGVjdGVkIGJhbGFuY2UgZHVyaW5nIG5vcm1hbCBzaXR1YXRpb25zCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGdldFZhbHVlQXQoYmFsYW5jZXNbX293bmVyXSwgX2Jsb2NrTnVtYmVyKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBub3RpY2UgVG90YWwgYW1vdW50IG9mIHRva2VucyBhdCBhIHNwZWNpZmljIGBfYmxvY2tOdW1iZXJgLgogICAgLy8vIEBwYXJhbSBfYmxvY2tOdW1iZXIgVGhlIGJsb2NrIG51bWJlciB3aGVuIHRoZSB0b3RhbFN1cHBseSBpcyBxdWVyaWVkCiAgICAvLy8gQHJldHVybiBUaGUgdG90YWwgYW1vdW50IG9mIHRva2VucyBhdCBgX2Jsb2NrTnVtYmVyYAogICAgZnVuY3Rpb24gdG90YWxTdXBwbHlBdCh1aW50IF9ibG9ja051bWJlcikgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7CgogICAgICAgIC8vIFRoZXNlIG5leHQgZmV3IGxpbmVzIGFyZSB1c2VkIHdoZW4gdGhlIHRvdGFsU3VwcGx5IG9mIHRoZSB0b2tlbiBpcwogICAgICAgIC8vICByZXF1ZXN0ZWQgYmVmb3JlIGEgY2hlY2sgcG9pbnQgd2FzIGV2ZXIgY3JlYXRlZCBmb3IgdGhpcyB0b2tlbiwgaXQKICAgICAgICAvLyAgcmVxdWlyZXMgdGhhdCB0aGUgYHBhcmVudFRva2VuLnRvdGFsU3VwcGx5QXRgIGJlIHF1ZXJpZWQgYXQgdGhlCiAgICAgICAgLy8gIGdlbmVzaXMgYmxvY2sgZm9yIHRoaXMgdG9rZW4gYXMgdGhhdCBjb250YWlucyB0b3RhbFN1cHBseSBvZiB0aGlzCiAgICAgICAgLy8gIHRva2VuIGF0IHRoaXMgYmxvY2sgbnVtYmVyLgogICAgICAgIGlmICgodG90YWxTdXBwbHlIaXN0b3J5Lmxlbmd0aCA9PSAwKQogICAgICAgICAgICB8fCAodG90YWxTdXBwbHlIaXN0b3J5WzBdLmZyb21CbG9jayA+IF9ibG9ja051bWJlcikpIHsKICAgICAgICAgICAgaWYgKGFkZHJlc3MocGFyZW50VG9rZW4pICE9IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwYXJlbnRUb2tlbi50b3RhbFN1cHBseUF0KG1pbihfYmxvY2tOdW1iZXIsIHBhcmVudFNuYXBTaG90QmxvY2spKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICB9CgogICAgICAgIC8vIFRoaXMgd2lsbCByZXR1cm4gdGhlIGV4cGVjdGVkIHRvdGFsU3VwcGx5IGR1cmluZyBub3JtYWwgc2l0dWF0aW9ucwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBnZXRWYWx1ZUF0KHRvdGFsU3VwcGx5SGlzdG9yeSwgX2Jsb2NrTnVtYmVyKTsKICAgICAgICB9CiAgICB9CgovLy8vLy8vLy8vLy8vLy8vCi8vIENsb25lIFRva2VuIE1ldGhvZAovLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgQ3JlYXRlcyBhIG5ldyBjbG9uZSB0b2tlbiB3aXRoIHRoZSBpbml0aWFsIGRpc3RyaWJ1dGlvbiBiZWluZwogICAgLy8vICB0aGlzIHRva2VuIGF0IGBfc25hcHNob3RCbG9ja2AKICAgIC8vLyBAcGFyYW0gX2Nsb25lVG9rZW5OYW1lIE5hbWUgb2YgdGhlIGNsb25lIHRva2VuCiAgICAvLy8gQHBhcmFtIF9jbG9uZURlY2ltYWxVbml0cyBOdW1iZXIgb2YgZGVjaW1hbHMgb2YgdGhlIHNtYWxsZXN0IHVuaXQKICAgIC8vLyBAcGFyYW0gX2Nsb25lVG9rZW5TeW1ib2wgU3ltYm9sIG9mIHRoZSBjbG9uZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfc25hcHNob3RCbG9jayBCbG9jayB3aGVuIHRoZSBkaXN0cmlidXRpb24gb2YgdGhlIHBhcmVudCB0b2tlbiBpcwogICAgLy8vICBjb3BpZWQgdG8gc2V0IHRoZSBpbml0aWFsIGRpc3RyaWJ1dGlvbiBvZiB0aGUgbmV3IGNsb25lIHRva2VuOwogICAgLy8vICBpZiB0aGUgYmxvY2sgaXMgemVybyB0aGFuIHRoZSBhY3R1YWwgYmxvY2ssIHRoZSBjdXJyZW50IGJsb2NrIGlzIHVzZWQKICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgVHJ1ZSBpZiB0cmFuc2ZlcnMgYXJlIGFsbG93ZWQgaW4gdGhlIGNsb25lCiAgICAvLy8gQHJldHVybiBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IE1pbmlNZVRva2VuIENvbnRyYWN0CiAgICBmdW5jdGlvbiBjcmVhdGVDbG9uZVRva2VuKAogICAgICAgIHN0cmluZyBfY2xvbmVUb2tlbk5hbWUsCiAgICAgICAgdWludDggX2Nsb25lRGVjaW1hbFVuaXRzLAogICAgICAgIHN0cmluZyBfY2xvbmVUb2tlblN5bWJvbCwKICAgICAgICB1aW50IF9zbmFwc2hvdEJsb2NrLAogICAgICAgIGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQKICAgICAgICApIHJldHVybnMoYWRkcmVzcykgewogICAgICAgIGlmIChfc25hcHNob3RCbG9jayA9PSAwKSBfc25hcHNob3RCbG9jayA9IGJsb2NrLm51bWJlcjsKICAgICAgICBNaW5pTWVUb2tlbiBjbG9uZVRva2VuID0gdG9rZW5GYWN0b3J5LmNyZWF0ZUNsb25lVG9rZW4oCiAgICAgICAgICAgIHRoaXMsCiAgICAgICAgICAgIF9zbmFwc2hvdEJsb2NrLAogICAgICAgICAgICBfY2xvbmVUb2tlbk5hbWUsCiAgICAgICAgICAgIF9jbG9uZURlY2ltYWxVbml0cywKICAgICAgICAgICAgX2Nsb25lVG9rZW5TeW1ib2wsCiAgICAgICAgICAgIF90cmFuc2ZlcnNFbmFibGVkCiAgICAgICAgICAgICk7CgogICAgICAgIGNsb25lVG9rZW4uY2hhbmdlQ29udHJvbGxlcihtc2cuc2VuZGVyKTsKCiAgICAgICAgLy8gQW4gZXZlbnQgdG8gbWFrZSB0aGUgdG9rZW4gZWFzeSB0byBmaW5kIG9uIHRoZSBibG9ja2NoYWluCiAgICAgICAgTmV3Q2xvbmVUb2tlbihhZGRyZXNzKGNsb25lVG9rZW4pLCBfc25hcHNob3RCbG9jayk7CiAgICAgICAgcmV0dXJuIGFkZHJlc3MoY2xvbmVUb2tlbik7CiAgICB9CgovLy8vLy8vLy8vLy8vLy8vCi8vIEdlbmVyYXRlIGFuZCBkZXN0cm95IHRva2VucwovLy8vLy8vLy8vLy8vLy8vCgoKICAgIC8vLyBAbm90aWNlIEdlbmVyYXRlcyBgX2Ftb3VudGAgdG9rZW5zIHRoYXQgYXJlIGFzc2lnbmVkIHRvIGBfb3duZXJgCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgYmUgYXNzaWduZWQgdGhlIG5ldyB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgcXVhbnRpdHkgb2YgdG9rZW5zIGdlbmVyYXRlZAogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdG9rZW5zIGFyZSBnZW5lcmF0ZWQgY29ycmVjdGx5CiAgICBmdW5jdGlvbiBnZW5lcmF0ZVRva2VucyhhZGRyZXNzIF9vd25lciwgdWludCBfYW1vdW50CiAgICApIG9ubHlDb250cm9sbGVyIHJldHVybnMgKGJvb2wpIHsKICAgICAgICB1aW50IGN1clRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkoKTsKICAgICAgICByZXF1aXJlKGN1clRvdGFsU3VwcGx5ICsgX2Ftb3VudCA+PSBjdXJUb3RhbFN1cHBseSk7IC8vIENoZWNrIGZvciBvdmVyZmxvdwogICAgICAgIHVpbnQgcHJldmlvdXNCYWxhbmNlVG8gPSBiYWxhbmNlT2YoX293bmVyKTsKICAgICAgICByZXF1aXJlKHByZXZpb3VzQmFsYW5jZVRvICsgX2Ftb3VudCA+PSBwcmV2aW91c0JhbGFuY2VUbyk7IC8vIENoZWNrIGZvciBvdmVyZmxvdwogICAgICAgIHVwZGF0ZVZhbHVlQXROb3codG90YWxTdXBwbHlIaXN0b3J5LCBjdXJUb3RhbFN1cHBseSArIF9hbW91bnQpOwogICAgICAgIHVwZGF0ZVZhbHVlQXROb3coYmFsYW5jZXNbX293bmVyXSwgcHJldmlvdXNCYWxhbmNlVG8gKyBfYW1vdW50KTsKICAgICAgICBUcmFuc2ZlcigwLCBfb3duZXIsIF9hbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKCiAgICAvLy8gQG5vdGljZSBCdXJucyBgX2Ftb3VudGAgdG9rZW5zIGZyb20gYF9vd25lcmAKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBsb3NlIHRoZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgcXVhbnRpdHkgb2YgdG9rZW5zIHRvIGJ1cm4KICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIHRva2VucyBhcmUgYnVybmVkIGNvcnJlY3RseQogICAgZnVuY3Rpb24gZGVzdHJveVRva2VucyhhZGRyZXNzIF9vd25lciwgdWludCBfYW1vdW50CiAgICApIG9ubHlDb250cm9sbGVyIHJldHVybnMgKGJvb2wpIHsKICAgICAgICB1aW50IGN1clRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkoKTsKICAgICAgICByZXF1aXJlKGN1clRvdGFsU3VwcGx5ID49IF9hbW91bnQpOwogICAgICAgIHVpbnQgcHJldmlvdXNCYWxhbmNlRnJvbSA9IGJhbGFuY2VPZihfb3duZXIpOwogICAgICAgIHJlcXVpcmUocHJldmlvdXNCYWxhbmNlRnJvbSA+PSBfYW1vdW50KTsKICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KHRvdGFsU3VwcGx5SGlzdG9yeSwgY3VyVG90YWxTdXBwbHkgLSBfYW1vdW50KTsKICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KGJhbGFuY2VzW19vd25lcl0sIHByZXZpb3VzQmFsYW5jZUZyb20gLSBfYW1vdW50KTsKICAgICAgICBUcmFuc2Zlcihfb3duZXIsIDAsIF9hbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKLy8vLy8vLy8vLy8vLy8vLwovLyBFbmFibGUgdG9rZW5zIHRyYW5zZmVycwovLy8vLy8vLy8vLy8vLy8vCgoKICAgIC8vLyBAbm90aWNlIEVuYWJsZXMgdG9rZW4gaG9sZGVycyB0byB0cmFuc2ZlciB0aGVpciB0b2tlbnMgZnJlZWx5IGlmIHRydWUKICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgVHJ1ZSBpZiB0cmFuc2ZlcnMgYXJlIGFsbG93ZWQgaW4gdGhlIGNsb25lCiAgICBmdW5jdGlvbiBlbmFibGVUcmFuc2ZlcnMoYm9vbCBfdHJhbnNmZXJzRW5hYmxlZCkgb25seUNvbnRyb2xsZXIgewogICAgICAgIHRyYW5zZmVyc0VuYWJsZWQgPSBfdHJhbnNmZXJzRW5hYmxlZDsKICAgIH0KCi8vLy8vLy8vLy8vLy8vLy8KLy8gSW50ZXJuYWwgaGVscGVyIGZ1bmN0aW9ucyB0byBxdWVyeSBhbmQgc2V0IGEgdmFsdWUgaW4gYSBzbmFwc2hvdCBhcnJheQovLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBkZXYgYGdldFZhbHVlQXRgIHJldHJpZXZlcyB0aGUgbnVtYmVyIG9mIHRva2VucyBhdCBhIGdpdmVuIGJsb2NrIG51bWJlcgogICAgLy8vIEBwYXJhbSBjaGVja3BvaW50cyBUaGUgaGlzdG9yeSBvZiB2YWx1ZXMgYmVpbmcgcXVlcmllZAogICAgLy8vIEBwYXJhbSBfYmxvY2sgVGhlIGJsb2NrIG51bWJlciB0byByZXRyaWV2ZSB0aGUgdmFsdWUgYXQKICAgIC8vLyBAcmV0dXJuIFRoZSBudW1iZXIgb2YgdG9rZW5zIGJlaW5nIHF1ZXJpZWQKICAgIGZ1bmN0aW9uIGdldFZhbHVlQXQoQ2hlY2twb2ludFtdIHN0b3JhZ2UgY2hlY2twb2ludHMsIHVpbnQgX2Jsb2NrCiAgICApIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICBpZiAoY2hlY2twb2ludHMubGVuZ3RoID09IDApIHJldHVybiAwOwoKICAgICAgICAvLyBTaG9ydGN1dCBmb3IgdGhlIGFjdHVhbCB2YWx1ZQogICAgICAgIGlmIChfYmxvY2sgPj0gY2hlY2twb2ludHNbY2hlY2twb2ludHMubGVuZ3RoLTFdLmZyb21CbG9jaykKICAgICAgICAgICAgcmV0dXJuIGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aC0xXS52YWx1ZTsKICAgICAgICBpZiAoX2Jsb2NrIDwgY2hlY2twb2ludHNbMF0uZnJvbUJsb2NrKSByZXR1cm4gMDsKCiAgICAgICAgLy8gQmluYXJ5IHNlYXJjaCBvZiB0aGUgdmFsdWUgaW4gdGhlIGFycmF5CiAgICAgICAgdWludCBtaW4gPSAwOwogICAgICAgIHVpbnQgbWF4ID0gY2hlY2twb2ludHMubGVuZ3RoLTE7CiAgICAgICAgd2hpbGUgKG1heCA+IG1pbikgewogICAgICAgICAgICB1aW50IG1pZCA9IChtYXggKyBtaW4gKyAxKS8gMjsKICAgICAgICAgICAgaWYgKGNoZWNrcG9pbnRzW21pZF0uZnJvbUJsb2NrPD1fYmxvY2spIHsKICAgICAgICAgICAgICAgIG1pbiA9IG1pZDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG1heCA9IG1pZC0xOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBjaGVja3BvaW50c1ttaW5dLnZhbHVlOwogICAgfQoKICAgIC8vLyBAZGV2IGB1cGRhdGVWYWx1ZUF0Tm93YCB1c2VkIHRvIHVwZGF0ZSB0aGUgYGJhbGFuY2VzYCBtYXAgYW5kIHRoZQogICAgLy8vICBgdG90YWxTdXBwbHlIaXN0b3J5YAogICAgLy8vIEBwYXJhbSBjaGVja3BvaW50cyBUaGUgaGlzdG9yeSBvZiBkYXRhIGJlaW5nIHVwZGF0ZWQKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBuZXcgbnVtYmVyIG9mIHRva2VucwogICAgZnVuY3Rpb24gdXBkYXRlVmFsdWVBdE5vdyhDaGVja3BvaW50W10gc3RvcmFnZSBjaGVja3BvaW50cywgdWludCBfdmFsdWUKICAgICkgaW50ZXJuYWwgIHsKICAgICAgICBpZiAoKGNoZWNrcG9pbnRzLmxlbmd0aCA9PSAwKQogICAgICAgIHx8IChjaGVja3BvaW50c1tjaGVja3BvaW50cy5sZW5ndGggLTFdLmZyb21CbG9jayA8IGJsb2NrLm51bWJlcikpIHsKICAgICAgICAgICAgICAgQ2hlY2twb2ludCBzdG9yYWdlIG5ld0NoZWNrUG9pbnQgPSBjaGVja3BvaW50c1sgY2hlY2twb2ludHMubGVuZ3RoKysgXTsKICAgICAgICAgICAgICAgbmV3Q2hlY2tQb2ludC5mcm9tQmxvY2sgPSAgdWludDEyOChibG9jay5udW1iZXIpOwogICAgICAgICAgICAgICBuZXdDaGVja1BvaW50LnZhbHVlID0gdWludDEyOChfdmFsdWUpOwogICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgIENoZWNrcG9pbnQgc3RvcmFnZSBvbGRDaGVja1BvaW50ID0gY2hlY2twb2ludHNbY2hlY2twb2ludHMubGVuZ3RoLTFdOwogICAgICAgICAgICAgICBvbGRDaGVja1BvaW50LnZhbHVlID0gdWludDEyOChfdmFsdWUpOwogICAgICAgICAgIH0KICAgIH0KCiAgICAvLy8gQGRldiBJbnRlcm5hbCBmdW5jdGlvbiB0byBkZXRlcm1pbmUgaWYgYW4gYWRkcmVzcyBpcyBhIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF9hZGRyIFRoZSBhZGRyZXNzIGJlaW5nIHF1ZXJpZWQKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgYF9hZGRyYCBpcyBhIGNvbnRyYWN0CiAgICBmdW5jdGlvbiBpc0NvbnRyYWN0KGFkZHJlc3MgX2FkZHIpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMoYm9vbCkgewogICAgICAgIHVpbnQgc2l6ZTsKICAgICAgICBpZiAoX2FkZHIgPT0gMCkgcmV0dXJuIGZhbHNlOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgc2l6ZSA6PSBleHRjb2Rlc2l6ZShfYWRkcikKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNpemU+MDsKICAgIH0KCiAgICAvLy8gQGRldiBIZWxwZXIgZnVuY3Rpb24gdG8gcmV0dXJuIGEgbWluIGJldHdlbiB0aGUgdHdvIHVpbnRzCiAgICBmdW5jdGlvbiBtaW4odWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUaGUgZmFsbGJhY2sgZnVuY3Rpb246IElmIHRoZSBjb250cmFjdCdzIGNvbnRyb2xsZXIgaGFzIG5vdCBiZWVuCiAgICAvLy8gIHNldCB0byAwLCB0aGVuIHRoZSBgcHJveHlQYXltZW50YCBtZXRob2QgaXMgY2FsbGVkIHdoaWNoIHJlbGF5cyB0aGUKICAgIC8vLyAgZXRoZXIgYW5kIGNyZWF0ZXMgdG9rZW5zIGFzIGRlc2NyaWJlZCBpbiB0aGUgdG9rZW4gY29udHJvbGxlciBjb250cmFjdAogICAgZnVuY3Rpb24gKCkgcGF5YWJsZSB7CiAgICAgICAgLy8gRmFpbCBhbnkgdHJhbnNmZXJzIGludG8gdGhlIHRva2VuIGNvbnRyYWN0CiAgICAgICAgcmVxdWlyZShmYWxzZSk7CiAgICB9CgovLy8vLy8vLy8vCi8vIFNhZmV0eSBNZXRob2RzCi8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBUaGlzIG1ldGhvZCBjYW4gYmUgdXNlZCBieSB0aGUgY29udHJvbGxlciB0byBleHRyYWN0IG1pc3Rha2VubHkKICAgIC8vLyAgc2VudCB0b2tlbnMgdG8gdGhpcyBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX3Rva2VuIFRoZSBhZGRyZXNzIG9mIHRoZSB0b2tlbiBjb250cmFjdCB0aGF0IHlvdSB3YW50IHRvIHJlY292ZXIKICAgIC8vLyAgc2V0IHRvIDAgaW4gY2FzZSB5b3Ugd2FudCB0byBleHRyYWN0IGV0aGVyLgogICAgZnVuY3Rpb24gY2xhaW1Ub2tlbnMoYWRkcmVzcyBfdG9rZW4pIG9ubHlDb250cm9sbGVyIHsKICAgICAgICBpZiAoX3Rva2VuID09IDB4MCkgewogICAgICAgICAgICBjb250cm9sbGVyLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIE1pbmlNZVRva2VuIHRva2VuID0gTWluaU1lVG9rZW4oX3Rva2VuKTsKICAgICAgICB1aW50IGJhbGFuY2UgPSB0b2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgICAgICAgdG9rZW4udHJhbnNmZXIoY29udHJvbGxlciwgYmFsYW5jZSk7CiAgICAgICAgQ2xhaW1lZFRva2VucyhfdG9rZW4sIGNvbnRyb2xsZXIsIGJhbGFuY2UpOwogICAgfQoKLy8vLy8vLy8vLy8vLy8vLwovLyBFdmVudHMKLy8vLy8vLy8vLy8vLy8vLwogICAgZXZlbnQgQ2xhaW1lZFRva2VucyhhZGRyZXNzIGluZGV4ZWQgX3Rva2VuLCBhZGRyZXNzIGluZGV4ZWQgX2NvbnRyb2xsZXIsIHVpbnQgX2Ftb3VudCk7CiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX2Ftb3VudCk7CiAgICBldmVudCBOZXdDbG9uZVRva2VuKGFkZHJlc3MgaW5kZXhlZCBfY2xvbmVUb2tlbiwgdWludCBfc25hcHNob3RCbG9jayk7CiAgICBldmVudCBBcHByb3ZhbCgKICAgICAgICBhZGRyZXNzIGluZGV4ZWQgX293bmVyLAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwKICAgICAgICB1aW50MjU2IF9hbW91bnQKICAgICAgICApOwoKfQoKLyoqCiAqIEB0aXRsZSBTYWZlTWF0aAogKiBAZGV2IE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MgdGhhdCB0aHJvdyBvbiBlcnJvcgogKi8KbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCi8qKgogKiBUaGlzIGNvbnRyYWN0IGluaGVyaXRzIGZyb20gdGhlIE1pbmltZVRva2VuIGFuZCBhZGRzIG1pbnRpbmcgY2FwYWJpbGl0eS4KICogV2hlbiB0aGUgc2FsZSBpcyBzdGFydGVkLCB0aGUgdG9rZW4gb3duZXJzaGlwIGlzIGhhbmRlZCBvdmVyIHRvIHRoZSBDcm93c2RhbGUgY29udHJhY3QuCiAqIFRoZSBjcm93ZHNhbGUgY29udHJhY3Qgd2lsbCBub3QgY2FsbCB0aGUgImdlbmVyYXRlVG9rZW5zKCkiIGNhbGwgZGlyZWN0bHkgaW4gdGhlIE1pbmltZVRva2VuLCAKICogYnV0IHdpbGwgaW5zdGVhZCB1c2UgdGhlIG1pbnRpbmcgZnVuY3Rpb25hbGl0eSBoZXJlLgogKi8KY29udHJhY3QgTWluaU1lTWludGFibGVUb2tlbiBpcyBNaW5pTWVUb2tlbiB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIC8vIEV2ZW50cyB0byBub3RpZnkgYWJvdXQgTWludGluZwogIGV2ZW50IE1pbnQoYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IGFtb3VudCk7CiAgZXZlbnQgTWludEZpbmlzaGVkKCk7CgogIC8vIEZsYWcgdG8gdHJhY2sgd2hldGhlciBtaW50aW5nIGlzIHN0aWxsIGFsbG93ZWQuCiAgYm9vbCBwdWJsaWMgbWludGluZ0ZpbmlzaGVkID0gZmFsc2U7CgogIC8vIFRoaXMgbWFwIHdpbGwga2VlcCB0cmFjayBvZiBob3cgbWFueSB0b2tlbnMgd2VyZSBpc3N1ZWQgZHVyaW5nIHRoZSB0b2tlbiBzYWxlLgogIC8vIFRoaXMgdmFsdWUgd2lsbCB0aGVuIGJlIHVzZWQgZm9yIHZlc3RpbmcgY2FsY3VsYXRpb25zIGZyb20gdGhlIHBvaW50IHdoZXJlIHRoZSB0b2tlbiBjb250cmFjdCBpcyBmaW5pc2hlZCBtaW50aW5nLgogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgaXNzdWVkVG9rZW5zOwoKICAvLyBNb2RpZmllciB0byBhbGxvdyBtaW50aW5nIG9mIHRva2Vucy4KICBtb2RpZmllciBjYW5NaW50KCkgewogICAgcmVxdWlyZSghbWludGluZ0ZpbmlzaGVkKTsKICAgIF87CiAgfQoKICAvLyBQYXNzIHRocm91Z2ggY29uc3J1Y3RvcgogIGZ1bmN0aW9uIE1pbmlNZU1pbnRhYmxlVG9rZW4oCiAgICBhZGRyZXNzIF90b2tlbkZhY3RvcnksCiAgICBhZGRyZXNzIF9wYXJlbnRUb2tlbiwKICAgIHVpbnQgX3BhcmVudFNuYXBTaG90QmxvY2ssCiAgICBzdHJpbmcgX3Rva2VuTmFtZSwKICAgIHVpbnQ4IF9kZWNpbWFsVW5pdHMsCiAgICBzdHJpbmcgX3Rva2VuU3ltYm9sLAogICAgYm9vbCBfdHJhbnNmZXJzRW5hYmxlZAogICkgCiAgTWluaU1lVG9rZW4oCiAgICBfdG9rZW5GYWN0b3J5LAogICAgX3BhcmVudFRva2VuLAogICAgX3BhcmVudFNuYXBTaG90QmxvY2ssCiAgICBfdG9rZW5OYW1lLAogICAgX2RlY2ltYWxVbml0cywKICAgIF90b2tlblN5bWJvbCwKICAgIF90cmFuc2ZlcnNFbmFibGVkCiAgKQogIHsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gbWludCB0b2tlbnMKICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCByZWNpZXZlIHRoZSBtaW50ZWQgdG9rZW5zLgogICAqIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIG1pbnQuCiAgICogQHJldHVybiBBIGJvb2xlYW4gdGhhdCBpbmRpY2F0ZXMgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bC4KICAgKi8KICBmdW5jdGlvbiBtaW50KGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIG9ubHlDb250cm9sbGVyIGNhbk1pbnQgcmV0dXJucyAoYm9vbCkgewoKICAgIC8vIEZpcnN0LCBnZW5lcmF0ZSB0aGUgdG9rZW5zIGluIHRoZSBiYXNlIE1pbmltZSBjbGFzcyBiYWxhbmNlcy4KICAgIGdlbmVyYXRlVG9rZW5zKF90bywgX2Ftb3VudCk7CgogICAgLy8gU2F2ZSBvZmYgdGhlIGFtb3VudCB0aGF0IHRoaXMgYWNjb3VudCBoYXMgYmVlbiBpc3N1ZWQgZHVyaW5nIHRoZSBtaW50aW5nIHBlcmlvZCBzbyB2ZXN0aW5nIGNhbiBiZSBjYWxjdWxhdGVkLgogICAgaXNzdWVkVG9rZW5zW190b10gPSBpc3N1ZWRUb2tlbnNbX3RvXS5hZGQoX2Ftb3VudCk7CgogICAgLy8gVHJpZ2dlciB0aGUgbWludGluZyBldmVudCBub3RpZmljYXRpb24KICAgIE1pbnQoX3RvLCBfYW1vdW50KTsKCiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gc3RvcCBtaW50aW5nIG5ldyB0b2tlbnMuCiAgICogQHJldHVybiBUcnVlIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwuCiAgICovCiAgZnVuY3Rpb24gZmluaXNoTWludGluZygpIG9ubHlDb250cm9sbGVyIGNhbk1pbnQgcmV0dXJucyAoYm9vbCkgewoKICAgIC8vIFNldCB0aGUgbWludGluZyBmaW5pc2hlZCBzbyB0aGF0IHRva2VucyBjYW4gYmUgdHJhbnNmZXJyZWQgb25jZSB2ZXN0ZWQuCiAgICAvLyBUaGlzIGZsYWcgd2lsbCBwcmV2ZW50IG5ldyB0b2tlbnMgZnJvbSBiZWluZyBtaW50ZWQgaW4gdGhlIGZ1dHVyZS4KICAgIG1pbnRpbmdGaW5pc2hlZCA9IHRydWU7CgogICAgLy8gVHJpZ2dlciB0aGUgbm90aWZpY2F0aW9uIHRoYXQgbWludGluZyBoYXMgZmluaXNoZWQuCiAgICBNaW50RmluaXNoZWQoKTsKICAgIAogICAgcmV0dXJuIHRydWU7CiAgfQp9CgovKioKICogVGhpcyBjb250cmFjdCBkZWZpbmVzIHRoZSB0b2tlbnMgZm9yIHRoZSBTV0FSTSBwbGF0Zm9ybS4KICogSXQgaW5oZXJpdHMgZnJvbSB0aGUgTWluaU1lVG9rZW4gY29udHJhY3Qgd2hpY2ggYWxsb3dzIHN1Yi10b2tlbnMgdG8gYmUgY3JlYXRlZC4KICogVGhpcyB0b2tlbiBhbHNvIGltcGxlbWVudHMgYSB2ZXN0aW5nIHNjaGVkdWxlIG9uIGFueSB0b2tlbnMgdGhhdCBhcmUgbWludGVkIGR1cmluZyB0aGUgcHJlLXNhbGUuCiAqIFRoZSBNaW50YWJsZVRva2VuIGNvbnRyYWN0IGlzIGFkYXB0ZWQgZnJvbSB0aGUgT3BlbiBaZXBwZWxpbiBjb250cmFjdC4KICovCmNvbnRyYWN0IE1pbmlNZVZlc3RlZFRva2VuIGlzIE1pbmlNZU1pbnRhYmxlVG9rZW4gewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAvLyBUaGlzIHZhbHVlIHdpbGwga2VlcCB0cmFjayBvZiB0aGUgdGltZSB3aGVuIHRoZSBtaW50aW5nIGlzIGZpbmlzaGVkIGFmdGVyIHRoZSBjcm93ZCBzYWxlIGVuZHMuCiAgLy8gVmVzdGluZyB3aWxsIHN0YXJ0IGFjY3J1aW5nIGF0IHRoaXMgcG9pbnQgaW4gdGltZS4KICB1aW50MjU2IHB1YmxpYyB2ZXN0aW5nU3RhcnRUaW1lID0gMDsKCiAgLy8gRGVmYXVsdCB2ZXN0aW5nIHBlcmlvZCBpcyA0MiBkYXlzLCB3aXRoIGEgbWF4IG9mIDggcGVyaW9kcwogIHVpbnQyNTYgcHVibGljIHZlc3RpbmdQZXJpb2RUaW1lID0gNDIgZGF5czsKICB1aW50MjU2IHB1YmxpYyB2ZXN0aW5nVG90YWxQZXJpb2RzID0gODsKCiAgLy8gUGFzcyB0aHJvdWdoIGNvbnNydWN0b3IKICBmdW5jdGlvbiBNaW5pTWVWZXN0ZWRUb2tlbigKICAgIGFkZHJlc3MgX3Rva2VuRmFjdG9yeSwKICAgIGFkZHJlc3MgX3BhcmVudFRva2VuLAogICAgdWludCBfcGFyZW50U25hcFNob3RCbG9jaywKICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgdWludDggX2RlY2ltYWxVbml0cywKICAgIHN0cmluZyBfdG9rZW5TeW1ib2wsCiAgICBib29sIF90cmFuc2ZlcnNFbmFibGVkCiAgKSAKICBNaW5pTWVNaW50YWJsZVRva2VuKAogICAgX3Rva2VuRmFjdG9yeSwKICAgIF9wYXJlbnRUb2tlbiwKICAgIF9wYXJlbnRTbmFwU2hvdEJsb2NrLAogICAgX3Rva2VuTmFtZSwKICAgIF9kZWNpbWFsVW5pdHMsCiAgICBfdG9rZW5TeW1ib2wsCiAgICBfdHJhbnNmZXJzRW5hYmxlZAogICkKICB7CiAgfQoKLy8vLy8vLy8vLy8vLy8vLy8vLy8KLy8gVG9rZW4gVHJhbnNmZXJzCi8vLy8vLy8vLy8vLy8vLy8vLy8vCgogIC8qKgogICAqIE1vZGlmaWVyIHRvIGZ1bmN0aW9ucyB0byBzZWUgaWYgdGhlIHZlc3RlZCBiYWxhbmNlIGlzIGhpZ2hlciB0aGFuIHJlcXVlc3RlZCB0cmFuc2ZlciBhbW91bnQuCiAgICogQWxzbyBlbmZvcmNlcyB0aGF0IHRoZSBtaW50aW5nIHBoYXNlIG9mIHRoZSBzYWxlIGlzIG92ZXIuCiAgICovCiAgbW9kaWZpZXIgY2FuVHJhbnNmZXIoYWRkcmVzcyBfc2VuZGVyLCB1aW50IF92YWx1ZSkgewogICAgcmVxdWlyZShtaW50aW5nRmluaXNoZWQpOwogICAgcmVxdWlyZShfdmFsdWUgPD0gdmVzdGVkQmFsYW5jZU9mKF9zZW5kZXIpKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBPdmVycmlkZSB0aGUgYmFzZSB0cmFuc2ZlciBjbGFzcyB0byBlbmZvcmNlIHZlc3RpbmcgcmVxdWlyZW1lbnQgaXMgbWV0CiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKQogICAgY2FuVHJhbnNmZXIobXNnLnNlbmRlciwgX3ZhbHVlKQogICAgcHVibGljCiAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgewogICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyKF90bywgX3ZhbHVlKTsKICB9CgogIC8qKgogICAqIE92ZXJyaWRlIHRoZSBiYXNlIHRyYW5zZmVyRnJvbSBjbGFzcyB0byBlbmZvcmNlIHZlc3RpbmcgcmVxdWlyZW1lbnQgaXMgbWV0CiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkKICAgIGNhblRyYW5zZmVyKF9mcm9tLCBfdmFsdWUpCiAgICBwdWJsaWMKICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykKICB7CiAgICByZXR1cm4gc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgfQoKLy8vLy8vLy8vLy8vLy8vLy8vLy8KLy8gVG9rZW4gVmVzdGluZwovLy8vLy8vLy8vLy8vLy8vLy8vCgogIC8qKgogICAqIEFsbG93IHZlc3Rpbmcgc2NoZWR1bGUgcGFyYW1zIHRvIGJlIG92ZXJyaWRkZW4uCiAgICovCiAgZnVuY3Rpb24gc2V0VmVzdGluZ1BhcmFtcyh1aW50MjU2IF92ZXN0aW5nU3RhcnRUaW1lLCB1aW50MjU2IF92ZXN0aW5nVG90YWxQZXJpb2RzLCB1aW50MjU2IF92ZXN0aW5nUGVyaW9kVGltZSkgb25seUNvbnRyb2xsZXIgewogICAgdmVzdGluZ1N0YXJ0VGltZSA9IF92ZXN0aW5nU3RhcnRUaW1lOwogICAgdmVzdGluZ1RvdGFsUGVyaW9kcyA9IF92ZXN0aW5nVG90YWxQZXJpb2RzOwogICAgdmVzdGluZ1BlcmlvZFRpbWUgPSBfdmVzdGluZ1BlcmlvZFRpbWU7CiAgfQoKICAvKioKICAgICogR2V0cyB0aGUgbnVtYmVyIG9mIHZlc3RpbmcgcGVyaW9kcyB0aGF0IGhhdmUgY29tcGxldGVkIGZyb20gdGhlIHN0YXJ0IHRpbWUgdG8gdGhlIGN1cnJlbnQgdGltZS4KICAgICovCiAgZnVuY3Rpb24gZ2V0VmVzdGluZ1BlcmlvZHNDb21wbGV0ZWQodWludDI1NiBfdmVzdGluZ1N0YXJ0VGltZSwgdWludDI1NiBfY3VycmVudFRpbWUpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgIHJldHVybiBfY3VycmVudFRpbWUuc3ViKF92ZXN0aW5nU3RhcnRUaW1lKS5kaXYodmVzdGluZ1BlcmlvZFRpbWUpOwogIH0KCiAgLyoqCiAgICAqIEdldHMgdGhlIHZlc3RlZCBiYWxhbmNlIGZvciBhbiBhY2NvdW50LgogICAgKiBpbml0aWFsQmFsYW5jZSAtIFRoZSBhbW91bnQgdGhhdCB3YXMgYWxsb2NhdGVkIGF0IHRoZSBzdGFydCBvZiB2ZXN0aW5nLgogICAgKiBjdXJyZW50QmFsYW5jZSAtIFRoZSBhbW91bnQgdGhhdCBpcyBjdXJyZW50bHkgaW4gdGhlIGFjY291bnQuCiAgICAqIHZlc3RpbmdTdGFydFRpbWUgLSBUaGUgdGltZSBzdGFtcCAoc2Vjb25kcyBzaW5jZSB1bml4IGVwb2NoKSB3aGVuIHZlc3Rpbmcgc3RhcnRlZC4KICAgICogY3VycmVudFRpbWUgLSBUaGUgY3VycmVudCB0aW1lIHN0YW1wIChzZWNvbmRzIHNpbmNlIHVuaXggZXBvY2gpLgogICAgKi8KICBmdW5jdGlvbiBnZXRWZXN0ZWRCYWxhbmNlKHVpbnQyNTYgX2luaXRpYWxCYWxhbmNlLCB1aW50MjU2IF9jdXJyZW50QmFsYW5jZSwgdWludDI1NiBfdmVzdGluZ1N0YXJ0VGltZSwgdWludDI1NiBfY3VycmVudFRpbWUpCiAgICAgIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KQogIHsKICAgICAgLy8gU2hvcnQtY3V0IGlmIHZlc3RpbmcgaGFzbid0IHN0YXJ0ZWQgeWV0CiAgICAgIGlmIChfY3VycmVudFRpbWUgPCBfdmVzdGluZ1N0YXJ0VGltZSkgewogICAgICAgIHJldHVybiAwOwogICAgICB9CiAgICAgIAogICAgICAvLyBTaG9ydC1jdXQgdGhlIHZlc3RpbmcgY2FsY3VsYXRpb25zIGlmIHRoZSB2ZXN0aW5nIHBlcmlvZHMgYXJlIGNvbXBsZXRlZAogICAgICBpZiAoX2N1cnJlbnRUaW1lID49IF92ZXN0aW5nU3RhcnRUaW1lLmFkZCh2ZXN0aW5nUGVyaW9kVGltZS5tdWwodmVzdGluZ1RvdGFsUGVyaW9kcykpKSB7CiAgICAgICAgICByZXR1cm4gX2N1cnJlbnRCYWxhbmNlOwogICAgICB9CgogICAgICAvLyBGaXJzdCwgZ2V0IHRoZSBudW1iZXIgb2YgdmVzdGluZyBwZXJpb2RzIGNvbXBsZXRlZAogICAgICB1aW50MjU2IHZlc3RlZFBlcmlvZHNDb21wbGV0ZWQgPSBnZXRWZXN0aW5nUGVyaW9kc0NvbXBsZXRlZChfdmVzdGluZ1N0YXJ0VGltZSwgX2N1cnJlbnRUaW1lKTsKCiAgICAgIC8vIENhbGN1bGF0ZSB0aGUgYW1vdW50IHRoYXQgc2hvdWxkIGJlIHdpdGhoZWxkLgogICAgICB1aW50MjU2IHZlc3RpbmdQZXJpb2RzUmVtYWluaW5nID0gdmVzdGluZ1RvdGFsUGVyaW9kcy5zdWIodmVzdGVkUGVyaW9kc0NvbXBsZXRlZCk7CiAgICAgIHVpbnQyNTYgdW52ZXN0ZWRCYWxhbmNlID0gX2luaXRpYWxCYWxhbmNlLm11bCh2ZXN0aW5nUGVyaW9kc1JlbWFpbmluZykuZGl2KHZlc3RpbmdUb3RhbFBlcmlvZHMpOwoKICAgICAgLy8gUmV0dXJuIHRoZSBjdXJyZW50IGJhbGFuY2UgbWludXMgYW55IHRoYXQgaXMgc3RpbGwgdW52ZXN0ZWQuCiAgICAgIHJldHVybiBfY3VycmVudEJhbGFuY2Uuc3ViKHVudmVzdGVkQmFsYW5jZSk7CiAgfQoKICAvKioKICAgKiBDb252ZW5pZW5jZSBtZXRob2QgLSBHZXQgdGhlIHZlc3RlZCBiYWxhbmNlIG9mIHRoZSBhZGRyZXNzLgogICAqLwogIGZ1bmN0aW9uIHZlc3RlZEJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgcmV0dXJuIGdldFZlc3RlZEJhbGFuY2UoaXNzdWVkVG9rZW5zW19vd25lcl0sIGJhbGFuY2VPZihfb3duZXIpLCB2ZXN0aW5nU3RhcnRUaW1lLCBibG9jay50aW1lc3RhbXApOwogIH0KCiAgLyoqCiAgICogQXQgdGhlIGVuZCBvZiB0aGUgc2FsZSwgdGhpcyBzaG91bGQgYmUgY2FsbGVkIHRvIHRyaWdnZXIgdGhlIHZlc3RpbmcgdG8gc3RhcnQuCiAgICogVG9rZW5zIGNhbm5vdCBiZSB0cmFuc2ZlcnJlZCBwcmlvciB0byB0aGlzIGJlaW5nIGNhbGxlZC4KICAgKi8KICBmdW5jdGlvbiBmaW5pc2hNaW50aW5nKCkgb25seUNvbnRyb2xsZXIgY2FuTWludCByZXR1cm5zIChib29sKSB7CiAgICAvLyBTZXQgdGhlIHRpbWUgc3RhbXAgZm9yIHRva2VucyB0byBzdGFydCB2ZXN0aW5nCiAgICB2ZXN0aW5nU3RhcnRUaW1lID0gYmxvY2sudGltZXN0YW1wOwoKICAgIHJldHVybiBzdXBlci5maW5pc2hNaW50aW5nKCk7CiAgfQp9Cgpjb250cmFjdCBTd2FybVRva2VuIGlzIE1pbmlNZVZlc3RlZFRva2VuIHsKCiAgLyoqCiAgICogQ29uc3RydWN0b3IgdG8gaW5pdGlhbGl6ZSBTd2FybSBUb2tlbi4KICAgKiBGYWN0b3J5IGlzIHByZS1kZXBsb3llZCBhbmQgcGFzc2VkIGluLgogICAqCiAgICogQGF1dGhvciBwb29sZV9wYXJ0eSB2aWEgdG9rZW5zb2Z0LmlvCiAgICovCiAgZnVuY3Rpb24gU3dhcm1Ub2tlbihhZGRyZXNzIF90b2tlbkZhY3RvcnkpCiAgICBNaW5pTWVWZXN0ZWRUb2tlbigKICAgICAgX3Rva2VuRmFjdG9yeSwKICAgICAgMHgwLAogICAgICAwLAogICAgICAiU3dhcm0gRnVuZCBUb2tlbiIsCiAgICAgIDE4LAogICAgICAiU1dNIiwKICAgICAgdHJ1ZQogICAgKQogICAge30gICAgCn0KCi8qKgogKiBAdGl0bGUgT3duYWJsZQogKiBAZGV2IFRoZSBPd25hYmxlIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgYXV0aG9yaXphdGlvbiBjb250cm9sCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciB7CiAgICBpZiAobmV3T3duZXIgIT0gYWRkcmVzcygwKSkgewogICAgICBvd25lciA9IG5ld093bmVyOwogICAgfQogIH0KCn0KCi8qKgogKiBAdGl0bGUgUGF1c2FibGUKICogQGRldiBCYXNlIGNvbnRyYWN0IHdoaWNoIGFsbG93cyBjaGlsZHJlbiB0byBpbXBsZW1lbnQgYW4gZW1lcmdlbmN5IHN0b3AgbWVjaGFuaXNtLgogKi8KY29udHJhY3QgUGF1c2FibGUgaXMgT3duYWJsZSB7CiAgZXZlbnQgUGF1c2UoKTsKICBldmVudCBVbnBhdXNlKCk7CgogIGJvb2wgcHVibGljIHBhdXNlZCA9IGZhbHNlOwoKCiAgLyoqCiAgICogQGRldiBtb2RpZmllciB0byBhbGxvdyBhY3Rpb25zIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgSVMgcGF1c2VkCiAgICovCiAgbW9kaWZpZXIgd2hlbk5vdFBhdXNlZCgpIHsKICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBtb2RpZmllciB0byBhbGxvdyBhY3Rpb25zIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgSVMgTk9UIHBhdXNlZAogICAqLwogIG1vZGlmaWVyIHdoZW5QYXVzZWQgewogICAgcmVxdWlyZShwYXVzZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byBwYXVzZSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHBhdXNlKCkgb25seU93bmVyIHdoZW5Ob3RQYXVzZWQgcmV0dXJucyAoYm9vbCkgewogICAgcGF1c2VkID0gdHJ1ZTsKICAgIFBhdXNlKCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byB1bnBhdXNlLCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHVucGF1c2UoKSBvbmx5T3duZXIgd2hlblBhdXNlZCByZXR1cm5zIChib29sKSB7CiAgICBwYXVzZWQgPSBmYWxzZTsKICAgIFVucGF1c2UoKTsKICAgIHJldHVybiB0cnVlOwogIH0KfQoKLyoqCiAqIEB0aXRsZSBDcm93ZHNhbGUgCiAqIEBkZXYgQ3Jvd2RzYWxlIGlzIGEgYmFzZSBjb250cmFjdCBmb3IgbWFuYWdpbmcgYSB0b2tlbiBjcm93ZHNhbGUuCiAqIENyb3dkc2FsZXMgaGF2ZSBhIHN0YXJ0IGFuZCBlbmQgYmxvY2ssIHdoZXJlIGludmVzdG9ycyBjYW4gbWFrZQogKiB0b2tlbiBwdXJjaGFzZXMgYW5kIHRoZSBjcm93ZHNhbGUgd2lsbCBhc3NpZ24gdGhlbSB0b2tlbnMgYmFzZWQKICogb24gYSB0b2tlbiBwZXIgRVRIIHJhdGUuIEZ1bmRzIGNvbGxlY3RlZCBhcmUgZm9yd2FyZGVkIHRvIGEgd2FsbGV0IAogKiBhcyB0aGV5IGFycml2ZS4KICovCmNvbnRyYWN0IENyb3dkc2FsZSB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIC8vIFRoZSB0b2tlbiBiZWluZyBzb2xkCiAgU3dhcm1Ub2tlbiBwdWJsaWMgdG9rZW47CgogIC8vIHN0YXJ0IGFuZCBlbmQgdGltZSB3aGVyZSBpbnZlc3RtZW50cyBhcmUgYWxsb3dlZCAoYm90aCBpbmNsdXNpdmUpCiAgdWludDI1NiBwdWJsaWMgc3RhcnRUaW1lOwogIHVpbnQyNTYgcHVibGljIGVuZFRpbWU7CgogIC8vIGFkZHJlc3Mgd2hlcmUgZnVuZHMgYXJlIGNvbGxlY3RlZAogIGFkZHJlc3MgcHVibGljIHdhbGxldDsKCiAgLy8gSW5pdGlhbCByYXRlIG9mIGhvdyBtYW55IHRva2VucyBhIGJ1eWVyIGdldHMgcGVyIEVUSCB0aGUgc2VuZCBpbi4KICB1aW50MjU2IHB1YmxpYyByYXRlOwoKICAvLyBhbW91bnQgb2YgcmFpc2VkIEVUSCBpbiB3ZWkKICB1aW50MjU2IHB1YmxpYyB3ZWlSYWlzZWQ7CgogIC8qKgogICAqIGV2ZW50IGZvciB0b2tlbiBwdXJjaGFzZSBsb2dnaW5nCiAgICogQHBhcmFtIHB1cmNoYXNlciB3aG8gcGFpZCBmb3IgdGhlIHRva2VucwogICAqIEBwYXJhbSBiZW5lZmljaWFyeSB3aG8gZ290IHRoZSB0b2tlbnMKICAgKiBAcGFyYW0gdmFsdWUgd2VpcyBwYWlkIGZvciBwdXJjaGFzZQogICAqIEBwYXJhbSBhbW91bnQgYW1vdW50IG9mIHRva2VucyBwdXJjaGFzZWQKICAgKi8gCiAgZXZlbnQgVG9rZW5QdXJjaGFzZShhZGRyZXNzIGluZGV4ZWQgcHVyY2hhc2VyLCBhZGRyZXNzIGluZGV4ZWQgYmVuZWZpY2lhcnksIHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgYW1vdW50KTsKCiAgLyoqCiAgICogQ29uc3RydWN0b3IgdG8gc2F2ZSBvZmYgYXJncyBkZWZpbmluZyB0aGUgc2FsZS4KICAgKi8KICBmdW5jdGlvbiBDcm93ZHNhbGUodWludDI1NiBfc3RhcnRUaW1lLCB1aW50MjU2IF9lbmRUaW1lLCB1aW50MjU2IF9yYXRlLCBhZGRyZXNzIF93YWxsZXQsIGFkZHJlc3MgX3Rva2VuKSB7CiAgICByZXF1aXJlKF9zdGFydFRpbWUgPj0gYmxvY2sudGltZXN0YW1wKTsKICAgIHJlcXVpcmUoX2VuZFRpbWUgPj0gX3N0YXJ0VGltZSk7CiAgICByZXF1aXJlKF9yYXRlID4gMCk7CiAgICByZXF1aXJlKF93YWxsZXQgIT0gMHgwKTsKCgogICAgc3RhcnRUaW1lID0gX3N0YXJ0VGltZTsKICAgIGVuZFRpbWUgPSBfZW5kVGltZTsKICAgIHJhdGUgPSBfcmF0ZTsKICAgIHdhbGxldCA9IF93YWxsZXQ7CiAgICB0b2tlbiA9IFN3YXJtVG9rZW4oX3Rva2VuKTsKICB9CgogIC8vIGZhbGxiYWNrIGZ1bmN0aW9uIGNhbiBiZSB1c2VkIHRvIGJ1eSB0b2tlbnMKICBmdW5jdGlvbiAoKSBwYXlhYmxlIHsKICAgIGJ1eVRva2Vucyhtc2cuc2VuZGVyKTsKICB9CgogIC8vIGxvdyBsZXZlbCB0b2tlbiBwdXJjaGFzZSBmdW5jdGlvbgogIGZ1bmN0aW9uIGJ1eVRva2VucyhhZGRyZXNzIGJlbmVmaWNpYXJ5KSBwYXlhYmxlOwoKICAvLyBzZW5kIGV0aGVyIHRvIHRoZSBmdW5kIGNvbGxlY3Rpb24gd2FsbGV0CiAgLy8gb3ZlcnJpZGUgdG8gY3JlYXRlIGN1c3RvbSBmdW5kIGZvcndhcmRpbmcgbWVjaGFuaXNtcwogIGZ1bmN0aW9uIGZvcndhcmRGdW5kcygpIGludGVybmFsIHsKICAgIHdhbGxldC50cmFuc2Zlcihtc2cudmFsdWUpOwogIH0KCiAgLy8gQHJldHVybiB0cnVlIGlmIHRoZSB0cmFuc2FjdGlvbiBjYW4gYnV5IHRva2VucwogIGZ1bmN0aW9uIHZhbGlkUHVyY2hhc2UoKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICB1aW50MjU2IGN1cnJlbnQgPSBibG9jay50aW1lc3RhbXA7CiAgICBib29sIHdpdGhpblBlcmlvZCA9IGN1cnJlbnQgPj0gc3RhcnRUaW1lICYmIGN1cnJlbnQgPD0gZW5kVGltZTsKICAgIGJvb2wgbm9uWmVyb1B1cmNoYXNlID0gbXNnLnZhbHVlICE9IDA7CiAgICByZXR1cm4gd2l0aGluUGVyaW9kICYmIG5vblplcm9QdXJjaGFzZTsKICB9CgogIC8vIEByZXR1cm4gdHJ1ZSBpZiBjcm93ZHNhbGUgZXZlbnQgaGFzIGVuZGVkCiAgZnVuY3Rpb24gaGFzRW5kZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIGJsb2NrLnRpbWVzdGFtcCA+IGVuZFRpbWU7CiAgfQp9CgovKioKICogQHRpdGxlIEZpbmFsaXphYmxlQ3Jvd2RzYWxlCiAqIEBkZXYgRXh0ZW5zaW9uIG9mIENyb3dzZGFsZSB3aGVyZSBhbiBvd25lciBjYW4gZG8gZXh0cmEgd29yawogKiBhZnRlciBmaW5pc2hpbmcuIEJ5IGRlZmF1bHQsIGl0IHdpbGwgZW5kIHRva2VuIG1pbnRpbmcuCiAqLwpjb250cmFjdCBGaW5hbGl6YWJsZUNyb3dkc2FsZSBpcyBDcm93ZHNhbGUsIFBhdXNhYmxlIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgYm9vbCBwdWJsaWMgaXNGaW5hbGl6ZWQgPSBmYWxzZTsKCiAgZXZlbnQgRmluYWxpemVkKCk7CgogIC8qKgogICAqIFBhc3MgdGhyb3VnaCBjb25zdHJ1Y3RvciB0byBwYXJlbnRzLgogICAqLwogIGZ1bmN0aW9uIEZpbmFsaXphYmxlQ3Jvd2RzYWxlICgKICAgIHVpbnQyNTYgX3N0YXJ0VGltZSwKICAgIHVpbnQyNTYgX2VuZFRpbWUsCiAgICB1aW50MjU2IF9yYXRlLAogICAgYWRkcmVzcyBfd2FsbGV0LAogICAgYWRkcmVzcyBfdG9rZW4KICApCiAgICBDcm93ZHNhbGUoX3N0YXJ0VGltZSwgX2VuZFRpbWUsIF9yYXRlLCBfd2FsbGV0LCBfdG9rZW4pCiAgICBPd25hYmxlKCkKICB7CiAgfQoKICAvLyBzaG91bGQgYmUgY2FsbGVkIGFmdGVyIGNyb3dkc2FsZSBlbmRzLCB0byBkbwogIC8vIHNvbWUgZXh0cmEgZmluYWxpemF0aW9uIHdvcmsKICBmdW5jdGlvbiBmaW5hbGl6ZSgpIG9ubHlPd25lciB7CiAgICByZXF1aXJlKCFpc0ZpbmFsaXplZCk7CiAgICByZXF1aXJlKGhhc0VuZGVkKCkpOwoKICAgIC8vIFNldCB0aGUgZmxhZyB0byBwcmV2ZW50IGFub3RoZXIgZmluYWxpemF0aW9uCiAgICBpc0ZpbmFsaXplZCA9IHRydWU7CgogICAgLy8gQ2FsbCB0aGUgZmluYWxpemF0aW9uIGZ1bmN0aW9uIGluIHRoZSBpbXBsZW1lbnRpbmcgY2xhc3MuCiAgICBmaW5hbGl6YXRpb24oKTsKCiAgICAvLyBUcmlnZ2VyIHRoZSBmaW5hbGl6ZWQgZXZlbnQuCiAgICBGaW5hbGl6ZWQoKTsKICB9CgogIC8vIGVuZCB0b2tlbiBtaW50aW5nIG9uIGZpbmFsaXphdGlvbgogIC8vIG92ZXJyaWRlIHRoaXMgd2l0aCBjdXN0b20gbG9naWMgaWYgbmVlZGVkCiAgZnVuY3Rpb24gZmluYWxpemF0aW9uKCkgaW50ZXJuYWw7Cgp9CgovKioKICogQHRpdGxlIFN3YXJtQ3Jvd2RzYWxlCiAqIEBkZXYgU3dhcm1Dcm93ZHNhbGUgaXMgYSBjb250cmFjdCBmb3IgbWFuYWdpbmcgYSB0b2tlbiBjcm93ZHNhbGUuCiAqIENyb3dkc2FsZXMgaGF2ZSBhIHN0YXJ0IGFuZCBlbmQgdGltZSBzdGFtcCwgd2hlcmUgaW52ZXN0b3JzIGNhbiBtYWtlCiAqIHRva2VuIHB1cmNoYXNlcyBhbmQgdGhlIGNyb3dkc2FsZSB3aWxsIGFzc2lnbiB0aGVtIHRva2VucyBiYXNlZAogKiBvbiBhIHRva2VuIHBlciBFVEggcmF0ZS4gRnVuZHMgY29sbGVjdGVkIGFyZSBmb3J3YXJkZWQgdG8gYSB3YWxsZXQKICogYXMgdGhleSBhcnJpdmUuCiAqIAogKiBUaW1lIHZhbHVlcyBhcmUgaW4gc2Vjb25kcyBzaW5jZSB1bml4IGVwb2NoLgogKgogKiBSYXRlIGlzIGluaXRpYWwgdmFsdWUgb2YgRVRIIGluIFVTRC4gIEVhY2ggdG9rZW4gc3RhcnRzIG91dCBjb3N0aW5nIGFwcHJveCAxIFVTRCBhbmQgaW5jcmVhc2VzCiAqIGFzIHRva2VucyBhcmUgc29sZC4gIHJhdGUgPSBVU0QgcHJpY2Ugb2YgRVRIIChlLmcuICIzMDAiKQogKgogKiBXYWxsZXQgaXMgdGhlIGFkZHJlc3Mgd2hlcmUgYWxsIGluY29taW5nIGZ1bmRzIHdpbGwgYmUgZm9yd2FyZGVkLiAgU2hvdWxkIGJlIGEgbXVsdGlzaWcgZm9yIHNlY3VyaXR5LgogKgogKiBAYXV0aG9yIHBvb2xlX3BhcnR5IHZpYSB0b2tlbnNvZnQuaW8KICovCmNvbnRyYWN0IFN3YXJtQ3Jvd2RzYWxlIGlzIEZpbmFsaXphYmxlQ3Jvd2RzYWxlIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsgIAoKICAvLyBUaGUgYW1vdW50IG9mIHRva2VucyBzb2xkIGR1cmluZyB0aGUgY3Jvd2RzYWxlCiAgdWludDI1NiBwdWJsaWMgYmFzZVRva2Vuc1NvbGQgPSAwOwoKICAvLyBUb2tlbiBiYXNlIHVuaXRzIGFyZSAxOCBkZWNpbWFscwogIHVpbnQyNTYgY29uc3RhbnQgVE9LRU5fREVDSU1BTFMgPSAxMCoqMTg7CgogIC8vIFRhcmdldCB0b2tlbnMgc29sZCBpcyAzMyBtaWxsaW9uCiAgdWludDI1NiBjb25zdGFudCBUT0tFTl9UQVJHRVRfU09MRCA9IDMzMzMzMzMzICogVE9LRU5fREVDSU1BTFM7CgogIC8vIENhcCBvbiB0aGUgY3Jvd2RzYWxlIGZvciBudW1iZXIgb2YgdG9rZW5zIC0gMzMsMzMzLDMzMyB0b2tlbnMKICB1aW50MjU2IGNvbnN0YW50IE1BWF9UT0tFTl9TQUxFX0NBUCA9IDMzMzMzMzMzICogVE9LRU5fREVDSU1BTFM7CgogIGJvb2wgcHVibGljIGluaXRpYWxpemVkID0gZmFsc2U7CgogIC8qKgogICAqIFBhc3MgdGhyb3VnaCBjb25zdHJ1Y3RvciB0byBwYXJlbnQuCiAgICovCiAgZnVuY3Rpb24gU3dhcm1Dcm93ZHNhbGUgKAogICAgdWludDI1NiBfc3RhcnRUaW1lLAogICAgdWludDI1NiBfZW5kVGltZSwKICAgIHVpbnQyNTYgX3JhdGUsCiAgICBhZGRyZXNzIF93YWxsZXQsCiAgICBhZGRyZXNzIF90b2tlbiwKICAgIHVpbnQyNTYgX2Jhc2VUb2tlbnNTb2xkCiAgKQogICAgRmluYWxpemFibGVDcm93ZHNhbGUoX3N0YXJ0VGltZSwgX2VuZFRpbWUsIF9yYXRlLCBfd2FsbGV0LCBfdG9rZW4pCiAgewogICAgYmFzZVRva2Vuc1NvbGQgPSBfYmFzZVRva2Vuc1NvbGQ7CiAgfQoKICAvKioKICAqIEFsbG93cyBhbnkgcHJlLWFsbG9jYXRpb25zIHRvIGJldCBzZXQgZm9yIHByZXNhbGUgcHVyY2hhc2VzIG9yIHRlYW0gbWVtYmVyIGFsbG9jYXRpb25zLgogICovCiAgZnVuY3Rpb24gcHJlc2FsZU1pbnQoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2FtdCkgb25seU93bmVyIHsKICAgIHJlcXVpcmUoIWluaXRpYWxpemVkKTsKCiAgICB0b2tlbi5taW50KF90bywgX2FtdCk7CiAgfQoKICAvKioKICAqIEFsbG93cyBhIGxpc3Qgb2YgcHJlLWFsbG9jYXRpb25zIHRvIGJldCBzZXQgZm9yIHByZXNhbGUgcHVyY2hhc2VzIG9yIHRlYW0gbWVtYmVyIGFsbG9jYXRpb25zLgogICovCiAgZnVuY3Rpb24gbXVsdGlQcmVzYWxlTWludChhZGRyZXNzW10gX3RvQXJyYXksIHVpbnQyNTZbXSBfYW10QXJyYXkpIG9ubHlPd25lciB7CiAgICByZXF1aXJlKCFpbml0aWFsaXplZCk7CgogICAgLy8gRW5zdXJlIHRoZSBhcnJheSBoYXMgaXRlbXMKICAgIHJlcXVpcmUoX3RvQXJyYXkubGVuZ3RoID4gMCk7CgogICAgLy8gRW5zdXJlIHRoZSBhcnJheXMgYXJlIHRoZSBzYW1lIGxlbmd0aAogICAgcmVxdWlyZShfdG9BcnJheS5sZW5ndGggPT0gX2FtdEFycmF5Lmxlbmd0aCk7CgogICAgLy8gSXRlcmF0ZSBvdmVyIHRoZSAKICAgIGZvciAodWludCBpID0gMDsgaSA8IF90b0FycmF5Lmxlbmd0aDsgaSsrKSB7CiAgICAgIHRva2VuLm1pbnQoX3RvQXJyYXlbaV0sIF9hbXRBcnJheVtpXSk7CiAgICB9ICAgIAogIH0KCiAgLyoqCiAgKiBTZXRzIHRoZSBpbnRpdGlhbGl6ZWQgZmxhZyB0byB0cnVlIHNvIHRoYXQgdGhlIHByZXNhbGUgY2FuIHN0YXJ0IGFuZCBtaW50aW5nIGlzIGZpbmlzaGVkCiAgKi8KICBmdW5jdGlvbiBpbml0aWFsaXplVG9rZW4oKSBvbmx5T3duZXIgewogICAgLy8gQWxsb3cgdGhpcyB0byBvbmx5IGJlIGNhbGxlZCBvbmNlIGJ5IHRoZSBvd25lci4KICAgIHJlcXVpcmUoIWluaXRpYWxpemVkKTsKICAgIGluaXRpYWxpemVkID0gdHJ1ZTsKICB9CgogIC8qKgogICogQWxsb3dzIHRoZSBvd25lciB0byBzZXQgdGhlIHRva2VucyBzb2xkLCBiYXNlZCBvbiB0aGUgbnVtYmVyIG9mIHByZXNhbGUgcHVyY2hhc2VzCiAgKi8KICBmdW5jdGlvbiBzZXRCYXNlVG9rZW5zU29sZCh1aW50MjU2IF9iYXNlVG9rZW5zU29sZCkgb25seU93bmVyIHsKICAgIGJhc2VUb2tlbnNTb2xkID0gX2Jhc2VUb2tlbnNTb2xkOwogIH0KCiAgLyoqCiAgICogRnVuY3Rpb24gdG8gYWxsb3cgdXNlcnMgdG8gcHVyY2hhc2UgdG9rZW5zIGJhc2VkIG9uIHRoZSBjYWxjdWxhdGVkIHNhbGUgcmF0ZS4KICAgKi8KICBmdW5jdGlvbiBidXlUb2tlbnMoYWRkcmVzcyBiZW5lZmljaWFyeSkgcHVibGljIHBheWFibGUgd2hlbk5vdFBhdXNlZCB7CiAgICByZXF1aXJlKGJlbmVmaWNpYXJ5ICE9IDB4MCk7CiAgICByZXF1aXJlKHZhbGlkUHVyY2hhc2UoKSk7CiAgICByZXF1aXJlKGluaXRpYWxpemVkKTsKCiAgICB1aW50MjU2IHdlaUFtb3VudCA9IG1zZy52YWx1ZTsKCiAgICAvLyBDYWxjdWxhdGUgdG9rZW4gYW1vdW50IHRvIGJlIGNyZWF0ZWQuCiAgICAvLyBVc2VzIGR5bmFtaWMgcHJpY2UgY2FsY3VsYXRvciBiYXNlZCBvbiBjdXJyZW50IG51bWJlciBvZiBzb2xkIHRva2Vucy4KICAgIHVpbnQyNTYgdG9rZW5zID0gd2VpQW1vdW50Lm11bChnZXRTYWxlUmF0ZShiYXNlVG9rZW5zU29sZCkpOwoKICAgIC8vIHVwZGF0ZSBzdGF0ZQogICAgd2VpUmFpc2VkID0gd2VpUmFpc2VkLmFkZCh3ZWlBbW91bnQpOwogICAgYmFzZVRva2Vuc1NvbGQgPSBiYXNlVG9rZW5zU29sZC5hZGQodG9rZW5zKTsKCiAgICAvLyBFbmZvcmNlIHRoZSBjYXAgb24gdGhlIGNyb3dkIHNhbGUgLSBkbyBub3QgYWxsb3cgYSBzYWxlIHRvIGdvIG92ZXIgdGhlIG1heAogICAgcmVxdWlyZShiYXNlVG9rZW5zU29sZCA8PSBNQVhfVE9LRU5fU0FMRV9DQVApOwoKICAgIC8vIE1pbnQgdGhlIHRva2VucyBmb3IgdGhlIHB1cmNoYXNlcgogICAgdG9rZW4ubWludChiZW5lZmljaWFyeSwgdG9rZW5zKTsgICAgCiAgICBUb2tlblB1cmNoYXNlKG1zZy5zZW5kZXIsIGJlbmVmaWNpYXJ5LCB3ZWlBbW91bnQsIHRva2Vucyk7CiAgICAKICAgIGZvcndhcmRGdW5kcygpOwogIH0KCiAgLyoqCiAgICAqIE92ZXJyaWRlcyBCYXNlIEZ1bmN0aW9uLgogICAgKiBUYWtlIGFueSBmaW5hbGl6YXRpb24gYWN0aW9ucyBoZXJlCiAgICAqIEVuZHMgdG9rZW4gbWludGluZyBvbiBmaW5hbGl6YXRpb24KICAgICovCiAgICBmdW5jdGlvbiBmaW5hbGl6YXRpb24oKSBpbnRlcm5hbCB3aGVuTm90UGF1c2VkIHsKCiAgICAgIC8vIEhhbmRsZSB1bnNvbGQgdG9rZW4gbG9naWMKICAgICAgdHJhbnNmZXJVbmFsbG9jYXRlZFRva2VucygpOwoKICAgICAgLy8gQ29tcGxldGUgbWludGluZyBhbmQgc3RhcnQgdmVzdGluZyBvZiB0b2tlbgogICAgICB0b2tlbi5maW5pc2hNaW50aW5nKCk7CgogICAgICAvLyBUcmFuc2ZlciBvd25lcnNoaXAgdG8gdGhlIHdhbGxldAogICAgICB0b2tlbi5jaGFuZ2VDb250cm9sbGVyKHdhbGxldCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBY2NvcmRpbmcgdG8gdGhlIHRlcm1zIG9mIHRoZSBzYWxlLCBhIG1pbmltdW0gb2YgMzMgbWlsbGlvbiB0b2tlbnMgYXJlIHRvIGFsbG9jYXRlZCBmb3IgdGhlIGNyb3dkIHNhbGUuCiAgICAgKiBJZiB0aGUgcHVibGljIGRvZXMgbm90IGJ1eSAzMyBtaWxsaW9uIHRva2VucyB0aGVuIHRoZSBhbW91bnQgc29sZCBpcyBzdWJ0cmFjdGVkIGZyb20gMzMgbWlsbGlvbiBhbmQgYWxsb2NhdGVkIHRvIHRoZSBTd2FybSBGb3VuZGF0aW9uLgogICAgICogVGhpcyBmdW5jdGlvbiB3aWxsIG1pbnQgYW55IHJlbWFpbmluZyB0b2tlbnMgb2YgdGhlIDMzIG1pbmltdW0gdG8gdGhlICJ3YWxsZXQiIGFjY291bnQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyVW5hbGxvY2F0ZWRUb2tlbnMoKSBpbnRlcm5hbCB7ICAgICAgCgogICAgICAvLyBJZiB0aGUgbWluaW11bSBhbW91bnQgc29sZCB3YXMgbWV0LCB0aGVuIHRha2Ugbm8gYWN0aW9uCiAgICAgIGlmIChiYXNlVG9rZW5zU29sZCA+IFRPS0VOX1RBUkdFVF9TT0xEKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICAvLyBNaW5pbXVtIHRva2VucyB3ZXJlIG5vdCBzb2xkLiAgR2V0IHRoZSBhbW91bnQgdG8gdHJhbnNmZXIgYW5kIGFzc2lnbiB0byB3YWxsZXQgYWRkcmVzcy4KICAgICAgdWludDI1NiBhbW91bnRUb1RyYW5zZmVyID0gVE9LRU5fVEFSR0VUX1NPTEQuc3ViKGJhc2VUb2tlbnNTb2xkKTsKICAgICAgdG9rZW4ubWludCh3YWxsZXQsIGFtb3VudFRvVHJhbnNmZXIpOwogICAgfQoKICAvKioKICAgICogR2V0cyB0aGUgY3VycmVudCBwcmljZSBvZiB0aGUgdG9rZW5zIGJhc2VkIG9uIHRoZSBjdXJyZW50IHNvbGQgYW1vdW50IChjdXJyZW50QmFzZVRva2Vuc1NvbGQpLgogICAgKiBUaGUgdmFyaWFibGUgInJhdGUiIGZyb20gdGhlIGJhc2UgY2xhc3MgaXMgdGhlIGluaXRpYWwgcHVyY2hhc2UgbXVsdGlwbGllci4KICAgICogQXMgbmV3IHRva2VucyBnZXQgcHVyY2hhc2VkLCB0aGUgcHJpY2UgaW5jcmVhc2VzIGFjY29yZGluZyB0aGUgdGhlIGFsZ29yaXRobSBvdXRsaW5lZCBpbiB0aGUgd2hpdGVwYXBlci4KICAgICogRWFjaCBnZW5lcmF0aW9uIHlvdSB3aWxsIGdldCBsZXNzIHRva2VucyBwZXIgRVRIIHNlbnQgaW4uCiAgICAqIHBhcmFtIC0gdWludDI1NiBjdXJyZW50VG9rZW5zU29sZCBBbW91bnQgb2YgdG9rZW5zIGFscmVhZHkgc29sZCBpbiAiYmFzZSB1bml0cyIuCiAgICAqIHJldHVybnMgLSB1aW50MjU2IEN1cnJlbnQgbnVtYmVyIG9mIHRva2VucyB5b3UgZ2V0IGZvciBlYWNoIEVUSCBzZW50IGluLgogICAgKi8KICBmdW5jdGlvbiBnZXRTYWxlUmF0ZSh1aW50MjU2IGN1cnJlbnRCYXNlVG9rZW5zU29sZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKCiAgICAvLyBCYXNlIHVuaXRzIHBlciB0b2tlbgogICAgdWludCBkZWNpbWFscyA9IFRPS0VOX0RFQ0lNQUxTOwoKICAgIC8vIEdldCB0aGUgd2hvbGUgdW5pdHMgb2YgdG9rZW5zIHNvbGQKICAgIHVpbnQyNTYgd2hvbGVUb2tlbnNTb2xkID0gY3VycmVudEJhc2VUb2tlbnNTb2xkLmRpdihkZWNpbWFscyk7CgogICAgLy8gR2V0IHRoZSBjdXJyZW50IGdlbmVyYXRpb24gb2YgdGhlIHRva2VuIHNhbGUuICBFYWNoIGdlbiBpcyAxIG1pbGxpb24gd2hvbGUgdG9rZW5zLgogICAgdWludDI1NiBnZW5lcmF0aW9uID0gd2hvbGVUb2tlbnNTb2xkLmRpdigxMCoqNik7CgogICAgLy8gSW5pdCB0aGUgcHJpY2UgbXVsdGlwbGllciBhdCAwLiAgSXQgc2hvdWxkIGFsd2F5cyBnbyB0aHJvdWdoIHRoZSBsb29wIGJlbG93IGF0IGxlYXN0IG9uY2UuCiAgICB1aW50MjU2IHByaWNlTXVsdGlwbGllciA9IDA7CgogICAgLy8gRWFjaCBnZW5lcmF0aW9uIGFkZHMgb24gYSBwcmljZSBwcmVtaXVtIHRoYXQgZGVjcmVhc2VzIHdpdGggZWFjaCBnZW5lcmF0aW9uLgogICAgZm9yICh1aW50IGkgPSAwOyBpIDw9IGdlbmVyYXRpb247IGkrKykgewoKICAgICAgLy8gVGhlIG11bHRpcGxpZXIgaXMgY2FsY3VsYXRlZCBhdCAxMF4xOCB1bml0cyBzaW5jZSB1aW50MjU2IGNhbid0IGhhbmRsZSBkZWNpbWFscy4KICAgICAgcHJpY2VNdWx0aXBsaWVyID0gcHJpY2VNdWx0aXBsaWVyLmFkZChkZWNpbWFscy5kaXYoMSArIGkpKTsKICAgIH0KCiAgICAvLyBSZXR1cm4gdGhlIGluaXRpYWwgcmF0ZSBkaXZpZGVkIGJ5IHRoZSBtdWx0aXBsaWVyLgogICAgLy8gVG8gZW5zdXJlIGludCBkaXZpc2lvbiBkb2Vzbid0IHRydW5jYXRlLCB1c2luZyByYXRlICogMTBeMTggaW4gbnVtZXJhdG9yLiAgICAgIAogICAgLy8gSWYgaW5pdGlhbCByYXRlIGlzIDMwMCB0aGVuIHRoZSBzZWNvbmQgZ2VuZXJhdGlvbiBzaG91bGQgcmV0dXJuID0+IDMwMCoxMF4xOCAvIDEuNSoxMF4xOCAgPT4gMjAwIChlLmcgbGVzcyB0b2tlbnMgcGVyIEVUSCB0aGUgc2Vjb25kIGdlbikKICAgIHJldHVybiByYXRlLm11bChkZWNpbWFscykuZGl2KHByaWNlTXVsdGlwbGllcik7CiAgfQoKICAvKioKICAgKiBDb252ZW5pZW5jZSBtZXRob2QgZm9yIHVzZXJzLgogICAqLwogIGZ1bmN0aW9uIGdldEN1cnJlbnRTYWxlUmF0ZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gZ2V0U2FsZVJhdGUoYmFzZVRva2Vuc1NvbGQpOwogIH0KfQ=='.
	

]
