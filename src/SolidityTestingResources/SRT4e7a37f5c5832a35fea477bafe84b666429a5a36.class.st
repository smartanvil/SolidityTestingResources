Class {
	#name : #SRT4e7a37f5c5832a35fea477bafe84b666429a5a36,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT4e7a37f5c5832a35fea477bafe84b666429a5a36 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgaWYgKGEgPT0gMCkgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSAvIGI7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQp9CgoKLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4KICovCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKCiAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIHByZXZpb3VzT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBuZXdPd25lcik7CgoKICAvKioKICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgKiBhY2NvdW50LgogICAqLwogIGZ1bmN0aW9uIE93bmFibGUoKSBwdWJsaWMgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCgogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgKi8KICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CgoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKLyoqCiAqIEB0aXRsZSBQYXVzYWJsZQogKiBAZGV2IEJhc2UgY29udHJhY3Qgd2hpY2ggYWxsb3dzIGNoaWxkcmVuIHRvIGltcGxlbWVudCBhbiBlbWVyZ2VuY3kgc3RvcCBtZWNoYW5pc20uCiAqLwpjb250cmFjdCBQYXVzYWJsZSBpcyBPd25hYmxlIHsKICBldmVudCBQYXVzZSgpOwogIGV2ZW50IFVucGF1c2UoKTsKCiAgYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CgoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIG5vdCBwYXVzZWQuCiAgICovCiAgbW9kaWZpZXIgd2hlbk5vdFBhdXNlZCgpIHsKICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBNb2RpZmllciB0byBtYWtlIGEgZnVuY3Rpb24gY2FsbGFibGUgb25seSB3aGVuIHRoZSBjb250cmFjdCBpcyBwYXVzZWQuCiAgICovCiAgbW9kaWZpZXIgd2hlblBhdXNlZCgpIHsKICAgIHJlcXVpcmUocGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gcGF1c2UsIHRyaWdnZXJzIHN0b3BwZWQgc3RhdGUKICAgKi8KICBmdW5jdGlvbiBwYXVzZSgpIG9ubHlPd25lciB3aGVuTm90UGF1c2VkIHB1YmxpYyB7CiAgICBwYXVzZWQgPSB0cnVlOwogICAgUGF1c2UoKTsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byB1bnBhdXNlLCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHVucGF1c2UoKSBvbmx5T3duZXIgd2hlblBhdXNlZCBwdWJsaWMgewogICAgcGF1c2VkID0gZmFsc2U7CiAgICBVbnBhdXNlKCk7CiAgfQp9CgovKioqKioKICAgICogT3JnaW5hbGx5IGZyb20gaHR0cHM6Ly9naXRodWIuY29tL09wZW5aZXBwZWxpbi96ZXBwZWxpbi1zb2xpZGl0eQogICAgKiBNb2RpZmllZCBieSBodHRwczovL2dpdGh1Yi5jb20vYWdhcndhbGFrYXJzaAogICAgKi8KCmludGVyZmFjZSB0b2tlblJlY2lwaWVudCB7IGZ1bmN0aW9uIHJlY2VpdmVBcHByb3ZhbChhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF92YWx1ZSwgYWRkcmVzcyBfdG9rZW4sIGJ5dGVzIF9leHRyYURhdGEpIHB1YmxpYzsgfQovKioqKioKICAgICogQHRpdGxlIEJhc2ljIFRva2VuCiAgICAqIEBkZXYgQmFzaWMgVmVyc2lvbiBvZiBhIEdlbmVyaWMgVG9rZW4KICAgICovCmNvbnRyYWN0IEVSQzIwQmFzaWNUb2tlbiBpcyBQYXVzYWJsZXsKICAgIC8vIDE4IGRlY2ltYWxzIGlzIHRoZSBzdHJvbmdseSBzdWdnZXN0ZWQgZGVmYXVsdCwgYXZvaWQgY2hhbmdpbmcgaXQKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwoKICAgIC8vIFRoaXMgY3JlYXRlcyBhbiBhcnJheSB3aXRoIGFsbCBiYWxhbmNlcwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgYmFsYW5jZXM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIHB1YmxpYyBhbGxvd2FuY2U7CgogICAgLy8gVGhpcyBnZW5lcmF0ZXMgYSBwdWJsaWMgZXZlbnQgb24gdGhlIGJsb2NrY2hhaW4gdGhhdCB3aWxsIG5vdGlmeSBjbGllbnRzCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKCiAgICAvLyBUaGlzIG5vdGlmaWVzIGNsaWVudHMgYWJvdXQgdGhlIGFtb3VudCBidXJudAogICAgZXZlbnQgQnVybihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgdWludDI1NiB2YWx1ZSk7CgogICAgLy9GaXggZm9yIHRoZSBFUkMyMCBzaG9ydCBhZGRyZXNzIGF0dGFjay4KICAgIG1vZGlmaWVyIG9ubHlQYXlsb2FkU2l6ZSh1aW50IHNpemUpIHsKICAgICAgICByZXF1aXJlKG1zZy5kYXRhLmxlbmd0aCA+PSBzaXplICsgNCkgOwogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnRlcm5hbCB0cmFuc2Zlciwgb25seSBjYW4gYmUgY2FsbGVkIGJ5IHRoaXMgY29udHJhY3QKICAgICAqLwogICAgZnVuY3Rpb24gX3RyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgd2hlbk5vdFBhdXNlZCBpbnRlcm5hbCB7CiAgICAgICAgLy8gUHJldmVudCB0cmFuc2ZlciB0byAweDAgYWRkcmVzcy4gVXNlIGJ1cm4oKSBpbnN0ZWFkCiAgICAgICAgcmVxdWlyZShfdG8gIT0gMHgwKTsKICAgICAgICAvLyBDaGVjayBpZiB0aGUgc2VuZGVyIGhhcyBlbm91Z2gKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW19mcm9tXSA+PSBfdmFsdWUpOwogICAgICAgIC8vIENoZWNrIGZvciBvdmVyZmxvd3MKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW190b10gKyBfdmFsdWUgPiBiYWxhbmNlc1tfdG9dKTsKICAgICAgICAvLyBTYXZlIHRoaXMgZm9yIGFuIGFzc2VydGlvbiBpbiB0aGUgZnV0dXJlCiAgICAgICAgdWludCBwcmV2aW91c0JhbGFuY2VzID0gYmFsYW5jZXNbX2Zyb21dICsgYmFsYW5jZXNbX3RvXTsKICAgICAgICAvLyBTdWJ0cmFjdCBmcm9tIHRoZSBzZW5kZXIKICAgICAgICBiYWxhbmNlc1tfZnJvbV0gLT0gX3ZhbHVlOwogICAgICAgIC8vIEFkZCB0aGUgc2FtZSB0byB0aGUgcmVjaXBpZW50CiAgICAgICAgYmFsYW5jZXNbX3RvXSArPSBfdmFsdWU7CiAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgICAgICAvLyBBc3NlcnRzIGFyZSB1c2VkIHRvIHVzZSBzdGF0aWMgYW5hbHlzaXMgdG8gZmluZCBidWdzIGluIHlvdXIgY29kZS4gVGhleSBzaG91bGQgbmV2ZXIgZmFpbAogICAgICAgIGFzc2VydChiYWxhbmNlc1tfZnJvbV0gKyBiYWxhbmNlc1tfdG9dID09IHByZXZpb3VzQmFsYW5jZXMpOwogICAgfQoKCiAgICAvKioKICAgICAqIFRyYW5zZmVyIHRva2VucyBmcm9tIG90aGVyIGFkZHJlc3MKICAgICAqCiAgICAgKiBTZW5kIGBfdmFsdWVgIHRva2VucyB0byBgX3RvYCBpbiBiZWhhbGYgb2YgYF9mcm9tYAogICAgICoKICAgICAqIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBvZiB0aGUgc2VuZGVyCiAgICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgICAqIEBwYXJhbSBfdmFsdWUgdGhlIGFtb3VudCB0byBzZW5kCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHdoZW5Ob3RQYXVzZWQgb25seVBheWxvYWRTaXplKDIgKiAzMikgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGFsbG93YW5jZVtfZnJvbV1bbXNnLnNlbmRlcl0pOyAgICAgLy8gQ2hlY2sgYWxsb3dhbmNlCiAgICAgICAgYWxsb3dhbmNlW19mcm9tXVttc2cuc2VuZGVyXSAtPSBfdmFsdWU7CiAgICAgICAgX3RyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBUcmFuc2ZlciB0b2tlbnMKICAgICAqCiAgICAgKiBTZW5kIGBfdmFsdWVgIHRva2VucyB0byBgX3RvYCBmcm9tIHlvdXIgYWNjb3VudAogICAgICoKICAgICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgICogQHBhcmFtIF92YWx1ZSB0aGUgYW1vdW50IHRvIHNlbmQKICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSB3aGVuTm90UGF1c2VkIG9ubHlQYXlsb2FkU2l6ZSgyICogMzIpIHB1YmxpYyB7CiAgICAgICAgX3RyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBub3RpY2UgQ3JlYXRlIGBtaW50ZWRBbW91bnRgIHRva2VucyBhbmQgc2VuZCBpdCB0byBgdGFyZ2V0YAogICAgICogQHBhcmFtIHRhcmdldCBBZGRyZXNzIHRvIHJlY2VpdmUgdGhlIHRva2VucwogICAgICogQHBhcmFtIG1pbnRlZEFtb3VudCB0aGUgYW1vdW50IG9mIHRva2VucyBpdCB3aWxsIHJlY2VpdmUKICAgICAqLwogICAgZnVuY3Rpb24gbWludFRva2VuKGFkZHJlc3MgdGFyZ2V0LCB1aW50MjU2IG1pbnRlZEFtb3VudCkgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgYmFsYW5jZXNbdGFyZ2V0XSArPSBtaW50ZWRBbW91bnQ7CiAgICAgICAgdG90YWxTdXBwbHkgKz0gbWludGVkQW1vdW50OwogICAgICAgIFRyYW5zZmVyKDAsIHRoaXMsIG1pbnRlZEFtb3VudCk7CiAgICAgICAgVHJhbnNmZXIodGhpcywgdGFyZ2V0LCBtaW50ZWRBbW91bnQpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IGFsbG93YW5jZSBmb3Igb3RoZXIgYWRkcmVzcwogICAgICoKICAgICAqIEFsbG93cyBgX3NwZW5kZXJgIHRvIHNwZW5kIG5vIG1vcmUgdGhhbiBgX3ZhbHVlYCB0b2tlbnMgaW4geW91ciBiZWhhbGYKICAgICAqCiAgICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3MgYXV0aG9yaXplZCB0byBzcGVuZAogICAgICogQHBhcmFtIF92YWx1ZSB0aGUgbWF4IGFtb3VudCB0aGV5IGNhbiBzcGVuZAogICAgICovCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMKICAgICAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBhbGxvd2FuY2VbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IGFsbG93YW5jZSBmb3Igb3RoZXIgYWRkcmVzcyBhbmQgbm90aWZ5CiAgICAgKgogICAgICogQWxsb3dzIGBfc3BlbmRlcmAgdG8gc3BlbmQgbm8gbW9yZSB0aGFuIGBfdmFsdWVgIHRva2VucyBpbiB5b3VyIGJlaGFsZiwgYW5kIHRoZW4gcGluZyB0aGUgY29udHJhY3QgYWJvdXQgaXQKICAgICAqCiAgICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3MgYXV0aG9yaXplZCB0byBzcGVuZAogICAgICogQHBhcmFtIF92YWx1ZSB0aGUgbWF4IGFtb3VudCB0aGV5IGNhbiBzcGVuZAogICAgICogQHBhcmFtIF9leHRyYURhdGEgc29tZSBleHRyYSBpbmZvcm1hdGlvbiB0byBzZW5kIHRvIHRoZSBhcHByb3ZlZCBjb250cmFjdAogICAgICovCiAgICBmdW5jdGlvbiBhcHByb3ZlQW5kQ2FsbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSwgYnl0ZXMgX2V4dHJhRGF0YSkKICAgICAgICBwdWJsaWMKICAgICAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICB0b2tlblJlY2lwaWVudCBzcGVuZGVyID0gdG9rZW5SZWNpcGllbnQoX3NwZW5kZXIpOwogICAgICAgIGlmIChhcHByb3ZlKF9zcGVuZGVyLCBfdmFsdWUpKSB7CiAgICAgICAgICAgIHNwZW5kZXIucmVjZWl2ZUFwcHJvdmFsKG1zZy5zZW5kZXIsIF92YWx1ZSwgdGhpcywgX2V4dHJhRGF0YSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIERlc3Ryb3kgdG9rZW5zCiAgICAgKgogICAgICogUmVtb3ZlIGBfdmFsdWVgIHRva2VucyBmcm9tIHRoZSBzeXN0ZW0gaXJyZXZlcnNpYmx5CiAgICAgKgogICAgICogQHBhcmFtIF92YWx1ZSB0aGUgYW1vdW50IG9mIG1vbmV5IHRvIGJ1cm4KICAgICAqLwogICAgZnVuY3Rpb24gYnVybih1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPj0gX3ZhbHVlKTsgICAvLyBDaGVjayBpZiB0aGUgc2VuZGVyIGhhcyBlbm91Z2gKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSAtPSBfdmFsdWU7ICAgICAgICAgICAgLy8gU3VidHJhY3QgZnJvbSB0aGUgc2VuZGVyCiAgICAgICAgdG90YWxTdXBwbHkgLT0gX3ZhbHVlOyAgICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGVzIHRvdGFsU3VwcGx5CiAgICAgICAgQnVybihtc2cuc2VuZGVyLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogRGVzdHJveSB0b2tlbnMgZnJvbSBvdGhlciBhY2NvdW50CiAgICAgKgogICAgICogUmVtb3ZlIGBfdmFsdWVgIHRva2VucyBmcm9tIHRoZSBzeXN0ZW0gaXJyZXZlcnNpYmx5IG9uIGJlaGFsZiBvZiBgX2Zyb21gLgogICAgICoKICAgICAqIEBwYXJhbSBfZnJvbSB0aGUgYWRkcmVzcyBvZiB0aGUgc2VuZGVyCiAgICAgKiBAcGFyYW0gX3ZhbHVlIHRoZSBhbW91bnQgb2YgbW9uZXkgdG8gYnVybgogICAgICovCiAgICBmdW5jdGlvbiBidXJuRnJvbShhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUoYmFsYW5jZXNbX2Zyb21dID49IF92YWx1ZSk7ICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSB0YXJnZXRlZCBiYWxhbmNlIGlzIGVub3VnaAogICAgICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGFsbG93YW5jZVtfZnJvbV1bbXNnLnNlbmRlcl0pOyAgICAvLyBDaGVjayBhbGxvd2FuY2UKICAgICAgICBiYWxhbmNlc1tfZnJvbV0gLT0gX3ZhbHVlOyAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTdWJ0cmFjdCBmcm9tIHRoZSB0YXJnZXRlZCBiYWxhbmNlCiAgICAgICAgYWxsb3dhbmNlW19mcm9tXVttc2cuc2VuZGVyXSAtPSBfdmFsdWU7ICAgICAgICAgICAgIC8vIFN1YnRyYWN0IGZyb20gdGhlIHNlbmRlcidzIGFsbG93YW5jZQogICAgICAgIHRvdGFsU3VwcGx5IC09IF92YWx1ZTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgdG90YWxTdXBwbHkKICAgICAgICBCdXJuKF9mcm9tLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogIAkgKiBSZXR1cm4gYmFsYW5jZSBvZiBhbiBhY2NvdW50CiAgICAgKiBAcGFyYW0gX293bmVyIHRoZSBhZGRyZXNzIHRvIGdldCBiYWxhbmNlCiAgCSAqLwogIAlmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50IGJhbGFuY2UpIHsKICAJCXJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogIAl9CgogICAgLyoqCiAgCSAqIFJldHVybiBhbGxvd2FuY2UgZm9yIG90aGVyIGFkZHJlc3MKICAgICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgc3BlbmQgdG8gdGhlIG90aGVyCiAgICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3MgYXV0aG9yaXplZCB0byBzcGVuZAogIAkgKi8KICAJZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCByZW1haW5pbmcpIHsKICAJCXJldHVybiBhbGxvd2FuY2VbX293bmVyXVtfc3BlbmRlcl07CiAgCX0KfQoKY29udHJhY3QgSldDVG9rZW4gaXMgRVJDMjBCYXNpY1Rva2VuIHsKCXVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKCXN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSAgICAgID0gIkpXQyBCbG9ja2NoYWluIFZlbnR1cmVzIjsgICAvL3Rva2VucyBuYW1lCglzdHJpbmcgcHVibGljIGNvbnN0YW50IHN5bWJvbCAgICA9ICJKV0MiOyAgICAgICAgICAgICAgICAgICAgICAgLy90b2tlbiBzeW1ib2wKCXVpbnQyNTYgcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gMTg7ICAgICAgICAgICAgICAgICAgICAgICAgICAvL3Rva2VuIGRlY2ltYWwKCXN0cmluZyBwdWJsaWMgY29uc3RhbnQgdmVyc2lvbiAgID0gIjEuMCI7ICAgICAgICAgICAgICAgICAgICAgICAvL3Rva2VucyB2ZXJzaW9uCgoJdWludDI1NiBwdWJsaWMgY29uc3RhbnQgdG9rZW5QcmVTYWxlICAgICAgICAgPSAxMDAwMDAwMDAgKiAxMCoqZGVjaW1hbHM7Ly90b2tlbnMgZm9yIHByZS1zYWxlCgl1aW50MjU2IHB1YmxpYyBjb25zdGFudCB0b2tlblB1YmxpY1NhbGUgICAgICA9IDQwMDAwMDAwMCAqIDEwKipkZWNpbWFsczsvL3Rva2VucyBmb3IgcHVibGljLXNhbGUKCXVpbnQyNTYgcHVibGljIGNvbnN0YW50IHRva2VuUmVzZXJ2ZSAgICAgICAgID0gMzAwMDAwMDAwICogMTAqKmRlY2ltYWxzOy8vdG9rZW5zIGZvciByZXNlcnZlCgl1aW50MjU2IHB1YmxpYyBjb25zdGFudCB0b2tlblRlYW1TdXBwb3J0ZXIgICA9IDEyMDAwMDAwMCAqIDEwKipkZWNpbWFsczsvL3Rva2VucyBmb3IgVGVhbSAmIFN1cHBvcnRlcgoJdWludDI1NiBwdWJsaWMgY29uc3RhbnQgdG9rZW5BZHZpc29yUGFydG5lcnMgPSA4MDAwMDAwMCAgKiAxMCoqZGVjaW1hbHM7Ly90b2tlbnMgZm9yIEFkdmlzb3IKCglhZGRyZXNzIHB1YmxpYyBpY29Db250cmFjdDsKCgkvLyBjb25zdHJ1Y3RvcgoJZnVuY3Rpb24gSldDVG9rZW4oKSBwdWJsaWMgewoJCXRvdGFsU3VwcGx5ID0gdG9rZW5QcmVTYWxlICsgdG9rZW5QdWJsaWNTYWxlICsgdG9rZW5SZXNlcnZlICsgdG9rZW5UZWFtU3VwcG9ydGVyICsgdG9rZW5BZHZpc29yUGFydG5lcnM7Cgl9CgoJLyoqCgkgKiBTZXQgSUNPIENvbnRyYWN0IGZvciB0aGlzIHRva2VuIHRvIG1ha2Ugc3VyZSBjYWxsZWQgYnkgb3VyIElDTyBjb250cmFjdAoJICogQHBhcmFtIF9pY29Db250cmFjdCAtIElDTyBDb250cmFjdCBhZGRyZXNzCgkgKi8KCWZ1bmN0aW9uIHNldEljb0NvbnRyYWN0KGFkZHJlc3MgX2ljb0NvbnRyYWN0KSBwdWJsaWMgb25seU93bmVyIHsKCQlpZiAoX2ljb0NvbnRyYWN0ICE9IGFkZHJlc3MoMCkpIHsKCQkJaWNvQ29udHJhY3QgPSBfaWNvQ29udHJhY3Q7CgkJfQoJfQoKCS8qKgoJICogU2VsbCB0b2tlbnMgd2hlbiBJQ08uIE9ubHkgY2FsbGVkIGJ5IElDTyBDb250cmFjdAoJICogQHBhcmFtIF9yZWNpcGllbnQgLSBhZGRyZXNzIHNlbmQgRVRIIHRvIGJ1eSB0b2tlbnMKCSAqIEBwYXJhbSBfdmFsdWUgLSBhbW91bnQgb2YgRVRIcwoJICovCglmdW5jdGlvbiBzZWxsKGFkZHJlc3MgX3JlY2lwaWVudCwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewoJCWFzc2VydChfdmFsdWUgPiAwKTsKCQlyZXF1aXJlKG1zZy5zZW5kZXIgPT0gaWNvQ29udHJhY3QpOwoKCQliYWxhbmNlc1tfcmVjaXBpZW50XSA9IGJhbGFuY2VzW19yZWNpcGllbnRdLmFkZChfdmFsdWUpOwoKCQlUcmFuc2ZlcigweDAsIF9yZWNpcGllbnQsIF92YWx1ZSk7CgkJcmV0dXJuIHRydWU7Cgl9CgoJLyoqCgkgKiBQYXkgYm9udXMgJiBhZmZpbGlhdGUgdG8gYWRkcmVzcwoJICogQHBhcmFtIF9yZWNpcGllbnQgLSBhZGRyZXNzIHRvIHJlY2VpdmUgYm9udXMgJiBhZmZpbGlhdGUKCSAqIEBwYXJhbSBfdmFsdWUgLSB2YWx1ZSBib251cyAmIGFmZmlsaWF0ZSB0byBnaXZlCgkgKi8KCWZ1bmN0aW9uIHBheUJvbnVzQWZmaWxpYXRlKGFkZHJlc3MgX3JlY2lwaWVudCwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKCQlhc3NlcnQoX3ZhbHVlID4gMCk7CgkJcmVxdWlyZShtc2cuc2VuZGVyID09IGljb0NvbnRyYWN0KTsKCgkJYmFsYW5jZXNbX3JlY2lwaWVudF0gPSBiYWxhbmNlc1tfcmVjaXBpZW50XS5hZGQoX3ZhbHVlKTsKCQl0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LmFkZChfdmFsdWUpOwoKCQlUcmFuc2ZlcigweDAsIF9yZWNpcGllbnQsIF92YWx1ZSk7CgkJcmV0dXJuIHRydWU7Cgl9Cn0KCi8qKgogKiBTdG9yZSBjb25maWcgb2YgcGhhc2UgSUNPCiAqLwpjb250cmFjdCBJY29QaGFzZSB7CiAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgcGhhc2VQcmVzYWxlX0Zyb20gPSAxNTE2NDU2ODAwOy8vMTRoIDIwLzAxLzIwMTggR01UCiAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgcGhhc2VQcmVzYWxlX1RvID0gMTUxNzgzOTIwMDsvLzE0aCAwNS8wMi8yMDE4IEdNVAoKICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBwaGFzZVB1YmxpY1NhbGUxX0Zyb20gPSAxNTE5OTEyODAwOy8vMTRoIDAxLzAzLzIwMTggR01UCiAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgcGhhc2VQdWJsaWNTYWxlMV9UbyA9IDE1MjAzNDQ4MDA7Ly8xNGggMDYvMDMvMjAxOCBHTVQKCiAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgcGhhc2VQdWJsaWNTYWxlMl9Gcm9tID0gMTUyMDM0NDgwMDsvLzE0aCAwNi8wMy8yMDE4IEdNVAogIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IHBoYXNlUHVibGljU2FsZTJfVG8gPSAxNTIwNzc2ODAwOy8vMTRoIDExLzAzLzIwMTggR01UCgogIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IHBoYXNlUHVibGljU2FsZTNfRnJvbSA9IDE1MjA3NzY4MDA7Ly8xNGggMTEvMDMvMjAxOCBHTVQKICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBwaGFzZVB1YmxpY1NhbGUzX1RvID0gMTUyMTIwODgwMDsvLzE0aCAxNi8wMy8yMDE4IEdNVAp9CgovKioKICogVGhpcyBjb250cmFjdCB3aWxsIGdpdmUgYm9udXMgZm9yIHVzZXIgd2hlbiBidXkgdG9rZW5zLiBUaGUgYm9udXMgd2lsbCBiZSBwYWlkIGFmdGVyIGZpbmlzaGluZyBJQ08KICovCmNvbnRyYWN0IEJvbnVzIGlzIEljb1BoYXNlLCBPd25hYmxlIHsKCXVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKCS8vZGVjaW1hbHMgb2YgdG9rZW5zCgl1aW50MjU2IGNvbnN0YW50IGRlY2ltYWxzID0gMTg7CgoJLy9lbmFibGUvZGlzYWJsZQoJYm9vbCBwdWJsaWMgaXNCb251czsKCgkvL21heCB0b2tlbnMgZm9yIHRpbWUgYm9udXMKCXVpbnQyNTYgcHVibGljIG1heFRpbWVCb251cyA9IDIyNTAwMDAwMCoxMCoqZGVjaW1hbHM7CgoJLy9tYXggdG9rZW5zIGZvciBhbW91bnQgYm9udXMKCXVpbnQyNTYgcHVibGljIG1heEFtb3VudEJvbnVzID0gMTI1MDAwMDAwKjEwKipkZWNpbWFsczsKCgkvL3N0b3JhZ2UKCW1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgYm9udXNBY2NvdW50QmFsYW5jZXM7CgltYXBwaW5nKHVpbnQyNTYgPT4gYWRkcmVzcykgcHVibGljIGJvbnVzQWNjb3VudEluZGV4OwoJdWludDI1NiBwdWJsaWMgYm9udXNBY2NvdW50Q291bnQ7CgoJdWludDI1NiBwdWJsaWMgaW5kZXhQYWlkQm9udXM7Ly9hbW91bnQgb2YgYWNjb3VudHMgaGF2ZSBiZWVuIHBhaWQgYm9udXMKCglmdW5jdGlvbiBCb251cygpIHB1YmxpYyB7CgkJaXNCb251cyA9IHRydWU7Cgl9CgoJLyoqCgkgKiBFbmFibGUgYm9udXMKCSAqLwoJZnVuY3Rpb24gZW5hYmxlQm9udXMoKSBwdWJsaWMgb25seU93bmVyIHJldHVybnMgKGJvb2wpCgl7CgkJcmVxdWlyZSghaXNCb251cyk7CgkJaXNCb251cz10cnVlOwoJCXJldHVybiB0cnVlOwoJfQoKCS8qKgoJICogRGlzYWJsZSBib251cwoJICovCglmdW5jdGlvbiBkaXNhYmxlQm9udXMoKSBwdWJsaWMgb25seU93bmVyIHJldHVybnMgKGJvb2wpCgl7CgkJcmVxdWlyZShpc0JvbnVzKTsKCQlpc0JvbnVzPWZhbHNlOwoJCXJldHVybiB0cnVlOwoJfQoKCS8qKgoJICogR2V0IGJvbnVzIHBlcmNlbnQgYnkgdGltZQoJICovCglmdW5jdGlvbiBnZXRUaW1lQm9udXMoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyh1aW50MjU2KSB7CgkJdWludDI1NiBib251cyA9IDA7CgoJCWlmKG5vdz49cGhhc2VQcmVzYWxlX0Zyb20gJiYgbm93PHBoYXNlUHJlc2FsZV9Ubyl7CgkJCWJvbnVzID0gNDA7CgkJfSBlbHNlIGlmIChub3c+PXBoYXNlUHVibGljU2FsZTFfRnJvbSAmJiBub3c8cGhhc2VQdWJsaWNTYWxlMV9UbykgewoJCQlib251cyA9IDIwOwoJCX0gZWxzZSBpZiAobm93Pj1waGFzZVB1YmxpY1NhbGUyX0Zyb20gJiYgbm93PHBoYXNlUHVibGljU2FsZTJfVG8pIHsKCQkJYm9udXMgPSAxMDsKCQl9IGVsc2UgaWYgKG5vdz49cGhhc2VQdWJsaWNTYWxlM19Gcm9tICYmIG5vdzxwaGFzZVB1YmxpY1NhbGUzX1RvKSB7CgkJCWJvbnVzID0gNTsKCQl9CgoJCXJldHVybiBib251czsKCX0KCgkvKioKCSAqIEdldCBib251cyBieSBldGgKCSAqIEBwYXJhbSBfdmFsdWUgLSBldGggdG8gY29udmVydCB0byBib251cwoJICovCglmdW5jdGlvbiBnZXRCb251c0J5RVRIKHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcHVyZSByZXR1cm5zKHVpbnQyNTYpIHsKCQl1aW50MjU2IGJvbnVzID0gMDsKCgkJaWYoX3ZhbHVlPj0xNTAwKjEwKipkZWNpbWFscyl7CgkJCWJvbnVzPV92YWx1ZS5tdWwoMjUpLzEwMDsKCQl9IGVsc2UgaWYoX3ZhbHVlPj0zMDAqMTAqKmRlY2ltYWxzKXsKCQkJYm9udXM9X3ZhbHVlLm11bCgyMCkvMTAwOwoJCX0gZWxzZSBpZihfdmFsdWU+PTE1MCoxMCoqZGVjaW1hbHMpewoJCQlib251cz1fdmFsdWUubXVsKDE1KS8xMDA7CgkJfSBlbHNlIGlmKF92YWx1ZT49MzAqMTAqKmRlY2ltYWxzKXsKCQkJYm9udXM9X3ZhbHVlLm11bCgxMCkvMTAwOwoJCX0gZWxzZSBpZihfdmFsdWU+PTE1KjEwKipkZWNpbWFscyl7CgkJCWJvbnVzPV92YWx1ZS5tdWwoNSkvMTAwOwoJCX0KCgkJcmV0dXJuIGJvbnVzOwoJfQoKCS8qKgoJICogR2V0IGJvbnVzIGJhbGFuY2Ugb2YgYW4gYWNjb3VudAoJICogQHBhcmFtIF9vd25lciAtIHRoZSBhZGRyZXNzIHRvIGdldCBib251cyBvZgoJICovCglmdW5jdGlvbiBiYWxhbmNlQm9udXNPZihhZGRyZXNzIF9vd25lcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkKCXsKCQlyZXR1cm4gYm9udXNBY2NvdW50QmFsYW5jZXNbX293bmVyXTsKCX0KCgkvKioKCSAqIEdldCBib251cyBiYWxhbmNlIG9mIGFuIGFjY291bnQKCSAqLwoJZnVuY3Rpb24gcGF5Qm9udXMoKSBwdWJsaWMgb25seU93bmVyIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7Cn0KCgovKioKICogVGhpcyBjb250cmFjdCB3aWxsIGdpdmUgYWZmaWxpYXRlIGZvciB1c2VyIHdoZW4gYnV5IHRva2Vucy4gVGhlIGFmZmlsaWF0ZSB3aWxsIGJlIHBhaWQgYWZ0ZXIgZmluaXNoaW5nIElDTwogKi8KY29udHJhY3QgQWZmaWxpYXRlIGlzIE93bmFibGUgewoKCS8vQ29udHJvbCBBZmZpbGlhdGUgZmVhdHVyZS4KCWJvb2wgcHVibGljIGlzQWZmaWxpYXRlOwoKCS8vQWZmaWxpYXRlIGxldmVsLCBpbml0IGlzIDEKCXVpbnQyNTYgcHVibGljIGFmZmlsaWF0ZUxldmVsID0gMTsKCgkvL0VhY2ggdXNlciB3aWxsIGhhdmUgZGlmZmVyZW50IHJhdGUKCW1hcHBpbmcodWludDI1NiA9PiB1aW50MjU2KSBwdWJsaWMgYWZmaWxpYXRlUmF0ZTsKCgkvL0tlZXAgYmFsYW5jZSBvZiB1c2VyCgltYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIHJlZmVycmFsQmFsYW5jZTsvL3JlZmVyZWU9PnZhbHVlCgoJbWFwcGluZyhhZGRyZXNzID0+IGFkZHJlc3MpIHB1YmxpYyByZWZlcnJhbDsvL3JlZmVyZWU9PnJlZmVycmVyCgltYXBwaW5nKHVpbnQyNTYgPT4gYWRkcmVzcykgcHVibGljIHJlZmVycmFsSW5kZXg7Ly9pbmRleD0+cmVmZXJlZQoKCXVpbnQyNTYgcHVibGljIHJlZmVycmFsQ291bnQ7CgoJLy9hbW91bnQgb2YgYWNjb3VudHMgaGF2ZSBiZWVuIHBhaWQgYWZmaWxpYXRlCgl1aW50MjU2IHB1YmxpYyBpbmRleFBhaWRBZmZpbGlhdGU7CgoJLy8gbWF4IHRva2VucyBmb3IgYWZmaWxpYXRlCgl1aW50MjU2IHB1YmxpYyBtYXhBZmZpbGlhdGUgPSAxMDAwMDAwMDAqKDEwKioxOCk7CgoJLyoqCgkgKiBUaHJvdyBpZiBhZmZpbGlhdGUgaXMgZGlzYWJsZQoJICovCgltb2RpZmllciB3aGVuQWZmaWxpYXRlKCkgewoJCXJlcXVpcmUgKGlzQWZmaWxpYXRlKTsKCQlfOwoJfQoKCS8qKgoJICogY29uc3RydWN0b3IgYWZmaWxpYXRlIHdpdGggbGV2ZWwgMSByYXRlID0gMTAlCgkgKi8KCWZ1bmN0aW9uIEFmZmlsaWF0ZSgpIHB1YmxpYyB7CgkJaXNBZmZpbGlhdGU9dHJ1ZTsKCQlhZmZpbGlhdGVMZXZlbD0xOwoJCWFmZmlsaWF0ZVJhdGVbMF09MTA7Cgl9CgoJLyoqCgkgKiBFbmFibGUgYWZmaWxpYXRlIGZvciB0aGUgY29udHJhY3QKCSAqLwoJZnVuY3Rpb24gZW5hYmxlQWZmaWxpYXRlKCkgcHVibGljIG9ubHlPd25lciByZXR1cm5zIChib29sKSB7CgkJcmVxdWlyZSAoIWlzQWZmaWxpYXRlKTsKCQlpc0FmZmlsaWF0ZT10cnVlOwoJCXJldHVybiB0cnVlOwoJfQoKCS8qKgoJICogRGlzYWJsZSBhZmZpbGlhdGUgZm9yIHRoZSBjb250cmFjdAoJICovCglmdW5jdGlvbiBkaXNhYmxlQWZmaWxpYXRlKCkgcHVibGljIG9ubHlPd25lciByZXR1cm5zIChib29sKSB7CgkJcmVxdWlyZSAoaXNBZmZpbGlhdGUpOwoJCWlzQWZmaWxpYXRlPWZhbHNlOwoJCXJldHVybiB0cnVlOwoJfQoKCS8qKgoJICogUmV0dXJuIGN1cnJlbnQgYWZmaWxpYXRlIGxldmVsCgkgKi8KCWZ1bmN0aW9uIGdldEFmZmlsaWF0ZUxldmVsKCkgcHVibGljIGNvbnN0YW50IHJldHVybnModWludDI1NikKCXsKCQlyZXR1cm4gYWZmaWxpYXRlTGV2ZWw7Cgl9CgoJLyoqCgkgKiBVcGRhdGUgYWZmaWxpYXRlIGxldmVsIGJ5IG93bmVyCgkgKiBAcGFyYW0gX2xldmVsIC0gbmV3IGxldmVsCgkgKi8KCWZ1bmN0aW9uIHNldEFmZmlsaWF0ZUxldmVsKHVpbnQyNTYgX2xldmVsKSBwdWJsaWMgb25seU93bmVyIHdoZW5BZmZpbGlhdGUgcmV0dXJucyhib29sKQoJewoJCWFmZmlsaWF0ZUxldmVsPV9sZXZlbDsKCQlyZXR1cm4gdHJ1ZTsKCX0KCgkvKioKCSAqIEdldCByZWZlcnJlciBhZGRyZXNzCgkgKiBAcGFyYW0gX3JlZmVyZWUgLSB0aGUgcmVmZXJlZSBhZGRyZXNzCgkgKi8KCWZ1bmN0aW9uIGdldFJlZmVycmVyQWRkcmVzcyhhZGRyZXNzIF9yZWZlcmVlKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcykKCXsKCQlyZXR1cm4gcmVmZXJyYWxbX3JlZmVyZWVdOwoJfQoKCS8qKgoJICogR2V0IHJlZmVyZWUgYWRkcmVzcwoJICogQHBhcmFtIF9yZWZlcnJlciAtIHRoZSByZWZlcnJlciBhZGRyZXNzCgkgKi8KCWZ1bmN0aW9uIGdldFJlZmVyZWVBZGRyZXNzKGFkZHJlc3MgX3JlZmVycmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzc1tdIF9yZWZlcmVlKQoJewoJCWFkZHJlc3NbXSBtZW1vcnkgcmVmZXJlZVRlbXAgPSBuZXcgYWRkcmVzc1tdKHJlZmVycmFsQ291bnQpOwoJCXVpbnQgY291bnQgPSAwOwoJCXVpbnQgaTsKCQlmb3IgKGk9MDsgaTxyZWZlcnJhbENvdW50OyBpKyspewoJCQlpZihyZWZlcnJhbFtyZWZlcnJhbEluZGV4W2ldXSA9PSBfcmVmZXJyZXIpewoJCQkJcmVmZXJlZVRlbXBbY291bnRdID0gcmVmZXJyYWxJbmRleFtpXTsKCgkJCQljb3VudCArPSAxOwoJCQl9CgkJfQoKCQlfcmVmZXJlZSA9IG5ldyBhZGRyZXNzW10oY291bnQpOwoJCWZvciAoaT0wOyBpPGNvdW50OyBpKyspCgkJCV9yZWZlcmVlW2ldID0gcmVmZXJlZVRlbXBbaV07Cgl9CgoJLyoqCgkgKiBNYXBwaW5nIHJlZmVyZWUgYWRkcmVzcyB3aXRoIHJlZmVycmVyIGFkZHJlc3MKCSAqIEBwYXJhbSBfcGFyZW50IC0gdGhlIHJlZmVycmVyIGFkZHJlc3MKCSAqIEBwYXJhbSBfY2hpbGQgLSB0aGUgcmVmZXJlZSBhZGRyZXNzCgkgKi8KCWZ1bmN0aW9uIHNldFJlZmVycmFsQWRkcmVzcyhhZGRyZXNzIF9wYXJlbnQsIGFkZHJlc3MgX2NoaWxkKSBwdWJsaWMgb25seU93bmVyIHdoZW5BZmZpbGlhdGUgcmV0dXJucyAoYm9vbCkKCXsKCQlyZXF1aXJlKF9wYXJlbnQgIT0gYWRkcmVzcygweDAwKSk7CgkJcmVxdWlyZShfY2hpbGQgIT0gYWRkcmVzcygweDAwKSk7CgoJCXJlZmVycmFsSW5kZXhbcmVmZXJyYWxDb3VudF09X2NoaWxkOwoJCXJlZmVycmFsW19jaGlsZF09X3BhcmVudDsKCQlyZWZlcnJhbENvdW50Kys7CgoJCXJlZmVycmFsQmFsYW5jZVtfY2hpbGRdPTA7CgoJCXJldHVybiB0cnVlOwoJfQoKCS8qKgoJICogR2V0IGFmZmlsaWF0ZSByYXRlIGJ5IGxldmVsCgkgKiBAcGFyYW0gX2xldmVsIC0gbGV2ZWwgdG8gZ2V0IGFmZmlsaWF0ZSByYXRlCgkgKi8KCWZ1bmN0aW9uIGdldEFmZmlsaWF0ZVJhdGUodWludDI1NiBfbGV2ZWwpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJhdGUpCgl7CgkJcmV0dXJuIGFmZmlsaWF0ZVJhdGVbX2xldmVsXTsKCX0KCgkvKioKCSAqIFNldCBhZmZpbGlhdGUgcmF0ZSBmb3IgbGV2ZWwKCSAqIEBwYXJhbSBfbGV2ZWwgLSB0aGUgbGV2ZWwgdG8gYmUgc2V0IHRoZSBuZXcgcmF0ZQoJICogQHBhcmFtIF9yYXRlIC0gbmV3IHJhdGUKCSAqLwoJZnVuY3Rpb24gc2V0QWZmaWxpYXRlUmF0ZSh1aW50MjU2IF9sZXZlbCwgdWludDI1NiBfcmF0ZSkgcHVibGljIG9ubHlPd25lciB3aGVuQWZmaWxpYXRlIHJldHVybnMgKGJvb2wpCgl7CgkJYWZmaWxpYXRlUmF0ZVtfbGV2ZWxdPV9yYXRlOwoJCXJldHVybiB0cnVlOwoJfQoKCS8qKgoJICogR2V0IGFmZmlsaWF0ZSBiYWxhbmNlIG9mIGFuIGFjY291bnQKCSAqIEBwYXJhbSBfcmVmZXJlZSAtIHRoZSBhZGRyZXNzIHRvIGdldCBhZmZpbGlhdGUgb2YKCSAqLwoJZnVuY3Rpb24gYmFsYW5jZUFmZmlsaWF0ZU9mKGFkZHJlc3MgX3JlZmVyZWUpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KQoJewoJCXJldHVybiByZWZlcnJhbEJhbGFuY2VbX3JlZmVyZWVdOwoJfQoKCS8qKgoJICogUGF5IGFmZmlsaWF0ZQoJICovCglmdW5jdGlvbiBwYXlBZmZpbGlhdGUoKSBwdWJsaWMgb25seU93bmVyIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7Cn0KCgovKioKICogVGhpcyBjb250cmFjdCB3aWxsIHNlbmQgdG9rZW5zIHdoZW4gYW4gYWNjb3VudCBzZW5kIGV0aAogKiBOb3RlOiBiZWZvcmUgc2VuZCBldGggdG8gdG9rZW4sIGFkZHJlc3MgaGFzIHRvIGJlIHJlZ2lzdGVyZWQgYnkgcmVnaXN0ZXJSZWNpcGllbnQgZnVuY3Rpb24KICovCmNvbnRyYWN0IEljb0NvbnRyYWN0IGlzIEljb1BoYXNlLCBPd25hYmxlLCBQYXVzYWJsZSwgQWZmaWxpYXRlLCBCb251cyB7Cgl1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCglKV0NUb2tlbiBjY2M7CgoJdWludDI1NiBwdWJsaWMgdG90YWxUb2tlblNhbGU7Cgl1aW50MjU2IHB1YmxpYyBtaW5Db250cmlidXRpb24gPSAwLjEgZXRoZXI7Ly9taW5pbXVuIGV0aCB1c2VkIHRvIGJ1eSB0b2tlbnMKCXVpbnQyNTYgcHVibGljIHRva2VuRXhjaGFuZ2VSYXRlID0gNzAwMDsvLzFFVEg9NzAwMCB0b2tlbnMKCXVpbnQyNTYgcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gMTg7CgoJdWludDI1NiBwdWJsaWMgdG9rZW5SZW1haW5QcmVTYWxlOy8vdG9rZW5zIHJlbWFpbiBmb3IgcHJlLXNhbGUKCXVpbnQyNTYgcHVibGljIHRva2VuUmVtYWluUHVibGljU2FsZTsvL3Rva2VucyBmb3IgcHVibGljLXNhbGUKCglhZGRyZXNzIHB1YmxpYyBldGhGdW5kRGVwb3NpdCA9IDB4MTMzZjI5RjMxNkFhYzA4QUJDMGIzOWI1Q2RiRDBFN2YxMzQ2NzFkQjsvL211bHRpLXNpZyB3YWxsZXQKCWFkZHJlc3MgcHVibGljIHRva2VuQWRkcmVzczsKCglib29sIHB1YmxpYyBpc0ZpbmFsaXplZDsKCgl1aW50MjU2IHB1YmxpYyBtYXhHYXNSZWZ1bmQgPSAwLjAwNDYgZXRoZXI7Ly9tYXhpbXVtIGdhcyB1c2VkIHRvIHJlZnVuZCBmb3IgZWFjaCB0cmFuc2FjdGlvbgoKCS8vY29uc3RydWN0b3IKCWZ1bmN0aW9uIEljb0NvbnRyYWN0KGFkZHJlc3MgX3Rva2VuQWRkcmVzcykgcHVibGljIHsKCQl0b2tlbkFkZHJlc3MgPSBfdG9rZW5BZGRyZXNzOwoKCQljY2MgPSBKV0NUb2tlbih0b2tlbkFkZHJlc3MpOwoJCXRvdGFsVG9rZW5TYWxlID0gY2NjLnRva2VuUHJlU2FsZSgpICsgY2NjLnRva2VuUHVibGljU2FsZSgpOwoKCQl0b2tlblJlbWFpblByZVNhbGUgPSBjY2MudG9rZW5QcmVTYWxlKCk7Ly90b2tlbnMgcmVtYWluIGZvciBwcmUtc2FsZQoJCXRva2VuUmVtYWluUHVibGljU2FsZSA9IGNjYy50b2tlblB1YmxpY1NhbGUoKTsvL3Rva2VucyBmb3IgcHVibGljLXNhbGUKCgkJaXNGaW5hbGl6ZWQ9ZmFsc2U7Cgl9CgoJLy91c2FnZTogd2ViMyBjaGFuZ2UgdG9rZW4gZnJvbSBldGgKCWZ1bmN0aW9uIGNoYW5nZUVUSDJUb2tlbih1aW50MjU2IF92YWx1ZSkgcHVibGljIGNvbnN0YW50IHJldHVybnModWludDI1NikgewoJCXVpbnQyNTYgZXRoZXJSZWNldiA9IF92YWx1ZSArIG1heEdhc1JlZnVuZDsKCQlyZXF1aXJlIChldGhlclJlY2V2ID49IG1pbkNvbnRyaWJ1dGlvbik7CgoJCXVpbnQyNTYgcmF0ZSA9IGdldFRva2VuRXhjaGFuZ2VSYXRlKCk7CgoJCXVpbnQyNTYgdG9rZW5zID0gZXRoZXJSZWNldi5tdWwocmF0ZSk7CgoJCS8vZ2V0IGN1cnJlbnQgcGhhc2Ugb2YgSUNPCgkJdWludDI1NiBwaGFzZUlDTyA9IGdldEN1cnJlbnRJQ09QaGFzZSgpOwoJCXVpbnQyNTYgdG9rZW5SZW1haW4gPSAwOwoJCWlmKHBoYXNlSUNPID09IDEpey8vcHJlLXNhbGUKCQkJdG9rZW5SZW1haW4gPSB0b2tlblJlbWFpblByZVNhbGU7CgkJfSBlbHNlIGlmIChwaGFzZUlDTyA9PSAyIHx8IHBoYXNlSUNPID09IDMgfHwgcGhhc2VJQ08gPT0gNCkgewoJCQl0b2tlblJlbWFpbiA9IHRva2VuUmVtYWluUHVibGljU2FsZTsKCQl9CgoJCWlmICh0b2tlblJlbWFpbiA8IHRva2VucykgewoJCQl0b2tlbnM9dG9rZW5SZW1haW47CgkJfQoKCQlyZXR1cm4gdG9rZW5zOwoJfQoKCWZ1bmN0aW9uICgpIHB1YmxpYyBwYXlhYmxlIHdoZW5Ob3RQYXVzZWQgewoJCXJlcXVpcmUgKCFpc0ZpbmFsaXplZCk7CgkJcmVxdWlyZSAobXNnLnNlbmRlciAhPSBhZGRyZXNzKDApKTsKCgkJdWludDI1NiBldGhlclJlY2V2ID0gbXNnLnZhbHVlICsgbWF4R2FzUmVmdW5kOwoJCXJlcXVpcmUgKGV0aGVyUmVjZXYgPj0gbWluQ29udHJpYnV0aW9uKTsKCgkJLy9nZXQgY3VycmVudCB0b2tlbiBleGNoYW5nZSByYXRlCgkJdG9rZW5FeGNoYW5nZVJhdGUgPSBnZXRUb2tlbkV4Y2hhbmdlUmF0ZSgpOwoKCQl1aW50MjU2IHRva2VucyA9IGV0aGVyUmVjZXYubXVsKHRva2VuRXhjaGFuZ2VSYXRlKTsKCgkJLy9nZXQgY3VycmVudCBwaGFzZSBvZiBJQ08KCQl1aW50MjU2IHBoYXNlSUNPID0gZ2V0Q3VycmVudElDT1BoYXNlKCk7CgoJCXJlcXVpcmUocGhhc2VJQ08hPTApOwoKCQl1aW50MjU2IHRva2VuUmVtYWluID0gMDsKCQlpZihwaGFzZUlDTyA9PSAxKXsvL3ByZS1zYWxlCgkJCXRva2VuUmVtYWluID0gdG9rZW5SZW1haW5QcmVTYWxlOwoJCX0gZWxzZSBpZiAocGhhc2VJQ08gPT0gMiB8fCBwaGFzZUlDTyA9PSAzIHx8IHBoYXNlSUNPID09IDQpIHsKCQkJdG9rZW5SZW1haW4gPSB0b2tlblJlbWFpblB1YmxpY1NhbGU7CgkJfQoKCQkvL3Rocm93IGlmIHRva2VuUmVtYWluPT0wCgkJcmVxdWlyZSh0b2tlblJlbWFpbj4wKTsKCgkJaWYgKHRva2VuUmVtYWluIDwgdG9rZW5zKSB7CgkJCS8vaWYgdG9rZW5zIGlzIG5vdCBlbm91Z2ggdG8gYnV5CgoJCQl1aW50MjU2IHRva2Vuc1RvUmVmdW5kID0gdG9rZW5zLnN1Yih0b2tlblJlbWFpbik7CgkJCXVpbnQyNTYgZXRoZXJUb1JlZnVuZCA9IHRva2Vuc1RvUmVmdW5kIC8gdG9rZW5FeGNoYW5nZVJhdGU7CgoJCQkvL3JlZnVuZCBldGggdG8gYnV5ZXIKCQkJbXNnLnNlbmRlci50cmFuc2ZlcihldGhlclRvUmVmdW5kKTsKCgkJCXRva2Vucz10b2tlblJlbWFpbjsKCQkJZXRoZXJSZWNldiA9IGV0aGVyUmVjZXYuc3ViKGV0aGVyVG9SZWZ1bmQpOwoKCQkJdG9rZW5SZW1haW4gPSAwOwoJCX0gZWxzZSB7CgkJCXRva2VuUmVtYWluID0gdG9rZW5SZW1haW4uc3ViKHRva2Vucyk7CgkJfQoKCQkvL3N0b3JlIHRva2VuIHJlbWFpbiBieSBwaGFzZQoJCWlmKHBoYXNlSUNPID09IDEpey8vcHJlLXNhbGUKCQkJdG9rZW5SZW1haW5QcmVTYWxlID0gdG9rZW5SZW1haW47CgkJfSBlbHNlIGlmIChwaGFzZUlDTyA9PSAyIHx8IHBoYXNlSUNPID09IDMgfHwgcGhhc2VJQ08gPT0gNCkgewoJCQl0b2tlblJlbWFpblB1YmxpY1NhbGUgPSB0b2tlblJlbWFpbjsKCQl9CgoJCS8vc2VuZCB0b2tlbgoJCWNjYy5zZWxsKG1zZy5zZW5kZXIsIHRva2Vucyk7CgkJZXRoRnVuZERlcG9zaXQudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKCgkJLy9ib251cwoJCWlmKGlzQm9udXMpewoJCQkvL2JvbnVzIGFtb3VudAoJCQkvL2dldCBib251cyBieSBldGgKCQkJdWludDI1NiBib251c0Ftb3VudEVUSCA9IGdldEJvbnVzQnlFVEgoZXRoZXJSZWNldik7CgkJCS8vZ2V0IGJvbnVzIGJ5IHRva2VuCgkJCXVpbnQyNTYgYm9udXNBbW91bnRUb2tlbnMgPSBib251c0Ftb3VudEVUSC5tdWwodG9rZW5FeGNoYW5nZVJhdGUpOwoKCQkJLy9jaGVjayBpZiB3ZSBoYXZlIGVub3VnaCB0b2tlbnMgZm9yIGJvbnVzCgkJCWlmKG1heEFtb3VudEJvbnVzPjApewoJCQkJaWYobWF4QW1vdW50Qm9udXM+PWJvbnVzQW1vdW50VG9rZW5zKXsKCQkJCQltYXhBbW91bnRCb251cy09Ym9udXNBbW91bnRUb2tlbnM7CgkJCQl9IGVsc2UgewoJCQkJCWJvbnVzQW1vdW50VG9rZW5zID0gbWF4QW1vdW50Qm9udXM7CgkJCQkJbWF4QW1vdW50Qm9udXMgPSAwOwoJCQkJfQoJCQl9IGVsc2UgewoJCQkJYm9udXNBbW91bnRUb2tlbnMgPSAwOwoJCQl9CgoJCQkvL2JvbnVzIHRpbWUKCQkJdWludDI1NiBib251c1RpbWVUb2tlbiA9IHRva2Vucy5tdWwoZ2V0VGltZUJvbnVzKCkpLzEwMDsKCQkJLy9jaGVjayBpZiB3ZSBoYXZlIGVub3VnaCB0b2tlbnMgZm9yIGJvbnVzCgkJCWlmKG1heFRpbWVCb251cz4wKXsKCQkJCWlmKG1heFRpbWVCb251cz49Ym9udXNUaW1lVG9rZW4pewoJCQkJCW1heFRpbWVCb251cy09Ym9udXNUaW1lVG9rZW47CgkJCQl9IGVsc2UgewoJCQkJCWJvbnVzVGltZVRva2VuID0gbWF4VGltZUJvbnVzOwoJCQkJCW1heFRpbWVCb251cyA9IDA7CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQlib251c1RpbWVUb2tlbiA9IDA7CgkJCX0KCgkJCS8vc3RvcmUgYm9udXMKCQkJaWYoYm9udXNBY2NvdW50QmFsYW5jZXNbbXNnLnNlbmRlcl09PTApey8vbmV3CgkJCQlib251c0FjY291bnRJbmRleFtib251c0FjY291bnRDb3VudF09bXNnLnNlbmRlcjsKCQkJCWJvbnVzQWNjb3VudENvdW50Kys7CgkJCX0KCgkJCXVpbnQyNTYgYm9udXNUb2tlbnM9Ym9udXNBbW91bnRUb2tlbnMgKyBib251c1RpbWVUb2tlbjsKCQkJYm9udXNBY2NvdW50QmFsYW5jZXNbbXNnLnNlbmRlcl09Ym9udXNBY2NvdW50QmFsYW5jZXNbbXNnLnNlbmRlcl0uYWRkKGJvbnVzVG9rZW5zKTsKCQl9CgoJCS8vYWZmaWxpYXRlCgkJaWYoaXNBZmZpbGlhdGUpewoJCQlhZGRyZXNzIGNoaWxkPW1zZy5zZW5kZXI7CgkJCWZvcih1aW50MjU2IGk9MDsgaTxhZmZpbGlhdGVMZXZlbDsgaSsrKXsKCQkJCXVpbnQyNTYgZ2lmdFRva2VuPWFmZmlsaWF0ZVJhdGVbaV0ubXVsKHRva2VucykvMTAwOwoKCQkJCS8vY2hlY2sgaWYgd2UgaGF2ZSBlbm91Z2ggdG9rZW5zIGZvciBhZmZpbGlhdGUKCQkJCWlmKG1heEFmZmlsaWF0ZTw9MCl7CgkJCQkJYnJlYWs7CgkJCQl9IGVsc2UgewoJCQkJCWlmKG1heEFmZmlsaWF0ZT49Z2lmdFRva2VuKXsKCQkJCQkJbWF4QWZmaWxpYXRlLT1naWZ0VG9rZW47CgkJCQkJfSBlbHNlIHsKCQkJCQkJZ2lmdFRva2VuID0gbWF4QWZmaWxpYXRlOwoJCQkJCQltYXhBZmZpbGlhdGUgPSAwOwoJCQkJCX0KCQkJCX0KCgkJCQlhZGRyZXNzIHBhcmVudCA9IHJlZmVycmFsW2NoaWxkXTsKCQkJCWlmKHBhcmVudCAhPSBhZGRyZXNzKDB4MDApKXsvL2hhcyBhZmZpbGlhdGUKCQkJCQlyZWZlcnJhbEJhbGFuY2VbY2hpbGRdPXJlZmVycmFsQmFsYW5jZVtjaGlsZF0uYWRkKGdpZnRUb2tlbik7CgkJCQl9CgoJCQkJY2hpbGQ9cGFyZW50OwoJCQl9CgkJfQoJfQoKCS8qKgoJICogUGF5IGFmZmlsaWF0ZSB0byBhZGRyZXNzLiBDYWxsZWQgd2hlbiBJQ08gZmluaXNoCgkgKi8KCWZ1bmN0aW9uIHBheUFmZmlsaWF0ZSgpIHB1YmxpYyBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CgkJdWludDI1NiB0b0luZGV4ID0gaW5kZXhQYWlkQWZmaWxpYXRlICsgMTU7CgkJaWYocmVmZXJyYWxDb3VudCA8IHRvSW5kZXgpCgkJCXRvSW5kZXggPSByZWZlcnJhbENvdW50OwoKCQlmb3IodWludDI1NiBpPWluZGV4UGFpZEFmZmlsaWF0ZTsgaTx0b0luZGV4OyBpKyspIHsKCQkJYWRkcmVzcyByZWZlcmVlID0gcmVmZXJyYWxJbmRleFtpXTsKCQkJcGF5QWZmaWxpYXRlMUFkZHJlc3MocmVmZXJlZSk7CgkJfQoKCQlyZXR1cm4gdHJ1ZTsKCX0KCgkvKioKCSAqIFBheSBhZmZpbGlhdGUgdG8gb25seSBhIGFkZHJlc3MKCSAqLwoJZnVuY3Rpb24gcGF5QWZmaWxpYXRlMUFkZHJlc3MoYWRkcmVzcyBfcmVmZXJlZSkgcHVibGljIG9ubHlPd25lciByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKCQlhZGRyZXNzIHJlZmVycmVyID0gcmVmZXJyYWxbX3JlZmVyZWVdOwoJCWNjYy5wYXlCb251c0FmZmlsaWF0ZShyZWZlcnJlciwgcmVmZXJyYWxCYWxhbmNlW19yZWZlcmVlXSk7CgoJCXJlZmVycmFsQmFsYW5jZVtfcmVmZXJlZV09MDsKCQlyZXR1cm4gdHJ1ZTsKCX0KCgkvKioKCSAqIFBheSBib251cyB0byBhZGRyZXNzLiBDYWxsZWQgd2hlbiBJQ08gZmluaXNoCgkgKi8KCWZ1bmN0aW9uIHBheUJvbnVzKCkgcHVibGljIG9ubHlPd25lciByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKCQl1aW50MjU2IHRvSW5kZXggPSBpbmRleFBhaWRCb251cyArIDE1OwoJCWlmKGJvbnVzQWNjb3VudENvdW50IDwgdG9JbmRleCkKCQkJdG9JbmRleCA9IGJvbnVzQWNjb3VudENvdW50OwoKCQlmb3IodWludDI1NiBpPWluZGV4UGFpZEJvbnVzOyBpPHRvSW5kZXg7IGkrKykKCQl7CgkJCXBheUJvbnVzMUFkZHJlc3MoYm9udXNBY2NvdW50SW5kZXhbaV0pOwoJCX0KCgkJcmV0dXJuIHRydWU7Cgl9CgoJLyoqCgkgKiBQYXkgYm9udXMgdG8gb25seSBhIGFkZHJlc3MKCSAqLwoJZnVuY3Rpb24gcGF5Qm9udXMxQWRkcmVzcyhhZGRyZXNzIF9hZGRyZXNzKSBwdWJsaWMgb25seU93bmVyIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewoJCWNjYy5wYXlCb251c0FmZmlsaWF0ZShfYWRkcmVzcywgYm9udXNBY2NvdW50QmFsYW5jZXNbX2FkZHJlc3NdKTsKCQlib251c0FjY291bnRCYWxhbmNlc1tfYWRkcmVzc109MDsKCQlyZXR1cm4gdHJ1ZTsKCX0KCglmdW5jdGlvbiBmaW5hbGl6ZSgpIGV4dGVybmFsIG9ubHlPd25lciB7CgkJcmVxdWlyZSAoIWlzRmluYWxpemVkKTsKCQkvLyBtb3ZlIHRvIG9wZXJhdGlvbmFsCgkJaXNGaW5hbGl6ZWQgPSB0cnVlOwoJCXBheUFmZmlsaWF0ZSgpOwoJCXBheUJvbnVzKCk7CgkJZXRoRnVuZERlcG9zaXQudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKCX0KCgkvKioKCSAqIEdldCB0b2tlbiBleGNoYW5nZSByYXRlCgkgKiBOb3RlOiBqdXN0IHVzZSB3aGVuIElDTwoJICovCglmdW5jdGlvbiBnZXRUb2tlbkV4Y2hhbmdlUmF0ZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQyNTYgcmF0ZSkgewoJCXJhdGUgPSB0b2tlbkV4Y2hhbmdlUmF0ZTsKCQlpZihub3c8cGhhc2VQcmVzYWxlX1RvKXsKCQkJaWYobm93Pj1waGFzZVByZXNhbGVfRnJvbSkKCQkJCXJhdGUgPSAxMDAwMDsKCQl9IGVsc2UgaWYobm93PHBoYXNlUHVibGljU2FsZTNfVG8pewoJCQlyYXRlID0gNzAwMDsKCQl9Cgl9CgoJLyoqCgkgKiBHZXQgdGhlIGN1cnJlbnQgSUNPIHBoYXNlCgkgKi8KCWZ1bmN0aW9uIGdldEN1cnJlbnRJQ09QaGFzZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQyNTYgcGhhc2UpIHsKCQlwaGFzZSA9IDA7CgkJaWYobm93Pj1waGFzZVByZXNhbGVfRnJvbSAmJiBub3c8cGhhc2VQcmVzYWxlX1RvKXsKCQkJcGhhc2UgPSAxOwoJCX0gZWxzZSBpZiAobm93Pj1waGFzZVB1YmxpY1NhbGUxX0Zyb20gJiYgbm93PHBoYXNlUHVibGljU2FsZTFfVG8pIHsKCQkJcGhhc2UgPSAyOwoJCX0gZWxzZSBpZiAobm93Pj1waGFzZVB1YmxpY1NhbGUyX0Zyb20gJiYgbm93PHBoYXNlUHVibGljU2FsZTJfVG8pIHsKCQkJcGhhc2UgPSAzOwoJCX0gZWxzZSBpZiAobm93Pj1waGFzZVB1YmxpY1NhbGUzX0Zyb20gJiYgbm93PHBoYXNlUHVibGljU2FsZTNfVG8pIHsKCQkJcGhhc2UgPSA0OwoJCX0KCX0KCgkvKioKCSAqIEdldCBhbW91bnQgb2YgdG9rZW5zIHRoYXQgYmUgc29sZAoJICovCglmdW5jdGlvbiBnZXRUb2tlblNvbGQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyh1aW50MjU2IHRva2VuU29sZCkgewoJCS8vZ2V0IGN1cnJlbnQgcGhhc2Ugb2YgSUNPCgkJdWludDI1NiBwaGFzZUlDTyA9IGdldEN1cnJlbnRJQ09QaGFzZSgpOwoJCXRva2VuU29sZCA9IDA7CgkJaWYocGhhc2VJQ08gPT0gMSl7Ly9wcmUtc2FsZQoJCQl0b2tlblNvbGQgPSBjY2MudG9rZW5QcmVTYWxlKCkuc3ViKHRva2VuUmVtYWluUHJlU2FsZSk7CgkJfSBlbHNlIGlmIChwaGFzZUlDTyA9PSAyIHx8IHBoYXNlSUNPID09IDMgfHwgcGhhc2VJQ08gPT0gNCkgewoJCQl0b2tlblNvbGQgPSBjY2MudG9rZW5QcmVTYWxlKCkuc3ViKHRva2VuUmVtYWluUHJlU2FsZSkgKyBjY2MudG9rZW5QdWJsaWNTYWxlKCkuc3ViKHRva2VuUmVtYWluUHVibGljU2FsZSk7CgkJfQoJfQoKCS8qKgoJICogU2V0IHRva2VuIGV4Y2hhbmdlIHJhdGUKCSAqLwoJZnVuY3Rpb24gc2V0VG9rZW5FeGNoYW5nZVJhdGUodWludDI1NiBfdG9rZW5FeGNoYW5nZVJhdGUpIHB1YmxpYyBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCkgewoJCXJlcXVpcmUoX3Rva2VuRXhjaGFuZ2VSYXRlPjApOwoJCXRva2VuRXhjaGFuZ2VSYXRlPV90b2tlbkV4Y2hhbmdlUmF0ZTsKCQlyZXR1cm4gdHJ1ZTsKCX0KCgkvKioKCSAqIHNldCBtaW4gZXRoIGNvbnRyaWJ1dGUKCSAqIEBwYXJhbSBfbWluQ29udHJpYnV0aW9uIC0gbWluIGV0aCB0byBjb250cmlidXRlCgkgKi8KCWZ1bmN0aW9uIHNldE1pbkNvbnRyaWJ1dGlvbih1aW50MjU2IF9taW5Db250cmlidXRpb24pIHB1YmxpYyBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCkgewoJCXJlcXVpcmUoX21pbkNvbnRyaWJ1dGlvbj4wKTsKCQltaW5Db250cmlidXRpb249X21pbkNvbnRyaWJ1dGlvbjsKCQlyZXR1cm4gdHJ1ZTsKCX0KCgkvKioKCSAqIENoYW5nZSBtdWx0aS1zaWcgYWRkcmVzcywgdGhlIGFkZHJlc3MgdG8gcmVjZWl2ZSBFVEgKCSAqIEBwYXJhbSBfZXRoRnVuZERlcG9zaXQgLSBuZXcgbXVsdGktc2lnIGFkZHJlc3MKCSAqLwoJZnVuY3Rpb24gc2V0RXRoRnVuZERlcG9zaXQoYWRkcmVzcyBfZXRoRnVuZERlcG9zaXQpIHB1YmxpYyBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCkgewoJCXJlcXVpcmUoX2V0aEZ1bmREZXBvc2l0ICE9IGFkZHJlc3MoMCkpOwoJCWV0aEZ1bmREZXBvc2l0PV9ldGhGdW5kRGVwb3NpdDsKCQlyZXR1cm4gdHJ1ZTsKCX0KCgkvKioKCSAqIFNldCBtYXggZ2FzIHRvIHJlZnVuZCB3aGVuIGFuIGFkZHJlc3Mgc2VuZCBFVEggdG8gYnV5IHRva2VucwoJICogQHBhcmFtIF9tYXhHYXNSZWZ1bmQgLSBtYXggZ2FzCgkgKi8KCWZ1bmN0aW9uIHNldE1heEdhc1JlZnVuZCh1aW50MjU2IF9tYXhHYXNSZWZ1bmQpIHB1YmxpYyBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCkgewoJCXJlcXVpcmUoX21heEdhc1JlZnVuZCA+IDApOwoJCW1heEdhc1JlZnVuZCA9IF9tYXhHYXNSZWZ1bmQ7CgkJcmV0dXJuIHRydWU7Cgl9Cn0='.
	

]
