Class {
	#name : #SRT574fb6d9d090042a04d0d12a4e87217f8303a5ca,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT574fb6d9d090042a04d0d12a4e87217f8303a5ca >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgoKY29udHJhY3QgRG9Ob3REZXBsb3lUaGlzR2V0VGhlUmlnaHRPbmVDb3NQYXJpdHlQdXRzVGhpc09uVG9wIHsKICAgIHVpbnQyNTYgbm90aGluZzsKCiAgICBmdW5jdGlvbiBEb05vdERlcGxveVRoaXNHZXRUaGVSaWdodE9uZUNvc1Bhcml0eVB1dHNUaGlzT25Ub3AoKSB7CiAgICAgICAgbm90aGluZyA9IDI3OwogICAgfQp9CgoKLy8qKioqKioqKioqKioqKiogT3duYWJsZQoKY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgogIGZ1bmN0aW9uIE93bmFibGUoKSB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgCiAgICBfOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHsKICAgIGlmIChuZXdPd25lciAhPSBhZGRyZXNzKDApKSB7CiAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICB9CiAgfQoKfQoKLy8qKioqKioqKioqKlBhdXNpYmxlCgpjb250cmFjdCBQYXVzYWJsZSBpcyBPd25hYmxlIHsKICBldmVudCBQYXVzZSgpOwogIGV2ZW50IFVucGF1c2UoKTsKCiAgYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CgogIC8qKgogICAqIEBkZXYgbW9kaWZpZXIgdG8gYWxsb3cgYWN0aW9ucyBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IElTIHBhdXNlZAogICAqLwogIG1vZGlmaWVyIHdoZW5Ob3RQYXVzZWQoKSB7CiAgICByZXF1aXJlICghcGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IG1vZGlmaWVyIHRvIGFsbG93IGFjdGlvbnMgb25seSB3aGVuIHRoZSBjb250cmFjdCBJUyBOT1QgcGF1c2VkCiAgICovCiAgbW9kaWZpZXIgd2hlblBhdXNlZCB7CiAgICByZXF1aXJlIChwYXVzZWQpIDsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gcGF1c2UsIHRyaWdnZXJzIHN0b3BwZWQgc3RhdGUKICAgKi8KICBmdW5jdGlvbiBwYXVzZSgpIG9ubHlPd25lciB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wpIHsKICAgIHBhdXNlZCA9IHRydWU7CiAgICBQYXVzZSgpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gdW5wYXVzZSwgcmV0dXJucyB0byBub3JtYWwgc3RhdGUKICAgKi8KICBmdW5jdGlvbiB1bnBhdXNlKCkgb25seU93bmVyIHdoZW5QYXVzZWQgcmV0dXJucyAoYm9vbCkgewogICAgcGF1c2VkID0gZmFsc2U7CiAgICBVbnBhdXNlKCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KCi8vKioqKioqKioqKioqKkVSQzIwCgpjb250cmFjdCBFUkMyMCB7CiAgdWludCBwdWJsaWMgdG90YWxTdXBwbHk7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsKCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvayk7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvayk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQgdmFsdWUpIHJldHVybnMgKGJvb2wgb2spOwogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQgdmFsdWUpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdmFsdWUpOwp9CgovLyoqKioqKioqKioqKioqKiBTYWZlTWF0aAoKY29udHJhY3QgU2FmZU1hdGggewogIGZ1bmN0aW9uIHNhZmVNdWwodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc2FmZURpdih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgYXNzZXJ0KGIgPiAwKTsKICAgIHVpbnQgYyA9IGEgLyBiOwogICAgYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHNhZmVTdWIodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgZnVuY3Rpb24gc2FmZUFkZCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgdWludCBjID0gYSArIGI7CiAgICBhc3NlcnQoYz49YSAmJiBjPj1iKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gbWF4NjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1heDI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWluMjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICB9Cgp9CgovLyoqKioqKioqKioqKioqKiogU3RhbmRhcmRUb2tlbgoKY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBFUkMyMCwgU2FmZU1hdGggewoKICAvKioKICAgKiBAZGV2IEZpeCBmb3IgdGhlIEVSQzIwIHNob3J0IGFkZHJlc3MgYXR0YWNrLgogICAqLwogIG1vZGlmaWVyIG9ubHlQYXlsb2FkU2l6ZSh1aW50IHNpemUpIHsKICAgICByZXF1aXJlKG1zZy5kYXRhLmxlbmd0aCA+PSBzaXplICsgNCk7CiAgICAgXzsKICB9CgogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBiYWxhbmNlczsKICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkpIGFsbG93ZWQ7CgogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgb25seVBheWxvYWRTaXplKDIgKiAzMikgIHJldHVybnMgKGJvb2wgc3VjY2Vzcyl7CiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYmFsYW5jZXNbbXNnLnNlbmRlcl0sIF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gc2FmZUFkZChiYWxhbmNlc1tfdG9dLCBfdmFsdWUpOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBvbmx5UGF5bG9hZFNpemUoMyAqIDMyKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIHZhciBfYWxsb3dhbmNlID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl07CgogICAgLy8gQ2hlY2sgaXMgbm90IG5lZWRlZCBiZWNhdXNlIHNhZmVTdWIoX2FsbG93YW5jZSwgX3ZhbHVlKSB3aWxsIGFscmVhZHkgdGhyb3cgaWYgdGhpcyBjb25kaXRpb24gaXMgbm90IG1ldAogICAgLy8gaWYgKF92YWx1ZSA+IF9hbGxvd2FuY2UpIHRocm93OwoKICAgIGJhbGFuY2VzW190b10gPSBzYWZlQWRkKGJhbGFuY2VzW190b10sIF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfZnJvbV0gPSBzYWZlU3ViKGJhbGFuY2VzW19mcm9tXSwgX3ZhbHVlKTsKICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gc2FmZVN1YihfYWxsb3dhbmNlLCBfdmFsdWUpOwogICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IGJhbGFuY2UpIHsKICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogIH0KCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICByZXF1aXJlKChfdmFsdWUgPT0gMCkgfHwgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID09IDApKTsKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCByZW1haW5pbmcpIHsKICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogIH0KCn0KCmNvbnRyYWN0IEdCVCB7CiAgZnVuY3Rpb24gcGFyZW50Q2hhbmdlKGFkZHJlc3MsdWludCk7CiAgZnVuY3Rpb24gcGFyZW50RmVlcyhhZGRyZXNzKTsKICBmdW5jdGlvbiBzZXRIR1QoYWRkcmVzcyBfaGd0KTsKfQoKLy8qKioqKioqKioqKiogSEVMTE9HT0xEVE9LRU4KCmNvbnRyYWN0IEhlbGxvR29sZFRva2VuIGlzIEVSQzIwLCBTYWZlTWF0aCwgUGF1c2FibGUsIFN0YW5kYXJkVG9rZW4gewoKICBzdHJpbmcgcHVibGljIG5hbWU7CiAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7CiAgdWludDggIHB1YmxpYyBkZWNpbWFsczsKCiAgR0JUICBnb2xkdG9rZW47CiAgCgogIGZ1bmN0aW9uIHNldEdCVChhZGRyZXNzIGdidF8pIG9ubHlPd25lciB7CiAgICBnb2xkdG9rZW4gPSBHQlQoZ2J0Xyk7CiAgfQoKICBmdW5jdGlvbiBHQlRBZGRyZXNzKCkgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcykgewogICAgcmV0dXJuIGFkZHJlc3MoZ29sZHRva2VuKTsKICB9CgogIGZ1bmN0aW9uIEhlbGxvR29sZFRva2VuKGFkZHJlc3MgX3Jlc2VydmUpIHsKICAgIG5hbWUgPSAiSGVsbG9Hb2xkIFRva2VuIjsKICAgIHN5bWJvbCA9ICJIR1QiOwogICAgZGVjaW1hbHMgPSA4OwogCiAgICB0b3RhbFN1cHBseSA9IDEgKiAxMCAqKiA5ICogMTAgKiogdWludDI1NihkZWNpbWFscyk7CiAgICBiYWxhbmNlc1tfcmVzZXJ2ZV0gPSB0b3RhbFN1cHBseTsKICB9CgoKICBmdW5jdGlvbiBwYXJlbnRDaGFuZ2UoYWRkcmVzcyBfdG8pIGludGVybmFsIHsKICAgIHJlcXVpcmUoYWRkcmVzcyhnb2xkdG9rZW4pICE9IDB4MCk7CiAgICBnb2xkdG9rZW4ucGFyZW50Q2hhbmdlKF90byxiYWxhbmNlc1tfdG9dKTsKICB9CiAgZnVuY3Rpb24gcGFyZW50RmVlcyhhZGRyZXNzIF90bykgaW50ZXJuYWwgewogICAgcmVxdWlyZShhZGRyZXNzKGdvbGR0b2tlbikgIT0gMHgwKTsKICAgIGdvbGR0b2tlbi5wYXJlbnRGZWVzKF90byk7CiAgfQoKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpewogICAgcGFyZW50RmVlcyhfZnJvbSk7CiAgICBwYXJlbnRGZWVzKF90byk7CiAgICBzdWNjZXNzID0gc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLF90byxfdmFsdWUpOwogICAgcGFyZW50Q2hhbmdlKF9mcm9tKTsKICAgIHBhcmVudENoYW5nZShfdG8pOwogICAgcmV0dXJuOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wgc3VjY2VzcykgIHsKICAgIHBhcmVudEZlZXMobXNnLnNlbmRlcik7CiAgICBwYXJlbnRGZWVzKF90byk7CiAgICBzdWNjZXNzID0gc3VwZXIudHJhbnNmZXIoX3RvLF92YWx1ZSk7CiAgICBwYXJlbnRDaGFuZ2UobXNnLnNlbmRlcik7CiAgICBwYXJlbnRDaGFuZ2UoX3RvKTsKICAgIHJldHVybjsKICB9CgogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfdmFsdWUpIHdoZW5Ob3RQYXVzZWQgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSAgewogICAgcmV0dXJuIHN1cGVyLmFwcHJvdmUoX3NwZW5kZXIsX3ZhbHVlKTsKICB9Cn0KCi8vKioqKioqKioqIEdPTERGRUVTICoqKioqKioqKioqKioqKioqKioqKioqKgoKY29udHJhY3QgR29sZEZlZXMgaXMgU2FmZU1hdGgsT3duYWJsZSB7CiAgICAvLyBlLmcuIGlmIHJhdGUgPSAwLjAwNTQKICAgIC8vdWludCByYXRlTiA9IDk5OTk0NTIwNTU7CiAgICB1aW50IHJhdGVOID0gOTk5OTQ1MjA1NDc5NDUyMDU0ODsKICAgIHVpbnQgcmF0ZUQgPSAxOTsKICAgIHVpbnQgcHVibGljIG1heERheXM7CiAgICB1aW50IHB1YmxpYyBtYXhSYXRlOwoKICAgIAogICAgZnVuY3Rpb24gR29sZEZlZXMoKSB7CiAgICAgICAgY2FsY01heCgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGNhbGNNYXgoKSB7CiAgICAgICAgbWF4RGF5cyA9IDE7CiAgICAgICAgbWF4UmF0ZSA9IHJhdGVOOwogICAgICAgIAogICAgICAgIAogICAgICAgIHVpbnQgcG93ID0gMjsKICAgICAgICBkbyB7CiAgICAgICAgICAgIHVpbnQgbmV3TiA9IHJhdGVOICoqIHBvdzsKICAgICAgICAgICAgaWYgKG5ld04gLyBtYXhSYXRlICE9IG1heFJhdGUpIHsKICAgICAgICAgICAgICAgIG1heERheXMgPSBwb3cgLyAyOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbWF4UmF0ZSA9IG5ld047CiAgICAgICAgICAgIHBvdyAqPSAyOwogICAgICAgIH0gd2hpbGUgKHBvdyA8IDIwMDApOwogICAgICAgIAogICAgfQoKICAgIGZ1bmN0aW9uIHVwZGF0ZVJhdGUodWludDI1NiBfbiwgdWludDI1NiBfZCkgb25seU93bmVyewogICAgICAgIHJhdGVOID0gX247CiAgICAgICAgcmF0ZUQgPSBfZDsKICAgICAgICBjYWxjTWF4KCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHJhdGVGb3JEYXlzKHVpbnQyNTYgbnVtRGF5cykgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByYXRlKSB7CiAgICAgICAgaWYgKG51bURheXMgPD0gbWF4RGF5cykgewogICAgICAgICAgICB1aW50IHIgPSByYXRlTiAqKiBudW1EYXlzOwogICAgICAgICAgICB1aW50IGQgPSByYXRlRCAqIG51bURheXM7CiAgICAgICAgICAgIGlmIChkID4gMTgpIHsKICAgICAgICAgICAgICAgIHVpbnQgZGl2ID0gIDEwICoqIChkLTE4KTsKICAgICAgICAgICAgICAgIHJhdGUgPSByIC8gZGl2OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZGl2ID0gMTAgKiogKDE4IC0gZCk7CiAgICAgICAgICAgICAgICByYXRlID0gciAqIGRpdjsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHVpbnQyNTYgbWQxID0gbnVtRGF5cyAvIDI7CiAgICAgICAgICAgIHVpbnQyNTYgbWQyID0gbnVtRGF5cyAtIG1kMTsKICAgICAgICAgICAgIHVpbnQyNTYgcjI7CgogICAgICAgICAgICB1aW50MjU2IHIxID0gcmF0ZUZvckRheXMobWQxKTsKICAgICAgICAgICAgaWYgKG1kMSA9PSBtZDIpIHsKICAgICAgICAgICAgICAgIHIyID0gcjE7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByMiA9IHJhdGVGb3JEYXlzKG1kMik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAKCiAgICAgICAgICAgIC8vdWludDI1NiByMSA9IHJhdGVGb3JEYXlzKG1heERheXMpOwogICAgICAgICAgICAvL3VpbnQyNTYgcjIgPSByYXRlRm9yRGF5cyhudW1EYXlzLW1heERheXMpOwogICAgICAgICAgICByYXRlICA9IHNhZmVNdWwoIHIxICwgcjIpICAvIDEwICoqIDE4OwogICAgICAgIH0KICAgICAgICByZXR1cm47IAogICAgICAgIAogICAgfQoKICAgIHVpbnQyNTYgY29uc3RhbnQgcHVibGljIFVUQzJNWVQgPSAxNDgzMjAwMDAwOwoKICAgIGZ1bmN0aW9uIHdvdERheSh1aW50MjU2IHRpbWUpIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gKHRpbWUgLSBVVEMyTVlUKSAvICgxIGRheXMpOwogICAgfQoKICAgIC8vIG1pbmltdW0gZmVlIGlzIDEgdW5sZXNzIHNhbWUgZGF5CiAgICBmdW5jdGlvbiBjYWxjRmVlcyh1aW50MjU2IHN0YXJ0LCB1aW50MjU2IGVuZCwgdWludDI1NiBzdGFydEFtb3VudCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBhbW91bnQsIHVpbnQyNTYgZmVlKSB7CiAgICAgICAgaWYgKHN0YXJ0QW1vdW50ID09IDApIHJldHVybjsKICAgICAgICB1aW50MjU2IG51bWJlck9mRGF5cyA9IHdvdERheShlbmQpIC0gd290RGF5KHN0YXJ0KTsKICAgICAgICBpZiAobnVtYmVyT2ZEYXlzID09IDApIHsKICAgICAgICAgICAgYW1vdW50ID0gc3RhcnRBbW91bnQ7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgYW1vdW50ID0gKHJhdGVGb3JEYXlzKG51bWJlck9mRGF5cykgKiBzdGFydEFtb3VudCkgLyAoMSBldGhlcik7CiAgICAgICAgaWYgKChmZWUgPT0gMCkgJiYgKGFtb3VudCAhPSAgMCkpIGFtb3VudC0tOwogICAgICAgIGZlZSA9IHNhZmVTdWIoc3RhcnRBbW91bnQsYW1vdW50KTsKICAgIH0KfQoKLy8qKioqKioqKioqKioqKioqKioqKiBHb2xkQmFja2VkVG9rZW4KCmNvbnRyYWN0IEdvbGRCYWNrZWRUb2tlbiBpcyBPd25hYmxlLCBTYWZlTWF0aCwgRVJDMjAsIFBhdXNhYmxlIHsKCiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB2YWx1ZSk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludCB2YWx1ZSk7CiAgZXZlbnQgRGVkdWN0RmVlcyhhZGRyZXNzIGluZGV4ZWQgb3duZXIsdWludDI1NiBhbW91bnQpOwoKICBldmVudCBUb2tlbk1pbnRlZChhZGRyZXNzIGRlc3RpbmF0aW9uLCB1aW50MjU2IGFtb3VudCk7CiAgZXZlbnQgVG9rZW5CdXJuZWQoYWRkcmVzcyBzb3VyY2UsIHVpbnQyNTYgYW1vdW50KTsKICAKCXN0cmluZyBwdWJsaWMgbmFtZSA9ICJIZWxsb0dvbGQgR29sZCBCYWNrZWQgVG9rZW4iOwoJc3RyaW5nIHB1YmxpYyBzeW1ib2wgPSAiR0JUIjsKCXVpbnQyNTYgY29uc3RhbnQgcHVibGljICBkZWNpbWFscyA9IDE4OyAgLy8gc2FtZSBhcyBFVEgKCXVpbnQyNTYgY29uc3RhbnQgcHVibGljICBoZ3REZWNpbWFscyA9IDg7CgkJCgl1aW50MjU2IGNvbnN0YW50IHB1YmxpYyBhbGxvY2F0aW9uUG9vbCA9IDEgKiAgMTAqKjkgKiAxMCoqaGd0RGVjaW1hbHM7ICAgICAgLy8gdG90YWwgSEdUIGhvbGRpbmdzCgl1aW50MjU2CWNvbnN0YW50IHB1YmxpYwltYXhBbGxvY2F0aW9uICA9IDM4ICogMTAqKjUgKiAxMCoqZGVjaW1hbHM7CQkJLy8gbWF4IEdCVCB0aGF0IGNhbiBldmVyIGV2ZXIgYmUgZ2l2ZW4gb3V0Cgl1aW50MjU2CSAgICAgICAgIHB1YmxpYwl0b3RBbGxvY2F0aW9uOwkJCS8vIGFtb3VudCBvZiBHQlQgc28gZmFyCgkKCWFkZHJlc3MJCQkgcHVibGljIGZlZUNhbGN1bGF0b3I7CglhZGRyZXNzCQkgICAgIHB1YmxpYyBIR1Q7CQkJCQkvLyBIR1QgY29udHJhY3QgYWRkcmVzcwoKCgoJZnVuY3Rpb24gc2V0RmVlQ2FsY3VsYXRvcihhZGRyZXNzIG5ld0ZDKSBvbmx5T3duZXIgewoJCWZlZUNhbGN1bGF0b3IgPSBuZXdGQzsKCX0KCgoJZnVuY3Rpb24gY2FsY0ZlZXModWludDI1NiBmcm9tLCB1aW50MjU2IHRvLCB1aW50MjU2IGFtb3VudCkgcmV0dXJucyAodWludDI1NiB2YWwsIHVpbnQyNTYgZmVlKSB7CgkJcmV0dXJuIEdvbGRGZWVzKGZlZUNhbGN1bGF0b3IpLmNhbGNGZWVzKGZyb20sdG8sYW1vdW50KTsKCX0KCglmdW5jdGlvbiBHb2xkQmFja2VkVG9rZW4oYWRkcmVzcyBmZWVDYWxjKSB7CgkJZmVlQ2FsY3VsYXRvciA9IGZlZUNhbGM7Cgl9CgogICAgc3RydWN0IGFsbG9jYXRpb24geyAKICAgICAgICB1aW50MjU2ICAgICBhbW91bnQ7CiAgICAgICAgdWludDI1NiAgICAgZGF0ZTsKICAgIH0KCQoJYWxsb2NhdGlvbltdICAgcHVibGljIGFsbG9jYXRpb25zT3ZlclRpbWU7CglhbGxvY2F0aW9uW10gICBwdWJsaWMgY3VycmVudEFsbG9jYXRpb25zOwoKCWZ1bmN0aW9uIGN1cnJlbnRBbGxvY2F0aW9uTGVuZ3RoKCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewoJCXJldHVybiBjdXJyZW50QWxsb2NhdGlvbnMubGVuZ3RoOwoJfQoKCWZ1bmN0aW9uIGFvdExlbmd0aCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKCQlyZXR1cm4gYWxsb2NhdGlvbnNPdmVyVGltZS5sZW5ndGg7Cgl9CgoJCiAgICBzdHJ1Y3QgQmFsYW5jZSB7CiAgICAgICAgdWludDI1NiBhbW91bnQ7ICAgICAgICAgICAgICAgICAvLyBhbW91bnQgdGhyb3VnaCB1cGRhdGUgb3IgdHJhbnNmZXIKICAgICAgICB1aW50MjU2IGxhc3RVcGRhdGVkOyAgICAgICAgICAgIC8vIERBVEUgbGFzdCB1cGRhdGVkCiAgICAgICAgdWludDI1NiBuZXh0QWxsb2NhdGlvbkluZGV4OyAgICAvLyB3aGljaCBhbGxvY2F0aW9uc092ZXJUaW1lIHJlY29yZCBjb250YWlucyBuZXh0IHVwZGF0ZQogICAgICAgIHVpbnQyNTYgYWxsb2NhdGlvblNoYXJlOyAgICAgICAgLy8gdGhlIHNoYXJlIG9mIGFsbG9jYXRpb25Qb29sIHRoYXQgdGhpcyBob2xkZXIgZ2V0cyAobWVhbnMgdGhleSBob2xkIEhHVCkKICAgIH0KCgkvKkNyZWF0ZXMgYW4gYXJyYXkgd2l0aCBhbGwgYmFsYW5jZXMqLwoJbWFwcGluZyAoYWRkcmVzcyA9PiBCYWxhbmNlKSBwdWJsaWMgYmFsYW5jZXM7CgltYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkpIGFsbG93ZWQ7CgkKCWZ1bmN0aW9uIHVwZGF0ZShhZGRyZXNzIHdoZXJlKSBpbnRlcm5hbCB7CiAgICAgICAgdWludDI1NiBwb3M7CgkJdWludDI1NiBmZWVzOwoJCXVpbnQyNTYgdmFsOwogICAgICAgICh2YWwsZmVlcyxwb3MpID0gdXBkYXRlZEJhbGFuY2Uod2hlcmUpOwoJICAgIGJhbGFuY2VzW3doZXJlXS5uZXh0QWxsb2NhdGlvbkluZGV4ID0gcG9zOwoJICAgIGJhbGFuY2VzW3doZXJlXS5hbW91bnQgPSB2YWw7CiAgICAgICAgYmFsYW5jZXNbd2hlcmVdLmxhc3RVcGRhdGVkID0gbm93OwoJfQoJCglmdW5jdGlvbiB1cGRhdGVkQmFsYW5jZShhZGRyZXNzIHdoZXJlKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludCB2YWwsIHVpbnQgZmVlcywgdWludCBwb3MpIHsKCQl1aW50MjU2IGNfdmFsOwoJCXVpbnQyNTYgY19mZWVzOwoJCXVpbnQyNTYgY19hbW91bnQ7CgoJCSh2YWwsIGZlZXMpID0gY2FsY0ZlZXMoYmFsYW5jZXNbd2hlcmVdLmxhc3RVcGRhdGVkLG5vdyxiYWxhbmNlc1t3aGVyZV0uYW1vdW50KTsKCgkgICAgcG9zID0gYmFsYW5jZXNbd2hlcmVdLm5leHRBbGxvY2F0aW9uSW5kZXg7CgkJaWYgKChwb3MgPCBjdXJyZW50QWxsb2NhdGlvbnMubGVuZ3RoKSAmJiAgKGJhbGFuY2VzW3doZXJlXS5hbGxvY2F0aW9uU2hhcmUgIT0gMCkpIHsKCgkJCWNfYW1vdW50ID0gY3VycmVudEFsbG9jYXRpb25zW2JhbGFuY2VzW3doZXJlXS5uZXh0QWxsb2NhdGlvbkluZGV4XS5hbW91bnQgKiBiYWxhbmNlc1t3aGVyZV0uYWxsb2NhdGlvblNoYXJlIC8gYWxsb2NhdGlvblBvb2w7CgoJCQkoY192YWwsY19mZWVzKSAgID0gY2FsY0ZlZXMoY3VycmVudEFsbG9jYXRpb25zW2JhbGFuY2VzW3doZXJlXS5uZXh0QWxsb2NhdGlvbkluZGV4XS5kYXRlLG5vdyxjX2Ftb3VudCk7CgoJCX0gCgoJICAgIHZhbCAgKz0gY192YWw7CgkJZmVlcyArPSBjX2ZlZXM7CgkJcG9zICAgPSBjdXJyZW50QWxsb2NhdGlvbnMubGVuZ3RoOwoJfQoKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdoZXJlKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHZhbCkgewogICAgICAgIHVpbnQyNTYgZmVlczsKCQl1aW50MjU2IHBvczsKICAgICAgICAodmFsLGZlZXMscG9zKSA9IHVwZGF0ZWRCYWxhbmNlKHdoZXJlKTsKICAgICAgICByZXR1cm4gOwogICAgfQoKCWV2ZW50IEFsbG9jYXRpb24odWludDI1NiBhbW91bnQsIHVpbnQyNTYgZGF0ZSk7CglldmVudCBGZWVPbkFsbG9jYXRpb24odWludDI1NiBmZWVzLCB1aW50MjU2IGRhdGUpOwoKCWV2ZW50IFBhcnRDb21wbGV0ZSgpOwoJZXZlbnQgU3RpbGxUb0dvKHVpbnQgbnVtTGVmdCk7Cgl1aW50MjU2IHB1YmxpYyBwYXJ0UG9zOwoJdWludDI1NiBwdWJsaWMgcGFydEZlZXM7Cgl1aW50MjU2IHBhcnRMOwoJYWxsb2NhdGlvbltdICAgcHVibGljIHBhcnRBbGxvY2F0aW9uczsKCglmdW5jdGlvbiBwYXJ0QWxsb2NhdGlvbkxlbmd0aCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKCQlyZXR1cm4gcGFydEFsbG9jYXRpb25zLmxlbmd0aDsKCX0KCglmdW5jdGlvbiBhZGRBbGxvY2F0aW9uUGFydE9uZSh1aW50IG5ld0FsbG9jYXRpb24sdWludCBudW1TdGVwcykgb25seU93bmVyewoJCXVpbnQyNTYgdGhpc0FsbG9jYXRpb24gPSBuZXdBbGxvY2F0aW9uOwoKCQlyZXF1aXJlKHRvdEFsbG9jYXRpb24gPCBtYXhBbGxvY2F0aW9uKTsJCS8vIGNhbm5vdCBhbGxvY2F0ZSBtb3JlIHRoYW4gdGhpczsKCgkJaWYgKGN1cnJlbnRBbGxvY2F0aW9ucy5sZW5ndGggPiBwYXJ0QWxsb2NhdGlvbnMubGVuZ3RoKSB7CgkJCXBhcnRBbGxvY2F0aW9ucyA9IGN1cnJlbnRBbGxvY2F0aW9uczsKCQl9CgoJCWlmICh0b3RBbGxvY2F0aW9uICsgdGhpc0FsbG9jYXRpb24gPiBtYXhBbGxvY2F0aW9uKSB7CgkJCXRoaXNBbGxvY2F0aW9uID0gbWF4QWxsb2NhdGlvbiAtIHRvdEFsbG9jYXRpb247CgkJCWxvZzAoIm1heCBhbGxvYyByZWFjaGVkIik7CgkJfQoJCXRvdEFsbG9jYXRpb24gKz0gdGhpc0FsbG9jYXRpb247CgoJCUFsbG9jYXRpb24odGhpc0FsbG9jYXRpb24sbm93KTsKCiAgICAgICAgYWxsb2NhdGlvbiBtZW1vcnkgbmV3RGl2OwogICAgICAgIG5ld0Rpdi5hbW91bnQgPSB0aGlzQWxsb2NhdGlvbjsKICAgICAgICBuZXdEaXYuZGF0ZSA9IG5vdzsKCQkvLyBzdG9yZSBpbnRvIGhpc3RvcnkKCSAgICBhbGxvY2F0aW9uc092ZXJUaW1lLnB1c2gobmV3RGl2KTsKCQkvLyBhZGQgdGhpcyByZWNvcmQgdG8gdGhlIGVuZCBvZiBjdXJyZW50QWxsb2NhdGlvbnMKCQlwYXJ0TCA9IHBhcnRBbGxvY2F0aW9ucy5wdXNoKG5ld0Rpdik7CgkJLy8gdXBkYXRlIGFsbCBvdGhlciByZWNvcmRzIHdpdGggY2FsY3MgZnJvbSBsYXN0IHJlY29yZAoJCWlmIChwYXJ0QWxsb2NhdGlvbnMubGVuZ3RoIDwgMikgeyAvLyBubyBmZWVzIHRvIGNvbnNpZGVyCgkJCVBhcnRDb21wbGV0ZSgpOwoJCQljdXJyZW50QWxsb2NhdGlvbnMgPSBwYXJ0QWxsb2NhdGlvbnM7CgkJCUZlZU9uQWxsb2NhdGlvbigwLG5vdyk7CgkJCXJldHVybjsKCQl9CgkJLy8KCQkvLyBUaGUgb25seSBmZWVzIHRoYXQgbmVlZCB0byBiZSBjb2xsZWN0ZWQgYXJlIHRoZSBmZWVzIG9uIGxvY2F0aW9uIHplcm8uCgkJLy8gU2luY2UgdGhleSBhcmUgdGhlIGxhc3QgY2FsY3VsYXRlZCA9IHRoZXkgY29tZSBvdXQgd2l0aCB0aGUgYnJlYWsKCQkvLwoJCWZvciAocGFydFBvcyA9IHBhcnRBbGxvY2F0aW9ucy5sZW5ndGggLSAyOyBwYXJ0UG9zID49IDA7IHBhcnRQb3MtLSApewoJCQkocGFydEFsbG9jYXRpb25zW3BhcnRQb3NdLmFtb3VudCxwYXJ0RmVlcykgPSBjYWxjRmVlcyhwYXJ0QWxsb2NhdGlvbnNbcGFydFBvc10uZGF0ZSxub3cscGFydEFsbG9jYXRpb25zW3BhcnRQb3NdLmFtb3VudCk7CgoJCQlwYXJ0QWxsb2NhdGlvbnNbcGFydFBvc10uYW1vdW50ICs9IHBhcnRBbGxvY2F0aW9uc1twYXJ0TCAtIDFdLmFtb3VudDsKCQkJcGFydEFsbG9jYXRpb25zW3BhcnRQb3NdLmRhdGUgICAgPSBub3c7CgkJCWlmICgocGFydFBvcyA9PSAwKSB8fCAocGFydFBvcyA9PSBwYXJ0QWxsb2NhdGlvbnMubGVuZ3RoLW51bVN0ZXBzKSl7CgkJCQlicmVhazsgCgkJCX0KCQl9CgkJaWYgKHBhcnRQb3MgIT0gMCkgewoJCQlTdGlsbFRvR28ocGFydFBvcyk7CgkJCXJldHVybjsgLy8gbm90IGRvbmUgeWV0CgkJfQoJCVBhcnRDb21wbGV0ZSgpOwoJCUZlZU9uQWxsb2NhdGlvbihwYXJ0RmVlcyxub3cpOwoJCWN1cnJlbnRBbGxvY2F0aW9ucyA9IHBhcnRBbGxvY2F0aW9uczsKCX0KCglmdW5jdGlvbiBhZGRBbGxvY2F0aW9uUGFydFR3byh1aW50IG51bVN0ZXBzKSBvbmx5T3duZXIgewoJCXJlcXVpcmUobnVtU3RlcHMgPiAwKTsKCQlyZXF1aXJlKHBhcnRQb3MgPiAwKTsKCQlmb3IgKHVpbnQgaSA9IDA7IGkgPCBudW1TdGVwczsgaSsrICl7CgkJCXBhcnRQb3MtLTsKCQkJKHBhcnRBbGxvY2F0aW9uc1twYXJ0UG9zXS5hbW91bnQscGFydEZlZXMpID0gY2FsY0ZlZXMocGFydEFsbG9jYXRpb25zW3BhcnRQb3NdLmRhdGUsbm93LHBhcnRBbGxvY2F0aW9uc1twYXJ0UG9zXS5hbW91bnQpOwoKCQkJcGFydEFsbG9jYXRpb25zW3BhcnRQb3NdLmFtb3VudCArPSBwYXJ0QWxsb2NhdGlvbnNbcGFydEwgLSAxXS5hbW91bnQ7CgkJCXBhcnRBbGxvY2F0aW9uc1twYXJ0UG9zXS5kYXRlICAgID0gbm93OwoJCQlpZiAocGFydFBvcyA9PSAwKSB7CgkJCQlicmVhazsgCgkJCX0KCQl9CgkJaWYgKHBhcnRQb3MgIT0gMCkgewoJCQlTdGlsbFRvR28ocGFydFBvcyk7CgkJCXJldHVybjsgLy8gbm90IGRvbmUgeWV0CgkJfQoJCVBhcnRDb21wbGV0ZSgpOwoJCUZlZU9uQWxsb2NhdGlvbihwYXJ0RmVlcyxub3cpOwoJCWN1cnJlbnRBbGxvY2F0aW9ucyA9IHBhcnRBbGxvY2F0aW9uczsKCX0KCgoJZnVuY3Rpb24gc2V0SEdUKGFkZHJlc3MgX2hndCkgb25seU93bmVyIHsKCQlIR1QgPSBfaGd0OwoJfQoKCWZ1bmN0aW9uIHBhcmVudEZlZXMoYWRkcmVzcyB3aGVyZSkgd2hlbk5vdFBhdXNlZCB7CgkJcmVxdWlyZShtc2cuc2VuZGVyID09IEhHVCk7CgkgICAgdXBkYXRlKHdoZXJlKTsJCQoJfQoJCglmdW5jdGlvbiBwYXJlbnRDaGFuZ2UoYWRkcmVzcyB3aGVyZSwgdWludCBuZXdWYWx1ZSkgd2hlbk5vdFBhdXNlZCB7IC8vIGNhbGxlZCB3aGVuIEhHVCBiYWxhbmNlIGNoYW5nZXMKCQlyZXF1aXJlKG1zZy5zZW5kZXIgPT0gSEdUKTsKCSAgICBiYWxhbmNlc1t3aGVyZV0uYWxsb2NhdGlvblNoYXJlID0gbmV3VmFsdWU7Cgl9CgkKCS8qIHNlbmQgR0JUICovCglmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHdoZW5Ob3RQYXVzZWQgcmV0dXJucyAoYm9vbCBvaykgewoJICAgIHVwZGF0ZShtc2cuc2VuZGVyKTsgICAgICAgICAgICAgIC8vIERvIHRoaXMgdG8gZW5zdXJlIHNlbmRlciBoYXMgZW5vdWdoIGZ1bmRzLgoJCXVwZGF0ZShfdG8pOyAKCiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0uYW1vdW50ID0gc2FmZVN1YihiYWxhbmNlc1ttc2cuc2VuZGVyXS5hbW91bnQsIF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbX3RvXS5hbW91bnQgPSBzYWZlQWRkKGJhbGFuY2VzW190b10uYW1vdW50LCBfdmFsdWUpOwoKCQlUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7IC8vTm90aWZ5IGFueW9uZSBsaXN0ZW5pbmcgdGhhdCB0aGlzIHRyYW5zZmVyIHRvb2sgcGxhY2UKICAgICAgICByZXR1cm4gdHJ1ZTsKCX0KCglmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewoJCXZhciBfYWxsb3dhbmNlID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl07CgoJICAgIHVwZGF0ZShfZnJvbSk7ICAgICAgICAgICAgICAvLyBEbyB0aGlzIHRvIGVuc3VyZSBzZW5kZXIgaGFzIGVub3VnaCBmdW5kcy4KCQl1cGRhdGUoX3RvKTsgCgoJCWJhbGFuY2VzW190b10uYW1vdW50ID0gc2FmZUFkZChiYWxhbmNlc1tfdG9dLmFtb3VudCwgX3ZhbHVlKTsKCQliYWxhbmNlc1tfZnJvbV0uYW1vdW50ID0gc2FmZVN1YihiYWxhbmNlc1tfZnJvbV0uYW1vdW50LCBfdmFsdWUpOwoJCWFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gc2FmZVN1YihfYWxsb3dhbmNlLCBfdmFsdWUpOwoJCVRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CgkJcmV0dXJuIHRydWU7Cgl9CgogIAlmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewoJCXJlcXVpcmUoKF92YWx1ZSA9PSAwKSB8fCAoYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPT0gMCkpOwogICAgCWFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgCUFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgCXJldHVybiB0cnVlOwogIAl9CgogIAlmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVtYWluaW5nKSB7CiAgICAJcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgCX0KCgkvLyBNaW50aW5nIEZ1bmN0aW9ucyAKCWFkZHJlc3MgcHVibGljIGF1dGhvcmlzZWRNaW50ZXI7CgoJZnVuY3Rpb24gc2V0TWludGVyKGFkZHJlc3MgbWludGVyKSBvbmx5T3duZXIgewoJCWF1dGhvcmlzZWRNaW50ZXIgPSBtaW50ZXI7Cgl9CgkKCWZ1bmN0aW9uIG1pbnRUb2tlbnMoYWRkcmVzcyBkZXN0aW5hdGlvbiwgdWludDI1NiBhbW91bnQpIHsKCQlyZXF1aXJlKG1zZy5zZW5kZXIgPT0gYXV0aG9yaXNlZE1pbnRlcik7CgkJdXBkYXRlKGRlc3RpbmF0aW9uKTsKCQliYWxhbmNlc1tkZXN0aW5hdGlvbl0uYW1vdW50ID0gc2FmZUFkZChiYWxhbmNlc1tkZXN0aW5hdGlvbl0uYW1vdW50LCBhbW91bnQpOwoJCWJhbGFuY2VzW2Rlc3RpbmF0aW9uXS5sYXN0VXBkYXRlZCA9IG5vdzsKCQliYWxhbmNlc1tkZXN0aW5hdGlvbl0ubmV4dEFsbG9jYXRpb25JbmRleCA9IGN1cnJlbnRBbGxvY2F0aW9ucy5sZW5ndGg7CgkJVG9rZW5NaW50ZWQoZGVzdGluYXRpb24sYW1vdW50KTsKCX0KCglmdW5jdGlvbiBidXJuVG9rZW5zKGFkZHJlc3Mgc291cmNlLCB1aW50MjU2IGFtb3VudCkgewoJCXJlcXVpcmUobXNnLnNlbmRlciA9PSBhdXRob3Jpc2VkTWludGVyKTsKCQl1cGRhdGUoc291cmNlKTsKCQliYWxhbmNlc1tzb3VyY2VdLmFtb3VudCA9IHNhZmVTdWIoYmFsYW5jZXNbc291cmNlXS5hbW91bnQsYW1vdW50KTsKCQliYWxhbmNlc1tzb3VyY2VdLmxhc3RVcGRhdGVkID0gbm93OwoJCWJhbGFuY2VzW3NvdXJjZV0ubmV4dEFsbG9jYXRpb25JbmRleCA9IGN1cnJlbnRBbGxvY2F0aW9ucy5sZW5ndGg7CgkJVG9rZW5CdXJuZWQoc291cmNlLGFtb3VudCk7Cgl9Cn0KCi8vKioqKioqKioqKioqKioqKiBIZWxsb0dvbGRTYWxlCgpjb250cmFjdCBIZWxsb0dvbGRTYWxlIGlzIFBhdXNhYmxlLCBTYWZlTWF0aCB7CgogIHVpbnQyNTYgcHVibGljIGRlY2ltYWxzID0gODsKCiAgdWludDI1NiBwdWJsaWMgc3RhcnREYXRlID0gMTUwMzg5MjgwMDsgICAgICAvLyBNb25kYXksIEF1Z3VzdCAyOCwgMjAxNyAxMjowMDowMCBQTSBHTVQrMDg6MDAKICB1aW50MjU2IHB1YmxpYyBlbmREYXRlICAgPSAxNTA0NDk3NjAwOyAgICAgIC8vIE1vbmRheSwgU2VwdGVtYmVyIDQsIDIwMTcgMTI6MDA6MDAgUE0gR01UKzA4OjAwCgogIHVpbnQyNTYgdHJhbmNoZVBlcmlvZCA9IDEgd2Vla3M7CgogIC8vIGFkZHJlc3Mgb2YgSEdUIFRva2VuLiBIR1QgbXVzdCBBcHByb3ZlIHRoaXMgY29udHJhY3QgdG8gZGlzYnVyc2UgMTgwTSB0b2tlbnMKICBIZWxsb0dvbGRUb2tlbiAgICAgICAgICB0b2tlbjsKCiAgdWludDI1NiBjb25zdGFudCBNYXhDb2luc1IxICAgICAgPSAgODAgKiAxMCoqNiAqIDEwKio4OyAgIC8vIDE4ME0gSEdUCiAgdWludDI1NiBwdWJsaWMgY29pbnNSZW1haW5pbmcgICAgPSAgODAgKiAxMCoqNiAqIDEwKio4OyAKICB1aW50MjU2IGNvaW5zUGVyVGllciAgICAgICAgICAgICA9ICAxNiAqIDEwKio2ICogMTAqKjg7ICAgLy8gNDBNIEhHVAogIHVpbnQyNTYgcHVibGljIGNvaW5zTGVmdEluVGllciAgID0gIDE2ICogMTAqKjYgKiAxMCoqODsKCiAgdWludDI1NiBwdWJsaWMgbWluaW11bUNhcCAgICAgICAgPSAgMDsgICAgLy8gcHJlc2FsZSBhY2hpZXZlZAoKICB1aW50MjU2IG51bVRpZXJzICAgICAgICAgICAgICAgPSA1OwogIHVpbnQxNiAgcHVibGljIHRpZXJObzsKICB1aW50MjU2IHB1YmxpYyBwcmVhbGxvY0NvaW5zOyAgIC8vIHVzZWQgZm9yIHRlc3RpbmcgYWdhaW5zdCBjYXAgKGluYyBwbGFjZW1lbnQpCiAgdWludDI1NiBwdWJsaWMgcHVyY2hhc2VkQ29pbnM7ICAvLyB1c2VkIGZvciB0ZXN0aW5nIGFnYWluc3QgdGllciBwcmljaW5nCiAgdWludDI1NiBwdWJsaWMgZXRoUmFpc2VkOwogIHVpbnQyNTYgcHVibGljIHBlcnNvbmFsTWF4ICAgICA9IDEwIGV0aGVyOyAgICAgLy8gbWF4IGV0aGVyIHBlciBwZXJzb24gZHVyaW5nIHB1YmxpYyBzYWxlCiAgdWludDI1NiBwdWJsaWMgY29udHJpYnV0b3JzOwoKICBhZGRyZXNzIHB1YmxpYyBjczsKICBhZGRyZXNzIHB1YmxpYyBtdWx0aVNpZzsKICBhZGRyZXNzIHB1YmxpYyBIR1RfUmVzZXJ2ZTsKICAKICBzdHJ1Y3QgY3NBY3Rpb24gIHsKICAgICAgYm9vbCAgICAgICAgcGFzc2VkS1lDOwogICAgICBib29sICAgICAgICBibG9ja2VkOwogIH0KCiAgLyogVGhpcyBjcmVhdGVzIGFuIGFycmF5IHdpdGggYWxsIGJhbGFuY2VzICovCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBjc0FjdGlvbikgcHVibGljIHBlcm1pc3Npb25zOwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgIHB1YmxpYyBkZXBvc2l0czsKCiAgbW9kaWZpZXIgTXVzdEJlRW5hYmxlZChhZGRyZXNzIHgpIHsKICAgICAgcmVxdWlyZSAoIXBlcm1pc3Npb25zW3hdLmJsb2NrZWQpIDsKICAgICAgcmVxdWlyZSAocGVybWlzc2lvbnNbeF0ucGFzc2VkS1lDKSA7CiAgICAgIAogICAgICBfOwogIH0KCiAgZnVuY3Rpb24gSGVsbG9Hb2xkU2FsZShhZGRyZXNzIF9jcywgYWRkcmVzcyBfaGd0LCBhZGRyZXNzIF9tdWx0aVNpZywgYWRkcmVzcyBfcmVzZXJ2ZSkgewogICAgY3MgICAgICAgICAgPSBfY3M7CiAgICB0b2tlbiAgICAgICA9IEhlbGxvR29sZFRva2VuKF9oZ3QpOwogICAgbXVsdGlTaWcgICAgPSBfbXVsdGlTaWc7CiAgICBIR1RfUmVzZXJ2ZSA9IF9yZXNlcnZlOwogIH0KCiAgLy8gV2Ugb25seSBleHBlY3QgdG8gdXNlIHRoaXMgdG8gc2V0L3Jlc2V0IHRoZSBzdGFydCBvZiB0aGUgY29udHJhY3QgdW5kZXIgZXhjZXB0aW9uYWwgY2lyY3Vtc3RhbmNlcwogIGZ1bmN0aW9uIHNldFN0YXJ0KHVpbnQyNTYgd2hlbl8pIG9ubHlPd25lciB7CiAgICAgIHN0YXJ0RGF0ZSA9IHdoZW5fOwogICAgICBlbmREYXRlID0gd2hlbl8gKyB0cmFuY2hlUGVyaW9kOwogIH0KCiAgbW9kaWZpZXIgTXVzdEJlQ3MoKSB7CiAgICAgIHJlcXVpcmUgKG1zZy5zZW5kZXIgPT0gY3MpIDsKICAgICAgCiAgICAgIF87CiAgfQoKCiAgLy8gMSBldGhlciA9IE4gSEdUIHRva2VucyAKICB1aW50MjU2WzVdIHB1YmxpYyBoZ3RSYXRlcyA9IFsxMjQ4OTAwMDAwMDAwLDExOTY5MDAwMDAwMDAsMTE0NDgwMDAwMDAwMCwxMDkyODAwMDAwMDAwLDEwNDA3MDAwMDAwMDBdOwogICAgICAgICAgICAgICAgICAgICAgCgogICAgLyogQXBwcm92ZSB0aGUgYWNjb3VudCBmb3Igb3BlcmF0aW9uICovCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgdXNlcikgTXVzdEJlQ3MgewogICAgICAgIHBlcm1pc3Npb25zW3VzZXJdLnBhc3NlZEtZQyA9IHRydWU7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGJsb2NrKGFkZHJlc3MgdXNlcikgTXVzdEJlQ3MgewogICAgICAgIHBlcm1pc3Npb25zW3VzZXJdLmJsb2NrZWQgPSB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIHVuYmxvY2soYWRkcmVzcyB1c2VyKSBNdXN0QmVDcyB7CiAgICAgICAgIHBlcm1pc3Npb25zW3VzZXJdLmJsb2NrZWQgPSBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBuZXdDcyhhZGRyZXNzIG5ld0NzKSBvbmx5T3duZXIgewogICAgICAgIGNzID0gbmV3Q3M7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0UGVyaW9kKHVpbnQyNTYgcGVyaW9kXykgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlICghZnVuZGluZygpKSA7CiAgICAgICAgdHJhbmNoZVBlcmlvZCA9IHBlcmlvZF87CiAgICAgICAgZW5kRGF0ZSA9IHN0YXJ0RGF0ZSArIHRyYW5jaGVQZXJpb2Q7CiAgICAgICAgaWYgKGVuZERhdGUgPCBub3cgKyB0cmFuY2hlUGVyaW9kKSB7CiAgICAgICAgICAgIGVuZERhdGUgPSBub3cgKyB0cmFuY2hlUGVyaW9kOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiB3aGVuKCkgIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gbm93OwogICAgfQoKICBmdW5jdGlvbiBmdW5kaW5nKCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgeyAgICAgCiAgICBpZiAocGF1c2VkKSByZXR1cm4gZmFsc2U7ICAgICAgICAgICAgICAgLy8gZnJvemVuCiAgICBpZiAobm93IDwgc3RhcnREYXRlKSByZXR1cm4gZmFsc2U7ICAgICAgLy8gdG9vIGVhcmx5CiAgICBpZiAobm93ID4gZW5kRGF0ZSkgcmV0dXJuIGZhbHNlOyAgICAgICAgLy8gdG9vIGxhdGUKICAgIGlmIChjb2luc1JlbWFpbmluZyA9PSAwKSByZXR1cm4gZmFsc2U7ICAvLyBubyBtb3JlIGNvaW5zCiAgICBpZiAodGllck5vID49IG51bVRpZXJzICkgcmV0dXJuIGZhbHNlOyAgLy8gcGFzc2VkIGVuZCBvZiB0b3AgdGllci4gVGllcnMgc3RhcnQgYXQgemVybwogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiBzdWNjZXNzKCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBzdWNjZWVkZWQpIHsKICAgIGlmIChjb2luc1JlbWFpbmluZyA9PSAwKSByZXR1cm4gdHJ1ZTsKICAgIGJvb2wgY29tcGxldGUgPSAobm93ID4gZW5kRGF0ZSkgOwogICAgYm9vbCBkaWRPSyA9IChjb2luc1JlbWFpbmluZyA8PSAoTWF4Q29pbnNSMSAtIG1pbmltdW1DYXApKTsgLy8gbm90IGV2ZW4gNDBNIEdvbmU/PyBBYXJnaC4KICAgIHN1Y2NlZWRlZCA9IChjb21wbGV0ZSAmJiBkaWRPSykgIDsgIC8vIChvdXQgb2Ygc3RlYW0gYnV0IGVub3VnaCBzb2xkKSAKICAgIHJldHVybiA7CiAgfQoKICBmdW5jdGlvbiBmYWlsZWQoKSBjb25zdGFudCByZXR1cm5zIChib29sIGRpZE5vdFN1Y2NlZWQpIHsKICAgIGJvb2wgY29tcGxldGUgPSAobm93ID4gZW5kRGF0ZSAgKTsKICAgIGJvb2wgZGlkQmFkID0gKGNvaW5zUmVtYWluaW5nID4gKE1heENvaW5zUjEgLSBtaW5pbXVtQ2FwKSk7CiAgICBkaWROb3RTdWNjZWVkID0gKGNvbXBsZXRlICYmIGRpZEJhZCk7CiAgICByZXR1cm47CiAgfQoKICAKICBmdW5jdGlvbiAoKSBwYXlhYmxlIE11c3RCZUVuYWJsZWQobXNnLnNlbmRlcikgd2hlbk5vdFBhdXNlZCB7ICAgIAogICAgY3JlYXRlVG9rZW5zKG1zZy5zZW5kZXIsbXNnLnZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIGxpbmtDb2luKGFkZHJlc3MgY29pbikgb25seU93bmVyIHsKICAgIHRva2VuID0gSGVsbG9Hb2xkVG9rZW4oY29pbik7CiAgfQoKICBmdW5jdGlvbiBjb2luQWRkcmVzcygpIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MpIHsKICAgICAgcmV0dXJuIGFkZHJlc3ModG9rZW4pOwogIH0KCiAgLy8gaGd0UmF0ZXMgaW4gd2hvbGUgdG9rZW5zIHBlciBFVEgKICAvLyBtYXggaW5kaXZpZHVhbCBjb250cmlidXRpb24gaW4gd2hvbGUgRVRICiAgZnVuY3Rpb24gc2V0SGd0UmF0ZXModWludDI1NiBwMCx1aW50MjU2IHAxLHVpbnQyNTYgcDIsdWludDI1NiBwMyx1aW50MjU2IHA0LCB1aW50MjU2IF9tYXggKSBvbmx5T3duZXIgewogICAgICAgICAgICAgIHJlcXVpcmUgKG5vdyA8IHN0YXJ0RGF0ZSkgOwogICAgICAgICAgICAgIGhndFJhdGVzWzBdICAgPSBwMCAqIDEwKio4OwogICAgICAgICAgICAgIGhndFJhdGVzWzFdICAgPSBwMSAqIDEwKio4OwogICAgICAgICAgICAgIGhndFJhdGVzWzJdICAgPSBwMiAqIDEwKio4OwogICAgICAgICAgICAgIGhndFJhdGVzWzNdICAgPSBwMyAqIDEwKio4OwogICAgICAgICAgICAgIGhndFJhdGVzWzRdICAgPSBwNCAqIDEwKio4OwogICAgICAgICAgICAgIHBlcnNvbmFsTWF4ID0gX21heCAqIDEgZXRoZXI7ICAgICAgICAgICAvLyBtYXggRVRIIHBlciBwZXJzb24KICB9CgogIAogIGV2ZW50IFB1cmNoYXNlKGFkZHJlc3MgaW5kZXhlZCBidXllciwgdWludDI1NiBsZXZlbCx1aW50MjU2IHZhbHVlLCB1aW50MjU2IHRva2Vucyk7CiAgZXZlbnQgUmVkdWN0aW9uKHN0cmluZyBtc2csIGFkZHJlc3MgaW5kZXhlZCBidXllciwgdWludDI1NiB3YW50ZWQsIHVpbnQyNTYgYWxsb2NhdGVkKTsKICBldmVudCBNYXhGdW5kcyhhZGRyZXNzIHNlbmRlciwgdWludDI1NiB0YWtlbiwgdWludDI1NiByZXR1cm5lZCk7CiAgCiAgZnVuY3Rpb24gY3JlYXRlVG9rZW5zKGFkZHJlc3MgcmVjaXBpZW50LCB1aW50MjU2IHZhbHVlKSBwcml2YXRlIHsKICAgIHVpbnQyNTYgdG90YWxUb2tlbnM7CiAgICB1aW50MjU2IGhndFJhdGU7CiAgICByZXF1aXJlIChmdW5kaW5nKCkpIDsKICAgIHJlcXVpcmUgKHZhbHVlID49IDEgZmlubmV5KSA7CiAgICByZXF1aXJlIChkZXBvc2l0c1tyZWNpcGllbnRdIDwgcGVyc29uYWxNYXgpOwoKICAgIHVpbnQyNTYgbWF4UmVmdW5kID0gMDsKICAgIGlmICgoZGVwb3NpdHNbcmVjaXBpZW50XSArIHZhbHVlKSA+IHBlcnNvbmFsTWF4KSB7CiAgICAgICAgbWF4UmVmdW5kID0gZGVwb3NpdHNbcmVjaXBpZW50XSArIHZhbHVlIC0gcGVyc29uYWxNYXg7CiAgICAgICAgdmFsdWUgLT0gbWF4UmVmdW5kOwogICAgICAgIE1heEZ1bmRzKHJlY2lwaWVudCx2YWx1ZSxtYXhSZWZ1bmQpOwogICAgfSAgCgogICAgdWludDI1NiB2YWwgPSB2YWx1ZTsKCiAgICBldGhSYWlzZWQgPSBzYWZlQWRkKGV0aFJhaXNlZCx2YWx1ZSk7CiAgICBpZiAoZGVwb3NpdHNbcmVjaXBpZW50XSA9PSAwKSBjb250cmlidXRvcnMrKzsKICAgIAogICAgCiAgICBkbyB7CiAgICAgIGhndFJhdGUgPSBoZ3RSYXRlc1t0aWVyTm9dOyAgICAgICAgICAgICAgICAgLy8gaGd0UmF0ZSBtdXN0IGluY2x1ZGUgdGhlIDEwXjgKICAgICAgdWludCB0b2tlbnMgPSBzYWZlTXVsKHZhbCwgaGd0UmF0ZSk7ICAgICAgLy8gKHZhbCBpbiBldGggKiAxMF4xOCkgKiAjdG9rZW5zIHBlciBldGgKICAgICAgdG9rZW5zID0gc2FmZURpdih0b2tlbnMsIDEgZXRoZXIpOyAgICAgIC8vIHZhbCBpcyBpbiBldGhlciwgbXNnLnZhbHVlIGlzIGluIHdlaQogICAKICAgICAgaWYgKHRva2VucyA8PSBjb2luc0xlZnRJblRpZXIpIHsKICAgICAgICB1aW50MjU2IGFjdHVhbFRva2VucyA9IHRva2VuczsKICAgICAgICB1aW50IHJlZnVuZCA9IDA7CiAgICAgICAgaWYgKHRva2VucyA+IGNvaW5zUmVtYWluaW5nKSB7IC8vY2FuJ3Qgc2VsbCBkZXNpcmVkICMgdG9rZW5zCiAgICAgICAgICAgIFJlZHVjdGlvbigiaW4gdGllciIscmVjaXBpZW50LHRva2Vucyxjb2luc1JlbWFpbmluZyk7CiAgICAgICAgICAgIGFjdHVhbFRva2VucyA9IGNvaW5zUmVtYWluaW5nOwogICAgICAgICAgICByZWZ1bmQgPSBzYWZlU3ViKHRva2VucywgY29pbnNSZW1haW5pbmcgKTsgLy8gcmVmdW5kIGFtb3VudCBpbiB0b2tlbnMKICAgICAgICAgICAgcmVmdW5kID0gc2FmZURpdihyZWZ1bmQqMSBldGhlcixoZ3RSYXRlICk7ICAvLyByZWZ1bmQgYW1vdW50IGluIEVUSAogICAgICAgICAgICAvLyBuZWVkIGEgcmVmdW5kIG1lY2hhbmlzbSBoZXJlIHRvbwogICAgICAgICAgICBjb2luc1JlbWFpbmluZyA9IDA7CiAgICAgICAgICAgIHZhbCA9IHNhZmVTdWIoIHZhbCxyZWZ1bmQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvaW5zUmVtYWluaW5nICA9IHNhZmVTdWIoY29pbnNSZW1haW5pbmcsICBhY3R1YWxUb2tlbnMpOwogICAgICAgIH0KICAgICAgICBwdXJjaGFzZWRDb2lucyAgPSBzYWZlQWRkKHB1cmNoYXNlZENvaW5zLCBhY3R1YWxUb2tlbnMpOwoKICAgICAgICB0b3RhbFRva2VucyA9IHNhZmVBZGQodG90YWxUb2tlbnMsYWN0dWFsVG9rZW5zKTsKCiAgICAgICAgcmVxdWlyZSAodG9rZW4udHJhbnNmZXJGcm9tKEhHVF9SZXNlcnZlLCByZWNpcGllbnQsdG90YWxUb2tlbnMpKSA7CgogICAgICAgIFB1cmNoYXNlKHJlY2lwaWVudCx0aWVyTm8sdmFsLGFjdHVhbFRva2Vucyk7IC8vIGV2ZW50CgogICAgICAgIGRlcG9zaXRzW3JlY2lwaWVudF0gPSBzYWZlQWRkKGRlcG9zaXRzW3JlY2lwaWVudF0sdmFsKTsgLy8gaW4gY2FzZSBvZiByZWZ1bmQgLSBjb3VsZCBwdWxsIG9mZiBldGhlcnNjYW4KICAgICAgICByZWZ1bmQgKz0gbWF4UmVmdW5kOwogICAgICAgIGlmIChyZWZ1bmQgPiAwKSB7CiAgICAgICAgICAgIGV0aFJhaXNlZCA9IHNhZmVTdWIoZXRoUmFpc2VkLHJlZnVuZCk7CiAgICAgICAgICAgIHJlY2lwaWVudC50cmFuc2ZlcihyZWZ1bmQpOwogICAgICAgIH0KICAgICAgICBpZiAoY29pbnNSZW1haW5pbmcgPD0gKE1heENvaW5zUjEgLSBtaW5pbXVtQ2FwKSl7IC8vIGhhcyBwYXNzZWQgc3VjY2VzcyBjcml0ZXJpYQogICAgICAgICAgICBpZiAoIW11bHRpU2lnLnNlbmQodGhpcy5iYWxhbmNlKSkgeyAgICAgICAgICAgICAgICAvLyBzZW5kIGZ1bmRzIHRvIEhHRgogICAgICAgICAgICAgICAgbG9nMCgiY2Fubm90IGZvcndhcmQgZnVuZHMgdG8gb3duZXIiKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb2luc0xlZnRJblRpZXIgPSBzYWZlU3ViKGNvaW5zTGVmdEluVGllcixhY3R1YWxUb2tlbnMpOwogICAgICAgIGlmICgoY29pbnNMZWZ0SW5UaWVyID09IDApICYmIChjb2luc1JlbWFpbmluZyAhPSAwKSkgeyAvLyBleGFjdCBzZWxsIG91dCBvZiBub24gZmluYWwgdGllcgogICAgICAgICAgICBjb2luc0xlZnRJblRpZXIgPSBjb2luc1BlclRpZXI7CiAgICAgICAgICAgIHRpZXJObysrOwogICAgICAgICAgICBlbmREYXRlID0gbm93ICsgdHJhbmNoZVBlcmlvZDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIC8vIGNoZWNrIHRoYXQgY29pbnNMZWZ0SW5UaWVyID49IGNvaW5zUmVtYWluaW5nCgogICAgICB1aW50MjU2IGNvaW5zMmJ1eSA9IG1pbjI1Nihjb2luc0xlZnRJblRpZXIgLCBjb2luc1JlbWFpbmluZyk7IAoKICAgICAgZW5kRGF0ZSA9IHNhZmVBZGQoIG5vdywgdHJhbmNoZVBlcmlvZCk7CiAgICAgIC8vIEhhdmUgYnVtcGVkIGxldmVscyAtIG5lZWQgdG8gbW9kaWZ5IGVuZCBkYXRlIGhlcmUKICAgICAgcHVyY2hhc2VkQ29pbnMgPSBzYWZlQWRkKHB1cmNoYXNlZENvaW5zLCBjb2luczJidXkpOyAgLy8gZ2l2ZSBhbGwgY29pbnMgcmVtYWluaW5nIGluIHRoaXMgdGllcgogICAgICB0b3RhbFRva2VucyAgICA9IHNhZmVBZGQodG90YWxUb2tlbnMsY29pbnMyYnV5KTsKICAgICAgY29pbnNSZW1haW5pbmcgPSBzYWZlU3ViKGNvaW5zUmVtYWluaW5nLGNvaW5zMmJ1eSk7CgogICAgICB1aW50IHdlaUNvaW5zTGVmdEluVGhpc1RpZXIgPSBzYWZlTXVsKGNvaW5zMmJ1eSwxIGV0aGVyKTsKICAgICAgdWludCBjb3N0T2ZUaGVzZUNvaW5zID0gc2FmZURpdih3ZWlDb2luc0xlZnRJblRoaXNUaWVyLCBoZ3RSYXRlKTsgIC8vIGhvdyBtdWNoIGRpZCB0aGF0IGNvc3Q/CgogICAgICBQdXJjaGFzZShyZWNpcGllbnQsIHRpZXJObyxjb3N0T2ZUaGVzZUNvaW5zLGNvaW5zMmJ1eSk7IC8vIGV2ZW50CgogICAgICBkZXBvc2l0c1tyZWNpcGllbnRdID0gc2FmZUFkZChkZXBvc2l0c1tyZWNpcGllbnRdLGNvc3RPZlRoZXNlQ29pbnMpOwogICAgICB2YWwgICAgPSBzYWZlU3ViKHZhbCxjb3N0T2ZUaGVzZUNvaW5zKTsKICAgICAgdGllck5vID0gdGllck5vICsgMTsKICAgICAgY29pbnNMZWZ0SW5UaWVyID0gY29pbnNQZXJUaWVyOwogICAgfSB3aGlsZSAoKHZhbCA+IDApICYmIGZ1bmRpbmcoKSk7CgogICAgLy8gZXNjYXBlZCBiZWNhdXNlIHdlIHBhc3NlZCB0aGUgZW5kIG9mIHRoZSB1bml2ZXJzZS4uLi4uCiAgICAvLyBzbyBnaXZlIHRoZW0gdGhlaXIgdG9rZW5zCiAgICByZXF1aXJlICh0b2tlbi50cmFuc2ZlckZyb20oSEdUX1Jlc2VydmUsIHJlY2lwaWVudCx0b3RhbFRva2VucykpIDsKCiAgICBpZiAoKHZhbCA+IDApIHx8IChtYXhSZWZ1bmQgPiAwKSl7CiAgICAgICAgUmVkdWN0aW9uKCJmaW5pc2hlZCBjcm93ZHNhbGUsIHJldHVybmluZyAiLHJlY2lwaWVudCx2YWx1ZSx0b3RhbFRva2Vucyk7CiAgICAgICAgLy8gcmV0dXJuIHRoZSByZW1haW5kZXIgIQogICAgICAgIHJlY2lwaWVudC50cmFuc2Zlcih2YWwrbWF4UmVmdW5kKTsgLy8gaWYgeW91IGNhbid0IHJldHVybiB0aGUgYmFsYW5jZSwgYWJvcnQgd2hvbGUgcHJvY2VzcwogICAgfQogICAgaWYgKCFtdWx0aVNpZy5zZW5kKHRoaXMuYmFsYW5jZSkpIHsKICAgICAgICBldGhSYWlzZWQgPSBzYWZlU3ViKGV0aFJhaXNlZCx0aGlzLmJhbGFuY2UpOwogICAgICAgIGxvZzAoImNhbm5vdCBzZW5kIGF0IHRpZXIganVtcCIpOwogICAgfQogIH0KICAKICBmdW5jdGlvbiBhbGxvY2F0ZWRUb2tlbnMoYWRkcmVzcyBncmFudGVlLCB1aW50MjU2IG51bVRva2Vucykgb25seU93bmVyIHsKICAgIHJlcXVpcmUgKG5vdyA8IHN0YXJ0RGF0ZSkgOwogICAgaWYgKG51bVRva2VucyA8IGNvaW5zUmVtYWluaW5nKSB7CiAgICAgICAgY29pbnNSZW1haW5pbmcgPSBzYWZlU3ViKGNvaW5zUmVtYWluaW5nLCBudW1Ub2tlbnMpOwogICAgICAgCiAgICB9IGVsc2UgewogICAgICAgIG51bVRva2VucyA9IGNvaW5zUmVtYWluaW5nOwogICAgICAgIGNvaW5zUmVtYWluaW5nID0gMDsKICAgIH0KICAgIHByZWFsbG9jQ29pbnMgPSBzYWZlQWRkKHByZWFsbG9jQ29pbnMsbnVtVG9rZW5zKTsKICAgIHJlcXVpcmUgKHRva2VuLnRyYW5zZmVyRnJvbShIR1RfUmVzZXJ2ZSxncmFudGVlLG51bVRva2VucykpOwogIH0KCiAgZnVuY3Rpb24gd2l0aGRyYXcoKSB7IC8vIGl0IGZhaWxlZC4gQ29tZSBhbmQgZ2V0IHlvdXIgZXRoZXIuCiAgICAgIGlmIChmYWlsZWQoKSkgewogICAgICAgICAgaWYgKGRlcG9zaXRzW21zZy5zZW5kZXJdID4gMCkgewogICAgICAgICAgICAgIHVpbnQyNTYgdmFsID0gZGVwb3NpdHNbbXNnLnNlbmRlcl07CiAgICAgICAgICAgICAgZGVwb3NpdHNbbXNnLnNlbmRlcl0gPSAwOwogICAgICAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIodmFsKTsKICAgICAgICAgIH0KICAgICAgfQogIH0KCiAgZnVuY3Rpb24gY29tcGxldGUoKSBvbmx5T3duZXIgeyAgLy8gdGhpcyBzaG91bGQgbm90IGhhdmUgdG8gYmUgY2FsbGVkLiBFeHRyZW1lIG1lYXN1cmVzLgogICAgICBpZiAoc3VjY2VzcygpKSB7CiAgICAgICAgICB1aW50MjU2IHZhbCA9IHRoaXMuYmFsYW5jZTsKICAgICAgICAgIGlmICh2YWwgPiAwKSB7CiAgICAgICAgICAgIGlmICghbXVsdGlTaWcuc2VuZCh2YWwpKSB7CiAgICAgICAgICAgICAgICBsb2cwKCJjYW5ub3Qgd2l0aGRyYXciKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGxvZzAoImZ1bmRzIHdpdGhkcmF3biIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGxvZzAoIm5vdGhpbmcgdG8gd2l0aGRyYXciKTsKICAgICAgICAgIH0KICAgICAgfQogIH0KCn0='.
	

]
