Class {
	#name : #SRTbc86727e770de68b1060c91f6bb6945c73e10388,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTbc86727e770de68b1060c91f6bb6945c73e10388 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovLyBGaWxlOiBjb250cmFjdHMvSW5rTWVkaWF0b3Iuc29sCgppbnRlcmZhY2UgSW5rTWVkaWF0b3IgewogIGZ1bmN0aW9uIG1lZGlhdGlvbkV4cGlyeSgpIGV4dGVybmFsIHJldHVybnMgKHVpbnQzMik7CiAgZnVuY3Rpb24gcmVxdWVzdE1lZGlhdG9yKHVpbnQyNTYgX3RyYW5zYWN0aW9uSWQsIHVpbnQyNTYgX3RyYW5zYWN0aW9uQW1vdW50LCBhZGRyZXNzIF90cmFuc2FjdGlvbk93bmVyKSBleHRlcm5hbCByZXR1cm5zIChib29sKTsKICBmdW5jdGlvbiBjb25maXJtVHJhbnNhY3Rpb25GZWUodWludDI1NiBfdHJhbnNhY3Rpb25BbW91bnQpIGV4dGVybmFsIHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIGNvbmZpcm1UcmFuc2FjdGlvbkFmdGVyRXhwaXJ5RmVlKHVpbnQyNTYgX3RyYW5zYWN0aW9uQW1vdW50KSBleHRlcm5hbCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiBjb25maXJtVHJhbnNhY3Rpb25BZnRlckRpc3B1dGVGZWUodWludDI1NiBfdHJhbnNhY3Rpb25BbW91bnQpIGV4dGVybmFsIHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIGNvbmZpcm1UcmFuc2FjdGlvbkJ5TWVkaWF0b3JGZWUodWludDI1NiBfdHJhbnNhY3Rpb25BbW91bnQpIGV4dGVybmFsIHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHJlZnVuZFRyYW5zYWN0aW9uRmVlKHVpbnQyNTYgX3RyYW5zYWN0aW9uQW1vdW50KSBleHRlcm5hbCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiByZWZ1bmRUcmFuc2FjdGlvbkFmdGVyRXhwaXJ5RmVlKHVpbnQyNTYgX3RyYW5zYWN0aW9uQW1vdW50KSBleHRlcm5hbCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiByZWZ1bmRUcmFuc2FjdGlvbkFmdGVyRGlzcHV0ZUZlZSh1aW50MjU2IF90cmFuc2FjdGlvbkFtb3VudCkgZXh0ZXJuYWwgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gcmVmdW5kVHJhbnNhY3Rpb25CeU1lZGlhdG9yRmVlKHVpbnQyNTYgX3RyYW5zYWN0aW9uQW1vdW50KSBleHRlcm5hbCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiBzZXR0bGVUcmFuc2FjdGlvbkJ5TWVkaWF0b3JGZWUodWludDI1NiBfYnV5ZXJBbW91bnQsIHVpbnQyNTYgX3NlbGxlckFtb3VudCkgZXh0ZXJuYWwgcmV0dXJucyAodWludDI1NiwgdWludDI1Nik7Cn0KCi8vIEZpbGU6IGNvbnRyYWN0cy9JbmtPd25lci5zb2wKCmludGVyZmFjZSBJbmtPd25lciB7CiAgZnVuY3Rpb24gYXV0aG9yaXplVHJhbnNhY3Rpb24odWludDI1NiBfaWQsIGFkZHJlc3MgX2J1eWVyKSBleHRlcm5hbCByZXR1cm5zIChib29sKTsKfQoKLy8gRmlsZTogY29udHJhY3RzL0lua1Byb3RvY29sSW50ZXJmYWNlLnNvbAoKaW50ZXJmYWNlIElua1Byb3RvY29sSW50ZXJmYWNlIHsKICAvLyBFdmVudCBlbWl0dGVkIHdoZW4gYSB0cmFuc2FjdGlvbiBpcyBpbml0aWF0ZWQuCiAgZXZlbnQgVHJhbnNhY3Rpb25Jbml0aWF0ZWQoCiAgICB1aW50MjU2IGluZGV4ZWQgaWQsCiAgICBhZGRyZXNzIG93bmVyLAogICAgYWRkcmVzcyBpbmRleGVkIGJ1eWVyLAogICAgYWRkcmVzcyBpbmRleGVkIHNlbGxlciwKICAgIGFkZHJlc3MgcG9saWN5LAogICAgYWRkcmVzcyBtZWRpYXRvciwKICAgIHVpbnQyNTYgYW1vdW50LAogICAgLy8gQSBoYXNoIHN0cmluZyByZXByZXNlbnRpbmcgdGhlIG1ldGFkYXRhIGZvciB0aGUgdHJhbnNhY3Rpb24uIFRoaXMgaXMKICAgIC8vIHNvbWV3aGF0IGFyYml0cmFyeSBmb3IgdGhlIHRyYW5zYWN0aW9uLiBPbmx5IHRoZSB0cmFuc2FjdGlvbiBvd25lcgogICAgLy8gd2lsbCByZWFsbHkga25vdyB0aGUgb3JpZ2luYWwgY29udGVudHMgb2YgdGhlIG1ldGFkYXRhIGFuZCBtYXkgY2hvb3NlCiAgICAvLyB0byBzaGFyZSBpdCBhdCB0aGVpciBkaXNjcmV0aW9uLgogICAgYnl0ZXMzMiBtZXRhZGF0YQogICk7CgogIC8vIEV2ZW50IGVtaXR0ZWQgd2hlbiBhIHRyYW5zYWN0aW9uIGhhcyBiZWVuIGFjY2VwdGVkIGJ5IHRoZSBzZWxsZXIuCiAgZXZlbnQgVHJhbnNhY3Rpb25BY2NlcHRlZCgKICAgIHVpbnQyNTYgaW5kZXhlZCBpZAogICk7CgogIC8vIEV2ZW50IGVtaXR0ZWQgd2hlbiBhIHRyYW5zYWN0aW9uIGhhcyBiZWVuIGRpc3B1dGVkIGJ5IHRoZSBidXllci4KICBldmVudCBUcmFuc2FjdGlvbkRpc3B1dGVkKAogICAgdWludDI1NiBpbmRleGVkIGlkCiAgKTsKCiAgLy8gRXZlbnQgZW1pdHRlZCB3aGVuIGEgdHJhbnNhY3Rpb24gaXMgZXNjYWxhdGVkIHRvIHRoZSBtZWRpYXRvciBieSB0aGUKICAvLyBzZWxsZXIuCiAgZXZlbnQgVHJhbnNhY3Rpb25Fc2NhbGF0ZWQoCiAgICB1aW50MjU2IGluZGV4ZWQgaWQKICApOwoKICAvLyBFdmVudCBlbWl0dGVkIHdoZW4gYSB0cmFuc2FjdGlvbiBpcyByZXZva2VkIGJ5IHRoZSBzZWxsZXIuCiAgZXZlbnQgVHJhbnNhY3Rpb25SZXZva2VkKAogICAgdWludDI1NiBpbmRleGVkIGlkCiAgKTsKCiAgLy8gRXZlbnQgZW1pdHRlZCB3aGVuIGEgdHJhbnNhY3Rpb24gaXMgcmV2b2tlZCBieSB0aGUgc2VsbGVyLgogIGV2ZW50IFRyYW5zYWN0aW9uUmVmdW5kZWRCeU1lZGlhdG9yKAogICAgdWludDI1NiBpbmRleGVkIGlkLAogICAgdWludDI1NiBtZWRpYXRvckZlZQogICk7CgogIC8vIEV2ZW50IGVtaXR0ZWQgd2hlbiBhIHRyYW5zYWN0aW9uIGlzIHNldHRsZWQgYnkgdGhlIG1lZGlhdG9yLgogIGV2ZW50IFRyYW5zYWN0aW9uU2V0dGxlZEJ5TWVkaWF0b3IoCiAgICB1aW50MjU2IGluZGV4ZWQgaWQsCiAgICB1aW50MjU2IGJ1eWVyQW1vdW50LAogICAgdWludDI1NiBzZWxsZXJBbW91bnQsCiAgICB1aW50MjU2IGJ1eWVyTWVkaWF0b3JGZWUsCiAgICB1aW50MjU2IHNlbGxlck1lZGlhdG9yRmVlCiAgKTsKCiAgLy8gRXZlbnQgZW1pdHRlZCB3aGVuIGEgdHJhbnNhY3Rpb24gaXMgY29uZmlybWVkIGJ5IHRoZSBtZWRpYXRvci4KICBldmVudCBUcmFuc2FjdGlvbkNvbmZpcm1lZEJ5TWVkaWF0b3IoCiAgICB1aW50MjU2IGluZGV4ZWQgaWQsCiAgICB1aW50MjU2IG1lZGlhdG9yRmVlCiAgKTsKCiAgLy8gRXZlbnQgZW1pdHRlZCB3aGVuIGEgdHJhbnNhY3Rpb24gaXMgY29uZmlybWVkIGJ5IHRoZSBidXllci4KICBldmVudCBUcmFuc2FjdGlvbkNvbmZpcm1lZCgKICAgIHVpbnQyNTYgaW5kZXhlZCBpZCwKICAgIHVpbnQyNTYgbWVkaWF0b3JGZWUKICApOwoKICAvLyBFdmVudCBlbWl0dGVkIHdoZW4gYSB0cmFuc2FjdGlvbiBpcyByZWZ1bmRlZCBieSB0aGUgc2VsbGVyLgogIGV2ZW50IFRyYW5zYWN0aW9uUmVmdW5kZWQoCiAgICB1aW50MjU2IGluZGV4ZWQgaWQsCiAgICB1aW50MjU2IG1lZGlhdG9yRmVlCiAgKTsKCiAgLy8gRXZlbnQgZW1pdHRlZCB3aGVuIGEgdHJhbnNhY3Rpb24gaXMgY29uZmlybWVkIGJ5IHRoZSBzZWxsZXIgYWZ0ZXIgdGhlCiAgLy8gdHJhbnNhY3Rpb24gZXhwaXJ5LgogIGV2ZW50IFRyYW5zYWN0aW9uQ29uZmlybWVkQWZ0ZXJFeHBpcnkoCiAgICB1aW50MjU2IGluZGV4ZWQgaWQsCiAgICB1aW50MjU2IG1lZGlhdG9yRmVlCiAgKTsKCiAgLy8gRXZlbnQgZW1pdHRlZCB3aGVuIGEgdHJhbnNhY3Rpb24gaXMgY29uZmlybWVkIGJ5IHRoZSBidXllciBhZnRlciBpdCB3YXMKICAvLyBkaXNwdXRlZC4KICBldmVudCBUcmFuc2FjdGlvbkNvbmZpcm1lZEFmdGVyRGlzcHV0ZSgKICAgIHVpbnQyNTYgaW5kZXhlZCBpZCwKICAgIHVpbnQyNTYgbWVkaWF0b3JGZWUKICApOwoKICAvLyBFdmVudCBlbWl0dGVkIHdoZW4gYSB0cmFuc2FjdGlvbiBpcyByZWZ1bmRlZCBieSB0aGUgc2VsbGVyIGFmdGVyIGl0IHdhcwogIC8vIGRpc3B1dGVkLgogIGV2ZW50IFRyYW5zYWN0aW9uUmVmdW5kZWRBZnRlckRpc3B1dGUoCiAgICB1aW50MjU2IGluZGV4ZWQgaWQsCiAgICB1aW50MjU2IG1lZGlhdG9yRmVlCiAgKTsKCiAgLy8gRXZlbnQgZW1pdHRlZCB3aGVuIGEgdHJhbnNhY3Rpb24gaXMgcmVmdW5kZWQgYnkgdGhlIGJ1eWVyIGFmdGVyIHRoZQogIC8vIGVzY2FsYXRpb24gZXhwaXJ5LgogIGV2ZW50IFRyYW5zYWN0aW9uUmVmdW5kZWRBZnRlckV4cGlyeSgKICAgIHVpbnQyNTYgaW5kZXhlZCBpZCwKICAgIHVpbnQyNTYgbWVkaWF0b3JGZWUKICApOwoKICAvLyBFdmVudCBlbWl0dGVkIHdoZW4gYSB0cmFuc2FjdGlvbiBpcyBjb25maXJtZWQgYnkgdGhlIGJ1eWVyIGFmdGVyIHRoZQogIC8vIG1lZGlhdGlvbiBleHBpcnkuCiAgZXZlbnQgVHJhbnNhY3Rpb25Db25maXJtZWRBZnRlckVzY2FsYXRpb24oCiAgICB1aW50MjU2IGluZGV4ZWQgaWQKICApOwoKICAvLyBFdmVudCBlbWl0dGVkIHdoZW4gYSB0cmFuc2FjdGlvbiBpcyByZWZ1bmRlZCBieSB0aGUgc2VsbGVyIGFmdGVyIHRoZQogIC8vIG1lZGlhdGlvbiBleHBpcnkuCiAgZXZlbnQgVHJhbnNhY3Rpb25SZWZ1bmRlZEFmdGVyRXNjYWxhdGlvbigKICAgIHVpbnQyNTYgaW5kZXhlZCBpZAogICk7CgogIC8vIEV2ZW50IGVtaXR0ZWQgd2hlbiBhIHRyYW5zYWN0aW9uIGlzIHNldHRsZWQgYnkgZWl0aGVyIHRoZSBidXllciBvciB0aGUKICAvLyBzZWxsZXIgYWZ0ZXIgdGhlIG1lZGlhdGlvbiBleHBpcnkuCiAgZXZlbnQgVHJhbnNhY3Rpb25TZXR0bGVkKAogICAgdWludDI1NiBpbmRleGVkIGlkLAogICAgdWludDI1NiBidXllckFtb3VudCwKICAgIHVpbnQyNTYgc2VsbGVyQW1vdW50CiAgKTsKCiAgLy8gRXZlbnQgZW1pdHRlZCB3aGVuIGEgdHJhbnNhY3Rpb24ncyBmZWVkYmFjayBpcyB1cGRhdGVkIGJ5IHRoZSBidXllci4KICBldmVudCBGZWVkYmFja1VwZGF0ZWQoCiAgICB1aW50MjU2IGluZGV4ZWQgdHJhbnNhY3Rpb25JZCwKICAgIHVpbnQ4IHJhdGluZywKICAgIGJ5dGVzMzIgY29tbWVudAogICk7CgogIC8vIEV2ZW50IGVtaXR0ZWQgYW4gYWNjb3VudCBpcyAodW5pZGlyZWN0aW9uYWxseSkgbGlua2VkIHRvIGFub3RoZXIgYWNjb3VudC4KICAvLyBGb3IgdHdvIGFjY291bnRzIHRvIGJlIGFja25vd2xlZGdlZCBhcyBsaW5rZWQsIHRoZSBsaW5rYWdlIG11c3QgYmUKICAvLyBiaWRpcmVjdGlvbmFsLgogIGV2ZW50IEFjY291bnRMaW5rZWQoCiAgICBhZGRyZXNzIGluZGV4ZWQgZnJvbSwKICAgIGFkZHJlc3MgaW5kZXhlZCB0bwogICk7CgogIC8qIFByb3RvY29sICovCiAgZnVuY3Rpb24gbGluayhhZGRyZXNzIF90bykgZXh0ZXJuYWw7CiAgZnVuY3Rpb24gY3JlYXRlVHJhbnNhY3Rpb24oYWRkcmVzcyBfc2VsbGVyLCB1aW50MjU2IF9hbW91bnQsIGJ5dGVzMzIgX21ldGFkYXRhLCBhZGRyZXNzIF9wb2xpY3ksIGFkZHJlc3MgX21lZGlhdG9yKSBleHRlcm5hbCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiBjcmVhdGVUcmFuc2FjdGlvbihhZGRyZXNzIF9zZWxsZXIsIHVpbnQyNTYgX2Ftb3VudCwgYnl0ZXMzMiBfbWV0YWRhdGEsIGFkZHJlc3MgX3BvbGljeSwgYWRkcmVzcyBfbWVkaWF0b3IsIGFkZHJlc3MgX293bmVyKSBleHRlcm5hbCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiByZXZva2VUcmFuc2FjdGlvbih1aW50MjU2IF9pZCkgZXh0ZXJuYWw7CiAgZnVuY3Rpb24gYWNjZXB0VHJhbnNhY3Rpb24odWludDI1NiBfaWQpIGV4dGVybmFsOwogIGZ1bmN0aW9uIGNvbmZpcm1UcmFuc2FjdGlvbih1aW50MjU2IF9pZCkgZXh0ZXJuYWw7CiAgZnVuY3Rpb24gY29uZmlybVRyYW5zYWN0aW9uQWZ0ZXJFeHBpcnkodWludDI1NiBfaWQpIGV4dGVybmFsOwogIGZ1bmN0aW9uIHJlZnVuZFRyYW5zYWN0aW9uKHVpbnQyNTYgX2lkKSBleHRlcm5hbDsKICBmdW5jdGlvbiByZWZ1bmRUcmFuc2FjdGlvbkFmdGVyRXhwaXJ5KHVpbnQyNTYgX2lkKSBleHRlcm5hbDsKICBmdW5jdGlvbiBkaXNwdXRlVHJhbnNhY3Rpb24odWludDI1NiBfaWQpIGV4dGVybmFsOwogIGZ1bmN0aW9uIGVzY2FsYXRlRGlzcHV0ZVRvTWVkaWF0b3IodWludDI1NiBfaWQpIGV4dGVybmFsOwogIGZ1bmN0aW9uIHNldHRsZVRyYW5zYWN0aW9uKHVpbnQyNTYgX2lkKSBleHRlcm5hbDsKICBmdW5jdGlvbiByZWZ1bmRUcmFuc2FjdGlvbkJ5TWVkaWF0b3IodWludDI1NiBfaWQpIGV4dGVybmFsOwogIGZ1bmN0aW9uIGNvbmZpcm1UcmFuc2FjdGlvbkJ5TWVkaWF0b3IodWludDI1NiBfaWQpIGV4dGVybmFsOwogIGZ1bmN0aW9uIHNldHRsZVRyYW5zYWN0aW9uQnlNZWRpYXRvcih1aW50MjU2IF9pZCwgdWludDI1NiBfYnV5ZXJBbW91bnQsIHVpbnQyNTYgX3NlbGxlckFtb3VudCkgZXh0ZXJuYWw7CiAgZnVuY3Rpb24gcHJvdmlkZVRyYW5zYWN0aW9uRmVlZGJhY2sodWludDI1NiBfaWQsIHVpbnQ4IF9yYXRpbmcsIGJ5dGVzMzIgX2NvbW1lbnQpIGV4dGVybmFsOwoKICAvKiBFUkMyMCAqLwogIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gaW5jcmVhc2VBcHByb3ZhbChhZGRyZXNzIHNwZW5kZXIsIHVpbnQgYWRkZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGZ1bmN0aW9uIGRlY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBzcGVuZGVyLCB1aW50IHN1YnRyYWN0ZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwp9CgovLyBGaWxlOiB6ZXBwZWxpbi1zb2xpZGl0eS9jb250cmFjdHMvbWF0aC9TYWZlTWF0aC5zb2wKCi8qKgogKiBAdGl0bGUgU2FmZU1hdGgKICogQGRldiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzIHRoYXQgdGhyb3cgb24gZXJyb3IKICovCmxpYnJhcnkgU2FmZU1hdGggewoKICAvKioKICAqIEBkZXYgTXVsdGlwbGllcyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93LgogICovCiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGlmIChhID09IDApIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgLyoqCiAgKiBAZGV2IEludGVnZXIgZGl2aXNpb24gb2YgdHdvIG51bWJlcnMsIHRydW5jYXRpbmcgdGhlIHF1b3RpZW50LgogICovCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICAvKioKICAqIEBkZXYgU3Vic3RyYWN0cyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93IChpLmUuIGlmIHN1YnRyYWhlbmQgaXMgZ3JlYXRlciB0aGFuIG1pbnVlbmQpLgogICovCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgLyoqCiAgKiBAZGV2IEFkZHMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdy4KICAqLwogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQp9CgovLyBGaWxlOiB6ZXBwZWxpbi1zb2xpZGl0eS9jb250cmFjdHMvdG9rZW4vRVJDMjAvRVJDMjBCYXNpYy5zb2wKCi8qKgogKiBAdGl0bGUgRVJDMjBCYXNpYwogKiBAZGV2IFNpbXBsZXIgdmVyc2lvbiBvZiBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE3OQogKi8KY29udHJhY3QgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKfQoKLy8gRmlsZTogemVwcGVsaW4tc29saWRpdHkvY29udHJhY3RzL3Rva2VuL0VSQzIwL0Jhc2ljVG9rZW4uc29sCgovKioKICogQHRpdGxlIEJhc2ljIHRva2VuCiAqIEBkZXYgQmFzaWMgdmVyc2lvbiBvZiBTdGFuZGFyZFRva2VuLCB3aXRoIG5vIGFsbG93YW5jZXMuCiAqLwpjb250cmFjdCBCYXNpY1Rva2VuIGlzIEVSQzIwQmFzaWMgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CgogIHVpbnQyNTYgdG90YWxTdXBwbHlfOwoKICAvKioKICAqIEBkZXYgdG90YWwgbnVtYmVyIG9mIHRva2VucyBpbiBleGlzdGVuY2UKICAqLwogIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHRvdGFsU3VwcGx5XzsKICB9CgogIC8qKgogICogQGRldiB0cmFuc2ZlciB0b2tlbiBmb3IgYSBzcGVjaWZpZWQgYWRkcmVzcwogICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0by4KICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCB0byBiZSB0cmFuc2ZlcnJlZC4KICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgcmVxdWlyZShfdmFsdWUgPD0gYmFsYW5jZXNbbXNnLnNlbmRlcl0pOwoKICAgIC8vIFNhZmVNYXRoLnN1YiB3aWxsIHRocm93IGlmIHRoZXJlIGlzIG5vdCBlbm91Z2ggYmFsYW5jZS4KICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgKiBAZGV2IEdldHMgdGhlIGJhbGFuY2Ugb2YgdGhlIHNwZWNpZmllZCBhZGRyZXNzLgogICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0byBxdWVyeSB0aGUgdGhlIGJhbGFuY2Ugb2YuCiAgKiBAcmV0dXJuIEFuIHVpbnQyNTYgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb3duZWQgYnkgdGhlIHBhc3NlZCBhZGRyZXNzLgogICovCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogIH0KCn0KCi8vIEZpbGU6IHplcHBlbGluLXNvbGlkaXR5L2NvbnRyYWN0cy90b2tlbi9FUkMyMC9FUkMyMC5zb2wKCi8qKgogKiBAdGl0bGUgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7Cn0KCi8vIEZpbGU6IHplcHBlbGluLXNvbGlkaXR5L2NvbnRyYWN0cy90b2tlbi9FUkMyMC9TdGFuZGFyZFRva2VuLnNvbAoKLyoqCiAqIEB0aXRsZSBTdGFuZGFyZCBFUkMyMCB0b2tlbgogKgogKiBAZGV2IEltcGxlbWVudGF0aW9uIG9mIHRoZSBiYXNpYyBzdGFuZGFyZCB0b2tlbi4KICogQGRldiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICogQGRldiBCYXNlZCBvbiBjb2RlIGJ5IEZpcnN0Qmxvb2Q6IGh0dHBzOi8vZ2l0aHViLmNvbS9GaXJzdGJsb29kaW8vdG9rZW4vYmxvYi9tYXN0ZXIvc21hcnRfY29udHJhY3QvRmlyc3RCbG9vZFRva2VuLnNvbAogKi8KY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBFUkMyMCwgQmFzaWNUb2tlbiB7CgogIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgaW50ZXJuYWwgYWxsb3dlZDsKCgogIC8qKgogICAqIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlcgogICAqIEBwYXJhbSBfZnJvbSBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20KICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gdHJhbnNmZXIgdG8KICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgdGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICByZXF1aXJlKF92YWx1ZSA8PSBiYWxhbmNlc1tfZnJvbV0pOwogICAgcmVxdWlyZShfdmFsdWUgPD0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0pOwoKICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgQXBwcm92ZSB0aGUgcGFzc2VkIGFkZHJlc3MgdG8gc3BlbmQgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIG9uIGJlaGFsZiBvZiBtc2cuc2VuZGVyLgogICAqCiAgICogQmV3YXJlIHRoYXQgY2hhbmdpbmcgYW4gYWxsb3dhbmNlIHdpdGggdGhpcyBtZXRob2QgYnJpbmdzIHRoZSByaXNrIHRoYXQgc29tZW9uZSBtYXkgdXNlIGJvdGggdGhlIG9sZAogICAqIGFuZCB0aGUgbmV3IGFsbG93YW5jZSBieSB1bmZvcnR1bmF0ZSB0cmFuc2FjdGlvbiBvcmRlcmluZy4gT25lIHBvc3NpYmxlIHNvbHV0aW9uIHRvIG1pdGlnYXRlIHRoaXMKICAgKiByYWNlIGNvbmRpdGlvbiBpcyB0byBmaXJzdCByZWR1Y2UgdGhlIHNwZW5kZXIncyBhbGxvd2FuY2UgdG8gMCBhbmQgc2V0IHRoZSBkZXNpcmVkIHZhbHVlIGFmdGVyd2FyZHM6CiAgICogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAgKi8KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBjaGVjayB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAqIEBwYXJhbSBfb3duZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCBvd25zIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3NwZW5kZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcmV0dXJuIEEgdWludDI1NiBzcGVjaWZ5aW5nIHRoZSBhbW91bnQgb2YgdG9rZW5zIHN0aWxsIGF2YWlsYWJsZSBmb3IgdGhlIHNwZW5kZXIuCiAgICovCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICB9CgogIC8qKgogICAqIEBkZXYgSW5jcmVhc2UgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKgogICAqIGFwcHJvdmUgc2hvdWxkIGJlIGNhbGxlZCB3aGVuIGFsbG93ZWRbX3NwZW5kZXJdID09IDAuIFRvIGluY3JlbWVudAogICAqIGFsbG93ZWQgdmFsdWUgaXMgYmV0dGVyIHRvIHVzZSB0aGlzIGZ1bmN0aW9uIHRvIGF2b2lkIDIgY2FsbHMgKGFuZCB3YWl0IHVudGlsCiAgICogdGhlIGZpcnN0IHRyYW5zYWN0aW9uIGlzIG1pbmVkKQogICAqIEZyb20gTW9ub2xpdGhEQU8gVG9rZW4uc29sCiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfYWRkZWRWYWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBpbmNyZWFzZSB0aGUgYWxsb3dhbmNlIGJ5LgogICAqLwogIGZ1bmN0aW9uIGluY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYWRkZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0uYWRkKF9hZGRlZFZhbHVlKTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRGVjcmVhc2UgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKgogICAqIGFwcHJvdmUgc2hvdWxkIGJlIGNhbGxlZCB3aGVuIGFsbG93ZWRbX3NwZW5kZXJdID09IDAuIFRvIGRlY3JlbWVudAogICAqIGFsbG93ZWQgdmFsdWUgaXMgYmV0dGVyIHRvIHVzZSB0aGlzIGZ1bmN0aW9uIHRvIGF2b2lkIDIgY2FsbHMgKGFuZCB3YWl0IHVudGlsCiAgICogdGhlIGZpcnN0IHRyYW5zYWN0aW9uIGlzIG1pbmVkKQogICAqIEZyb20gTW9ub2xpdGhEQU8gVG9rZW4uc29sCiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfc3VidHJhY3RlZFZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGRlY3JlYXNlIHRoZSBhbGxvd2FuY2UgYnkuCiAgICovCiAgZnVuY3Rpb24gZGVjcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9zdWJ0cmFjdGVkVmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICB1aW50IG9sZFZhbHVlID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl07CiAgICBpZiAoX3N1YnRyYWN0ZWRWYWx1ZSA+IG9sZFZhbHVlKSB7CiAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gMDsKICAgIH0gZWxzZSB7CiAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gb2xkVmFsdWUuc3ViKF9zdWJ0cmFjdGVkVmFsdWUpOwogICAgfQogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgIHJldHVybiB0cnVlOwogIH0KCn0KCi8vIEZpbGU6IGNvbnRyYWN0cy9JbmtQcm90b2NvbENvcmUuc29sCgovLy8gQHRpdGxlIEluayBQcm90b2NvbDogRGVjZW50cmFsaXplZCByZXB1dGF0aW9uIGFuZCBwYXltZW50cyBmb3IgcGVlci10by1wZWVyIG1hcmtldHBsYWNlcy4KY29udHJhY3QgSW5rUHJvdG9jb2xDb3JlIGlzIElua1Byb3RvY29sSW50ZXJmYWNlLCBTdGFuZGFyZFRva2VuIHsKICBzdHJpbmcgcHVibGljIGNvbnN0YW50IG5hbWUgPSAiSW5rIFByb3RvY29sIjsKICBzdHJpbmcgcHVibGljIGNvbnN0YW50IHN5bWJvbCA9ICJYTksiOwogIHVpbnQ4IHB1YmxpYyBjb25zdGFudCBkZWNpbWFscyA9IDE4OwoKICB1aW50MjU2IHByaXZhdGUgY29uc3RhbnQgZ2FzTGltaXRGb3JFeHBpcnlDYWxsID0gMTAwMDAwMDsKICB1aW50MjU2IHByaXZhdGUgY29uc3RhbnQgZ2FzTGltaXRGb3JNZWRpYXRvckNhbGwgPSA0MDAwMDAwOwoKICBlbnVtIEV4cGlyeSB7CiAgICBUcmFuc2FjdGlvbiwgLy8gMAogICAgRnVsZmlsbG1lbnQsIC8vIDEKICAgIEVzY2FsYXRpb24sICAvLyAyCiAgICBNZWRpYXRpb24gICAgLy8gMwogIH0KCiAgZW51bSBUcmFuc2FjdGlvblN0YXRlIHsKICAgIC8vIFRoaXMgaXMgYW4gaW50ZXJuYWwgc3RhdGUgdG8gcmVwcmVzZW50IGFuIHVuaW5pdGlhbGl6ZWQgdHJhbnNhY3Rpb24uCiAgICBOdWxsLCAgICAgICAgICAgICAgICAgICAgIC8vIDAKCiAgICBJbml0aWF0ZWQsICAgICAgICAgICAgICAgIC8vIDEKICAgIEFjY2VwdGVkLCAgICAgICAgICAgICAgICAgLy8gMgogICAgRGlzcHV0ZWQsICAgICAgICAgICAgICAgICAvLyAzCiAgICBFc2NhbGF0ZWQsICAgICAgICAgICAgICAgIC8vIDQKICAgIFJldm9rZWQsICAgICAgICAgICAgICAgICAgLy8gNQogICAgUmVmdW5kZWRCeU1lZGlhdG9yLCAgICAgICAvLyA2CiAgICBTZXR0bGVkQnlNZWRpYXRvciwgICAgICAgIC8vIDcKICAgIENvbmZpcm1lZEJ5TWVkaWF0b3IsICAgICAgLy8gOAogICAgQ29uZmlybWVkLCAgICAgICAgICAgICAgICAvLyA5CiAgICBSZWZ1bmRlZCwgICAgICAgICAgICAgICAgIC8vIDEwCiAgICBDb25maXJtZWRBZnRlckV4cGlyeSwgICAgIC8vIDExCiAgICBDb25maXJtZWRBZnRlckRpc3B1dGUsICAgIC8vIDEyCiAgICBSZWZ1bmRlZEFmdGVyRGlzcHV0ZSwgICAgIC8vIDEzCiAgICBSZWZ1bmRlZEFmdGVyRXhwaXJ5LCAgICAgIC8vIDE0CiAgICBDb25maXJtZWRBZnRlckVzY2FsYXRpb24sIC8vIDE1CiAgICBSZWZ1bmRlZEFmdGVyRXNjYWxhdGlvbiwgIC8vIDE2CiAgICBTZXR0bGVkICAgICAgICAgICAgICAgICAgIC8vIDE3CiAgfQoKICAvLyBUaGUgcnVubmluZyBJRCBjb3VudGVyIGZvciBhbGwgSW5rIFRyYW5zYWN0aW9ucy4KICB1aW50MjU2IHByaXZhdGUgZ2xvYmFsVHJhbnNhY3Rpb25JZCA9IDA7CgogIC8vIE1hcHBpbmcgb2YgYWxsIHRyYW5zYWN0aW9ucyBieSBJRCAoZ2xvYmFsVHJhbnNhY3Rpb25JZCkuCiAgbWFwcGluZyh1aW50MjU2ID0+IFRyYW5zYWN0aW9uKSBpbnRlcm5hbCB0cmFuc2FjdGlvbnM7CgogIC8vIFRoZSBzdHJ1Y3QgZGVmaW5pdGlvbiBmb3IgYW4gSW5rIFRyYW5zYWN0aW9uLgogIHN0cnVjdCBUcmFuc2FjdGlvbiB7CiAgICAvLyBUaGUgYWRkcmVzcyBvZiB0aGUgYnV5ZXIgb24gdGhlIHRyYW5zYWN0aW9uLgogICAgYWRkcmVzcyBidXllcjsKICAgIC8vIFRoZSBhZGRyZXNzIG9mIHRoZSBzZWxsZXIgb24gdGhlIHRyYW5zYWN0aW9uLgogICAgYWRkcmVzcyBzZWxsZXI7CiAgICAvLyBUaGUgYWRkcmVzcyBvZiB0aGUgcG9saWN5IGNvbnRyYWN0IGZvciB0aGUgdHJhbnNhY3Rpb24uCiAgICBhZGRyZXNzIHBvbGljeTsKICAgIC8vIFRoZSBhZGRyZXNzIG9mIHRoZSBtZWRpYXRvciBjb250cmFjdCBmb3IgdGhlIHRyYW5zYWN0aW9uLgogICAgYWRkcmVzcyBtZWRpYXRvcjsKICAgIC8vIFRoZSBzdGF0ZSBvZiB0aGUgdHJhbnNhY3Rpb24uCiAgICBUcmFuc2FjdGlvblN0YXRlIHN0YXRlOwogICAgLy8gVGhlIChibG9jaykgdGltZSB0aGF0IHRoZSB0cmFuc2FjdGlvbiB0cmFuc2l0aW9uZWQgdG8gaXRzIGN1cnJlbnQgc3RhdGUuCiAgICAvLyBUaGlzIHZhbHVlIGlzIG9ubHkgc2V0IGZvciB0aGUgc3RhdGVzIHRoYXQgbmVlZCBpdCB0byBiZSBzZXQgKHN0YXRlcwogICAgLy8gd2l0aCBhbiBleHBpcnkgaW52b2x2ZWQpLgogICAgdWludDI1NiBzdGF0ZVRpbWU7CiAgICAvLyBUaGUgWE5LIGFtb3VudCBvZiB0aGUgdHJhbnNhY3Rpb24uCiAgICB1aW50MjU2IGFtb3VudDsKICB9CgoKICAvKgogICAgQ29uc3RydWN0b3IKICAqLwoKICBmdW5jdGlvbiBJbmtQcm90b2NvbENvcmUoKSBpbnRlcm5hbCB7CiAgICAvLyBTdGFydCB3aXRoIGEgdG90YWwgc3VwcGx5IG9mIDUwMCwwMDAsMDAwIEluayBUb2tlbnMgKFhOSykuCiAgICB0b3RhbFN1cHBseV8gPSA1MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDA7CiAgfQoKCiAgLyoKICAgIEVSQzIwIG92ZXJyaWRlIGZ1bmN0aW9ucwogICovCgogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgLy8gRG9uJ3QgYWxsb3cgdG9rZW4gdHJhbnNmZXJzIHRvIHRoZSBJbmsgY29udHJhY3QuCiAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3ModGhpcykpOwoKICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyKF90bywgX3ZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgIC8vIERvbid0IGFsbG93IHRva2VuIHRyYW5zZmVycyB0byB0aGUgSW5rIGNvbnRyYWN0LgogICByZXF1aXJlKF90byAhPSBhZGRyZXNzKHRoaXMpKTsKCiAgIHJldHVybiBzdXBlci50cmFuc2ZlckZyb20oX2Zyb20sIF90bywgX3ZhbHVlKTsKICB9CgoKICAvKgogICAgQWNjb3VudCBsaW5raW5nIGZ1bmN0aW9ucwoKICAgIEZ1bmN0aW9ucyB1c2VkIGJ5IHVzZXJzIGFuZCBhZ2VudHMgdG8gZGVjbGFyZSBhIHVuaWRpcmVjdGlvbmFsbHkgYWNjb3VudAogICAgbGlua2luZy4KICAqLwoKICAvLyBDYWxsZWQgYnkgYSB1c2VyIHdobyB3aXNoZXMgdG8gbGluayB3aXRoIGFub3RoZXIgX2FjY291bnQuCiAgZnVuY3Rpb24gbGluayhhZGRyZXNzIF90bykgZXh0ZXJuYWwgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICByZXF1aXJlKF90byAhPSBtc2cuc2VuZGVyKTsKCiAgICBBY2NvdW50TGlua2VkKHsKICAgICAgZnJvbTogbXNnLnNlbmRlciwKICAgICAgdG86IF90bwogICAgfSk7CiAgfQoKCiAgLyoKICAgIFRyYW5zYWN0aW9uIGZ1bmN0aW9ucwogICovCgogIGZ1bmN0aW9uIGNyZWF0ZVRyYW5zYWN0aW9uKGFkZHJlc3MgX3NlbGxlciwgdWludDI1NiBfYW1vdW50LCBieXRlczMyIF9tZXRhZGF0YSwgYWRkcmVzcyBfcG9saWN5LCBhZGRyZXNzIF9tZWRpYXRvcikgZXh0ZXJuYWwgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIF9jcmVhdGVUcmFuc2FjdGlvbihfc2VsbGVyLCBfYW1vdW50LCBfbWV0YWRhdGEsIF9wb2xpY3ksIF9tZWRpYXRvciwgYWRkcmVzcygwKSk7CiAgfQoKICBmdW5jdGlvbiBjcmVhdGVUcmFuc2FjdGlvbihhZGRyZXNzIF9zZWxsZXIsIHVpbnQyNTYgX2Ftb3VudCwgYnl0ZXMzMiBfbWV0YWRhdGEsIGFkZHJlc3MgX3BvbGljeSwgYWRkcmVzcyBfbWVkaWF0b3IsIGFkZHJlc3MgX293bmVyKSBleHRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gX2NyZWF0ZVRyYW5zYWN0aW9uKF9zZWxsZXIsIF9hbW91bnQsIF9tZXRhZGF0YSwgX3BvbGljeSwgX21lZGlhdG9yLCBfb3duZXIpOwogIH0KCiAgZnVuY3Rpb24gcmV2b2tlVHJhbnNhY3Rpb24odWludDI1NiBfaWQpIGV4dGVybmFsIHsKICAgIF9yZXZva2VUcmFuc2FjdGlvbihfaWQsIF9maW5kVHJhbnNhY3Rpb25Gb3JCdXllcihfaWQpKTsKICB9CgogIGZ1bmN0aW9uIGFjY2VwdFRyYW5zYWN0aW9uKHVpbnQyNTYgX2lkKSBleHRlcm5hbCB7CiAgICBfYWNjZXB0VHJhbnNhY3Rpb24oX2lkLCBfZmluZFRyYW5zYWN0aW9uRm9yU2VsbGVyKF9pZCkpOwogIH0KCiAgZnVuY3Rpb24gY29uZmlybVRyYW5zYWN0aW9uKHVpbnQyNTYgX2lkKSBleHRlcm5hbCB7CiAgICBfY29uZmlybVRyYW5zYWN0aW9uKF9pZCwgX2ZpbmRUcmFuc2FjdGlvbkZvckJ1eWVyKF9pZCkpOwogIH0KCiAgZnVuY3Rpb24gY29uZmlybVRyYW5zYWN0aW9uQWZ0ZXJFeHBpcnkodWludDI1NiBfaWQpIGV4dGVybmFsIHsKICAgIF9jb25maXJtVHJhbnNhY3Rpb25BZnRlckV4cGlyeShfaWQsIF9maW5kVHJhbnNhY3Rpb25Gb3JTZWxsZXIoX2lkKSk7CiAgfQoKICBmdW5jdGlvbiByZWZ1bmRUcmFuc2FjdGlvbih1aW50MjU2IF9pZCkgZXh0ZXJuYWwgewogICAgX3JlZnVuZFRyYW5zYWN0aW9uKF9pZCwgX2ZpbmRUcmFuc2FjdGlvbkZvclNlbGxlcihfaWQpKTsKICB9CgogIGZ1bmN0aW9uIHJlZnVuZFRyYW5zYWN0aW9uQWZ0ZXJFeHBpcnkodWludDI1NiBfaWQpIGV4dGVybmFsIHsKICAgIF9yZWZ1bmRUcmFuc2FjdGlvbkFmdGVyRXhwaXJ5KF9pZCwgX2ZpbmRUcmFuc2FjdGlvbkZvckJ1eWVyKF9pZCkpOwogIH0KCiAgZnVuY3Rpb24gZGlzcHV0ZVRyYW5zYWN0aW9uKHVpbnQyNTYgX2lkKSBleHRlcm5hbCB7CiAgICBfZGlzcHV0ZVRyYW5zYWN0aW9uKF9pZCwgX2ZpbmRUcmFuc2FjdGlvbkZvckJ1eWVyKF9pZCkpOwogIH0KCiAgZnVuY3Rpb24gZXNjYWxhdGVEaXNwdXRlVG9NZWRpYXRvcih1aW50MjU2IF9pZCkgZXh0ZXJuYWwgewogICAgX2VzY2FsYXRlRGlzcHV0ZVRvTWVkaWF0b3IoX2lkLCBfZmluZFRyYW5zYWN0aW9uRm9yU2VsbGVyKF9pZCkpOwogIH0KCiAgZnVuY3Rpb24gc2V0dGxlVHJhbnNhY3Rpb24odWludDI1NiBfaWQpIGV4dGVybmFsIHsKICAgIF9zZXR0bGVUcmFuc2FjdGlvbihfaWQsIF9maW5kVHJhbnNhY3Rpb25Gb3JQYXJ0eShfaWQpKTsKICB9CgogIGZ1bmN0aW9uIHJlZnVuZFRyYW5zYWN0aW9uQnlNZWRpYXRvcih1aW50MjU2IF9pZCkgZXh0ZXJuYWwgewogICAgX3JlZnVuZFRyYW5zYWN0aW9uQnlNZWRpYXRvcihfaWQsIF9maW5kVHJhbnNhY3Rpb25Gb3JNZWRpYXRvcihfaWQpKTsKICB9CgogIGZ1bmN0aW9uIGNvbmZpcm1UcmFuc2FjdGlvbkJ5TWVkaWF0b3IodWludDI1NiBfaWQpIGV4dGVybmFsIHsKICAgIF9jb25maXJtVHJhbnNhY3Rpb25CeU1lZGlhdG9yKF9pZCwgX2ZpbmRUcmFuc2FjdGlvbkZvck1lZGlhdG9yKF9pZCkpOwogIH0KCiAgZnVuY3Rpb24gc2V0dGxlVHJhbnNhY3Rpb25CeU1lZGlhdG9yKHVpbnQyNTYgX2lkLCB1aW50MjU2IF9idXllckFtb3VudCwgdWludDI1NiBfc2VsbGVyQW1vdW50KSBleHRlcm5hbCB7CiAgICBfc2V0dGxlVHJhbnNhY3Rpb25CeU1lZGlhdG9yKF9pZCwgX2ZpbmRUcmFuc2FjdGlvbkZvck1lZGlhdG9yKF9pZCksIF9idXllckFtb3VudCwgX3NlbGxlckFtb3VudCk7CiAgfQoKICBmdW5jdGlvbiBwcm92aWRlVHJhbnNhY3Rpb25GZWVkYmFjayh1aW50MjU2IF9pZCwgdWludDggX3JhdGluZywgYnl0ZXMzMiBfY29tbWVudCkgZXh0ZXJuYWwgewogICAgX3Byb3ZpZGVUcmFuc2FjdGlvbkZlZWRiYWNrKF9pZCwgX2ZpbmRUcmFuc2FjdGlvbkZvckJ1eWVyKF9pZCksIF9yYXRpbmcsIF9jb21tZW50KTsKICB9CgoKICAvKgogICAgUHJpdmF0ZSBmdW5jdGlvbnMKICAqLwoKICBmdW5jdGlvbiBfY3JlYXRlVHJhbnNhY3Rpb24oYWRkcmVzcyBfc2VsbGVyLCB1aW50MjU2IF9hbW91bnQsIGJ5dGVzMzIgX21ldGFkYXRhLCBhZGRyZXNzIF9wb2xpY3ksIGFkZHJlc3MgX21lZGlhdG9yLCBhZGRyZXNzIF9vd25lcikgcHJpdmF0ZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXF1aXJlKF9zZWxsZXIgIT0gYWRkcmVzcygwKSAmJiBfc2VsbGVyICE9IG1zZy5zZW5kZXIpOwogICAgcmVxdWlyZShfb3duZXIgIT0gbXNnLnNlbmRlciAmJiBfb3duZXIgIT0gX3NlbGxlcik7CiAgICByZXF1aXJlKF9hbW91bnQgPiAwKTsKCiAgICAvLyBQZXIgc3BlY2lmaWNhdGlvbnMsIGlmIGEgbWVkaWF0b3IgaXMgaW52b2x2ZWQgdGhlbiBhIHBvbGljeSBpcyByZXF1aXJlZC4KICAgIC8vIE90aGVyd2lzZSwgcG9saWN5IG11c3QgYmUgYSB6ZXJvIGFkZHJlc3MuCiAgICBpZiAoX21lZGlhdG9yID09IGFkZHJlc3MoMCkpIHsKICAgICAgcmVxdWlyZShfcG9saWN5ID09IGFkZHJlc3MoMCkpOwogICAgfSBlbHNlIHsKICAgICAgcmVxdWlyZShfcG9saWN5ICE9IGFkZHJlc3MoMCkpOwogICAgfQoKICAgIC8vIEluY3JlbWVudCB0aGUgdHJhbnNhY3Rpb24uCiAgICB1aW50MjU2IGlkID0gZ2xvYmFsVHJhbnNhY3Rpb25JZCsrOwoKICAgIC8vIENyZWF0ZSB0aGUgdHJhbnNhY3Rpb24uCiAgICBUcmFuc2FjdGlvbiBzdG9yYWdlIHRyYW5zYWN0aW9uID0gdHJhbnNhY3Rpb25zW2lkXTsKICAgIHRyYW5zYWN0aW9uLmJ1eWVyID0gbXNnLnNlbmRlcjsKICAgIHRyYW5zYWN0aW9uLnNlbGxlciA9IF9zZWxsZXI7CiAgICB0cmFuc2FjdGlvbi5zdGF0ZSA9IFRyYW5zYWN0aW9uU3RhdGUuSW5pdGlhdGVkOwogICAgdHJhbnNhY3Rpb24uYW1vdW50ID0gX2Ftb3VudDsKICAgIHRyYW5zYWN0aW9uLnBvbGljeSA9IF9wb2xpY3k7CgogICAgX3Jlc29sdmVNZWRpYXRvcihpZCwgdHJhbnNhY3Rpb24sIF9tZWRpYXRvciwgX293bmVyKTsKICAgIF9yZXNvbHZlT3duZXIoaWQsIF9vd25lcik7CgogICAgLy8gRW1pdCB0aGUgZXZlbnQuCiAgICBUcmFuc2FjdGlvbkluaXRpYXRlZCh7CiAgICAgIGlkOiBpZCwKICAgICAgb3duZXI6IF9vd25lciwKICAgICAgYnV5ZXI6IG1zZy5zZW5kZXIsCiAgICAgIHNlbGxlcjogX3NlbGxlciwKICAgICAgcG9saWN5OiBfcG9saWN5LAogICAgICBtZWRpYXRvcjogX21lZGlhdG9yLAogICAgICBhbW91bnQ6IF9hbW91bnQsCiAgICAgIG1ldGFkYXRhOiBfbWV0YWRhdGEKICAgIH0pOwoKICAgIC8vIFBsYWNlIHRoZSBidXllcidzIHRva2VucyBpbiBlc2Nyb3cgKGllLiB0aGlzIGNvbnRyYWN0KS4KICAgIF90cmFuc2ZlckZyb20obXNnLnNlbmRlciwgdGhpcywgX2Ftb3VudCk7CgogICAgLy8gUmV0dXJuIHRoZSBuZXdseSBjcmVhdGVkIHRyYW5zYWN0aW9uJ3MgaWQuCiAgICByZXR1cm4gaWQ7CiAgfQoKICBmdW5jdGlvbiBfcmV2b2tlVHJhbnNhY3Rpb24odWludDI1NiBfaWQsIFRyYW5zYWN0aW9uIHN0b3JhZ2UgX3RyYW5zYWN0aW9uKSBwcml2YXRlIHsKICAgIHJlcXVpcmUoX3RyYW5zYWN0aW9uLnN0YXRlID09IFRyYW5zYWN0aW9uU3RhdGUuSW5pdGlhdGVkKTsKCiAgICBUcmFuc2FjdGlvblJldm9rZWQoeyBpZDogX2lkIH0pOwoKICAgIF90cmFuc2ZlckZyb21Fc2Nyb3coX3RyYW5zYWN0aW9uLmJ1eWVyLCBfdHJhbnNhY3Rpb24uYW1vdW50KTsKCiAgICBfY2xlYW51cFRyYW5zYWN0aW9uKF9pZCwgX3RyYW5zYWN0aW9uLCBmYWxzZSk7CiAgfQoKICBmdW5jdGlvbiBfYWNjZXB0VHJhbnNhY3Rpb24odWludDI1NiBfaWQsIFRyYW5zYWN0aW9uIHN0b3JhZ2UgX3RyYW5zYWN0aW9uKSBwcml2YXRlIHsKICAgIHJlcXVpcmUoX3RyYW5zYWN0aW9uLnN0YXRlID09IFRyYW5zYWN0aW9uU3RhdGUuSW5pdGlhdGVkKTsKCiAgICBpZiAoX3RyYW5zYWN0aW9uLm1lZGlhdG9yICE9IGFkZHJlc3MoMCkpIHsKICAgICAgX3VwZGF0ZVRyYW5zYWN0aW9uU3RhdGUoX3RyYW5zYWN0aW9uLCBUcmFuc2FjdGlvblN0YXRlLkFjY2VwdGVkKTsKICAgIH0KCiAgICBUcmFuc2FjdGlvbkFjY2VwdGVkKHsgaWQ6IF9pZCB9KTsKCiAgICBpZiAoX3RyYW5zYWN0aW9uLm1lZGlhdG9yID09IGFkZHJlc3MoMCkpIHsKICAgICAgLy8gSWYgdGhlcmUgaXMgbm8gbWVkaWF0b3IgaW52b2x2ZWQsIHRoZSB0cmFuc2FjdGlvbiBpcyBpbW1lZGlhdGVseSBjb25maXJtZWQuCiAgICAgIF9jb21wbGV0ZVRyYW5zYWN0aW9uKF9pZCwgX3RyYW5zYWN0aW9uLCBUcmFuc2FjdGlvblN0YXRlLkNvbmZpcm1lZCwgX3RyYW5zYWN0aW9uLnNlbGxlcik7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBfY29uZmlybVRyYW5zYWN0aW9uKHVpbnQyNTYgX2lkLCBUcmFuc2FjdGlvbiBzdG9yYWdlIF90cmFuc2FjdGlvbikgcHJpdmF0ZSB7CiAgICBUcmFuc2FjdGlvblN0YXRlIGZpbmFsU3RhdGU7CgogICAgaWYgKF90cmFuc2FjdGlvbi5zdGF0ZSA9PSBUcmFuc2FjdGlvblN0YXRlLkFjY2VwdGVkKSB7CiAgICAgIGZpbmFsU3RhdGUgPSBUcmFuc2FjdGlvblN0YXRlLkNvbmZpcm1lZDsKICAgIH0gZWxzZSBpZiAoX3RyYW5zYWN0aW9uLnN0YXRlID09IFRyYW5zYWN0aW9uU3RhdGUuRGlzcHV0ZWQpIHsKICAgICAgZmluYWxTdGF0ZSA9IFRyYW5zYWN0aW9uU3RhdGUuQ29uZmlybWVkQWZ0ZXJEaXNwdXRlOwogICAgfSBlbHNlIGlmIChfdHJhbnNhY3Rpb24uc3RhdGUgPT0gVHJhbnNhY3Rpb25TdGF0ZS5Fc2NhbGF0ZWQpIHsKICAgICAgcmVxdWlyZShfYWZ0ZXJFeHBpcnkoX3RyYW5zYWN0aW9uLCBfZmV0Y2hFeHBpcnkoX3RyYW5zYWN0aW9uLCBFeHBpcnkuTWVkaWF0aW9uKSkpOwogICAgICBmaW5hbFN0YXRlID0gVHJhbnNhY3Rpb25TdGF0ZS5Db25maXJtZWRBZnRlckVzY2FsYXRpb247CiAgICB9IGVsc2UgewogICAgICByZXZlcnQoKTsKICAgIH0KCiAgICBfY29tcGxldGVUcmFuc2FjdGlvbihfaWQsIF90cmFuc2FjdGlvbiwgZmluYWxTdGF0ZSwgX3RyYW5zYWN0aW9uLnNlbGxlcik7CiAgfQoKICBmdW5jdGlvbiBfY29uZmlybVRyYW5zYWN0aW9uQWZ0ZXJFeHBpcnkodWludDI1NiBfaWQsIFRyYW5zYWN0aW9uIHN0b3JhZ2UgX3RyYW5zYWN0aW9uKSBwcml2YXRlIHsKICAgIHJlcXVpcmUoX3RyYW5zYWN0aW9uLnN0YXRlID09IFRyYW5zYWN0aW9uU3RhdGUuQWNjZXB0ZWQpOwogICAgcmVxdWlyZShfYWZ0ZXJFeHBpcnkoX3RyYW5zYWN0aW9uLCBfZmV0Y2hFeHBpcnkoX3RyYW5zYWN0aW9uLCBFeHBpcnkuVHJhbnNhY3Rpb24pKSk7CgogICAgX2NvbXBsZXRlVHJhbnNhY3Rpb24oX2lkLCBfdHJhbnNhY3Rpb24sIFRyYW5zYWN0aW9uU3RhdGUuQ29uZmlybWVkQWZ0ZXJFeHBpcnksIF90cmFuc2FjdGlvbi5zZWxsZXIpOwogIH0KCiAgZnVuY3Rpb24gX3JlZnVuZFRyYW5zYWN0aW9uKHVpbnQyNTYgX2lkLCBUcmFuc2FjdGlvbiBzdG9yYWdlIF90cmFuc2FjdGlvbikgcHJpdmF0ZSB7CiAgICBUcmFuc2FjdGlvblN0YXRlIGZpbmFsU3RhdGU7CgogICAgaWYgKF90cmFuc2FjdGlvbi5zdGF0ZSA9PSBUcmFuc2FjdGlvblN0YXRlLkFjY2VwdGVkKSB7CiAgICAgIGZpbmFsU3RhdGUgPSBUcmFuc2FjdGlvblN0YXRlLlJlZnVuZGVkOwogICAgfSBlbHNlIGlmIChfdHJhbnNhY3Rpb24uc3RhdGUgPT0gVHJhbnNhY3Rpb25TdGF0ZS5EaXNwdXRlZCkgewogICAgICBmaW5hbFN0YXRlID0gVHJhbnNhY3Rpb25TdGF0ZS5SZWZ1bmRlZEFmdGVyRGlzcHV0ZTsKICAgIH0gZWxzZSBpZiAoX3RyYW5zYWN0aW9uLnN0YXRlID09IFRyYW5zYWN0aW9uU3RhdGUuRXNjYWxhdGVkKSB7CiAgICAgIHJlcXVpcmUoX2FmdGVyRXhwaXJ5KF90cmFuc2FjdGlvbiwgX2ZldGNoRXhwaXJ5KF90cmFuc2FjdGlvbiwgRXhwaXJ5Lk1lZGlhdGlvbikpKTsKICAgICAgZmluYWxTdGF0ZSA9IFRyYW5zYWN0aW9uU3RhdGUuUmVmdW5kZWRBZnRlckVzY2FsYXRpb247CiAgICB9IGVsc2UgewogICAgICByZXZlcnQoKTsKICAgIH0KCiAgICBfY29tcGxldGVUcmFuc2FjdGlvbihfaWQsIF90cmFuc2FjdGlvbiwgZmluYWxTdGF0ZSwgX3RyYW5zYWN0aW9uLmJ1eWVyKTsKICB9CgogIGZ1bmN0aW9uIF9yZWZ1bmRUcmFuc2FjdGlvbkFmdGVyRXhwaXJ5KHVpbnQyNTYgX2lkLCBUcmFuc2FjdGlvbiBzdG9yYWdlIF90cmFuc2FjdGlvbikgcHJpdmF0ZSB7CiAgICByZXF1aXJlKF90cmFuc2FjdGlvbi5zdGF0ZSA9PSBUcmFuc2FjdGlvblN0YXRlLkRpc3B1dGVkKTsKICAgIHJlcXVpcmUoX2FmdGVyRXhwaXJ5KF90cmFuc2FjdGlvbiwgX2ZldGNoRXhwaXJ5KF90cmFuc2FjdGlvbiwgRXhwaXJ5LkVzY2FsYXRpb24pKSk7CgogICAgX2NvbXBsZXRlVHJhbnNhY3Rpb24oX2lkLCBfdHJhbnNhY3Rpb24sIFRyYW5zYWN0aW9uU3RhdGUuUmVmdW5kZWRBZnRlckV4cGlyeSwgX3RyYW5zYWN0aW9uLmJ1eWVyKTsKICB9CgogIGZ1bmN0aW9uIF9kaXNwdXRlVHJhbnNhY3Rpb24odWludDI1NiBfaWQsIFRyYW5zYWN0aW9uIHN0b3JhZ2UgX3RyYW5zYWN0aW9uKSBwcml2YXRlIHsKICAgIHJlcXVpcmUoX3RyYW5zYWN0aW9uLnN0YXRlID09IFRyYW5zYWN0aW9uU3RhdGUuQWNjZXB0ZWQpOwogICAgcmVxdWlyZShfYWZ0ZXJFeHBpcnkoX3RyYW5zYWN0aW9uLCBfZmV0Y2hFeHBpcnkoX3RyYW5zYWN0aW9uLCBFeHBpcnkuRnVsZmlsbG1lbnQpKSk7CgogICAgX3VwZGF0ZVRyYW5zYWN0aW9uU3RhdGUoX3RyYW5zYWN0aW9uLCBUcmFuc2FjdGlvblN0YXRlLkRpc3B1dGVkKTsKCiAgICBUcmFuc2FjdGlvbkRpc3B1dGVkKHsgaWQ6IF9pZCB9KTsKICB9CgogIGZ1bmN0aW9uIF9lc2NhbGF0ZURpc3B1dGVUb01lZGlhdG9yKHVpbnQyNTYgX2lkLCBUcmFuc2FjdGlvbiBzdG9yYWdlIF90cmFuc2FjdGlvbikgcHJpdmF0ZSB7CiAgICByZXF1aXJlKF90cmFuc2FjdGlvbi5zdGF0ZSA9PSBUcmFuc2FjdGlvblN0YXRlLkRpc3B1dGVkKTsKCiAgICBfdXBkYXRlVHJhbnNhY3Rpb25TdGF0ZShfdHJhbnNhY3Rpb24sIFRyYW5zYWN0aW9uU3RhdGUuRXNjYWxhdGVkKTsKCiAgICBUcmFuc2FjdGlvbkVzY2FsYXRlZCh7IGlkOiBfaWQgfSk7CiAgfQoKICBmdW5jdGlvbiBfc2V0dGxlVHJhbnNhY3Rpb24odWludDI1NiBfaWQsIFRyYW5zYWN0aW9uIHN0b3JhZ2UgX3RyYW5zYWN0aW9uKSBwcml2YXRlIHsKICAgIHJlcXVpcmUoX3RyYW5zYWN0aW9uLnN0YXRlID09IFRyYW5zYWN0aW9uU3RhdGUuRXNjYWxhdGVkKTsKICAgIHJlcXVpcmUoX2FmdGVyRXhwaXJ5KF90cmFuc2FjdGlvbiwgX2ZldGNoRXhwaXJ5KF90cmFuc2FjdGlvbiwgRXhwaXJ5Lk1lZGlhdGlvbikpKTsKCiAgICAvLyBEaXZpZGUgdGhlIGVzY3JvdyBhbW91bnQgaW4gaGFsZiBhbmQgZ2l2ZSBpdCB0byB0aGUgYnV5ZXIuIFRoZXJlJ3MKICAgIC8vIGEgcG9zc2liaWxpdHkgdGhhdCBvbmUgYWNjb3VudCB3aWxsIGdldCBzbGlnaHRseSBtb3JlIHRoYW4gdGhlIG90aGVyLgogICAgLy8gV2UgaGF2ZSBkZWNpZGVkIHRvIGdpdmUgdGhlIGxlc3NlciBhbW91bnQgdG8gdGhlIGJ1eWVyIChhcmJpdHJhcmlseSkuCiAgICB1aW50MjU2IGJ1eWVyQW1vdW50ID0gX3RyYW5zYWN0aW9uLmFtb3VudC5kaXYoMik7CiAgICAvLyBUaGUgcmVtYWluaW5nIGFtb3VudCBpcyBnaXZlbiB0byB0aGUgc2VsbGVyLgogICAgdWludDI1NiBzZWxsZXJBbW91bnQgPSBfdHJhbnNhY3Rpb24uYW1vdW50LnN1YihidXllckFtb3VudCk7CgogICAgVHJhbnNhY3Rpb25TZXR0bGVkKHsKICAgICAgaWQ6IF9pZCwKICAgICAgYnV5ZXJBbW91bnQ6IGJ1eWVyQW1vdW50LAogICAgICBzZWxsZXJBbW91bnQ6IHNlbGxlckFtb3VudAogICAgfSk7CgogICAgX3RyYW5zZmVyRnJvbUVzY3JvdyhfdHJhbnNhY3Rpb24uYnV5ZXIsIGJ1eWVyQW1vdW50KTsKICAgIF90cmFuc2ZlckZyb21Fc2Nyb3coX3RyYW5zYWN0aW9uLnNlbGxlciwgc2VsbGVyQW1vdW50KTsKCiAgICBfY2xlYW51cFRyYW5zYWN0aW9uKF9pZCwgX3RyYW5zYWN0aW9uLCB0cnVlKTsKICB9CgogIGZ1bmN0aW9uIF9yZWZ1bmRUcmFuc2FjdGlvbkJ5TWVkaWF0b3IodWludDI1NiBfaWQsIFRyYW5zYWN0aW9uIHN0b3JhZ2UgX3RyYW5zYWN0aW9uKSBwcml2YXRlIHsKICAgIHJlcXVpcmUoX3RyYW5zYWN0aW9uLnN0YXRlID09IFRyYW5zYWN0aW9uU3RhdGUuRXNjYWxhdGVkKTsKCiAgICBfY29tcGxldGVUcmFuc2FjdGlvbihfaWQsIF90cmFuc2FjdGlvbiwgVHJhbnNhY3Rpb25TdGF0ZS5SZWZ1bmRlZEJ5TWVkaWF0b3IsIF90cmFuc2FjdGlvbi5idXllcik7CiAgfQoKICBmdW5jdGlvbiBfY29uZmlybVRyYW5zYWN0aW9uQnlNZWRpYXRvcih1aW50MjU2IF9pZCwgVHJhbnNhY3Rpb24gc3RvcmFnZSBfdHJhbnNhY3Rpb24pIHByaXZhdGUgewogICAgcmVxdWlyZShfdHJhbnNhY3Rpb24uc3RhdGUgPT0gVHJhbnNhY3Rpb25TdGF0ZS5Fc2NhbGF0ZWQpOwoKICAgIF9jb21wbGV0ZVRyYW5zYWN0aW9uKF9pZCwgX3RyYW5zYWN0aW9uLCBUcmFuc2FjdGlvblN0YXRlLkNvbmZpcm1lZEJ5TWVkaWF0b3IsIF90cmFuc2FjdGlvbi5zZWxsZXIpOwogIH0KCiAgZnVuY3Rpb24gX3NldHRsZVRyYW5zYWN0aW9uQnlNZWRpYXRvcih1aW50MjU2IF9pZCwgVHJhbnNhY3Rpb24gc3RvcmFnZSBfdHJhbnNhY3Rpb24sIHVpbnQyNTYgX2J1eWVyQW1vdW50LCB1aW50MjU2IF9zZWxsZXJBbW91bnQpIHByaXZhdGUgewogICAgcmVxdWlyZShfdHJhbnNhY3Rpb24uc3RhdGUgPT0gVHJhbnNhY3Rpb25TdGF0ZS5Fc2NhbGF0ZWQpOwogICAgcmVxdWlyZShfYnV5ZXJBbW91bnQuYWRkKF9zZWxsZXJBbW91bnQpID09IF90cmFuc2FjdGlvbi5hbW91bnQpOwoKICAgIHVpbnQyNTYgYnV5ZXJNZWRpYXRvckZlZTsKICAgIHVpbnQyNTYgc2VsbGVyTWVkaWF0b3JGZWU7CgogICAgKGJ1eWVyTWVkaWF0b3JGZWUsIHNlbGxlck1lZGlhdG9yRmVlKSA9IElua01lZGlhdG9yKF90cmFuc2FjdGlvbi5tZWRpYXRvcikuc2V0dGxlVHJhbnNhY3Rpb25CeU1lZGlhdG9yRmVlKF9idXllckFtb3VudCwgX3NlbGxlckFtb3VudCk7CgogICAgLy8gUmVxdWlyZSB0aGF0IHRoZSBzdW0gb2YgdGhlIGZlZXMgYmUgbm8gbW9yZSB0aGFuIHRoZSB0cmFuc2FjdGlvbidzIGFtb3VudC4KICAgIHJlcXVpcmUoYnV5ZXJNZWRpYXRvckZlZSA8PSBfYnV5ZXJBbW91bnQgJiYgc2VsbGVyTWVkaWF0b3JGZWUgPD0gX3NlbGxlckFtb3VudCk7CgogICAgVHJhbnNhY3Rpb25TZXR0bGVkQnlNZWRpYXRvcih7CiAgICAgIGlkOiBfaWQsCiAgICAgIGJ1eWVyQW1vdW50OiBfYnV5ZXJBbW91bnQsCiAgICAgIHNlbGxlckFtb3VudDogX3NlbGxlckFtb3VudCwKICAgICAgYnV5ZXJNZWRpYXRvckZlZTogYnV5ZXJNZWRpYXRvckZlZSwKICAgICAgc2VsbGVyTWVkaWF0b3JGZWU6IHNlbGxlck1lZGlhdG9yRmVlCiAgICB9KTsKCiAgICBfdHJhbnNmZXJGcm9tRXNjcm93KF90cmFuc2FjdGlvbi5idXllciwgX2J1eWVyQW1vdW50LnN1YihidXllck1lZGlhdG9yRmVlKSk7CiAgICBfdHJhbnNmZXJGcm9tRXNjcm93KF90cmFuc2FjdGlvbi5zZWxsZXIsIF9zZWxsZXJBbW91bnQuc3ViKHNlbGxlck1lZGlhdG9yRmVlKSk7CiAgICBfdHJhbnNmZXJGcm9tRXNjcm93KF90cmFuc2FjdGlvbi5tZWRpYXRvciwgYnV5ZXJNZWRpYXRvckZlZS5hZGQoc2VsbGVyTWVkaWF0b3JGZWUpKTsKCiAgICBfY2xlYW51cFRyYW5zYWN0aW9uKF9pZCwgX3RyYW5zYWN0aW9uLCB0cnVlKTsKICB9CgogIGZ1bmN0aW9uIF9wcm92aWRlVHJhbnNhY3Rpb25GZWVkYmFjayh1aW50MjU2IF9pZCwgVHJhbnNhY3Rpb24gc3RvcmFnZSBfdHJhbnNhY3Rpb24sIHVpbnQ4IF9yYXRpbmcsIGJ5dGVzMzIgX2NvbW1lbnQpIHByaXZhdGUgewogICAgLy8gVGhlIHRyYW5zYWN0aW9uIG11c3QgYmUgY29tcGxldGVkIChOdWxsIHN0YXRlIHdpdGggYSBidXllcikgdG8gYWxsb3cKICAgIC8vIGZlZWRiYWNrLgogICAgcmVxdWlyZShfdHJhbnNhY3Rpb24uc3RhdGUgPT0gVHJhbnNhY3Rpb25TdGF0ZS5OdWxsKTsKCiAgICAvLyBBcyBwZXIgZnVuY3Rpb25hbCBzcGVjaWZpY2F0aW9ucywgcmF0aW5ncyBtdXN0IGJlIGFuIGludGVnZXIgYmV0d2VlbgogICAgLy8gMSBhbmQgNSwgaW5jbHVzaXZlLgogICAgcmVxdWlyZShfcmF0aW5nID49IDEgJiYgX3JhdGluZyA8PSA1KTsKCiAgICBGZWVkYmFja1VwZGF0ZWQoewogICAgICB0cmFuc2FjdGlvbklkOiBfaWQsCiAgICAgIHJhdGluZzogX3JhdGluZywKICAgICAgY29tbWVudDogX2NvbW1lbnQKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gX2NvbXBsZXRlVHJhbnNhY3Rpb24odWludDI1NiBfaWQsIFRyYW5zYWN0aW9uIHN0b3JhZ2UgX3RyYW5zYWN0aW9uLCBUcmFuc2FjdGlvblN0YXRlIF9maW5hbFN0YXRlLCBhZGRyZXNzIF90cmFuc2ZlclRvKSBwcml2YXRlIHsKICAgIHVpbnQyNTYgbWVkaWF0b3JGZWUgPSBfZmV0Y2hNZWRpYXRvckZlZShfdHJhbnNhY3Rpb24sIF9maW5hbFN0YXRlKTsKCiAgICBpZiAoX2ZpbmFsU3RhdGUgPT0gVHJhbnNhY3Rpb25TdGF0ZS5Db25maXJtZWQpIHsKICAgICAgVHJhbnNhY3Rpb25Db25maXJtZWQoeyBpZDogX2lkLCBtZWRpYXRvckZlZTogbWVkaWF0b3JGZWUgfSk7CiAgICB9IGVsc2UgaWYgKF9maW5hbFN0YXRlID09IFRyYW5zYWN0aW9uU3RhdGUuQ29uZmlybWVkQWZ0ZXJEaXNwdXRlKSB7CiAgICAgIFRyYW5zYWN0aW9uQ29uZmlybWVkQWZ0ZXJEaXNwdXRlKHsgaWQ6IF9pZCwgbWVkaWF0b3JGZWU6IG1lZGlhdG9yRmVlIH0pOwogICAgfSBlbHNlIGlmIChfZmluYWxTdGF0ZSA9PSBUcmFuc2FjdGlvblN0YXRlLkNvbmZpcm1lZEFmdGVyRXNjYWxhdGlvbikgewogICAgICBUcmFuc2FjdGlvbkNvbmZpcm1lZEFmdGVyRXNjYWxhdGlvbih7IGlkOiBfaWQgfSk7CiAgICB9IGVsc2UgaWYgKF9maW5hbFN0YXRlID09IFRyYW5zYWN0aW9uU3RhdGUuQ29uZmlybWVkQWZ0ZXJFeHBpcnkpIHsKICAgICAgVHJhbnNhY3Rpb25Db25maXJtZWRBZnRlckV4cGlyeSh7IGlkOiBfaWQsIG1lZGlhdG9yRmVlOiBtZWRpYXRvckZlZSB9KTsKICAgIH0gZWxzZSBpZiAoX2ZpbmFsU3RhdGUgPT0gVHJhbnNhY3Rpb25TdGF0ZS5SZWZ1bmRlZCkgewogICAgICBUcmFuc2FjdGlvblJlZnVuZGVkKHsgaWQ6IF9pZCwgbWVkaWF0b3JGZWU6IG1lZGlhdG9yRmVlIH0pOwogICAgfSBlbHNlIGlmIChfZmluYWxTdGF0ZSA9PSBUcmFuc2FjdGlvblN0YXRlLlJlZnVuZGVkQWZ0ZXJEaXNwdXRlKSB7CiAgICAgIFRyYW5zYWN0aW9uUmVmdW5kZWRBZnRlckRpc3B1dGUoeyBpZDogX2lkLCBtZWRpYXRvckZlZTogbWVkaWF0b3JGZWUgfSk7CiAgICB9IGVsc2UgaWYgKF9maW5hbFN0YXRlID09IFRyYW5zYWN0aW9uU3RhdGUuUmVmdW5kZWRBZnRlckVzY2FsYXRpb24pIHsKICAgICAgVHJhbnNhY3Rpb25SZWZ1bmRlZEFmdGVyRXNjYWxhdGlvbih7IGlkOiBfaWQgfSk7CiAgICB9IGVsc2UgaWYgKF9maW5hbFN0YXRlID09IFRyYW5zYWN0aW9uU3RhdGUuUmVmdW5kZWRBZnRlckV4cGlyeSkgewogICAgICBUcmFuc2FjdGlvblJlZnVuZGVkQWZ0ZXJFeHBpcnkoeyBpZDogX2lkLCBtZWRpYXRvckZlZTogbWVkaWF0b3JGZWUgfSk7CiAgICB9IGVsc2UgaWYgKF9maW5hbFN0YXRlID09IFRyYW5zYWN0aW9uU3RhdGUuUmVmdW5kZWRCeU1lZGlhdG9yKSB7CiAgICAgIFRyYW5zYWN0aW9uUmVmdW5kZWRCeU1lZGlhdG9yKHsgaWQ6IF9pZCwgbWVkaWF0b3JGZWU6IG1lZGlhdG9yRmVlIH0pOwogICAgfSBlbHNlIGlmIChfZmluYWxTdGF0ZSA9PSBUcmFuc2FjdGlvblN0YXRlLkNvbmZpcm1lZEJ5TWVkaWF0b3IpIHsKICAgICAgVHJhbnNhY3Rpb25Db25maXJtZWRCeU1lZGlhdG9yKHsgaWQ6IF9pZCwgbWVkaWF0b3JGZWU6IG1lZGlhdG9yRmVlIH0pOwogICAgfQoKICAgIF90cmFuc2ZlckZyb21Fc2Nyb3coX3RyYW5zZmVyVG8sIF90cmFuc2FjdGlvbi5hbW91bnQuc3ViKG1lZGlhdG9yRmVlKSk7CiAgICBfdHJhbnNmZXJGcm9tRXNjcm93KF90cmFuc2FjdGlvbi5tZWRpYXRvciwgbWVkaWF0b3JGZWUpOwoKICAgIF9jbGVhbnVwVHJhbnNhY3Rpb24oX2lkLCBfdHJhbnNhY3Rpb24sIHRydWUpOwogIH0KCiAgZnVuY3Rpb24gX2ZldGNoRXhwaXJ5KFRyYW5zYWN0aW9uIHN0b3JhZ2UgX3RyYW5zYWN0aW9uLCBFeHBpcnkgX2V4cGlyeVR5cGUpIHByaXZhdGUgcmV0dXJucyAodWludDMyKSB7CiAgICB1aW50MzIgZXhwaXJ5OwogICAgYm9vbCBzdWNjZXNzOwoKICAgIGlmIChfZXhwaXJ5VHlwZSA9PSBFeHBpcnkuVHJhbnNhY3Rpb24pIHsKICAgICAgc3VjY2VzcyA9IF90cmFuc2FjdGlvbi5wb2xpY3kuY2FsbC5nYXMoZ2FzTGltaXRGb3JFeHBpcnlDYWxsKShieXRlczQoa2VjY2FrMjU2KCJ0cmFuc2FjdGlvbkV4cGlyeSgpIikpKTsKICAgIH0gZWxzZSBpZiAoX2V4cGlyeVR5cGUgPT0gRXhwaXJ5LkZ1bGZpbGxtZW50KSB7CiAgICAgIHN1Y2Nlc3MgPSBfdHJhbnNhY3Rpb24ucG9saWN5LmNhbGwuZ2FzKGdhc0xpbWl0Rm9yRXhwaXJ5Q2FsbCkoYnl0ZXM0KGtlY2NhazI1NigiZnVsZmlsbG1lbnRFeHBpcnkoKSIpKSk7CiAgICB9IGVsc2UgaWYgKF9leHBpcnlUeXBlID09IEV4cGlyeS5Fc2NhbGF0aW9uKSB7CiAgICAgIHN1Y2Nlc3MgPSBfdHJhbnNhY3Rpb24ucG9saWN5LmNhbGwuZ2FzKGdhc0xpbWl0Rm9yRXhwaXJ5Q2FsbCkoYnl0ZXM0KGtlY2NhazI1NigiZXNjYWxhdGlvbkV4cGlyeSgpIikpKTsKICAgIH0gZWxzZSBpZiAoX2V4cGlyeVR5cGUgPT0gRXhwaXJ5Lk1lZGlhdGlvbikgewogICAgICBzdWNjZXNzID0gX3RyYW5zYWN0aW9uLm1lZGlhdG9yLmNhbGwuZ2FzKGdhc0xpbWl0Rm9yRXhwaXJ5Q2FsbCkoYnl0ZXM0KGtlY2NhazI1NigibWVkaWF0aW9uRXhwaXJ5KCkiKSkpOwogICAgfQoKICAgIGlmIChzdWNjZXNzKSB7CiAgICAgIGFzc2VtYmx5IHsKICAgICAgICBpZiBlcShyZXR1cm5kYXRhc2l6ZSgpLCAweDIwKSB7CiAgICAgICAgICBsZXQgX2ZyZWVNZW1Qb2ludGVyIDo9IG1sb2FkKDB4NDApCiAgICAgICAgICByZXR1cm5kYXRhY29weShfZnJlZU1lbVBvaW50ZXIsIDAsIDB4MjApCiAgICAgICAgICBleHBpcnkgOj0gbWxvYWQoX2ZyZWVNZW1Qb2ludGVyKQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHJldHVybiBleHBpcnk7CiAgfQoKICBmdW5jdGlvbiBfZmV0Y2hNZWRpYXRvckZlZShUcmFuc2FjdGlvbiBzdG9yYWdlIF90cmFuc2FjdGlvbiwgVHJhbnNhY3Rpb25TdGF0ZSBfZmluYWxTdGF0ZSkgcHJpdmF0ZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBpZiAoX3RyYW5zYWN0aW9uLm1lZGlhdG9yID09IGFkZHJlc3MoMCkpIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgdWludDI1NiBtZWRpYXRvckZlZTsKICAgIGJvb2wgc3VjY2VzczsKCiAgICBpZiAoX2ZpbmFsU3RhdGUgPT0gVHJhbnNhY3Rpb25TdGF0ZS5Db25maXJtZWQpIHsKICAgICAgc3VjY2VzcyA9IF90cmFuc2FjdGlvbi5tZWRpYXRvci5jYWxsLmdhcyhnYXNMaW1pdEZvck1lZGlhdG9yQ2FsbCkoYnl0ZXM0KGtlY2NhazI1NigiY29uZmlybVRyYW5zYWN0aW9uRmVlKHVpbnQyNTYpIikpLCBfdHJhbnNhY3Rpb24uYW1vdW50KTsKICAgIH0gZWxzZSBpZiAoX2ZpbmFsU3RhdGUgPT0gVHJhbnNhY3Rpb25TdGF0ZS5Db25maXJtZWRBZnRlckV4cGlyeSkgewogICAgICBzdWNjZXNzID0gX3RyYW5zYWN0aW9uLm1lZGlhdG9yLmNhbGwuZ2FzKGdhc0xpbWl0Rm9yTWVkaWF0b3JDYWxsKShieXRlczQoa2VjY2FrMjU2KCJjb25maXJtVHJhbnNhY3Rpb25BZnRlckV4cGlyeUZlZSh1aW50MjU2KSIpKSwgX3RyYW5zYWN0aW9uLmFtb3VudCk7CiAgICB9IGVsc2UgaWYgKF9maW5hbFN0YXRlID09IFRyYW5zYWN0aW9uU3RhdGUuQ29uZmlybWVkQWZ0ZXJEaXNwdXRlKSB7CiAgICAgIHN1Y2Nlc3MgPSBfdHJhbnNhY3Rpb24ubWVkaWF0b3IuY2FsbC5nYXMoZ2FzTGltaXRGb3JNZWRpYXRvckNhbGwpKGJ5dGVzNChrZWNjYWsyNTYoImNvbmZpcm1UcmFuc2FjdGlvbkFmdGVyRGlzcHV0ZUZlZSh1aW50MjU2KSIpKSwgX3RyYW5zYWN0aW9uLmFtb3VudCk7CiAgICB9IGVsc2UgaWYgKF9maW5hbFN0YXRlID09IFRyYW5zYWN0aW9uU3RhdGUuQ29uZmlybWVkQnlNZWRpYXRvcikgewogICAgICBtZWRpYXRvckZlZSA9IElua01lZGlhdG9yKF90cmFuc2FjdGlvbi5tZWRpYXRvcikuY29uZmlybVRyYW5zYWN0aW9uQnlNZWRpYXRvckZlZShfdHJhbnNhY3Rpb24uYW1vdW50KTsKICAgIH0gZWxzZSBpZiAoX2ZpbmFsU3RhdGUgPT0gVHJhbnNhY3Rpb25TdGF0ZS5SZWZ1bmRlZCkgewogICAgICBzdWNjZXNzID0gX3RyYW5zYWN0aW9uLm1lZGlhdG9yLmNhbGwuZ2FzKGdhc0xpbWl0Rm9yTWVkaWF0b3JDYWxsKShieXRlczQoa2VjY2FrMjU2KCJyZWZ1bmRUcmFuc2FjdGlvbkZlZSh1aW50MjU2KSIpKSwgX3RyYW5zYWN0aW9uLmFtb3VudCk7CiAgICB9IGVsc2UgaWYgKF9maW5hbFN0YXRlID09IFRyYW5zYWN0aW9uU3RhdGUuUmVmdW5kZWRBZnRlckV4cGlyeSkgewogICAgICBzdWNjZXNzID0gX3RyYW5zYWN0aW9uLm1lZGlhdG9yLmNhbGwuZ2FzKGdhc0xpbWl0Rm9yTWVkaWF0b3JDYWxsKShieXRlczQoa2VjY2FrMjU2KCJyZWZ1bmRUcmFuc2FjdGlvbkFmdGVyRXhwaXJ5RmVlKHVpbnQyNTYpIikpLCBfdHJhbnNhY3Rpb24uYW1vdW50KTsKICAgIH0gZWxzZSBpZiAoX2ZpbmFsU3RhdGUgPT0gVHJhbnNhY3Rpb25TdGF0ZS5SZWZ1bmRlZEFmdGVyRGlzcHV0ZSkgewogICAgICBzdWNjZXNzID0gX3RyYW5zYWN0aW9uLm1lZGlhdG9yLmNhbGwuZ2FzKGdhc0xpbWl0Rm9yTWVkaWF0b3JDYWxsKShieXRlczQoa2VjY2FrMjU2KCJyZWZ1bmRUcmFuc2FjdGlvbkFmdGVyRGlzcHV0ZUZlZSh1aW50MjU2KSIpKSwgX3RyYW5zYWN0aW9uLmFtb3VudCk7CiAgICB9IGVsc2UgaWYgKF9maW5hbFN0YXRlID09IFRyYW5zYWN0aW9uU3RhdGUuUmVmdW5kZWRCeU1lZGlhdG9yKSB7CiAgICAgIG1lZGlhdG9yRmVlID0gSW5rTWVkaWF0b3IoX3RyYW5zYWN0aW9uLm1lZGlhdG9yKS5yZWZ1bmRUcmFuc2FjdGlvbkJ5TWVkaWF0b3JGZWUoX3RyYW5zYWN0aW9uLmFtb3VudCk7CiAgICB9CgogICAgaWYgKHN1Y2Nlc3MpIHsKICAgICAgYXNzZW1ibHkgewogICAgICAgIGlmIGVxKHJldHVybmRhdGFzaXplKCksIDB4MjApIHsKICAgICAgICAgIGxldCBfZnJlZU1lbVBvaW50ZXIgOj0gbWxvYWQoMHg0MCkKICAgICAgICAgIHJldHVybmRhdGFjb3B5KF9mcmVlTWVtUG9pbnRlciwgMCwgMHgyMCkKICAgICAgICAgIG1lZGlhdG9yRmVlIDo9IG1sb2FkKF9mcmVlTWVtUG9pbnRlcikKICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIFRoZSBtZWRpYXRvcidzIGZlZSBjYW5ub3QgYmUgbW9yZSB0aGFuIHRyYW5zYWN0aW9uJ3MgYW1vdW50LgogICAgICBpZiAobWVkaWF0b3JGZWUgPiBfdHJhbnNhY3Rpb24uYW1vdW50KSB7CiAgICAgICAgbWVkaWF0b3JGZWUgPSAwOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICByZXF1aXJlKG1lZGlhdG9yRmVlIDw9IF90cmFuc2FjdGlvbi5hbW91bnQpOwogICAgfQoKICAgIHJldHVybiBtZWRpYXRvckZlZTsKICB9CgogIGZ1bmN0aW9uIF9yZXNvbHZlT3duZXIodWludDI1NiBfdHJhbnNhY3Rpb25JZCwgYWRkcmVzcyBfb3duZXIpIHByaXZhdGUgewogICAgaWYgKF9vd25lciAhPSBhZGRyZXNzKDApKSB7CiAgICAgIC8vIElmIGFuIG93bmVyIGlzIHNwZWNpZmllZCwgaXQgbXVzdCBhdXRob3JpemUgdGhlIHRyYW5zYWN0aW9uLgogICAgICByZXF1aXJlKElua093bmVyKF9vd25lcikuYXV0aG9yaXplVHJhbnNhY3Rpb24oCiAgICAgICAgX3RyYW5zYWN0aW9uSWQsCiAgICAgICAgbXNnLnNlbmRlcgogICAgICApKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIF9yZXNvbHZlTWVkaWF0b3IodWludDI1NiBfdHJhbnNhY3Rpb25JZCwgVHJhbnNhY3Rpb24gc3RvcmFnZSBfdHJhbnNhY3Rpb24sIGFkZHJlc3MgX21lZGlhdG9yLCBhZGRyZXNzIF9vd25lcikgcHJpdmF0ZSB7CiAgICBpZiAoX21lZGlhdG9yICE9IGFkZHJlc3MoMCkpIHsKICAgICAgLy8gVGhlIG1lZGlhdG9yIG11c3QgYWNjZXB0IHRoZSB0cmFuc2FjdGlvbiBvdGhlcndpc2Ugd2UgYWJvcnQuCiAgICAgIHJlcXVpcmUoSW5rTWVkaWF0b3IoX21lZGlhdG9yKS5yZXF1ZXN0TWVkaWF0b3IoX3RyYW5zYWN0aW9uSWQsIF90cmFuc2FjdGlvbi5hbW91bnQsIF9vd25lcikpOwoKICAgICAgLy8gQXNzaWduIHRoZSBtZWRpYXRvciB0byB0aGUgdHJhbnNhY3Rpb24uCiAgICAgIF90cmFuc2FjdGlvbi5tZWRpYXRvciA9IF9tZWRpYXRvcjsKICAgIH0KICB9CgogIGZ1bmN0aW9uIF9hZnRlckV4cGlyeShUcmFuc2FjdGlvbiBzdG9yYWdlIF90cmFuc2FjdGlvbiwgdWludDMyIF9leHBpcnkpIHByaXZhdGUgdmlldyByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gbm93LnN1YihfdHJhbnNhY3Rpb24uc3RhdGVUaW1lKSA+PSBfZXhwaXJ5OwogIH0KCiAgZnVuY3Rpb24gX2ZpbmRUcmFuc2FjdGlvbkZvckJ1eWVyKHVpbnQyNTYgX2lkKSBwcml2YXRlIHZpZXcgcmV0dXJucyAoVHJhbnNhY3Rpb24gc3RvcmFnZSB0cmFuc2FjdGlvbikgewogICAgdHJhbnNhY3Rpb24gPSBfZmluZFRyYW5zYWN0aW9uKF9pZCk7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gdHJhbnNhY3Rpb24uYnV5ZXIpOwogIH0KCiAgZnVuY3Rpb24gX2ZpbmRUcmFuc2FjdGlvbkZvclNlbGxlcih1aW50MjU2IF9pZCkgcHJpdmF0ZSB2aWV3IHJldHVybnMgKFRyYW5zYWN0aW9uIHN0b3JhZ2UgdHJhbnNhY3Rpb24pIHsKICAgIHRyYW5zYWN0aW9uID0gX2ZpbmRUcmFuc2FjdGlvbihfaWQpOwogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHRyYW5zYWN0aW9uLnNlbGxlcik7CiAgfQoKICBmdW5jdGlvbiBfZmluZFRyYW5zYWN0aW9uRm9yUGFydHkodWludDI1NiBfaWQpIHByaXZhdGUgdmlldyByZXR1cm5zIChUcmFuc2FjdGlvbiBzdG9yYWdlIHRyYW5zYWN0aW9uKSB7CiAgICB0cmFuc2FjdGlvbiA9IF9maW5kVHJhbnNhY3Rpb24oX2lkKTsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSB0cmFuc2FjdGlvbi5idXllciB8fCBtc2cuc2VuZGVyID09IHRyYW5zYWN0aW9uLnNlbGxlcik7CiAgfQoKICBmdW5jdGlvbiBfZmluZFRyYW5zYWN0aW9uRm9yTWVkaWF0b3IodWludDI1NiBfaWQpIHByaXZhdGUgdmlldyByZXR1cm5zIChUcmFuc2FjdGlvbiBzdG9yYWdlIHRyYW5zYWN0aW9uKSB7CiAgICB0cmFuc2FjdGlvbiA9IF9maW5kVHJhbnNhY3Rpb24oX2lkKTsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSB0cmFuc2FjdGlvbi5tZWRpYXRvcik7CiAgfQoKICBmdW5jdGlvbiBfZmluZFRyYW5zYWN0aW9uKHVpbnQyNTYgX2lkKSBwcml2YXRlIHZpZXcgcmV0dXJucyAoVHJhbnNhY3Rpb24gc3RvcmFnZSB0cmFuc2FjdGlvbikgewogICAgdHJhbnNhY3Rpb24gPSB0cmFuc2FjdGlvbnNbX2lkXTsKICAgIHJlcXVpcmUoX2lkIDwgZ2xvYmFsVHJhbnNhY3Rpb25JZCk7CiAgfQoKICBmdW5jdGlvbiBfdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHJpdmF0ZSByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGJhbGFuY2VzW19mcm9tXSk7CgogICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gX3RyYW5zZmVyRnJvbUVzY3JvdyhhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHByaXZhdGUgcmV0dXJucyAoYm9vbCkgewogICAgaWYgKF92YWx1ZSA+IDApIHsKICAgICAgcmV0dXJuIF90cmFuc2ZlckZyb20odGhpcywgX3RvLCBfdmFsdWUpOwogICAgfQoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gX3VwZGF0ZVRyYW5zYWN0aW9uU3RhdGUoVHJhbnNhY3Rpb24gc3RvcmFnZSBfdHJhbnNhY3Rpb24sIFRyYW5zYWN0aW9uU3RhdGUgX3N0YXRlKSBwcml2YXRlIHsKICAgIF90cmFuc2FjdGlvbi5zdGF0ZSA9IF9zdGF0ZTsKICAgIF90cmFuc2FjdGlvbi5zdGF0ZVRpbWUgPSBub3c7CiAgfQoKICBmdW5jdGlvbiBfY2xlYW51cFRyYW5zYWN0aW9uKHVpbnQyNTYgX2lkLCBUcmFuc2FjdGlvbiBzdG9yYWdlIF90cmFuc2FjdGlvbiwgYm9vbCBfY29tcGxldGVkKSBwcml2YXRlIHsKICAgIC8vIFJlbW92ZSBkYXRhIHRoYXQgaXMgbm8gbG9uZ2VyIG5lZWRlZCBvbiB0aGUgY29udHJhY3QuCgogICAgaWYgKF9jb21wbGV0ZWQpIHsKICAgICAgZGVsZXRlIF90cmFuc2FjdGlvbi5zdGF0ZTsKICAgICAgZGVsZXRlIF90cmFuc2FjdGlvbi5zZWxsZXI7CiAgICAgIGRlbGV0ZSBfdHJhbnNhY3Rpb24ucG9saWN5OwogICAgICBkZWxldGUgX3RyYW5zYWN0aW9uLm1lZGlhdG9yOwogICAgICBkZWxldGUgX3RyYW5zYWN0aW9uLnN0YXRlVGltZTsKICAgICAgZGVsZXRlIF90cmFuc2FjdGlvbi5hbW91bnQ7CiAgICB9IGVsc2UgewogICAgICBkZWxldGUgdHJhbnNhY3Rpb25zW19pZF07CiAgICB9CiAgfQp9CgovLyBGaWxlOiB6ZXBwZWxpbi1zb2xpZGl0eS9jb250cmFjdHMvb3duZXJzaGlwL093bmFibGUuc29sCgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKLy8gRmlsZTogemVwcGVsaW4tc29saWRpdHkvY29udHJhY3RzL3Rva2VuL0VSQzIwL1NhZmVFUkMyMC5zb2wKCi8qKgogKiBAdGl0bGUgU2FmZUVSQzIwCiAqIEBkZXYgV3JhcHBlcnMgYXJvdW5kIEVSQzIwIG9wZXJhdGlvbnMgdGhhdCB0aHJvdyBvbiBmYWlsdXJlLgogKiBUbyB1c2UgdGhpcyBsaWJyYXJ5IHlvdSBjYW4gYWRkIGEgYHVzaW5nIFNhZmVFUkMyMCBmb3IgRVJDMjA7YCBzdGF0ZW1lbnQgdG8geW91ciBjb250cmFjdCwKICogd2hpY2ggYWxsb3dzIHlvdSB0byBjYWxsIHRoZSBzYWZlIG9wZXJhdGlvbnMgYXMgYHRva2VuLnNhZmVUcmFuc2ZlciguLi4pYCwgZXRjLgogKi8KbGlicmFyeSBTYWZlRVJDMjAgewogIGZ1bmN0aW9uIHNhZmVUcmFuc2ZlcihFUkMyMEJhc2ljIHRva2VuLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBpbnRlcm5hbCB7CiAgICBhc3NlcnQodG9rZW4udHJhbnNmZXIodG8sIHZhbHVlKSk7CiAgfQoKICBmdW5jdGlvbiBzYWZlVHJhbnNmZXJGcm9tKEVSQzIwIHRva2VuLCBhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHsKICAgIGFzc2VydCh0b2tlbi50cmFuc2ZlckZyb20oZnJvbSwgdG8sIHZhbHVlKSk7CiAgfQoKICBmdW5jdGlvbiBzYWZlQXBwcm92ZShFUkMyMCB0b2tlbiwgYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBpbnRlcm5hbCB7CiAgICBhc3NlcnQodG9rZW4uYXBwcm92ZShzcGVuZGVyLCB2YWx1ZSkpOwogIH0KfQoKLy8gRmlsZTogemVwcGVsaW4tc29saWRpdHkvY29udHJhY3RzL3Rva2VuL0VSQzIwL1Rva2VuVmVzdGluZy5zb2wKCi8qKgogKiBAdGl0bGUgVG9rZW5WZXN0aW5nCiAqIEBkZXYgQSB0b2tlbiBob2xkZXIgY29udHJhY3QgdGhhdCBjYW4gcmVsZWFzZSBpdHMgdG9rZW4gYmFsYW5jZSBncmFkdWFsbHkgbGlrZSBhCiAqIHR5cGljYWwgdmVzdGluZyBzY2hlbWUsIHdpdGggYSBjbGlmZiBhbmQgdmVzdGluZyBwZXJpb2QuIE9wdGlvbmFsbHkgcmV2b2NhYmxlIGJ5IHRoZQogKiBvd25lci4KICovCmNvbnRyYWN0IFRva2VuVmVzdGluZyBpcyBPd25hYmxlIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKICB1c2luZyBTYWZlRVJDMjAgZm9yIEVSQzIwQmFzaWM7CgogIGV2ZW50IFJlbGVhc2VkKHVpbnQyNTYgYW1vdW50KTsKICBldmVudCBSZXZva2VkKCk7CgogIC8vIGJlbmVmaWNpYXJ5IG9mIHRva2VucyBhZnRlciB0aGV5IGFyZSByZWxlYXNlZAogIGFkZHJlc3MgcHVibGljIGJlbmVmaWNpYXJ5OwoKICB1aW50MjU2IHB1YmxpYyBjbGlmZjsKICB1aW50MjU2IHB1YmxpYyBzdGFydDsKICB1aW50MjU2IHB1YmxpYyBkdXJhdGlvbjsKCiAgYm9vbCBwdWJsaWMgcmV2b2NhYmxlOwoKICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyByZWxlYXNlZDsKICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyByZXZva2VkOwoKICAvKioKICAgKiBAZGV2IENyZWF0ZXMgYSB2ZXN0aW5nIGNvbnRyYWN0IHRoYXQgdmVzdHMgaXRzIGJhbGFuY2Ugb2YgYW55IEVSQzIwIHRva2VuIHRvIHRoZQogICAqIF9iZW5lZmljaWFyeSwgZ3JhZHVhbGx5IGluIGEgbGluZWFyIGZhc2hpb24gdW50aWwgX3N0YXJ0ICsgX2R1cmF0aW9uLiBCeSB0aGVuIGFsbAogICAqIG9mIHRoZSBiYWxhbmNlIHdpbGwgaGF2ZSB2ZXN0ZWQuCiAgICogQHBhcmFtIF9iZW5lZmljaWFyeSBhZGRyZXNzIG9mIHRoZSBiZW5lZmljaWFyeSB0byB3aG9tIHZlc3RlZCB0b2tlbnMgYXJlIHRyYW5zZmVycmVkCiAgICogQHBhcmFtIF9jbGlmZiBkdXJhdGlvbiBpbiBzZWNvbmRzIG9mIHRoZSBjbGlmZiBpbiB3aGljaCB0b2tlbnMgd2lsbCBiZWdpbiB0byB2ZXN0CiAgICogQHBhcmFtIF9kdXJhdGlvbiBkdXJhdGlvbiBpbiBzZWNvbmRzIG9mIHRoZSBwZXJpb2QgaW4gd2hpY2ggdGhlIHRva2VucyB3aWxsIHZlc3QKICAgKiBAcGFyYW0gX3Jldm9jYWJsZSB3aGV0aGVyIHRoZSB2ZXN0aW5nIGlzIHJldm9jYWJsZSBvciBub3QKICAgKi8KICBmdW5jdGlvbiBUb2tlblZlc3RpbmcoYWRkcmVzcyBfYmVuZWZpY2lhcnksIHVpbnQyNTYgX3N0YXJ0LCB1aW50MjU2IF9jbGlmZiwgdWludDI1NiBfZHVyYXRpb24sIGJvb2wgX3Jldm9jYWJsZSkgcHVibGljIHsKICAgIHJlcXVpcmUoX2JlbmVmaWNpYXJ5ICE9IGFkZHJlc3MoMCkpOwogICAgcmVxdWlyZShfY2xpZmYgPD0gX2R1cmF0aW9uKTsKCiAgICBiZW5lZmljaWFyeSA9IF9iZW5lZmljaWFyeTsKICAgIHJldm9jYWJsZSA9IF9yZXZvY2FibGU7CiAgICBkdXJhdGlvbiA9IF9kdXJhdGlvbjsKICAgIGNsaWZmID0gX3N0YXJ0LmFkZChfY2xpZmYpOwogICAgc3RhcnQgPSBfc3RhcnQ7CiAgfQoKICAvKioKICAgKiBAbm90aWNlIFRyYW5zZmVycyB2ZXN0ZWQgdG9rZW5zIHRvIGJlbmVmaWNpYXJ5LgogICAqIEBwYXJhbSB0b2tlbiBFUkMyMCB0b2tlbiB3aGljaCBpcyBiZWluZyB2ZXN0ZWQKICAgKi8KICBmdW5jdGlvbiByZWxlYXNlKEVSQzIwQmFzaWMgdG9rZW4pIHB1YmxpYyB7CiAgICB1aW50MjU2IHVucmVsZWFzZWQgPSByZWxlYXNhYmxlQW1vdW50KHRva2VuKTsKCiAgICByZXF1aXJlKHVucmVsZWFzZWQgPiAwKTsKCiAgICByZWxlYXNlZFt0b2tlbl0gPSByZWxlYXNlZFt0b2tlbl0uYWRkKHVucmVsZWFzZWQpOwoKICAgIHRva2VuLnNhZmVUcmFuc2ZlcihiZW5lZmljaWFyeSwgdW5yZWxlYXNlZCk7CgogICAgUmVsZWFzZWQodW5yZWxlYXNlZCk7CiAgfQoKICAvKioKICAgKiBAbm90aWNlIEFsbG93cyB0aGUgb3duZXIgdG8gcmV2b2tlIHRoZSB2ZXN0aW5nLiBUb2tlbnMgYWxyZWFkeSB2ZXN0ZWQKICAgKiByZW1haW4gaW4gdGhlIGNvbnRyYWN0LCB0aGUgcmVzdCBhcmUgcmV0dXJuZWQgdG8gdGhlIG93bmVyLgogICAqIEBwYXJhbSB0b2tlbiBFUkMyMCB0b2tlbiB3aGljaCBpcyBiZWluZyB2ZXN0ZWQKICAgKi8KICBmdW5jdGlvbiByZXZva2UoRVJDMjBCYXNpYyB0b2tlbikgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlKHJldm9jYWJsZSk7CiAgICByZXF1aXJlKCFyZXZva2VkW3Rva2VuXSk7CgogICAgdWludDI1NiBiYWxhbmNlID0gdG9rZW4uYmFsYW5jZU9mKHRoaXMpOwoKICAgIHVpbnQyNTYgdW5yZWxlYXNlZCA9IHJlbGVhc2FibGVBbW91bnQodG9rZW4pOwogICAgdWludDI1NiByZWZ1bmQgPSBiYWxhbmNlLnN1Yih1bnJlbGVhc2VkKTsKCiAgICByZXZva2VkW3Rva2VuXSA9IHRydWU7CgogICAgdG9rZW4uc2FmZVRyYW5zZmVyKG93bmVyLCByZWZ1bmQpOwoKICAgIFJldm9rZWQoKTsKICB9CgogIC8qKgogICAqIEBkZXYgQ2FsY3VsYXRlcyB0aGUgYW1vdW50IHRoYXQgaGFzIGFscmVhZHkgdmVzdGVkIGJ1dCBoYXNuJ3QgYmVlbiByZWxlYXNlZCB5ZXQuCiAgICogQHBhcmFtIHRva2VuIEVSQzIwIHRva2VuIHdoaWNoIGlzIGJlaW5nIHZlc3RlZAogICAqLwogIGZ1bmN0aW9uIHJlbGVhc2FibGVBbW91bnQoRVJDMjBCYXNpYyB0b2tlbikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHZlc3RlZEFtb3VudCh0b2tlbikuc3ViKHJlbGVhc2VkW3Rva2VuXSk7CiAgfQoKICAvKioKICAgKiBAZGV2IENhbGN1bGF0ZXMgdGhlIGFtb3VudCB0aGF0IGhhcyBhbHJlYWR5IHZlc3RlZC4KICAgKiBAcGFyYW0gdG9rZW4gRVJDMjAgdG9rZW4gd2hpY2ggaXMgYmVpbmcgdmVzdGVkCiAgICovCiAgZnVuY3Rpb24gdmVzdGVkQW1vdW50KEVSQzIwQmFzaWMgdG9rZW4pIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgY3VycmVudEJhbGFuY2UgPSB0b2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgICB1aW50MjU2IHRvdGFsQmFsYW5jZSA9IGN1cnJlbnRCYWxhbmNlLmFkZChyZWxlYXNlZFt0b2tlbl0pOwoKICAgIGlmIChub3cgPCBjbGlmZikgewogICAgICByZXR1cm4gMDsKICAgIH0gZWxzZSBpZiAobm93ID49IHN0YXJ0LmFkZChkdXJhdGlvbikgfHwgcmV2b2tlZFt0b2tlbl0pIHsKICAgICAgcmV0dXJuIHRvdGFsQmFsYW5jZTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiB0b3RhbEJhbGFuY2UubXVsKG5vdy5zdWIoc3RhcnQpKS5kaXYoZHVyYXRpb24pOwogICAgfQogIH0KfQoKLy8gRmlsZTogY29udHJhY3RzL0lua1Byb3RvY29sLnNvbAoKLy8vIEB0aXRsZSBJbmsgUHJvdG9jb2w6IERlY2VudHJhbGl6ZWQgcmVwdXRhdGlvbiBhbmQgcGF5bWVudHMgZm9yIHBlZXItdG8tcGVlciBtYXJrZXRwbGFjZXMuCmNvbnRyYWN0IElua1Byb3RvY29sIGlzIElua1Byb3RvY29sQ29yZSB7CiAgLy8gQWxsb2NhdGlvbiBhZGRyZXNzZXMuCiAgYWRkcmVzcyBwdWJsaWMgY29uc3RhbnQgX19hZGRyZXNzMF9fID0gMHhBMTNmZWJlRWRlMkIyOTI0Q2U4YjI3YzE1MTI4NzREMzU3NmZFQzE2OwogIGFkZHJlc3MgcHVibGljIGNvbnN0YW50IF9fYWRkcmVzczFfXyA9IDB4YzViQTcxNTdiNUI2OUIwZkFlOTMzMkYzMDcxOUVlY2Q3OTY0OTQ4NjsKICBhZGRyZXNzIHB1YmxpYyBjb25zdGFudCBfX2FkZHJlc3MyX18gPSAweDI5YTRiNDQzNjRBOEJjYjZlNGQ5ZGQ2MGMyMjJjQ2FjYTI4NmViZjI7CiAgYWRkcmVzcyBwdWJsaWMgY29uc3RhbnQgX19hZGRyZXNzM19fID0gMHhjMURDMWU1QzM5NzBFMjIyMDFDNURBQjA4NDFhYkIyREQ2NDk5RDNGOwogIGFkZHJlc3MgcHVibGljIGNvbnN0YW50IF9fYWRkcmVzczRfXyA9IDB4MDc0NmQwYjY3QkVEMjU4ZDk0RDA2YjE1ODU5ZGY4ZGJkOTkwZUMzRDsKCiAgLyoKICAgIENvbnN0cnVjdG9yIGZvciBNYWlubmV0LgogICovCgogIGZ1bmN0aW9uIElua1Byb3RvY29sKCkgcHVibGljIHsKICAgIC8vIFVuc29sZCB0b2tlbnMgZHVlIHRvIHRva2VuIHNhbGUgaGFyZCBjYXAuCiAgICBiYWxhbmNlc1tfX2FkZHJlc3MwX19dID0gMTk2MjU5NzM2OTc4OTU1MDAwMDAwMDAwMDA7CiAgICBUcmFuc2ZlcihhZGRyZXNzKDApLCBfX2FkZHJlc3MwX18sIGJhbGFuY2VPZihfX2FkZHJlc3MwX18pKTsKCiAgICAvLyBBbGxvY2F0ZSAzMiUgdG8gY29udHJhY3QgZm9yIGRpc3RyaWJ1dGlvbi4KICAgIC8vIFZlc3Rpbmcgc3RhcnRzIEZlYiAyOCwgMjAxOCBAIDAwOjAwOjAwIEdNVAogICAgVG9rZW5WZXN0aW5nIHZlc3RpbmcxID0gbmV3IFRva2VuVmVzdGluZyhfX2FkZHJlc3MxX18sIDE1MTk3NzYwMDAsIDAsIDMgeWVhcnMsIGZhbHNlKTsKICAgIGJhbGFuY2VzW3Zlc3RpbmcxXSA9IDE2MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDsKICAgIFRyYW5zZmVyKGFkZHJlc3MoMCksIHZlc3RpbmcxLCBiYWxhbmNlT2YodmVzdGluZzEpKTsKCiAgICAvLyBBbGxvY2F0ZSAzMiUgdG8gY29udHJhY3QgZm9yIExpc3RpYSBJbmMuCiAgICAvLyBWZXN0aW5nIHN0YXJ0cyBGZWIgMjgsIDIwMTggQCAwMDowMDowMCBHTVQKICAgIFRva2VuVmVzdGluZyB2ZXN0aW5nMiA9IG5ldyBUb2tlblZlc3RpbmcoX19hZGRyZXNzMl9fLCAxNTE5Nzc2MDAwLCAwLCAzIHllYXJzLCBmYWxzZSk7CiAgICBiYWxhbmNlc1t2ZXN0aW5nMl0gPSAxNjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDA7CiAgICBUcmFuc2ZlcihhZGRyZXNzKDApLCB2ZXN0aW5nMiwgYmFsYW5jZU9mKHZlc3RpbmcyKSk7CgogICAgLy8gQWxsb2NhdGUgNiUgdG8gd2FsbGV0IGZvciBMaXN0aWEgTWFya2V0cGxhY2UgY3JlZGl0IGNvbnZlcnNpb24uCiAgICBiYWxhbmNlc1tfX2FkZHJlc3MzX19dID0gMzAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDA7CiAgICBUcmFuc2ZlcihhZGRyZXNzKDApLCBfX2FkZHJlc3MzX18sIGJhbGFuY2VPZihfX2FkZHJlc3MzX18pKTsKCiAgICAvLyBBbGxvY2F0ZSB0byB3YWxsZXQgZm9yIHRva2VuIHNhbGUgZGlzdHJpYnV0aW9uLgogICAgYmFsYW5jZXNbX19hZGRyZXNzNF9fXSA9IDEzMDM3NDAyNjMwMjEwNDUwMDAwMDAwMDAwMDsKICAgIFRyYW5zZmVyKGFkZHJlc3MoMCksIF9fYWRkcmVzczRfXywgYmFsYW5jZU9mKF9fYWRkcmVzczRfXykpOwogIH0KfQ=='.
	

]
