Class {
	#name : #SRT552f355ccb9b91c8fb47d9c011abad5b72ec30e9,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT552f355ccb9b91c8fb47d9c011abad5b72ec30e9 >> base64 [
	^ 'Ly8gaGV2bTogZmxhdHRlbmVkIHNvdXJjZXMgb2Ygc3JjL2ZhYi5zb2wKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovLy8vLy8gbGliL2RzLWd1YXJkL2xpYi9kcy1hdXRoL3NyYy9hdXRoLnNvbAovLyBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQovLyBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQovLyB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvcgovLyAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgoKLy8gVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCi8vIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCi8vIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUKLy8gR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KCi8vIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCi8vIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LgoKLyogcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7ICovCgpjb250cmFjdCBEU0F1dGhvcml0eSB7CiAgICBmdW5jdGlvbiBjYW5DYWxsKAogICAgICAgIGFkZHJlc3Mgc3JjLCBhZGRyZXNzIGRzdCwgYnl0ZXM0IHNpZwogICAgKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKTsKfQoKY29udHJhY3QgRFNBdXRoRXZlbnRzIHsKICAgIGV2ZW50IExvZ1NldEF1dGhvcml0eSAoYWRkcmVzcyBpbmRleGVkIGF1dGhvcml0eSk7CiAgICBldmVudCBMb2dTZXRPd25lciAgICAgKGFkZHJlc3MgaW5kZXhlZCBvd25lcik7Cn0KCmNvbnRyYWN0IERTQXV0aCBpcyBEU0F1dGhFdmVudHMgewogICAgRFNBdXRob3JpdHkgIHB1YmxpYyAgYXV0aG9yaXR5OwogICAgYWRkcmVzcyAgICAgIHB1YmxpYyAgb3duZXI7CgogICAgZnVuY3Rpb24gRFNBdXRoKCkgcHVibGljIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICAgICAgTG9nU2V0T3duZXIobXNnLnNlbmRlcik7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0T3duZXIoYWRkcmVzcyBvd25lcl8pCiAgICAgICAgcHVibGljCiAgICAgICAgYXV0aAogICAgewogICAgICAgIG93bmVyID0gb3duZXJfOwogICAgICAgIExvZ1NldE93bmVyKG93bmVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRBdXRob3JpdHkoRFNBdXRob3JpdHkgYXV0aG9yaXR5XykKICAgICAgICBwdWJsaWMKICAgICAgICBhdXRoCiAgICB7CiAgICAgICAgYXV0aG9yaXR5ID0gYXV0aG9yaXR5XzsKICAgICAgICBMb2dTZXRBdXRob3JpdHkoYXV0aG9yaXR5KTsKICAgIH0KCiAgICBtb2RpZmllciBhdXRoIHsKICAgICAgICByZXF1aXJlKGlzQXV0aG9yaXplZChtc2cuc2VuZGVyLCBtc2cuc2lnKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBpc0F1dGhvcml6ZWQoYWRkcmVzcyBzcmMsIGJ5dGVzNCBzaWcpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGlmIChzcmMgPT0gYWRkcmVzcyh0aGlzKSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgaWYgKHNyYyA9PSBvd25lcikgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgaWYgKGF1dGhvcml0eSA9PSBEU0F1dGhvcml0eSgwKSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGF1dGhvcml0eS5jYW5DYWxsKHNyYywgdGhpcywgc2lnKTsKICAgICAgICB9CiAgICB9Cn0KCi8vLy8vLyBsaWIvZHMtZ3VhcmQvc3JjL2d1YXJkLnNvbAovLyBndWFyZC5zb2wgLS0gc2ltcGxlIHdoaXRlbGlzdCBpbXBsZW1lbnRhdGlvbiBvZiBEU0F1dGhvcml0eQoKLy8gQ29weXJpZ2h0IChDKSAyMDE3ICBEYXBwSHViLCBMTEMKCi8vIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5Ci8vIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5Ci8vIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yCi8vIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCgovLyBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKLy8gYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKLy8gTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQovLyBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgoKLy8gWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UKLy8gYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uCgovKiBwcmFnbWEgc29saWRpdHkgXjAuNC4xMzsgKi8KCi8qIGltcG9ydCAiZHMtYXV0aC9hdXRoLnNvbCI7ICovCgpjb250cmFjdCBEU0d1YXJkRXZlbnRzIHsKICAgIGV2ZW50IExvZ1Blcm1pdCgKICAgICAgICBieXRlczMyIGluZGV4ZWQgc3JjLAogICAgICAgIGJ5dGVzMzIgaW5kZXhlZCBkc3QsCiAgICAgICAgYnl0ZXMzMiBpbmRleGVkIHNpZwogICAgKTsKCiAgICBldmVudCBMb2dGb3JiaWQoCiAgICAgICAgYnl0ZXMzMiBpbmRleGVkIHNyYywKICAgICAgICBieXRlczMyIGluZGV4ZWQgZHN0LAogICAgICAgIGJ5dGVzMzIgaW5kZXhlZCBzaWcKICAgICk7Cn0KCmNvbnRyYWN0IERTR3VhcmQgaXMgRFNBdXRoLCBEU0F1dGhvcml0eSwgRFNHdWFyZEV2ZW50cyB7CiAgICBieXRlczMyIGNvbnN0YW50IHB1YmxpYyBBTlkgPSBieXRlczMyKHVpbnQoLTEpKTsKCiAgICBtYXBwaW5nIChieXRlczMyID0+IG1hcHBpbmcgKGJ5dGVzMzIgPT4gbWFwcGluZyAoYnl0ZXMzMiA9PiBib29sKSkpIGFjbDsKCiAgICBmdW5jdGlvbiBjYW5DYWxsKAogICAgICAgIGFkZHJlc3Mgc3JjXywgYWRkcmVzcyBkc3RfLCBieXRlczQgc2lnCiAgICApIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICB2YXIgc3JjID0gYnl0ZXMzMihzcmNfKTsKICAgICAgICB2YXIgZHN0ID0gYnl0ZXMzMihkc3RfKTsKCiAgICAgICAgcmV0dXJuIGFjbFtzcmNdW2RzdF1bc2lnXQogICAgICAgICAgICB8fCBhY2xbc3JjXVtkc3RdW0FOWV0KICAgICAgICAgICAgfHwgYWNsW3NyY11bQU5ZXVtzaWddCiAgICAgICAgICAgIHx8IGFjbFtzcmNdW0FOWV1bQU5ZXQogICAgICAgICAgICB8fCBhY2xbQU5ZXVtkc3RdW3NpZ10KICAgICAgICAgICAgfHwgYWNsW0FOWV1bZHN0XVtBTlldCiAgICAgICAgICAgIHx8IGFjbFtBTlldW0FOWV1bc2lnXQogICAgICAgICAgICB8fCBhY2xbQU5ZXVtBTlldW0FOWV07CiAgICB9CgogICAgZnVuY3Rpb24gcGVybWl0KGJ5dGVzMzIgc3JjLCBieXRlczMyIGRzdCwgYnl0ZXMzMiBzaWcpIHB1YmxpYyBhdXRoIHsKICAgICAgICBhY2xbc3JjXVtkc3RdW3NpZ10gPSB0cnVlOwogICAgICAgIExvZ1Blcm1pdChzcmMsIGRzdCwgc2lnKTsKICAgIH0KCiAgICBmdW5jdGlvbiBmb3JiaWQoYnl0ZXMzMiBzcmMsIGJ5dGVzMzIgZHN0LCBieXRlczMyIHNpZykgcHVibGljIGF1dGggewogICAgICAgIGFjbFtzcmNdW2RzdF1bc2lnXSA9IGZhbHNlOwogICAgICAgIExvZ0ZvcmJpZChzcmMsIGRzdCwgc2lnKTsKICAgIH0KCiAgICBmdW5jdGlvbiBwZXJtaXQoYWRkcmVzcyBzcmMsIGFkZHJlc3MgZHN0LCBieXRlczMyIHNpZykgcHVibGljIHsKICAgICAgICBwZXJtaXQoYnl0ZXMzMihzcmMpLCBieXRlczMyKGRzdCksIHNpZyk7CiAgICB9CiAgICBmdW5jdGlvbiBmb3JiaWQoYWRkcmVzcyBzcmMsIGFkZHJlc3MgZHN0LCBieXRlczMyIHNpZykgcHVibGljIHsKICAgICAgICBmb3JiaWQoYnl0ZXMzMihzcmMpLCBieXRlczMyKGRzdCksIHNpZyk7CiAgICB9Cgp9Cgpjb250cmFjdCBEU0d1YXJkRmFjdG9yeSB7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpICBwdWJsaWMgIGlzR3VhcmQ7CgogICAgZnVuY3Rpb24gbmV3R3VhcmQoKSBwdWJsaWMgcmV0dXJucyAoRFNHdWFyZCBndWFyZCkgewogICAgICAgIGd1YXJkID0gbmV3IERTR3VhcmQoKTsKICAgICAgICBndWFyZC5zZXRPd25lcihtc2cuc2VuZGVyKTsKICAgICAgICBpc0d1YXJkW2d1YXJkXSA9IHRydWU7CiAgICB9Cn0KCi8vLy8vLyBsaWIvZHMtcm9sZXMvc3JjL3JvbGVzLnNvbAovLyByb2xlcy5zb2wgLSByb2xlZCBiYXNlZCBhdXRoZW50aWNhdGlvbgoKLy8gQ29weXJpZ2h0IChDKSAyMDE3ICBEYXBwSHViLCBMTEMKCi8vIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5Ci8vIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5Ci8vIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yCi8vIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCgovLyBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKLy8gYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKLy8gTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQovLyBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgoKLy8gWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UKLy8gYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uCgovKiBwcmFnbWEgc29saWRpdHkgXjAuNC4xMzsgKi8KCi8qIGltcG9ydCAnZHMtYXV0aC9hdXRoLnNvbCc7ICovCgpjb250cmFjdCBEU1JvbGVzIGlzIERTQXV0aCwgRFNBdXRob3JpdHkKewogICAgbWFwcGluZyhhZGRyZXNzPT5ib29sKSBfcm9vdF91c2VyczsKICAgIG1hcHBpbmcoYWRkcmVzcz0+Ynl0ZXMzMikgX3VzZXJfcm9sZXM7CiAgICBtYXBwaW5nKGFkZHJlc3M9Pm1hcHBpbmcoYnl0ZXM0PT5ieXRlczMyKSkgX2NhcGFiaWxpdHlfcm9sZXM7CiAgICBtYXBwaW5nKGFkZHJlc3M9Pm1hcHBpbmcoYnl0ZXM0PT5ib29sKSkgX3B1YmxpY19jYXBhYmlsaXRpZXM7CgogICAgZnVuY3Rpb24gZ2V0VXNlclJvbGVzKGFkZHJlc3Mgd2hvKQogICAgICAgIHB1YmxpYwogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zIChieXRlczMyKQogICAgewogICAgICAgIHJldHVybiBfdXNlcl9yb2xlc1t3aG9dOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldENhcGFiaWxpdHlSb2xlcyhhZGRyZXNzIGNvZGUsIGJ5dGVzNCBzaWcpCiAgICAgICAgcHVibGljCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKGJ5dGVzMzIpCiAgICB7CiAgICAgICAgcmV0dXJuIF9jYXBhYmlsaXR5X3JvbGVzW2NvZGVdW3NpZ107CiAgICB9CgogICAgZnVuY3Rpb24gaXNVc2VyUm9vdChhZGRyZXNzIHdobykKICAgICAgICBwdWJsaWMKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXR1cm4gX3Jvb3RfdXNlcnNbd2hvXTsKICAgIH0KCiAgICBmdW5jdGlvbiBpc0NhcGFiaWxpdHlQdWJsaWMoYWRkcmVzcyBjb2RlLCBieXRlczQgc2lnKQogICAgICAgIHB1YmxpYwogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJldHVybiBfcHVibGljX2NhcGFiaWxpdGllc1tjb2RlXVtzaWddOwogICAgfQoKICAgIGZ1bmN0aW9uIGhhc1VzZXJSb2xlKGFkZHJlc3Mgd2hvLCB1aW50OCByb2xlKQogICAgICAgIHB1YmxpYwogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGJ5dGVzMzIgcm9sZXMgPSBnZXRVc2VyUm9sZXMod2hvKTsKICAgICAgICBieXRlczMyIHNoaWZ0ZWQgPSBieXRlczMyKHVpbnQyNTYodWludDI1NigyKSAqKiB1aW50MjU2KHJvbGUpKSk7CiAgICAgICAgcmV0dXJuIGJ5dGVzMzIoMCkgIT0gcm9sZXMgJiBzaGlmdGVkOwogICAgfQoKICAgIGZ1bmN0aW9uIGNhbkNhbGwoYWRkcmVzcyBjYWxsZXIsIGFkZHJlc3MgY29kZSwgYnl0ZXM0IHNpZykKICAgICAgICBwdWJsaWMKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBpZiggaXNVc2VyUm9vdChjYWxsZXIpIHx8IGlzQ2FwYWJpbGl0eVB1YmxpYyhjb2RlLCBzaWcpICkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgaGFzX3JvbGVzID0gZ2V0VXNlclJvbGVzKGNhbGxlcik7CiAgICAgICAgICAgIHZhciBuZWVkc19vbmVfb2YgPSBnZXRDYXBhYmlsaXR5Um9sZXMoY29kZSwgc2lnKTsKICAgICAgICAgICAgcmV0dXJuIGJ5dGVzMzIoMCkgIT0gaGFzX3JvbGVzICYgbmVlZHNfb25lX29mOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBCSVROT1QoYnl0ZXMzMiBpbnB1dCkgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChieXRlczMyIG91dHB1dCkgewogICAgICAgIHJldHVybiAoaW5wdXQgXiBieXRlczMyKHVpbnQoLTEpKSk7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0Um9vdFVzZXIoYWRkcmVzcyB3aG8sIGJvb2wgZW5hYmxlZCkKICAgICAgICBwdWJsaWMKICAgICAgICBhdXRoCiAgICB7CiAgICAgICAgX3Jvb3RfdXNlcnNbd2hvXSA9IGVuYWJsZWQ7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0VXNlclJvbGUoYWRkcmVzcyB3aG8sIHVpbnQ4IHJvbGUsIGJvb2wgZW5hYmxlZCkKICAgICAgICBwdWJsaWMKICAgICAgICBhdXRoCiAgICB7CiAgICAgICAgdmFyIGxhc3Rfcm9sZXMgPSBfdXNlcl9yb2xlc1t3aG9dOwogICAgICAgIGJ5dGVzMzIgc2hpZnRlZCA9IGJ5dGVzMzIodWludDI1Nih1aW50MjU2KDIpICoqIHVpbnQyNTYocm9sZSkpKTsKICAgICAgICBpZiggZW5hYmxlZCApIHsKICAgICAgICAgICAgX3VzZXJfcm9sZXNbd2hvXSA9IGxhc3Rfcm9sZXMgfCBzaGlmdGVkOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF91c2VyX3JvbGVzW3dob10gPSBsYXN0X3JvbGVzICYgQklUTk9UKHNoaWZ0ZWQpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBzZXRQdWJsaWNDYXBhYmlsaXR5KGFkZHJlc3MgY29kZSwgYnl0ZXM0IHNpZywgYm9vbCBlbmFibGVkKQogICAgICAgIHB1YmxpYwogICAgICAgIGF1dGgKICAgIHsKICAgICAgICBfcHVibGljX2NhcGFiaWxpdGllc1tjb2RlXVtzaWddID0gZW5hYmxlZDsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRSb2xlQ2FwYWJpbGl0eSh1aW50OCByb2xlLCBhZGRyZXNzIGNvZGUsIGJ5dGVzNCBzaWcsIGJvb2wgZW5hYmxlZCkKICAgICAgICBwdWJsaWMKICAgICAgICBhdXRoCiAgICB7CiAgICAgICAgdmFyIGxhc3Rfcm9sZXMgPSBfY2FwYWJpbGl0eV9yb2xlc1tjb2RlXVtzaWddOwogICAgICAgIGJ5dGVzMzIgc2hpZnRlZCA9IGJ5dGVzMzIodWludDI1Nih1aW50MjU2KDIpICoqIHVpbnQyNTYocm9sZSkpKTsKICAgICAgICBpZiggZW5hYmxlZCApIHsKICAgICAgICAgICAgX2NhcGFiaWxpdHlfcm9sZXNbY29kZV1bc2lnXSA9IGxhc3Rfcm9sZXMgfCBzaGlmdGVkOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF9jYXBhYmlsaXR5X3JvbGVzW2NvZGVdW3NpZ10gPSBsYXN0X3JvbGVzICYgQklUTk9UKHNoaWZ0ZWQpOwogICAgICAgIH0KCiAgICB9Cgp9CgovLy8vLy8gbGliL2RzLXNwZWxsL2xpYi9kcy1ub3RlL3NyYy9ub3RlLnNvbAovLy8gbm90ZS5zb2wgLS0gdGhlIGBub3RlJyBtb2RpZmllciwgZm9yIGxvZ2dpbmcgY2FsbHMgYXMgZXZlbnRzCgovLyBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQovLyBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQovLyB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvcgovLyAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgoKLy8gVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCi8vIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCi8vIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUKLy8gR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KCi8vIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCi8vIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LgoKLyogcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7ICovCgpjb250cmFjdCBEU05vdGUgewogICAgZXZlbnQgTG9nTm90ZSgKICAgICAgICBieXRlczQgICBpbmRleGVkICBzaWcsCiAgICAgICAgYWRkcmVzcyAgaW5kZXhlZCAgZ3V5LAogICAgICAgIGJ5dGVzMzIgIGluZGV4ZWQgIGZvbywKICAgICAgICBieXRlczMyICBpbmRleGVkICBiYXIsCiAgICAgICAgdWludCAgICAgICAgICAgICAgd2FkLAogICAgICAgIGJ5dGVzICAgICAgICAgICAgIGZheAogICAgKSBhbm9ueW1vdXM7CgogICAgbW9kaWZpZXIgbm90ZSB7CiAgICAgICAgYnl0ZXMzMiBmb287CiAgICAgICAgYnl0ZXMzMiBiYXI7CgogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgZm9vIDo9IGNhbGxkYXRhbG9hZCg0KQogICAgICAgICAgICBiYXIgOj0gY2FsbGRhdGFsb2FkKDM2KQogICAgICAgIH0KCiAgICAgICAgTG9nTm90ZShtc2cuc2lnLCBtc2cuc2VuZGVyLCBmb28sIGJhciwgbXNnLnZhbHVlLCBtc2cuZGF0YSk7CgogICAgICAgIF87CiAgICB9Cn0KCi8vLy8vLyBsaWIvZHMtdGhpbmcvbGliL2RzLW1hdGgvc3JjL21hdGguc29sCi8vLyBtYXRoLnNvbCAtLSBtaXhpbiBmb3IgaW5saW5lIG51bWVyaWNhbCB3aXphcmRyeQoKLy8gVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKLy8gaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkKLy8gdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3IKLy8gKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KCi8vIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAovLyBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgovLyBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCi8vIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCgovLyBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQovLyBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KCi8qIHByYWdtYSBzb2xpZGl0eSBeMC40LjEzOyAqLwoKY29udHJhY3QgRFNNYXRoIHsKICAgIGZ1bmN0aW9uIGFkZCh1aW50IHgsIHVpbnQgeSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50IHopIHsKICAgICAgICByZXF1aXJlKCh6ID0geCArIHkpID49IHgpOwogICAgfQogICAgZnVuY3Rpb24gc3ViKHVpbnQgeCwgdWludCB5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgeikgewogICAgICAgIHJlcXVpcmUoKHogPSB4IC0geSkgPD0geCk7CiAgICB9CiAgICBmdW5jdGlvbiBtdWwodWludCB4LCB1aW50IHkpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCB6KSB7CiAgICAgICAgcmVxdWlyZSh5ID09IDAgfHwgKHogPSB4ICogeSkgLyB5ID09IHgpOwogICAgfQoKICAgIGZ1bmN0aW9uIG1pbih1aW50IHgsIHVpbnQgeSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50IHopIHsKICAgICAgICByZXR1cm4geCA8PSB5ID8geCA6IHk7CiAgICB9CiAgICBmdW5jdGlvbiBtYXgodWludCB4LCB1aW50IHkpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCB6KSB7CiAgICAgICAgcmV0dXJuIHggPj0geSA/IHggOiB5OwogICAgfQogICAgZnVuY3Rpb24gaW1pbihpbnQgeCwgaW50IHkpIGludGVybmFsIHB1cmUgcmV0dXJucyAoaW50IHopIHsKICAgICAgICByZXR1cm4geCA8PSB5ID8geCA6IHk7CiAgICB9CiAgICBmdW5jdGlvbiBpbWF4KGludCB4LCBpbnQgeSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChpbnQgeikgewogICAgICAgIHJldHVybiB4ID49IHkgPyB4IDogeTsKICAgIH0KCiAgICB1aW50IGNvbnN0YW50IFdBRCA9IDEwICoqIDE4OwogICAgdWludCBjb25zdGFudCBSQVkgPSAxMCAqKiAyNzsKCiAgICBmdW5jdGlvbiB3bXVsKHVpbnQgeCwgdWludCB5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgeikgewogICAgICAgIHogPSBhZGQobXVsKHgsIHkpLCBXQUQgLyAyKSAvIFdBRDsKICAgIH0KICAgIGZ1bmN0aW9uIHJtdWwodWludCB4LCB1aW50IHkpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCB6KSB7CiAgICAgICAgeiA9IGFkZChtdWwoeCwgeSksIFJBWSAvIDIpIC8gUkFZOwogICAgfQogICAgZnVuY3Rpb24gd2Rpdih1aW50IHgsIHVpbnQgeSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50IHopIHsKICAgICAgICB6ID0gYWRkKG11bCh4LCBXQUQpLCB5IC8gMikgLyB5OwogICAgfQogICAgZnVuY3Rpb24gcmRpdih1aW50IHgsIHVpbnQgeSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50IHopIHsKICAgICAgICB6ID0gYWRkKG11bCh4LCBSQVkpLCB5IC8gMikgLyB5OwogICAgfQoKICAgIC8vIFRoaXMgZmFtb3VzIGFsZ29yaXRobSBpcyBjYWxsZWQgImV4cG9uZW50aWF0aW9uIGJ5IHNxdWFyaW5nIgogICAgLy8gYW5kIGNhbGN1bGF0ZXMgeF5uIHdpdGggeCBhcyBmaXhlZC1wb2ludCBhbmQgbiBhcyByZWd1bGFyIHVuc2lnbmVkLgogICAgLy8KICAgIC8vIEl0J3MgTyhsb2cgbiksIGluc3RlYWQgb2YgTyhuKSBmb3IgbmFpdmUgcmVwZWF0ZWQgbXVsdGlwbGljYXRpb24uCiAgICAvLwogICAgLy8gVGhlc2UgZmFjdHMgYXJlIHdoeSBpdCB3b3JrczoKICAgIC8vCiAgICAvLyAgSWYgbiBpcyBldmVuLCB0aGVuIHhebiA9ICh4XjIpXihuLzIpLgogICAgLy8gIElmIG4gaXMgb2RkLCAgdGhlbiB4Xm4gPSB4ICogeF4obi0xKSwKICAgIC8vICAgYW5kIGFwcGx5aW5nIHRoZSBlcXVhdGlvbiBmb3IgZXZlbiB4IGdpdmVzCiAgICAvLyAgICB4Xm4gPSB4ICogKHheMileKChuLTEpIC8gMikuCiAgICAvLwogICAgLy8gIEFsc28sIEVWTSBkaXZpc2lvbiBpcyBmbG9vcmluZyBhbmQKICAgIC8vICAgIGZsb29yWyhuLTEpIC8gMl0gPSBmbG9vcltuIC8gMl0uCiAgICAvLwogICAgZnVuY3Rpb24gcnBvdyh1aW50IHgsIHVpbnQgbikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50IHopIHsKICAgICAgICB6ID0gbiAlIDIgIT0gMCA/IHggOiBSQVk7CgogICAgICAgIGZvciAobiAvPSAyOyBuICE9IDA7IG4gLz0gMikgewogICAgICAgICAgICB4ID0gcm11bCh4LCB4KTsKCiAgICAgICAgICAgIGlmIChuICUgMiAhPSAwKSB7CiAgICAgICAgICAgICAgICB6ID0gcm11bCh6LCB4KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKLy8vLy8vIGxpYi9kcy10aGluZy9zcmMvdGhpbmcuc29sCi8vIHRoaW5nLnNvbCAtIGBhdXRoYCB3aXRoIGhhbmR5IG1peGlucy4geW91ciB0aGluZ3Mgc2hvdWxkIGJlIERTVGhpbmdzCgovLyBDb3B5cmlnaHQgKEMpIDIwMTcgIERhcHBIdWIsIExMQwoKLy8gVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKLy8gaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkKLy8gdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3IKLy8gKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KCi8vIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAovLyBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgovLyBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCi8vIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCgovLyBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQovLyBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KCi8qIHByYWdtYSBzb2xpZGl0eSBeMC40LjEzOyAqLwoKLyogaW1wb3J0ICdkcy1hdXRoL2F1dGguc29sJzsgKi8KLyogaW1wb3J0ICdkcy1ub3RlL25vdGUuc29sJzsgKi8KLyogaW1wb3J0ICdkcy1tYXRoL21hdGguc29sJzsgKi8KCmNvbnRyYWN0IERTVGhpbmcgaXMgRFNBdXRoLCBEU05vdGUsIERTTWF0aCB7CgogICAgZnVuY3Rpb24gUyhzdHJpbmcgcykgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChieXRlczQpIHsKICAgICAgICByZXR1cm4gYnl0ZXM0KGtlY2NhazI1NihzKSk7CiAgICB9Cgp9CgovLy8vLy8gbGliL2RzLXRva2VuL2xpYi9kcy1zdG9wL3NyYy9zdG9wLnNvbAovLy8gc3RvcC5zb2wgLS0gbWl4aW4gZm9yIGVuYWJsZS9kaXNhYmxlIGZ1bmN0aW9uYWxpdHkKCi8vIENvcHlyaWdodCAoQykgMjAxNyAgRGFwcEh1YiwgTExDCgovLyBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQovLyBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQovLyB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvcgovLyAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgoKLy8gVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCi8vIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCi8vIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUKLy8gR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KCi8vIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCi8vIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LgoKLyogcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7ICovCgovKiBpbXBvcnQgImRzLWF1dGgvYXV0aC5zb2wiOyAqLwovKiBpbXBvcnQgImRzLW5vdGUvbm90ZS5zb2wiOyAqLwoKY29udHJhY3QgRFNTdG9wIGlzIERTTm90ZSwgRFNBdXRoIHsKCiAgICBib29sIHB1YmxpYyBzdG9wcGVkOwoKICAgIG1vZGlmaWVyIHN0b3BwYWJsZSB7CiAgICAgICAgcmVxdWlyZSghc3RvcHBlZCk7CiAgICAgICAgXzsKICAgIH0KICAgIGZ1bmN0aW9uIHN0b3AoKSBwdWJsaWMgYXV0aCBub3RlIHsKICAgICAgICBzdG9wcGVkID0gdHJ1ZTsKICAgIH0KICAgIGZ1bmN0aW9uIHN0YXJ0KCkgcHVibGljIGF1dGggbm90ZSB7CiAgICAgICAgc3RvcHBlZCA9IGZhbHNlOwogICAgfQoKfQoKLy8vLy8vIGxpYi9kcy10b2tlbi9saWIvZXJjMjAvc3JjL2VyYzIwLnNvbAovLy8gZXJjMjAuc29sIC0tIEFQSSBmb3IgdGhlIEVSQzIwIHRva2VuIHN0YW5kYXJkCgovLyBTZWUgPGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMD4uCgovLyBUaGlzIGZpbGUgbGlrZWx5IGRvZXMgbm90IG1lZXQgdGhlIHRocmVzaG9sZCBvZiBvcmlnaW5hbGl0eQovLyByZXF1aXJlZCBmb3IgY29weXJpZ2h0IHRvIGFwcGx5LiAgQXMgYSByZXN1bHQsIHRoaXMgaXMgZnJlZSBhbmQKLy8gdW5lbmN1bWJlcmVkIHNvZnR3YXJlIGJlbG9uZ2luZyB0byB0aGUgcHVibGljIGRvbWFpbi4KCi8qIHByYWdtYSBzb2xpZGl0eSBeMC40Ljg7ICovCgpjb250cmFjdCBFUkMyMEV2ZW50cyB7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgc3JjLCBhZGRyZXNzIGluZGV4ZWQgZ3V5LCB1aW50IHdhZCk7CiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgc3JjLCBhZGRyZXNzIGluZGV4ZWQgZHN0LCB1aW50IHdhZCk7Cn0KCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwRXZlbnRzIHsKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCk7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBndXkpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpOwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgc3JjLCBhZGRyZXNzIGd1eSkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCk7CgogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIGd1eSwgdWludCB3YWQpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgZHN0LCB1aW50IHdhZCkgcHVibGljIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKAogICAgICAgIGFkZHJlc3Mgc3JjLCBhZGRyZXNzIGRzdCwgdWludCB3YWQKICAgICkgcHVibGljIHJldHVybnMgKGJvb2wpOwp9CgovLy8vLy8gbGliL2RzLXRva2VuL3NyYy9iYXNlLnNvbAovLy8gYmFzZS5zb2wgLS0gYmFzaWMgRVJDMjAgaW1wbGVtZW50YXRpb24KCi8vIENvcHlyaWdodCAoQykgMjAxNSwgMjAxNiwgMjAxNyAgRGFwcEh1YiwgTExDCgovLyBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQovLyBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQovLyB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvcgovLyAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgoKLy8gVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCi8vIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCi8vIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUKLy8gR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KCi8vIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCi8vIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LgoKLyogcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7ICovCgovKiBpbXBvcnQgImVyYzIwL2VyYzIwLnNvbCI7ICovCi8qIGltcG9ydCAiZHMtbWF0aC9tYXRoLnNvbCI7ICovCgpjb250cmFjdCBEU1Rva2VuQmFzZSBpcyBFUkMyMCwgRFNNYXRoIHsKICAgIHVpbnQyNTYgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9zdXBwbHk7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpICAgICAgICAgICAgICAgICAgICAgICBfYmFsYW5jZXM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpICBfYXBwcm92YWxzOwoKICAgIGZ1bmN0aW9uIERTVG9rZW5CYXNlKHVpbnQgc3VwcGx5KSBwdWJsaWMgewogICAgICAgIF9iYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHN1cHBseTsKICAgICAgICBfc3VwcGx5ID0gc3VwcGx5OwogICAgfQoKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBfc3VwcGx5OwogICAgfQogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgc3JjKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIF9iYWxhbmNlc1tzcmNdOwogICAgfQogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgc3JjLCBhZGRyZXNzIGd1eSkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBfYXBwcm92YWxzW3NyY11bZ3V5XTsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIGRzdCwgdWludCB3YWQpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHRyYW5zZmVyRnJvbShtc2cuc2VuZGVyLCBkc3QsIHdhZCk7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3Mgc3JjLCBhZGRyZXNzIGRzdCwgdWludCB3YWQpCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBpZiAoc3JjICE9IG1zZy5zZW5kZXIpIHsKICAgICAgICAgICAgX2FwcHJvdmFsc1tzcmNdW21zZy5zZW5kZXJdID0gc3ViKF9hcHByb3ZhbHNbc3JjXVttc2cuc2VuZGVyXSwgd2FkKTsKICAgICAgICB9CgogICAgICAgIF9iYWxhbmNlc1tzcmNdID0gc3ViKF9iYWxhbmNlc1tzcmNdLCB3YWQpOwogICAgICAgIF9iYWxhbmNlc1tkc3RdID0gYWRkKF9iYWxhbmNlc1tkc3RdLCB3YWQpOwoKICAgICAgICBUcmFuc2ZlcihzcmMsIGRzdCwgd2FkKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIGd1eSwgdWludCB3YWQpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgX2FwcHJvdmFsc1ttc2cuc2VuZGVyXVtndXldID0gd2FkOwoKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBndXksIHdhZCk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQp9CgovLy8vLy8gbGliL2RzLXRva2VuL3NyYy90b2tlbi5zb2wKLy8vIHRva2VuLnNvbCAtLSBFUkMyMCBpbXBsZW1lbnRhdGlvbiB3aXRoIG1pbnRpbmcgYW5kIGJ1cm5pbmcKCi8vIENvcHlyaWdodCAoQykgMjAxNSwgMjAxNiwgMjAxNyAgRGFwcEh1YiwgTExDCgovLyBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQovLyBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQovLyB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvcgovLyAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgoKLy8gVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCi8vIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCi8vIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUKLy8gR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KCi8vIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCi8vIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LgoKLyogcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7ICovCgovKiBpbXBvcnQgImRzLXN0b3Avc3RvcC5zb2wiOyAqLwoKLyogaW1wb3J0ICIuL2Jhc2Uuc29sIjsgKi8KCmNvbnRyYWN0IERTVG9rZW4gaXMgRFNUb2tlbkJhc2UoMCksIERTU3RvcCB7CgogICAgYnl0ZXMzMiAgcHVibGljICBzeW1ib2w7CiAgICB1aW50MjU2ICBwdWJsaWMgIGRlY2ltYWxzID0gMTg7IC8vIHN0YW5kYXJkIHRva2VuIHByZWNpc2lvbi4gb3ZlcnJpZGUgdG8gY3VzdG9taXplCgogICAgZnVuY3Rpb24gRFNUb2tlbihieXRlczMyIHN5bWJvbF8pIHB1YmxpYyB7CiAgICAgICAgc3ltYm9sID0gc3ltYm9sXzsKICAgIH0KCiAgICBldmVudCBNaW50KGFkZHJlc3MgaW5kZXhlZCBndXksIHVpbnQgd2FkKTsKICAgIGV2ZW50IEJ1cm4oYWRkcmVzcyBpbmRleGVkIGd1eSwgdWludCB3YWQpOwoKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBndXkpIHB1YmxpYyBzdG9wcGFibGUgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBzdXBlci5hcHByb3ZlKGd1eSwgdWludCgtMSkpOwogICAgfQoKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBndXksIHVpbnQgd2FkKSBwdWJsaWMgc3RvcHBhYmxlIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gc3VwZXIuYXBwcm92ZShndXksIHdhZCk7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3Mgc3JjLCBhZGRyZXNzIGRzdCwgdWludCB3YWQpCiAgICAgICAgcHVibGljCiAgICAgICAgc3RvcHBhYmxlCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBpZiAoc3JjICE9IG1zZy5zZW5kZXIgJiYgX2FwcHJvdmFsc1tzcmNdW21zZy5zZW5kZXJdICE9IHVpbnQoLTEpKSB7CiAgICAgICAgICAgIF9hcHByb3ZhbHNbc3JjXVttc2cuc2VuZGVyXSA9IHN1YihfYXBwcm92YWxzW3NyY11bbXNnLnNlbmRlcl0sIHdhZCk7CiAgICAgICAgfQoKICAgICAgICBfYmFsYW5jZXNbc3JjXSA9IHN1YihfYmFsYW5jZXNbc3JjXSwgd2FkKTsKICAgICAgICBfYmFsYW5jZXNbZHN0XSA9IGFkZChfYmFsYW5jZXNbZHN0XSwgd2FkKTsKCiAgICAgICAgVHJhbnNmZXIoc3JjLCBkc3QsIHdhZCk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIHB1c2goYWRkcmVzcyBkc3QsIHVpbnQgd2FkKSBwdWJsaWMgewogICAgICAgIHRyYW5zZmVyRnJvbShtc2cuc2VuZGVyLCBkc3QsIHdhZCk7CiAgICB9CiAgICBmdW5jdGlvbiBwdWxsKGFkZHJlc3Mgc3JjLCB1aW50IHdhZCkgcHVibGljIHsKICAgICAgICB0cmFuc2ZlckZyb20oc3JjLCBtc2cuc2VuZGVyLCB3YWQpOwogICAgfQogICAgZnVuY3Rpb24gbW92ZShhZGRyZXNzIHNyYywgYWRkcmVzcyBkc3QsIHVpbnQgd2FkKSBwdWJsaWMgewogICAgICAgIHRyYW5zZmVyRnJvbShzcmMsIGRzdCwgd2FkKTsKICAgIH0KCiAgICBmdW5jdGlvbiBtaW50KHVpbnQgd2FkKSBwdWJsaWMgewogICAgICAgIG1pbnQobXNnLnNlbmRlciwgd2FkKTsKICAgIH0KICAgIGZ1bmN0aW9uIGJ1cm4odWludCB3YWQpIHB1YmxpYyB7CiAgICAgICAgYnVybihtc2cuc2VuZGVyLCB3YWQpOwogICAgfQogICAgZnVuY3Rpb24gbWludChhZGRyZXNzIGd1eSwgdWludCB3YWQpIHB1YmxpYyBhdXRoIHN0b3BwYWJsZSB7CiAgICAgICAgX2JhbGFuY2VzW2d1eV0gPSBhZGQoX2JhbGFuY2VzW2d1eV0sIHdhZCk7CiAgICAgICAgX3N1cHBseSA9IGFkZChfc3VwcGx5LCB3YWQpOwogICAgICAgIE1pbnQoZ3V5LCB3YWQpOwogICAgfQogICAgZnVuY3Rpb24gYnVybihhZGRyZXNzIGd1eSwgdWludCB3YWQpIHB1YmxpYyBhdXRoIHN0b3BwYWJsZSB7CiAgICAgICAgaWYgKGd1eSAhPSBtc2cuc2VuZGVyICYmIF9hcHByb3ZhbHNbZ3V5XVttc2cuc2VuZGVyXSAhPSB1aW50KC0xKSkgewogICAgICAgICAgICBfYXBwcm92YWxzW2d1eV1bbXNnLnNlbmRlcl0gPSBzdWIoX2FwcHJvdmFsc1tndXldW21zZy5zZW5kZXJdLCB3YWQpOwogICAgICAgIH0KCiAgICAgICAgX2JhbGFuY2VzW2d1eV0gPSBzdWIoX2JhbGFuY2VzW2d1eV0sIHdhZCk7CiAgICAgICAgX3N1cHBseSA9IHN1Yihfc3VwcGx5LCB3YWQpOwogICAgICAgIEJ1cm4oZ3V5LCB3YWQpOwogICAgfQoKICAgIC8vIE9wdGlvbmFsIHRva2VuIG5hbWUKICAgIGJ5dGVzMzIgICBwdWJsaWMgIG5hbWUgPSAiIjsKCiAgICBmdW5jdGlvbiBzZXROYW1lKGJ5dGVzMzIgbmFtZV8pIHB1YmxpYyBhdXRoIHsKICAgICAgICBuYW1lID0gbmFtZV87CiAgICB9Cn0KCi8vLy8vLyBsaWIvZHMtdmFsdWUvc3JjL3ZhbHVlLnNvbAovLy8gdmFsdWUuc29sIC0gYSB2YWx1ZSBpcyBhIHNpbXBsZSB0aGluZywgaXQgY2FuIGJlIGdldCBhbmQgc2V0CgovLyBDb3B5cmlnaHQgKEMpIDIwMTcgIERhcHBIdWIsIExMQwoKLy8gVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKLy8gaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkKLy8gdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3IKLy8gKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KCi8vIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAovLyBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgovLyBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCi8vIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCgovLyBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQovLyBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KCi8qIHByYWdtYSBzb2xpZGl0eSBeMC40LjEzOyAqLwoKLyogaW1wb3J0ICdkcy10aGluZy90aGluZy5zb2wnOyAqLwoKY29udHJhY3QgRFNWYWx1ZSBpcyBEU1RoaW5nIHsKICAgIGJvb2wgICAgaGFzOwogICAgYnl0ZXMzMiB2YWw7CiAgICBmdW5jdGlvbiBwZWVrKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYnl0ZXMzMiwgYm9vbCkgewogICAgICAgIHJldHVybiAodmFsLGhhcyk7CiAgICB9CiAgICBmdW5jdGlvbiByZWFkKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYnl0ZXMzMikgewogICAgICAgIHZhciAod3V0LCBoYXopID0gcGVlaygpOwogICAgICAgIGFzc2VydChoYXopOwogICAgICAgIHJldHVybiB3dXQ7CiAgICB9CiAgICBmdW5jdGlvbiBwb2tlKGJ5dGVzMzIgd3V0KSBwdWJsaWMgbm90ZSBhdXRoIHsKICAgICAgICB2YWwgPSB3dXQ7CiAgICAgICAgaGFzID0gdHJ1ZTsKICAgIH0KICAgIGZ1bmN0aW9uIHZvaWQoKSBwdWJsaWMgbm90ZSBhdXRoIHsgIC8vIHVuc2V0IHRoZSB2YWx1ZQogICAgICAgIGhhcyA9IGZhbHNlOwogICAgfQp9CgovLy8vLy8gc3JjL3ZveC5zb2wKLy8vIHZveC5zb2wgLS0gdGFyZ2V0IHByaWNlIGZlZWQKCi8vIENvcHlyaWdodCAoQykgMjAxNiwgMjAxNyAgTmlrb2xhaSBNdXNoZWdpYW4gPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iY2ZhMWE2YTRhMGEzYWVhNjhmYWJhZWJmYmYiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+aHViLmNvbT4KLy8gQ29weXJpZ2h0IChDKSAyMDE2LCAyMDE3ICBEYW5pZWwgQnJvY2ttYW4gPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iZDdiM2I2YjliZWIyYmI5N2IzYjZhN2E3YmZhMmI1ZjliNGI4YmEiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PgovLyBDb3B5cmlnaHQgKEMpIDIwMTcgICAgICAgIFJhaW4gQnJlYWsgPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iNWQyZjNjMzQzMzNmMmYzODNjMzYxZDJmMzQyZTM4MjgyZDczMzMzODI5Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4KCi8vIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5Ci8vIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5Ci8vIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yCi8vIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCgovLyBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKLy8gYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKLy8gTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQovLyBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgoKLy8gWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UKLy8gYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uCgovKiBwcmFnbWEgc29saWRpdHkgXjAuNC4xODsgKi8KCi8qIGltcG9ydCAiZHMtdGhpbmcvdGhpbmcuc29sIjsgKi8KCmNvbnRyYWN0IFNhaVZveCBpcyBEU1RoaW5nIHsKICAgIHVpbnQyNTYgIF9wYXI7CiAgICB1aW50MjU2ICBfd2F5OwoKICAgIHVpbnQyNTYgIHB1YmxpYyAgZml4OwogICAgdWludDI1NiAgcHVibGljICBob3c7CiAgICB1aW50MjU2ICBwdWJsaWMgIHRhdTsKCiAgICBmdW5jdGlvbiBTYWlWb3godWludCBwYXJfKSBwdWJsaWMgewogICAgICAgIF9wYXIgPSBmaXggPSBwYXJfOwogICAgICAgIF93YXkgPSBSQVk7CiAgICAgICAgdGF1ICA9IGVyYSgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGVyYSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gYmxvY2sudGltZXN0YW1wOwogICAgfQoKICAgIGZ1bmN0aW9uIG1vbGQoYnl0ZXMzMiBwYXJhbSwgdWludCB2YWwpIHB1YmxpYyBub3RlIGF1dGggewogICAgICAgIGlmIChwYXJhbSA9PSAnd2F5JykgX3dheSA9IHZhbDsKICAgIH0KCiAgICAvLyBEYWkgVGFyZ2V0IFByaWNlIChyZWYgcGVyIGRhaSkKICAgIGZ1bmN0aW9uIHBhcigpIHB1YmxpYyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcHJvZCgpOwogICAgICAgIHJldHVybiBfcGFyOwogICAgfQogICAgZnVuY3Rpb24gd2F5KCkgcHVibGljIHJldHVybnMgKHVpbnQpIHsKICAgICAgICBwcm9kKCk7CiAgICAgICAgcmV0dXJuIF93YXk7CiAgICB9CgogICAgZnVuY3Rpb24gdGVsbCh1aW50MjU2IHJheSkgcHVibGljIG5vdGUgYXV0aCB7CiAgICAgICAgZml4ID0gcmF5OwogICAgfQogICAgZnVuY3Rpb24gdHVuZSh1aW50MjU2IHJheSkgcHVibGljIG5vdGUgYXV0aCB7CiAgICAgICAgaG93ID0gcmF5OwogICAgfQoKICAgIGZ1bmN0aW9uIHByb2QoKSBwdWJsaWMgbm90ZSB7CiAgICAgICAgdmFyIGFnZSA9IGVyYSgpIC0gdGF1OwogICAgICAgIGlmIChhZ2UgPT0gMCkgcmV0dXJuOyAgLy8gb3B0aW1pc2VkCiAgICAgICAgdGF1ID0gZXJhKCk7CgogICAgICAgIGlmIChfd2F5ICE9IFJBWSkgX3BhciA9IHJtdWwoX3BhciwgcnBvdyhfd2F5LCBhZ2UpKTsgIC8vIG9wdGltaXNlZAoKICAgICAgICBpZiAoaG93ID09IDApIHJldHVybjsgIC8vIG9wdGltaXNlZAogICAgICAgIHZhciB3YWcgPSBpbnQxMjgoaG93ICogYWdlKTsKICAgICAgICBfd2F5ID0gaW5qKHByaihfd2F5KSArIChmaXggPCBfcGFyID8gd2FnIDogLXdhZykpOwogICAgfQoKICAgIGZ1bmN0aW9uIGluaihpbnQxMjggeCkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHggPj0gMCA/IHVpbnQyNTYoeCkgKyBSQVkKICAgICAgICAgICAgOiByZGl2KFJBWSwgUkFZICsgdWludDI1NigteCkpOwogICAgfQogICAgZnVuY3Rpb24gcHJqKHVpbnQyNTYgeCkgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChpbnQxMjgpIHsKICAgICAgICByZXR1cm4geCA+PSBSQVkgPyBpbnQxMjgoeCAtIFJBWSkKICAgICAgICAgICAgOiBpbnQxMjgoUkFZKSAtIGludDEyOChyZGl2KFJBWSwgeCkpOwogICAgfQp9CgovLy8vLy8gc3JjL3R1Yi5zb2wKLy8vIHR1Yi5zb2wgLS0gc2ltcGxpZmllZCBDRFAgZW5naW5lIChiYWJ5IGJyb3RoZXIgb2YgYHZhdCcpCgovLyBDb3B5cmlnaHQgKEMpIDIwMTcgIE5pa29sYWkgTXVzaGVnaWFuIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImQyYmNiYmI5YmRiZWIzYmI5MmI2YjNhMmEyYmFhN2IwZmNiMWJkYmYiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PgovLyBDb3B5cmlnaHQgKEMpIDIwMTcgIERhbmllbCBCcm9ja21hbiA8PHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSIzNDUwNTU1YTVkNTE1ODc0NTA1NTQ0NDQ1YzQxNTYxYTU3NWI1OSI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+Ci8vIENvcHlyaWdodCAoQykgMjAxNyAgUmFpbiBCcmVhayA8PHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSJjYmI5YWFhMmE1YTliOWFlYWFhMDhiYjlhMmI4YWViZWJiZTVhNWFlYmYiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PgoKLy8gVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKLy8gaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkKLy8gdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3IKLy8gKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KCi8vIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAovLyBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgovLyBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCi8vIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCgovLyBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQovLyBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KCi8qIHByYWdtYSBzb2xpZGl0eSBeMC40LjE4OyAqLwoKLyogaW1wb3J0ICJkcy10aGluZy90aGluZy5zb2wiOyAqLwovKiBpbXBvcnQgImRzLXRva2VuL3Rva2VuLnNvbCI7ICovCi8qIGltcG9ydCAiZHMtdmFsdWUvdmFsdWUuc29sIjsgKi8KCi8qIGltcG9ydCAiLi92b3guc29sIjsgKi8KCmNvbnRyYWN0IFNhaVR1YkV2ZW50cyB7CiAgICBldmVudCBMb2dOZXdDdXAoYWRkcmVzcyBpbmRleGVkIGxhZCwgYnl0ZXMzMiBjdXApOwp9Cgpjb250cmFjdCBTYWlUdWIgaXMgRFNUaGluZywgU2FpVHViRXZlbnRzIHsKICAgIERTVG9rZW4gIHB1YmxpYyAgc2FpOyAgLy8gU3RhYmxlY29pbgogICAgRFNUb2tlbiAgcHVibGljICBzaW47ICAvLyBEZWJ0IChuZWdhdGl2ZSBzYWkpCgogICAgRFNUb2tlbiAgcHVibGljICBza3I7ICAvLyBBYnN0cmFjdGVkIGNvbGxhdGVyYWwKICAgIEVSQzIwICAgIHB1YmxpYyAgZ2VtOyAgLy8gVW5kZXJseWluZyBjb2xsYXRlcmFsCgogICAgRFNUb2tlbiAgcHVibGljICBnb3Y7ICAvLyBHb3Zlcm5hbmNlIHRva2VuCgogICAgU2FpVm94ICAgcHVibGljICB2b3g7ICAvLyBUYXJnZXQgcHJpY2UgZmVlZAogICAgRFNWYWx1ZSAgcHVibGljICBwaXA7ICAvLyBSZWZlcmVuY2UgcHJpY2UgZmVlZAogICAgRFNWYWx1ZSAgcHVibGljICBwZXA7ICAvLyBHb3Zlcm5hbmNlIHByaWNlIGZlZWQKCiAgICBhZGRyZXNzICBwdWJsaWMgIHRhcDsgIC8vIExpcXVpZGF0b3IKICAgIGFkZHJlc3MgIHB1YmxpYyAgcGl0OyAgLy8gR292ZXJuYW5jZSBWYXVsdAoKICAgIHVpbnQyNTYgIHB1YmxpYyAgYXhlOyAgLy8gTGlxdWlkYXRpb24gcGVuYWx0eQogICAgdWludDI1NiAgcHVibGljICBjYXA7ICAvLyBEZWJ0IGNlaWxpbmcKICAgIHVpbnQyNTYgIHB1YmxpYyAgbWF0OyAgLy8gTGlxdWlkYXRpb24gcmF0aW8KICAgIHVpbnQyNTYgIHB1YmxpYyAgdGF4OyAgLy8gU3RhYmlsaXR5IGZlZQogICAgdWludDI1NiAgcHVibGljICBmZWU7ICAvLyBHb3Zlcm5hbmNlIGZlZQogICAgdWludDI1NiAgcHVibGljICBnYXA7ICAvLyBKb2luLUV4aXQgU3ByZWFkCgogICAgYm9vbCAgICAgcHVibGljICBvZmY7ICAvLyBDYWdlIGZsYWcKICAgIGJvb2wgICAgIHB1YmxpYyAgb3V0OyAgLy8gUG9zdCBjYWdlIGV4aXQKCiAgICB1aW50MjU2ICBwdWJsaWMgIGZpdDsgIC8vIFJFRiBwZXIgU0tSIChqdXN0IGJlZm9yZSBzZXR0bGVtZW50KQoKICAgIHVpbnQyNTYgIHB1YmxpYyAgcmhvOyAgLy8gVGltZSBvZiBsYXN0IGRyaXAKICAgIHVpbnQyNTYgICAgICAgICBfY2hpOyAgLy8gQWNjdW11bGF0ZWQgVGF4IFJhdGVzCiAgICB1aW50MjU2ICAgICAgICAgX3JoaTsgIC8vIEFjY3VtdWxhdGVkIFRheCArIEZlZSBSYXRlcwogICAgdWludDI1NiAgcHVibGljICBydW07ICAvLyBUb3RhbCBub3JtYWxpc2VkIGRlYnQKCiAgICB1aW50MjU2ICAgICAgICAgICAgICAgICAgIHB1YmxpYyAgY3VwaTsKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gQ3VwKSAgcHVibGljICBjdXBzOwoKICAgIHN0cnVjdCBDdXAgewogICAgICAgIGFkZHJlc3MgIGxhZDsgICAgICAvLyBDRFAgb3duZXIKICAgICAgICB1aW50MjU2ICBpbms7ICAgICAgLy8gTG9ja2VkIGNvbGxhdGVyYWwgKGluIFNLUikKICAgICAgICB1aW50MjU2ICBhcnQ7ICAgICAgLy8gT3V0c3RhbmRpbmcgbm9ybWFsaXNlZCBkZWJ0ICh0YXggb25seSkKICAgICAgICB1aW50MjU2ICBpcmU7ICAgICAgLy8gT3V0c3RhbmRpbmcgbm9ybWFsaXNlZCBkZWJ0CiAgICB9CgogICAgZnVuY3Rpb24gbGFkKGJ5dGVzMzIgY3VwKSBwdWJsaWMgdmlldyByZXR1cm5zIChhZGRyZXNzKSB7CiAgICAgICAgcmV0dXJuIGN1cHNbY3VwXS5sYWQ7CiAgICB9CiAgICBmdW5jdGlvbiBpbmsoYnl0ZXMzMiBjdXApIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gY3Vwc1tjdXBdLmluazsKICAgIH0KICAgIGZ1bmN0aW9uIHRhYihieXRlczMyIGN1cCkgcHVibGljIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gcm11bChjdXBzW2N1cF0uYXJ0LCBjaGkoKSk7CiAgICB9CiAgICBmdW5jdGlvbiByYXAoYnl0ZXMzMiBjdXApIHB1YmxpYyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHN1YihybXVsKGN1cHNbY3VwXS5pcmUsIHJoaSgpKSwgdGFiKGN1cCkpOwogICAgfQoKICAgIC8vIFRvdGFsIENEUCBEZWJ0CiAgICBmdW5jdGlvbiBkaW4oKSBwdWJsaWMgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBybXVsKHJ1bSwgY2hpKCkpOwogICAgfQogICAgLy8gQmFja2luZyBjb2xsYXRlcmFsCiAgICBmdW5jdGlvbiBhaXIoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHNrci5iYWxhbmNlT2YodGhpcyk7CiAgICB9CiAgICAvLyBSYXcgY29sbGF0ZXJhbAogICAgZnVuY3Rpb24gcGllKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBnZW0uYmFsYW5jZU9mKHRoaXMpOwogICAgfQoKICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgZnVuY3Rpb24gU2FpVHViKAogICAgICAgIERTVG9rZW4gIHNhaV8sCiAgICAgICAgRFNUb2tlbiAgc2luXywKICAgICAgICBEU1Rva2VuICBza3JfLAogICAgICAgIEVSQzIwICAgIGdlbV8sCiAgICAgICAgRFNUb2tlbiAgZ292XywKICAgICAgICBEU1ZhbHVlICBwaXBfLAogICAgICAgIERTVmFsdWUgIHBlcF8sCiAgICAgICAgU2FpVm94ICAgdm94XywKICAgICAgICBhZGRyZXNzICBwaXRfCiAgICApIHB1YmxpYyB7CiAgICAgICAgZ2VtID0gZ2VtXzsKICAgICAgICBza3IgPSBza3JfOwoKICAgICAgICBzYWkgPSBzYWlfOwogICAgICAgIHNpbiA9IHNpbl87CgogICAgICAgIGdvdiA9IGdvdl87CiAgICAgICAgcGl0ID0gcGl0XzsKCiAgICAgICAgcGlwID0gcGlwXzsKICAgICAgICBwZXAgPSBwZXBfOwogICAgICAgIHZveCA9IHZveF87CgogICAgICAgIGF4ZSA9IFJBWTsKICAgICAgICBtYXQgPSBSQVk7CiAgICAgICAgdGF4ID0gUkFZOwogICAgICAgIGZlZSA9IFJBWTsKICAgICAgICBnYXAgPSBXQUQ7CgogICAgICAgIF9jaGkgPSBSQVk7CiAgICAgICAgX3JoaSA9IFJBWTsKCiAgICAgICAgcmhvID0gZXJhKCk7CiAgICB9CgogICAgZnVuY3Rpb24gZXJhKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gYmxvY2sudGltZXN0YW1wOwogICAgfQoKICAgIC8vLS1SaXNrLXBhcmFtZXRlci1jb25maWctLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgZnVuY3Rpb24gbW9sZChieXRlczMyIHBhcmFtLCB1aW50IHZhbCkgcHVibGljIG5vdGUgYXV0aCB7CiAgICAgICAgaWYgICAgICAocGFyYW0gPT0gJ2NhcCcpIGNhcCA9IHZhbDsKICAgICAgICBlbHNlIGlmIChwYXJhbSA9PSAnbWF0JykgeyByZXF1aXJlKHZhbCA+PSBSQVkpOyBtYXQgPSB2YWw7IH0KICAgICAgICBlbHNlIGlmIChwYXJhbSA9PSAndGF4JykgeyByZXF1aXJlKHZhbCA+PSBSQVkpOyBkcmlwKCk7IHRheCA9IHZhbDsgfQogICAgICAgIGVsc2UgaWYgKHBhcmFtID09ICdmZWUnKSB7IHJlcXVpcmUodmFsID49IFJBWSk7IGRyaXAoKTsgZmVlID0gdmFsOyB9CiAgICAgICAgZWxzZSBpZiAocGFyYW0gPT0gJ2F4ZScpIHsgcmVxdWlyZSh2YWwgPj0gUkFZKTsgYXhlID0gdmFsOyB9CiAgICAgICAgZWxzZSBpZiAocGFyYW0gPT0gJ2dhcCcpIHsgcmVxdWlyZSh2YWwgPj0gV0FEKTsgZ2FwID0gdmFsOyB9CiAgICAgICAgZWxzZSByZXR1cm47CiAgICB9CgogICAgLy8tLVByaWNlLWZlZWQtc2V0dGVycy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICBmdW5jdGlvbiBzZXRQaXAoRFNWYWx1ZSBwaXBfKSBwdWJsaWMgbm90ZSBhdXRoIHsKICAgICAgICBwaXAgPSBwaXBfOwogICAgfQogICAgZnVuY3Rpb24gc2V0UGVwKERTVmFsdWUgcGVwXykgcHVibGljIG5vdGUgYXV0aCB7CiAgICAgICAgcGVwID0gcGVwXzsKICAgIH0KICAgIGZ1bmN0aW9uIHNldFZveChTYWlWb3ggdm94XykgcHVibGljIG5vdGUgYXV0aCB7CiAgICAgICAgdm94ID0gdm94XzsKICAgIH0KCiAgICAvLy0tVGFwLXNldHRlci0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgZnVuY3Rpb24gdHVybihhZGRyZXNzIHRhcF8pIHB1YmxpYyBub3RlIHsKICAgICAgICByZXF1aXJlKHRhcCAgPT0gMCk7CiAgICAgICAgcmVxdWlyZSh0YXBfICE9IDApOwogICAgICAgIHRhcCA9IHRhcF87CiAgICB9CgogICAgLy8tLUNvbGxhdGVyYWwtd3JhcHBlci0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICAvLyBXcmFwcGVyIHJhdGlvIChnZW0gcGVyIHNrcikKICAgIGZ1bmN0aW9uIHBlcigpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQgcmF5KSB7CiAgICAgICAgcmV0dXJuIHNrci50b3RhbFN1cHBseSgpID09IDAgPyBSQVkgOiByZGl2KHBpZSgpLCBza3IudG90YWxTdXBwbHkoKSk7CiAgICB9CiAgICAvLyBKb2luIHByaWNlIChnZW0gcGVyIHNrcikKICAgIGZ1bmN0aW9uIGFzayh1aW50IHdhZCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBybXVsKHdhZCwgd211bChwZXIoKSwgZ2FwKSk7CiAgICB9CiAgICAvLyBFeGl0IHByaWNlIChnZW0gcGVyIHNrcikKICAgIGZ1bmN0aW9uIGJpZCh1aW50IHdhZCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBybXVsKHdhZCwgd211bChwZXIoKSwgc3ViKDIgKiBXQUQsIGdhcCkpKTsKICAgIH0KICAgIGZ1bmN0aW9uIGpvaW4odWludCB3YWQpIHB1YmxpYyBub3RlIHsKICAgICAgICByZXF1aXJlKCFvZmYpOwogICAgICAgIHJlcXVpcmUoYXNrKHdhZCkgPiAwKTsKICAgICAgICByZXF1aXJlKGdlbS50cmFuc2ZlckZyb20obXNnLnNlbmRlciwgdGhpcywgYXNrKHdhZCkpKTsKICAgICAgICBza3IubWludChtc2cuc2VuZGVyLCB3YWQpOwogICAgfQogICAgZnVuY3Rpb24gZXhpdCh1aW50IHdhZCkgcHVibGljIG5vdGUgewogICAgICAgIHJlcXVpcmUoIW9mZiB8fCBvdXQpOwogICAgICAgIHJlcXVpcmUoZ2VtLnRyYW5zZmVyKG1zZy5zZW5kZXIsIGJpZCh3YWQpKSk7CiAgICAgICAgc2tyLmJ1cm4obXNnLnNlbmRlciwgd2FkKTsKICAgIH0KCiAgICAvLy0tU3RhYmlsaXR5LWZlZS1hY2N1bXVsYXRpb24tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAgIC8vIEFjY3VtdWxhdGVkIFJhdGVzCiAgICBmdW5jdGlvbiBjaGkoKSBwdWJsaWMgcmV0dXJucyAodWludCkgewogICAgICAgIGRyaXAoKTsKICAgICAgICByZXR1cm4gX2NoaTsKICAgIH0KICAgIGZ1bmN0aW9uIHJoaSgpIHB1YmxpYyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgZHJpcCgpOwogICAgICAgIHJldHVybiBfcmhpOwogICAgfQogICAgZnVuY3Rpb24gZHJpcCgpIHB1YmxpYyBub3RlIHsKICAgICAgICBpZiAob2ZmKSByZXR1cm47CgogICAgICAgIHZhciByaG9fID0gZXJhKCk7CiAgICAgICAgdmFyIGFnZSA9IHJob18gLSByaG87CiAgICAgICAgaWYgKGFnZSA9PSAwKSByZXR1cm47ICAgIC8vIG9wdGltaXNlZAogICAgICAgIHJobyA9IHJob187CgogICAgICAgIHZhciBpbmMgPSBSQVk7CgogICAgICAgIGlmICh0YXggIT0gUkFZKSB7ICAvLyBvcHRpbWlzZWQKICAgICAgICAgICAgdmFyIF9jaGlfID0gX2NoaTsKICAgICAgICAgICAgaW5jID0gcnBvdyh0YXgsIGFnZSk7CiAgICAgICAgICAgIF9jaGkgPSBybXVsKF9jaGksIGluYyk7CiAgICAgICAgICAgIHNhaS5taW50KHRhcCwgcm11bChzdWIoX2NoaSwgX2NoaV8pLCBydW0pKTsKICAgICAgICB9CgogICAgICAgIC8vIG9wdGltaXNlZAogICAgICAgIGlmIChmZWUgIT0gUkFZKSBpbmMgPSBybXVsKGluYywgcnBvdyhmZWUsIGFnZSkpOwogICAgICAgIGlmIChpbmMgIT0gUkFZKSBfcmhpID0gcm11bChfcmhpLCBpbmMpOwogICAgfQoKCiAgICAvLy0tQ0RQLXJpc2staW5kaWNhdG9yLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAgIC8vIEFic3RyYWN0ZWQgY29sbGF0ZXJhbCBwcmljZSAocmVmIHBlciBza3IpCiAgICBmdW5jdGlvbiB0YWcoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50IHdhZCkgewogICAgICAgIHJldHVybiBvZmYgPyBmaXQgOiB3bXVsKHBlcigpLCB1aW50KHBpcC5yZWFkKCkpKTsKICAgIH0KICAgIC8vIFJldHVybnMgdHJ1ZSBpZiBjdXAgaXMgd2VsbC1jb2xsYXRlcmFsaXplZAogICAgZnVuY3Rpb24gc2FmZShieXRlczMyIGN1cCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICB2YXIgcHJvID0gcm11bCh0YWcoKSwgaW5rKGN1cCkpOwogICAgICAgIHZhciBjb24gPSBybXVsKHZveC5wYXIoKSwgdGFiKGN1cCkpOwogICAgICAgIHZhciBtaW4gPSBybXVsKGNvbiwgbWF0KTsKICAgICAgICByZXR1cm4gcHJvID49IG1pbjsKICAgIH0KCgogICAgLy8tLUNEUC1vcGVyYXRpb25zLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICBmdW5jdGlvbiBvcGVuKCkgcHVibGljIG5vdGUgcmV0dXJucyAoYnl0ZXMzMiBjdXApIHsKICAgICAgICByZXF1aXJlKCFvZmYpOwogICAgICAgIGN1cGkgPSBhZGQoY3VwaSwgMSk7CiAgICAgICAgY3VwID0gYnl0ZXMzMihjdXBpKTsKICAgICAgICBjdXBzW2N1cF0ubGFkID0gbXNnLnNlbmRlcjsKICAgICAgICBMb2dOZXdDdXAobXNnLnNlbmRlciwgY3VwKTsKICAgIH0KICAgIGZ1bmN0aW9uIGdpdmUoYnl0ZXMzMiBjdXAsIGFkZHJlc3MgZ3V5KSBwdWJsaWMgbm90ZSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGN1cHNbY3VwXS5sYWQpOwogICAgICAgIHJlcXVpcmUoZ3V5ICE9IDApOwogICAgICAgIGN1cHNbY3VwXS5sYWQgPSBndXk7CiAgICB9CgogICAgZnVuY3Rpb24gbG9jayhieXRlczMyIGN1cCwgdWludCB3YWQpIHB1YmxpYyBub3RlIHsKICAgICAgICByZXF1aXJlKCFvZmYpOwogICAgICAgIGN1cHNbY3VwXS5pbmsgPSBhZGQoY3Vwc1tjdXBdLmluaywgd2FkKTsKICAgICAgICBza3IucHVsbChtc2cuc2VuZGVyLCB3YWQpOwogICAgICAgIHJlcXVpcmUoY3Vwc1tjdXBdLmluayA9PSAwIHx8IGN1cHNbY3VwXS5pbmsgPiAwLjAwNSBldGhlcik7CiAgICB9CiAgICBmdW5jdGlvbiBmcmVlKGJ5dGVzMzIgY3VwLCB1aW50IHdhZCkgcHVibGljIG5vdGUgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBjdXBzW2N1cF0ubGFkKTsKICAgICAgICBjdXBzW2N1cF0uaW5rID0gc3ViKGN1cHNbY3VwXS5pbmssIHdhZCk7CiAgICAgICAgc2tyLnB1c2gobXNnLnNlbmRlciwgd2FkKTsKICAgICAgICByZXF1aXJlKHNhZmUoY3VwKSk7CiAgICAgICAgcmVxdWlyZShjdXBzW2N1cF0uaW5rID09IDAgfHwgY3Vwc1tjdXBdLmluayA+IDAuMDA1IGV0aGVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBkcmF3KGJ5dGVzMzIgY3VwLCB1aW50IHdhZCkgcHVibGljIG5vdGUgewogICAgICAgIHJlcXVpcmUoIW9mZik7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGN1cHNbY3VwXS5sYWQpOwogICAgICAgIHJlcXVpcmUocmRpdih3YWQsIGNoaSgpKSA+IDApOwoKICAgICAgICBjdXBzW2N1cF0uYXJ0ID0gYWRkKGN1cHNbY3VwXS5hcnQsIHJkaXYod2FkLCBjaGkoKSkpOwogICAgICAgIHJ1bSA9IGFkZChydW0sIHJkaXYod2FkLCBjaGkoKSkpOwoKICAgICAgICBjdXBzW2N1cF0uaXJlID0gYWRkKGN1cHNbY3VwXS5pcmUsIHJkaXYod2FkLCByaGkoKSkpOwogICAgICAgIHNhaS5taW50KGN1cHNbY3VwXS5sYWQsIHdhZCk7CgogICAgICAgIHJlcXVpcmUoc2FmZShjdXApKTsKICAgICAgICByZXF1aXJlKHNhaS50b3RhbFN1cHBseSgpIDw9IGNhcCk7CiAgICB9CiAgICBmdW5jdGlvbiB3aXBlKGJ5dGVzMzIgY3VwLCB1aW50IHdhZCkgcHVibGljIG5vdGUgewogICAgICAgIHJlcXVpcmUoIW9mZik7CgogICAgICAgIHZhciBvd2UgPSBybXVsKHdhZCwgcmRpdihyYXAoY3VwKSwgdGFiKGN1cCkpKTsKCiAgICAgICAgY3Vwc1tjdXBdLmFydCA9IHN1YihjdXBzW2N1cF0uYXJ0LCByZGl2KHdhZCwgY2hpKCkpKTsKICAgICAgICBydW0gPSBzdWIocnVtLCByZGl2KHdhZCwgY2hpKCkpKTsKCiAgICAgICAgY3Vwc1tjdXBdLmlyZSA9IHN1YihjdXBzW2N1cF0uaXJlLCByZGl2KGFkZCh3YWQsIG93ZSksIHJoaSgpKSk7CiAgICAgICAgc2FpLmJ1cm4obXNnLnNlbmRlciwgd2FkKTsKCiAgICAgICAgdmFyICh2YWwsIG9rKSA9IHBlcC5wZWVrKCk7CiAgICAgICAgaWYgKG9rICYmIHZhbCAhPSAwKSBnb3YubW92ZShtc2cuc2VuZGVyLCBwaXQsIHdkaXYob3dlLCB1aW50KHZhbCkpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzaHV0KGJ5dGVzMzIgY3VwKSBwdWJsaWMgbm90ZSB7CiAgICAgICAgcmVxdWlyZSghb2ZmKTsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY3Vwc1tjdXBdLmxhZCk7CiAgICAgICAgaWYgKHRhYihjdXApICE9IDApIHdpcGUoY3VwLCB0YWIoY3VwKSk7CiAgICAgICAgaWYgKGluayhjdXApICE9IDApIGZyZWUoY3VwLCBpbmsoY3VwKSk7CiAgICAgICAgZGVsZXRlIGN1cHNbY3VwXTsKICAgIH0KCiAgICBmdW5jdGlvbiBiaXRlKGJ5dGVzMzIgY3VwKSBwdWJsaWMgbm90ZSB7CiAgICAgICAgcmVxdWlyZSghc2FmZShjdXApIHx8IG9mZik7CgogICAgICAgIC8vIFRha2Ugb24gYWxsIG9mIHRoZSBkZWJ0LCBleGNlcHQgdW5wYWlkIGZlZXMKICAgICAgICB2YXIgcnVlID0gdGFiKGN1cCk7CiAgICAgICAgc2luLm1pbnQodGFwLCBydWUpOwogICAgICAgIHJ1bSA9IHN1YihydW0sIGN1cHNbY3VwXS5hcnQpOwogICAgICAgIGN1cHNbY3VwXS5hcnQgPSAwOwogICAgICAgIGN1cHNbY3VwXS5pcmUgPSAwOwoKICAgICAgICAvLyBBbW91bnQgb3dlZCBpbiBTS1IsIGluY2x1ZGluZyBsaXF1aWRhdGlvbiBwZW5hbHR5CiAgICAgICAgdmFyIG93ZSA9IHJkaXYocm11bChybXVsKHJ1ZSwgYXhlKSwgdm94LnBhcigpKSwgdGFnKCkpOwoKICAgICAgICBpZiAob3dlID4gY3Vwc1tjdXBdLmluaykgewogICAgICAgICAgICBvd2UgPSBjdXBzW2N1cF0uaW5rOwogICAgICAgIH0KCiAgICAgICAgc2tyLnB1c2godGFwLCBvd2UpOwogICAgICAgIGN1cHNbY3VwXS5pbmsgPSBzdWIoY3Vwc1tjdXBdLmluaywgb3dlKTsKICAgIH0KCiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAgIGZ1bmN0aW9uIGNhZ2UodWludCBmaXRfLCB1aW50IGphbSkgcHVibGljIG5vdGUgYXV0aCB7CiAgICAgICAgcmVxdWlyZSghb2ZmICYmIGZpdF8gIT0gMCk7CiAgICAgICAgb2ZmID0gdHJ1ZTsKICAgICAgICBheGUgPSBSQVk7CiAgICAgICAgZ2FwID0gV0FEOwogICAgICAgIGZpdCA9IGZpdF87ICAgICAgICAgLy8gcmVmIHBlciBza3IKICAgICAgICByZXF1aXJlKGdlbS50cmFuc2Zlcih0YXAsIGphbSkpOwogICAgfQogICAgZnVuY3Rpb24gZmxvdygpIHB1YmxpYyBub3RlIGF1dGggewogICAgICAgIHJlcXVpcmUob2ZmKTsKICAgICAgICBvdXQgPSB0cnVlOwogICAgfQp9CgovLy8vLy8gc3JjL3RhcC5zb2wKLy8vIHRhcC5zb2wgLS0gbGlxdWlkYXRpb24gZW5naW5lIChzZWUgYWxzbyBgdm93YCkKCi8vIENvcHlyaWdodCAoQykgMjAxNyAgTmlrb2xhaSBNdXNoZWdpYW4gPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iNWYzMTM2MzQzMDMzM2UzNjFmM2IzZTJmMmYzNzJhM2Q3MTNjMzAzMiI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+Ci8vIENvcHlyaWdodCAoQykgMjAxNyAgRGFuaWVsIEJyb2NrbWFuIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjRmMmIyZTIxMjYyYTIzMGYyYjJlM2YzZjI3M2EyZDYxMmMyMDIyIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4KLy8gQ29weXJpZ2h0IChDKSAyMDE3ICBSYWluIEJyZWFrIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImJjY2VkZGQ1ZDJkZWNlZDlkZGQ3ZmNjZWQ1Y2ZkOWM5Y2M5MmQyZDljOCI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+CgovLyBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQovLyBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQovLyB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvcgovLyAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgoKLy8gVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCi8vIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCi8vIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUKLy8gR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KCi8vIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCi8vIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LgoKLyogcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7ICovCgovKiBpbXBvcnQgIi4vdHViLnNvbCI7ICovCgpjb250cmFjdCBTYWlUYXAgaXMgRFNUaGluZyB7CiAgICBEU1Rva2VuICBwdWJsaWMgIHNhaTsKICAgIERTVG9rZW4gIHB1YmxpYyAgc2luOwogICAgRFNUb2tlbiAgcHVibGljICBza3I7CgogICAgU2FpVm94ICAgcHVibGljICB2b3g7CiAgICBTYWlUdWIgICBwdWJsaWMgIHR1YjsKCiAgICB1aW50MjU2ICBwdWJsaWMgIGdhcDsgIC8vIEJvb20tQnVzdCBTcHJlYWQKICAgIGJvb2wgICAgIHB1YmxpYyAgb2ZmOyAgLy8gQ2FnZSBmbGFnCiAgICB1aW50MjU2ICBwdWJsaWMgIGZpeDsgIC8vIENhZ2UgcHJpY2UKCiAgICAvLyBTdXJwbHVzCiAgICBmdW5jdGlvbiBqb3koKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHNhaS5iYWxhbmNlT2YodGhpcyk7CiAgICB9CiAgICAvLyBCYWQgZGVidAogICAgZnVuY3Rpb24gd29lKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBzaW4uYmFsYW5jZU9mKHRoaXMpOwogICAgfQogICAgLy8gQ29sbGF0ZXJhbCBwZW5kaW5nIGxpcXVpZGF0aW9uCiAgICBmdW5jdGlvbiBmb2coKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHNrci5iYWxhbmNlT2YodGhpcyk7CiAgICB9CgoKICAgIGZ1bmN0aW9uIFNhaVRhcChTYWlUdWIgdHViXykgcHVibGljIHsKICAgICAgICB0dWIgPSB0dWJfOwoKICAgICAgICBzYWkgPSB0dWIuc2FpKCk7CiAgICAgICAgc2luID0gdHViLnNpbigpOwogICAgICAgIHNrciA9IHR1Yi5za3IoKTsKCiAgICAgICAgdm94ID0gdHViLnZveCgpOwoKICAgICAgICBnYXAgPSBXQUQ7CiAgICB9CgogICAgZnVuY3Rpb24gbW9sZChieXRlczMyIHBhcmFtLCB1aW50IHZhbCkgcHVibGljIG5vdGUgYXV0aCB7CiAgICAgICAgaWYgKHBhcmFtID09ICdnYXAnKSBnYXAgPSB2YWw7CiAgICB9CgogICAgLy8gQ2FuY2VsIGRlYnQKICAgIGZ1bmN0aW9uIGhlYWwoKSBwdWJsaWMgbm90ZSB7CiAgICAgICAgaWYgKGpveSgpID09IDAgfHwgd29lKCkgPT0gMCkgcmV0dXJuOyAgLy8gb3B0aW1pc2VkCiAgICAgICAgdmFyIHdhZCA9IG1pbihqb3koKSwgd29lKCkpOwogICAgICAgIHNhaS5idXJuKHdhZCk7CiAgICAgICAgc2luLmJ1cm4od2FkKTsKICAgIH0KCiAgICAvLyBGZWVkIHByaWNlIChzYWkgcGVyIHNrcikKICAgIGZ1bmN0aW9uIHMycygpIHB1YmxpYyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdmFyIHRhZyA9IHR1Yi50YWcoKTsgICAgLy8gcmVmIHBlciBza3IKICAgICAgICB2YXIgcGFyID0gdm94LnBhcigpOyAgICAvLyByZWYgcGVyIHNhaQogICAgICAgIHJldHVybiByZGl2KHRhZywgcGFyKTsgIC8vIHNhaSBwZXIgc2tyCiAgICB9CiAgICAvLyBCb29tIHByaWNlIChzYWkgcGVyIHNrcikKICAgIGZ1bmN0aW9uIGJpZCh1aW50IHdhZCkgcHVibGljIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gcm11bCh3YWQsIHdtdWwoczJzKCksIHN1YigyICogV0FELCBnYXApKSk7CiAgICB9CiAgICAvLyBCdXN0IHByaWNlIChzYWkgcGVyIHNrcikKICAgIGZ1bmN0aW9uIGFzayh1aW50IHdhZCkgcHVibGljIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gcm11bCh3YWQsIHdtdWwoczJzKCksIGdhcCkpOwogICAgfQogICAgZnVuY3Rpb24gZmxpcCh1aW50IHdhZCkgaW50ZXJuYWwgewogICAgICAgIHJlcXVpcmUoYXNrKHdhZCkgPiAwKTsKICAgICAgICBza3IucHVzaChtc2cuc2VuZGVyLCB3YWQpOwogICAgICAgIHNhaS5wdWxsKG1zZy5zZW5kZXIsIGFzayh3YWQpKTsKICAgICAgICBoZWFsKCk7CiAgICB9CiAgICBmdW5jdGlvbiBmbG9wKHVpbnQgd2FkKSBpbnRlcm5hbCB7CiAgICAgICAgc2tyLm1pbnQoc3ViKHdhZCwgZm9nKCkpKTsKICAgICAgICBmbGlwKHdhZCk7CiAgICAgICAgcmVxdWlyZShqb3koKSA9PSAwKTsgIC8vIGNhbid0IGZsb3AgaW50byBzdXJwbHVzCiAgICB9CiAgICBmdW5jdGlvbiBmbGFwKHVpbnQgd2FkKSBpbnRlcm5hbCB7CiAgICAgICAgaGVhbCgpOwogICAgICAgIHNhaS5wdXNoKG1zZy5zZW5kZXIsIGJpZCh3YWQpKTsKICAgICAgICBza3IuYnVybihtc2cuc2VuZGVyLCB3YWQpOwogICAgfQogICAgZnVuY3Rpb24gYnVzdCh1aW50IHdhZCkgcHVibGljIG5vdGUgewogICAgICAgIHJlcXVpcmUoIW9mZik7CiAgICAgICAgaWYgKHdhZCA+IGZvZygpKSBmbG9wKHdhZCk7CiAgICAgICAgZWxzZSBmbGlwKHdhZCk7CiAgICB9CiAgICBmdW5jdGlvbiBib29tKHVpbnQgd2FkKSBwdWJsaWMgbm90ZSB7CiAgICAgICAgcmVxdWlyZSghb2ZmKTsKICAgICAgICBmbGFwKHdhZCk7CiAgICB9CgogICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICBmdW5jdGlvbiBjYWdlKHVpbnQgZml4XykgcHVibGljIG5vdGUgYXV0aCB7CiAgICAgICAgcmVxdWlyZSghb2ZmKTsKICAgICAgICBvZmYgPSB0cnVlOwogICAgICAgIGZpeCA9IGZpeF87CiAgICB9CiAgICBmdW5jdGlvbiBjYXNoKHVpbnQgd2FkKSBwdWJsaWMgbm90ZSB7CiAgICAgICAgcmVxdWlyZShvZmYpOwogICAgICAgIHNhaS5idXJuKG1zZy5zZW5kZXIsIHdhZCk7CiAgICAgICAgcmVxdWlyZSh0dWIuZ2VtKCkudHJhbnNmZXIobXNnLnNlbmRlciwgcm11bCh3YWQsIGZpeCkpKTsKICAgIH0KICAgIGZ1bmN0aW9uIG1vY2sodWludCB3YWQpIHB1YmxpYyBub3RlIHsKICAgICAgICByZXF1aXJlKG9mZik7CiAgICAgICAgc2FpLm1pbnQobXNnLnNlbmRlciwgd2FkKTsKICAgICAgICByZXF1aXJlKHR1Yi5nZW0oKS50cmFuc2ZlckZyb20obXNnLnNlbmRlciwgdGhpcywgcm11bCh3YWQsIGZpeCkpKTsKICAgIH0KICAgIGZ1bmN0aW9uIHZlbnQoKSBwdWJsaWMgbm90ZSB7CiAgICAgICAgcmVxdWlyZShvZmYpOwogICAgICAgIHNrci5idXJuKGZvZygpKTsKICAgIH0KfQoKLy8vLy8vIHNyYy90b3Auc29sCi8vLyB0b3Auc29sIC0tIGdsb2JhbCBzZXR0bGVtZW50IG1hbmFnZXIKCi8vIENvcHlyaWdodCAoQykgMjAxNyAgTmlrb2xhaSBNdXNoZWdpYW4gPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iMzY1ODVmNWQ1OTVhNTc1Zjc2NTI1NzQ2NDY1ZTQzNTQxODU1NTk1YiI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+Ci8vIENvcHlyaWdodCAoQykgMjAxNyAgRGFuaWVsIEJyb2NrbWFuIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjU4M2MzOTM2MzEzZDM0MTgzYzM5MjgyODMwMmQzYTc2M2IzNzM1Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4KLy8gQ29weXJpZ2h0IChDKSAyMDE3ICBSYWluIEJyZWFrIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImUyOTA4MzhiOGM4MDkwODc4Mzg5YTI5MDhiOTE4Nzk3OTJjYzhjODc5NiI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+CgovLyBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQovLyBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQovLyB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvcgovLyAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgoKLy8gVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCi8vIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCi8vIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUKLy8gR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KCi8vIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCi8vIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LgoKLyogcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7ICovCgovKiBpbXBvcnQgIi4vdHViLnNvbCI7ICovCi8qIGltcG9ydCAiLi90YXAuc29sIjsgKi8KCmNvbnRyYWN0IFNhaVRvcCBpcyBEU1RoaW5nIHsKICAgIFNhaVZveCAgIHB1YmxpYyAgdm94OwogICAgU2FpVHViICAgcHVibGljICB0dWI7CiAgICBTYWlUYXAgICBwdWJsaWMgIHRhcDsKCiAgICBEU1Rva2VuICBwdWJsaWMgIHNhaTsKICAgIERTVG9rZW4gIHB1YmxpYyAgc2luOwogICAgRFNUb2tlbiAgcHVibGljICBza3I7CiAgICBFUkMyMCAgICBwdWJsaWMgIGdlbTsKCiAgICB1aW50MjU2ICBwdWJsaWMgIGZpeDsgIC8vIHNhaSBjYWdlIHByaWNlIChnZW0gcGVyIHNhaSkKICAgIHVpbnQyNTYgIHB1YmxpYyAgZml0OyAgLy8gc2tyIGNhZ2UgcHJpY2UgKHJlZiBwZXIgc2tyKQogICAgdWludDI1NiAgcHVibGljICBjYWdlZDsKICAgIHVpbnQyNTYgIHB1YmxpYyAgY29vbGRvd24gPSA2IGhvdXJzOwoKICAgIGZ1bmN0aW9uIFNhaVRvcChTYWlUdWIgdHViXywgU2FpVGFwIHRhcF8pIHB1YmxpYyB7CiAgICAgICAgdHViID0gdHViXzsKICAgICAgICB0YXAgPSB0YXBfOwoKICAgICAgICB2b3ggPSB0dWIudm94KCk7CgogICAgICAgIHNhaSA9IHR1Yi5zYWkoKTsKICAgICAgICBzaW4gPSB0dWIuc2luKCk7CiAgICAgICAgc2tyID0gdHViLnNrcigpOwogICAgICAgIGdlbSA9IHR1Yi5nZW0oKTsKICAgIH0KCiAgICBmdW5jdGlvbiBlcmEoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGJsb2NrLnRpbWVzdGFtcDsKICAgIH0KCiAgICAvLyBmb3JjZSBzZXR0bGVtZW50IG9mIHRoZSBzeXN0ZW0gYXQgYSBnaXZlbiBwcmljZSAoc2FpIHBlciBnZW0pLgogICAgLy8gVGhpcyBpcyBuZWFybHkgdGhlIGVxdWl2YWxlbnQgb2YgYml0aW5nIGFsbCBjdXBzIGF0IG9uY2UuCiAgICAvLyBJbXBvcnRhbnQgY29uc2lkZXJhdGlvbjogdGhlIGdlbXMgYXNzb2NpYXRlZCB3aXRoIGZyZWUgc2tyIGNhbgogICAgLy8gYmUgdGFwcGVkIHRvIG1ha2Ugc2FpIHdob2xlLgogICAgZnVuY3Rpb24gY2FnZSh1aW50IHByaWNlKSBpbnRlcm5hbCB7CiAgICAgICAgcmVxdWlyZSghdHViLm9mZigpICYmIHByaWNlICE9IDApOwogICAgICAgIGNhZ2VkID0gZXJhKCk7CgogICAgICAgIHR1Yi5kcmlwKCk7ICAvLyBjb2xsZWN0IHJlbWFpbmluZyBmZWVzCiAgICAgICAgdGFwLmhlYWwoKTsgIC8vIGFic29yYiBhbnkgcGVuZGluZyBmZWVzCgogICAgICAgIGZpdCA9IHJtdWwod211bChwcmljZSwgdm94LnBhcigpKSwgdHViLnBlcigpKTsKICAgICAgICAvLyBNb3N0IGdlbXMgd2UgY2FuIGdldCBwZXIgc2FpIGlzIHRoZSBmdWxsIGJhbGFuY2Ugb2YgdGhlIHR1Yi4KICAgICAgICAvLyBJZiB0aGVyZSBpcyBubyBzYWkgaXNzdWVkLCB3ZSBzaG91bGQgc3RpbGwgYmUgYWJsZSB0byBjYWdlLgogICAgICAgIGlmIChzYWkudG90YWxTdXBwbHkoKSA9PSAwKSB7CiAgICAgICAgICAgIGZpeCA9IHJkaXYoV0FELCBwcmljZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZml4ID0gbWluKHJkaXYoV0FELCBwcmljZSksIHJkaXYodHViLnBpZSgpLCBzYWkudG90YWxTdXBwbHkoKSkpOwogICAgICAgIH0KCiAgICAgICAgdHViLmNhZ2UoZml0LCBybXVsKGZpeCwgc2FpLnRvdGFsU3VwcGx5KCkpKTsKICAgICAgICB0YXAuY2FnZShmaXgpOwoKICAgICAgICB0YXAudmVudCgpOyAgICAvLyBidXJuIHBlbmRpbmcgc2FsZSBza3IKICAgIH0KICAgIC8vIGNhZ2UgYnkgcmVhZGluZyB0aGUgbGFzdCB2YWx1ZSBmcm9tIHRoZSBmZWVkIGZvciB0aGUgcHJpY2UKICAgIGZ1bmN0aW9uIGNhZ2UoKSBwdWJsaWMgbm90ZSBhdXRoIHsKICAgICAgICBjYWdlKHJkaXYodWludCh0dWIucGlwKCkucmVhZCgpKSwgdm94LnBhcigpKSk7CiAgICB9CgogICAgZnVuY3Rpb24gZmxvdygpIHB1YmxpYyBub3RlIHsKICAgICAgICByZXF1aXJlKHR1Yi5vZmYoKSk7CiAgICAgICAgdmFyIGVtcHR5ID0gdHViLmRpbigpID09IDAgJiYgdGFwLmZvZygpID09IDA7CiAgICAgICAgdmFyIGVuZGVkID0gZXJhKCkgPiBjYWdlZCArIGNvb2xkb3duOwogICAgICAgIHJlcXVpcmUoZW1wdHkgfHwgZW5kZWQpOwogICAgICAgIHR1Yi5mbG93KCk7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0Q29vbGRvd24odWludCBjb29sZG93bl8pIHB1YmxpYyBhdXRoIHsKICAgICAgICBjb29sZG93biA9IGNvb2xkb3duXzsKICAgIH0KfQoKLy8vLy8vIHNyYy9tb20uc29sCi8vLyBtb20uc29sIC0tIGFkbWluIG1hbmFnZXIKCi8vIENvcHlyaWdodCAoQykgMjAxNyAgTmlrb2xhaSBNdXNoZWdpYW4gPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iZGFiNGIzYjFiNWI2YmJiMzlhYmViYmFhYWFiMmFmYjhmNGI5YjViNyI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+Ci8vIENvcHlyaWdodCAoQykgMjAxNyAgRGFuaWVsIEJyb2NrbWFuIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjZjMDgwZDAyMDUwOTAwMmMwODBkMWMxYzA0MTkwZTQyMGYwMzAxIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4KLy8gQ29weXJpZ2h0IChDKSAyMDE3ICBSYWluIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjMyNDA1MzViNWM1MDQwNTc1MzU5NzI0MDViNDE1NzQ3NDIxYzVjNTc0NiI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+CgovLyBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQovLyBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQovLyB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvcgovLyAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgoKLy8gVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCi8vIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCi8vIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUKLy8gR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KCi8vIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCi8vIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LgoKLyogcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7ICovCgovKiBpbXBvcnQgJ2RzLXRoaW5nL3RoaW5nLnNvbCc7ICovCi8qIGltcG9ydCAnLi90dWIuc29sJzsgKi8KLyogaW1wb3J0ICcuL3RvcC5zb2wnOyAqLwovKiBpbXBvcnQgJy4vdGFwLnNvbCc7ICovCgpjb250cmFjdCBTYWlNb20gaXMgRFNUaGluZyB7CiAgICBTYWlUdWIgIHB1YmxpYyAgdHViOwogICAgU2FpVGFwICBwdWJsaWMgIHRhcDsKICAgIFNhaVZveCAgcHVibGljICB2b3g7CgogICAgZnVuY3Rpb24gU2FpTW9tKFNhaVR1YiB0dWJfLCBTYWlUYXAgdGFwXywgU2FpVm94IHZveF8pIHB1YmxpYyB7CiAgICAgICAgdHViID0gdHViXzsKICAgICAgICB0YXAgPSB0YXBfOwogICAgICAgIHZveCA9IHZveF87CiAgICB9CiAgICAvLyBEZWJ0IGNlaWxpbmcKICAgIGZ1bmN0aW9uIHNldENhcCh1aW50IHdhZCkgcHVibGljIG5vdGUgYXV0aCB7CiAgICAgICAgdHViLm1vbGQoImNhcCIsIHdhZCk7CiAgICB9CiAgICAvLyBMaXF1aWRhdGlvbiByYXRpbwogICAgZnVuY3Rpb24gc2V0TWF0KHVpbnQgcmF5KSBwdWJsaWMgbm90ZSBhdXRoIHsKICAgICAgICB0dWIubW9sZCgibWF0IiwgcmF5KTsKICAgICAgICB2YXIgYXhlID0gdHViLmF4ZSgpOwogICAgICAgIHZhciBtYXQgPSB0dWIubWF0KCk7CiAgICAgICAgcmVxdWlyZShheGUgPj0gUkFZICYmIGF4ZSA8PSBtYXQpOwogICAgfQogICAgLy8gU3RhYmlsaXR5IGZlZQogICAgZnVuY3Rpb24gc2V0VGF4KHVpbnQgcmF5KSBwdWJsaWMgbm90ZSBhdXRoIHsKICAgICAgICB0dWIubW9sZCgidGF4IiwgcmF5KTsKICAgICAgICB2YXIgdGF4ID0gdHViLnRheCgpOwogICAgICAgIHJlcXVpcmUoUkFZIDw9IHRheCk7CiAgICAgICAgcmVxdWlyZSh0YXggPCAxMDAwMiAqIDEwICoqIDIzKTsgIC8vIH4yMDAlIHBlciBob3VyCiAgICB9CiAgICAvLyBHb3Zlcm5hbmNlIGZlZQogICAgZnVuY3Rpb24gc2V0RmVlKHVpbnQgcmF5KSBwdWJsaWMgbm90ZSBhdXRoIHsKICAgICAgICB0dWIubW9sZCgiZmVlIiwgcmF5KTsKICAgICAgICB2YXIgZmVlID0gdHViLmZlZSgpOwogICAgICAgIHJlcXVpcmUoUkFZIDw9IGZlZSk7CiAgICAgICAgcmVxdWlyZShmZWUgPCAxMDAwMiAqIDEwICoqIDIzKTsgIC8vIH4yMDAlIHBlciBob3VyCiAgICB9CiAgICAvLyBMaXF1aWRhdGlvbiBmZWUKICAgIGZ1bmN0aW9uIHNldEF4ZSh1aW50IHJheSkgcHVibGljIG5vdGUgYXV0aCB7CiAgICAgICAgdHViLm1vbGQoImF4ZSIsIHJheSk7CiAgICAgICAgdmFyIGF4ZSA9IHR1Yi5heGUoKTsKICAgICAgICB2YXIgbWF0ID0gdHViLm1hdCgpOwogICAgICAgIHJlcXVpcmUoYXhlID49IFJBWSAmJiBheGUgPD0gbWF0KTsKICAgIH0KICAgIC8vIEpvaW4vRXhpdCBTcHJlYWQKICAgIGZ1bmN0aW9uIHNldFR1YkdhcCh1aW50IHdhZCkgcHVibGljIG5vdGUgYXV0aCB7CiAgICAgICAgdHViLm1vbGQoImdhcCIsIHdhZCk7CiAgICB9CiAgICAvLyBFVEgvVVNEIEZlZWQKICAgIGZ1bmN0aW9uIHNldFBpcChEU1ZhbHVlIHBpcF8pIHB1YmxpYyBub3RlIGF1dGggewogICAgICAgIHR1Yi5zZXRQaXAocGlwXyk7CiAgICB9CiAgICAvLyBNS1IvVVNEIEZlZWQKICAgIGZ1bmN0aW9uIHNldFBlcChEU1ZhbHVlIHBlcF8pIHB1YmxpYyBub3RlIGF1dGggewogICAgICAgIHR1Yi5zZXRQZXAocGVwXyk7CiAgICB9CiAgICAvLyBUUkZNCiAgICBmdW5jdGlvbiBzZXRWb3goU2FpVm94IHZveF8pIHB1YmxpYyBub3RlIGF1dGggewogICAgICAgIHR1Yi5zZXRWb3godm94Xyk7CiAgICB9CiAgICAvLyBCb29tL0J1c3QgU3ByZWFkCiAgICBmdW5jdGlvbiBzZXRUYXBHYXAodWludCB3YWQpIHB1YmxpYyBub3RlIGF1dGggewogICAgICAgIHRhcC5tb2xkKCJnYXAiLCB3YWQpOwogICAgICAgIHZhciBnYXAgPSB0YXAuZ2FwKCk7CiAgICAgICAgcmVxdWlyZShnYXAgPD0gMS4wNSBldGhlcik7CiAgICAgICAgcmVxdWlyZShnYXAgPj0gMC45NSBldGhlcik7CiAgICB9CiAgICAvLyBSYXRlIG9mIGNoYW5nZSBvZiB0YXJnZXQgcHJpY2UgKHBlciBzZWNvbmQpCiAgICBmdW5jdGlvbiBzZXRXYXkodWludCByYXkpIHB1YmxpYyBub3RlIGF1dGggewogICAgICAgIHJlcXVpcmUocmF5IDwgMTAwMDIgKiAxMCAqKiAyMyk7ICAvLyB+MjAwJSBwZXIgaG91cgogICAgICAgIHJlcXVpcmUocmF5ID4gOTk5OCAqIDEwICoqIDIzKTsKICAgICAgICB2b3gubW9sZCgid2F5IiwgcmF5KTsKICAgIH0KICAgIGZ1bmN0aW9uIHNldEhvdyh1aW50IHJheSkgcHVibGljIG5vdGUgYXV0aCB7CiAgICAgICAgdm94LnR1bmUocmF5KTsKICAgIH0KfQoKLy8vLy8vIHNyYy9mYWIuc29sCi8qIHByYWdtYSBzb2xpZGl0eSBeMC40LjE4OyAqLwoKLyogaW1wb3J0ICJkcy1hdXRoL2F1dGguc29sIjsgKi8KLyogaW1wb3J0ICdkcy10b2tlbi90b2tlbi5zb2wnOyAqLwovKiBpbXBvcnQgJ2RzLWd1YXJkL2d1YXJkLnNvbCc7ICovCi8qIGltcG9ydCAnZHMtcm9sZXMvcm9sZXMuc29sJzsgKi8KLyogaW1wb3J0ICdkcy12YWx1ZS92YWx1ZS5zb2wnOyAqLwoKLyogaW1wb3J0ICcuL21vbS5zb2wnOyAqLwoKY29udHJhY3QgR2VtRmFiIHsKICAgIGZ1bmN0aW9uIG5ld1RvayhieXRlczMyIG5hbWUpIHB1YmxpYyByZXR1cm5zIChEU1Rva2VuIHRva2VuKSB7CiAgICAgICAgdG9rZW4gPSBuZXcgRFNUb2tlbihuYW1lKTsKICAgICAgICB0b2tlbi5zZXRPd25lcihtc2cuc2VuZGVyKTsKICAgIH0KfQoKY29udHJhY3QgVm94RmFiIHsKICAgIGZ1bmN0aW9uIG5ld1ZveCgpIHB1YmxpYyByZXR1cm5zIChTYWlWb3ggdm94KSB7CiAgICAgICAgdm94ID0gbmV3IFNhaVZveCgxMCAqKiAyNyk7CiAgICAgICAgdm94LnNldE93bmVyKG1zZy5zZW5kZXIpOwogICAgfQp9Cgpjb250cmFjdCBUdWJGYWIgewogICAgZnVuY3Rpb24gbmV3VHViKERTVG9rZW4gc2FpLCBEU1Rva2VuIHNpbiwgRFNUb2tlbiBza3IsIEVSQzIwIGdlbSwgRFNUb2tlbiBnb3YsIERTVmFsdWUgcGlwLCBEU1ZhbHVlIHBlcCwgU2FpVm94IHZveCwgYWRkcmVzcyBwaXQpIHB1YmxpYyByZXR1cm5zIChTYWlUdWIgdHViKSB7CiAgICAgICAgdHViID0gbmV3IFNhaVR1YihzYWksIHNpbiwgc2tyLCBnZW0sIGdvdiwgcGlwLCBwZXAsIHZveCwgcGl0KTsKICAgICAgICB0dWIuc2V0T3duZXIobXNnLnNlbmRlcik7CiAgICB9Cn0KCmNvbnRyYWN0IFRhcEZhYiB7CiAgICBmdW5jdGlvbiBuZXdUYXAoU2FpVHViIHR1YikgcHVibGljIHJldHVybnMgKFNhaVRhcCB0YXApIHsKICAgICAgICB0YXAgPSBuZXcgU2FpVGFwKHR1Yik7CiAgICAgICAgdGFwLnNldE93bmVyKG1zZy5zZW5kZXIpOwogICAgfQp9Cgpjb250cmFjdCBUb3BGYWIgewogICAgZnVuY3Rpb24gbmV3VG9wKFNhaVR1YiB0dWIsIFNhaVRhcCB0YXApIHB1YmxpYyByZXR1cm5zIChTYWlUb3AgdG9wKSB7CiAgICAgICAgdG9wID0gbmV3IFNhaVRvcCh0dWIsIHRhcCk7CiAgICAgICAgdG9wLnNldE93bmVyKG1zZy5zZW5kZXIpOwogICAgfQp9Cgpjb250cmFjdCBNb21GYWIgewogICAgZnVuY3Rpb24gbmV3TW9tKFNhaVR1YiB0dWIsIFNhaVRhcCB0YXAsIFNhaVZveCB2b3gpIHB1YmxpYyByZXR1cm5zIChTYWlNb20gbW9tKSB7CiAgICAgICAgbW9tID0gbmV3IFNhaU1vbSh0dWIsIHRhcCwgdm94KTsKICAgICAgICBtb20uc2V0T3duZXIobXNnLnNlbmRlcik7CiAgICB9Cn0KCmNvbnRyYWN0IERhZEZhYiB7CiAgICBmdW5jdGlvbiBuZXdEYWQoKSBwdWJsaWMgcmV0dXJucyAoRFNHdWFyZCBkYWQpIHsKICAgICAgICBkYWQgPSBuZXcgRFNHdWFyZCgpOwogICAgICAgIGRhZC5zZXRPd25lcihtc2cuc2VuZGVyKTsKICAgIH0KfQoKY29udHJhY3QgRGFpRmFiIGlzIERTQXV0aCB7CiAgICBHZW1GYWIgcHVibGljIGdlbUZhYjsKICAgIFZveEZhYiBwdWJsaWMgdm94RmFiOwogICAgVGFwRmFiIHB1YmxpYyB0YXBGYWI7CiAgICBUdWJGYWIgcHVibGljIHR1YkZhYjsKICAgIFRvcEZhYiBwdWJsaWMgdG9wRmFiOwogICAgTW9tRmFiIHB1YmxpYyBtb21GYWI7CiAgICBEYWRGYWIgcHVibGljIGRhZEZhYjsKCiAgICBEU1Rva2VuIHB1YmxpYyBzYWk7CiAgICBEU1Rva2VuIHB1YmxpYyBzaW47CiAgICBEU1Rva2VuIHB1YmxpYyBza3I7CgogICAgU2FpVm94IHB1YmxpYyB2b3g7CiAgICBTYWlUdWIgcHVibGljIHR1YjsKICAgIFNhaVRhcCBwdWJsaWMgdGFwOwogICAgU2FpVG9wIHB1YmxpYyB0b3A7CgogICAgU2FpTW9tIHB1YmxpYyBtb207CiAgICBEU0d1YXJkIHB1YmxpYyBkYWQ7CgogICAgdWludDggcHVibGljIHN0ZXAgPSAwOwoKICAgIGZ1bmN0aW9uIERhaUZhYihHZW1GYWIgZ2VtRmFiXywgVm94RmFiIHZveEZhYl8sIFR1YkZhYiB0dWJGYWJfLCBUYXBGYWIgdGFwRmFiXywgVG9wRmFiIHRvcEZhYl8sIE1vbUZhYiBtb21GYWJfLCBEYWRGYWIgZGFkRmFiXykgcHVibGljIHsKICAgICAgICBnZW1GYWIgPSBnZW1GYWJfOwogICAgICAgIHZveEZhYiA9IHZveEZhYl87CiAgICAgICAgdHViRmFiID0gdHViRmFiXzsKICAgICAgICB0YXBGYWIgPSB0YXBGYWJfOwogICAgICAgIHRvcEZhYiA9IHRvcEZhYl87CiAgICAgICAgbW9tRmFiID0gbW9tRmFiXzsKICAgICAgICBkYWRGYWIgPSBkYWRGYWJfOwogICAgfQoKICAgIGZ1bmN0aW9uIG1ha2VUb2tlbnMoKSBwdWJsaWMgYXV0aCB7CiAgICAgICAgcmVxdWlyZShzdGVwID09IDApOwogICAgICAgIHNhaSA9IGdlbUZhYi5uZXdUb2soJ3NhaScpOwogICAgICAgIHNpbiA9IGdlbUZhYi5uZXdUb2soJ3NpbicpOwogICAgICAgIHNrciA9IGdlbUZhYi5uZXdUb2soJ3NrcicpOwogICAgICAgIHN0ZXAgKz0gMTsKICAgIH0KCiAgICBmdW5jdGlvbiBtYWtlVm94VHViKEVSQzIwIGdlbSwgRFNUb2tlbiBnb3YsIERTVmFsdWUgcGlwLCBEU1ZhbHVlIHBlcCwgYWRkcmVzcyBwaXQpIHB1YmxpYyBhdXRoIHsKICAgICAgICByZXF1aXJlKHN0ZXAgPT0gMSk7CiAgICAgICAgcmVxdWlyZShhZGRyZXNzKGdlbSkgIT0gMHgwKTsKICAgICAgICByZXF1aXJlKGFkZHJlc3MoZ292KSAhPSAweDApOwogICAgICAgIHJlcXVpcmUoYWRkcmVzcyhwaXApICE9IDB4MCk7CiAgICAgICAgcmVxdWlyZShhZGRyZXNzKHBlcCkgIT0gMHgwKTsKICAgICAgICByZXF1aXJlKHBpdCAhPSAweDApOwogICAgICAgIHZveCA9IHZveEZhYi5uZXdWb3goKTsKICAgICAgICB0dWIgPSB0dWJGYWIubmV3VHViKHNhaSwgc2luLCBza3IsIGdlbSwgZ292LCBwaXAsIHBlcCwgdm94LCBwaXQpOwogICAgICAgIHN0ZXAgKz0gMTsKICAgIH0KCiAgICBmdW5jdGlvbiBtYWtlVGFwVG9wKCkgcHVibGljIGF1dGggewogICAgICAgIHJlcXVpcmUoc3RlcCA9PSAyKTsKICAgICAgICB0YXAgPSB0YXBGYWIubmV3VGFwKHR1Yik7CiAgICAgICAgdHViLnR1cm4odGFwKTsKICAgICAgICB0b3AgPSB0b3BGYWIubmV3VG9wKHR1YiwgdGFwKTsKICAgICAgICBzdGVwICs9IDE7CiAgICB9CgogICAgZnVuY3Rpb24gUyhzdHJpbmcgcykgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChieXRlczQpIHsKICAgICAgICByZXR1cm4gYnl0ZXM0KGtlY2NhazI1NihzKSk7CiAgICB9CgogICAgZnVuY3Rpb24gcmF5KHVpbnQyNTYgd2FkKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gd2FkICogMTAgKiogOTsKICAgIH0KCiAgICAvLyBMaXF1aWRhdGlvbiBSYXRpbyAgIDE1MCUKICAgIC8vIExpcXVpZGF0aW9uIFBlbmFsdHkgMTMlCiAgICAvLyBTdGFiaWxpdHkgRmVlICAgICAgIDAuMDUlCiAgICAvLyBQRVRIIEZlZSAgICAgICAgICAgIDAlCiAgICAvLyBCb29tL0J1c3QgU3ByZWFkICAgLTMlCiAgICAvLyBKb2luL0V4aXQgU3ByZWFkICAgIDAlCiAgICAvLyBEZWJ0IENlaWxpbmcgICAgICAgIDAKICAgIGZ1bmN0aW9uIGNvbmZpZ1BhcmFtcygpIHB1YmxpYyBhdXRoIHsKICAgICAgICByZXF1aXJlKHN0ZXAgPT0gMyk7CgogICAgICAgIHR1Yi5tb2xkKCJjYXAiLCAwKTsKICAgICAgICB0dWIubW9sZCgibWF0IiwgcmF5KDEuNSAgZXRoZXIpKTsKICAgICAgICB0dWIubW9sZCgiYXhlIiwgcmF5KDEuMTMgZXRoZXIpKTsKICAgICAgICB0dWIubW9sZCgiZmVlIiwgMTAwMDAwMDAwMDE1ODE1MzkwMzgzNzk0NjI1Nyk7ICAvLyAwLjUlIC8geWVhcgogICAgICAgIHR1Yi5tb2xkKCJ0YXgiLCByYXkoMSBldGhlcikpOwogICAgICAgIHR1Yi5tb2xkKCJnYXAiLCAxIGV0aGVyKTsKCiAgICAgICAgdGFwLm1vbGQoImdhcCIsIDAuOTcgZXRoZXIpOwoKICAgICAgICBzdGVwICs9IDE7CiAgICB9CgogICAgZnVuY3Rpb24gdmVyaWZ5UGFyYW1zKCkgcHVibGljIGF1dGggewogICAgICAgIHJlcXVpcmUoc3RlcCA9PSA0KTsKCiAgICAgICAgcmVxdWlyZSh0dWIuY2FwKCkgPT0gMCk7CiAgICAgICAgcmVxdWlyZSh0dWIubWF0KCkgPT0gMTUwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCk7CiAgICAgICAgcmVxdWlyZSh0dWIuYXhlKCkgPT0gMTEzMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCk7CiAgICAgICAgcmVxdWlyZSh0dWIuZmVlKCkgPT0gMTAwMDAwMDAwMDE1ODE1MzkwMzgzNzk0NjI1Nyk7CiAgICAgICAgcmVxdWlyZSh0dWIudGF4KCkgPT0gMTAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCk7CiAgICAgICAgcmVxdWlyZSh0dWIuZ2FwKCkgPT0gMTAwMDAwMDAwMDAwMDAwMDAwMCk7CgogICAgICAgIHJlcXVpcmUodGFwLmdhcCgpID09IDk3MDAwMDAwMDAwMDAwMDAwMCk7CgogICAgICAgIHJlcXVpcmUodm94LnBhcigpID09IDEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDApOwogICAgICAgIHJlcXVpcmUodm94LmhvdygpID09IDApOwoKICAgICAgICBzdGVwICs9IDE7CiAgICB9CgogICAgZnVuY3Rpb24gY29uZmlnQXV0aChEU0F1dGhvcml0eSBhdXRob3JpdHkpIHB1YmxpYyBhdXRoIHsKICAgICAgICByZXF1aXJlKHN0ZXAgPT0gNSk7CiAgICAgICAgcmVxdWlyZShhZGRyZXNzKGF1dGhvcml0eSkgIT0gMHgwKTsKCiAgICAgICAgbW9tID0gbW9tRmFiLm5ld01vbSh0dWIsIHRhcCwgdm94KTsKICAgICAgICBkYWQgPSBkYWRGYWIubmV3RGFkKCk7CgogICAgICAgIHZveC5zZXRBdXRob3JpdHkoZGFkKTsKICAgICAgICB2b3guc2V0T3duZXIoMCk7CiAgICAgICAgdHViLnNldEF1dGhvcml0eShkYWQpOwogICAgICAgIHR1Yi5zZXRPd25lcigwKTsKICAgICAgICB0YXAuc2V0QXV0aG9yaXR5KGRhZCk7CiAgICAgICAgdGFwLnNldE93bmVyKDApOwogICAgICAgIHNhaS5zZXRBdXRob3JpdHkoZGFkKTsKICAgICAgICBzYWkuc2V0T3duZXIoMCk7CiAgICAgICAgc2luLnNldEF1dGhvcml0eShkYWQpOwogICAgICAgIHNpbi5zZXRPd25lcigwKTsKICAgICAgICBza3Iuc2V0QXV0aG9yaXR5KGRhZCk7CiAgICAgICAgc2tyLnNldE93bmVyKDApOwoKICAgICAgICB0b3Auc2V0QXV0aG9yaXR5KGF1dGhvcml0eSk7CiAgICAgICAgdG9wLnNldE93bmVyKDApOwogICAgICAgIG1vbS5zZXRBdXRob3JpdHkoYXV0aG9yaXR5KTsKICAgICAgICBtb20uc2V0T3duZXIoMCk7CgogICAgICAgIGRhZC5wZXJtaXQodG9wLCB0dWIsIFMoImNhZ2UodWludDI1Nix1aW50MjU2KSIpKTsKICAgICAgICBkYWQucGVybWl0KHRvcCwgdHViLCBTKCJmbG93KCkiKSk7CiAgICAgICAgZGFkLnBlcm1pdCh0b3AsIHRhcCwgUygiY2FnZSh1aW50MjU2KSIpKTsKCiAgICAgICAgZGFkLnBlcm1pdCh0dWIsIHNrciwgUygnbWludChhZGRyZXNzLHVpbnQyNTYpJykpOwogICAgICAgIGRhZC5wZXJtaXQodHViLCBza3IsIFMoJ2J1cm4oYWRkcmVzcyx1aW50MjU2KScpKTsKCiAgICAgICAgZGFkLnBlcm1pdCh0dWIsIHNhaSwgUygnbWludChhZGRyZXNzLHVpbnQyNTYpJykpOwogICAgICAgIGRhZC5wZXJtaXQodHViLCBzYWksIFMoJ2J1cm4oYWRkcmVzcyx1aW50MjU2KScpKTsKCiAgICAgICAgZGFkLnBlcm1pdCh0dWIsIHNpbiwgUygnbWludChhZGRyZXNzLHVpbnQyNTYpJykpOwoKICAgICAgICBkYWQucGVybWl0KHRhcCwgc2FpLCBTKCdtaW50KGFkZHJlc3MsdWludDI1NiknKSk7CiAgICAgICAgZGFkLnBlcm1pdCh0YXAsIHNhaSwgUygnYnVybihhZGRyZXNzLHVpbnQyNTYpJykpOwogICAgICAgIGRhZC5wZXJtaXQodGFwLCBzYWksIFMoJ2J1cm4odWludDI1NiknKSk7CiAgICAgICAgZGFkLnBlcm1pdCh0YXAsIHNpbiwgUygnYnVybih1aW50MjU2KScpKTsKCiAgICAgICAgZGFkLnBlcm1pdCh0YXAsIHNrciwgUygnbWludCh1aW50MjU2KScpKTsKICAgICAgICBkYWQucGVybWl0KHRhcCwgc2tyLCBTKCdidXJuKHVpbnQyNTYpJykpOwogICAgICAgIGRhZC5wZXJtaXQodGFwLCBza3IsIFMoJ2J1cm4oYWRkcmVzcyx1aW50MjU2KScpKTsKCiAgICAgICAgZGFkLnBlcm1pdChtb20sIHZveCwgUygibW9sZChieXRlczMyLHVpbnQyNTYpIikpOwogICAgICAgIGRhZC5wZXJtaXQobW9tLCB2b3gsIFMoInR1bmUodWludDI1NikiKSk7CiAgICAgICAgZGFkLnBlcm1pdChtb20sIHR1YiwgUygibW9sZChieXRlczMyLHVpbnQyNTYpIikpOwogICAgICAgIGRhZC5wZXJtaXQobW9tLCB0YXAsIFMoIm1vbGQoYnl0ZXMzMix1aW50MjU2KSIpKTsKICAgICAgICBkYWQucGVybWl0KG1vbSwgdHViLCBTKCJzZXRQaXAoYWRkcmVzcykiKSk7CiAgICAgICAgZGFkLnBlcm1pdChtb20sIHR1YiwgUygic2V0UGVwKGFkZHJlc3MpIikpOwogICAgICAgIGRhZC5wZXJtaXQobW9tLCB0dWIsIFMoInNldFZveChhZGRyZXNzKSIpKTsKCiAgICAgICAgZGFkLnNldE93bmVyKDApOwogICAgICAgIHN0ZXAgKz0gMTsKICAgIH0KfQ=='.
	

]
