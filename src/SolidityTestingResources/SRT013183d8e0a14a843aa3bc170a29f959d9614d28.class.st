Class {
	#name : #SRT013183d8e0a14a843aa3bc170a29f959d9614d28,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT013183d8e0a14a843aa3bc170a29f959d9614d28 >> base64 [
	^ 'Y29udHJhY3QgQ2VydGlmaWVyIHsKCWV2ZW50IENvbmZpcm1lZChhZGRyZXNzIGluZGV4ZWQgd2hvKTsKCWV2ZW50IFJldm9rZWQoYWRkcmVzcyBpbmRleGVkIHdobyk7CglmdW5jdGlvbiBjZXJ0aWZpZWQoYWRkcmVzcyBfd2hvKSB2aWV3IHB1YmxpYyByZXR1cm5zIChib29sKTsKfQoKY29udHJhY3QgRVJDMjIzUmVjZWl2aW5nQ29udHJhY3QgewoKICAgIC8vLyBAZGV2IFN0YW5kYXJkIEVSQzIyMyBmdW5jdGlvbiB0aGF0IHdpbGwgaGFuZGxlIGluY29taW5nIHRva2VuIHRyYW5zZmVycy4KICAgIC8vLyBAcGFyYW0gX2Zyb20gIFRva2VuIHNlbmRlciBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBfdmFsdWUgQW1vdW50IG9mIHRva2Vucy4KICAgIC8vLyBAcGFyYW0gX2RhdGEgIFRyYW5zYWN0aW9uIG1ldGFkYXRhLgogICAgZnVuY3Rpb24gdG9rZW5GYWxsYmFjayhhZGRyZXNzIF9mcm9tLCB1aW50IF92YWx1ZSwgYnl0ZXMgX2RhdGEpIHB1YmxpYzsKCn0KCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KCmNvbnRyYWN0IEVSQzIyM0Jhc2ljIGlzIEVSQzIwQmFzaWMgewoKICAgIC8qKgogICAgICAqIEBkZXYgVHJhbnNmZXIgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIHRvIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAgICAgKiAgICAgIE5vdyB3aXRoIGEgbmV3IHBhcmFtZXRlciBfZGF0YS4KICAgICAgKgogICAgICAqIEBwYXJhbSBfdG8gICAgUmVjZWl2ZXIgYWRkcmVzcy4KICAgICAgKiBAcGFyYW0gX3ZhbHVlIEFtb3VudCBvZiB0b2tlbnMgdGhhdCB3aWxsIGJlIHRyYW5zZmVycmVkLgogICAgICAqIEBwYXJhbSBfZGF0YSAgVHJhbnNhY3Rpb24gbWV0YWRhdGEuCiAgICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUsIGJ5dGVzIF9kYXRhKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CgogICAgLyoqCiAgICAgICogQGRldiB0cmlnZ2VyZWQgd2hlbiB0cmFuc2ZlciBpcyBzdWNjZXNzZnVsbHkgY2FsbGVkLgogICAgICAqCiAgICAgICogQHBhcmFtIF9mcm9tICBTZW5kZXIgYWRkcmVzcy4KICAgICAgKiBAcGFyYW0gX3RvICAgIFJlY2VpdmVyIGFkZHJlc3MuCiAgICAgICogQHBhcmFtIF92YWx1ZSBBbW91bnQgb2YgdG9rZW5zIHRoYXQgd2lsbCBiZSB0cmFuc2ZlcnJlZC4KICAgICAgKiBAcGFyYW0gX2RhdGEgIFRyYW5zYWN0aW9uIG1ldGFkYXRhLgogICAgICAqLwogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IGluZGV4ZWQgX3ZhbHVlLCBieXRlcyBfZGF0YSk7Cn0KCgpjb250cmFjdCBTYWZlTWF0aCB7CgogIC8qKgogICogQGRldiBNdWx0aXBsaWVzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cuCiAgKi8KICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgaWYgKGEgPT0gMCkgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICAvKioKICAqIEBkZXYgSW50ZWdlciBkaXZpc2lvbiBvZiB0d28gbnVtYmVycywgdHJ1bmNhdGluZyB0aGUgcXVvdGllbnQuCiAgKi8KICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIC8qKgogICogQGRldiBTdWJzdHJhY3RzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cgKGkuZS4gaWYgc3VidHJhaGVuZCBpcyBncmVhdGVyIHRoYW4gbWludWVuZCkuCiAgKi8KICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICAvKioKICAqIEBkZXYgQWRkcyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93LgogICovCiAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKCiAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIHByZXZpb3VzT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBuZXdPd25lcik7CgoKICAvKioKICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgKiBhY2NvdW50LgogICAqLwogIGZ1bmN0aW9uIE93bmFibGUoKSBwdWJsaWMgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZShuZXdPd25lciAhPSBhZGRyZXNzKDApKTsKICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBuZXdPd25lcik7CiAgICBvd25lciA9IG5ld093bmVyOwogIH0KCn0KCgpjb250cmFjdCBEZXRoZXJCYW5rIGlzIEVSQzIyM1JlY2VpdmluZ0NvbnRyYWN0LCBPd25hYmxlLCBTYWZlTWF0aCAgewogIHVzaW5nIEJ5dGVzTGliIGZvciBieXRlczsKCiAgLyoKICAgKiBFdmVudAogICAqLwogIGV2ZW50IHJlY2VpdmVEdGgoYWRkcmVzcyBfZnJvbSwgdWludCBhbW91bnQpOwogIGV2ZW50IHJlY2VpdmVFdGgoYWRkcmVzcyBfZnJvbSwgdWludCBhbW91bnQpOwogIGV2ZW50IHNlbmREdGgoYWRkcmVzcyBfZnJvbSwgdWludCBhbW91bnQpOwogIGV2ZW50IHNlbmRFdGgoYWRkcmVzcyBfZnJvbSwgdWludCBhbW91bnQpOwoKICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgcHVibGljIGR0aFNob3BCYWxhbmNlOwogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgZHRoVGVsbGVyQmFsYW5jZTsKICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgcHVibGljIGV0aFNob3BCYWxhbmNlOwogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgZXRoVGVsbGVyQmFsYW5jZTsKCiAgRVJDMjIzQmFzaWMgcHVibGljIGR0aDsKICBib29sIHB1YmxpYyBpc0luaXQgPSBmYWxzZTsKCiAgLyoqCiAgICogSU5JVAogICAqLwogIGZ1bmN0aW9uIHNldER0aCAoYWRkcmVzcyBfZHRoKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgcmVxdWlyZSghaXNJbml0KTsKICAgIGR0aCA9IEVSQzIyM0Jhc2ljKF9kdGgpOwogICAgaXNJbml0ID0gdHJ1ZTsKICB9CgogIC8qKgogICAqIENvcmUgZm9uY3Rpb24KICAgKi8KICAvLyB3aXRoZHJhdyBEVEggd2hlbiB0ZWxsZXIgZGVsZXRlCiAgZnVuY3Rpb24gd2l0aGRyYXdEdGhUZWxsZXIoYWRkcmVzcyBfcmVjZWl2ZXIpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICByZXF1aXJlKGR0aFRlbGxlckJhbGFuY2VbX3JlY2VpdmVyXSA+IDApOwogICAgdWludCB0b3NlbmQgPSBkdGhUZWxsZXJCYWxhbmNlW19yZWNlaXZlcl07CiAgICBkdGhUZWxsZXJCYWxhbmNlW19yZWNlaXZlcl0gPSAwOwogICAgcmVxdWlyZShkdGgudHJhbnNmZXIoX3JlY2VpdmVyLCB0b3NlbmQpKTsKICB9CiAgLy8gd2l0aGRyYXcgRFRIIHdoZW4gc2hvcCBkZWxldGUKICBmdW5jdGlvbiB3aXRoZHJhd0R0aFNob3AoYWRkcmVzcyBfcmVjZWl2ZXIpIGV4dGVybmFsIG9ubHlPd25lciAgewogICAgcmVxdWlyZShkdGhTaG9wQmFsYW5jZVtfcmVjZWl2ZXJdID4gMCk7CiAgICB1aW50IHRvc2VuZCA9IGR0aFNob3BCYWxhbmNlW19yZWNlaXZlcl07CiAgICBkdGhTaG9wQmFsYW5jZVtfcmVjZWl2ZXJdID0gMDsKICAgIHJlcXVpcmUoZHRoLnRyYW5zZmVyKF9yZWNlaXZlciwgdG9zZW5kKSk7CiAgfQogIC8vIHdpdGhkcmF3IERUSCB3aGVuIGEgc2hvcCBhZGQgYnkgYWRtaW4gaXMgZGVsZXRlCiAgZnVuY3Rpb24gd2l0aGRyYXdEdGhTaG9wQWRtaW4oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfcmVjZWl2ZXIpIGV4dGVybmFsIG9ubHlPd25lciAgewogICAgcmVxdWlyZShkdGhTaG9wQmFsYW5jZVtfZnJvbV0gID4gMCk7CiAgICB1aW50IHRvc2VuZCA9IGR0aFNob3BCYWxhbmNlW19mcm9tXTsKICAgIGR0aFNob3BCYWxhbmNlW19mcm9tXSA9IDA7CiAgICByZXF1aXJlKGR0aC50cmFuc2ZlcihfcmVjZWl2ZXIsIHRvc2VuZCkpOwogIH0KCiAgLy8gYWRkIERUSCB3aGVuIHNob3AgcmVnaXN0ZXIKICBmdW5jdGlvbiBhZGRUb2tlblNob3AoYWRkcmVzcyBfZnJvbSwgdWludCBfdmFsdWUpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICBkdGhTaG9wQmFsYW5jZVtfZnJvbV0gPSBTYWZlTWF0aC5hZGQoZHRoU2hvcEJhbGFuY2VbX2Zyb21dLCBfdmFsdWUpOwogIH0KICAvLyBhZGQgRFRIIHdoZW4gdG9rZW4gcmVnaXN0ZXIKICBmdW5jdGlvbiBhZGRUb2tlblRlbGxlcihhZGRyZXNzIF9mcm9tLCB1aW50IF92YWx1ZSkgZXh0ZXJuYWwgb25seU93bmVyewogICAgZHRoVGVsbGVyQmFsYW5jZVtfZnJvbV0gPSBTYWZlTWF0aC5hZGQoZHRoVGVsbGVyQmFsYW5jZVtfZnJvbV0sIF92YWx1ZSk7CiAgfQogIC8vIGFkZCBFVEggZm9yIGVzY3JvdyB0ZWxsZXIKICBmdW5jdGlvbiBhZGRFdGhUZWxsZXIoYWRkcmVzcyBfZnJvbSwgdWludCBfdmFsdWUpIGV4dGVybmFsIHBheWFibGUgb25seU93bmVyIHJldHVybnMgKGJvb2wpIHsKICAgIGV0aFRlbGxlckJhbGFuY2VbX2Zyb21dID0gU2FmZU1hdGguYWRkKGV0aFRlbGxlckJhbGFuY2VbX2Zyb21dICxfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQogIC8vIHdpdGhkcmF3IEVUSCBmb3IgdGVsbGVyIGVzY3JvdwogIGZ1bmN0aW9uIHdpdGhkcmF3RXRoKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF9hbW91bnQpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICByZXF1aXJlKGV0aFRlbGxlckJhbGFuY2VbX2Zyb21dID49IF9hbW91bnQpOwogICAgZXRoVGVsbGVyQmFsYW5jZVtfZnJvbV0gPSBTYWZlTWF0aC5zdWIoZXRoVGVsbGVyQmFsYW5jZVtfZnJvbV0sIF9hbW91bnQpOwogICAgX3RvLnRyYW5zZmVyKF9hbW91bnQpOwogIH0KICAvLyByZWZ1bmQgYWxsIEVUSCBmcm9tIHRlbGxlciBjb250cmFjdAogIGZ1bmN0aW9uIHJlZnVuZEV0aChhZGRyZXNzIF9mcm9tKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgdWludCB0b1NlbmQgPSBldGhUZWxsZXJCYWxhbmNlW19mcm9tXTsKICAgIGlmICh0b1NlbmQgPiAwKSB7CiAgICAgIGV0aFRlbGxlckJhbGFuY2VbX2Zyb21dID0gMDsKICAgICAgX2Zyb20udHJhbnNmZXIodG9TZW5kKTsKICAgIH0KICB9CgogIC8qKgogICAqIEdFVFRFUgogICAqLwogIGZ1bmN0aW9uIGdldER0aFRlbGxlcihhZGRyZXNzIF91c2VyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gZHRoVGVsbGVyQmFsYW5jZVtfdXNlcl07CiAgfQogIGZ1bmN0aW9uIGdldER0aFNob3AoYWRkcmVzcyBfdXNlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIGR0aFNob3BCYWxhbmNlW191c2VyXTsKICB9CgogIGZ1bmN0aW9uIGdldEV0aEJhbFRlbGxlcihhZGRyZXNzIF91c2VyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gZXRoVGVsbGVyQmFsYW5jZVtfdXNlcl07CiAgfQogIC8vLyBAZGV2IFN0YW5kYXJkIEVSQzIyMyBmdW5jdGlvbiB0aGF0IHdpbGwgaGFuZGxlIGluY29taW5nIHRva2VuIHRyYW5zZmVycy4KICAvLyBETyBOT1RISU5HIGJ1dCBhbGxvdyB0byByZWNlaXZlIHRva2VuIHdoZW4gYWRkVG9rZW4qIGZ1bmN0aW9uIGFyZSBjYWxsZWQKICAvLyBieSB0aGUgZGV0aGVyY29yZSBjb250cmFjdAogIGZ1bmN0aW9uIHRva2VuRmFsbGJhY2soYWRkcmVzcyBfZnJvbSwgdWludCBfdmFsdWUsIGJ5dGVzIF9kYXRhKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhkdGgpKTsKICB9Cgp9CgoKY29udHJhY3QgRGV0aGVyQWNjZXNzQ29udHJvbCB7CiAgICAvLyBUaGlzIGZhY2V0IGNvbnRyb2xzIGFjY2VzcyBjb250cm9sIGZvciBEZXRoZXIuIFRoZXJlIGFyZSBmb3VyIHJvbGVzIG1hbmFnZWQgaGVyZToKICAgIC8vCiAgICAvLyAgICAgLSBUaGUgQ0VPOiBUaGUgQ0VPIGNhbiByZWFzc2lnbiBvdGhlciByb2xlcyBhbmQgY2hhbmdlIHRoZSBhZGRyZXNzZXMgb2Ygb3VyIGRlcGVuZGVudCBzbWFydAogICAgLy8gICAgICAgICBjb250cmFjdHMuIEl0IGlzIGFsc28gdGhlIG9ubHkgcm9sZSB0aGF0IGNhbiB1bnBhdXNlIHRoZSBzbWFydCBjb250cmFjdC4KICAgIC8vCiAgICAvLyAgICAgLSBUaGUgQ01POiBUaGUgQ01PIGlzIGluIGNoYXJnZSB0byBvcGVuIG9yIGNsb3NlIGFjdGl2aXR5IGluIHpvbmUKICAgIC8vCiAgICAvLyBJdCBzaG91bGQgYmUgbm90ZWQgdGhhdCB0aGVzZSByb2xlcyBhcmUgZGlzdGluY3Qgd2l0aG91dCBvdmVybGFwIGluIHRoZWlyIGFjY2VzcyBhYmlsaXRpZXMsIHRoZQogICAgLy8gYWJpbGl0aWVzIGxpc3RlZCBmb3IgZWFjaCByb2xlIGFib3ZlIGFyZSBleGhhdXN0aXZlLiBJbiBwYXJ0aWN1bGFyLCB3aGlsZSB0aGUgQ0VPIGNhbiBhc3NpZ24gYW55CiAgICAvLyBhZGRyZXNzIHRvIGFueSByb2xlLCB0aGUgQ0VPIGFkZHJlc3MgaXRzZWxmIGRvZXNuJ3QgaGF2ZSB0aGUgYWJpbGl0eSB0byBhY3QgaW4gdGhvc2Ugcm9sZXMuIFRoaXMKICAgIC8vIHJlc3RyaWN0aW9uIGlzIGludGVudGlvbmFsIHNvIHRoYXQgd2UgYXJlbid0IHRlbXB0ZWQgdG8gdXNlIHRoZSBDRU8gYWRkcmVzcyBmcmVxdWVudGx5IG91dCBvZgogICAgLy8gY29udmVuaWVuY2UuIFRoZSBsZXNzIHdlIHVzZSBhbiBhZGRyZXNzLCB0aGUgbGVzcyBsaWtlbHkgaXQgaXMgdGhhdCB3ZSBzb21laG93IGNvbXByb21pc2UgdGhlCiAgICAvLyBhY2NvdW50LgoKICAgIC8vLyBAZGV2IEVtaXRlZCB3aGVuIGNvbnRyYWN0IGlzIHVwZ3JhZGVkCiAgICBldmVudCBDb250cmFjdFVwZ3JhZGUoYWRkcmVzcyBuZXdDb250cmFjdCk7CgogICAgLy8gVGhlIGFkZHJlc3NlcyBvZiB0aGUgYWNjb3VudHMgKG9yIGNvbnRyYWN0cykgdGhhdCBjYW4gZXhlY3V0ZSBhY3Rpb25zIHdpdGhpbiBlYWNoIHJvbGVzLgogICAgYWRkcmVzcyBwdWJsaWMgY2VvQWRkcmVzczsKICAgIGFkZHJlc3MgcHVibGljIGNtb0FkZHJlc3M7CiAgICBhZGRyZXNzIHB1YmxpYyBjc29BZGRyZXNzOyAvLyBDSElFRiBTSE9QIE9GRklDRVIKCSAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgc2hvcE1vZGVyYXRvcnM7ICAgLy8gY2VudHJhbGlzZWQgbW9kZXJhdG9yLCB3b3VsZCBiZWNvbWUgZGVjZW50cmFsaXNlZAogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgdGVsbGVyTW9kZXJhdG9yczsgICAvLyBjZW50cmFsaXNlZCBtb2RlcmF0b3IsIHdvdWxkIGJlY29tZSBkZWNlbnRyYWxpc2VkCgogICAgLy8gQGRldiBLZWVwcyB0cmFjayB3aGV0aGVyIHRoZSBjb250cmFjdCBpcyBwYXVzZWQuIFdoZW4gdGhhdCBpcyB0cnVlLCBtb3N0IGFjdGlvbnMgYXJlIGJsb2NrZWQKICAgIGJvb2wgcHVibGljIHBhdXNlZCA9IGZhbHNlOwoKICAgIC8vLyBAZGV2IEFjY2VzcyBtb2RpZmllciBmb3IgQ0VPLW9ubHkgZnVuY3Rpb25hbGl0eQogICAgbW9kaWZpZXIgb25seUNFTygpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY2VvQWRkcmVzcyk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQGRldiBBY2Nlc3MgbW9kaWZpZXIgZm9yIENNTy1vbmx5IGZ1bmN0aW9uYWxpdHkKICAgIG1vZGlmaWVyIG9ubHlDTU8oKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGNtb0FkZHJlc3MpOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gaXNDU08oYWRkcmVzcyBfYWRkcikgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICByZXR1cm4gKF9hZGRyID09IGNzb0FkZHJlc3MpOwogICAgfQoKCiAgICBtb2RpZmllciBpc1Nob3BNb2RlcmF0b3IoYWRkcmVzcyBfdXNlcikgewogICAgICByZXF1aXJlKHNob3BNb2RlcmF0b3JzW191c2VyXSk7CiAgICAgIF87CiAgICB9CiAgICBtb2RpZmllciBpc1RlbGxlck1vZGVyYXRvcihhZGRyZXNzIF91c2VyKSB7CiAgICAgIHJlcXVpcmUodGVsbGVyTW9kZXJhdG9yc1tfdXNlcl0pOwogICAgICBfOwogICAgfQoKICAgIC8vLyBAZGV2IEFzc2lnbnMgYSBuZXcgYWRkcmVzcyB0byBhY3QgYXMgdGhlIENFTy4gT25seSBhdmFpbGFibGUgdG8gdGhlIGN1cnJlbnQgQ0VPLgogICAgLy8vIEBwYXJhbSBfbmV3Q0VPIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgQ0VPCiAgICBmdW5jdGlvbiBzZXRDRU8oYWRkcmVzcyBfbmV3Q0VPKSBleHRlcm5hbCBvbmx5Q0VPIHsKICAgICAgICByZXF1aXJlKF9uZXdDRU8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgY2VvQWRkcmVzcyA9IF9uZXdDRU87CiAgICB9CgogICAgLy8vIEBkZXYgQXNzaWducyBhIG5ldyBhZGRyZXNzIHRvIGFjdCBhcyB0aGUgQ01PLiBPbmx5IGF2YWlsYWJsZSB0byB0aGUgY3VycmVudCBDRU8uCiAgICAvLy8gQHBhcmFtIF9uZXdDTU8gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBDTU8KICAgIGZ1bmN0aW9uIHNldENNTyhhZGRyZXNzIF9uZXdDTU8pIGV4dGVybmFsIG9ubHlDRU8gewogICAgICAgIHJlcXVpcmUoX25ld0NNTyAhPSBhZGRyZXNzKDApKTsKICAgICAgICBjbW9BZGRyZXNzID0gX25ld0NNTzsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRDU08oYWRkcmVzcyBfbmV3Q1NPKSBleHRlcm5hbCBvbmx5Q0VPIHsKICAgICAgICByZXF1aXJlKF9uZXdDU08gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgY3NvQWRkcmVzcyA9IF9uZXdDU087CiAgICB9CgogICAgZnVuY3Rpb24gc2V0U2hvcE1vZGVyYXRvcihhZGRyZXNzIF9tb2RlcmF0b3IpIGV4dGVybmFsIG9ubHlDRU8gewogICAgICByZXF1aXJlKF9tb2RlcmF0b3IgIT0gYWRkcmVzcygwKSk7CiAgICAgIHNob3BNb2RlcmF0b3JzW19tb2RlcmF0b3JdID0gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiByZW1vdmVTaG9wTW9kZXJhdG9yKGFkZHJlc3MgX21vZGVyYXRvcikgZXh0ZXJuYWwgb25seUNFTyB7CiAgICAgIHNob3BNb2RlcmF0b3JzW19tb2RlcmF0b3JdID0gZmFsc2U7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0VGVsbGVyTW9kZXJhdG9yKGFkZHJlc3MgX21vZGVyYXRvcikgZXh0ZXJuYWwgb25seUNFTyB7CiAgICAgIHJlcXVpcmUoX21vZGVyYXRvciAhPSBhZGRyZXNzKDApKTsKICAgICAgdGVsbGVyTW9kZXJhdG9yc1tfbW9kZXJhdG9yXSA9IHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gcmVtb3ZlVGVsbGVyTW9kZXJhdG9yKGFkZHJlc3MgX21vZGVyYXRvcikgZXh0ZXJuYWwgb25seUNFTyB7CiAgICAgIHRlbGxlck1vZGVyYXRvcnNbX21vZGVyYXRvcl0gPSBmYWxzZTsKICAgIH0KICAgIC8qKiogUGF1c2FibGUgZnVuY3Rpb25hbGl0eSBhZGFwdGVkIGZyb20gT3BlblplcHBlbGluICoqKi8KCiAgICAvLy8gQGRldiBNb2RpZmllciB0byBhbGxvdyBhY3Rpb25zIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgSVMgTk9UIHBhdXNlZAogICAgbW9kaWZpZXIgd2hlbk5vdFBhdXNlZCgpIHsKICAgICAgICByZXF1aXJlKCFwYXVzZWQpOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgTW9kaWZpZXIgdG8gYWxsb3cgYWN0aW9ucyBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IElTIHBhdXNlZAogICAgbW9kaWZpZXIgd2hlblBhdXNlZCB7CiAgICAgICAgcmVxdWlyZShwYXVzZWQpOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgQ2FsbGVkIGJ5IGFueSAiQy1sZXZlbCIgcm9sZSB0byBwYXVzZSB0aGUgY29udHJhY3QuIFVzZWQgb25seSB3aGVuCiAgICAvLy8gIGEgYnVnIG9yIGV4cGxvaXQgaXMgZGV0ZWN0ZWQgYW5kIHdlIG5lZWQgdG8gbGltaXQgZGFtYWdlLgogICAgZnVuY3Rpb24gcGF1c2UoKSBleHRlcm5hbCBvbmx5Q0VPIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIHBhdXNlZCA9IHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgVW5wYXVzZXMgdGhlIHNtYXJ0IGNvbnRyYWN0LiBDYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIENFTywgc2luY2UKICAgIC8vLyAgb25lIHJlYXNvbiB3ZSBtYXkgcGF1c2UgdGhlIGNvbnRyYWN0IGlzIHdoZW4gQ01PIGFjY291bnQgYXJlCiAgICAvLy8gIGNvbXByb21pc2VkLgogICAgLy8vIEBub3RpY2UgVGhpcyBpcyBwdWJsaWMgcmF0aGVyIHRoYW4gZXh0ZXJuYWwgc28gaXQgY2FuIGJlIGNhbGxlZCBieQogICAgLy8vICBkZXJpdmVkIGNvbnRyYWN0cy4KICAgIGZ1bmN0aW9uIHVucGF1c2UoKSBwdWJsaWMgb25seUNFTyB3aGVuUGF1c2VkIHsKICAgICAgICAvLyBjYW4ndCB1bnBhdXNlIGlmIGNvbnRyYWN0IHdhcyB1cGdyYWRlZAogICAgICAgIHBhdXNlZCA9IGZhbHNlOwogICAgfQp9Cgpjb250cmFjdCBEZXRoZXJTZXR1cCBpcyBEZXRoZXJBY2Nlc3NDb250cm9sICB7CgogIGJvb2wgcHVibGljIHJ1bjEgPSBmYWxzZTsKICBib29sIHB1YmxpYyBydW4yID0gZmFsc2U7CiAgLy8gLU5lZWQgdG8gYmUgd2hpdGVsaXN0ZWQgdG8gYmUgYWJsZSB0byByZWdpc3RlciBpbiB0aGUgY29udHJhY3QgYXMgYSBzaG9wIG9yCiAgLy8gdGVsbGVyLCB0aGVyZSBpcyB0d28gbGV2ZWwgb2YgaWRlbnRpZmljYXRpb24uCiAgLy8gLVRoaXMgaWRlbnRpZmljYXRpb24gbWV0aG9kIGFyZSBub3cgY2VudHJhbGlzZWQgYW5kIHByb2Nlc3NlZCBieSBkZXRoZXIsIGJ1dAogIC8vIHdpbGwgYmUgZGVjZW50cmFsaXNlZCBzb29uCiAgQ2VydGlmaWVyIHB1YmxpYyBzbXNDZXJ0aWZpZXI7CiAgQ2VydGlmaWVyIHB1YmxpYyBreWNDZXJ0aWZpZXI7CiAgLy8gWm9uZSBuZWVkIHRvIGJlIG9wZW4gYnkgdGhlIENNTyBiZWZvcmUgYWNjZXB0aW5nIHJlZ2lzdHJhdGlvbgogIC8vIFRoZSBieXRlczIgcGFyYW1ldGVyIHdhaXQgZm9yIGEgY291bnRyeSBJRCAoZXg6IEZSICgweDQ2NTIgaW4gaGV4KSBmb3IgZnJhbmNlIGNmOlJFQURNRSkKICBtYXBwaW5nKGJ5dGVzMiA9PiBib29sKSBwdWJsaWMgb3BlbmVkQ291bnRyeVNob3A7CiAgbWFwcGluZyhieXRlczIgPT4gYm9vbCkgcHVibGljIG9wZW5lZENvdW50cnlUZWxsZXI7CiAgLy8gRm9yIHJlZ2lzdGVyaW5nIGluIGEgem9uZSB5b3UgbmVlZCB0byBzdGFrZSBEVEgKICAvLyBUaGUgcHJpY2UgY2FuIGRpZmZlciBieSBjb3VudHJ5CiAgLy8gVXRzIG5vdyBhIGZpeGVkIHByaWNlIGJ5IHRoZSBDTU8gYnV0IHRoZSBwcmljZSB3aWxsIGFkanVzdGVkIGF1dG9tYXRpY2FsbHkKICAvLyByZWdhcmRpbmcgZGlmZmVyZW50IGZhY3RvciBpbiB0aGUgZnV0dXIgc21hcnQgY29udHJhY3QKICBtYXBwaW5nKGJ5dGVzMiA9PiB1aW50KSBwdWJsaWMgbGljZW5jZVNob3A7CiAgbWFwcGluZyhieXRlczIgPT4gdWludCkgcHVibGljIGxpY2VuY2VUZWxsZXI7CgogIG1vZGlmaWVyIHRpZXIxKGFkZHJlc3MgX3VzZXIpIHsKICAgIHJlcXVpcmUoc21zQ2VydGlmaWVyLmNlcnRpZmllZChfdXNlcikpOwogICAgXzsKICB9CiAgbW9kaWZpZXIgdGllcjIoYWRkcmVzcyBfdXNlcikgewogICAgcmVxdWlyZShreWNDZXJ0aWZpZXIuY2VydGlmaWVkKF91c2VyKSk7CiAgICBfOwogIH0KICBtb2RpZmllciBpc1pvbmVTaG9wT3BlbihieXRlczIgX2NvdW50cnkpIHsKICAgIHJlcXVpcmUob3BlbmVkQ291bnRyeVNob3BbX2NvdW50cnldKTsKICAgIF87CiAgfQogIG1vZGlmaWVyIGlzWm9uZVRlbGxlck9wZW4oYnl0ZXMyIF9jb3VudHJ5KSB7CiAgICByZXF1aXJlKG9wZW5lZENvdW50cnlUZWxsZXJbX2NvdW50cnldKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBJTklUCiAgICovCiAgZnVuY3Rpb24gc2V0U21zQ2VydGlmaWVyIChhZGRyZXNzIF9zbXNDZXJ0aWZpZXIpIGV4dGVybmFsIG9ubHlDRU8gewogICAgcmVxdWlyZSghcnVuMSk7CiAgICBzbXNDZXJ0aWZpZXIgPSBDZXJ0aWZpZXIoX3Ntc0NlcnRpZmllcik7CiAgICBydW4xID0gdHJ1ZTsKICB9CiAgLyoqCiAgICogQ09SRSBGVU5DVElPTgogICAqLwogIGZ1bmN0aW9uIHNldEt5Y0NlcnRpZmllciAoYWRkcmVzcyBfa3ljQ2VydGlmaWVyKSBleHRlcm5hbCBvbmx5Q0VPIHsKICAgIHJlcXVpcmUoIXJ1bjIpOwogICAga3ljQ2VydGlmaWVyID0gQ2VydGlmaWVyKF9reWNDZXJ0aWZpZXIpOwogICAgcnVuMiA9IHRydWU7CiAgfQogIGZ1bmN0aW9uIHNldExpY2VuY2VTaG9wUHJpY2UoYnl0ZXMyIGNvdW50cnksIHVpbnQgcHJpY2UpIGV4dGVybmFsIG9ubHlDTU8gewogICAgbGljZW5jZVNob3BbY291bnRyeV0gPSBwcmljZTsKICB9CiAgZnVuY3Rpb24gc2V0TGljZW5jZVRlbGxlclByaWNlKGJ5dGVzMiBjb3VudHJ5LCB1aW50IHByaWNlKSBleHRlcm5hbCBvbmx5Q01PIHsKICAgIGxpY2VuY2VUZWxsZXJbY291bnRyeV0gPSBwcmljZTsKICB9CiAgZnVuY3Rpb24gb3BlblpvbmVTaG9wKGJ5dGVzMiBfY291bnRyeSkgZXh0ZXJuYWwgb25seUNNTyB7CiAgICBvcGVuZWRDb3VudHJ5U2hvcFtfY291bnRyeV0gPSB0cnVlOwogIH0KICBmdW5jdGlvbiBjbG9zZVpvbmVTaG9wKGJ5dGVzMiBfY291bnRyeSkgZXh0ZXJuYWwgb25seUNNTyB7CiAgICBvcGVuZWRDb3VudHJ5U2hvcFtfY291bnRyeV0gPSBmYWxzZTsKICB9CiAgZnVuY3Rpb24gb3BlblpvbmVUZWxsZXIoYnl0ZXMyIF9jb3VudHJ5KSBleHRlcm5hbCBvbmx5Q01PIHsKICAgIG9wZW5lZENvdW50cnlUZWxsZXJbX2NvdW50cnldID0gdHJ1ZTsKICB9CiAgZnVuY3Rpb24gY2xvc2Vab25lVGVsbGVyKGJ5dGVzMiBfY291bnRyeSkgZXh0ZXJuYWwgb25seUNNTyB7CiAgICBvcGVuZWRDb3VudHJ5VGVsbGVyW19jb3VudHJ5XSA9IGZhbHNlOwogIH0KfQoKCgpsaWJyYXJ5IEJ5dGVzTGliIHsKICAgIGZ1bmN0aW9uIGNvbmNhdChieXRlcyBtZW1vcnkgX3ByZUJ5dGVzLCBieXRlcyBtZW1vcnkgX3Bvc3RCeXRlcykgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChieXRlcykgewogICAgICAgIGJ5dGVzIG1lbW9yeSB0ZW1wQnl0ZXM7CgogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgLy8gR2V0IGEgbG9jYXRpb24gb2Ygc29tZSBmcmVlIG1lbW9yeSBhbmQgc3RvcmUgaXQgaW4gdGVtcEJ5dGVzIGFzCiAgICAgICAgICAgIC8vIFNvbGlkaXR5IGRvZXMgZm9yIG1lbW9yeSB2YXJpYWJsZXMuCiAgICAgICAgICAgIHRlbXBCeXRlcyA6PSBtbG9hZCgweDQwKQoKICAgICAgICAgICAgLy8gU3RvcmUgdGhlIGxlbmd0aCBvZiB0aGUgZmlyc3QgYnl0ZXMgYXJyYXkgYXQgdGhlIGJlZ2lubmluZyBvZgogICAgICAgICAgICAvLyB0aGUgbWVtb3J5IGZvciB0ZW1wQnl0ZXMuCiAgICAgICAgICAgIGxldCBsZW5ndGggOj0gbWxvYWQoX3ByZUJ5dGVzKQogICAgICAgICAgICBtc3RvcmUodGVtcEJ5dGVzLCBsZW5ndGgpCgogICAgICAgICAgICAvLyBNYWludGFpbiBhIG1lbW9yeSBjb3VudGVyIGZvciB0aGUgY3VycmVudCB3cml0ZSBsb2NhdGlvbiBpbiB0aGUKICAgICAgICAgICAgLy8gdGVtcCBieXRlcyBhcnJheSBieSBhZGRpbmcgdGhlIDMyIGJ5dGVzIGZvciB0aGUgYXJyYXkgbGVuZ3RoIHRvCiAgICAgICAgICAgIC8vIHRoZSBzdGFydGluZyBsb2NhdGlvbi4KICAgICAgICAgICAgbGV0IG1jIDo9IGFkZCh0ZW1wQnl0ZXMsIDB4MjApCiAgICAgICAgICAgIC8vIFN0b3AgY29weWluZyB3aGVuIHRoZSBtZW1vcnkgY291bnRlciByZWFjaGVzIHRoZSBsZW5ndGggb2YgdGhlCiAgICAgICAgICAgIC8vIGZpcnN0IGJ5dGVzIGFycmF5LgogICAgICAgICAgICBsZXQgZW5kIDo9IGFkZChtYywgbGVuZ3RoKQoKICAgICAgICAgICAgZm9yIHsKICAgICAgICAgICAgICAgIC8vIEluaXRpYWxpemUgYSBjb3B5IGNvdW50ZXIgdG8gdGhlIHN0YXJ0IG9mIHRoZSBfcHJlQnl0ZXMgZGF0YSwKICAgICAgICAgICAgICAgIC8vIDMyIGJ5dGVzIGludG8gaXRzIG1lbW9yeS4KICAgICAgICAgICAgICAgIGxldCBjYyA6PSBhZGQoX3ByZUJ5dGVzLCAweDIwKQogICAgICAgICAgICB9IGx0KG1jLCBlbmQpIHsKICAgICAgICAgICAgICAgIC8vIEluY3JlYXNlIGJvdGggY291bnRlcnMgYnkgMzIgYnl0ZXMgZWFjaCBpdGVyYXRpb24uCiAgICAgICAgICAgICAgICBtYyA6PSBhZGQobWMsIDB4MjApCiAgICAgICAgICAgICAgICBjYyA6PSBhZGQoY2MsIDB4MjApCiAgICAgICAgICAgIH0gewogICAgICAgICAgICAgICAgLy8gV3JpdGUgdGhlIF9wcmVCeXRlcyBkYXRhIGludG8gdGhlIHRlbXBCeXRlcyBtZW1vcnkgMzIgYnl0ZXMKICAgICAgICAgICAgICAgIC8vIGF0IGEgdGltZS4KICAgICAgICAgICAgICAgIG1zdG9yZShtYywgbWxvYWQoY2MpKQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBBZGQgdGhlIGxlbmd0aCBvZiBfcG9zdEJ5dGVzIHRvIHRoZSBjdXJyZW50IGxlbmd0aCBvZiB0ZW1wQnl0ZXMKICAgICAgICAgICAgLy8gYW5kIHN0b3JlIGl0IGFzIHRoZSBuZXcgbGVuZ3RoIGluIHRoZSBmaXJzdCAzMiBieXRlcyBvZiB0aGUKICAgICAgICAgICAgLy8gdGVtcEJ5dGVzIG1lbW9yeS4KICAgICAgICAgICAgbGVuZ3RoIDo9IG1sb2FkKF9wb3N0Qnl0ZXMpCiAgICAgICAgICAgIG1zdG9yZSh0ZW1wQnl0ZXMsIGFkZChsZW5ndGgsIG1sb2FkKHRlbXBCeXRlcykpKQoKICAgICAgICAgICAgLy8gTW92ZSB0aGUgbWVtb3J5IGNvdW50ZXIgYmFjayBmcm9tIGEgbXVsdGlwbGUgb2YgMHgyMCB0byB0aGUKICAgICAgICAgICAgLy8gYWN0dWFsIGVuZCBvZiB0aGUgX3ByZUJ5dGVzIGRhdGEuCiAgICAgICAgICAgIG1jIDo9IGVuZAogICAgICAgICAgICAvLyBTdG9wIGNvcHlpbmcgd2hlbiB0aGUgbWVtb3J5IGNvdW50ZXIgcmVhY2hlcyB0aGUgbmV3IGNvbWJpbmVkCiAgICAgICAgICAgIC8vIGxlbmd0aCBvZiB0aGUgYXJyYXlzLgogICAgICAgICAgICBlbmQgOj0gYWRkKG1jLCBsZW5ndGgpCgogICAgICAgICAgICBmb3IgewogICAgICAgICAgICAgICAgbGV0IGNjIDo9IGFkZChfcG9zdEJ5dGVzLCAweDIwKQogICAgICAgICAgICB9IGx0KG1jLCBlbmQpIHsKICAgICAgICAgICAgICAgIG1jIDo9IGFkZChtYywgMHgyMCkKICAgICAgICAgICAgICAgIGNjIDo9IGFkZChjYywgMHgyMCkKICAgICAgICAgICAgfSB7CiAgICAgICAgICAgICAgICBtc3RvcmUobWMsIG1sb2FkKGNjKSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSBmcmVlLW1lbW9yeSBwb2ludGVyIGJ5IHBhZGRpbmcgb3VyIGxhc3Qgd3JpdGUgbG9jYXRpb24KICAgICAgICAgICAgLy8gdG8gMzIgYnl0ZXM6IGFkZCAzMSBieXRlcyB0byB0aGUgZW5kIG9mIHRlbXBCeXRlcyB0byBtb3ZlIHRvIHRoZQogICAgICAgICAgICAvLyBuZXh0IDMyIGJ5dGUgYmxvY2ssIHRoZW4gcm91bmQgZG93biB0byB0aGUgbmVhcmVzdCBtdWx0aXBsZSBvZgogICAgICAgICAgICAvLyAzMi4gSWYgdGhlIHN1bSBvZiB0aGUgbGVuZ3RoIG9mIHRoZSB0d28gYXJyYXlzIGlzIHplcm8gdGhlbiBhZGQKICAgICAgICAgICAgLy8gb25lIGJlZm9yZSByb3VuZGluZyBkb3duIHRvIGxlYXZlIGEgYmxhbmsgMzIgYnl0ZXMgKHRoZSBsZW5ndGggYmxvY2sgd2l0aCAwKS4KICAgICAgICAgICAgbXN0b3JlKDB4NDAsIGFuZCgKICAgICAgICAgICAgICBhZGQoYWRkKGVuZCwgaXN6ZXJvKGFkZChsZW5ndGgsIG1sb2FkKF9wcmVCeXRlcykpKSksIDMxKSwKICAgICAgICAgICAgICBub3QoMzEpIC8vIFJvdW5kIGRvd24gdG8gdGhlIG5lYXJlc3QgMzIgYnl0ZXMuCiAgICAgICAgICAgICkpCiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdGVtcEJ5dGVzOwogICAgfQoKICAgIGZ1bmN0aW9uIGNvbmNhdFN0b3JhZ2UoYnl0ZXMgc3RvcmFnZSBfcHJlQnl0ZXMsIGJ5dGVzIG1lbW9yeSBfcG9zdEJ5dGVzKSBpbnRlcm5hbCB7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAvLyBSZWFkIHRoZSBmaXJzdCAzMiBieXRlcyBvZiBfcHJlQnl0ZXMgc3RvcmFnZSwgd2hpY2ggaXMgdGhlIGxlbmd0aAogICAgICAgICAgICAvLyBvZiB0aGUgYXJyYXkuIChXZSBkb24ndCBuZWVkIHRvIHVzZSB0aGUgb2Zmc2V0IGludG8gdGhlIHNsb3QKICAgICAgICAgICAgLy8gYmVjYXVzZSBhcnJheXMgdXNlIHRoZSBlbnRpcmUgc2xvdC4pCiAgICAgICAgICAgIGxldCBmc2xvdCA6PSBzbG9hZChfcHJlQnl0ZXNfc2xvdCkKICAgICAgICAgICAgLy8gQXJyYXlzIG9mIDMxIGJ5dGVzIG9yIGxlc3MgaGF2ZSBhbiBldmVuIHZhbHVlIGluIHRoZWlyIHNsb3QsCiAgICAgICAgICAgIC8vIHdoaWxlIGxvbmdlciBhcnJheXMgaGF2ZSBhbiBvZGQgdmFsdWUuIFRoZSBhY3R1YWwgbGVuZ3RoIGlzCiAgICAgICAgICAgIC8vIHRoZSBzbG90IGRpdmlkZWQgYnkgdHdvIGZvciBvZGQgdmFsdWVzLCBhbmQgdGhlIGxvd2VzdCBvcmRlcgogICAgICAgICAgICAvLyBieXRlIGRpdmlkZWQgYnkgdHdvIGZvciBldmVuIHZhbHVlcy4KICAgICAgICAgICAgLy8gSWYgdGhlIHNsb3QgaXMgZXZlbiwgYml0d2lzZSBhbmQgdGhlIHNsb3Qgd2l0aCAyNTUgYW5kIGRpdmlkZSBieQogICAgICAgICAgICAvLyB0d28gdG8gZ2V0IHRoZSBsZW5ndGguIElmIHRoZSBzbG90IGlzIG9kZCwgYml0d2lzZSBhbmQgdGhlIHNsb3QKICAgICAgICAgICAgLy8gd2l0aCAtMSBhbmQgZGl2aWRlIGJ5IHR3by4KICAgICAgICAgICAgbGV0IHNsZW5ndGggOj0gZGl2KGFuZChmc2xvdCwgc3ViKG11bCgweDEwMCwgaXN6ZXJvKGFuZChmc2xvdCwgMSkpKSwgMSkpLCAyKQogICAgICAgICAgICBsZXQgbWxlbmd0aCA6PSBtbG9hZChfcG9zdEJ5dGVzKQogICAgICAgICAgICBsZXQgbmV3bGVuZ3RoIDo9IGFkZChzbGVuZ3RoLCBtbGVuZ3RoKQogICAgICAgICAgICAvLyBzbGVuZ3RoIGNhbiBjb250YWluIGJvdGggdGhlIGxlbmd0aCBhbmQgY29udGVudHMgb2YgdGhlIGFycmF5CiAgICAgICAgICAgIC8vIGlmIGxlbmd0aCA8IDMyIGJ5dGVzIHNvIGxldCdzIHByZXBhcmUgZm9yIHRoYXQKICAgICAgICAgICAgLy8gdi4gaHR0cDovL3NvbGlkaXR5LnJlYWR0aGVkb2NzLmlvL2VuL2xhdGVzdC9taXNjZWxsYW5lb3VzLmh0bWwjbGF5b3V0LW9mLXN0YXRlLXZhcmlhYmxlcy1pbi1zdG9yYWdlCiAgICAgICAgICAgIHN3aXRjaCBhZGQobHQoc2xlbmd0aCwgMzIpLCBsdChuZXdsZW5ndGgsIDMyKSkKICAgICAgICAgICAgY2FzZSAyIHsKICAgICAgICAgICAgICAgIC8vIFNpbmNlIHRoZSBuZXcgYXJyYXkgc3RpbGwgZml0cyBpbiB0aGUgc2xvdCwgd2UganVzdCBuZWVkIHRvCiAgICAgICAgICAgICAgICAvLyB1cGRhdGUgdGhlIGNvbnRlbnRzIG9mIHRoZSBzbG90LgogICAgICAgICAgICAgICAgLy8gdWludDI1NihieXRlc19zdG9yYWdlKSA9IHVpbnQyNTYoYnl0ZXNfc3RvcmFnZSkgKyB1aW50MjU2KGJ5dGVzX21lbW9yeSkgKyBuZXdfbGVuZ3RoCiAgICAgICAgICAgICAgICBzc3RvcmUoCiAgICAgICAgICAgICAgICAgICAgX3ByZUJ5dGVzX3Nsb3QsCiAgICAgICAgICAgICAgICAgICAgLy8gYWxsIHRoZSBtb2RpZmljYXRpb25zIHRvIHRoZSBzbG90IGFyZSBpbnNpZGUgdGhpcwogICAgICAgICAgICAgICAgICAgIC8vIG5leHQgYmxvY2sKICAgICAgICAgICAgICAgICAgICBhZGQoCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdlIGNhbiBqdXN0IGFkZCB0byB0aGUgc2xvdCBjb250ZW50cyBiZWNhdXNlIHRoZQogICAgICAgICAgICAgICAgICAgICAgICAvLyBieXRlcyB3ZSB3YW50IHRvIGNoYW5nZSBhcmUgdGhlIExTQnMKICAgICAgICAgICAgICAgICAgICAgICAgZnNsb3QsCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG11bCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXYoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGxvYWQgdGhlIGJ5dGVzIGZyb20gbWVtb3J5CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1sb2FkKGFkZChfcG9zdEJ5dGVzLCAweDIwKSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHplcm8gYWxsIGJ5dGVzIHRvIHRoZSByaWdodAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHAoMHgxMDAsIHN1YigzMiwgbWxlbmd0aCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhbmQgbm93IHNoaWZ0IGxlZnQgdGhlIG51bWJlciBvZiBieXRlcyB0bwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGxlYXZlIHNwYWNlIGZvciB0aGUgbGVuZ3RoIGluIHRoZSBzbG90CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwKDB4MTAwLCBzdWIoMzIsIG5ld2xlbmd0aCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW5jcmVhc2UgbGVuZ3RoIGJ5IHRoZSBkb3VibGUgb2YgdGhlIG1lbW9yeQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYnl0ZXMgbGVuZ3RoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtdWwobWxlbmd0aCwgMikKICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlIDEgewogICAgICAgICAgICAgICAgLy8gVGhlIHN0b3JlZCB2YWx1ZSBmaXRzIGluIHRoZSBzbG90LCBidXQgdGhlIGNvbWJpbmVkIHZhbHVlCiAgICAgICAgICAgICAgICAvLyB3aWxsIGV4Y2VlZCBpdC4KICAgICAgICAgICAgICAgIC8vIGdldCB0aGUga2VjY2FrIGhhc2ggdG8gZ2V0IHRoZSBjb250ZW50cyBvZiB0aGUgYXJyYXkKICAgICAgICAgICAgICAgIG1zdG9yZSgweDAsIF9wcmVCeXRlc19zbG90KQogICAgICAgICAgICAgICAgbGV0IHNjIDo9IGFkZChrZWNjYWsyNTYoMHgwLCAweDIwKSwgZGl2KHNsZW5ndGgsIDMyKSkKCiAgICAgICAgICAgICAgICAvLyBzYXZlIG5ldyBsZW5ndGgKICAgICAgICAgICAgICAgIHNzdG9yZShfcHJlQnl0ZXNfc2xvdCwgYWRkKG11bChuZXdsZW5ndGgsIDIpLCAxKSkKCiAgICAgICAgICAgICAgICAvLyBUaGUgY29udGVudHMgb2YgdGhlIF9wb3N0Qnl0ZXMgYXJyYXkgc3RhcnQgMzIgYnl0ZXMgaW50bwogICAgICAgICAgICAgICAgLy8gdGhlIHN0cnVjdHVyZS4gT3VyIGZpcnN0IHJlYWQgc2hvdWxkIG9idGFpbiB0aGUgYHN1Ym1vZGAKICAgICAgICAgICAgICAgIC8vIGJ5dGVzIHRoYXQgY2FuIGZpdCBpbnRvIHRoZSB1bnVzZWQgc3BhY2UgaW4gdGhlIGxhc3Qgd29yZAogICAgICAgICAgICAgICAgLy8gb2YgdGhlIHN0b3JlZCBhcnJheS4gVG8gZ2V0IHRoaXMsIHdlIHJlYWQgMzIgYnl0ZXMgc3RhcnRpbmcKICAgICAgICAgICAgICAgIC8vIGZyb20gYHN1Ym1vZGAsIHNvIHRoZSBkYXRhIHdlIHJlYWQgb3ZlcmxhcHMgd2l0aCB0aGUgYXJyYXkKICAgICAgICAgICAgICAgIC8vIGNvbnRlbnRzIGJ5IGBzdWJtb2RgIGJ5dGVzLiBNYXNraW5nIHRoZSBsb3dlc3Qtb3JkZXIKICAgICAgICAgICAgICAgIC8vIGBzdWJtb2RgIGJ5dGVzIGFsbG93cyB1cyB0byBhZGQgdGhhdCB2YWx1ZSBkaXJlY3RseSB0byB0aGUKICAgICAgICAgICAgICAgIC8vIHN0b3JlZCB2YWx1ZS4KCiAgICAgICAgICAgICAgICBsZXQgc3VibW9kIDo9IHN1YigzMiwgc2xlbmd0aCkKICAgICAgICAgICAgICAgIGxldCBtYyA6PSBhZGQoX3Bvc3RCeXRlcywgc3VibW9kKQogICAgICAgICAgICAgICAgbGV0IGVuZCA6PSBhZGQoX3Bvc3RCeXRlcywgbWxlbmd0aCkKICAgICAgICAgICAgICAgIGxldCBtYXNrIDo9IHN1YihleHAoMHgxMDAsIHN1Ym1vZCksIDEpCgogICAgICAgICAgICAgICAgc3N0b3JlKAogICAgICAgICAgICAgICAgICAgIHNjLAogICAgICAgICAgICAgICAgICAgIGFkZCgKICAgICAgICAgICAgICAgICAgICAgICAgYW5kKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnNsb3QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAweGZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmMDAKICAgICAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICAgICAgYW5kKG1sb2FkKG1jKSwgbWFzaykKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICApCgogICAgICAgICAgICAgICAgZm9yIHsKICAgICAgICAgICAgICAgICAgICBtYyA6PSBhZGQobWMsIDB4MjApCiAgICAgICAgICAgICAgICAgICAgc2MgOj0gYWRkKHNjLCAxKQogICAgICAgICAgICAgICAgfSBsdChtYywgZW5kKSB7CiAgICAgICAgICAgICAgICAgICAgc2MgOj0gYWRkKHNjLCAxKQogICAgICAgICAgICAgICAgICAgIG1jIDo9IGFkZChtYywgMHgyMCkKICAgICAgICAgICAgICAgIH0gewogICAgICAgICAgICAgICAgICAgIHNzdG9yZShzYywgbWxvYWQobWMpKQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1hc2sgOj0gZXhwKDB4MTAwLCBzdWIobWMsIGVuZCkpCgogICAgICAgICAgICAgICAgc3N0b3JlKHNjLCBtdWwoZGl2KG1sb2FkKG1jKSwgbWFzayksIG1hc2spKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGRlZmF1bHQgewogICAgICAgICAgICAgICAgLy8gZ2V0IHRoZSBrZWNjYWsgaGFzaCB0byBnZXQgdGhlIGNvbnRlbnRzIG9mIHRoZSBhcnJheQogICAgICAgICAgICAgICAgbXN0b3JlKDB4MCwgX3ByZUJ5dGVzX3Nsb3QpCiAgICAgICAgICAgICAgICAvLyBTdGFydCBjb3B5aW5nIHRvIHRoZSBsYXN0IHVzZWQgd29yZCBvZiB0aGUgc3RvcmVkIGFycmF5LgogICAgICAgICAgICAgICAgbGV0IHNjIDo9IGFkZChrZWNjYWsyNTYoMHgwLCAweDIwKSwgZGl2KHNsZW5ndGgsIDMyKSkKCiAgICAgICAgICAgICAgICAvLyBzYXZlIG5ldyBsZW5ndGgKICAgICAgICAgICAgICAgIHNzdG9yZShfcHJlQnl0ZXNfc2xvdCwgYWRkKG11bChuZXdsZW5ndGgsIDIpLCAxKSkKCiAgICAgICAgICAgICAgICAvLyBDb3B5IG92ZXIgdGhlIGZpcnN0IGBzdWJtb2RgIGJ5dGVzIG9mIHRoZSBuZXcgZGF0YSBhcyBpbgogICAgICAgICAgICAgICAgLy8gY2FzZSAxIGFib3ZlLgogICAgICAgICAgICAgICAgbGV0IHNsZW5ndGhtb2QgOj0gbW9kKHNsZW5ndGgsIDMyKQogICAgICAgICAgICAgICAgbGV0IG1sZW5ndGhtb2QgOj0gbW9kKG1sZW5ndGgsIDMyKQogICAgICAgICAgICAgICAgbGV0IHN1Ym1vZCA6PSBzdWIoMzIsIHNsZW5ndGhtb2QpCiAgICAgICAgICAgICAgICBsZXQgbWMgOj0gYWRkKF9wb3N0Qnl0ZXMsIHN1Ym1vZCkKICAgICAgICAgICAgICAgIGxldCBlbmQgOj0gYWRkKF9wb3N0Qnl0ZXMsIG1sZW5ndGgpCiAgICAgICAgICAgICAgICBsZXQgbWFzayA6PSBzdWIoZXhwKDB4MTAwLCBzdWJtb2QpLCAxKQoKICAgICAgICAgICAgICAgIHNzdG9yZShzYywgYWRkKHNsb2FkKHNjKSwgYW5kKG1sb2FkKG1jKSwgbWFzaykpKQoKICAgICAgICAgICAgICAgIGZvciB7CiAgICAgICAgICAgICAgICAgICAgc2MgOj0gYWRkKHNjLCAxKQogICAgICAgICAgICAgICAgICAgIG1jIDo9IGFkZChtYywgMHgyMCkKICAgICAgICAgICAgICAgIH0gbHQobWMsIGVuZCkgewogICAgICAgICAgICAgICAgICAgIHNjIDo9IGFkZChzYywgMSkKICAgICAgICAgICAgICAgICAgICBtYyA6PSBhZGQobWMsIDB4MjApCiAgICAgICAgICAgICAgICB9IHsKICAgICAgICAgICAgICAgICAgICBzc3RvcmUoc2MsIG1sb2FkKG1jKSkKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtYXNrIDo9IGV4cCgweDEwMCwgc3ViKG1jLCBlbmQpKQoKICAgICAgICAgICAgICAgIHNzdG9yZShzYywgbXVsKGRpdihtbG9hZChtYyksIG1hc2spLCBtYXNrKSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBzbGljZShieXRlcyBfYnl0ZXMsIHVpbnQgX3N0YXJ0LCB1aW50IF9sZW5ndGgpIGludGVybmFsICBwdXJlIHJldHVybnMgKGJ5dGVzKSB7CiAgICAgICAgcmVxdWlyZShfYnl0ZXMubGVuZ3RoID49IChfc3RhcnQgKyBfbGVuZ3RoKSk7CgogICAgICAgIGJ5dGVzIG1lbW9yeSB0ZW1wQnl0ZXM7CgogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgc3dpdGNoIGlzemVybyhfbGVuZ3RoKQogICAgICAgICAgICBjYXNlIDAgewogICAgICAgICAgICAgICAgLy8gR2V0IGEgbG9jYXRpb24gb2Ygc29tZSBmcmVlIG1lbW9yeSBhbmQgc3RvcmUgaXQgaW4gdGVtcEJ5dGVzIGFzCiAgICAgICAgICAgICAgICAvLyBTb2xpZGl0eSBkb2VzIGZvciBtZW1vcnkgdmFyaWFibGVzLgogICAgICAgICAgICAgICAgdGVtcEJ5dGVzIDo9IG1sb2FkKDB4NDApCgogICAgICAgICAgICAgICAgLy8gVGhlIGZpcnN0IHdvcmQgb2YgdGhlIHNsaWNlIHJlc3VsdCBpcyBwb3RlbnRpYWxseSBhIHBhcnRpYWwKICAgICAgICAgICAgICAgIC8vIHdvcmQgcmVhZCBmcm9tIHRoZSBvcmlnaW5hbCBhcnJheS4gVG8gcmVhZCBpdCwgd2UgY2FsY3VsYXRlCiAgICAgICAgICAgICAgICAvLyB0aGUgbGVuZ3RoIG9mIHRoYXQgcGFydGlhbCB3b3JkIGFuZCBzdGFydCBjb3B5aW5nIHRoYXQgbWFueQogICAgICAgICAgICAgICAgLy8gYnl0ZXMgaW50byB0aGUgYXJyYXkuIFRoZSBmaXJzdCB3b3JkIHdlIGNvcHkgd2lsbCBzdGFydCB3aXRoCiAgICAgICAgICAgICAgICAvLyBkYXRhIHdlIGRvbid0IGNhcmUgYWJvdXQsIGJ1dCB0aGUgbGFzdCBgbGVuZ3RobW9kYCBieXRlcyB3aWxsCiAgICAgICAgICAgICAgICAvLyBsYW5kIGF0IHRoZSBiZWdpbm5pbmcgb2YgdGhlIGNvbnRlbnRzIG9mIHRoZSBuZXcgYXJyYXkuIFdoZW4KICAgICAgICAgICAgICAgIC8vIHdlJ3JlIGRvbmUgY29weWluZywgd2Ugb3ZlcndyaXRlIHRoZSBmdWxsIGZpcnN0IHdvcmQgd2l0aAogICAgICAgICAgICAgICAgLy8gdGhlIGFjdHVhbCBsZW5ndGggb2YgdGhlIHNsaWNlLgogICAgICAgICAgICAgICAgbGV0IGxlbmd0aG1vZCA6PSBhbmQoX2xlbmd0aCwgMzEpCgogICAgICAgICAgICAgICAgLy8gVGhlIG11bHRpcGxpY2F0aW9uIGluIHRoZSBuZXh0IGxpbmUgaXMgbmVjZXNzYXJ5CiAgICAgICAgICAgICAgICAvLyBiZWNhdXNlIHdoZW4gc2xpY2luZyBtdWx0aXBsZXMgb2YgMzIgYnl0ZXMgKGxlbmd0aG1vZCA9PSAwKQogICAgICAgICAgICAgICAgLy8gdGhlIGZvbGxvd2luZyBjb3B5IGxvb3Agd2FzIGNvcHlpbmcgdGhlIG9yaWdpbidzIGxlbmd0aAogICAgICAgICAgICAgICAgLy8gYW5kIHRoZW4gZW5kaW5nIHByZW1hdHVyZWx5IG5vdCBjb3B5aW5nIGV2ZXJ5dGhpbmcgaXQgc2hvdWxkLgogICAgICAgICAgICAgICAgbGV0IG1jIDo9IGFkZChhZGQodGVtcEJ5dGVzLCBsZW5ndGhtb2QpLCBtdWwoMHgyMCwgaXN6ZXJvKGxlbmd0aG1vZCkpKQogICAgICAgICAgICAgICAgbGV0IGVuZCA6PSBhZGQobWMsIF9sZW5ndGgpCgogICAgICAgICAgICAgICAgZm9yIHsKICAgICAgICAgICAgICAgICAgICAvLyBUaGUgbXVsdGlwbGljYXRpb24gaW4gdGhlIG5leHQgbGluZSBoYXMgdGhlIHNhbWUgZXhhY3QgcHVycG9zZQogICAgICAgICAgICAgICAgICAgIC8vIGFzIHRoZSBvbmUgYWJvdmUuCiAgICAgICAgICAgICAgICAgICAgbGV0IGNjIDo9IGFkZChhZGQoYWRkKF9ieXRlcywgbGVuZ3RobW9kKSwgbXVsKDB4MjAsIGlzemVybyhsZW5ndGhtb2QpKSksIF9zdGFydCkKICAgICAgICAgICAgICAgIH0gbHQobWMsIGVuZCkgewogICAgICAgICAgICAgICAgICAgIG1jIDo9IGFkZChtYywgMHgyMCkKICAgICAgICAgICAgICAgICAgICBjYyA6PSBhZGQoY2MsIDB4MjApCiAgICAgICAgICAgICAgICB9IHsKICAgICAgICAgICAgICAgICAgICBtc3RvcmUobWMsIG1sb2FkKGNjKSkKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtc3RvcmUodGVtcEJ5dGVzLCBfbGVuZ3RoKQoKICAgICAgICAgICAgICAgIC8vdXBkYXRlIGZyZWUtbWVtb3J5IHBvaW50ZXIKICAgICAgICAgICAgICAgIC8vYWxsb2NhdGluZyB0aGUgYXJyYXkgcGFkZGVkIHRvIDMyIGJ5dGVzIGxpa2UgdGhlIGNvbXBpbGVyIGRvZXMgbm93CiAgICAgICAgICAgICAgICBtc3RvcmUoMHg0MCwgYW5kKGFkZChtYywgMzEpLCBub3QoMzEpKSkKICAgICAgICAgICAgfQogICAgICAgICAgICAvL2lmIHdlIHdhbnQgYSB6ZXJvLWxlbmd0aCBzbGljZSBsZXQncyBqdXN0IHJldHVybiBhIHplcm8tbGVuZ3RoIGFycmF5CiAgICAgICAgICAgIGRlZmF1bHQgewogICAgICAgICAgICAgICAgdGVtcEJ5dGVzIDo9IG1sb2FkKDB4NDApCgogICAgICAgICAgICAgICAgbXN0b3JlKDB4NDAsIGFkZCh0ZW1wQnl0ZXMsIDB4MjApKQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdGVtcEJ5dGVzOwogICAgfQoKICAgIGZ1bmN0aW9uIHRvQWRkcmVzcyhieXRlcyBfYnl0ZXMsIHVpbnQgX3N0YXJ0KSBpbnRlcm5hbCAgcHVyZSByZXR1cm5zIChhZGRyZXNzKSB7CiAgICAgICAgcmVxdWlyZShfYnl0ZXMubGVuZ3RoID49IChfc3RhcnQgKyAyMCkpOwogICAgICAgIGFkZHJlc3MgdGVtcEFkZHJlc3M7CgogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgdGVtcEFkZHJlc3MgOj0gZGl2KG1sb2FkKGFkZChhZGQoX2J5dGVzLCAweDIwKSwgX3N0YXJ0KSksIDB4MTAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCkKICAgICAgICB9CgogICAgICAgIHJldHVybiB0ZW1wQWRkcmVzczsKICAgIH0KCiAgICBmdW5jdGlvbiB0b1VpbnQoYnl0ZXMgX2J5dGVzLCB1aW50IF9zdGFydCkgaW50ZXJuYWwgIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJlcXVpcmUoX2J5dGVzLmxlbmd0aCA+PSAoX3N0YXJ0ICsgMzIpKTsKICAgICAgICB1aW50MjU2IHRlbXBVaW50OwoKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHRlbXBVaW50IDo9IG1sb2FkKGFkZChhZGQoX2J5dGVzLCAweDIwKSwgX3N0YXJ0KSkKICAgICAgICB9CgogICAgICAgIHJldHVybiB0ZW1wVWludDsKICAgIH0KCiAgICBmdW5jdGlvbiB0b0J5dGVzMzIoYnl0ZXMgX2J5dGVzLCB1aW50IF9zdGFydCkgaW50ZXJuYWwgIHB1cmUgcmV0dXJucyAoYnl0ZXMzMikgewogICAgICAgIHJlcXVpcmUoX2J5dGVzLmxlbmd0aCA+PSAoX3N0YXJ0ICsgMzIpKTsKICAgICAgICBieXRlczMyIHRlbXBCeXRlczMyOwoKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHRlbXBCeXRlczMyIDo9IG1sb2FkKGFkZChhZGQoX2J5dGVzLCAweDIwKSwgX3N0YXJ0KSkKICAgICAgICB9CgogICAgICAgIHJldHVybiB0ZW1wQnl0ZXMzMjsKICAgIH0KCiAgICBmdW5jdGlvbiB0b0J5dGVzMTYoYnl0ZXMgX2J5dGVzLCB1aW50IF9zdGFydCkgaW50ZXJuYWwgIHB1cmUgcmV0dXJucyAoYnl0ZXMxNikgewogICAgICAgIHJlcXVpcmUoX2J5dGVzLmxlbmd0aCA+PSAoX3N0YXJ0ICsgMTYpKTsKICAgICAgICBieXRlczE2IHRlbXBCeXRlczE2OwoKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHRlbXBCeXRlczE2IDo9IG1sb2FkKGFkZChhZGQoX2J5dGVzLCAweDIwKSwgX3N0YXJ0KSkKICAgICAgICB9CgogICAgICAgIHJldHVybiB0ZW1wQnl0ZXMxNjsKICAgIH0KCiAgICBmdW5jdGlvbiB0b0J5dGVzMihieXRlcyBfYnl0ZXMsIHVpbnQgX3N0YXJ0KSBpbnRlcm5hbCAgcHVyZSByZXR1cm5zIChieXRlczIpIHsKICAgICAgICByZXF1aXJlKF9ieXRlcy5sZW5ndGggPj0gKF9zdGFydCArIDIpKTsKICAgICAgICBieXRlczIgdGVtcEJ5dGVzMjsKCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICB0ZW1wQnl0ZXMyIDo9IG1sb2FkKGFkZChhZGQoX2J5dGVzLCAweDIwKSwgX3N0YXJ0KSkKICAgICAgICB9CgogICAgICAgIHJldHVybiB0ZW1wQnl0ZXMyOwogICAgfQoKICAgIGZ1bmN0aW9uIHRvQnl0ZXM0KGJ5dGVzIF9ieXRlcywgdWludCBfc3RhcnQpIGludGVybmFsICBwdXJlIHJldHVybnMgKGJ5dGVzNCkgewogICAgICAgIHJlcXVpcmUoX2J5dGVzLmxlbmd0aCA+PSAoX3N0YXJ0ICsgNCkpOwogICAgICAgIGJ5dGVzNCB0ZW1wQnl0ZXM0OwoKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHRlbXBCeXRlczQgOj0gbWxvYWQoYWRkKGFkZChfYnl0ZXMsIDB4MjApLCBfc3RhcnQpKQogICAgICAgIH0KICAgICAgICByZXR1cm4gdGVtcEJ5dGVzNDsKICAgIH0KCiAgICBmdW5jdGlvbiB0b0J5dGVzMShieXRlcyBfYnl0ZXMsIHVpbnQgX3N0YXJ0KSBpbnRlcm5hbCAgcHVyZSByZXR1cm5zIChieXRlczEpIHsKICAgICAgICByZXF1aXJlKF9ieXRlcy5sZW5ndGggPj0gKF9zdGFydCArIDEpKTsKICAgICAgICBieXRlczEgdGVtcEJ5dGVzMTsKCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICB0ZW1wQnl0ZXMxIDo9IG1sb2FkKGFkZChhZGQoX2J5dGVzLCAweDIwKSwgX3N0YXJ0KSkKICAgICAgICB9CgogICAgICAgIHJldHVybiB0ZW1wQnl0ZXMxOwogICAgfQoKICAgIGZ1bmN0aW9uIGVxdWFsKGJ5dGVzIG1lbW9yeSBfcHJlQnl0ZXMsIGJ5dGVzIG1lbW9yeSBfcG9zdEJ5dGVzKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBib29sIHN1Y2Nlc3MgPSB0cnVlOwoKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIGxldCBsZW5ndGggOj0gbWxvYWQoX3ByZUJ5dGVzKQoKICAgICAgICAgICAgLy8gaWYgbGVuZ3RocyBkb24ndCBtYXRjaCB0aGUgYXJyYXlzIGFyZSBub3QgZXF1YWwKICAgICAgICAgICAgc3dpdGNoIGVxKGxlbmd0aCwgbWxvYWQoX3Bvc3RCeXRlcykpCiAgICAgICAgICAgIGNhc2UgMSB7CiAgICAgICAgICAgICAgICAvLyBjYiBpcyBhIGNpcmN1aXQgYnJlYWtlciBpbiB0aGUgZm9yIGxvb3Agc2luY2UgdGhlcmUncwogICAgICAgICAgICAgICAgLy8gIG5vIHNhaWQgZmVhdHVyZSBmb3IgaW5saW5lIGFzc2VtYmx5IGxvb3BzCiAgICAgICAgICAgICAgICAvLyBjYiA9IDEgLSBkb24ndCBicmVha2VyCiAgICAgICAgICAgICAgICAvLyBjYiA9IDAgLSBicmVhawogICAgICAgICAgICAgICAgbGV0IGNiIDo9IDEKCiAgICAgICAgICAgICAgICBsZXQgbWMgOj0gYWRkKF9wcmVCeXRlcywgMHgyMCkKICAgICAgICAgICAgICAgIGxldCBlbmQgOj0gYWRkKG1jLCBsZW5ndGgpCgogICAgICAgICAgICAgICAgZm9yIHsKICAgICAgICAgICAgICAgICAgICBsZXQgY2MgOj0gYWRkKF9wb3N0Qnl0ZXMsIDB4MjApCiAgICAgICAgICAgICAgICAvLyB0aGUgbmV4dCBsaW5lIGlzIHRoZSBsb29wIGNvbmRpdGlvbjoKICAgICAgICAgICAgICAgIC8vIHdoaWxlKHVpbnQobWMgPCBlbmQpICsgY2IgPT0gMikKICAgICAgICAgICAgICAgIH0gZXEoYWRkKGx0KG1jLCBlbmQpLCBjYiksIDIpIHsKICAgICAgICAgICAgICAgICAgICBtYyA6PSBhZGQobWMsIDB4MjApCiAgICAgICAgICAgICAgICAgICAgY2MgOj0gYWRkKGNjLCAweDIwKQogICAgICAgICAgICAgICAgfSB7CiAgICAgICAgICAgICAgICAgICAgLy8gaWYgYW55IG9mIHRoZXNlIGNoZWNrcyBmYWlscyB0aGVuIGFycmF5cyBhcmUgbm90IGVxdWFsCiAgICAgICAgICAgICAgICAgICAgaWYgaXN6ZXJvKGVxKG1sb2FkKG1jKSwgbWxvYWQoY2MpKSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyB1bnN1Y2Nlc3M6CiAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3MgOj0gMAogICAgICAgICAgICAgICAgICAgICAgICBjYiA6PSAwCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGRlZmF1bHQgewogICAgICAgICAgICAgICAgLy8gdW5zdWNjZXNzOgogICAgICAgICAgICAgICAgc3VjY2VzcyA6PSAwCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBzdWNjZXNzOwogICAgfQoKICAgIGZ1bmN0aW9uIGVxdWFsU3RvcmFnZShieXRlcyBzdG9yYWdlIF9wcmVCeXRlcywgYnl0ZXMgbWVtb3J5IF9wb3N0Qnl0ZXMpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGJvb2wgc3VjY2VzcyA9IHRydWU7CgogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgLy8gd2Uga25vdyBfcHJlQnl0ZXNfb2Zmc2V0IGlzIDAKICAgICAgICAgICAgbGV0IGZzbG90IDo9IHNsb2FkKF9wcmVCeXRlc19zbG90KQogICAgICAgICAgICAvLyBEZWNvZGUgdGhlIGxlbmd0aCBvZiB0aGUgc3RvcmVkIGFycmF5IGxpa2UgaW4gY29uY2F0U3RvcmFnZSgpLgogICAgICAgICAgICBsZXQgc2xlbmd0aCA6PSBkaXYoYW5kKGZzbG90LCBzdWIobXVsKDB4MTAwLCBpc3plcm8oYW5kKGZzbG90LCAxKSkpLCAxKSksIDIpCiAgICAgICAgICAgIGxldCBtbGVuZ3RoIDo9IG1sb2FkKF9wb3N0Qnl0ZXMpCgogICAgICAgICAgICAvLyBpZiBsZW5ndGhzIGRvbid0IG1hdGNoIHRoZSBhcnJheXMgYXJlIG5vdCBlcXVhbAogICAgICAgICAgICBzd2l0Y2ggZXEoc2xlbmd0aCwgbWxlbmd0aCkKICAgICAgICAgICAgY2FzZSAxIHsKICAgICAgICAgICAgICAgIC8vIHNsZW5ndGggY2FuIGNvbnRhaW4gYm90aCB0aGUgbGVuZ3RoIGFuZCBjb250ZW50cyBvZiB0aGUgYXJyYXkKICAgICAgICAgICAgICAgIC8vIGlmIGxlbmd0aCA8IDMyIGJ5dGVzIHNvIGxldCdzIHByZXBhcmUgZm9yIHRoYXQKICAgICAgICAgICAgICAgIC8vIHYuIGh0dHA6Ly9zb2xpZGl0eS5yZWFkdGhlZG9jcy5pby9lbi9sYXRlc3QvbWlzY2VsbGFuZW91cy5odG1sI2xheW91dC1vZi1zdGF0ZS12YXJpYWJsZXMtaW4tc3RvcmFnZQogICAgICAgICAgICAgICAgaWYgaXN6ZXJvKGlzemVybyhzbGVuZ3RoKSkgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCBsdChzbGVuZ3RoLCAzMikKICAgICAgICAgICAgICAgICAgICBjYXNlIDEgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBibGFuayB0aGUgbGFzdCBieXRlIHdoaWNoIGlzIHRoZSBsZW5ndGgKICAgICAgICAgICAgICAgICAgICAgICAgZnNsb3QgOj0gbXVsKGRpdihmc2xvdCwgMHgxMDApLCAweDEwMCkKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGlzemVybyhlcShmc2xvdCwgbWxvYWQoYWRkKF9wb3N0Qnl0ZXMsIDB4MjApKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHVuc3VjY2VzczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3MgOj0gMAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBjYiBpcyBhIGNpcmN1aXQgYnJlYWtlciBpbiB0aGUgZm9yIGxvb3Agc2luY2UgdGhlcmUncwogICAgICAgICAgICAgICAgICAgICAgICAvLyAgbm8gc2FpZCBmZWF0dXJlIGZvciBpbmxpbmUgYXNzZW1ibHkgbG9vcHMKICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2IgPSAxIC0gZG9uJ3QgYnJlYWtlcgogICAgICAgICAgICAgICAgICAgICAgICAvLyBjYiA9IDAgLSBicmVhawogICAgICAgICAgICAgICAgICAgICAgICBsZXQgY2IgOj0gMQoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gZ2V0IHRoZSBrZWNjYWsgaGFzaCB0byBnZXQgdGhlIGNvbnRlbnRzIG9mIHRoZSBhcnJheQogICAgICAgICAgICAgICAgICAgICAgICBtc3RvcmUoMHgwLCBfcHJlQnl0ZXNfc2xvdCkKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHNjIDo9IGtlY2NhazI1NigweDAsIDB4MjApCgogICAgICAgICAgICAgICAgICAgICAgICBsZXQgbWMgOj0gYWRkKF9wb3N0Qnl0ZXMsIDB4MjApCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBlbmQgOj0gYWRkKG1jLCBtbGVuZ3RoKQoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIG5leHQgbGluZSBpcyB0aGUgbG9vcCBjb25kaXRpb246CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdoaWxlKHVpbnQobWMgPCBlbmQpICsgY2IgPT0gMikKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHt9IGVxKGFkZChsdChtYywgZW5kKSwgY2IpLCAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYyA6PSBhZGQoc2MsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYyA6PSBhZGQobWMsIDB4MjApCiAgICAgICAgICAgICAgICAgICAgICAgIH0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaXN6ZXJvKGVxKHNsb2FkKHNjKSwgbWxvYWQobWMpKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHVuc3VjY2VzczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzIDo9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYiA6PSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGVmYXVsdCB7CiAgICAgICAgICAgICAgICAvLyB1bnN1Y2Nlc3M6CiAgICAgICAgICAgICAgICBzdWNjZXNzIDo9IDAKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHN1Y2Nlc3M7CiAgICB9Cn0KCgpjb250cmFjdCBEZXRoZXJDb3JlIGlzIERldGhlclNldHVwLCBFUkMyMjNSZWNlaXZpbmdDb250cmFjdCwgU2FmZU1hdGggewogIHVzaW5nIEJ5dGVzTGliIGZvciBieXRlczsKCiAgLyoqCiAgKiBFdmVudAogICovCiAgLy8gd2hlbiBhIFRlbGxlciBpcyByZWdpc3RlcmVkCiAgZXZlbnQgUmVnaXN0ZXJUZWxsZXIoYWRkcmVzcyBpbmRleGVkIHRlbGxlckFkZHJlc3MpOwogIC8vIHdoZW4gYSB0ZWxsZXIgaXMgZGVsZXRlZAogIGV2ZW50IERlbGV0ZVRlbGxlcihhZGRyZXNzIGluZGV4ZWQgdGVsbGVyQWRkcmVzcyk7CiAgLy8gd2hlbiB0ZWxsZXIgdXBkYXRlCiAgZXZlbnQgVXBkYXRlVGVsbGVyKGFkZHJlc3MgaW5kZXhlZCB0ZWxsZXJBZGRyZXNzKTsKICAvLyB3aGVuIGEgdGVsbGVyIHNlbmQgdG8gYSBidXllcgogIGV2ZW50IFNlbnQoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50IGFtb3VudCk7CiAgLy8gd2hlbiBhIHNob3AgcmVnaXN0ZXIKICBldmVudCBSZWdpc3RlclNob3AoYWRkcmVzcyBzaG9wQWRkcmVzcyk7CiAgLy8gd2hlbiBhIHNob3AgZGVsZXRlCiAgZXZlbnQgRGVsZXRlU2hvcChhZGRyZXNzIHNob3BBZGRyZXNzKTsKICAvLyB3aGVuIGEgbW9kZXJhdG9yIGRlbGV0ZSBhIHNob3AKICBldmVudCBEZWxldGVTaG9wTW9kZXJhdG9yKGFkZHJlc3MgaW5kZXhlZCBtb2RlcmF0b3IsIGFkZHJlc3Mgc2hvcEFkZHJlc3MpOwogIC8vIHdoZW4gYSBtb2RlcmF0b3IgZGVsZXRlIGEgdGVsbGVyCiAgZXZlbnQgRGVsZXRlVGVsbGVyTW9kZXJhdG9yKGFkZHJlc3MgaW5kZXhlZCBtb2RlcmF0b3IsIGFkZHJlc3MgdGVsbGVyQWRkcmVzcyk7CgogIC8qKgogICAqIE1vZGlmaWVyCiAgICovCiAgLy8gaWYgdGVsbGVyIGhhcyBzdGFrZWQgZW5vdWdoIGR0aCB0bwogIG1vZGlmaWVyIHRlbGxlckhhc1N0YWtlZCh1aW50IGFtb3VudCkgewogICAgcmVxdWlyZShiYW5rLmdldER0aFRlbGxlcihtc2cuc2VuZGVyKSA+PSBhbW91bnQpOwogICAgXzsKICB9CiAgLy8gaWYgc2hvcCBoYXMgc3Rha2VkIGVub3VnaCBkdGggdG8KICBtb2RpZmllciBzaG9wSGFzU3Rha2VkKHVpbnQgYW1vdW50KSB7CiAgICByZXF1aXJlKGJhbmsuZ2V0RHRoU2hvcChtc2cuc2VuZGVyKSA+PSBhbW91bnQpOwogICAgXzsKICB9CgogIC8qCiAgICogRXh0ZXJuYWwgY29udHJhY3QKICAgKi8KICAvLyBEVEggY29udHJhY3QKICBFUkMyMjNCYXNpYyBwdWJsaWMgZHRoOwogIC8vIGJhbmsgY29udHJhY3Qgd2hlcmUgYXJlIHN0b3JlZCBFVEggYW5kIERUSAogIERldGhlckJhbmsgcHVibGljIGJhbms7CgogIC8vIHRlbGxlciBzdHJ1Y3QKICBzdHJ1Y3QgVGVsbGVyIHsKICAgIGludDMyIGxhdDsgICAgICAgICAgICAvLyBMYXRpdHVkZQogICAgaW50MzIgbG5nOyAgICAgICAgICAgIC8vIExvbmdpdHVkZQogICAgYnl0ZXMyIGNvdW50cnlJZDsgICAgIC8vIGNvdW50cnlJRCAoaW4gaGV4YSksIElTTyBBTFBIQSAyIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0lTT18zMTY2LTFfYWxwaGEtMgogICAgYnl0ZXMxNiBwb3N0YWxDb2RlOyAgIC8vIHBvc3RhbENvZGUgaWYgcHJlc2VudCwgaW4gSGV4YSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9MaXN0X29mX3Bvc3RhbF9jb2RlcwoKICAgIGludDggY3VycmVuY3lJZDsgICAgICAvLyAxIC0gMTAwICwgY2YgUkVBRE1FCiAgICBieXRlczE2IG1lc3NlbmdlcjsgICAgLy8gdGVsZWdyYW1lIG5pY2tuYW1lCiAgICBpbnQ4IGF2YXRhcklkOyAgICAgICAgLy8gMSAtIDEwMCAsIHJlZ2FyZGluZyB0aGUgZnJvbnQtZW5kIGFwcCB5b3UgdXNlCiAgICBpbnQxNiByYXRlczsgICAgICAgICAgLy8gbWFyZ2luIG9mIHRlbGxlcnMgLCAtOTk5IC0gKzk5OTkgLCBjb3JyZXNwb25kaW5nIHRvIC05OSw5JSB4IDEwICAsIDk5OSw5JSB4IDEwCgogICAgdWludCB6b25lSW5kZXg7ICAgICAgIC8vIGluZGV4IG9mIHRoZSB6b25lIG1hcHBpbmcKICAgIHVpbnQgZ2VuZXJhbEluZGV4OyAgICAvLyBpbmRleCBvZiBnZW5lcmFsIG1hcHBpbmcKICAgIGJvb2wgb25saW5lOyAgICAgICAgICAvLyBzd2l0Y2ggb25saW5lL29mZmxpbmUsIGlmIHRoZSB0ZWxsZXJzIHdhbnQgdG8gYmUgaW5hY3RpdmUgd2l0aG91dCBkZWxldGluZyBoaXMgcG9pbnQKICB9CgogIC8qCiAgICogUmVwdXRhdGlvbiBmaWVsZCBWMC4xCiAgICogUmVwdXRhdGlvbiBpcyBiYXNlZCBvbiB2b2x1bWUgc2VsbCwgdm9sdW1lIGJ1eSwgYW5kIG51bWJlciBvZiB0cmFuc2FjdGlvbgogICAqLwogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSB2b2x1bWVCdXk7CiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIHZvbHVtZVNlbGw7CiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIG5iVHJhZGU7CgogIC8vIGdlbmVyYWwgbWFwcGluZyBvZiB0ZWxsZXIKICBtYXBwaW5nKGFkZHJlc3MgPT4gVGVsbGVyKSB0ZWxsZXI7CiAgLy8gbWFwcG9pbmcgb2YgdGVsbGVyIGJ5IENPVU5UUllDT0RFID0+IFBPU1RBTENPREUKICBtYXBwaW5nKGJ5dGVzMiA9PiBtYXBwaW5nKGJ5dGVzMTYgPT4gYWRkcmVzc1tdKSkgdGVsbGVySW5ab25lOwogIC8vIHRlbGxlciBhcnJheSBjdXJyZW50bHkgcmVnaXN0ZXJlZAogIGFkZHJlc3NbXSBwdWJsaWMgdGVsbGVySW5kZXg7IC8vIHVub3JkZXJlZCBsaXN0IG9mIHRlbGxlciByZWdpc3RlciBvbiBpdAogIGJvb2wgaXNTdGFydGVkID0gZmFsc2U7CiAgLy8gc2hvcCBzdHJ1Y3QKICBzdHJ1Y3QgU2hvcCB7CiAgICBpbnQzMiBsYXQ7ICAgICAgICAgICAgLy8gbGF0aXR1ZGUKICAgIGludDMyIGxuZzsgICAgICAgICAgICAvLyBsb25naXR1ZGUKICAgIGJ5dGVzMiBjb3VudHJ5SWQ7ICAgICAvLyBjb3VudHJ5SUQgKGluIGhleGEgY2hhciksIElTTyBBTFBIQSAyIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0lTT18zMTY2LTFfYWxwaGEtMgogICAgYnl0ZXMxNiBwb3N0YWxDb2RlOyAgIC8vIHBvc3RhbENvZGUgaWYgcHJlc2VudCAoaW4gaGV4YSBjaGFyKSwgaW4gSGV4YSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9MaXN0X29mX3Bvc3RhbF9jb2RlcwogICAgYnl0ZXMxNiBjYXQ7ICAgICAgICAgIC8vIENhdGVnb3J5IG9mIHRoZSBzaG9wIChpbiBoZXggY2hhciksIHdpbGwgYmUgdXNlZCBsYXRlciBmb3Igc2VhcmNoIGVuZ2luZSBhbmQgYXVjdGlvbiBieSB6b25lCiAgICBieXRlczE2IG5hbWU7ICAgICAgICAgLy8gbmFtZSBvZiB0aGUgc2hvcCAoaW4gaGV4IGNoYXIpCiAgICBieXRlczMyIGRlc2NyaXB0aW9uOyAgLy8gZGVzY3JpcHRpb24gb2YgdGhlIHNob3AKICAgIGJ5dGVzMTYgb3BlbmluZzsgICAgICAvLyBvcGVuaW5nIGhvdXJzLCBjZiBSRUFETUUgZm9yIHRoZSBmb3JtYXQKCiAgICB1aW50IHpvbmVJbmRleDsgICAgICAgLy8gaW5kZXggb2YgdGhlIHpvbmUgbWFwcGluZwogICAgdWludCBnZW5lcmFsSW5kZXg7ICAgIC8vIGluZGV4IG9mIGdlbmVyYWwgbWFwcGluZwogICAgYm9vbCBkZXRoZXJTaG9wOyAgICAgIC8vIGJvb2wgaWYgc2hvcCBpcyByZWdpc3RlcmVkIGJ5IGRldGhlciBhcyBidXNpbmVzcyBwYXJ0bmVyc2hpcCAoc3RpbGwgcmVxdWlyZWQgRFRIKQogIH0KCiAgLy8gZ2VuZXJhbCBtYXBwaW5nIG9mIHNob3AKICBtYXBwaW5nKGFkZHJlc3MgPT4gU2hvcCkgc2hvcDsKICAvLyBtYXBwaW5nIG9mIHRlbGxlciBieSBDT1VOVFJZQ09ERSA9PiBQT1NUQUxDT0RFCiAgbWFwcGluZyhieXRlczIgPT4gbWFwcGluZyhieXRlczE2ID0+IGFkZHJlc3NbXSkpIHNob3BJblpvbmU7CiAgLy8gc2hvcCBhcnJheSBjdXJyZW50bHkgcmVnaXN0ZXJlZAogIGFkZHJlc3NbXSBwdWJsaWMgc2hvcEluZGV4OyAvLyB1bm9yZGVyZWQgbGlzdCBvZiBzaG9wIHJlZ2lzdGVyIG9uIGl0CgogIC8qCiAgICogSW5zdGFuY2lhdGlvbgogICAqLwogIGZ1bmN0aW9uIERldGhlckNvcmUoKSB7CiAgIGNlb0FkZHJlc3MgPSBtc2cuc2VuZGVyOwogIH0KICBmdW5jdGlvbiBpbml0Q29udHJhY3QgKGFkZHJlc3MgX2R0aCwgYWRkcmVzcyBfYmFuaykgZXh0ZXJuYWwgb25seUNFTyB7CiAgICByZXF1aXJlKCFpc1N0YXJ0ZWQpOwogICAgZHRoID0gRVJDMjIzQmFzaWMoX2R0aCk7CiAgICBiYW5rID0gRGV0aGVyQmFuayhfYmFuayk7CiAgICBpc1N0YXJ0ZWQgPSB0cnVlOwogIH0KCiAgLyoqCiAgICogQ29yZSBmb25jdGlvbgogICAqLwoKICAvKioKICAgKiBAZGV2IFN0YW5kYXJkIEVSQzIyMyBmdW5jdGlvbiB0aGF0IHdpbGwgaGFuZGxlIGluY29taW5nIHRva2VuIHRyYW5zZmVycy4KICAgKiBUaGlzIGlzIHRoZSBtYWluIGZ1bmN0aW9uIHRvIHJlZ2lzdGVyIFNIT1Agb3IgVEVMTEVSLCBpdHMgY2FsbGluZyB3aGVuIHlvdQogICAqIHNlbmQgdG9rZW4gdG8gdGhlIERUSCBjb250cmFjdCBhbmQgYnkgcGFzc2luZyBkYXRhIGFzIGJ5dGVzIG9uIHRoZSB0aGlyZAogICAqIHBhcmFtZXRlci4KICAgKiBJdHMgbm90IHN1cHBvc2VkIHRvIGJlIHVzZSBvbiBpdHMgb3duIGJ1dCB3aWxsIG9ubHkgaGFuZGxlIGluY29taW5nIERUSAogICAqIHRyYW5zYWN0aW9uLgogICAqIFRoZSBfZGF0YSB3aWxsIHdhaXQgZm9yCiAgICogWzFzdCBieXRlXSAxICgweDMxKSBmb3Igc2hvcCBPUiAyICgweDMyKSBmb3IgdGVsbGVyCiAgICogRk9SIFNIT1AgQU5EIFRFTExFUjoKICAgKiAyc2QgdG8gNXRoIGJ5dGVzIGxhdAogICAqIDZ0aCB0byA5dGggYnl0ZXMgbG5nCiAgICogLi4uCiAgICogTW9kaWZpZXIgdGllcjE6IENoZWNrIGlmIGFkZHJlc3MgaXMgd2hpdGVsaXN0ZWQgd2l0aCB0aGUgc21zIHZlcmlmaWNhdGlvbgogICAqLwogIGZ1bmN0aW9uIHRva2VuRmFsbGJhY2soYWRkcmVzcyBfZnJvbSwgdWludCBfdmFsdWUsIGJ5dGVzIF9kYXRhKSB3aGVuTm90UGF1c2VkIHRpZXIxKF9mcm9tICkgewogICAgLy8gcmVxdWlyZSB0aGFuIHRoZSB0b2tlbiBmYWxsYmFjayBpcyB0cmlnZ2VyZWQgZnJvbSB0aGUgZHRoIHRva2VuIGNvbnRyYWN0CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhkdGgpKTsKICAgIC8vIGNoZWNrIGZpcnN0IGJ5dGUgdG8ga25vdyBpZiBpdHMgc2hvcCBvciB0ZWxsZXIgcmVnaXN0cmF0aW9uCiAgICAvLyAxIC8gMHgzMSA9IHNob3AgLy8gMiAvIDB4MzIgPSB0ZWxsZXIKICAgIGJ5dGVzMSBfZnVuYyA9IF9kYXRhLnRvQnl0ZXMxKDApOwogICAgaW50MzIgcG9zTGF0ID0gX2RhdGEudG9CeXRlczEoMSkgPT0gYnl0ZXMxKDB4MDEpID8gaW50MzIoX2RhdGEudG9CeXRlczQoMikpICogLTEgOiBpbnQzMihfZGF0YS50b0J5dGVzNCgyKSk7CiAgICBpbnQzMiBwb3NMbmcgPSBfZGF0YS50b0J5dGVzMSg2KSA9PSBieXRlczEoMHgwMSkgPyBpbnQzMihfZGF0YS50b0J5dGVzNCg3KSkgKiAtMSA6IGludDMyKF9kYXRhLnRvQnl0ZXM0KDcpKTsKICAgIGlmIChfZnVuYyA9PSBieXRlczEoMHgzMSkpIHsgLy8gc2hvcCByZWdpc3RyYXRpb24KICAgICAgLy8gcmVxdWlyZSBzdGFrZWQgZ3JlYXRlciB0aGFuIGxpY2VuY2UgcHJpY2UKICAgICAgcmVxdWlyZShfdmFsdWUgPj0gbGljZW5jZVNob3BbX2RhdGEudG9CeXRlczIoMTEpXSk7CiAgICAgIC8vIHJlcXVpcmUgaXRzIG5vdCBhbHJlYWR5IHNob3AKICAgICAgcmVxdWlyZSghaXNTaG9wKF9mcm9tKSk7CiAgICAgIC8vIHJlcXVpcmUgem9uZSBpcyBvcGVuCiAgICAgIHJlcXVpcmUob3BlbmVkQ291bnRyeVNob3BbX2RhdGEudG9CeXRlczIoMTEpXSk7CgogICAgICBzaG9wW19mcm9tXS5sYXQgPSBwb3NMYXQ7CiAgICAgIHNob3BbX2Zyb21dLmxuZyA9IHBvc0xuZzsKICAgICAgc2hvcFtfZnJvbV0uY291bnRyeUlkID0gX2RhdGEudG9CeXRlczIoMTEpOwogICAgICBzaG9wW19mcm9tXS5wb3N0YWxDb2RlID0gX2RhdGEudG9CeXRlczE2KDEzKTsKICAgICAgc2hvcFtfZnJvbV0uY2F0ID0gX2RhdGEudG9CeXRlczE2KDI5KTsKICAgICAgc2hvcFtfZnJvbV0ubmFtZSA9IF9kYXRhLnRvQnl0ZXMxNig0NSk7CiAgICAgIHNob3BbX2Zyb21dLmRlc2NyaXB0aW9uID0gX2RhdGEudG9CeXRlczMyKDYxKTsKICAgICAgc2hvcFtfZnJvbV0ub3BlbmluZyA9IF9kYXRhLnRvQnl0ZXMxNig5Myk7CiAgICAgIHNob3BbX2Zyb21dLmdlbmVyYWxJbmRleCA9IHNob3BJbmRleC5wdXNoKF9mcm9tKSAtIDE7CiAgICAgIHNob3BbX2Zyb21dLnpvbmVJbmRleCA9IHNob3BJblpvbmVbX2RhdGEudG9CeXRlczIoMTEpXVtfZGF0YS50b0J5dGVzMTYoMTMpXS5wdXNoKF9mcm9tKSAtIDE7CiAgICAgIGVtaXQgUmVnaXN0ZXJTaG9wKF9mcm9tKTsKICAgICAgYmFuay5hZGRUb2tlblNob3AoX2Zyb20sX3ZhbHVlKTsKICAgICAgZHRoLnRyYW5zZmVyKGFkZHJlc3MoYmFuayksIF92YWx1ZSk7CiAgICB9IGVsc2UgaWYgKF9mdW5jID09IGJ5dGVzMSgweDMyKSkgeyAvLyB0ZWxsZXIgcmVnaXN0cmF0aW9uCiAgICAgIC8vIHJlcXVpcmUgc3Rha2VkIGdyZWF0ZXIgdGhhbiBsaWNlbmNlIHByaWNlCiAgICAgIHJlcXVpcmUoX3ZhbHVlID49IGxpY2VuY2VUZWxsZXJbX2RhdGEudG9CeXRlczIoMTEpXSk7CiAgICAgIC8vIHJlcXVpcmUgaXMgbm90IGFscmVhZHkgYSB0ZWxsZXIKICAgICAgcmVxdWlyZSghaXNUZWxsZXIoX2Zyb20pKTsKICAgICAgLy8gcmVxdWlyZSB6b25lIGlzIG9wZW4KICAgICAgcmVxdWlyZShvcGVuZWRDb3VudHJ5VGVsbGVyW19kYXRhLnRvQnl0ZXMyKDExKV0pOwoKICAgICAgdGVsbGVyW19mcm9tXS5sYXQgPSBwb3NMYXQ7CiAgICAgIHRlbGxlcltfZnJvbV0ubG5nID0gcG9zTG5nOwogICAgICB0ZWxsZXJbX2Zyb21dLmNvdW50cnlJZCA9IF9kYXRhLnRvQnl0ZXMyKDExKTsKICAgICAgdGVsbGVyW19mcm9tXS5wb3N0YWxDb2RlID0gX2RhdGEudG9CeXRlczE2KDEzKTsKICAgICAgdGVsbGVyW19mcm9tXS5hdmF0YXJJZCA9IGludDgoX2RhdGEudG9CeXRlczEoMjkpKTsKICAgICAgdGVsbGVyW19mcm9tXS5jdXJyZW5jeUlkID0gaW50OChfZGF0YS50b0J5dGVzMSgzMCkpOwogICAgICB0ZWxsZXJbX2Zyb21dLm1lc3NlbmdlciA9IF9kYXRhLnRvQnl0ZXMxNigzMSk7CiAgICAgIHRlbGxlcltfZnJvbV0ucmF0ZXMgPSBpbnQxNihfZGF0YS50b0J5dGVzMig0NykpOwogICAgICB0ZWxsZXJbX2Zyb21dLmdlbmVyYWxJbmRleCA9IHRlbGxlckluZGV4LnB1c2goX2Zyb20pIC0gMTsKICAgICAgdGVsbGVyW19mcm9tXS56b25lSW5kZXggPSB0ZWxsZXJJblpvbmVbX2RhdGEudG9CeXRlczIoMTEpXVtfZGF0YS50b0J5dGVzMTYoMTMpXS5wdXNoKF9mcm9tKSAtIDE7CiAgICAgIHRlbGxlcltfZnJvbV0ub25saW5lID0gdHJ1ZTsKICAgICAgZW1pdCBSZWdpc3RlclRlbGxlcihfZnJvbSk7CiAgICAgIGJhbmsuYWRkVG9rZW5UZWxsZXIoX2Zyb20sIF92YWx1ZSk7CiAgICAgIGR0aC50cmFuc2ZlcihhZGRyZXNzKGJhbmspLCBfdmFsdWUpOwogICAgfSBlbHNlIGlmIChfZnVuYyA9PSBieXRlczEoMHgzMykpIHsgIC8vIHNob3AgYnVsayByZWdpc3RyYXRpb24KICAgICAgLy8gV2UgbmVlZCB0byBoYXZlIHRoZSBwb3NzaWJpbGl0eSB0byByZWdpc3RlciBpbiBidWxrIHNvbWUgc2hvcAogICAgICAvLyBGb3IgYmlnIHJldGFpbGVyIGNvbXBhbnkgd2lsbGluZyB0byBiZSBsaXN0ZWQgb24gZGV0aGVyLCB3ZSBuZWVkIHRvIGhhdmUgYSB3YXkgdG8gYWRkCiAgICAgIC8vIGFsbCB0aGVpciBzaG9wIGZyb20gb25lIGFkZHJlc3MKICAgICAgLy8gVGhpcyBmdW5jdGlvbm5hbGl0eSB3aWxsIGJlY29tZSBhdmFpbGFibGUgZm9yIGFueW9uZSB3aWxsaW5nIHRvIGxpc3QgbXVsdGlwbGUgc2hvcAogICAgICAvLyBpbiB0aGUgZnV0dXJlcyBjb250cmFjdAoKICAgICAgLy8gT25seSB0aGUgQ1NPIHNob3VsZCBiZSBhYmxlIHRvIHJlZ2lzdGVyIHNob3AgaW4gYnVsawogICAgICByZXF1aXJlKF9mcm9tID09IGNzb0FkZHJlc3MpOwogICAgICAvLyBFYWNoIHNob3Agc3RpbGwgbmVlZCBoaXMgb3duIHN0YWtpbmcKICAgICAgcmVxdWlyZShfdmFsdWUgPj0gbGljZW5jZVNob3BbX2RhdGEudG9CeXRlczIoMTEpXSk7CiAgICAgIC8vIHJlcXVpcmUgdGhlIGFkZHJlc3NlcyBub3QgYWxyZWFkeSByZWdpc3RlcmVkCiAgICAgIHJlcXVpcmUoIWlzU2hvcChhZGRyZXNzKF9kYXRhLnRvQWRkcmVzcygxMDkpKSkpOwogICAgICAvLyByZXF1aXJlIHpvbmUgaXMgb3BlbgogICAgICByZXF1aXJlKG9wZW5lZENvdW50cnlTaG9wW19kYXRhLnRvQnl0ZXMyKDExKV0pOwogICAgICBhZGRyZXNzIG5ld1Nob3BBZGRyZXNzID0gX2RhdGEudG9BZGRyZXNzKDEwOSk7CiAgICAgIHNob3BbbmV3U2hvcEFkZHJlc3NdLmxhdCA9IHBvc0xhdDsKICAgICAgc2hvcFtuZXdTaG9wQWRkcmVzc10ubG5nID0gcG9zTG5nOwogICAgICBzaG9wW25ld1Nob3BBZGRyZXNzXS5jb3VudHJ5SWQgPSBfZGF0YS50b0J5dGVzMigxMSk7CiAgICAgIHNob3BbbmV3U2hvcEFkZHJlc3NdLnBvc3RhbENvZGUgPSBfZGF0YS50b0J5dGVzMTYoMTMpOwogICAgICBzaG9wW25ld1Nob3BBZGRyZXNzXS5jYXQgPSBfZGF0YS50b0J5dGVzMTYoMjkpOwogICAgICBzaG9wW25ld1Nob3BBZGRyZXNzXS5uYW1lID0gX2RhdGEudG9CeXRlczE2KDQ1KTsKICAgICAgc2hvcFtuZXdTaG9wQWRkcmVzc10uZGVzY3JpcHRpb24gPSBfZGF0YS50b0J5dGVzMzIoNjEpOwogICAgICBzaG9wW25ld1Nob3BBZGRyZXNzXS5vcGVuaW5nID0gX2RhdGEudG9CeXRlczE2KDkzKTsKICAgICAgc2hvcFtuZXdTaG9wQWRkcmVzc10uZ2VuZXJhbEluZGV4ID0gc2hvcEluZGV4LnB1c2gobmV3U2hvcEFkZHJlc3MpIC0gMTsKICAgICAgc2hvcFtuZXdTaG9wQWRkcmVzc10uem9uZUluZGV4ID0gc2hvcEluWm9uZVtfZGF0YS50b0J5dGVzMigxMSldW19kYXRhLnRvQnl0ZXMxNigxMyldLnB1c2gobmV3U2hvcEFkZHJlc3MpIC0gMTsKICAgICAgc2hvcFtuZXdTaG9wQWRkcmVzc10uZGV0aGVyU2hvcCA9IHRydWU7CiAgICAgIGVtaXQgUmVnaXN0ZXJTaG9wKG5ld1Nob3BBZGRyZXNzKTsKICAgICAgYmFuay5hZGRUb2tlblNob3AobmV3U2hvcEFkZHJlc3MsIF92YWx1ZSk7CiAgICAgIGR0aC50cmFuc2ZlcihhZGRyZXNzKGJhbmspLCBfdmFsdWUpOwogICAgfQogIH0KCiAgLyoqCiAgICogYSB0ZWxsZXIgY2FuIHVwZGF0ZSBoaXMgcHJvZmlsZQogICAqIElmIGEgdGVsbGVyIHdhbnQgdG8gY2hhbmdlIGhpcyBsb2NhdGlvbiwgaGUgd291bGQgbmVlZCB0byBkZWxldGUgYW5kIHJlY3JlYXRlCiAgICogYSBuZXcgcG9pbnQKICAgKi8KICBmdW5jdGlvbiB1cGRhdGVUZWxsZXIoCiAgICBpbnQ4IGN1cnJlbmN5SWQsCiAgICBieXRlczE2IG1lc3NlbmdlciwKICAgIGludDggYXZhdGFySWQsCiAgICBpbnQxNiByYXRlcywKICAgIGJvb2wgb25saW5lCiAgICkgcHVibGljIHBheWFibGUgewogICAgcmVxdWlyZShpc1RlbGxlcihtc2cuc2VuZGVyKSk7CiAgICBpZiAoY3VycmVuY3lJZCAhPSB0ZWxsZXJbbXNnLnNlbmRlcl0uY3VycmVuY3lJZCkKICAgIHRlbGxlclttc2cuc2VuZGVyXS5jdXJyZW5jeUlkID0gY3VycmVuY3lJZDsKICAgIGlmICh0ZWxsZXJbbXNnLnNlbmRlcl0ubWVzc2VuZ2VyICE9IG1lc3NlbmdlcikKICAgICB0ZWxsZXJbbXNnLnNlbmRlcl0ubWVzc2VuZ2VyID0gbWVzc2VuZ2VyOwogICAgaWYgKHRlbGxlclttc2cuc2VuZGVyXS5hdmF0YXJJZCAhPSBhdmF0YXJJZCkKICAgICB0ZWxsZXJbbXNnLnNlbmRlcl0uYXZhdGFySWQgPSBhdmF0YXJJZDsKICAgIGlmICh0ZWxsZXJbbXNnLnNlbmRlcl0ucmF0ZXMgIT0gcmF0ZXMpCiAgICAgdGVsbGVyW21zZy5zZW5kZXJdLnJhdGVzID0gcmF0ZXM7CiAgICBpZiAodGVsbGVyW21zZy5zZW5kZXJdLm9ubGluZSAhPSBvbmxpbmUpCiAgICAgIHRlbGxlclttc2cuc2VuZGVyXS5vbmxpbmUgPSBvbmxpbmU7CiAgICBpZiAobXNnLnZhbHVlID4gMCkgewogICAgICBiYW5rLmFkZEV0aFRlbGxlci52YWx1ZShtc2cudmFsdWUpKG1zZy5zZW5kZXIsIG1zZy52YWx1ZSk7CiAgICB9CiAgICBlbWl0IFVwZGF0ZVRlbGxlcihtc2cuc2VuZGVyKTsKICB9CgogIC8qKgogICAqIFNlbGxFdGgKICAgKiBAcGFyYW0gX3RvIC0+IHRoZSBhZGRyZXNzIGZvciB0aGUgcmVjZWl2ZXIKICAgKiBAcGFyYW0gX2Ftb3VudCAtPiB0aGUgYW1vdW50IHRvIHNlbmQKICAgKi8KICBmdW5jdGlvbiBzZWxsRXRoKGFkZHJlc3MgX3RvLCB1aW50IF9hbW91bnQpIHdoZW5Ob3RQYXVzZWQgZXh0ZXJuYWwgewogICAgcmVxdWlyZShpc1RlbGxlcihtc2cuc2VuZGVyKSk7CiAgICByZXF1aXJlKF90byAhPSBtc2cuc2VuZGVyKTsKICAgIC8vIHNlbmQgZXRoIHRvIHRoZSByZWNlaXZlciBmcm9tIHRoZSBiYW5rIGNvbnRyYWN0CiAgICBiYW5rLndpdGhkcmF3RXRoKG1zZy5zZW5kZXIsIF90bywgX2Ftb3VudCk7CiAgICAvLyBpbmNyZWFzZSByZXB1dCBmb3IgdGhlIGJ1eWVyIGFuZCB0aGUgc2VsbGVyIE9ubHkgaWYgdGhlIGJ1eWVyIGlzIGFsc28gd2hpdGVsaXN0ZWQsCiAgICAvLyBJdCdzIGEgd2F5IHRvIGluY2VudGl2ZSB1c2VyIHRvIHRyYWRlIG9uIHRoZSBzeXN0ZW0KICAgIGlmIChzbXNDZXJ0aWZpZXIuY2VydGlmaWVkKF90bykpIHsKICAgICAgdm9sdW1lQnV5W190b10gPSBTYWZlTWF0aC5hZGQodm9sdW1lQnV5W190b10sIF9hbW91bnQpOwogICAgICB2b2x1bWVTZWxsW21zZy5zZW5kZXJdID0gU2FmZU1hdGguYWRkKHZvbHVtZVNlbGxbbXNnLnNlbmRlcl0sIF9hbW91bnQpOwogICAgICBuYlRyYWRlW21zZy5zZW5kZXJdICs9IDE7CiAgICB9CiAgICBlbWl0IFNlbnQobXNnLnNlbmRlciwgX3RvLCBfYW1vdW50KTsKICB9CgogIC8qKgogICAqIHN3aXRjaFN0YXR1cwogICAqIFR1cm4gc3RhdHVzIHRlbGxlciBvbi9vZmYKICAgKi8KICBmdW5jdGlvbiBzd2l0Y2hTdGF0dXMoYm9vbCBfc3RhdHVzKSBleHRlcm5hbCB7CiAgICBpZiAodGVsbGVyW21zZy5zZW5kZXJdLm9ubGluZSAhPSBfc3RhdHVzKQogICAgIHRlbGxlclttc2cuc2VuZGVyXS5vbmxpbmUgPSBfc3RhdHVzOwogIH0KCiAgLyoqCiAgICogYWRkRnVuZHMKICAgKiB0ZWxsZXIgY2FuIGFkZCBtb3JlIGZ1bmRzIG9uIGhpcyBzZWxscG9pbnQKICAgKi8KICBmdW5jdGlvbiBhZGRGdW5kcygpIGV4dGVybmFsIHBheWFibGUgewogICAgcmVxdWlyZShpc1RlbGxlcihtc2cuc2VuZGVyKSk7CiAgICByZXF1aXJlKGJhbmsuYWRkRXRoVGVsbGVyLnZhbHVlKG1zZy52YWx1ZSkobXNnLnNlbmRlciwgbXNnLnZhbHVlKSk7CiAgfQoKICAvLyBnYXMgdXNlZCA2Nzg0MQogIC8vIGEgdGVsbGVyIGNhbiBkZWxldGUgYSBzZWxscG9pbnQKICBmdW5jdGlvbiBkZWxldGVUZWxsZXIoKSBleHRlcm5hbCB7CiAgICByZXF1aXJlKGlzVGVsbGVyKG1zZy5zZW5kZXIpKTsKICAgIHVpbnQgcm93VG9EZWxldGUxID0gdGVsbGVyW21zZy5zZW5kZXJdLnpvbmVJbmRleDsKICAgIGFkZHJlc3Mga2V5VG9Nb3ZlMSA9IHRlbGxlckluWm9uZVt0ZWxsZXJbbXNnLnNlbmRlcl0uY291bnRyeUlkXVt0ZWxsZXJbbXNnLnNlbmRlcl0ucG9zdGFsQ29kZV1bdGVsbGVySW5ab25lW3RlbGxlclttc2cuc2VuZGVyXS5jb3VudHJ5SWRdW3RlbGxlclttc2cuc2VuZGVyXS5wb3N0YWxDb2RlXS5sZW5ndGggLSAxXTsKICAgIHRlbGxlckluWm9uZVt0ZWxsZXJbbXNnLnNlbmRlcl0uY291bnRyeUlkXVt0ZWxsZXJbbXNnLnNlbmRlcl0ucG9zdGFsQ29kZV1bcm93VG9EZWxldGUxXSA9IGtleVRvTW92ZTE7CiAgICB0ZWxsZXJba2V5VG9Nb3ZlMV0uem9uZUluZGV4ID0gcm93VG9EZWxldGUxOwogICAgdGVsbGVySW5ab25lW3RlbGxlclttc2cuc2VuZGVyXS5jb3VudHJ5SWRdW3RlbGxlclttc2cuc2VuZGVyXS5wb3N0YWxDb2RlXS5sZW5ndGgtLTsKCiAgICB1aW50IHJvd1RvRGVsZXRlMiA9IHRlbGxlclttc2cuc2VuZGVyXS5nZW5lcmFsSW5kZXg7CiAgICBhZGRyZXNzIGtleVRvTW92ZTIgPSB0ZWxsZXJJbmRleFt0ZWxsZXJJbmRleC5sZW5ndGggLSAxXTsKICAgIHRlbGxlckluZGV4W3Jvd1RvRGVsZXRlMl0gPSBrZXlUb01vdmUyOwogICAgdGVsbGVyW2tleVRvTW92ZTJdLmdlbmVyYWxJbmRleCA9IHJvd1RvRGVsZXRlMjsKICAgIHRlbGxlckluZGV4Lmxlbmd0aC0tOwogICAgZGVsZXRlIHRlbGxlclttc2cuc2VuZGVyXTsKICAgIGJhbmsud2l0aGRyYXdEdGhUZWxsZXIobXNnLnNlbmRlcik7CiAgICBiYW5rLnJlZnVuZEV0aChtc2cuc2VuZGVyKTsKICAgIGVtaXQgRGVsZXRlVGVsbGVyKG1zZy5zZW5kZXIpOwogIH0KCiAgLy8gZ2FzIHVzZWQgNjc4NDEKICAvLyBBIG1vZGVyYXRvciBjYW4gZGVsZXRlIGEgc2VsbHBvaW50CiAgZnVuY3Rpb24gZGVsZXRlVGVsbGVyTW9kcyhhZGRyZXNzIF90b0RlbGV0ZSkgaXNUZWxsZXJNb2RlcmF0b3IobXNnLnNlbmRlcikgZXh0ZXJuYWwgewogICAgdWludCByb3dUb0RlbGV0ZTEgPSB0ZWxsZXJbX3RvRGVsZXRlXS56b25lSW5kZXg7CiAgICBhZGRyZXNzIGtleVRvTW92ZTEgPSB0ZWxsZXJJblpvbmVbdGVsbGVyW190b0RlbGV0ZV0uY291bnRyeUlkXVt0ZWxsZXJbX3RvRGVsZXRlXS5wb3N0YWxDb2RlXVt0ZWxsZXJJblpvbmVbdGVsbGVyW190b0RlbGV0ZV0uY291bnRyeUlkXVt0ZWxsZXJbX3RvRGVsZXRlXS5wb3N0YWxDb2RlXS5sZW5ndGggLSAxXTsKICAgIHRlbGxlckluWm9uZVt0ZWxsZXJbX3RvRGVsZXRlXS5jb3VudHJ5SWRdW3RlbGxlcltfdG9EZWxldGVdLnBvc3RhbENvZGVdW3Jvd1RvRGVsZXRlMV0gPSBrZXlUb01vdmUxOwogICAgdGVsbGVyW2tleVRvTW92ZTFdLnpvbmVJbmRleCA9IHJvd1RvRGVsZXRlMTsKICAgIHRlbGxlckluWm9uZVt0ZWxsZXJbX3RvRGVsZXRlXS5jb3VudHJ5SWRdW3RlbGxlcltfdG9EZWxldGVdLnBvc3RhbENvZGVdLmxlbmd0aC0tOwoKICAgIHVpbnQgcm93VG9EZWxldGUyID0gdGVsbGVyW190b0RlbGV0ZV0uZ2VuZXJhbEluZGV4OwogICAgYWRkcmVzcyBrZXlUb01vdmUyID0gdGVsbGVySW5kZXhbdGVsbGVySW5kZXgubGVuZ3RoIC0gMV07CiAgICB0ZWxsZXJJbmRleFtyb3dUb0RlbGV0ZTJdID0ga2V5VG9Nb3ZlMjsKICAgIHRlbGxlcltrZXlUb01vdmUyXS5nZW5lcmFsSW5kZXggPSByb3dUb0RlbGV0ZTI7CiAgICB0ZWxsZXJJbmRleC5sZW5ndGgtLTsKICAgIGRlbGV0ZSB0ZWxsZXJbX3RvRGVsZXRlXTsKICAgIGJhbmsud2l0aGRyYXdEdGhUZWxsZXIoX3RvRGVsZXRlKTsKICAgIGJhbmsucmVmdW5kRXRoKF90b0RlbGV0ZSk7CiAgICBlbWl0IERlbGV0ZVRlbGxlck1vZGVyYXRvcihtc2cuc2VuZGVyLCBfdG9EZWxldGUpOwogIH0KCiAgLy8gZ2FzIHVzZWQgNjc4NDEKICAvLyBBIHNob3Agb3duZXIgY2FuIGRlbGV0ZSBoaXMgcG9pbnQuCiAgZnVuY3Rpb24gZGVsZXRlU2hvcCgpIGV4dGVybmFsIHsKICAgIHJlcXVpcmUoaXNTaG9wKG1zZy5zZW5kZXIpKTsKICAgIHVpbnQgcm93VG9EZWxldGUxID0gc2hvcFttc2cuc2VuZGVyXS56b25lSW5kZXg7CiAgICBhZGRyZXNzIGtleVRvTW92ZTEgPSBzaG9wSW5ab25lW3Nob3BbbXNnLnNlbmRlcl0uY291bnRyeUlkXVtzaG9wW21zZy5zZW5kZXJdLnBvc3RhbENvZGVdW3Nob3BJblpvbmVbc2hvcFttc2cuc2VuZGVyXS5jb3VudHJ5SWRdW3Nob3BbbXNnLnNlbmRlcl0ucG9zdGFsQ29kZV0ubGVuZ3RoIC0gMV07CiAgICBzaG9wSW5ab25lW3Nob3BbbXNnLnNlbmRlcl0uY291bnRyeUlkXVtzaG9wW21zZy5zZW5kZXJdLnBvc3RhbENvZGVdW3Jvd1RvRGVsZXRlMV0gPSBrZXlUb01vdmUxOwogICAgc2hvcFtrZXlUb01vdmUxXS56b25lSW5kZXggPSByb3dUb0RlbGV0ZTE7CiAgICBzaG9wSW5ab25lW3Nob3BbbXNnLnNlbmRlcl0uY291bnRyeUlkXVtzaG9wW21zZy5zZW5kZXJdLnBvc3RhbENvZGVdLmxlbmd0aC0tOwoKICAgIHVpbnQgcm93VG9EZWxldGUyID0gc2hvcFttc2cuc2VuZGVyXS5nZW5lcmFsSW5kZXg7CiAgICBhZGRyZXNzIGtleVRvTW92ZTIgPSBzaG9wSW5kZXhbc2hvcEluZGV4Lmxlbmd0aCAtIDFdOwogICAgc2hvcEluZGV4W3Jvd1RvRGVsZXRlMl0gPSBrZXlUb01vdmUyOwogICAgc2hvcFtrZXlUb01vdmUyXS5nZW5lcmFsSW5kZXggPSByb3dUb0RlbGV0ZTI7CiAgICBzaG9wSW5kZXgubGVuZ3RoLS07CiAgICBkZWxldGUgc2hvcFttc2cuc2VuZGVyXTsKICAgIGJhbmsud2l0aGRyYXdEdGhTaG9wKG1zZy5zZW5kZXIpOwogICAgZW1pdCBEZWxldGVTaG9wKG1zZy5zZW5kZXIpOwogIH0KCiAgLy8gZ2FzIHVzZWQgNjc4NDEKICAvLyBNb2RlcmF0b3IgY2FuIGRlbGV0ZSBhIHNob3AgcG9pbnQKICBmdW5jdGlvbiBkZWxldGVTaG9wTW9kcyhhZGRyZXNzIF90b0RlbGV0ZSkgaXNTaG9wTW9kZXJhdG9yKG1zZy5zZW5kZXIpIGV4dGVybmFsIHsKICAgIHVpbnQgcm93VG9EZWxldGUxID0gc2hvcFtfdG9EZWxldGVdLnpvbmVJbmRleDsKICAgIGFkZHJlc3Mga2V5VG9Nb3ZlMSA9IHNob3BJblpvbmVbc2hvcFtfdG9EZWxldGVdLmNvdW50cnlJZF1bc2hvcFtfdG9EZWxldGVdLnBvc3RhbENvZGVdW3Nob3BJblpvbmVbc2hvcFtfdG9EZWxldGVdLmNvdW50cnlJZF1bc2hvcFtfdG9EZWxldGVdLnBvc3RhbENvZGVdLmxlbmd0aCAtIDFdOwogICAgc2hvcEluWm9uZVtzaG9wW190b0RlbGV0ZV0uY291bnRyeUlkXVtzaG9wW190b0RlbGV0ZV0ucG9zdGFsQ29kZV1bcm93VG9EZWxldGUxXSA9IGtleVRvTW92ZTE7CiAgICBzaG9wW2tleVRvTW92ZTFdLnpvbmVJbmRleCA9IHJvd1RvRGVsZXRlMTsKICAgIHNob3BJblpvbmVbc2hvcFtfdG9EZWxldGVdLmNvdW50cnlJZF1bc2hvcFtfdG9EZWxldGVdLnBvc3RhbENvZGVdLmxlbmd0aC0tOwoKICAgIHVpbnQgcm93VG9EZWxldGUyID0gc2hvcFtfdG9EZWxldGVdLmdlbmVyYWxJbmRleDsKICAgIGFkZHJlc3Mga2V5VG9Nb3ZlMiA9IHNob3BJbmRleFtzaG9wSW5kZXgubGVuZ3RoIC0gMV07CiAgICBzaG9wSW5kZXhbcm93VG9EZWxldGUyXSA9IGtleVRvTW92ZTI7CiAgICBzaG9wW2tleVRvTW92ZTJdLmdlbmVyYWxJbmRleCA9IHJvd1RvRGVsZXRlMjsKICAgIHNob3BJbmRleC5sZW5ndGgtLTsKICAgIGlmICghc2hvcFtfdG9EZWxldGVdLmRldGhlclNob3ApCiAgICAgIGJhbmsud2l0aGRyYXdEdGhTaG9wKF90b0RlbGV0ZSk7CiAgICBlbHNlCiAgICAgIGJhbmsud2l0aGRyYXdEdGhTaG9wQWRtaW4oX3RvRGVsZXRlLCBjc29BZGRyZXNzKTsKICAgIGRlbGV0ZSBzaG9wW190b0RlbGV0ZV07CiAgICBlbWl0IERlbGV0ZVNob3BNb2RlcmF0b3IobXNnLnNlbmRlciwgX3RvRGVsZXRlKTsKICB9CgogIC8qKgogICAqICBHRVRURVIKICAgKi8KCiAgLy8gZ2V0IHRlbGxlcgogIC8vIHJldHVybiB0ZWxsZXIgaW5mbwogIGZ1bmN0aW9uIGdldFRlbGxlcihhZGRyZXNzIF90ZWxsZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKAogICAgaW50MzIgbGF0LAogICAgaW50MzIgbG5nLAogICAgYnl0ZXMyIGNvdW50cnlJZCwKICAgIGJ5dGVzMTYgcG9zdGFsQ29kZSwKICAgIGludDggY3VycmVuY3lJZCwKICAgIGJ5dGVzMTYgbWVzc2VuZ2VyLAogICAgaW50OCBhdmF0YXJJZCwKICAgIGludDE2IHJhdGVzLAogICAgdWludCBiYWxhbmNlLAogICAgYm9vbCBvbmxpbmUsCiAgICB1aW50IHNlbGxWb2x1bWUsCiAgICB1aW50IG51bVRyYWRlCiAgICApIHsKICAgIFRlbGxlciBzdG9yYWdlIHRoZVRlbGxlciA9IHRlbGxlcltfdGVsbGVyXTsKICAgIGxhdCA9IHRoZVRlbGxlci5sYXQ7CiAgICBsbmcgPSB0aGVUZWxsZXIubG5nOwogICAgY291bnRyeUlkID0gdGhlVGVsbGVyLmNvdW50cnlJZDsKICAgIHBvc3RhbENvZGUgPSB0aGVUZWxsZXIucG9zdGFsQ29kZTsKICAgIGN1cnJlbmN5SWQgPSB0aGVUZWxsZXIuY3VycmVuY3lJZDsKICAgIG1lc3NlbmdlciA9IHRoZVRlbGxlci5tZXNzZW5nZXI7CiAgICBhdmF0YXJJZCA9IHRoZVRlbGxlci5hdmF0YXJJZDsKICAgIHJhdGVzID0gdGhlVGVsbGVyLnJhdGVzOwogICAgb25saW5lID0gdGhlVGVsbGVyLm9ubGluZTsKICAgIHNlbGxWb2x1bWUgPSB2b2x1bWVTZWxsW190ZWxsZXJdOwogICAgbnVtVHJhZGUgPSBuYlRyYWRlW190ZWxsZXJdOwogICAgYmFsYW5jZSA9IGJhbmsuZ2V0RXRoQmFsVGVsbGVyKF90ZWxsZXIpOwogIH0KCiAgLyoKICAgKiBTaG9wIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgKiByZXR1cm4gU2hvcCB2YWx1ZQogICAqLwogIGZ1bmN0aW9uIGdldFNob3AoYWRkcmVzcyBfc2hvcCkgcHVibGljIHZpZXcgcmV0dXJucyAoCiAgIGludDMyIGxhdCwKICAgaW50MzIgbG5nLAogICBieXRlczIgY291bnRyeUlkLAogICBieXRlczE2IHBvc3RhbENvZGUsCiAgIGJ5dGVzMTYgY2F0LAogICBieXRlczE2IG5hbWUsCiAgIGJ5dGVzMzIgZGVzY3JpcHRpb24sCiAgIGJ5dGVzMTYgb3BlbmluZwogICApIHsKICAgIFNob3Agc3RvcmFnZSB0aGVTaG9wID0gc2hvcFtfc2hvcF07CiAgICBsYXQgPSB0aGVTaG9wLmxhdDsKICAgIGxuZyA9IHRoZVNob3AubG5nOwogICAgY291bnRyeUlkID0gdGhlU2hvcC5jb3VudHJ5SWQ7CiAgICBwb3N0YWxDb2RlID0gdGhlU2hvcC5wb3N0YWxDb2RlOwogICAgY2F0ID0gdGhlU2hvcC5jYXQ7CiAgICBuYW1lID0gdGhlU2hvcC5uYW1lOwogICAgZGVzY3JpcHRpb24gPSB0aGVTaG9wLmRlc2NyaXB0aW9uOwogICAgb3BlbmluZyA9IHRoZVNob3Aub3BlbmluZzsKICAgfQoKICAgLy8gZ2V0IHJlcHV0CiAgIC8vIHJldHVybiByZXB1dGF0aW9uIGRhdGEgZnJvbSB0ZWxsZXIKICBmdW5jdGlvbiBnZXRSZXB1dChhZGRyZXNzIF90ZWxsZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKAogICB1aW50IGJ1eVZvbHVtZSwKICAgdWludCBzZWxsVm9sdW1lLAogICB1aW50IG51bVRyYWRlCiAgICkgewogICAgIGJ1eVZvbHVtZSA9IHZvbHVtZUJ1eVtfdGVsbGVyXTsKICAgICBzZWxsVm9sdW1lID0gdm9sdW1lU2VsbFtfdGVsbGVyXTsKICAgICBudW1UcmFkZSA9IG5iVHJhZGVbX3RlbGxlcl07CiAgfQogIC8vIHJldHVybiBiYWxhbmNlIG9mIHRlbGxlciBwdXQgaW4gZXNjcm93CiAgZnVuY3Rpb24gZ2V0VGVsbGVyQmFsYW5jZShhZGRyZXNzIF90ZWxsZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiBiYW5rLmdldEV0aEJhbFRlbGxlcihfdGVsbGVyKTsKICB9CgogIC8vIHJldHVybiBhbiBhcnJheSBvZiBhZGRyZXNzIG9mIGFsbCB6b25lIHByZXNlbnQgb24gYSB6b25lCiAgLy8gem9uZSBpcyBhIG1hcHBpbmcgQ09VTlRSWSA9PiBQT1NUQUxDT0RFCiAgZnVuY3Rpb24gZ2V0Wm9uZVNob3AoYnl0ZXMyIF9jb3VudHJ5LCBieXRlczE2IF9wb3N0YWxjb2RlKSBwdWJsaWMgdmlldyByZXR1cm5zIChhZGRyZXNzW10pIHsKICAgICByZXR1cm4gc2hvcEluWm9uZVtfY291bnRyeV1bX3Bvc3RhbGNvZGVdOwogIH0KCiAgLy8gcmV0dXJuIGFycmF5IG9mIGFkZHJlc3Mgb2YgYWxsIHNob3AKICBmdW5jdGlvbiBnZXRBbGxTaG9wcygpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3NbXSkgewogICByZXR1cm4gc2hvcEluZGV4OwogIH0KCiAgZnVuY3Rpb24gaXNTaG9wKGFkZHJlc3MgX3Nob3ApIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wgKXsKICAgcmV0dXJuIChzaG9wW19zaG9wXS5jb3VudHJ5SWQgIT0gYnl0ZXMyKDB4MCkpOwogIH0KCiAgLy8gcmV0dXJuIGFuIGFycmF5IG9mIGFkZHJlc3Mgb2YgYWxsIHRlbGxlciBwcmVzZW50IG9uIGEgem9uZQogIC8vIHpvbmUgaXMgYSBtYXBwaW5nIENPVU5UUlkgPT4gUE9TVEFMQ09ERQogIGZ1bmN0aW9uIGdldFpvbmVUZWxsZXIoYnl0ZXMyIF9jb3VudHJ5LCBieXRlczE2IF9wb3N0YWxjb2RlKSBwdWJsaWMgdmlldyByZXR1cm5zIChhZGRyZXNzW10pIHsKICAgICByZXR1cm4gdGVsbGVySW5ab25lW19jb3VudHJ5XVtfcG9zdGFsY29kZV07CiAgfQoKICAvLyByZXR1cm4gYXJyYXkgb2YgYWRkcmVzcyBvZiBhbGwgdGVsbGVyCiAgZnVuY3Rpb24gZ2V0QWxsVGVsbGVycygpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3NbXSkgewogICByZXR1cm4gdGVsbGVySW5kZXg7CiAgfQoKICAvLyByZXR1cm4gaWYgdGVsbGVyIG9yIG5vdAogIGZ1bmN0aW9uIGlzVGVsbGVyKGFkZHJlc3MgX3RlbGxlcikgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCApewogICAgcmV0dXJuICh0ZWxsZXJbX3RlbGxlcl0uY291bnRyeUlkICE9IGJ5dGVzMigweDApKTsKICB9CgogIC8qCiAgICogbWlzYwogICAqLwogICAvLyByZXR1cm4gaW5mbyBhYm91dCBob3cgbXVjaCBEVEggdGhlIHNob3AgaGFzIHN0YWtlZAogIGZ1bmN0aW9uIGdldFN0YWtlZFNob3AoYWRkcmVzcyBfc2hvcCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIGJhbmsuZ2V0RHRoU2hvcChfc2hvcCk7CiAgfQogIC8vIHJldHVybiBpbmZvIGFib3V0IGhvdyBtdWNoIERUSCB0aGUgdGVsbGVyIGhhcyBzdGFrZWQKICBmdW5jdGlvbiBnZXRTdGFrZWRUZWxsZXIoYWRkcmVzcyBfdGVsbGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gYmFuay5nZXREdGhUZWxsZXIoX3RlbGxlcik7CiAgfQogIC8vIGdpdmUgb3duZXJzaGlwIHRvIHRoZSBiYW5rIGNvbnRyYWN0CiAgZnVuY3Rpb24gdHJhbnNmZXJCYW5rT3duZXJzaGlwKGFkZHJlc3MgX25ld2Jhbmtvd25lcikgZXh0ZXJuYWwgb25seUNFTyB3aGVuUGF1c2VkIHsKICAgIGJhbmsudHJhbnNmZXJPd25lcnNoaXAoX25ld2Jhbmtvd25lcik7CiAgfQp9'.
	

]
