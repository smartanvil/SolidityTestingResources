Class {
	#name : #SRT5f5b2c8af81193bdaf2cb6793fb3d4dce52fba99,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT5f5b2c8af81193bdaf2cb6793fb3d4dce52fba99 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgoKCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKCiAgLyoqCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgcHVibGljIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgaWYgKG5ld093bmVyICE9IGFkZHJlc3MoMCkpIHsKICAgICAgb3duZXIgPSBuZXdPd25lcjsKICAgIH0KICB9Cgp9CgovLy8gQHRpdGxlIEludGVyZmFjZSBmb3IgY29udHJhY3RzIGNvbmZvcm1pbmcgdG8gRVJDLTcyMTogTm9uLUZ1bmdpYmxlIFRva2VucwovLy8gQGF1dGhvciBEaWV0ZXIgU2hpcmxleSA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9Ijk1ZjFmMGUxZjBkNWY0ZWRmY2ZhZjhlZmYwZmJiYmY2ZmEiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+PiAoaHR0cHM6Ly9naXRodWIuY29tL2RldGUpCmNvbnRyYWN0IEVSQzcyMSB7CiAgICAvLyBSZXF1aXJlZCBtZXRob2RzCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgdG90YWwpOwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOwogICAgZnVuY3Rpb24gb3duZXJPZih1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGFkZHJlc3Mgb3duZXIpOwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsOwoKICAgIC8vIEV2ZW50cwogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHRva2VuSWQpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBhcHByb3ZlZCwgdWludDI1NiB0b2tlbklkKTsKCiAgICAvLyBPcHRpb25hbAogICAgLy8gZnVuY3Rpb24gbmFtZSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZyBuYW1lKTsKICAgIC8vIGZ1bmN0aW9uIHN5bWJvbCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZyBzeW1ib2wpOwogICAgLy8gZnVuY3Rpb24gdG9rZW5zT2ZPd25lcihhZGRyZXNzIF9vd25lcikgZXh0ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2W10gdG9rZW5JZHMpOwogICAgLy8gZnVuY3Rpb24gdG9rZW5NZXRhZGF0YSh1aW50MjU2IF90b2tlbklkLCBzdHJpbmcgX3ByZWZlcnJlZFRyYW5zcG9ydCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nIGluZm9VcmwpOwoKICAgIC8vIEVSQy0xNjUgQ29tcGF0aWJpbGl0eSAoaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE2NSkKICAgIGZ1bmN0aW9uIHN1cHBvcnRzSW50ZXJmYWNlKGJ5dGVzNCBfaW50ZXJmYWNlSUQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCk7Cn0KCgoKCgoKCgoKCgpjb250cmFjdCBNb25zdGVyQWNjZXNzQ29udHJvbCB7CgogICAgZXZlbnQgQ29udHJhY3RVcGdyYWRlKGFkZHJlc3MgbmV3Q29udHJhY3QpOwoKICAgICAvLyBUaGUgYWRkcmVzc2VzIG9mIHRoZSBhY2NvdW50cyAob3IgY29udHJhY3RzKSB0aGF0IGNhbiBleGVjdXRlIGFjdGlvbnMgd2l0aGluIGVhY2ggcm9sZXMuCiAgICBhZGRyZXNzIHB1YmxpYyBhZG1pbkFkZHJlc3M7CiAgICAKCiAgCgogICAgLy8vIEBkZXYgQWNjZXNzIG1vZGlmaWVyIGZvciBDRU8tb25seSBmdW5jdGlvbmFsaXR5CiAgICBtb2RpZmllciBvbmx5QWRtaW4oKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkbWluQWRkcmVzcyk7CiAgICAgICAgXzsKICAgIH0KCiAgCgogICAgCn0KCi8vIFRoaXMgY29udHJhY3Qgc3RvcmVzIGFsbCBkYXRhIG9uIHRoZSBibG9ja2NoYWluCi8vIG9ubHkgb3VyIG90aGVyIGNvbnRyYWN0cyBjYW4gaW50ZXJhY3Qgd2l0aCB0aGlzCi8vIHRoZSBkYXRhIGhlcmUgd2lsbCBiZSB2YWxpZCBmb3IgYWxsIGV0ZXJuaXR5IGV2ZW4gaWYgb3RoZXIgY29udHJhY3RzIGdldCB1cGRhdGVkCi8vIHRoaXMgd2F5IHdlIGNhbiBtYWtlIHN1cmUgdGhhdCBvdXIgTW9uc3RlcnMgaGF2ZSBhIGhhcmQtY29kZWQgdmFsdWUgYXR0YWNoZWQgdG8gdGhlbQovLyB0aGF0IG5vIG9uZSBpbmNsdWRpbmcgdXMgY2FuIGNoYW5nZSghKQpjb250cmFjdCBNb25zdGVyc0RhdGEgewoKICAgIGFkZHJlc3MgY29yZUNvbnRyYWN0OyAvLyAKICAgIAoKCiAgICBzdHJ1Y3QgTW9uc3RlciB7CiAgICAgICAgLy8gdGltZXN0YW1wIG9mIGJsb2NrIHdoZW4gdGhpcyBtb25zdGVyIHdhcyBzcGF3bmVkL2NyZWF0ZWQKICAgICAgICB1aW50NjQgYmlydGhUaW1lOwoKICAgICAgICAvLyBnZW5lcmF0aW9uIG51bWJlcgogICAgICAgIC8vIGdlbjAgaXMgdGhlIHZlcnkgZmlyc3QgZ2VuZXJhdGlvbiAtIHRoZSBsYXRlciBtb25zdGVyIHNwYXduIHRoZSBsZXNzIGxpa2VseSB0aGV5IGFyZSB0byBoYXZlCiAgICAgICAgLy8gc3BlY2lhbCBhdHRyaWJ1dGVzIGFuZCBzdGF0cwogICAgICAgLy8gdWludDE2IGdlbmVyYXRpb247CgogICAgICAgIHVpbnQxNiBocDsgLy8gaGVhbHRoIHBvaW50cyAKICAgICAgICB1aW50MTYgYXR0YWNrOyAvLyBhdHRhY2sgcG9pbnRzCiAgICAgICAgdWludDE2IGRlZmVuc2U7IC8vIGRlZmVuc2UgcG9pbnRzCiAgICAgICAgdWludDE2IHNwQXR0YWNrOyAvLyBzcGVjaWFsIGF0dGFjawogICAgICAgIHVpbnQxNiBzcERlZmVuc2U7IC8vIHNwZWNpYWwgZGVmZW5zZQogICAgICAgIHVpbnQxNiBzcGVlZDsgLy8gc3BlZWQgcmVzcG9uc2libGUgb2Ygd2hvIGF0dGFja3MgZmlyc3QoISkKICAgICAgICAKCiAgICAgICAgdWludDE2IHR5cGVPbmU7CiAgICAgICAgdWludDE2IHR5cGVUd287CgogICAgICAgIHVpbnQxNiBtSUQ7IC8vIHRoaXMgaWQgKGZyb20gMSB0byAxNTEpIGlzIHJlc3BvbnNpYmxlIGZvciBldmVyeXRoaW5nIHZpc3VhbGx5IGxpa2Ugc2hvd2luZyB0aGUgcmVhbCBkZWFsIQogICAgICAgIGJvb2wgdHJhZGVhYmxlOwogICAgICAgIC8vdWludDE2IHVJRDsgLy8gdW5pcXVlIGlkCiAgICAgICAgCiAgICAgICAgLy8gVGhlc2UgYXR0cmlidXRlcyBhcmUgaGFuZGxlZCBieSBtYXBwaW5ncyBzaW5jZSB0aGV5IHdvdWxkIG92ZXJmbG93IHRoZSBtYXhpbXVtIHN0YWNrCiAgICAgICAgLy9ib29sIGZlbWFsZQogICAgICAgIC8vIHN0cmluZyBuaWNrbmFtZQogICAgICAgIAoKICAgIH0KCiAgICAvLyBsdjEgYmFzZSBzdGF0cwogICAgc3RydWN0IE1vbnN0ZXJCYXNlU3RhdHMgewogICAgICAgIHVpbnQxNiBocDsKICAgICAgICB1aW50MTYgYXR0YWNrOwogICAgICAgIHVpbnQxNiBkZWZlbnNlOwogICAgICAgIHVpbnQxNiBzcEF0dGFjazsKICAgICAgICB1aW50MTYgc3BEZWZlbnNlOwogICAgICAgIHVpbnQxNiBzcGVlZDsKICAgICAgICAKICAgIH0KCiAgICAvLyBsb21vbnN0ZXJpb24gc3RydWN0IHVzZWQgZm9yIHRyYXZlbGxpbmcgYXJvdW5kIHRoZSAid29ybGQiCiAgICAvLyAKICAgIHN0cnVjdCBBcmVhIHsKICAgICAgICAvLyBhcmVhSUQgdXNlZCBpbi1lbmdpbmUgdG8gZGV0ZXJtaW5lIHdvcmxkIHBvc2l0aW9uCiAgICAgICAKICAgICAgICAgICAgIAogICAgICAgIC8vIG1pbmltdW0gbGV2ZWwgdG8gZW50ZXIgdGhpcyBhcmVhLi4uCiAgICAgICAgdWludDE2IG1pbkxldmVsOwogICAgfQoKICAgIHN0cnVjdCBUcmFpbmVyIHsKICAgICAgICAvLyB0aW1lc3RhbXAgb2YgYmxvY2sgd2hlbiB0aGlzIHBsYXllci90cmFpbmVyIHdhcyBjcmVhdGVkCiAgICAgICAgdWludDY0IGJpcnRoVGltZTsKICAgICAgICAKICAgICAgICAvLyBhZGQgdXNlcm5hbWUKICAgICAgICBzdHJpbmcgdXNlcm5hbWU7CiAgICAgICAKICAgICAgICAKICAgICAgICAvLyBjdXJyZW50IGFyZWEgaW4gdGhlICJ3b3JsZCIKICAgICAgICB1aW50MTYgY3VyckFyZWE7CiAgICAgICAgCiAgICAgICAgYWRkcmVzcyBvd25lcjsKICAgICAgICAKICAgICAgIAogICAgICAgIAogICAgfQoKCiAgIAoKCiAgICAvLyB0YWtlIHRpbWVzdGFtcCBvZiBibG9jayB0aGlzIGdhbWUgd2FzIGNyZWF0ZWQgb24gdGhlIGJsb2NrY2hhaW4KICAgIHVpbnQ2NCBjcmVhdGlvbkJsb2NrID0gdWludDY0KG5vdyk7CiAgIAogICAKCiAgIAogIAogICAgCgoKICAgIAogIAogICAgICAgIAoKCn0KCgoKCmNvbnRyYWN0IE1vbnN0ZXJzQmFzZSBpcyBNb25zdGVyQWNjZXNzQ29udHJvbCwgTW9uc3RlcnNEYXRhIHsKCiAgICAvLy8gQGRldiBUcmFuc2ZlciBldmVudCBhcyBkZWZpbmVkIGluIGN1cnJlbnQgZHJhZnQgb2YgRVJDNzIxLiBFbWl0dGVkIGV2ZXJ5IHRpbWUgYSBtb25zdGVyCiAgICAvLy8gIG93bmVyc2hpcCBpcyBhc3NpZ25lZCwgaW5jbHVkaW5nIGJpcnRocy4KICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB0b2tlbklkKTsKCiAgICBib29sIGxvY2tlZE1vbnN0ZXJDcmVhdG9yID0gZmFsc2U7CgogICAgTW9uc3RlckF1Y3Rpb24gcHVibGljIG1vbnN0ZXJBdWN0aW9uOwoKICAgIE1vbnN0ZXJDcmVhdG9ySW50ZXJmYWNlIHB1YmxpYyBtb25zdGVyQ3JlYXRvcjsKCgogICAgZnVuY3Rpb24gc2V0TW9uc3RlckNyZWF0b3JBZGRyZXNzKGFkZHJlc3MgX2FkZHJlc3MpIGV4dGVybmFsIG9ubHlBZG1pbiB7CiAgICAgICAgLy8gb25seSBzZXQgdGhpcyBvbmNlIHNvIHdlICh0aGUgZGV2cykgY2FuJ3QgY2hlYXQhCiAgICAgICAgcmVxdWlyZSghbG9ja2VkTW9uc3RlckNyZWF0b3IpOwogICAgICAgIE1vbnN0ZXJDcmVhdG9ySW50ZXJmYWNlIGNhbmRpZGF0ZUNvbnRyYWN0ID0gTW9uc3RlckNyZWF0b3JJbnRlcmZhY2UoX2FkZHJlc3MpOwoKICAgICAgIAoKICAgICAgICBtb25zdGVyQ3JlYXRvciA9IGNhbmRpZGF0ZUNvbnRyYWN0OwogICAgICAgIGxvY2tlZE1vbnN0ZXJDcmVhdG9yID0gdHJ1ZTsKCiAgICB9CiAgICAKICAgIC8vIEFuIGFwcHJveGltYXRpb24gb2YgY3VycmVudGx5IGhvdyBtYW55IHNlY29uZHMgYXJlIGluIGJldHdlZW4gYmxvY2tzLgogICAgdWludDI1NiBwdWJsaWMgc2Vjb25kc1BlckJsb2NrID0gMTU7CiAgCgogICAgLy8gYXJyYXkgY29udGFpbmluZyBhbGwgbW9uc3RlcnMgaW4gZXhpc3RlbmNlCiAgICBNb25zdGVyW10gbW9uc3RlcnM7CgogICAgdWludDhbXSBhcmVhczsKCiAgICB1aW50OCBhcmVhSW5kZXggPSAwOwogICAgCgoKICAgICAgbWFwcGluZyhhZGRyZXNzID0+IFRyYWluZXIpIHB1YmxpYyBhZGRyZXNzVG9UcmFpbmVyOwogICAgCgogICAgLy8vIEBkZXYgQSBtYXBwaW5nIGZyb20gbW9uc3RlciBJRHMgdG8gdGhlIGFkZHJlc3MgdGhhdCBvd25zIHRoZW0uIEFsbCBtb25zdGVyIGhhdmUKICAgIC8vLyAgc29tZSB2YWxpZCBvd25lciBhZGRyZXNzLCBldmVuIGdlbjAgbW9uc3RlciBhcmUgY3JlYXRlZCB3aXRoIGEgbm9uLXplcm8gb3duZXIuCiAgICBtYXBwaW5nICh1aW50MjU2ID0+IGFkZHJlc3MpIHB1YmxpYyBtb25zdGVySW5kZXhUb093bmVyOwoKICAgIC8vIEBkZXYgQSBtYXBwaW5nIGZyb20gb3duZXIgYWRkcmVzcyB0byBjb3VudCBvZiB0b2tlbnMgdGhhdCBhZGRyZXNzIG93bnMuCiAgICAvLyAgVXNlZCBpbnRlcm5hbGx5IGluc2lkZSBiYWxhbmNlT2YoKSB0byByZXNvbHZlIG93bmVyc2hpcCBjb3VudC4KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1Nikgb3duZXJzaGlwVG9rZW5Db3VudDsKCgogICAgbWFwcGluZyAodWludDI1NiA9PiBhZGRyZXNzKSBwdWJsaWMgbW9uc3RlckluZGV4VG9BcHByb3ZlZDsKICAgIAogICAgbWFwcGluZyAodWludDI1NiA9PiBzdHJpbmcpIHB1YmxpYyBtb25zdGVySWRUb05pY2tuYW1lOwogICAgCiAgICBtYXBwaW5nICh1aW50MjU2ID0+IGJvb2wpIHB1YmxpYyBtb25zdGVySWRUb1RyYWRlYWJsZTsKICAgIAogICAgbWFwcGluZyAodWludDI1NiA9PiB1aW50MjU2KSBwdWJsaWMgbW9uc3RlcklkVG9HZW5lcmF0aW9uOwoKCiAgICAgbWFwcGluZyAodWludDI1NiA9PiBNb25zdGVyQmFzZVN0YXRzKSBwdWJsaWMgYmFzZVN0YXRzOwoKICAgICBtYXBwaW5nICh1aW50MjU2ID0+IHVpbnQ4WzddKSBwdWJsaWMgbW9uc3RlcklkVG9JVnM7CiAgICAKCgogICAgLy8gYWRkcyBuZXcgYXJlYSB0byB3b3JsZCAKICAgIGZ1bmN0aW9uIF9jcmVhdGVBcmVhKCkgaW50ZXJuYWwgewogICAgICAgICAgICAKICAgICAgICAgICAgYXJlYUluZGV4Kys7CiAgICAgICAgICAgIGFyZWFzLnB1c2goYXJlYUluZGV4KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIAogICAgICAgIH0KCiAgICAKCgogICAgZnVuY3Rpb24gX2NyZWF0ZU1vbnN0ZXIoCiAgICAgICAgdWludDI1NiBfZ2VuZXJhdGlvbiwKICAgICAgICB1aW50MjU2IF9ocCwKICAgICAgICB1aW50MjU2IF9hdHRhY2ssCiAgICAgICAgdWludDI1NiBfZGVmZW5zZSwKICAgICAgICB1aW50MjU2IF9zcEF0dGFjaywKICAgICAgICB1aW50MjU2IF9zcERlZmVuc2UsCiAgICAgICAgdWludDI1NiBfc3BlZWQsCiAgICAgICAgdWludDI1NiBfdHlwZU9uZSwKICAgICAgICB1aW50MjU2IF90eXBlVHdvLAogICAgICAgIGFkZHJlc3MgX293bmVyLAogICAgICAgIHVpbnQyNTYgX21JRCwKICAgICAgICBib29sIHRyYWRlYWJsZQogICAgICAgIAogICAgKQogICAgICAgIGludGVybmFsCiAgICAgICAgcmV0dXJucyAodWludCkKICAgICAgICB7CiAgICAgICAgICAgCgogICAgICAgICAgICBNb25zdGVyIG1lbW9yeSBfbW9uc3RlciA9IE1vbnN0ZXIoewogICAgICAgICAgICAgICAgYmlydGhUaW1lOiB1aW50NjQobm93KSwKICAgICAgICAgICAgICAgIGhwOiB1aW50MTYoX2hwKSwKICAgICAgICAgICAgICAgIGF0dGFjazogdWludDE2KF9hdHRhY2spLAogICAgICAgICAgICAgICAgZGVmZW5zZTogdWludDE2KF9kZWZlbnNlKSwKICAgICAgICAgICAgICAgIHNwQXR0YWNrOiB1aW50MTYoX3NwQXR0YWNrKSwKICAgICAgICAgICAgICAgIHNwRGVmZW5zZTogdWludDE2KF9zcERlZmVuc2UpLAogICAgICAgICAgICAgICAgc3BlZWQ6IHVpbnQxNihfc3BlZWQpLAogICAgICAgICAgICAgICAgdHlwZU9uZTogdWludDE2KF90eXBlT25lKSwKICAgICAgICAgICAgICAgIHR5cGVUd286IHVpbnQxNihfdHlwZVR3byksCiAgICAgICAgICAgICAgICBtSUQ6IHVpbnQxNihfbUlEKSwKICAgICAgICAgICAgICAgIHRyYWRlYWJsZTogdHJhZGVhYmxlCiAgICAgICAgICAgICAgICAKCgogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdWludDI1NiBuZXdNb25zdGVySWQgPSBtb25zdGVycy5wdXNoKF9tb25zdGVyKSAtIDE7CiAgICAgICAgICAgIG1vbnN0ZXJJZFRvVHJhZGVhYmxlW25ld01vbnN0ZXJJZF0gPSB0cmFkZWFibGU7CiAgICAgICAgICAgIG1vbnN0ZXJJZFRvR2VuZXJhdGlvbltuZXdNb25zdGVySWRdID0gX2dlbmVyYXRpb247CiAgICAgICAgICAgCgogICAgICAgICAgICByZXF1aXJlKG5ld01vbnN0ZXJJZCA9PSB1aW50MjU2KHVpbnQzMihuZXdNb25zdGVySWQpKSk7CiAgICAgICAgICAgIAogICAgICAgICAgIAogICAgICAgICAgCiAgICAgICAgICAgIAogICAgICAgICAgICAgbW9uc3RlcklkVG9OaWNrbmFtZVtuZXdNb25zdGVySWRdID0gIiI7CgogICAgICAgICAgICBfdHJhbnNmZXIoMCwgX293bmVyLCBuZXdNb25zdGVySWQpOwoKICAgICAgICAgICAgcmV0dXJuIG5ld01vbnN0ZXJJZDsKCgogICAgICAgIH0KICAgIAogICAgZnVuY3Rpb24gX2NyZWF0ZVRyYWluZXIoc3RyaW5nIF91c2VybmFtZSwgdWludDE2IF9zdGFydGVySWQsIGFkZHJlc3MgX293bmVyKQogICAgICAgIGludGVybmFsCiAgICAgICAgcmV0dXJucyAodWludCBtb24pCiAgICAgICAgewogICAgICAgICAgICAKICAgICAgICAgICAKICAgICAgICAgICAgVHJhaW5lciBtZW1vcnkgX3RyYWluZXIgPSBUcmFpbmVyKHsKICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBiaXJ0aFRpbWU6IHVpbnQ2NChub3cpLAogICAgICAgICAgICAgICAgdXNlcm5hbWU6IHN0cmluZyhfdXNlcm5hbWUpLAogICAgICAgICAgICAgICAgY3VyckFyZWE6IHVpbnQxNigxKSwgLy8gc2V0cyB0byBmaXJzdCBhcmVhISwKICAgICAgICAgICAgICAgIG93bmVyOiBhZGRyZXNzKF9vd25lcikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYWRkcmVzc1RvVHJhaW5lcltfb3duZXJdID0gX3RyYWluZXI7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBzdGFydGVyIHN0YXRzIGFyZSBoYXJkY29kZWQhCiAgICAgICAgICAgIGlmIChfc3RhcnRlcklkID09IDEpIHsKICAgICAgICAgICAgICAgIHVpbnQ4WzhdIG1lbW9yeSBTdGF0cyA9IHVpbnQ4WzhdKG1vbnN0ZXJDcmVhdG9yLmdldE1vbnN0ZXJTdGF0cygxKSk7CiAgICAgICAgICAgICAgICBtb24gPSBfY3JlYXRlTW9uc3RlcigwLCBTdGF0c1swXSwgU3RhdHNbMV0sIFN0YXRzWzJdLCBTdGF0c1szXSwgU3RhdHNbNF0sIFN0YXRzWzVdLCBTdGF0c1s2XSwgU3RhdHNbN10sIF9vd25lciwgMSwgZmFsc2UpOwogICAgICAgICAgICAgICAKICAgICAgICAgICAgfSBlbHNlIGlmIChfc3RhcnRlcklkID09IDIpIHsKICAgICAgICAgICAgICAgIHVpbnQ4WzhdIG1lbW9yeSBTdGF0czIgPSB1aW50OFs4XShtb25zdGVyQ3JlYXRvci5nZXRNb25zdGVyU3RhdHMoNCkpOwogICAgICAgICAgICAgICAgbW9uID0gX2NyZWF0ZU1vbnN0ZXIoMCwgU3RhdHMyWzBdLCBTdGF0czJbMV0sIFN0YXRzMlsyXSwgU3RhdHMyWzNdLCBTdGF0czJbNF0sIFN0YXRzMls1XSwgU3RhdHMyWzZdLCBTdGF0czJbN10sIF9vd25lciwgNCwgZmFsc2UpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIH0gZWxzZSBpZiAoX3N0YXJ0ZXJJZCA9PSAzKSB7CiAgICAgICAgICAgICAgICB1aW50OFs4XSBtZW1vcnkgU3RhdHMzID0gdWludDhbOF0obW9uc3RlckNyZWF0b3IuZ2V0TW9uc3RlclN0YXRzKDcpKTsKICAgICAgICAgICAgICAgIG1vbiA9IF9jcmVhdGVNb25zdGVyKDAsIFN0YXRzM1swXSwgU3RhdHMzWzFdLCBTdGF0czNbMl0sIFN0YXRzM1szXSwgU3RhdHMzWzRdLCBTdGF0czNbNV0sIFN0YXRzM1s2XSwgU3RhdHMzWzddLCBfb3duZXIsIDcsIGZhbHNlKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgIH0KCgogICAgZnVuY3Rpb24gX21vdmVUb0FyZWEodWludDE2IF9uZXdBcmVhLCBhZGRyZXNzIHBsYXllcikgaW50ZXJuYWwgewogICAgICAgICAgICAKICAgICAgICAgICAgYWRkcmVzc1RvVHJhaW5lcltwbGF5ZXJdLmN1cnJBcmVhID0gX25ld0FyZWE7CiAgICAgICAgICAKICAgICAgICB9ICAgCiAgICAgICAgCiAgICAKICAgICAKCiAgICAKICAgIC8vIGFzc2lnbnMgb3duZXJzaGlwIG9mIG1vbnN0ZXIgdG8gYWRkcmVzcwogICAgZnVuY3Rpb24gX3RyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB7CiAgICAgICAgb3duZXJzaGlwVG9rZW5Db3VudFtfdG9dKys7CiAgICAgICAgbW9uc3RlckluZGV4VG9Pd25lcltfdG9rZW5JZF0gPSBfdG87CgogICAgICAgIGlmIChfZnJvbSAhPSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgIG93bmVyc2hpcFRva2VuQ291bnRbX2Zyb21dLS07CgogICAgICAgICAgICAvLyBjbGVhciBhbnkgcHJldmlvdXNseSBhcHByb3ZlZCBvd25lcnNoaXAgZXhjaGFuZ2UKICAgICAgICAgICAgZGVsZXRlIG1vbnN0ZXJJbmRleFRvQXBwcm92ZWRbX3Rva2VuSWRdOwogICAgICAgIH0KCiAgICAgICAgLy8gRW1pdCBUcmFuc2ZlciBldmVudAogICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCgogICAgLy8gT25seSBhZG1pbiBjYW4gZml4IGhvdyBtYW55IHNlY29uZHMgcGVyIGJsb2NrcyBhcmUgY3VycmVudGx5IG9ic2VydmVkLgogICAgZnVuY3Rpb24gc2V0U2Vjb25kc1BlckJsb2NrKHVpbnQyNTYgc2VjcykgZXh0ZXJuYWwgb25seUFkbWluIHsKICAgICAgICAvL3JlcXVpcmUoc2VjcyA8IGNvb2xkb3duc1swXSk7CiAgICAgICAgc2Vjb25kc1BlckJsb2NrID0gc2VjczsKICAgIH0KCgogICAgCgoKfQoKLy8vIEB0aXRsZSBUaGUgZXh0ZXJuYWwgY29udHJhY3QgdGhhdCBpcyByZXNwb25zaWJsZSBmb3IgZ2VuZXJhdGluZyBtZXRhZGF0YSBmb3IgdGhlIG1vbnN0ZXJzLAovLy8gIGl0IGhhcyBvbmUgZnVuY3Rpb24gdGhhdCB3aWxsIHJldHVybiB0aGUgZGF0YSBhcyBieXRlcy4KY29udHJhY3QgRVJDNzIxTWV0YWRhdGEgewogICAgLy8vIEBkZXYgR2l2ZW4gYSB0b2tlbiBJZCwgcmV0dXJucyBhIGJ5dGUgYXJyYXkgdGhhdCBpcyBzdXBwb3NlZCB0byBiZSBjb252ZXJ0ZWQgaW50byBzdHJpbmcuCiAgICBmdW5jdGlvbiBnZXRNZXRhZGF0YSh1aW50MjU2IF90b2tlbklkLCBzdHJpbmcpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJ5dGVzMzJbNF0gYnVmZmVyLCB1aW50MjU2IGNvdW50KSB7CiAgICAgICAgaWYgKF90b2tlbklkID09IDEpIHsKICAgICAgICAgICAgYnVmZmVyWzBdID0gIkhlbGxvIFdvcmxkISA6RCI7CiAgICAgICAgICAgIGNvdW50ID0gMTU7CiAgICAgICAgfSBlbHNlIGlmIChfdG9rZW5JZCA9PSAyKSB7CiAgICAgICAgICAgIGJ1ZmZlclswXSA9ICJJIHdvdWxkIGRlZmluaXRlbHkgY2hvb3NlIGEgbWVkaSI7CiAgICAgICAgICAgIGJ1ZmZlclsxXSA9ICJ1bSBsZW5ndGggc3RyaW5nLiI7CiAgICAgICAgICAgIGNvdW50ID0gNDk7CiAgICAgICAgfSBlbHNlIGlmIChfdG9rZW5JZCA9PSAzKSB7CiAgICAgICAgICAgIGJ1ZmZlclswXSA9ICJMb3JlbSBpcHN1bSBkb2xvciBzaXQgYW1ldCwgbWkgZSI7CiAgICAgICAgICAgIGJ1ZmZlclsxXSA9ICJzdCBhY2N1bXNhbiBkYXBpYnVzIGF1Z3VlIGxvcmVtLCI7CiAgICAgICAgICAgIGJ1ZmZlclsyXSA9ICIgdHJpc3RpcXVlIHZlc3RpYnVsdW0gaWQsIGxpYmVybyI7CiAgICAgICAgICAgIGJ1ZmZlclszXSA9ICIgc3VzY2lwaXQgdmFyaXVzIHNhcGllbiBhbGlxdWFtLiI7CiAgICAgICAgICAgIGNvdW50ID0gMTI4OwogICAgICAgIH0KICAgIH0KfQoKCmNvbnRyYWN0IE1vbnN0ZXJPd25lcnNoaXAgaXMgTW9uc3RlcnNCYXNlLCBFUkM3MjEgewoKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJDaGFpbk1vbnN0ZXJzIjsKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gIkNITU8iOwoKCiAgICAvLyBUaGUgY29udHJhY3QgdGhhdCB3aWxsIHJldHVybiBtb25zdGVyIG1ldGFkYXRhCiAgICBFUkM3MjFNZXRhZGF0YSBwdWJsaWMgZXJjNzIxTWV0YWRhdGE7CgogICAgYnl0ZXM0IGNvbnN0YW50IEludGVyZmFjZVNpZ25hdHVyZV9FUkMxNjUgPQogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3N1cHBvcnRzSW50ZXJmYWNlKGJ5dGVzNCknKSk7CgoKCgogICAgYnl0ZXM0IGNvbnN0YW50IEludGVyZmFjZVNpZ25hdHVyZV9FUkM3MjEgPQogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ25hbWUoKScpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1Nignc3ltYm9sKCknKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3RvdGFsU3VwcGx5KCknKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ2JhbGFuY2VPZihhZGRyZXNzKScpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1Nignb3duZXJPZih1aW50MjU2KScpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NignYXBwcm92ZShhZGRyZXNzLHVpbnQyNTYpJykpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCd0cmFuc2ZlcihhZGRyZXNzLHVpbnQyNTYpJykpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCd0cmFuc2ZlckZyb20oYWRkcmVzcyxhZGRyZXNzLHVpbnQyNTYpJykpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCd0b2tlbnNPZk93bmVyKGFkZHJlc3MpJykpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCd0b2tlbk1ldGFkYXRhKHVpbnQyNTYsc3RyaW5nKScpKTsKCgoKCiAgICBmdW5jdGlvbiBzdXBwb3J0c0ludGVyZmFjZShieXRlczQgX2ludGVyZmFjZUlEKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICAvLyBERUJVRyBPTkxZCiAgICAgICAgLy9yZXF1aXJlKChJbnRlcmZhY2VTaWduYXR1cmVfRVJDMTY1ID09IDB4MDFmZmM5YTcpICYmIChJbnRlcmZhY2VTaWduYXR1cmVfRVJDNzIxID09IDB4OWEyMDQ4M2QpKTsKCiAgICAgICAgcmV0dXJuICgoX2ludGVyZmFjZUlEID09IEludGVyZmFjZVNpZ25hdHVyZV9FUkMxNjUpIHx8IChfaW50ZXJmYWNlSUQgPT0gSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzcyMSkpOwogICAgfQoKICAgIC8vLyBAZGV2IFNldCB0aGUgYWRkcmVzcyBvZiB0aGUgc2libGluZyBjb250cmFjdCB0aGF0IHRyYWNrcyBtZXRhZGF0YS4KICAgIC8vLyAgQ0VPIG9ubHkuCiAgICBmdW5jdGlvbiBzZXRNZXRhZGF0YUFkZHJlc3MoYWRkcmVzcyBfY29udHJhY3RBZGRyZXNzKSBwdWJsaWMgb25seUFkbWluIHsKICAgICAgICBlcmM3MjFNZXRhZGF0YSA9IEVSQzcyMU1ldGFkYXRhKF9jb250cmFjdEFkZHJlc3MpOwogICAgfQoKICAgIGZ1bmN0aW9uIF9vd25zKGFkZHJlc3MgX2NsYWltYW50LCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gbW9uc3RlckluZGV4VG9Pd25lcltfdG9rZW5JZF0gPT0gX2NsYWltYW50OwogICAgfQogICAgCiAgICBmdW5jdGlvbiBfaXNUcmFkZWFibGUodWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIG1vbnN0ZXJJZFRvVHJhZGVhYmxlW190b2tlbklkXTsKICAgIH0KICAgIAogICAgCiAgICAvLy8gQGRldiBDaGVja3MgaWYgYSBnaXZlbiBhZGRyZXNzIGN1cnJlbnRseSBoYXMgdHJhbnNmZXJBcHByb3ZhbCBmb3IgYSBwYXJ0aWN1bGFyIG1vbnN0ZXIuCiAgICAvLy8gQHBhcmFtIF9jbGFpbWFudCB0aGUgYWRkcmVzcyB3ZSBhcmUgY29uZmlybWluZyBtb25zdGVyIGlzIGFwcHJvdmVkIGZvci4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgbW9uc3RlciBpZCwgb25seSB2YWxpZCB3aGVuID4gMAogICAgZnVuY3Rpb24gX2FwcHJvdmVkRm9yKGFkZHJlc3MgX2NsYWltYW50LCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gbW9uc3RlckluZGV4VG9BcHByb3ZlZFtfdG9rZW5JZF0gPT0gX2NsYWltYW50OwogICAgfQoKICAgIC8vLyBAZGV2IE1hcmtzIGFuIGFkZHJlc3MgYXMgYmVpbmcgYXBwcm92ZWQgZm9yIHRyYW5zZmVyRnJvbSgpLCBvdmVyd3JpdGluZyBhbnkgcHJldmlvdXMKICAgIC8vLyAgYXBwcm92YWwuIFNldHRpbmcgX2FwcHJvdmVkIHRvIGFkZHJlc3MoMCkgY2xlYXJzIGFsbCB0cmFuc2ZlciBhcHByb3ZhbC4KICAgIC8vLyAgTk9URTogX2FwcHJvdmUoKSBkb2VzIE5PVCBzZW5kIHRoZSBBcHByb3ZhbCBldmVudC4gVGhpcyBpcyBpbnRlbnRpb25hbCBiZWNhdXNlCiAgICAvLy8gIF9hcHByb3ZlKCkgYW5kIHRyYW5zZmVyRnJvbSgpIGFyZSB1c2VkIHRvZ2V0aGVyIGZvciBwdXR0aW5nIG1vbnN0ZXJzIG9uIGF1Y3Rpb24sIGFuZAogICAgLy8vICB0aGVyZSBpcyBubyB2YWx1ZSBpbiBzcGFtbWluZyB0aGUgbG9nIHdpdGggQXBwcm92YWwgZXZlbnRzIGluIHRoYXQgY2FzZS4KICAgIGZ1bmN0aW9uIF9hcHByb3ZlKHVpbnQyNTYgX3Rva2VuSWQsIGFkZHJlc3MgX2FwcHJvdmVkKSBpbnRlcm5hbCB7CiAgICAgICAgbW9uc3RlckluZGV4VG9BcHByb3ZlZFtfdG9rZW5JZF0gPSBfYXBwcm92ZWQ7CiAgICB9CiAgICAKICAgIAogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IGNvdW50KSB7CiAgICAgICAgcmV0dXJuIG93bmVyc2hpcFRva2VuQ291bnRbX293bmVyXTsKICAgIH0KCgogICAgZnVuY3Rpb24gdHJhbnNmZXIgKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbCB7CiAgICAgICAgLy8gU2FmZXR5IGNoZWNrIHRvIHByZXZlbnQgYWdhaW5zdCBhbiB1bmV4cGVjdGVkIDB4MCBkZWZhdWx0LgogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIC8vIERpc2FsbG93IHRyYW5zZmVycyB0byB0aGlzIGNvbnRyYWN0IHRvIHByZXZlbnQgYWNjaWRlbnRhbCBtaXN1c2UuCiAgICAgICAgLy8gVGhlIGNvbnRyYWN0IHNob3VsZCBuZXZlciBvd24gYW55IG1vbnN0ZXJzIChleGNlcHQgdmVyeSBicmllZmx5CiAgICAgICAgLy8gYWZ0ZXIgYSBnZW4wIG1vbnN0ZXIgaXMgY3JlYXRlZCBhbmQgYmVmb3JlIGl0IGdvZXMgb24gYXVjdGlvbikuCiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgCgogICAgICAgIC8vIFlvdSBjYW4gb25seSBzZW5kIHlvdXIgb3duIG1vbnN0ZXIuCiAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfdG9rZW5JZCkpOwoKICAgICAgICAvLyBSZWFzc2lnbiBvd25lcnNoaXAsIGNsZWFyIHBlbmRpbmcgYXBwcm92YWxzLCBlbWl0IFRyYW5zZmVyIGV2ZW50LgogICAgICAgIF90cmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCiAgICAKICAgIAoKLy8vIEBub3RpY2UgR3JhbnQgYW5vdGhlciBhZGRyZXNzIHRoZSByaWdodCB0byB0cmFuc2ZlciBhIHNwZWNpZmljIG1vbnN0ZXIgdmlhCiAgICAvLy8gIHRyYW5zZmVyRnJvbSgpLiBUaGlzIGlzIHRoZSBwcmVmZXJyZWQgZmxvdyBmb3IgdHJhbnNmZXJpbmcgTkZUcyB0byBjb250cmFjdHMuCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0byBiZSBncmFudGVkIHRyYW5zZmVyIGFwcHJvdmFsLiBQYXNzIGFkZHJlc3MoMCkgdG8KICAgIC8vLyAgY2xlYXIgYWxsIGFwcHJvdmFscy4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIElEIG9mIHRoZSBtb25zdGVyIHRoYXQgY2FuIGJlIHRyYW5zZmVycmVkIGlmIHRoaXMgY2FsbCBzdWNjZWVkcy4KICAgIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UuCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkICkgZXh0ZXJuYWwgewogICAgICAgIC8vIE9ubHkgYW4gb3duZXIgY2FuIGdyYW50IHRyYW5zZmVyIGFwcHJvdmFsLgogICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX3Rva2VuSWQpKTsKCiAgICAgICAgLy8gUmVnaXN0ZXIgdGhlIGFwcHJvdmFsIChyZXBsYWNpbmcgYW55IHByZXZpb3VzIGFwcHJvdmFsKS4KICAgICAgICBfYXBwcm92ZShfdG9rZW5JZCwgX3RvKTsKCiAgICAgICAgLy8gRW1pdCBhcHByb3ZhbCBldmVudC4KICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUcmFuc2ZlciBhIG1vbnN0ZXIgb3duZWQgYnkgYW5vdGhlciBhZGRyZXNzLCBmb3Igd2hpY2ggdGhlIGNhbGxpbmcgYWRkcmVzcwogICAgLy8vICBoYXMgcHJldmlvdXNseSBiZWVuIGdyYW50ZWQgdHJhbnNmZXIgYXBwcm92YWwgYnkgdGhlIG93bmVyLgogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyB0aGF0IG93bnMgdGhlIG1vbnN0ZXIgdG8gYmUgdHJhbnNmZXJlZC4KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgc2hvdWxkIHRha2Ugb3duZXJzaGlwIG9mIHRoZSBtb25zdGVyLiBDYW4gYmUgYW55IGFkZHJlc3MsCiAgICAvLy8gIGluY2x1ZGluZyB0aGUgY2FsbGVyLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgSUQgb2YgdGhlIG1vbnN0ZXIgdG8gYmUgdHJhbnNmZXJyZWQuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tIChhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCApIGV4dGVybmFsIHsKICAgICAgICAvLyBTYWZldHkgY2hlY2sgdG8gcHJldmVudCBhZ2FpbnN0IGFuIHVuZXhwZWN0ZWQgMHgwIGRlZmF1bHQuCiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgLy8gRGlzYWxsb3cgdHJhbnNmZXJzIHRvIHRoaXMgY29udHJhY3QgdG8gcHJldmVudCBhY2NpZGVudGFsIG1pc3VzZS4KICAgICAgICAvLyBUaGUgY29udHJhY3Qgc2hvdWxkIG5ldmVyIG93biBhbnkgbW9uc3RlcnMgKGV4Y2VwdCB2ZXJ5IGJyaWVmbHkKICAgICAgICAvLyBhZnRlciBhIGdlbjAgbW9uc3RlciBpcyBjcmVhdGVkIGFuZCBiZWZvcmUgaXQgZ29lcyBvbiBhdWN0aW9uKS4KICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKHRoaXMpKTsKICAgICAgICAvLyBDaGVjayBmb3IgYXBwcm92YWwgYW5kIHZhbGlkIG93bmVyc2hpcAogICAgICAgIC8vcmVxdWlyZShfYXBwcm92ZWRGb3IobXNnLnNlbmRlciwgX3Rva2VuSWQpKTsKICAgICAgICByZXF1aXJlKF9vd25zKF9mcm9tLCBfdG9rZW5JZCkpOwoKICAgICAgICAvLyBSZWFzc2lnbiBvd25lcnNoaXAgKGFsc28gY2xlYXJzIHBlbmRpbmcgYXBwcm92YWxzIGFuZCBlbWl0cyBUcmFuc2ZlciBldmVudCkuCiAgICAgICAgX3RyYW5zZmVyKF9mcm9tLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gbW9uc3RlcnMubGVuZ3RoOwogICAgfQoKCiAgICBmdW5jdGlvbiBvd25lck9mKHVpbnQyNTYgX3Rva2VuSWQpCiAgICAgICAgICAgIGV4dGVybmFsCiAgICAgICAgICAgIHZpZXcKICAgICAgICAgICAgcmV0dXJucyAoYWRkcmVzcyBvd25lcikKICAgICAgICB7CiAgICAgICAgICAgIG93bmVyID0gbW9uc3RlckluZGV4VG9Pd25lcltfdG9rZW5JZF07CgogICAgICAgICAgICByZXF1aXJlKG93bmVyICE9IGFkZHJlc3MoMCkpOwogICAgICAgIH0KCiAgICAgZnVuY3Rpb24gdG9rZW5zT2ZPd25lcihhZGRyZXNzIF9vd25lcikgZXh0ZXJuYWwgdmlldyByZXR1cm5zKHVpbnQyNTZbXSBvd25lclRva2VucykgewogICAgICAgIHVpbnQyNTYgdG9rZW5Db3VudCA9IGJhbGFuY2VPZihfb3duZXIpOwoKICAgICAgICBpZiAodG9rZW5Db3VudCA9PSAwKSB7CiAgICAgICAgICAgIC8vIFJldHVybiBhbiBlbXB0eSBhcnJheQogICAgICAgICAgICByZXR1cm4gbmV3IHVpbnQyNTZbXSgwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB1aW50MjU2W10gbWVtb3J5IHJlc3VsdCA9IG5ldyB1aW50MjU2W10odG9rZW5Db3VudCk7CiAgICAgICAgICAgIHVpbnQyNTYgdG90YWxNb25zdGVycyA9IHRvdGFsU3VwcGx5KCk7CiAgICAgICAgICAgIHVpbnQyNTYgcmVzdWx0SW5kZXggPSAwOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIHVpbnQyNTYgbW9uc3RlcklkOwoKICAgICAgICAgICAgZm9yIChtb25zdGVySWQgPSAwOyBtb25zdGVySWQgPD0gdG90YWxNb25zdGVyczsgbW9uc3RlcklkKyspIHsKICAgICAgICAgICAgICAgIGlmIChtb25zdGVySW5kZXhUb093bmVyW21vbnN0ZXJJZF0gPT0gX293bmVyKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0W3Jlc3VsdEluZGV4XSA9IG1vbnN0ZXJJZDsKICAgICAgICAgICAgICAgICAgICByZXN1bHRJbmRleCsrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgIH0KCgogICAKCiAgICAvLy8gQGRldiBBZGFwdGVkIGZyb20gbWVtY3B5KCkgYnkgQGFyYWNobmlkIChOaWNrIEpvaG5zb24gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI0ZjJlM2QyZTJjMjcyMTI2MmIwZjIxMjAzYjJiMjAzYjYxMjEyYTNiIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4pCiAgICAvLy8gIFRoaXMgbWV0aG9kIGlzIGxpY2VuY2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZS4KICAgIC8vLyAgUmVmOiBodHRwczovL2dpdGh1Yi5jb20vQXJhY2huaWQvc29saWRpdHktc3RyaW5ndXRpbHMvYmxvYi8yZjZjYTlhY2NiNDhhZTE0YzY2ZjE0MzdlYzUwZWQxOWEwNjE2Zjc4L3N0cmluZ3Muc29sCiAgICBmdW5jdGlvbiBfbWVtY3B5KHVpbnQgX2Rlc3QsIHVpbnQgX3NyYywgdWludCBfbGVuKSBwcml2YXRlIHZpZXcgewogICAgICAgIC8vIENvcHkgd29yZC1sZW5ndGggY2h1bmtzIHdoaWxlIHBvc3NpYmxlCiAgICAgICAgZm9yKDsgX2xlbiA+PSAzMjsgX2xlbiAtPSAzMikgewogICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICBtc3RvcmUoX2Rlc3QsIG1sb2FkKF9zcmMpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9kZXN0ICs9IDMyOwogICAgICAgICAgICBfc3JjICs9IDMyOwogICAgICAgIH0KCiAgICAgICAgLy8gQ29weSByZW1haW5pbmcgYnl0ZXMKICAgICAgICB1aW50MjU2IG1hc2sgPSAyNTYgKiogKDMyIC0gX2xlbikgLSAxOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgbGV0IHNyY3BhcnQgOj0gYW5kKG1sb2FkKF9zcmMpLCBub3QobWFzaykpCiAgICAgICAgICAgIGxldCBkZXN0cGFydCA6PSBhbmQobWxvYWQoX2Rlc3QpLCBtYXNrKQogICAgICAgICAgICBtc3RvcmUoX2Rlc3QsIG9yKGRlc3RwYXJ0LCBzcmNwYXJ0KSkKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgQWRhcHRlZCBmcm9tIHRvU3RyaW5nKHNsaWNlKSBieSBAYXJhY2huaWQgKE5pY2sgSm9obnNvbiA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjA2Njc3NDY3NjU2ZTY4NmY2MjQ2Njg2OTcyNjI2OTcyMjg2ODYzNzIiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+PikKICAgIC8vLyAgVGhpcyBtZXRob2QgaXMgbGljZW5jZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLgogICAgLy8vICBSZWY6IGh0dHBzOi8vZ2l0aHViLmNvbS9BcmFjaG5pZC9zb2xpZGl0eS1zdHJpbmd1dGlscy9ibG9iLzJmNmNhOWFjY2I0OGFlMTRjNjZmMTQzN2VjNTBlZDE5YTA2MTZmNzgvc3RyaW5ncy5zb2wKICAgIGZ1bmN0aW9uIF90b1N0cmluZyhieXRlczMyWzRdIF9yYXdCeXRlcywgdWludDI1NiBfc3RyaW5nTGVuZ3RoKSBwcml2YXRlIHZpZXcgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgdmFyIG91dHB1dFN0cmluZyA9IG5ldyBzdHJpbmcoX3N0cmluZ0xlbmd0aCk7CiAgICAgICAgdWludDI1NiBvdXRwdXRQdHI7CiAgICAgICAgdWludDI1NiBieXRlc1B0cjsKCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBvdXRwdXRQdHIgOj0gYWRkKG91dHB1dFN0cmluZywgMzIpCiAgICAgICAgICAgIGJ5dGVzUHRyIDo9IF9yYXdCeXRlcwogICAgICAgIH0KCiAgICAgICAgX21lbWNweShvdXRwdXRQdHIsIGJ5dGVzUHRyLCBfc3RyaW5nTGVuZ3RoKTsKCiAgICAgICAgcmV0dXJuIG91dHB1dFN0cmluZzsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIGEgVVJJIHBvaW50aW5nIHRvIGEgbWV0YWRhdGEgcGFja2FnZSBmb3IgdGhpcyB0b2tlbiBjb25mb3JtaW5nIHRvCiAgICAvLy8gIEVSQy03MjEgKGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy83MjEpCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIFRoZSBJRCBudW1iZXIgb2YgdGhlIG1vbnN0ZXIgd2hvc2UgbWV0YWRhdGEgc2hvdWxkIGJlIHJldHVybmVkLgogICAgZnVuY3Rpb24gdG9rZW5NZXRhZGF0YSh1aW50MjU2IF90b2tlbklkLCBzdHJpbmcgX3ByZWZlcnJlZFRyYW5zcG9ydCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChzdHJpbmcgaW5mb1VybCkgewogICAgICAgIHJlcXVpcmUoZXJjNzIxTWV0YWRhdGEgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgYnl0ZXMzMls0XSBtZW1vcnkgYnVmZmVyOwogICAgICAgIHVpbnQyNTYgY291bnQ7CiAgICAgICAgKGJ1ZmZlciwgY291bnQpID0gZXJjNzIxTWV0YWRhdGEuZ2V0TWV0YWRhdGEoX3Rva2VuSWQsIF9wcmVmZXJyZWRUcmFuc3BvcnQpOwoKICAgICAgICByZXR1cm4gX3RvU3RyaW5nKGJ1ZmZlciwgY291bnQpOwogICAgfQoKfQoKY29udHJhY3QgTW9uc3RlckF1Y3Rpb25CYXNlIHsKICAgIAogICAgCiAgICAvLyBSZWZlcmVuY2UgdG8gY29udHJhY3QgdHJhY2tpbmcgTkZUIG93bmVyc2hpcAogICAgRVJDNzIxIHB1YmxpYyBub25GdW5naWJsZUNvbnRyYWN0OwogICAgQ2hhaW5Nb25zdGVyc0NvcmUgcHVibGljIGNvcmU7CiAgICAKICAgIHN0cnVjdCBBdWN0aW9uIHsKCiAgICAgICAgLy8gY3VycmVudCBvd25lcgogICAgICAgIGFkZHJlc3Mgc2VsbGVyOwoKICAgICAgICAvLyBwcmljZSBpbiB3ZWkKICAgICAgICB1aW50MjU2IHByaWNlOwoKICAgICAgICAvLyB0aW1lIHdoZW4gYXVjdGlvbiBzdGFydGVkCiAgICAgICAgdWludDY0IHN0YXJ0ZWRBdDsKCiAgICAgICAgdWludDI1NiBpZDsKICAgIH0KCiAgCgogICAgLy8gQ3V0IG93bmVyIHRha2VzIG9uIGVhY2ggYXVjdGlvbiwgbWVhc3VyZWQgaW4gYmFzaXMgcG9pbnRzICgxLzEwMCBvZiBhIHBlcmNlbnQpLgogICAgLy8gVmFsdWVzIDAtMTAsMDAwIG1hcCB0byAwJS0xMDAlCiAgICB1aW50MjU2IHB1YmxpYyBvd25lckN1dDsKCiAgICAvLyBNYXAgZnJvbSB0b2tlbiBJRCB0byB0aGVpciBjb3JyZXNwb25kaW5nIGF1Y3Rpb24uCiAgICBtYXBwaW5nKHVpbnQyNTYgPT4gQXVjdGlvbikgdG9rZW5JZFRvQXVjdGlvbjsKCiAgICBtYXBwaW5nKHVpbnQyNTYgPT4gYWRkcmVzcykgcHVibGljIGF1Y3Rpb25JZFRvU2VsbGVyOwogICAgCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBvd25lcnNoaXBBdWN0aW9uQ291bnQ7CgoKICAgIGV2ZW50IEF1Y3Rpb25DcmVhdGVkKHVpbnQyNTYgdG9rZW5JZCwgdWludDI1NiBwcmljZSwgdWludDI1NiB1SUQsIGFkZHJlc3Mgc2VsbGVyKTsKICAgIGV2ZW50IEF1Y3Rpb25TdWNjZXNzZnVsKHVpbnQyNTYgdG9rZW5JZCwgdWludDI1NiBwcmljZSwgYWRkcmVzcyBuZXdPd25lciwgdWludDI1NiB1SUQpOwogICAgZXZlbnQgQXVjdGlvbkNhbmNlbGxlZCh1aW50MjU2IHRva2VuSWQsIHVpbnQyNTYgdUlEKTsKCgogICAgZnVuY3Rpb24gX3RyYW5zZmVyKGFkZHJlc3MgX3JlY2VpdmVyLCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gaXQgd2lsbCB0aHJvdyBpZiB0cmFuc2ZlciBmYWlscwogICAgICAgIG5vbkZ1bmdpYmxlQ29udHJhY3QudHJhbnNmZXIoX3JlY2VpdmVyLCBfdG9rZW5JZCk7CiAgICB9CgoKICAgIGZ1bmN0aW9uIF9hZGRBdWN0aW9uKHVpbnQyNTYgX3Rva2VuSWQsIEF1Y3Rpb24gX2F1Y3Rpb24pIGludGVybmFsIHsKICAgICAgICAKICAgICAgICB0b2tlbklkVG9BdWN0aW9uW190b2tlbklkXSA9IF9hdWN0aW9uOwoKICAgICAgICBBdWN0aW9uQ3JlYXRlZCgKICAgICAgICAgICAgdWludDI1NihfdG9rZW5JZCksCiAgICAgICAgICAgIHVpbnQyNTYoX2F1Y3Rpb24ucHJpY2UpLAogICAgICAgICAgICB1aW50MjU2KF9hdWN0aW9uLmlkKSwKICAgICAgICAgICAgYWRkcmVzcyhfYXVjdGlvbi5zZWxsZXIpCiAgICAgICAgKTsKICAgICAgIAogICAgfQoKCiAgICBmdW5jdGlvbiBfY2FuY2VsQXVjdGlvbih1aW50MjU2IF90b2tlbklkLCBhZGRyZXNzIF9zZWxsZXIpIGludGVybmFsIHsKICAgICAgICAKICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgX2F1Y3Rpb24gPSB0b2tlbklkVG9BdWN0aW9uW190b2tlbklkXTsKCiAgICAgICAgdWludDI1NiB1SUQgPSBfYXVjdGlvbi5pZDsKICAgICAgICAKICAgICAgICBfcmVtb3ZlQXVjdGlvbihfdG9rZW5JZCk7CiAgICAgICAgb3duZXJzaGlwQXVjdGlvbkNvdW50W19zZWxsZXJdLS07CiAgICAgICAgX3RyYW5zZmVyKF9zZWxsZXIsIF90b2tlbklkKTsKICAgICAgICAKICAgICAgICBBdWN0aW9uQ2FuY2VsbGVkKF90b2tlbklkLCB1SUQpOwogICAgfQoKCiAgICBmdW5jdGlvbiBfYnV5KHVpbnQyNTYgX3Rva2VuSWQsIHVpbnQyNTYgX2JpZEFtb3VudCkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICAgICAgewogICAgICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdOwogICAgICAgIAoKICAgICAgICByZXF1aXJlKF9pc09uQXVjdGlvbihhdWN0aW9uKSk7CgogICAgICAgIHVpbnQyNTYgcHJpY2UgPSBhdWN0aW9uLnByaWNlOwogICAgICAgIHJlcXVpcmUoX2JpZEFtb3VudCA+PSBwcmljZSk7CgogICAgICAgIGFkZHJlc3Mgc2VsbGVyID0gYXVjdGlvbi5zZWxsZXI7CgogICAgICAgIHVpbnQyNTYgdUlEID0gYXVjdGlvbi5pZDsKICAgICAgICAvLyBBdWN0aW9uIEJpZCBsb29rcyBmaW5lISBzbyByZW1vdmUKICAgICAgICBfcmVtb3ZlQXVjdGlvbihfdG9rZW5JZCk7CiAgICAgICAgb3duZXJzaGlwQXVjdGlvbkNvdW50W3NlbGxlcl0tLTsKCiAgICAgICAgaWYgKHByaWNlID4gMCkgewoKICAgICAgICAgICAgdWludDI1NiBhdWN0aW9uZWVyQ3V0ID0gX2NvbXB1dGVDdXQocHJpY2UpOwogICAgICAgICAgICB1aW50MjU2IHNlbGxlclByb2NlZWRzID0gcHJpY2UgLSBhdWN0aW9uZWVyQ3V0OwoKICAgICAgICAgICAgLy8gTk9URTogRG9pbmcgYSB0cmFuc2ZlcigpIGluIHRoZSBtaWRkbGUgb2YgYSBjb21wbGV4CiAgICAgICAgICAgIC8vIG1ldGhvZCBsaWtlIHRoaXMgaXMgZ2VuZXJhbGx5IGRpc2NvdXJhZ2VkIGJlY2F1c2Ugb2YKICAgICAgICAgICAgLy8gcmVlbnRyYW5jeSBhdHRhY2tzIGFuZCBEb1MgYXR0YWNrcyBpZiB0aGUgc2VsbGVyIGlzCiAgICAgICAgICAgIC8vIGEgY29udHJhY3Qgd2l0aCBhbiBpbnZhbGlkIGZhbGxiYWNrIGZ1bmN0aW9uLiBXZSBleHBsaWNpdGx5CiAgICAgICAgICAgIC8vIGd1YXJkIGFnYWluc3QgcmVlbnRyYW5jeSBhdHRhY2tzIGJ5IHJlbW92aW5nIHRoZSBhdWN0aW9uCiAgICAgICAgICAgIC8vIGJlZm9yZSBjYWxsaW5nIHRyYW5zZmVyKCksIGFuZCB0aGUgb25seSB0aGluZyB0aGUgc2VsbGVyCiAgICAgICAgICAgIC8vIGNhbiBEb1MgaXMgdGhlIHNhbGUgb2YgdGhlaXIgb3duIGFzc2V0ISAoQW5kIGlmIGl0J3MgYW4KICAgICAgICAgICAgLy8gYWNjaWRlbnQsIHRoZXkgY2FuIGNhbGwgY2FuY2VsQXVjdGlvbigpLiApCiAgICAgICAgICAgIGlmKHNlbGxlciAhPSBhZGRyZXNzKGNvcmUpKSB7CiAgICAgICAgICAgICAgICBzZWxsZXIudHJhbnNmZXIoc2VsbGVyUHJvY2VlZHMpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBDYWxjdWxhdGUgYW55IGV4Y2VzcyBmdW5kcyBpbmNsdWRlZCB3aXRoIHRoZSBiaWQuIElmIHRoZSBleGNlc3MKICAgICAgICAvLyBpcyBhbnl0aGluZyB3b3J0aCB3b3JyeWluZyBhYm91dCwgdHJhbnNmZXIgaXQgYmFjayB0byBiaWRkZXIuCiAgICAgICAgLy8gTk9URTogV2UgY2hlY2tlZCBhYm92ZSB0aGF0IHRoZSBiaWQgYW1vdW50IGlzIGdyZWF0ZXIgdGhhbiBvcgogICAgICAgIC8vIGVxdWFsIHRvIHRoZSBwcmljZSBzbyB0aGlzIGNhbm5vdCB1bmRlcmZsb3cuCiAgICAgICAgdWludDI1NiBiaWRFeGNlc3MgPSBfYmlkQW1vdW50IC0gcHJpY2U7CgogICAgICAgIC8vIFJldHVybiB0aGUgZnVuZHMuIFNpbWlsYXIgdG8gdGhlIHByZXZpb3VzIHRyYW5zZmVyLCB0aGlzIGlzCiAgICAgICAgLy8gbm90IHN1c2NlcHRpYmxlIHRvIGEgcmUtZW50cnkgYXR0YWNrIGJlY2F1c2UgdGhlIGF1Y3Rpb24gaXMKICAgICAgICAvLyByZW1vdmVkIGJlZm9yZSBhbnkgdHJhbnNmZXJzIG9jY3VyLgogICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoYmlkRXhjZXNzKTsKCiAgICAgICAgLy8gVGVsbCB0aGUgd29ybGQhCiAgICAgICAgQXVjdGlvblN1Y2Nlc3NmdWwoX3Rva2VuSWQsIHByaWNlLCBtc2cuc2VuZGVyLCB1SUQpOwoKICAgICAgICByZXR1cm4gcHJpY2U7CgoKICAgIH0KCiAgICBmdW5jdGlvbiBfcmVtb3ZlQXVjdGlvbih1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB7CiAgICAgICAgZGVsZXRlIHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdOwogICAgfQoKICAgIGZ1bmN0aW9uIF9pc09uQXVjdGlvbihBdWN0aW9uIHN0b3JhZ2UgX2F1Y3Rpb24pIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAoX2F1Y3Rpb24uc3RhcnRlZEF0ID4gMCk7CiAgICB9CgogICAgIGZ1bmN0aW9uIF9jb21wdXRlQ3V0KHVpbnQyNTYgX3ByaWNlKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICAvLyBOT1RFOiBXZSBkb24ndCB1c2UgU2FmZU1hdGggKG9yIHNpbWlsYXIpIGluIHRoaXMgZnVuY3Rpb24gYmVjYXVzZQogICAgICAgIC8vICBhbGwgb2Ygb3VyIGVudHJ5IGZ1bmN0aW9ucyBjYXJlZnVsbHkgY2FwIHRoZSBtYXhpbXVtIHZhbHVlcyBmb3IKICAgICAgICAvLyAgY3VycmVuY3kgKGF0IDEyOC1iaXRzKSwgYW5kIG93bmVyQ3V0IDw9IDEwMDAwIChzZWUgdGhlIHJlcXVpcmUoKQogICAgICAgIC8vICBzdGF0ZW1lbnQgaW4gdGhlIENsb2NrQXVjdGlvbiBjb25zdHJ1Y3RvcikuIFRoZSByZXN1bHQgb2YgdGhpcwogICAgICAgIC8vICBmdW5jdGlvbiBpcyBhbHdheXMgZ3VhcmFudGVlZCB0byBiZSA8PSBfcHJpY2UuCiAgICAgICAgcmV0dXJuIF9wcmljZSAqIG93bmVyQ3V0IC8gMTAwMDA7CiAgICB9CgogICAgCgp9CgoKY29udHJhY3QgTW9uc3RlckF1Y3Rpb24gaXMgIE1vbnN0ZXJBdWN0aW9uQmFzZSwgT3duYWJsZSB7CgoKICAgIGJvb2wgcHVibGljIGlzTW9uc3RlckF1Y3Rpb24gPSB0cnVlOwogICAgIHVpbnQyNTYgcHVibGljIGF1Y3Rpb25JbmRleCA9IDA7CgogICAgLy8vIEBkZXYgVGhlIEVSQy0xNjUgaW50ZXJmYWNlIHNpZ25hdHVyZSBmb3IgRVJDLTcyMS4KICAgIC8vLyAgUmVmOiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTY1CiAgICAvLy8gIFJlZjogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzcyMQogICAgYnl0ZXM0IGNvbnN0YW50IEludGVyZmFjZVNpZ25hdHVyZV9FUkM3MjEgPSBieXRlczQoMHg5YTIwNDgzZCk7CgogICAgZnVuY3Rpb24gTW9uc3RlckF1Y3Rpb24oYWRkcmVzcyBfbmZ0QWRkcmVzcywgdWludDI1NiBfY3V0KSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoX2N1dCA8PSAxMDAwMCk7CiAgICAgICAgb3duZXJDdXQgPSBfY3V0OwoKICAgICAgICBFUkM3MjEgY2FuZGlkYXRlQ29udHJhY3QgPSBFUkM3MjEoX25mdEFkZHJlc3MpOwogICAgICAgIAogICAgICAgIG5vbkZ1bmdpYmxlQ29udHJhY3QgPSBjYW5kaWRhdGVDb250cmFjdDsKICAgICAgICBDaGFpbk1vbnN0ZXJzQ29yZSBjYW5kaWRhdGVDb3JlQ29udHJhY3QgPSBDaGFpbk1vbnN0ZXJzQ29yZShfbmZ0QWRkcmVzcyk7CiAgICAgICAgY29yZSA9IGNhbmRpZGF0ZUNvcmVDb250cmFjdDsKCiAgICAgICAgCiAgICB9CiAgICAKICAgIC8vIG9ubHkgcG9zc2libGUgdG8gZGVjcmVhc2Ugb3duZXJDdXQhCiAgICBmdW5jdGlvbiBzZXRPd25lckN1dCh1aW50MjU2IF9jdXQpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShfY3V0IDw9IG93bmVyQ3V0KTsKICAgICAgICBvd25lckN1dCA9IF9jdXQ7CiAgICB9CiAgICAKICAgIAogICAgZnVuY3Rpb24gX293bnMoYWRkcmVzcyBfY2xhaW1hbnQsIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAobm9uRnVuZ2libGVDb250cmFjdC5vd25lck9mKF90b2tlbklkKSA9PSBfY2xhaW1hbnQpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBfZXNjcm93KGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gaXQgd2lsbCB0aHJvdyBpZiB0cmFuc2ZlciBmYWlscwogICAgICAgIG5vbkZ1bmdpYmxlQ29udHJhY3QudHJhbnNmZXJGcm9tKF9vd25lciwgdGhpcywgX3Rva2VuSWQpOwogICAgfQoKICAgIGZ1bmN0aW9uIHdpdGhkcmF3QmFsYW5jZSgpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAKICAgICAgIAogICAgICAgdWludDI1NiBiYWxhbmNlID0gdGhpcy5iYWxhbmNlOwogICAgICAgCiAgICAgICAKICAgICAgICBvd25lci50cmFuc2ZlcihiYWxhbmNlKTsKCiAgICAgICAgCiAgICAgICAKICAgIH0KCiAgICAKICAgIGZ1bmN0aW9uIHRva2Vuc0luQXVjdGlvbnNPZk93bmVyKGFkZHJlc3MgX293bmVyKSBleHRlcm5hbCB2aWV3IHJldHVybnModWludDI1NltdIGF1Y3Rpb25Ub2tlbnMpIHsKICAgICAgICAKICAgICAgICAgICB1aW50MjU2IG51bUF1Y3Rpb25zID0gb3duZXJzaGlwQXVjdGlvbkNvdW50W19vd25lcl07CgogICAgICAgICAgICAKICAgICAgICAKICAgICAgICAgICAgdWludDI1NltdIG1lbW9yeSByZXN1bHQgPSBuZXcgdWludDI1NltdKG51bUF1Y3Rpb25zKTsKICAgICAgICAgICAgdWludDI1NiB0b3RhbEF1Y3Rpb25zID0gY29yZS50b3RhbFN1cHBseSgpOwogICAgICAgICAgICB1aW50MjU2IHJlc3VsdEluZGV4ID0gMDsKCiAgICAgICAgICAgIAogICAgICAgICAgICB1aW50MjU2IGF1Y3Rpb25JZDsKCiAgICAgICAgICAgIGZvciAoYXVjdGlvbklkID0gMDsgYXVjdGlvbklkIDw9IHRvdGFsQXVjdGlvbnM7IGF1Y3Rpb25JZCsrKSB7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gdG9rZW5JZFRvQXVjdGlvblthdWN0aW9uSWRdOwogICAgICAgICAgICAgICAgaWYgKGF1Y3Rpb24uc2VsbGVyID09IF9vd25lcikgewogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHJlc3VsdFtyZXN1bHRJbmRleF0gPSBhdWN0aW9uSWQ7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0SW5kZXgrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAKICAgICAgICAKICAgIH0KCgoKCiAgICBmdW5jdGlvbiBjcmVhdGVBdWN0aW9uKHVpbnQyNTYgX3Rva2VuSWQsIHVpbnQyNTYgX3ByaWNlLCBhZGRyZXNzIF9zZWxsZXIpIGV4dGVybmFsIHsKICAgICAgICAgICAgIHJlcXVpcmUoX3ByaWNlID09IHVpbnQyNTYoX3ByaWNlKSk7CiAgICAgICAgICAgIHJlcXVpcmUoY29yZS5faXNUcmFkZWFibGUoX3Rva2VuSWQpKTsKICAgICAgICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX3Rva2VuSWQpKTsKICAgICAgICAgICAgIF9lc2Nyb3cobXNnLnNlbmRlciwgX3Rva2VuSWQpOwoKICAgICAgICAgICAgCgogICAgICAgICAgICAKICAgICAgICAgICAgIEF1Y3Rpb24gbWVtb3J5IGF1Y3Rpb24gPSBBdWN0aW9uKAogICAgICAgICAgICAgICAgIF9zZWxsZXIsCiAgICAgICAgICAgICAgICAgdWludDI1NihfcHJpY2UpLAogICAgICAgICAgICAgICAgIHVpbnQ2NChub3cpLAogICAgICAgICAgICAgICAgIHVpbnQyNTYoYXVjdGlvbkluZGV4KQogICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIGF1Y3Rpb25JZFRvU2VsbGVyW2F1Y3Rpb25JbmRleF0gPSBfc2VsbGVyOwogICAgICAgICAgICBvd25lcnNoaXBBdWN0aW9uQ291bnRbX3NlbGxlcl0rKzsKICAgICAgICAgICAgCiAgICAgICAgICAgICBhdWN0aW9uSW5kZXgrKzsKICAgICAgICAgICAgIF9hZGRBdWN0aW9uKF90b2tlbklkLCBhdWN0aW9uKTsKICAgICAgICB9CgogICAgZnVuY3Rpb24gYnV5KHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsIHBheWFibGUgewogICAgICAgICAgICAvL2RlbGV0ZSBhdWN0aW9uSWRUb1NlbGxlcltfdG9rZW5JZF07CiAgICAgICAgICAgIC8vIGJ1eSB3aWxsIHRocm93IGlmIHRoZSBiaWQgb3IgZnVuZHMgdHJhbnNmZXIgZmFpbHMKICAgICAgICAgICAgX2J1eSAoX3Rva2VuSWQsIG1zZy52YWx1ZSk7CiAgICAgICAgICAgIF90cmFuc2Zlcihtc2cuc2VuZGVyLCBfdG9rZW5JZCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAKICAgICAgICB9CgogICAgCiAgICBmdW5jdGlvbiBjYW5jZWxBdWN0aW9uKHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsIHsKICAgICAgICAgICAgQXVjdGlvbiBzdG9yYWdlIGF1Y3Rpb24gPSB0b2tlbklkVG9BdWN0aW9uW190b2tlbklkXTsKICAgICAgICAgICAgcmVxdWlyZShfaXNPbkF1Y3Rpb24oYXVjdGlvbikpOwoKICAgICAgICAgICAgYWRkcmVzcyBzZWxsZXIgPSBhdWN0aW9uLnNlbGxlcjsKICAgICAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHNlbGxlcik7CiAgICAgICAgICAgIAogICAgICAgICAgICAKICAgICAgICAgICAgX2NhbmNlbEF1Y3Rpb24oX3Rva2VuSWQsIHNlbGxlcik7CiAgICAgICAgfQoKICAgIAogICAgZnVuY3Rpb24gZ2V0QXVjdGlvbih1aW50MjU2IF90b2tlbklkKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMKICAgICAgICAoCiAgICAgICAgICAgIGFkZHJlc3Mgc2VsbGVyLAogICAgICAgICAgICB1aW50MjU2IHByaWNlLAogICAgICAgICAgICB1aW50MjU2IHN0YXJ0ZWRBdAogICAgICAgICkgewogICAgICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdOwogICAgICAgICAgICByZXF1aXJlKF9pc09uQXVjdGlvbihhdWN0aW9uKSk7CgogICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgYXVjdGlvbi5zZWxsZXIsCiAgICAgICAgICAgICAgICBhdWN0aW9uLnByaWNlLAogICAgICAgICAgICAgICAgYXVjdGlvbi5zdGFydGVkQXQKICAgICAgICAgICAgKTsKICAgICAgICB9CgoKICAgIGZ1bmN0aW9uIGdldFByaWNlKHVpbnQyNTYgX3Rva2VuSWQpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgICAgICB7CiAgICAgICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF07CiAgICAgICAgICAgIHJlcXVpcmUoX2lzT25BdWN0aW9uKGF1Y3Rpb24pKTsKICAgICAgICAgICAgcmV0dXJuIGF1Y3Rpb24ucHJpY2U7CiAgICAgICAgfQp9CgoKY29udHJhY3QgQ2hhaW5Nb25zdGVyc0F1Y3Rpb24gaXMgTW9uc3Rlck93bmVyc2hpcCB7CgogIAoKCiAgICBmdW5jdGlvbiBzZXRNb25zdGVyQXVjdGlvbkFkZHJlc3MoYWRkcmVzcyBfYWRkcmVzcykgZXh0ZXJuYWwgb25seUFkbWluIHsKICAgICAgICBNb25zdGVyQXVjdGlvbiBjYW5kaWRhdGVDb250cmFjdCA9IE1vbnN0ZXJBdWN0aW9uKF9hZGRyZXNzKTsKCiAgICAgICAgcmVxdWlyZShjYW5kaWRhdGVDb250cmFjdC5pc01vbnN0ZXJBdWN0aW9uKCkpOwoKICAgICAgICBtb25zdGVyQXVjdGlvbiA9IGNhbmRpZGF0ZUNvbnRyYWN0OwogICAgfQoKCgogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgUFJPTU9fQ1JFQVRJT05fTElNSVQgPSA1MDAwOwoKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IEdFTjBfQ1JFQVRJT05fTElNSVQgPSA1MDAwOwoKICAgIC8vIENvdW50cyB0aGUgbnVtYmVyIG9mIG1vbnN0ZXIgdGhlIGNvbnRyYWN0IG93bmVyIGhhcyBjcmVhdGVkLgogICAgdWludDI1NiBwdWJsaWMgcHJvbW9DcmVhdGVkQ291bnQ7CiAgICB1aW50MjU2IHB1YmxpYyBnZW4wQ3JlYXRlZENvdW50OwoKCiAgICAKICAgIC8vIGl0cyBzdGF0cyBhcmUgY29tcGxldGVseSBkZXBlbmRlbnQgb24gdGhlIHNwYXduIGFsZ2hvcml0aG0KICAgIGZ1bmN0aW9uIGNyZWF0ZVByb21vTW9uc3Rlcih1aW50MjU2IF9tSWQsIGFkZHJlc3MgX293bmVyKSBleHRlcm5hbCBvbmx5QWRtaW4gewogICAgICAgCgogICAgICAgLy8gZHVyaW5nIGdlbmVyYXRpb24gd2UgaGF2ZSB0byBrZWVwIGluIG1pbmQgdGhhdCB3ZSBoYXZlIG9ubHkgMTAsMDAwIHRva2VucyBhdmFpbGFibGUKICAgICAgIC8vIHdoaWNoIGhhdmUgdG8gYmUgZGl2aWRlZCBieSAxNTEgbW9uc3RlcnMsIHNvbWUgcmFyZXIgdGhhbiBvdGhlcnMKICAgICAgIC8vIHNlZSBXaGl0ZVBhcGVyIGZvciBnZW4wL3Byb21vIG1vbnN0ZXIgcGxhbgogICAgICAgIAogICAgICAgIHJlcXVpcmUocHJvbW9DcmVhdGVkQ291bnQgPCBQUk9NT19DUkVBVElPTl9MSU1JVCk7CgogICAgICAgIHByb21vQ3JlYXRlZENvdW50Kys7CiAgICAgICAgdWludDhbOF0gbWVtb3J5IFN0YXRzID0gdWludDhbOF0obW9uc3RlckNyZWF0b3IuZ2V0TW9uc3RlclN0YXRzKHVpbnQyNTYoX21JZCkpKTsKICAgICAgICB1aW50OFs3XSBtZW1vcnkgSVZzID0gdWludDhbN10obW9uc3RlckNyZWF0b3IuZ2V0R2VuMElWcygpKTsKICAgICAgICAKICAgICAgICB1aW50MjU2IG1vbnN0ZXJJZCA9IF9jcmVhdGVNb25zdGVyKDAsIFN0YXRzWzBdLCBTdGF0c1sxXSwgU3RhdHNbMl0sIFN0YXRzWzNdLCBTdGF0c1s0XSwgU3RhdHNbNV0sIFN0YXRzWzZdLCBTdGF0c1s3XSwgX293bmVyLCBfbUlkLCB0cnVlKTsKICAgICAgICBtb25zdGVySWRUb1RyYWRlYWJsZVttb25zdGVySWRdID0gdHJ1ZTsKCiAgICAgICAgbW9uc3RlcklkVG9JVnNbbW9uc3RlcklkXSA9IElWczsKICAgICAgICAKICAgICAgIAogICAgfQoKICAgCgoKICAgIGZ1bmN0aW9uIGNyZWF0ZUdlbjBBdWN0aW9uKHVpbnQyNTYgX21JZCwgdWludDI1NiBwcmljZSkgZXh0ZXJuYWwgb25seUFkbWluIHsKICAgICAgICByZXF1aXJlKGdlbjBDcmVhdGVkQ291bnQgPCBHRU4wX0NSRUFUSU9OX0xJTUlUKTsKCiAgICAgICAgdWludDhbOF0gbWVtb3J5IFN0YXRzID0gdWludDhbOF0obW9uc3RlckNyZWF0b3IuZ2V0TW9uc3RlclN0YXRzKHVpbnQyNTYoX21JZCkpKTsKICAgICAgICB1aW50OFs3XSBtZW1vcnkgSVZzID0gdWludDhbN10obW9uc3RlckNyZWF0b3IuZ2V0R2VuMElWcygpKTsKICAgICAgICB1aW50MjU2IG1vbnN0ZXJJZCA9IF9jcmVhdGVNb25zdGVyKDAsIFN0YXRzWzBdLCBTdGF0c1sxXSwgU3RhdHNbMl0sIFN0YXRzWzNdLCBTdGF0c1s0XSwgU3RhdHNbNV0sIFN0YXRzWzZdLCBTdGF0c1s3XSwgdGhpcywgX21JZCwgdHJ1ZSk7CiAgICAgICAgbW9uc3RlcklkVG9UcmFkZWFibGVbbW9uc3RlcklkXSA9IHRydWU7CgogICAgICAgIG1vbnN0ZXJJZFRvSVZzW21vbnN0ZXJJZF0gPSBJVnM7CgogICAgICAgIG1vbnN0ZXJBdWN0aW9uLmNyZWF0ZUF1Y3Rpb24obW9uc3RlcklkLCBwcmljZSwgYWRkcmVzcyh0aGlzKSk7CgoKICAgICAgICBnZW4wQ3JlYXRlZENvdW50Kys7CiAgICAgICAgCiAgICB9CgogICAgCn0KCgovLyB1c2VkIGR1cmluZyBsYXVuY2ggZm9yIHdvcmxkIGNoYW1waW9uc2hpcAovLyBjYW4gYW5kIHdpbGwgYmUgdXBncmFkZWQgZHVyaW5nIGRldmVsb3BtZW50IHdpdGggbmV3IGJhdHRsZSBzeXN0ZW0hCi8vIHRoaXMgaXMganVzdCB0byBnaXZlIHBsYXllcnMgc29tZXRoaW5nIHRvIGRvIGFuZCB0ZXN0IHRoZWlyIG1vbnN0ZXJzCi8vIGFsc28gZGVtb25zdHJhdGVzIGhvdyB3ZSBjYW4gYnVpbGQgdXAgbW9yZSBtZWNoYW5pY3Mgb24gdG9wIG9mIG91ciBsb2NrZWQgY29yZSBjb250cmFjdCEKY29udHJhY3QgTW9uc3RlckNoYW1waW9uc2hpcCBpcyBPd25hYmxlIHsKCiAgICBib29sIHB1YmxpYyBpc01vbnN0ZXJDaGFtcGlvbnNoaXAgPSB0cnVlOwogICAgCiAgICBDaGFpbk1vbnN0ZXJzQ29yZSBjb3JlOwogICAgCiAgICAvLyBsaXN0IG9mIHRvcCB0ZW4gCiAgICBhZGRyZXNzWzEwXSB0b3BUZW47CgogICAgLy8gaG9sZHMgdGhlIGFkZHJlc3MgY3VycmVudCAid29ybGQiIGNoYW1waW9uCiAgICBhZGRyZXNzIHB1YmxpYyBjdXJyQ2hhbXBpb247CiAgICAKICAgIAogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgYWRkcmVzc1RvUG93ZXJsZXZlbDsKICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gYWRkcmVzcykgcHVibGljIHJhbmtUb0FkZHJlc3M7CiAgICAKCiAgIAogICAgCiAgICAKICAgICAvLyB0cnkgdG8gYmVhdCBldmVyeSBvdGhlciBwbGF5ZXIgaW4gdGhlIHRvcDEwIHdpdGggeW91ciBzdHJvbmdlc3QgbW9uc3RlciEKICAgIC8vIGVmZmVjdGl2ZWx5IGxvb3BpbmcgdGhyb3VnaCBhbGwgdG9wMTAgcGxheWVycywgYmVhdGluZyB0aGVtIG9uZSBieSBvbmUgCiAgICAvLyBhbmQgaWYgc3Ryb25nIGVub3VnaCBwbGFjaW5nIHlvdXIgaW4gdGhlIHRvcDEwIGFzIHdlbGwKICAgIGZ1bmN0aW9uIGNvbnRlc3RDaGFtcGlvbih1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbCB7CiAgICAgICAgICAgIHVpbnQgbWF4SW5kZXggPSA5OwogICAgICAgICAgICAKICAgICAgICAgICAKICAgICAgICAgICAgCiAgICAgICAgICAgCiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBmYWlsIHR4IGlmIHBsYXllciBpcyBhbHJlYWR5IGNoYW1waW9uIQogICAgICAgICAgICAvLyBpbiB0aGVvcnkgcGxheWVycyBjb3VsZCBpbmNyZWFzZSB0aGVpciBwb3dlcmxldmVsIGJ5IGNvbnRlc3RpbmcgdGhlbXNlbHZlcyBidXQKICAgICAgICAgICAgLy8gdGhpcyBjaGVjayBzdG9wcyB0aGF0IGZyb20gaGFwcGVuaW5nIHNvIG90aGVyIHBsYXllcnMgaGF2ZSB0aGUgY2hhbmNlIHRvCiAgICAgICAgICAgIC8vIGJlY29tZSB0aGUgdGVtcG9yYXJ5IGNoYW1waW9uIQogICAgICAgICAgICBpZiAoY3VyckNoYW1waW9uID09IG1zZy5zZW5kZXIpCiAgICAgICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAKICAgICAgICAgICByZXF1aXJlKGNvcmUuaXNUcmFpbmVyKG1zZy5zZW5kZXIpKTsgICAgICAgIAogICAgICAgICAgIHJlcXVpcmUoY29yZS5tb25zdGVySW5kZXhUb093bmVyKF90b2tlbklkKSA9PSBtc2cuc2VuZGVyKTsKICAgICAgICAgICAgCiAgICAgICAgICAgCiAgICAgICAgICAgdWludCBteVBvd2VybGV2ZWwgPSBjb3JlLmdldE1vbnN0ZXJQb3dlckxldmVsKF90b2tlbklkKTsKCiAgICAgICAgICAgCiAgICAgICAgICAgLy8gY2hlY2tzIGlmIHRoaXMgdHJhbnNhY3Rpb24gaXMgdXNlbGVzcwogICAgICAgICAgIC8vIHNpbmNlIHdlIGNhbid0IGZpZ2h0IGFnYWluc3Qgb3Vyc2VsZiEKICAgICAgICAgICAvLyBhbHNvIHN0b3BzIHJlZW50cmFuY3kgYXR0YWNrcwogICAgICAgICAgIHJlcXVpcmUobXlQb3dlcmxldmVsID4gYWRkcmVzc1RvUG93ZXJsZXZlbFttc2cuc2VuZGVyXSk7CiAgICAgICAgICAgCiAgICAgICAgICAKICAgICAgICAgICB1aW50IG15UmFuayA9IDA7CiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IgKHVpbnQgaT0wOyBpPD1tYXhJbmRleDsgaSsrKSB7CiAgICAgICAgICAgICAgICAvL2lmIChhZGRyZXMpCiAgICAgICAgICAgICAgICBpZiAoIG15UG93ZXJsZXZlbCA+IGFkZHJlc3NUb1Bvd2VybGV2ZWxbdG9wVGVuW2ldXSApIHsKICAgICAgICAgICAgICAgICAgICAvLyB5b3UgaGF2ZSBiZWF0ZW4gdGhpcyBvbmUgc28gaW5jcmVhc2UgdGVtcG9yYXJ5IHJhbmsKICAgICAgICAgICAgICAgICAgICBteVJhbmsgPSBpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIChteVJhbmsgPT0gbWF4SW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3VyckNoYW1waW9uID0gbXNnLnNlbmRlcjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgIAogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBhZGRyZXNzVG9Qb3dlcmxldmVsW21zZy5zZW5kZXJdID0gbXlQb3dlcmxldmVsOwogICAgICAgICAgICAKICAgICAgICAgICAgYWRkcmVzc1sxMF0gc3RvcmFnZSBuZXdUb3BUZW4gPSB0b3BUZW47CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoY3VyckNoYW1waW9uID09IG1zZy5zZW5kZXIpIHsKICAgICAgICAgICAgICAgIGZvciAodWludCBqPTA7IGo8bWF4SW5kZXg7IGorKykgewogICAgICAgICAgICAgICAgICAgIC8vIHJlbW92ZSBvdXJzZWx2ZXMgZnJvbSB0aGlzIGxpc3QgaW4gY2FzZSAKICAgICAgICAgICAgICAgICAgICBpZiAobmV3VG9wVGVuW2pdID09IG1zZy5zZW5kZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmV3VG9wVGVuW2pdID0gMHgwOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IgKHVpbnQgeD0wOyB4PD1teVJhbms7IHgrKykgewogICAgICAgICAgICAgICAgaWYgKHggPT0gbXlSYW5rKSB7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBuZXdUb3BUZW5beF0gPSBtc2cuc2VuZGVyOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAoeCA8IG1heEluZGV4KQogICAgICAgICAgICAgICAgICAgICAgICBuZXdUb3BUZW5beF0gPSB0b3BUZW5beCsxXTsgICAgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAKICAgICAgICAgICAgdG9wVGVuID0gbmV3VG9wVGVuOwogICAgICAgICAgICAKICAgICAgICB9CiAgICAKICAgIAogICAgCiAgICBmdW5jdGlvbiBnZXRUb3BQbGF5ZXJzKCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zICgKICAgICAgICAgICAgYWRkcmVzc1sxMF0gcGxheWVycwogICAgICAgICkgewogICAgICAgICAgICBwbGF5ZXJzID0gdG9wVGVuOwogICAgICAgIH0KICAgIAoKCgogICAgCiAgICAKICAgIAogICAgCiAgICBmdW5jdGlvbiBNb25zdGVyQ2hhbXBpb25zaGlwKGFkZHJlc3MgY29yZUNvbnRyYWN0KSBwdWJsaWMgewogICAgICAgY29yZSA9IENoYWluTW9uc3RlcnNDb3JlKGNvcmVDb250cmFjdCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHdpdGhkcmF3QmFsYW5jZSgpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAKICAgICAgICB1aW50MjU2IGJhbGFuY2UgPSB0aGlzLmJhbGFuY2U7CiAgICAgICAKICAgICAgIAogICAgICAgIG93bmVyLnRyYW5zZmVyKGJhbGFuY2UpOwogICAgICAgIAogICAgfQoKCgoKfQoKCi8vIHdoZXJlIHRoZSBub3Qtc28tbXVjaCAiaGlkZGVuIiBtYWdpYyBoYXBwZW5zCmNvbnRyYWN0IE1vbnN0ZXJDcmVhdG9ySW50ZXJmYWNlIGlzIE93bmFibGUgewoKICAgIHVpbnQ4IHB1YmxpYyBsb2NrZWRNb25zdGVyU3RhdHNDb3VudCA9IDA7CiAgICB1aW50IG5vbmNlID0gMDsKCiAgICBmdW5jdGlvbiByYW5kKHVpbnQ4IG1pbiwgdWludDggbWF4KSBwdWJsaWMgcmV0dXJucyAodWludDgpIHsKICAgICAgICBub25jZSsrOwogICAgICAgIHVpbnQ4IHJlc3VsdCA9ICh1aW50OChzaGEzKGJsb2NrLmJsb2NraGFzaChibG9jay5udW1iZXItMSksIG5vbmNlICkpJW1heCk7CiAgICAgICAgCiAgICAgICAgaWYgKHJlc3VsdCA8IG1pbikKICAgICAgICB7CiAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdCttaW47CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAKICAgIAoKCiAgICBmdW5jdGlvbiBzaGlueVJhbmQodWludDE2IG1pbiwgdWludDE2IG1heCkgcHVibGljIHJldHVybnMgKHVpbnQxNikgewogICAgICAgIG5vbmNlKys7CiAgICAgICAgdWludDE2IHJlc3VsdCA9ICh1aW50MTYoc2hhMyhibG9jay5ibG9ja2hhc2goYmxvY2subnVtYmVyLTEpLCBub25jZSApKSVtYXgpOwogICAgICAgIAogICAgICAgIGlmIChyZXN1bHQgPCBtaW4pCiAgICAgICAgewogICAgICAgICAgICByZXN1bHQgPSByZXN1bHQrbWluOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgCiAgICAKICAgIAogICAgbWFwcGluZyh1aW50MjU2ID0+IHVpbnQ4WzhdKSBwdWJsaWMgYmFzZVN0YXRzOwoKICAgIGZ1bmN0aW9uIGFkZEJhc2VTdGF0cyh1aW50MjU2IF9tSWQsIHVpbnQ4WzhdIGRhdGEpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgLy8gbG9jayIgdGhlIHN0YXRzIGRvd24gZm9yZXZlcgogICAgICAgIC8vIHNpbmNlIGhwIGlzIG5ldmVyIGdvaW5nIHRvIGJlIDAgdGhpcyBpcyBhIHZhbGlkIGNoZWNrCiAgICAgICAgLy8gc28gd2UgaGF2ZSB0byBiZSBleHRyYSBjYXJlZnVsIHdoZW4gYWRkaW5nIG5ldyBiYXNlU3RhdHMhCiAgICAgICAgcmVxdWlyZShkYXRhWzBdID4gMCk7CiAgICAgICAgcmVxdWlyZShiYXNlU3RhdHNbX21JZF1bMF0gPT0gMCk7CiAgICAgICAgYmFzZVN0YXRzW19tSWRdID0gZGF0YTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gX2FkZEJhc2VTdGF0cyh1aW50MjU2IF9tSWQsIHVpbnQ4WzhdIGRhdGEpIGludGVybmFsIHsKICAgICAgICAKICAgICAgICAKICAgICAgICBiYXNlU3RhdHNbX21JZF0gPSBkYXRhOwogICAgICAgIGxvY2tlZE1vbnN0ZXJTdGF0c0NvdW50Kys7CiAgICB9CgoKICAgIAoKCiAgICAKICAgIGZ1bmN0aW9uIE1vbnN0ZXJDcmVhdG9ySW50ZXJmYWNlKCkgcHVibGljIHsKICAgICAgICAKICAgICAgIC8vIHRoZXNlIG1vbnN0ZXJzIGFyZSBhbHJlYWR5IGRvd24gYW5kICJsb2NrZWQiIGRvd24gc3RhdHMvZGVzaWduIHdpc2UKICAgICAgICBfYWRkQmFzZVN0YXRzKDEsIFs0NSwgNDksIDQ5LCA2NSwgNjUsIDQ1LCAxMiwgNF0pOwogICAgICAgIF9hZGRCYXNlU3RhdHMoMiwgWzYwLCA2MiwgNjMsIDgwLCA4MCwgNjAsIDEyLCA0XSk7CiAgICAgICAgX2FkZEJhc2VTdGF0cygzLCBbODAsIDgyLCA4MywgMTAwLCAxMDAsIDgwLCAxMiwgNF0pOwogICAgICAgIF9hZGRCYXNlU3RhdHMoNCwgWzM5LCA1MiwgNDMsIDYwLCA1MCwgNjUsIDEwLCA2XSk7CiAgICAgICAgX2FkZEJhc2VTdGF0cyg1LCBbNTgsIDY0LCA1OCwgODAsIDY1LCA4MCwgMTAsIDZdKTsKICAgICAgICBfYWRkQmFzZVN0YXRzKDYsIFs3OCwgODQsIDc4LCAxMDksIDg1LCAxMDAsIDEwLCA2XSk7CiAgICAgICAgX2FkZEJhc2VTdGF0cyg3LCBbNDQsIDQ4LCA2NSwgNTAsIDY0LCA0MywgMTEsIDE0XSk7CiAgICAgICAgX2FkZEJhc2VTdGF0cyg4LCBbNTksIDYzLCA4MCwgNjUsIDgwLCA1OCwgMTEsIDE0XSk7CiAgICAgICAgX2FkZEJhc2VTdGF0cyg5LCBbNzksIDgzLCAxMDAsIDg1LCAxMDUsIDc4LCAxMSwgMTRdKTsKICAgICAgICBfYWRkQmFzZVN0YXRzKDEwLCBbNDAsIDM1LCAzMCwgMjAsIDIwLCA1MCwgNywgNF0pOwogICAgICAgIAogICAgICAgIF9hZGRCYXNlU3RhdHMoMTQ5LCBbNTUsIDUwLCA0NSwgMTM1LCA5NSwgMTIwLCA4LCAxNF0pOwogICAgICAgIF9hZGRCYXNlU3RhdHMoMTUwLCBbOTEsIDEzNCwgOTUsIDEwMCwgMTAwLCA4MCwgMiwgNV0pOwogICAgICAgIF9hZGRCYXNlU3RhdHMoMTUxLCBbMTAwLCAxMDAsIDEwMCwgMTAwLCAxMDAsIDEwMCwgNSwgMTldKTsKICAgIH0KICAgIAogICAgLy8gdGhpcyBzZXJ2ZXMgYXMgYSBsb29rdXAgZm9yIG5ldyBtb25zdGVycyB0byBiZSBnZW5lcmF0ZWQgc2luY2UgYWxsIG1vbnN0ZXJzIAogICAgLy8gb2YgdGhlIHNhbWUgaWQgc2hhcmUgdGhlIGJhc2Ugc3RhdHMKICAgIGZ1bmN0aW9uIGdldE1vbnN0ZXJTdGF0cyggdWludDI1NiBfbUlEKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zKHVpbnQ4WzhdIHN0YXRzKSB7CiAgICAgICAgICAgc3RhdHNbMF0gPSBiYXNlU3RhdHNbX21JRF1bMF07CiAgICAgICAgICAgc3RhdHNbMV0gPSBiYXNlU3RhdHNbX21JRF1bMV07CiAgICAgICAgICAgc3RhdHNbMl0gPSBiYXNlU3RhdHNbX21JRF1bMl07CiAgICAgICAgICAgc3RhdHNbM10gPSBiYXNlU3RhdHNbX21JRF1bM107CiAgICAgICAgICAgc3RhdHNbNF0gPSBiYXNlU3RhdHNbX21JRF1bNF07CiAgICAgICAgICAgc3RhdHNbNV0gPSBiYXNlU3RhdHNbX21JRF1bNV07CiAgICAgICAgICAgc3RhdHNbNl0gPSBiYXNlU3RhdHNbX21JRF1bNl07CiAgICAgICAgICAgc3RhdHNbN10gPSBiYXNlU3RhdHNbX21JRF1bN107CiAgICAgICAgICAgCiAgICAgICAgICAKCiAgICAgICAgfQoKICAgICAgICAvLyBnZW5lcmF0ZXMgcmFuZG9taXplZCBJVnMgZm9yIGEgbmV3IG1vbnN0ZXIKICAgICAgICBmdW5jdGlvbiBnZXRNb25zdGVySVZzKCkgZXh0ZXJuYWwgcmV0dXJucyh1aW50OFs3XSBpdnMpIHsKCiAgICAgICAgICAgIGJvb2wgc2hpbnkgPSBmYWxzZTsKCiAgICAgICAgICAgIHVpbnQxNiBjaGFuY2UgPSBzaGlueVJhbmQoMSwgODE5Mik7CgogICAgICAgICAgICBpZiAoY2hhbmNlID09IDQyKSB7CiAgICAgICAgICAgICAgICBzaGlueSA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIElWcyByYW5nZSBiZXR3ZWVuIDAgYW5kIDMxCiAgICAgICAgICAgIC8vIHN0YXQgcmFuZ2UgbW9kaWZpZWQgZm9yIHNoaW55IG1vbnN0ZXJzIQogICAgICAgICAgICBpZiAoc2hpbnkgPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgaXZzWzBdID0gdWludDgocmFuZCgxMCwgMzEpKTsKICAgICAgICAgICAgICAgIGl2c1sxXSA9IHVpbnQ4KHJhbmQoMTAsIDMxKSk7CiAgICAgICAgICAgICAgICBpdnNbMl0gPSB1aW50OChyYW5kKDEwLCAzMSkpOwogICAgICAgICAgICAgICAgaXZzWzNdID0gdWludDgocmFuZCgxMCwgMzEpKTsKICAgICAgICAgICAgICAgIGl2c1s0XSA9IHVpbnQ4KHJhbmQoMTAsIDMxKSk7CiAgICAgICAgICAgICAgICBpdnNbNV0gPSB1aW50OChyYW5kKDEwLCAzMSkpOwogICAgICAgICAgICAgICAgaXZzWzZdID0gMTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaXZzWzBdID0gdWludDgocmFuZCgwLCAzMSkpOwogICAgICAgICAgICAgICAgaXZzWzFdID0gdWludDgocmFuZCgwLCAzMSkpOwogICAgICAgICAgICAgICAgaXZzWzJdID0gdWludDgocmFuZCgwLCAzMSkpOwogICAgICAgICAgICAgICAgaXZzWzNdID0gdWludDgocmFuZCgwLCAzMSkpOwogICAgICAgICAgICAgICAgaXZzWzRdID0gdWludDgocmFuZCgwLCAzMSkpOwogICAgICAgICAgICAgICAgaXZzWzVdID0gdWludDgocmFuZCgwLCAzMSkpOwogICAgICAgICAgICAgICAgaXZzWzZdID0gMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgCgogICAgICAgIH0KCgogICAgICAgIC8vIGdlbjAgbW9uc3RlcnMgcHJvZml0IGZyb20gc2hpbnkgYm9vc3Qgd2hpbGUgc2hpbnkgZ2VuMHMgaGF2ZSBwb3RlbnRpYWxseSBldmVuIGhpZ2hlciBJVnMhCiAgICAgICAgLy8gZnVydGhlciBpbmNyZWFzaW5nIHRoZSByYXJpdHkgYnkgYWxzbyBkb3VibGluZyB0aGUgc2hpbnkgY2hhbmNlIQogICAgICAgIGZ1bmN0aW9uIGdldEdlbjBJVnMoKSBleHRlcm5hbCByZXR1cm5zICh1aW50OFs3XSBpdnMpIHsKICAgICAgICAgICAgCiAgICAgICAgICAgIGJvb2wgc2hpbnkgPSBmYWxzZTsKCiAgICAgICAgICAgIHVpbnQxNiBjaGFuY2UgPSBzaGlueVJhbmQoMSwgNDA5Nik7CgogICAgICAgICAgICBpZiAoY2hhbmNlID09IDQyKSB7CiAgICAgICAgICAgICAgICBzaGlueSA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChzaGlueSkgewogICAgICAgICAgICAgICAgIGl2c1swXSA9IHVpbnQ4KHJhbmQoMTUsIDMxKSk7CiAgICAgICAgICAgICAgICBpdnNbMV0gPSB1aW50OChyYW5kKDE1LCAzMSkpOwogICAgICAgICAgICAgICAgaXZzWzJdID0gdWludDgocmFuZCgxNSwgMzEpKTsKICAgICAgICAgICAgICAgIGl2c1szXSA9IHVpbnQ4KHJhbmQoMTUsIDMxKSk7CiAgICAgICAgICAgICAgICBpdnNbNF0gPSB1aW50OChyYW5kKDE1LCAzMSkpOwogICAgICAgICAgICAgICAgaXZzWzVdID0gdWludDgocmFuZCgxNSwgMzEpKTsKICAgICAgICAgICAgICAgIGl2c1s2XSA9IDE7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGl2c1swXSA9IHVpbnQ4KHJhbmQoMTAsIDMxKSk7CiAgICAgICAgICAgICAgICBpdnNbMV0gPSB1aW50OChyYW5kKDEwLCAzMSkpOwogICAgICAgICAgICAgICAgaXZzWzJdID0gdWludDgocmFuZCgxMCwgMzEpKTsKICAgICAgICAgICAgICAgIGl2c1szXSA9IHVpbnQ4KHJhbmQoMTAsIDMxKSk7CiAgICAgICAgICAgICAgICBpdnNbNF0gPSB1aW50OChyYW5kKDEwLCAzMSkpOwogICAgICAgICAgICAgICAgaXZzWzVdID0gdWludDgocmFuZCgxMCwgMzEpKTsKICAgICAgICAgICAgICAgIGl2c1s2XSA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgfQogICAgICAgIAogICAgICAgIGZ1bmN0aW9uIHdpdGhkcmF3QmFsYW5jZSgpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAKICAgICAgICB1aW50MjU2IGJhbGFuY2UgPSB0aGlzLmJhbGFuY2U7CiAgICAgICAKICAgICAgIAogICAgICAgIG93bmVyLnRyYW5zZmVyKGJhbGFuY2UpOwogICAgICAgIAogICAgfQp9Cgpjb250cmFjdCBHYW1lTG9naWNDb250cmFjdCB7CiAgICAKICAgIGJvb2wgcHVibGljIGlzR2FtZUxvZ2ljQ29udHJhY3QgPSB0cnVlOwogICAgCiAgICBmdW5jdGlvbiBHYW1lTG9naWNDb250cmFjdCgpIHB1YmxpYyB7CiAgICAgICAgCiAgICB9Cn0KCmNvbnRyYWN0IENoYWluTW9uc3RlcnNDb3JlIGlzIENoYWluTW9uc3RlcnNBdWN0aW9uLCBPd25hYmxlIHsKCgogICAvLyB1c2luZyBhIGJvb2wgdG8gZW5hYmxlIHVzIHRvIHByZXBhcmUgdGhlIGdhbWUgCiAgIGJvb2wgaGFzTGF1bmNoZWQgPSBmYWxzZTsKCgogICAgLy8gdGhpcyBhZGRyZXNzIHdpbGwgaG9sZCBmdXR1cmUgZ2FtZWxvZ2ljIGluIHBsYWNlCiAgICBhZGRyZXNzIGdhbWVDb250cmFjdDsKICAgIAoKICAgIGZ1bmN0aW9uIENoYWluTW9uc3RlcnNDb3JlKCkgcHVibGljIHsKCiAgICAgICAgYWRtaW5BZGRyZXNzID0gbXNnLnNlbmRlcjsKICAgICAgICAKCiAgICAgICAgX2NyZWF0ZUFyZWEoKTsgLy8gYXJlYSAxCiAgICAgICAgX2NyZWF0ZUFyZWEoKTsgLy8gYXJlYSAyCiAgICAgICAgCiAgICAKCiAgICAgICAgCiAgICB9CiAgICAKICAgIC8vIHdlIGRvbid0IGtub3cgdGhlIGV4YWN0IGludGVyZmFjZXMgeWV0IHNvIHVzZSB0aGUgbG9ja2VkTW9uc3RlclN0YXRzIHZhbHVlIHRvIGRldGVybWluZSBpZiB0aGUgZ2FtZSBpcyAicmVhZHkiCiAgICAvLyBzZWUgV2hpdGVQYXBlciBmb3IgZXhwbGFpbmF0aW9uIGZvciBvdXIgdXBncmFkZSBhbmQgZGV2ZWxvcG1lbnQgcm9hZG1hcAogICAgZnVuY3Rpb24gc2V0R2FtZUxvZ2ljQ29udHJhY3QoYWRkcmVzcyBfY2FuZGlkYXRlQ29udHJhY3QpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShtb25zdGVyQ3JlYXRvci5sb2NrZWRNb25zdGVyU3RhdHNDb3VudCgpID09IDE1MSk7CiAgICAgICAgCiAgICAgICAgcmVxdWlyZShHYW1lTG9naWNDb250cmFjdChfY2FuZGlkYXRlQ29udHJhY3QpLmlzR2FtZUxvZ2ljQ29udHJhY3QoKSk7CiAgICAgICAgZ2FtZUNvbnRyYWN0ID0gX2NhbmRpZGF0ZUNvbnRyYWN0OwogICAgfQoKICAgIC8vIG9ubHkgY2FsbGFibGUgYnkgZ2FtZUNvbnRyYWN0IGFmdGVyIHRoZSBmdWxsIGdhbWUgaXMgbGF1bmNoZWQKICAgIC8vIHNpbmNlIGFsbCBhZGRpdGlvbmFsIG1vbnN0ZXJzIGFmdGVyIHRoZSBwcm9tby9nZW4wIG9uZXMgbmVlZCB0byB1c2UgdGhpcyBjb3JlQ29udHJhY3QKICAgIC8vIGNvbnRyYWN0IGFzIHdlbGwgd2UgaGF2ZSB0byBwcmVwYXJlIHRoaXMgY29yZSBmb3Igb3VyIGZ1dHVyZSB1cGRhdGVzIHdoZXJlCiAgICAvLyBwbGF5ZXJzIGNhbiBmcmVlbHkgcm9hbSB0aGUgd29ybGQgYW5kIGh1bnQgQ2hhaW5Nb25zdGVycyB0aHVzIGdlbmVyYXRpbmcgbW9yZQogICAgZnVuY3Rpb24gc3Bhd25Nb25zdGVyKHVpbnQyNTYgX21JZCwgYWRkcmVzcyBfb3duZXIpIGV4dGVybmFsIHsKICAgICAgICAgCiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGdhbWVDb250cmFjdCk7CiAgICAgICAgCiAgICAgICAgdWludDhbOF0gbWVtb3J5IFN0YXRzID0gdWludDhbOF0obW9uc3RlckNyZWF0b3IuZ2V0TW9uc3RlclN0YXRzKHVpbnQyNTYoX21JZCkpKTsKICAgICAgICB1aW50OFs3XSBtZW1vcnkgSVZzID0gdWludDhbN10obW9uc3RlckNyZWF0b3IuZ2V0TW9uc3RlcklWcygpKTsKICAgICAgICAKICAgICAgICAvLyBpbXBvcnRhbnQgdG8gbm90ZSB0aGF0IHRoZSBJViBnZW5lcmF0b3JzIGRvIG5vdCB1c2UgR2VuMCBtZXRob2RzIGFuZCBhcmUgR2VuZXJhdGlvbiAxIAogICAgICAgIC8vIHRoaXMgbWVhbnMgdGhlcmUgd29uJ3QgYmUgbW9yZSB0aGFuIHRoZSAxMCwwMDAgR2VuMCBtb25zdGVycyBzb2xkIGR1cmluZyB0aGUgZGV2ZWxvcG1lbnQgdGhyb3VnaCB0aGUgbWFya2V0cGxhY2UKICAgICAgICB1aW50MjU2IG1vbnN0ZXJJZCA9IF9jcmVhdGVNb25zdGVyKDEsIFN0YXRzWzBdLCBTdGF0c1sxXSwgU3RhdHNbMl0sIFN0YXRzWzNdLCBTdGF0c1s0XSwgU3RhdHNbNV0sIFN0YXRzWzZdLCBTdGF0c1s3XSwgX293bmVyLCBfbUlkLCB0cnVlKTsKICAgICAgICBtb25zdGVySWRUb1RyYWRlYWJsZVttb25zdGVySWRdID0gdHJ1ZTsKCiAgICAgICAgbW9uc3RlcklkVG9JVnNbbW9uc3RlcklkXSA9IElWczsKICAgIH0KICAgIAogICAgCiAgICAvLyB1c2VkIHRvIGFkZCBwbGF5YWJsZSBjb250ZW50IHRvIHRoZSBnYW1lIAogICAgLy8gbW9uc3RlcnMgd2lsbCBvbmx5IHNwYXduIGluIGNlcnRhaW4gYXJlYXMgc28gc29tZSBhcmUgbG9ja2VkIG9uIHJlbGVhc2UKICAgIC8vIGR1ZSB0byB0aGUgZ2FtZSBiZWluZyBpbiBhY3RpdmUgZGV2ZWxvcG1lbnQgb24gImxhdW5jaCIKICAgIC8vIGVhY2ggbW9uc3RlciBoYXMgYSBtYXhpbXVtIG51bWJlciBvZiAzIGFyZWFzIHdoZXJlIGl0IGNhbiBhcHBlYXIKICAgIC8vIAogICAgIGZ1bmN0aW9uIGNyZWF0ZUFyZWEoKSBwdWJsaWMgb25seUFkbWluIHsKICAgICAgICAgICAgX2NyZWF0ZUFyZWEoKTsKICAgICAgICB9CgogICAgZnVuY3Rpb24gY3JlYXRlVHJhaW5lcihzdHJpbmcgX3VzZXJuYW1lLCB1aW50MTYgX3N0YXJ0ZXJJZCkgcHVibGljIHsKICAgICAgICAgICAgCiAgICAgICAgICAgIHJlcXVpcmUoaGFzTGF1bmNoZWQpOwoKICAgICAgICAgICAgLy8gb25seSBvbmUgdHJhaW5lci9hY2NvdW50IHBlciBldGhlcmV1bSBhZGRyZXNzCiAgICAgICAgICAgIHJlcXVpcmUoYWRkcmVzc1RvVHJhaW5lclttc2cuc2VuZGVyXS5vd25lciA9PSAwKTsKICAgICAgICAgICAKICAgICAgICAgICAvLyB2YWxpZCBpbnB1dCBjaGVjawogICAgICAgICAgICByZXF1aXJlKF9zdGFydGVySWQgPT0gMSB8fCBfc3RhcnRlcklkID09IDIgfHwgX3N0YXJ0ZXJJZCA9PSAzICk7CiAgICAgICAgICAgIAogICAgICAgICAgICB1aW50MjU2IG1vbiA9IF9jcmVhdGVUcmFpbmVyKF91c2VybmFtZSwgX3N0YXJ0ZXJJZCwgbXNnLnNlbmRlcik7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBkdWUgdG8gc3RhY2sgbGltaXRhdGlvbnMgd2UgaGF2ZSB0byBhc3NpZ24gdGhlIElWcyBoZXJlOgogICAgICAgICAgICB1aW50OFs3XSBtZW1vcnkgSVZzID0gdWludDhbN10obW9uc3RlckNyZWF0b3IuZ2V0TW9uc3RlcklWcygpKTsKICAgICAgICAgICAgbW9uc3RlcklkVG9JVnNbbW9uXSA9IElWczsKICAgICAgICAgICAgCiAgICAgICAgfQogICAgICAgIAogICAgICAgIAogICAgZnVuY3Rpb24gY2hhbmdlVXNlcm5hbWUoc3RyaW5nIF9uYW1lKSBwdWJsaWMgewogICAgICAgICAgICByZXF1aXJlKGFkZHJlc3NUb1RyYWluZXJbbXNnLnNlbmRlcl0ub3duZXIgPT0gbXNnLnNlbmRlcik7CiAgICAgICAgICAgIAogICAgICAgICAgICAKICAgICAgICAgICAgYWRkcmVzc1RvVHJhaW5lclttc2cuc2VuZGVyXS51c2VybmFtZSA9IF9uYW1lOwogICAgICAgIH0KICAgICAgICAKICAgIGZ1bmN0aW9uIGNoYW5nZU1vbnN0ZXJOaWNrbmFtZSh1aW50MjU2IF90b2tlbklkLCBzdHJpbmcgX25hbWUpIHB1YmxpYyB7CiAgICAgICAgICAgIC8vIHVzZXJzIHdvbid0IGJlIGFibGUgdG8gcmVuYW1lIGEgbW9uc3RlciB0aGF0IGlzIHBhcnQgb2YgYW4gYXVjdGlvbgogICAgICAgICAgICByZXF1aXJlKF9vd25zKG1zZy5zZW5kZXIsIF90b2tlbklkKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAKICAgICAgICAgICAgLy8gc29tZSBzdHJpbmcgY2hlY2tzLi4uPwogICAgICAgICAgICBtb25zdGVySWRUb05pY2tuYW1lW190b2tlbklkXSA9IF9uYW1lOwogICAgICAgIH0KCiAgICBmdW5jdGlvbiBtb3ZlVG9BcmVhKHVpbnQxNiBfbmV3QXJlYSkgcHVibGljIHsKICAgICAgICAgICAKICAgICAgICAgICAgLy8gbmV2ZXIgYWxsb3cgYW55b25lIHRvIG1vdmUgdG8gYXJlYSAwIG9yIGJlbG93IHNpbmNlIHRoaXMgaXMgdXNlZAogICAgICAgICAgICAvLyB0byBkZXRlcm1pbmUgaWYgYSB0cmFpbmVyIHByb2ZpbGUgZXhpc3RzIGluIGFub3RoZXIgbWV0aG9kIQogICAgICAgICAgICByZXF1aXJlKF9uZXdBcmVhID4gMCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBtYWtlIHN1cmUgdGhhdCB0aGlzIGFyZWEgZXhpc3RzIHlldCEKICAgICAgICAgICAgcmVxdWlyZShhcmVhcy5sZW5ndGggPj0gX25ld0FyZWEpOwogICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIHdoZW4gcGxheWVyIGlzIG5vdCBzdHVjayBkb2luZyBzb21ldGhpbmcgZWxzZSBoZSBjYW4gbW92ZSBmcmVlbHkhCiAgICAgICAgICAgIF9tb3ZlVG9BcmVhKF9uZXdBcmVhLCBtc2cuc2VuZGVyKTsKICAgICAgICB9CgogICAgCiAgICAvLyB0byBiZSBjaGFuZ2VkIHRvIHJldHJpZXZlIGN1cnJlbnQgc3RhdHMhCiAgICBmdW5jdGlvbiBnZXRNb25zdGVyKHVpbnQyNTYgX2lkKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKAogICAgICAgIHVpbnQyNTYgYmlydGhUaW1lLAogICAgICAgIHVpbnQyNTYgZ2VuZXJhdGlvbiwKICAgICAgICB1aW50MjU2IGhwLAogICAgICAgIHVpbnQyNTYgYXR0YWNrLAogICAgICAgIHVpbnQyNTYgZGVmZW5zZSwKICAgICAgICB1aW50MjU2IHNwQXR0YWNrLAogICAgICAgIHVpbnQyNTYgc3BEZWZlbnNlLAogICAgICAgIHVpbnQyNTYgc3BlZWQsCiAgICAgICAgdWludDI1NiB0eXBlT25lLAogICAgICAgIHVpbnQyNTYgdHlwZVR3bywKICAgICAgICAKICAgICAgICB1aW50MjU2IG1JRCwKICAgICAgICBib29sIHRyYWRlYWJsZSwgCiAgICAgICAgdWludDI1NiB1SUQKICAgICAgICAKICAgICAgICAgICAgCiAgICAgICAgKSB7ICAgIAogICAgICAgTW9uc3RlciBzdG9yYWdlIG1vbiA9IG1vbnN0ZXJzW19pZF07CiAgICAgICAgYmlydGhUaW1lID0gdWludDI1Nihtb24uYmlydGhUaW1lKTsKICAgICAgICBnZW5lcmF0aW9uID0gMDsgLy8gaGFyZGNvZGluZyBkdWUgdG8gc3RhY2sgdG9vIGRlZXAgZXJyb3IKICAgICAgICBocCA9IHVpbnQyNTYobW9uLmhwKTsKICAgICAgICBhdHRhY2sgPSB1aW50MjU2KG1vbi5hdHRhY2spOwogICAgICAgIGRlZmVuc2UgPSB1aW50MjU2KG1vbi5kZWZlbnNlKTsKICAgICAgICBzcEF0dGFjayA9IHVpbnQyNTYobW9uLnNwQXR0YWNrKTsKICAgICAgICBzcERlZmVuc2UgPSB1aW50MjU2KG1vbi5zcERlZmVuc2UpOwogICAgICAgIHNwZWVkID0gdWludDI1Nihtb24uc3BlZWQpOwogICAgICAgIHR5cGVPbmUgPSB1aW50MjU2KG1vbi50eXBlT25lKTsKICAgICAgICB0eXBlVHdvID0gdWludDI1Nihtb24udHlwZVR3byk7CiAgICAgICAgbUlEID0gdWludDI1Nihtb24ubUlEKTsKICAgICAgICB0cmFkZWFibGUgPSBib29sKG1vbi50cmFkZWFibGUpOwogICAgICAgIAogICAgICAgIC8vIGhhY2sgdG8gb3ZlcmNvbWUgc29saWRpdHkncyBzdGFjayBsaW1pdGF0aW9uIGluIG1vbnN0ZXIgc3RydWN0Li4uLgogICAgICAgIHVJRCA9IF9pZDsKICAgICAgICAgICAgCiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIHRoaXMgbWV0aG9kIG9ubHkgcmV0dXJucyB0aGUgImJhc2UiIHBvd2VybGV2ZWwgb2YgYSBtb25zdGVyIHdoaWNoIHdpbGwgYmUgdXNlZAogICAgICAgIC8vIGluIG1vcmUgYWR2YW5jZWQgZmlnaHRpbmcgY2FsY3VsYXRpb25zIGxhdGVyIG9uCiAgICBmdW5jdGlvbiBnZXRNb25zdGVyUG93ZXJMZXZlbCh1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKAogICAgICAgICAgICB1aW50MjU2IHBvd2VybGV2ZWwKICAgICAgICApIHsKICAgICAgICAgICAgTW9uc3RlciBzdG9yYWdlIG1vbiA9IG1vbnN0ZXJzW190b2tlbklkXTsKICAgICAgICAgICAgdWludDhbN10gc3RvcmFnZSBJVnMgPSBtb25zdGVySWRUb0lWc1tfdG9rZW5JZF07CgogICAgICAgICAgICAKICAgICAgICAgICAgcG93ZXJsZXZlbCA9IG1vbi5ocCArIElWc1swXSArIG1vbi5hdHRhY2sgKyBJVnNbMV0gKyBtb24uZGVmZW5zZSArIElWc1syXSArIG1vbi5zcEF0dGFjayArIElWc1szXSArIG1vbi5zcERlZmVuc2UgKyBJVnNbNF0gKyBtb24uc3BlZWQgKyBJVnNbNV07CiAgICAgICAgfQogICAgICAgIAogICAgICAgIAogICAgICAgIAoKICAgCiAgICAKICAgIGZ1bmN0aW9uIGlzVHJhaW5lcihhZGRyZXNzIF9jaGVjaykKICAgIGV4dGVybmFsIAogICAgdmlldyAKICAgIHJldHVybnMgKAogICAgICAgIGJvb2wgaXNUcmFpbmVyCiAgICApIHsKICAgICAgICBUcmFpbmVyIHN0b3JhZ2UgdHJhaW5lciA9IGFkZHJlc3NUb1RyYWluZXJbX2NoZWNrXTsKCiAgICAgICAgaWYgKHRyYWluZXIuY3VyckFyZWEgPiAwKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgCgogICAgCiAgIAogICAKICAgIGZ1bmN0aW9uIHdpdGhkcmF3QmFsYW5jZSgpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAKICAgICAgICB1aW50MjU2IGJhbGFuY2UgPSB0aGlzLmJhbGFuY2U7CiAgICAgICAKICAgICAgIAogICAgICAgIG93bmVyLnRyYW5zZmVyKGJhbGFuY2UpOwogICAgICAgIAogICAgfQoKICAgIC8vIGFmdGVyIHdlIGhhdmUgc2V0dXAgZXZlcnl0aGluZyB3ZSBjYW4gdW5sb2NrIHRoZSBnYW1lCiAgICAvLyBmb3IgcHVibGljCiAgICBmdW5jdGlvbiBsYXVuY2hHYW1lKCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBoYXNMYXVuY2hlZCA9IHRydWU7CiAgICB9Cn0='.
	

]
