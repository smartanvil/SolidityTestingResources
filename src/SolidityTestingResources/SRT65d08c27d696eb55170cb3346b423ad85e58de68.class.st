Class {
	#name : #SRT65d08c27d696eb55170cb3346b423ad85e58de68,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT65d08c27d696eb55170cb3346b423ad85e58de68 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovKiBBZGFwdGVkIGZyb20gc3RyaW5ncy5zb2wgY3JlYXRlZCBieSBOaWNrIEpvaG5zb24gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSJhZmNlZGRjZWNjYzdjMWM2Y2JlZmMxYzBkYmNiYzBkYjgxYzFjYWRiIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4KICogUmVmOiBodHRwczovL2dpdGh1Yi5jb20vQXJhY2huaWQvc29saWRpdHktc3RyaW5ndXRpbHMvYmxvYi8yZjZjYTlhY2NiNDhhZTE0YzY2ZjE0MzdlYzUwZWQxOWEwNjE2Zjc4L3N0cmluZ3Muc29sCiAqIEB0aXRsZSBTdHJpbmcgJiBzbGljZSB1dGlsaXR5IGxpYnJhcnkgZm9yIFNvbGlkaXR5IGNvbnRyYWN0cy4KICogQGF1dGhvciBOaWNrIEpvaG5zb24gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI3OTE4MGIxODFhMTExNzEwMWQzOTE3MTYwZDFkMTYwZDU3MTcxYzBkIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4KICovCmxpYnJhcnkgc3RyaW5ncyB7CiAgICAKICAgIHN0cnVjdCBzbGljZSB7CiAgICAgICAgdWludCBfbGVuOwogICAgICAgIHVpbnQgX3B0cjsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBSZXR1cm5zIGEgc2xpY2UgY29udGFpbmluZyB0aGUgZW50aXJlIHN0cmluZy4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzdHJpbmcgdG8gbWFrZSBhIHNsaWNlIGZyb20uCiAgICAgKiBAcmV0dXJuIEEgbmV3bHkgYWxsb2NhdGVkIHNsaWNlIGNvbnRhaW5pbmcgdGhlIGVudGlyZSBzdHJpbmcuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRvU2xpY2Uoc3RyaW5nIHNlbGYpIGludGVybmFsIHB1cmUgcmV0dXJucyAoc2xpY2UpIHsKICAgICAgICB1aW50IHB0cjsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHB0ciA6PSBhZGQoc2VsZiwgMHgyMCkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNsaWNlKGJ5dGVzKHNlbGYpLmxlbmd0aCwgcHRyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBtZW1jcHkodWludCBkZXN0LCB1aW50IHNyYywgdWludCBsZW4pIHByaXZhdGUgcHVyZSB7CiAgICAgICAgLy8gQ29weSB3b3JkLWxlbmd0aCBjaHVua3Mgd2hpbGUgcG9zc2libGUKICAgICAgICBmb3IoOyBsZW4gPj0gMzI7IGxlbiAtPSAzMikgewogICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICBtc3RvcmUoZGVzdCwgbWxvYWQoc3JjKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBkZXN0ICs9IDMyOwogICAgICAgICAgICBzcmMgKz0gMzI7CiAgICAgICAgfQoKICAgICAgICAvLyBDb3B5IHJlbWFpbmluZyBieXRlcwogICAgICAgIHVpbnQgbWFzayA9IDI1NiAqKiAoMzIgLSBsZW4pIC0gMTsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIGxldCBzcmNwYXJ0IDo9IGFuZChtbG9hZChzcmMpLCBub3QobWFzaykpCiAgICAgICAgICAgIGxldCBkZXN0cGFydCA6PSBhbmQobWxvYWQoZGVzdCksIG1hc2spCiAgICAgICAgICAgIG1zdG9yZShkZXN0LCBvcihkZXN0cGFydCwgc3JjcGFydCkpCiAgICAgICAgfQogICAgfQoKICAgIAogICAgZnVuY3Rpb24gY29uY2F0KHNsaWNlIHNlbGYsIHNsaWNlIG90aGVyKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICB2YXIgcmV0ID0gbmV3IHN0cmluZyhzZWxmLl9sZW4gKyBvdGhlci5fbGVuKTsKICAgICAgICB1aW50IHJldHB0cjsKICAgICAgICBhc3NlbWJseSB7IHJldHB0ciA6PSBhZGQocmV0LCAzMikgfQogICAgICAgIG1lbWNweShyZXRwdHIsIHNlbGYuX3B0ciwgc2VsZi5fbGVuKTsKICAgICAgICBtZW1jcHkocmV0cHRyICsgc2VsZi5fbGVuLCBvdGhlci5fcHRyLCBvdGhlci5fbGVuKTsKICAgICAgICByZXR1cm4gcmV0OwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IENvdW50cyB0aGUgbnVtYmVyIG9mIG5vbm92ZXJsYXBwaW5nIG9jY3VycmVuY2VzIG9mIGBuZWVkbGVgIGluIGBzZWxmYC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzZWFyY2guCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLgogICAgICogQHJldHVybiBUaGUgbnVtYmVyIG9mIG9jY3VycmVuY2VzIG9mIGBuZWVkbGVgIGZvdW5kIGluIGBzZWxmYC4KICAgICAqLwogICAgZnVuY3Rpb24gY291bnQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zICh1aW50IGNudCkgewogICAgICAgIHVpbnQgcHRyID0gZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKSArIG5lZWRsZS5fbGVuOwogICAgICAgIHdoaWxlIChwdHIgPD0gc2VsZi5fcHRyICsgc2VsZi5fbGVuKSB7CiAgICAgICAgICAgIGNudCsrOwogICAgICAgICAgICBwdHIgPSBmaW5kUHRyKHNlbGYuX2xlbiAtIChwdHIgLSBzZWxmLl9wdHIpLCBwdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cikgKyBuZWVkbGUuX2xlbjsKICAgICAgICB9CiAgICB9CgogICAgLy8gUmV0dXJucyB0aGUgbWVtb3J5IGFkZHJlc3Mgb2YgdGhlIGZpcnN0IGJ5dGUgb2YgdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YKICAgIC8vIGBuZWVkbGVgIGluIGBzZWxmYCwgb3IgdGhlIGZpcnN0IGJ5dGUgYWZ0ZXIgYHNlbGZgIGlmIG5vdCBmb3VuZC4KICAgIGZ1bmN0aW9uIGZpbmRQdHIodWludCBzZWxmbGVuLCB1aW50IHNlbGZwdHIsIHVpbnQgbmVlZGxlbGVuLCB1aW50IG5lZWRsZXB0cikgcHJpdmF0ZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCBwdHI7CiAgICAgICAgdWludCBpZHg7CgogICAgICAgIGlmIChuZWVkbGVsZW4gPD0gc2VsZmxlbikgewogICAgICAgICAgICBpZiAobmVlZGxlbGVuIDw9IDMyKSB7CiAgICAgICAgICAgICAgICAvLyBPcHRpbWl6ZWQgYXNzZW1ibHkgZm9yIDY4IGdhcyBwZXIgYnl0ZSBvbiBzaG9ydCBzdHJpbmdzCiAgICAgICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICAgICAgbGV0IG1hc2sgOj0gbm90KHN1YihleHAoMiwgbXVsKDgsIHN1YigzMiwgbmVlZGxlbGVuKSkpLCAxKSkKICAgICAgICAgICAgICAgICAgICBsZXQgbmVlZGxlZGF0YSA6PSBhbmQobWxvYWQobmVlZGxlcHRyKSwgbWFzaykKICAgICAgICAgICAgICAgICAgICBsZXQgZW5kIDo9IGFkZChzZWxmcHRyLCBzdWIoc2VsZmxlbiwgbmVlZGxlbGVuKSkKICAgICAgICAgICAgICAgICAgICBwdHIgOj0gc2VsZnB0cgogICAgICAgICAgICAgICAgICAgIGxvb3A6CiAgICAgICAgICAgICAgICAgICAganVtcGkoZXhpdCwgZXEoYW5kKG1sb2FkKHB0ciksIG1hc2spLCBuZWVkbGVkYXRhKSkKICAgICAgICAgICAgICAgICAgICBwdHIgOj0gYWRkKHB0ciwgMSkKICAgICAgICAgICAgICAgICAgICBqdW1waShsb29wLCBsdChzdWIocHRyLCAxKSwgZW5kKSkKICAgICAgICAgICAgICAgICAgICBwdHIgOj0gYWRkKHNlbGZwdHIsIHNlbGZsZW4pCiAgICAgICAgICAgICAgICAgICAgZXhpdDoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBwdHI7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBGb3IgbG9uZyBuZWVkbGVzLCB1c2UgaGFzaGluZwogICAgICAgICAgICAgICAgYnl0ZXMzMiBoYXNoOwogICAgICAgICAgICAgICAgYXNzZW1ibHkgeyBoYXNoIDo9IHNoYTMobmVlZGxlcHRyLCBuZWVkbGVsZW4pIH0KICAgICAgICAgICAgICAgIHB0ciA9IHNlbGZwdHI7CiAgICAgICAgICAgICAgICBmb3IgKGlkeCA9IDA7IGlkeCA8PSBzZWxmbGVuIC0gbmVlZGxlbGVuOyBpZHgrKykgewogICAgICAgICAgICAgICAgICAgIGJ5dGVzMzIgdGVzdEhhc2g7CiAgICAgICAgICAgICAgICAgICAgYXNzZW1ibHkgeyB0ZXN0SGFzaCA6PSBzaGEzKHB0ciwgbmVlZGxlbGVuKSB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGhhc2ggPT0gdGVzdEhhc2gpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwdHI7CiAgICAgICAgICAgICAgICAgICAgcHRyICs9IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNlbGZwdHIgKyBzZWxmbGVuOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFNwbGl0cyB0aGUgc2xpY2UsIHNldHRpbmcgYHNlbGZgIHRvIGV2ZXJ5dGhpbmcgYWZ0ZXIgdGhlIGZpcnN0CiAgICAgKiAgICAgIG9jY3VycmVuY2Ugb2YgYG5lZWRsZWAsIGFuZCBgdG9rZW5gIHRvIGV2ZXJ5dGhpbmcgYmVmb3JlIGl0LiBJZgogICAgICogICAgICBgbmVlZGxlYCBkb2VzIG5vdCBvY2N1ciBpbiBgc2VsZmAsIGBzZWxmYCBpcyBzZXQgdG8gdGhlIGVtcHR5IHNsaWNlLAogICAgICogICAgICBhbmQgYHRva2VuYCBpcyBzZXQgdG8gdGhlIGVudGlyZXR5IG9mIGBzZWxmYC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzcGxpdC4KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuCiAgICAgKiBAcGFyYW0gdG9rZW4gQW4gb3V0cHV0IHBhcmFtZXRlciB0byB3aGljaCB0aGUgZmlyc3QgdG9rZW4gaXMgd3JpdHRlbi4KICAgICAqIEByZXR1cm4gYHRva2VuYC4KICAgICAqLwogICAgZnVuY3Rpb24gc3BsaXQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlLCBzbGljZSB0b2tlbikgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsKICAgICAgICB1aW50IHB0ciA9IGZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cik7CiAgICAgICAgdG9rZW4uX3B0ciA9IHNlbGYuX3B0cjsKICAgICAgICB0b2tlbi5fbGVuID0gcHRyIC0gc2VsZi5fcHRyOwogICAgICAgIGlmIChwdHIgPT0gc2VsZi5fcHRyICsgc2VsZi5fbGVuKSB7CiAgICAgICAgICAgIC8vIE5vdCBmb3VuZAogICAgICAgICAgICBzZWxmLl9sZW4gPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHNlbGYuX2xlbiAtPSB0b2tlbi5fbGVuICsgbmVlZGxlLl9sZW47CiAgICAgICAgICAgIHNlbGYuX3B0ciA9IHB0ciArIG5lZWRsZS5fbGVuOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdG9rZW47CiAgICB9CgogICAgIC8qCiAgICAgKiBAZGV2IFNwbGl0cyB0aGUgc2xpY2UsIHNldHRpbmcgYHNlbGZgIHRvIGV2ZXJ5dGhpbmcgYWZ0ZXIgdGhlIGZpcnN0CiAgICAgKiAgICAgIG9jY3VycmVuY2Ugb2YgYG5lZWRsZWAsIGFuZCByZXR1cm5pbmcgZXZlcnl0aGluZyBiZWZvcmUgaXQuIElmCiAgICAgKiAgICAgIGBuZWVkbGVgIGRvZXMgbm90IG9jY3VyIGluIGBzZWxmYCwgYHNlbGZgIGlzIHNldCB0byB0aGUgZW1wdHkgc2xpY2UsCiAgICAgKiAgICAgIGFuZCB0aGUgZW50aXJldHkgb2YgYHNlbGZgIGlzIHJldHVybmVkLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNwbGl0LgogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yIGluIGBzZWxmYC4KICAgICAqIEByZXR1cm4gVGhlIHBhcnQgb2YgYHNlbGZgIHVwIHRvIHRoZSBmaXJzdCBvY2N1cnJlbmNlIG9mIGBkZWxpbWAuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNwbGl0KHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UgdG9rZW4pIHsKICAgICAgICBzcGxpdChzZWxmLCBuZWVkbGUsIHRva2VuKTsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBDb3BpZXMgYSBzbGljZSB0byBhIG5ldyBzdHJpbmcuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gY29weS4KICAgICAqIEByZXR1cm4gQSBuZXdseSBhbGxvY2F0ZWQgc3RyaW5nIGNvbnRhaW5pbmcgdGhlIHNsaWNlJ3MgdGV4dC4KICAgICAqLwogICAgZnVuY3Rpb24gdG9TdHJpbmcoc2xpY2Ugc2VsZikgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICB2YXIgcmV0ID0gbmV3IHN0cmluZyhzZWxmLl9sZW4pOwogICAgICAgIHVpbnQgcmV0cHRyOwogICAgICAgIGFzc2VtYmx5IHsgcmV0cHRyIDo9IGFkZChyZXQsIDMyKSB9CgogICAgICAgIG1lbWNweShyZXRwdHIsIHNlbGYuX3B0ciwgc2VsZi5fbGVuKTsKICAgICAgICByZXR1cm4gcmV0OwogICAgfQoKfQoKLyogSGVscGVyIFN0cmluZyBGdW5jdGlvbnMgZm9yIEdhbWUgTWFuYWdlciBDb250cmFjdAogKiBAdGl0bGUgU3RyaW5nIEhlYWxwZXJzCiAqIEBhdXRob3IgRmF6cmkgWnViYWlyICYgRmFyaGFuIEtod2FqYSAoTHVjaWQgU2lnaHQsIEluYy4pCiAqLwpjb250cmFjdCBTdHJpbmdIZWxwZXJzIHsKICAgIHVzaW5nIHN0cmluZ3MgZm9yICo7CiAgICAKICAgIGZ1bmN0aW9uIHN0cmluZ1RvQnl0ZXMzMihzdHJpbmcgbWVtb3J5IHNvdXJjZSkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiByZXN1bHQpIHsKICAgICAgICBieXRlcyBtZW1vcnkgdGVtcEVtcHR5U3RyaW5nVGVzdCA9IGJ5dGVzKHNvdXJjZSk7CiAgICAgICAgaWYgKHRlbXBFbXB0eVN0cmluZ1Rlc3QubGVuZ3RoID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIDB4MDsKICAgICAgICB9CiAgICAKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHJlc3VsdCA6PSBtbG9hZChhZGQoc291cmNlLCAzMikpCiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGJ5dGVzMzJUb1N0cmluZyhieXRlczMyIHgpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIGJ5dGVzIG1lbW9yeSBieXRlc1N0cmluZyA9IG5ldyBieXRlcygzMik7CiAgICAgICAgdWludCBjaGFyQ291bnQgPSAwOwogICAgICAgIGZvciAodWludCBqID0gMDsgaiA8IDMyOyBqKyspIHsKICAgICAgICAgICAgYnl0ZSBjaGFyID0gYnl0ZShieXRlczMyKHVpbnQoeCkgKiAyICoqICg4ICogaikpKTsKICAgICAgICAgICAgaWYgKGNoYXIgIT0gMCkgewogICAgICAgICAgICAgICAgYnl0ZXNTdHJpbmdbY2hhckNvdW50XSA9IGNoYXI7CiAgICAgICAgICAgICAgICBjaGFyQ291bnQrKzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBieXRlcyBtZW1vcnkgYnl0ZXNTdHJpbmdUcmltbWVkID0gbmV3IGJ5dGVzKGNoYXJDb3VudCk7CiAgICAgICAgZm9yIChqID0gMDsgaiA8IGNoYXJDb3VudDsgaisrKSB7CiAgICAgICAgICAgIGJ5dGVzU3RyaW5nVHJpbW1lZFtqXSA9IGJ5dGVzU3RyaW5nW2pdOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc3RyaW5nKGJ5dGVzU3RyaW5nVHJpbW1lZCk7CiAgICB9Cn0KCi8vLyBAdGl0bGUgSW50ZXJmYWNlIGZvciBjb250cmFjdHMgY29uZm9ybWluZyB0byBFUkMtNzIxOiBOb24tRnVuZ2libGUgVG9rZW5zCi8vLyBAYXV0aG9yIERpZXRlciBTaGlybGV5IDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iYTNjN2M2ZDdjNmUzYzJkYmNhY2NjZWQ5YzZjZDhkYzBjYyI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+IChodHRwczovL2dpdGh1Yi5jb20vZGV0ZSkKY29udHJhY3QgRVJDNzIxIHsKICAvLyBSZXF1aXJlZCBtZXRob2RzCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOwogIGZ1bmN0aW9uIG93bmVyT2YodWludDI1NiBfYXNzZXRJZCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcyBvd25lcik7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF90bywgdWludDI1NiBfYXNzZXRJZCkgcHVibGljOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hc3NldElkKSBwdWJsaWM7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hc3NldElkKSBwdWJsaWM7CiAgZnVuY3Rpb24gaW1wbGVtZW50c0VSQzcyMSgpIHB1YmxpYyBwdXJlIHJldHVybnMgKGJvb2wpOwogIGZ1bmN0aW9uIHRha2VPd25lcnNoaXAodWludDI1NiBfYXNzZXRJZCkgcHVibGljOwogIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiB0b3RhbCk7CgogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdG9rZW5JZCk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgYXBwcm92ZWQsIHVpbnQyNTYgdG9rZW5JZCk7CgogIC8vIE9wdGlvbmFsCiAgLy8gZnVuY3Rpb24gbmFtZSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZyBuYW1lKTsKICAvLyBmdW5jdGlvbiBzeW1ib2woKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgc3ltYm9sKTsKICAvLyBmdW5jdGlvbiB0b2tlbk9mT3duZXJCeUluZGV4KGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF9pbmRleCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2IHRva2VuSWQpOwogIC8vIGZ1bmN0aW9uIHRva2VuTWV0YWRhdGEodWludDI1NiBfYXNzZXRJZCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nIGluZm9VcmwpOwoKICAvLyBFUkMtMTY1IENvbXBhdGliaWxpdHkgKGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8xNjUpCiAgZnVuY3Rpb24gc3VwcG9ydHNJbnRlcmZhY2UoYnl0ZXM0IF9pbnRlcmZhY2VJRCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChib29sKTsKfQoKLyogQ29udHJvbHMgZ2FtZSBwbGF5IHN0YXRlIGFuZCBhY2Nlc3MgcmlnaHRzIGZvciBnYW1lIGZ1bmN0aW9ucwogKiBAdGl0bGUgT3BlcmF0aW9uYWwgQ29udHJvbAogKiBAYXV0aG9yIEZhenJpIFp1YmFpciAmIEZhcmhhbiBLaHdhamEgKEx1Y2lkIFNpZ2h0LCBJbmMuKQogKiBJbnNwaXJlZCBhbmQgYWRhcHRlZCBmcm9tIGNvbnRyYWN0IGNyZWF0ZWQgYnkgT3BlblplcHBlbGluCiAqIFJlZjogaHR0cHM6Ly9naXRodWIuY29tL09wZW5aZXBwZWxpbi96ZXBwZWxpbi1zb2xpZGl0eS8KICovCmNvbnRyYWN0IE9wZXJhdGlvbmFsQ29udHJvbCB7CiAgICAvLyBGYWNpbGl0YXRlcyBhY2Nlc3MgJiBjb250cm9sIGZvciB0aGUgZ2FtZS4KICAgIC8vIFJvbGVzOgogICAgLy8gIC1UaGUgR2FtZSBNYW5hZ2VycyAoUHJpbWFyeS9TZWNvbmRhcnkpOiBIYXMgdW5pdmVyc2FsIGNvbnRyb2wgb2YgYWxsIGdhbWUgZWxlbWVudHMgKE5vIGFiaWxpdHkgdG8gd2l0aGRyYXcpCiAgICAvLyAgLVRoZSBCYW5rZXI6IFRoZSBCYW5rIGNhbiB3aXRoZHJhdyBmdW5kcyBhbmQgYWRqdXN0IGZlZXMgLyBwcmljZXMuCgogICAgLy8vIEBkZXYgRW1pdGVkIHdoZW4gY29udHJhY3QgaXMgdXBncmFkZWQKICAgIGV2ZW50IENvbnRyYWN0VXBncmFkZShhZGRyZXNzIG5ld0NvbnRyYWN0KTsKCiAgICAvLyBUaGUgYWRkcmVzc2VzIG9mIHRoZSBhY2NvdW50cyAob3IgY29udHJhY3RzKSB0aGF0IGNhbiBleGVjdXRlIGFjdGlvbnMgd2l0aGluIGVhY2ggcm9sZXMuCiAgICBhZGRyZXNzIHB1YmxpYyBnYW1lTWFuYWdlclByaW1hcnk7CiAgICBhZGRyZXNzIHB1YmxpYyBnYW1lTWFuYWdlclNlY29uZGFyeTsKICAgIGFkZHJlc3MgcHVibGljIGJhbmtNYW5hZ2VyOwoKICAgIC8vIEBkZXYgS2VlcHMgdHJhY2sgd2hldGhlciB0aGUgY29udHJhY3QgaXMgcGF1c2VkLiBXaGVuIHRoYXQgaXMgdHJ1ZSwgbW9zdCBhY3Rpb25zIGFyZSBibG9ja2VkCiAgICBib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKCiAgICAvLyBAZGV2IEtlZXBzIHRyYWNrIHdoZXRoZXIgdGhlIGNvbnRyYWN0IGVycm9yZWRPdXQuIFdoZW4gdGhhdCBpcyB0cnVlLCBtb3N0IGFjdGlvbnMgYXJlIGJsb2NrZWQgJiByZWZ1bmQgY2FuIGJlIGNsYWltZWQKICAgIGJvb2wgcHVibGljIGVycm9yID0gZmFsc2U7CgogICAgLy8vIEBkZXYgT3BlcmF0aW9uIG1vZGlmaWVycyBmb3IgbGltaXRpbmcgYWNjZXNzCiAgICBtb2RpZmllciBvbmx5R2FtZU1hbmFnZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGdhbWVNYW5hZ2VyUHJpbWFyeSB8fCBtc2cuc2VuZGVyID09IGdhbWVNYW5hZ2VyU2Vjb25kYXJ5KTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlCYW5rZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGJhbmtNYW5hZ2VyKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGFueU9wZXJhdG9yKCkgewogICAgICAgIHJlcXVpcmUoCiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gZ2FtZU1hbmFnZXJQcmltYXJ5IHx8CiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gZ2FtZU1hbmFnZXJTZWNvbmRhcnkgfHwKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBiYW5rTWFuYWdlcgogICAgICAgICk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQGRldiBBc3NpZ25zIGEgbmV3IGFkZHJlc3MgdG8gYWN0IGFzIHRoZSBHTS4KICAgIGZ1bmN0aW9uIHNldFByaW1hcnlHYW1lTWFuYWdlcihhZGRyZXNzIF9uZXdHTSkgZXh0ZXJuYWwgb25seUdhbWVNYW5hZ2VyIHsKICAgICAgICByZXF1aXJlKF9uZXdHTSAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgZ2FtZU1hbmFnZXJQcmltYXJ5ID0gX25ld0dNOwogICAgfQoKICAgIC8vLyBAZGV2IEFzc2lnbnMgYSBuZXcgYWRkcmVzcyB0byBhY3QgYXMgdGhlIEdNLgogICAgZnVuY3Rpb24gc2V0U2Vjb25kYXJ5R2FtZU1hbmFnZXIoYWRkcmVzcyBfbmV3R00pIGV4dGVybmFsIG9ubHlHYW1lTWFuYWdlciB7CiAgICAgICAgcmVxdWlyZShfbmV3R00gIT0gYWRkcmVzcygwKSk7CgogICAgICAgIGdhbWVNYW5hZ2VyU2Vjb25kYXJ5ID0gX25ld0dNOwogICAgfQoKICAgIC8vLyBAZGV2IEFzc2lnbnMgYSBuZXcgYWRkcmVzcyB0byBhY3QgYXMgdGhlIEJhbmtlci4KICAgIGZ1bmN0aW9uIHNldEJhbmtlcihhZGRyZXNzIF9uZXdCSykgZXh0ZXJuYWwgb25seUdhbWVNYW5hZ2VyIHsKICAgICAgICByZXF1aXJlKF9uZXdCSyAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgYmFua01hbmFnZXIgPSBfbmV3Qks7CiAgICB9CgogICAgLyoqKiBQYXVzYWJsZSBmdW5jdGlvbmFsaXR5IGFkYXB0ZWQgZnJvbSBPcGVuWmVwcGVsaW4gKioqLwoKICAgIC8vLyBAZGV2IE1vZGlmaWVyIHRvIGFsbG93IGFjdGlvbnMgb25seSB3aGVuIHRoZSBjb250cmFjdCBJUyBOT1QgcGF1c2VkCiAgICBtb2RpZmllciB3aGVuTm90UGF1c2VkKCkgewogICAgICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQGRldiBNb2RpZmllciB0byBhbGxvdyBhY3Rpb25zIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgSVMgcGF1c2VkCiAgICBtb2RpZmllciB3aGVuUGF1c2VkIHsKICAgICAgICByZXF1aXJlKHBhdXNlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQGRldiBNb2RpZmllciB0byBhbGxvdyBhY3Rpb25zIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgaGFzIEVycm9yCiAgICBtb2RpZmllciB3aGVuRXJyb3IgewogICAgICAgIHJlcXVpcmUoZXJyb3IpOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgQ2FsbGVkIGJ5IGFueSBPcGVyYXRvciByb2xlIHRvIHBhdXNlIHRoZSBjb250cmFjdC4KICAgIC8vLyBVc2VkIG9ubHkgaWYgYSBidWcgb3IgZXhwbG9pdCBpcyBkaXNjb3ZlcmVkIChIZXJlIHRvIGxpbWl0IGxvc3NlcyAvIGRhbWFnZSkKICAgIGZ1bmN0aW9uIHBhdXNlKCkgZXh0ZXJuYWwgb25seUdhbWVNYW5hZ2VyIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIHBhdXNlZCA9IHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgVW5wYXVzZXMgdGhlIHNtYXJ0IGNvbnRyYWN0LiBDYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIEdhbWUgTWFzdGVyCiAgICAvLy8gQG5vdGljZSBUaGlzIGlzIHB1YmxpYyByYXRoZXIgdGhhbiBleHRlcm5hbCBzbyBpdCBjYW4gYmUgY2FsbGVkIGJ5IGRlcml2ZWQgY29udHJhY3RzLiAKICAgIGZ1bmN0aW9uIHVucGF1c2UoKSBwdWJsaWMgb25seUdhbWVNYW5hZ2VyIHdoZW5QYXVzZWQgewogICAgICAgIC8vIGNhbid0IHVucGF1c2UgaWYgY29udHJhY3Qgd2FzIHVwZ3JhZGVkCiAgICAgICAgcGF1c2VkID0gZmFsc2U7CiAgICB9CgogICAgLy8vIEBkZXYgVW5wYXVzZXMgdGhlIHNtYXJ0IGNvbnRyYWN0LiBDYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIEdhbWUgTWFzdGVyCiAgICAvLy8gQG5vdGljZSBUaGlzIGlzIHB1YmxpYyByYXRoZXIgdGhhbiBleHRlcm5hbCBzbyBpdCBjYW4gYmUgY2FsbGVkIGJ5IGRlcml2ZWQgY29udHJhY3RzLiAKICAgIGZ1bmN0aW9uIGhhc0Vycm9yKCkgcHVibGljIG9ubHlHYW1lTWFuYWdlciB3aGVuUGF1c2VkIHsKICAgICAgICBlcnJvciA9IHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgVW5wYXVzZXMgdGhlIHNtYXJ0IGNvbnRyYWN0LiBDYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIEdhbWUgTWFzdGVyCiAgICAvLy8gQG5vdGljZSBUaGlzIGlzIHB1YmxpYyByYXRoZXIgdGhhbiBleHRlcm5hbCBzbyBpdCBjYW4gYmUgY2FsbGVkIGJ5IGRlcml2ZWQgY29udHJhY3RzLiAKICAgIGZ1bmN0aW9uIG5vRXJyb3IoKSBwdWJsaWMgb25seUdhbWVNYW5hZ2VyIHdoZW5QYXVzZWQgewogICAgICAgIGVycm9yID0gZmFsc2U7CiAgICB9Cn0KCmNvbnRyYWN0IENTQ0NvbGxlY3RpYmxlQmFzZSBpcyBFUkM3MjEsIE9wZXJhdGlvbmFsQ29udHJvbCwgU3RyaW5nSGVscGVycyB7CgogIC8qKiogRVZFTlRTICoqKi8KICAvLy8gQGRldiBUaGUgQ3JlYXRlZCBldmVudCBpcyBmaXJlZCB3aGVuZXZlciBhIG5ldyBjb2xsZWN0aWJsZSBjb21lcyBpbnRvIGV4aXN0ZW5jZS4KICBldmVudCBDb2xsZWN0aWJsZUNyZWF0ZWQoYWRkcmVzcyBvd25lciwgdWludDI1NiBjb2xsZWN0aWJsZUlkLCBieXRlczMyIGNvbGxlY3RpYmxlTmFtZSwgYm9vbCBpc1JlZGVlbWVkKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgc2hpcElkKTsKCiAgLyoqKiBDT05TVEFOVFMgKioqLwoKICAvLy8gQG5vdGljZSBOYW1lIGFuZCBzeW1ib2wgb2YgdGhlIG5vbiBmdW5naWJsZSB0b2tlbiwgYXMgZGVmaW5lZCBpbiBFUkM3MjEuCiAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBOQU1FID0gIkNTQ1JhcmVDb2xsZWN0aWJsZVByZVNhbGUiOwogIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgU1lNQk9MID0gIkNTQ1IiOwogIGJ5dGVzNCBjb25zdGFudCBJbnRlcmZhY2VTaWduYXR1cmVfRVJDMTY1ID0gYnl0ZXM0KGtlY2NhazI1Nignc3VwcG9ydHNJbnRlcmZhY2UoYnl0ZXM0KScpKTsKICBieXRlczQgY29uc3RhbnQgSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzcyMSA9CiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NignbmFtZSgpJykpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCdzeW1ib2woKScpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NigndG90YWxTdXBwbHkoKScpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NignYmFsYW5jZU9mKGFkZHJlc3MpJykpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCdvd25lck9mKHVpbnQyNTYpJykpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCdhcHByb3ZlKGFkZHJlc3MsdWludDI1NiknKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3RyYW5zZmVyKGFkZHJlc3MsdWludDI1NiknKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3RyYW5zZmVyRnJvbShhZGRyZXNzLGFkZHJlc3MsdWludDI1NiknKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3Rva2Vuc09mT3duZXIoYWRkcmVzcyknKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3Rva2VuTWV0YWRhdGEodWludDI1NixzdHJpbmcpJykpOwoKICAvLy8gQGRldiBDU0MgUHJlIFNhbGUgU3RydWN0LCBoYXZpbmcgZGV0YWlscyBvZiB0aGUgc2hpcAogIHN0cnVjdCBSYXJlUHJlU2FsZUl0ZW0gewoKICAgIC8vLyBAZGV2IG5hbWUgb2YgdGhlIGNvbGxlY3RpYmxlIHN0b3JlZCBpbiBieXRlcwogICAgYnl0ZXMzMiBjb2xsZWN0aWJsZU5hbWU7CgogICAgLy8vIEBkZXYgVGltZXN0YW1wIHdoZW4gYm91Z2h0CiAgICB1aW50MjU2IGJvdWdodFRpbWVzdGFtcDsKCiAgICAvLyBAZGV2IG93bmVyIGFkZHJlc3MKICAgIGFkZHJlc3Mgb3duZXI7CgogICAgLy8gQGRldiByZWRlZW1lIGZsYWcgKHRvIGhlbHAgd2hldGhlciBpdCBnb3QgcmVkZWVtZWQgb3Igbm90KQogICAgYm9vbCBpc1JlZGVlbWVkOwogIH0KCiAgLy8gQGRldiBhcnJheSBvZiBSYXJlUHJlU2FsZUl0ZW0gdHlwZSBob2xkaW5nIGluZm9ybWF0aW9uIG9uIHRoZSBTaGlwcwogIFJhcmVQcmVTYWxlSXRlbVtdIGFsbFByZVNhbGVJdGVtczsKCiAgLy8gQGRldiBtYXBwaW5nIHdoaWNoIGhvbGRzIGFsbCB0aGUgcG9zc2libGUgYWRkcmVzc2VzIHdoaWNoIGFyZSBhbGxvd2VkIHRvIGludGVyYWN0IHdpdGggdGhlIGNvbnRyYWN0CiAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBhcHByb3ZlZEFkZHJlc3NMaXN0OwoKICAvLyBAZGV2IG1hcHBpbmcgaG9sZHMgdGhlIHByZVNhbGVJdGVtIC0+IG93bmVyIGRldGFpbHMKICBtYXBwaW5nICh1aW50MjU2ID0+IGFkZHJlc3MpIHB1YmxpYyBwcmVTYWxlSXRlbUluZGV4VG9Pd25lcjsKCiAgLy8gQGRldiBBIG1hcHBpbmcgZnJvbSBvd25lciBhZGRyZXNzIHRvIGNvdW50IG9mIHRva2VucyB0aGF0IGFkZHJlc3Mgb3ducy4KICAvLyAgVXNlZCBpbnRlcm5hbGx5IGluc2lkZSBiYWxhbmNlT2YoKSB0byByZXNvbHZlIG93bmVyc2hpcCBjb3VudC4KICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHByaXZhdGUgb3duZXJzaGlwVG9rZW5Db3VudDsKCiAgLy8vIEBkZXYgQSBtYXBwaW5nIGZyb20gcHJlU2FsZUl0ZW0gdG8gYW4gYWRkcmVzcyB0aGF0IGhhcyBiZWVuIGFwcHJvdmVkIHRvIGNhbGwKICAvLy8gIHRyYW5zZmVyRnJvbSgpLiBFYWNoIFNoaXAgY2FuIG9ubHkgaGF2ZSBvbmUgYXBwcm92ZWQgYWRkcmVzcyBmb3IgdHJhbnNmZXIKICAvLy8gIGF0IGFueSB0aW1lLiBBIHplcm8gdmFsdWUgbWVhbnMgbm8gYXBwcm92YWwgaXMgb3V0c3RhbmRpbmcuCiAgbWFwcGluZyAodWludDI1NiA9PiBhZGRyZXNzKSBwdWJsaWMgcHJlU2FsZUl0ZW1JbmRleFRvQXBwcm92ZWQ7CgogIC8vLyBAbm90aWNlIEludHJvc3BlY3Rpb24gaW50ZXJmYWNlIGFzIHBlciBFUkMtMTY1IChodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTY1KS4KICAvLy8gIFJldHVybnMgdHJ1ZSBmb3IgYW55IHN0YW5kYXJkaXplZCBpbnRlcmZhY2VzIGltcGxlbWVudGVkIGJ5IHRoaXMgY29udHJhY3QuIFdlIGltcGxlbWVudAogIC8vLyAgRVJDLTE2NSAob2J2aW91c2x5ISkgYW5kIEVSQy03MjEuCiAgZnVuY3Rpb24gc3VwcG9ydHNJbnRlcmZhY2UoYnl0ZXM0IF9pbnRlcmZhY2VJRCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChib29sKQogIHsKICAgICAgLy8gREVCVUcgT05MWQogICAgICAvL3JlcXVpcmUoKEludGVyZmFjZVNpZ25hdHVyZV9FUkMxNjUgPT0gMHgwMWZmYzlhNykgJiYgKEludGVyZmFjZVNpZ25hdHVyZV9FUkM3MjEgPT0gMHg5YTIwNDgzZCkpOwogICAgICByZXR1cm4gKChfaW50ZXJmYWNlSUQgPT0gSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzE2NSkgfHwgKF9pbnRlcmZhY2VJRCA9PSBJbnRlcmZhY2VTaWduYXR1cmVfRVJDNzIxKSk7CiAgfQoKICAvKioqIFBVQkxJQyBGVU5DVElPTlMgKioqLwogIC8vLyBAbm90aWNlIEdyYW50IGFub3RoZXIgYWRkcmVzcyB0aGUgcmlnaHQgdG8gdHJhbnNmZXIgdG9rZW4gdmlhIHRha2VPd25lcnNoaXAoKSBhbmQgdHJhbnNmZXJGcm9tKCkuCiAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gYmUgZ3JhbnRlZCB0cmFuc2ZlciBhcHByb3ZhbC4gUGFzcyBhZGRyZXNzKDApIHRvCiAgLy8vICBjbGVhciBhbGwgYXBwcm92YWxzLgogIC8vLyBAcGFyYW0gX2Fzc2V0SWQgVGhlIElEIG9mIHRoZSBUb2tlbiB0aGF0IGNhbiBiZSB0cmFuc2ZlcnJlZCBpZiB0aGlzIGNhbGwgc3VjY2VlZHMuCiAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hc3NldElkKSBwdWJsaWMgewogICAgLy8gQ2FsbGVyIG11c3Qgb3duIHRva2VuLgogICAgcmVxdWlyZShfb3ducyhhZGRyZXNzKHRoaXMpLCBfYXNzZXRJZCkpOwogICAgcHJlU2FsZUl0ZW1JbmRleFRvQXBwcm92ZWRbX2Fzc2V0SWRdID0gX3RvOwoKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF90bywgX2Fzc2V0SWQpOwogIH0KCiAgLy8vIEZvciBxdWVyeWluZyBiYWxhbmNlIG9mIGEgcGFydGljdWxhciBhY2NvdW50CiAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgZm9yIGJhbGFuY2UgcXVlcnkKICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICByZXR1cm4gb3duZXJzaGlwVG9rZW5Db3VudFtfb3duZXJdOwogIH0KCiAgZnVuY3Rpb24gaW1wbGVtZW50c0VSQzcyMSgpIHB1YmxpYyBwdXJlIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEZvciBxdWVyeWluZyBvd25lciBvZiB0b2tlbgogIC8vLyBAcGFyYW0gX2Fzc2V0SWQgVGhlIHRva2VuSUQgZm9yIG93bmVyIGlucXVpcnkKICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogIGZ1bmN0aW9uIG93bmVyT2YodWludDI1NiBfYXNzZXRJZCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcyBvd25lcikgewogICAgb3duZXIgPSBwcmVTYWxlSXRlbUluZGV4VG9Pd25lcltfYXNzZXRJZF07CiAgICByZXF1aXJlKG93bmVyICE9IGFkZHJlc3MoMCkpOwogIH0KCiAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICBmdW5jdGlvbiBzeW1ib2woKSBwdWJsaWMgcHVyZSByZXR1cm5zIChzdHJpbmcpIHsKICAgIHJldHVybiBTWU1CT0w7CiAgfQoKICAvLy8gQG5vdGljZSBBbGxvdyBwcmUtYXBwcm92ZWQgdXNlciB0byB0YWtlIG93bmVyc2hpcCBvZiBhIHRva2VuCiAgLy8vIEBwYXJhbSBfYXNzZXRJZCBUaGUgSUQgb2YgdGhlIFRva2VuIHRoYXQgY2FuIGJlIHRyYW5zZmVycmVkIGlmIHRoaXMgY2FsbCBzdWNjZWVkcy4KICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogIGZ1bmN0aW9uIHRha2VPd25lcnNoaXAodWludDI1NiBfYXNzZXRJZCkgcHVibGljIHsKICAgIGFkZHJlc3MgbmV3T3duZXIgPSBtc2cuc2VuZGVyOwogICAgYWRkcmVzcyBvbGRPd25lciA9IHByZVNhbGVJdGVtSW5kZXhUb093bmVyW19hc3NldElkXTsKCiAgICAvLyBTYWZldHkgY2hlY2sgdG8gcHJldmVudCBhZ2FpbnN0IGFuIHVuZXhwZWN0ZWQgMHgwIGRlZmF1bHQuCiAgICByZXF1aXJlKF9hZGRyZXNzTm90TnVsbChuZXdPd25lcikpOwoKICAgIC8vIE1ha2luZyBzdXJlIHRyYW5zZmVyIGlzIGFwcHJvdmVkCiAgICByZXF1aXJlKF9hcHByb3ZlZChuZXdPd25lciwgX2Fzc2V0SWQpKTsKCiAgICBfdHJhbnNmZXIob2xkT3duZXIsIG5ld093bmVyLCBfYXNzZXRJZCk7CiAgfQoKICAvLy8gQHBhcmFtIF9vd25lciBUaGUgb3duZXIgd2hvc2Ugc2hpcHMgdG9rZW5zIHdlIGFyZSBpbnRlcmVzdGVkIGluLgogIC8vLyBAZGV2IFRoaXMgbWV0aG9kIE1VU1QgTkVWRVIgYmUgY2FsbGVkIGJ5IHNtYXJ0IGNvbnRyYWN0IGNvZGUuIEZpcnN0LCBpdCdzIGZhaXJseQogIC8vLyAgZXhwZW5zaXZlIChpdCB3YWxrcyB0aGUgZW50aXJlIENTQ1NoaXBzIGFycmF5IGxvb2tpbmcgZm9yIGVtb2ppcyBiZWxvbmdpbmcgdG8gb3duZXIpLAogIC8vLyAgYnV0IGl0IGFsc28gcmV0dXJucyBhIGR5bmFtaWMgYXJyYXksIHdoaWNoIGlzIG9ubHkgc3VwcG9ydGVkIGZvciB3ZWIzIGNhbGxzLCBhbmQKICAvLy8gIG5vdCBjb250cmFjdC10by1jb250cmFjdCBjYWxscy4KICBmdW5jdGlvbiB0b2tlbnNPZk93bmVyKGFkZHJlc3MgX293bmVyKSBleHRlcm5hbCB2aWV3IHJldHVybnModWludDI1NltdIG93bmVyVG9rZW5zKSB7CiAgICB1aW50MjU2IHRva2VuQ291bnQgPSBiYWxhbmNlT2YoX293bmVyKTsKCiAgICBpZiAodG9rZW5Db3VudCA9PSAwKSB7CiAgICAgICAgLy8gUmV0dXJuIGFuIGVtcHR5IGFycmF5CiAgICAgICAgcmV0dXJuIG5ldyB1aW50MjU2W10oMCk7CiAgICB9IGVsc2UgewogICAgICAgIHVpbnQyNTZbXSBtZW1vcnkgcmVzdWx0ID0gbmV3IHVpbnQyNTZbXSh0b2tlbkNvdW50KTsKICAgICAgICB1aW50MjU2IHRvdGFsU2hpcHMgPSB0b3RhbFN1cHBseSgpICsgMTsKICAgICAgICB1aW50MjU2IHJlc3VsdEluZGV4ID0gMDsKCiAgICAgICAgLy8gV2UgY291bnQgb24gdGhlIGZhY3QgdGhhdCBhbGwgQ1NDIFNoaXAgQ29sbGVjdGlibGUgaGF2ZSBJRHMgc3RhcnRpbmcgYXQgMCBhbmQgaW5jcmVhc2luZwogICAgICAgIC8vIHNlcXVlbnRpYWxseSB1cCB0byB0aGUgdG90YWwgY291bnQuCiAgICAgICAgdWludDI1NiBfYXNzZXRJZDsKCiAgICAgICAgZm9yIChfYXNzZXRJZCA9IDA7IF9hc3NldElkIDwgdG90YWxTaGlwczsgX2Fzc2V0SWQrKykgewogICAgICAgICAgICBpZiAocHJlU2FsZUl0ZW1JbmRleFRvT3duZXJbX2Fzc2V0SWRdID09IF9vd25lcikgewogICAgICAgICAgICAgICAgcmVzdWx0W3Jlc3VsdEluZGV4XSA9IF9hc3NldElkOwogICAgICAgICAgICAgICAgcmVzdWx0SW5kZXgrKzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICB9CgogIC8vLyBGb3IgcXVlcnlpbmcgdG90YWxTdXBwbHkgb2YgdG9rZW4KICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiB0b3RhbCkgewogICAgcmV0dXJuIGFsbFByZVNhbGVJdGVtcy5sZW5ndGggLSAxOyAvL1JlbW92ZWQgMCBpbmRleAogIH0KCiAgLy8vIE93bmVyIGluaXRhdGVzIHRoZSB0cmFuc2ZlciBvZiB0aGUgdG9rZW4gdG8gYW5vdGhlciBhY2NvdW50CiAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgZm9yIHRoZSB0b2tlbiB0byBiZSB0cmFuc2ZlcnJlZCB0by4KICAvLy8gQHBhcmFtIF9hc3NldElkIFRoZSBJRCBvZiB0aGUgVG9rZW4gdGhhdCBjYW4gYmUgdHJhbnNmZXJyZWQgaWYgdGhpcyBjYWxsIHN1Y2NlZWRzLgogIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UuCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Fzc2V0SWQpIHB1YmxpYyB7CiAgICByZXF1aXJlKF9hZGRyZXNzTm90TnVsbChfdG8pKTsKICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX2Fzc2V0SWQpKTsKCiAgICBfdHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfYXNzZXRJZCk7CiAgfQoKICAvLy8gVGhpcmQtcGFydHkgaW5pdGlhdGVzIHRyYW5zZmVyIG9mIHRva2VuIGZyb20gYWRkcmVzcyBfZnJvbSB0byBhZGRyZXNzIF90bwogIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3MgZm9yIHRoZSB0b2tlbiB0byBiZSB0cmFuc2ZlcnJlZCBmcm9tLgogIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIGZvciB0aGUgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQgdG8uCiAgLy8vIEBwYXJhbSBfYXNzZXRJZCBUaGUgSUQgb2YgdGhlIFRva2VuIHRoYXQgY2FuIGJlIHRyYW5zZmVycmVkIGlmIHRoaXMgY2FsbCBzdWNjZWVkcy4KICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfYXNzZXRJZCkgcHVibGljIHsKICAgIHJlcXVpcmUoX293bnMoX2Zyb20sIF9hc3NldElkKSk7CiAgICByZXF1aXJlKF9hcHByb3ZlZChfdG8sIF9hc3NldElkKSk7CiAgICByZXF1aXJlKF9hZGRyZXNzTm90TnVsbChfdG8pKTsKCiAgICBfdHJhbnNmZXIoX2Zyb20sIF90bywgX2Fzc2V0SWQpOwogIH0KCiAgLyoqKiBQUklWQVRFIEZVTkNUSU9OUyAqKiovCiAgLy8vIEBkZXYgIFNhZmV0eSBjaGVjayBvbiBfdG8gYWRkcmVzcyB0byBwcmV2ZW50IGFnYWluc3QgYW4gdW5leHBlY3RlZCAweDAgZGVmYXVsdC4KICBmdW5jdGlvbiBfYWRkcmVzc05vdE51bGwoYWRkcmVzcyBfdG8pIGludGVybmFsIHB1cmUgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIF90byAhPSBhZGRyZXNzKDApOwogIH0KCiAgLy8vIEBkZXYgIEZvciBjaGVja2luZyBhcHByb3ZhbCBvZiB0cmFuc2ZlciBmb3IgYWRkcmVzcyBfdG8KICBmdW5jdGlvbiBfYXBwcm92ZWQoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Fzc2V0SWQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHByZVNhbGVJdGVtSW5kZXhUb0FwcHJvdmVkW19hc3NldElkXSA9PSBfdG87CiAgfQoKICAvLy8gQGRldiBGb3IgY3JlYXRpbmcgQ1NDIENvbGxlY3RpYmxlCiAgZnVuY3Rpb24gX2NyZWF0ZUNvbGxlY3RpYmxlKGJ5dGVzMzIgX2NvbGxlY3RpYmxlTmFtZSwgYWRkcmVzcyBfb3duZXIpIGludGVybmFsIHJldHVybnModWludDI1NikgewogICAgCiAgICBSYXJlUHJlU2FsZUl0ZW0gbWVtb3J5IF9jb2xsZWN0aWJsZU9iaiA9IFJhcmVQcmVTYWxlSXRlbSgKICAgICAgX2NvbGxlY3RpYmxlTmFtZSwKICAgICAgMCwKICAgICAgYWRkcmVzcygwKSwKICAgICAgZmFsc2UKICAgICk7CgogICAgdWludDI1NiBuZXdDb2xsZWN0aWJsZUlkID0gYWxsUHJlU2FsZUl0ZW1zLnB1c2goX2NvbGxlY3RpYmxlT2JqKSAtIDE7CiAgICAKICAgIC8vIGVtaXQgQ3JlYXRlZCBldmVudAogICAgQ29sbGVjdGlibGVDcmVhdGVkKF9vd25lciwgbmV3Q29sbGVjdGlibGVJZCwgX2NvbGxlY3RpYmxlTmFtZSwgZmFsc2UpOwogICAgCiAgICAvLyBUaGlzIHdpbGwgYXNzaWduIG93bmVyc2hpcCwgYW5kIGFsc28gZW1pdCB0aGUgVHJhbnNmZXIgZXZlbnQgYXMKICAgIC8vIHBlciBFUkM3MjEgZHJhZnQKICAgIF90cmFuc2ZlcihhZGRyZXNzKDApLCBfb3duZXIsIG5ld0NvbGxlY3RpYmxlSWQpOwogICAgCiAgICByZXR1cm4gbmV3Q29sbGVjdGlibGVJZDsKICB9CgogIC8vLyBDaGVjayBmb3IgdG9rZW4gb3duZXJzaGlwCiAgZnVuY3Rpb24gX293bnMoYWRkcmVzcyBjbGFpbWFudCwgdWludDI1NiBfYXNzZXRJZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gY2xhaW1hbnQgPT0gcHJlU2FsZUl0ZW1JbmRleFRvT3duZXJbX2Fzc2V0SWRdOwogIH0KCiAgLy8vIEBkZXYgQXNzaWducyBvd25lcnNoaXAgb2YgYSBzcGVjaWZpYyBFbW9qaSB0byBhbiBhZGRyZXNzLgogIGZ1bmN0aW9uIF90cmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfYXNzZXRJZCkgaW50ZXJuYWwgewogICAgLy8gVXBkYXRpbmcgdGhlIG93bmVyIGRldGFpbHMgb2YgdGhlIHNoaXAKICAgIFJhcmVQcmVTYWxlSXRlbSBtZW1vcnkgX3NoaXBPYmogPSBhbGxQcmVTYWxlSXRlbXNbX2Fzc2V0SWRdOwogICAgX3NoaXBPYmoub3duZXIgPSBfdG87CiAgICBhbGxQcmVTYWxlSXRlbXNbX2Fzc2V0SWRdID0gX3NoaXBPYmo7CgogICAgLy8gU2luY2UgdGhlIG51bWJlciBvZiBlbW9qaXMgaXMgY2FwcGVkIHRvIDJeMzIgd2UgY2FuJ3Qgb3ZlcmZsb3cgdGhpcwogICAgb3duZXJzaGlwVG9rZW5Db3VudFtfdG9dKys7CgogICAgLy90cmFuc2ZlciBvd25lcnNoaXAKICAgIHByZVNhbGVJdGVtSW5kZXhUb093bmVyW19hc3NldElkXSA9IF90bzsKCiAgICAvLyBXaGVuIGNyZWF0aW5nIG5ldyBlbW9qaXMgX2Zyb20gaXMgMHgwLCBidXQgd2UgY2FuJ3QgYWNjb3VudCB0aGF0IGFkZHJlc3MuCiAgICBpZiAoX2Zyb20gIT0gYWRkcmVzcygwKSkgewogICAgICBvd25lcnNoaXBUb2tlbkNvdW50W19mcm9tXS0tOwogICAgICAvLyBjbGVhciBhbnkgcHJldmlvdXNseSBhcHByb3ZlZCBvd25lcnNoaXAgZXhjaGFuZ2UKICAgICAgZGVsZXRlIHByZVNhbGVJdGVtSW5kZXhUb0FwcHJvdmVkW19hc3NldElkXTsKICAgIH0KCiAgICAvLyBFbWl0IHRoZSB0cmFuc2ZlciBldmVudC4KICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF9hc3NldElkKTsKICB9CgogIC8vLyBAZGV2IENoZWNrcyBpZiBhIGdpdmVuIGFkZHJlc3MgY3VycmVudGx5IGhhcyB0cmFuc2ZlckFwcHJvdmFsIGZvciBhIHBhcnRpY3VsYXIgUmFyZVByZVNhbGVJdGVtLgogIC8vLyAwIGlzIGEgdmFsaWQgdmFsdWUgYXMgaXQgd2lsbCBiZSB0aGUgc3RhcnRlcgogIGZ1bmN0aW9uIF9hcHByb3ZlZEZvcihhZGRyZXNzIF9jbGFpbWFudCwgdWludDI1NiBfYXNzZXRJZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgIHJldHVybiBwcmVTYWxlSXRlbUluZGV4VG9BcHByb3ZlZFtfYXNzZXRJZF0gPT0gX2NsYWltYW50OwogIH0KCiAgZnVuY3Rpb24gX2dldENvbGxlY3RpYmxlRGV0YWlscyAodWludDI1NiBfYXNzZXRJZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zKFJhcmVQcmVTYWxlSXRlbSkgewogICAgUmFyZVByZVNhbGVJdGVtIHN0b3JhZ2UgX09iaiA9IGFsbFByZVNhbGVJdGVtc1tfYXNzZXRJZF07CiAgICByZXR1cm4gX09iajsKICB9CgogIC8vLyBAZGV2IEhlbHBzIGluIGZldGNoaW5nIHRoZSBhdHRyaWJ1dGVzIG9mIHRoZSBzaGlwIGRlcGVuZGluZyBvbiB0aGUgc2hpcAogIC8vLyBhc3NldElkIDogVGhlIGFjdHVhbCBFUkM3MjEgQXNzZXQgSUQKICAvLy8gc2VxdWVuY2VJZCA6IEluZGV4IHcuci50IFNoaXAgdHlwZQogIGZ1bmN0aW9uIGdldFNoaXBEZXRhaWxzKHVpbnQyNTYgX2Fzc2V0SWQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoCiAgICB1aW50MjU2IGNvbGxlY3RpYmxlSWQsCiAgICBzdHJpbmcgc2hpcE5hbWUsCiAgICB1aW50MjU2IGJvdWdodFRpbWVzdGFtcCwKICAgIGFkZHJlc3Mgb3duZXIsCiAgICBib29sIGlzUmVkZWVtZWQKICAgICkgewogICAgUmFyZVByZVNhbGVJdGVtIHN0b3JhZ2UgX2NvbGxlY3RpYmxlT2JqID0gYWxsUHJlU2FsZUl0ZW1zW19hc3NldElkXTsKICAgIGNvbGxlY3RpYmxlSWQgPSBfYXNzZXRJZDsKICAgIHNoaXBOYW1lID0gYnl0ZXMzMlRvU3RyaW5nKF9jb2xsZWN0aWJsZU9iai5jb2xsZWN0aWJsZU5hbWUpOwogICAgYm91Z2h0VGltZXN0YW1wID0gX2NvbGxlY3RpYmxlT2JqLmJvdWdodFRpbWVzdGFtcDsKICAgIG93bmVyID0gX2NvbGxlY3RpYmxlT2JqLm93bmVyOwogICAgaXNSZWRlZW1lZCA9IF9jb2xsZWN0aWJsZU9iai5pc1JlZGVlbWVkOwogIH0KfQoKLyogTHVjaWQgU2lnaHQsIEluYy4gRVJDLTcyMSBDU0MgQ29sbGVjdGlsYmUgU2FsZSBDb250cmFjdC4gCiAqIEB0aXRsZSBDU0NDb2xsZWN0aWJsZVNhbGUKICogQGF1dGhvciBGYXpyaSBadWJhaXIgJiBGYXJoYW4gS2h3YWphIChMdWNpZCBTaWdodCwgSW5jLikKICovCmNvbnRyYWN0IENTQ0NvbGxlY3RpYmxlU2FsZSBpcyBDU0NDb2xsZWN0aWJsZUJhc2UgewogIGV2ZW50IFNhbGVXaW5uZXIoYWRkcmVzcyBvd25lciwgdWludDI1NiBjb2xsZWN0aWJsZUlkLCB1aW50MjU2IGJ1eWluZ1ByaWNlKTsKICBldmVudCBDb2xsZWN0aWJsZUJpZFN1Y2Nlc3MoYWRkcmVzcyBvd25lciwgdWludDI1NiBjb2xsZWN0aWJsZUlkLCB1aW50MjU2IG5ld0JpZFByaWNlLCBib29sIGlzQWN0aXZlKTsKICBldmVudCBTYWxlQ3JlYXRlZCh1aW50MjU2IHRva2VuSUQsIHVpbnQyNTYgc3RhcnRpbmdQcmljZSwgdWludDI1NiBlbmRpbmdQcmljZSwgdWludDI1NiBkdXJhdGlvbiwgdWludDY0IHN0YXJ0ZWRBdCwgYm9vbCBpc0FjdGl2ZSwgdWludDI1NiBiaWRQcmljZSk7CgogIC8vICBTSElQIERBVEFUWVBFUyAmIENPTlNUQU5UUwogIHN0cnVjdCBDb2xsZWN0aWJsZVNhbGUgewogICAgLy8gQ3VycmVudCBvd25lciBvZiBORlQgKEVSQzcyMSkKICAgIGFkZHJlc3Mgc2VsbGVyOwogICAgLy8gUHJpY2UgKGluIHdlaSkgYXQgYmVnaW5uaW5nIG9mIHNhbGUgKEZvciBCdXlpbmcpCiAgICB1aW50MjU2IHN0YXJ0aW5nUHJpY2U7CiAgICAvLyBQcmljZSAoaW4gd2VpKSBhdCBlbmQgb2Ygc2FsZSAoRm9yIEJ1eWluZykKICAgIHVpbnQyNTYgZW5kaW5nUHJpY2U7CiAgICAvLyBEdXJhdGlvbiAoaW4gc2Vjb25kcykgb2Ygc2FsZQogICAgdWludDI1NiBkdXJhdGlvbjsKICAgIC8vIFRpbWUgd2hlbiBzYWxlIHN0YXJ0ZWQKICAgIC8vIE5PVEU6IDAgaWYgdGhpcyBzYWxlIGhhcyBiZWVuIGNvbmNsdWRlZAogICAgdWludDY0IHN0YXJ0ZWRBdDsKCiAgICAvLyBGbGFnIGRlbm90aW5nIGlzIHRoZSBTYWxlIHN0aWxsYSBjdGl2ZQogICAgYm9vbCBpc0FjdGl2ZTsKCiAgICAvLyBhZGRyZXNzIG9mIHRoZSB3YWxsZXQgd2hvIGhhZCB0aGUgbWF4QmlkCiAgICBhZGRyZXNzIGhpZ2hlc3RCaWRkZXI7CgogICAgLy8gYWRkcmVzcyBvZiB0aGUgd2FsbGV0IHdobyBib3VnaHQgdGhlIGFzc2V0CiAgICBhZGRyZXNzIGJ1eWVyOwoKICAgIC8vIEVSQzcyMSBBc3NldElECiAgICB1aW50MjU2IHRva2VuSWQ7CiAgfQoKICAvLyBAZGV2IHNoaXAgUHJpY2VzICYgcHJpY2UgY2FwCiAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgU0FMRV9EVVJBVElPTiA9IDI1OTIwMDA7CiAgCiAgLy8vIG1hcHBpbmcgaG9sZGluZyBkZXRhaWxzIG9mIHRoZSBsYXN0IHBlcnNvbiB3aG8gaGFkIGEgc3VjY2Vzc2Z1bGwgYmlkLiB1c2VkIGZvciBnaXZpbmcgYmFjayB0aGUgbGFzdCBiaWQgcHJpY2UgdW50aWwgdGhlIGFzc2V0IGlzIGJvdWdodAogIG1hcHBpbmcodWludDI1NiA9PiBhZGRyZXNzKSBpbmRleFRvQmlkZGVyQWRkcmVzczsKICBtYXBwaW5nKGFkZHJlc3MgPT4gbWFwcGluZyh1aW50MjU2ID0+IHVpbnQyNTYpKSBhZGRyZXNzVG9CaWRWYWx1ZTsKCiAgLy8gQSBtYXAgZnJvbSBhc3NldElkIHRvIHRoZSBiaWQgaW5jcmVtZW50CiAgbWFwcGluZyAoIHVpbnQyNTYgPT4gdWludDI1NiApIGluZGV4VG9QcmljZUluY3JlbWVudDsKICAvLy8gTWFwIGZyb20gYXNzZXRJZCB0byBiaWQgcHJpY2UKICBtYXBwaW5nICggdWludDI1NiA9PiB1aW50MjU2ICkgaW5kZXhUb0JpZFByaWNlOwoKICAvLyBNYXAgZnJvbSB0b2tlbiB0byB0aGVpciBjb3JyZXNwb25kaW5nIHNhbGUuCiAgbWFwcGluZyAodWludDI1NiA9PiBDb2xsZWN0aWJsZVNhbGUpIHRva2VuSWRUb1NhbGU7CgogIC8vLyBAZGV2IEFkZHMgYW4gc2FsZSB0byB0aGUgbGlzdCBvZiBvcGVuIHNhbGVzLiBBbHNvIGZpcmVzIHRoZQogIC8vLyAgU2FsZUNyZWF0ZWQgZXZlbnQuCiAgZnVuY3Rpb24gX2FkZFNhbGUodWludDI1NiBfYXNzZXRJZCwgQ29sbGVjdGlibGVTYWxlIF9zYWxlKSBpbnRlcm5hbCB7CiAgICAgIC8vIFJlcXVpcmUgdGhhdCBhbGwgc2FsZXMgaGF2ZSBhIGR1cmF0aW9uIG9mCiAgICAgIC8vIGF0IGxlYXN0IG9uZSBtaW51dGUuCiAgICAgIHJlcXVpcmUoX3NhbGUuZHVyYXRpb24gPj0gMSBtaW51dGVzKTsKICAgICAgCiAgICAgIHRva2VuSWRUb1NhbGVbX2Fzc2V0SWRdID0gX3NhbGU7CiAgICAgIGluZGV4VG9CaWRQcmljZVtfYXNzZXRJZF0gPSBfc2FsZS5lbmRpbmdQcmljZTsKCiAgICAgIFNhbGVDcmVhdGVkKAogICAgICAgICAgdWludDI1NihfYXNzZXRJZCksCiAgICAgICAgICB1aW50MjU2KF9zYWxlLnN0YXJ0aW5nUHJpY2UpLAogICAgICAgICAgdWludDI1Nihfc2FsZS5lbmRpbmdQcmljZSksCiAgICAgICAgICB1aW50MjU2KF9zYWxlLmR1cmF0aW9uKSwKICAgICAgICAgIHVpbnQ2NChfc2FsZS5zdGFydGVkQXQpLAogICAgICAgICAgX3NhbGUuaXNBY3RpdmUsCiAgICAgICAgICBpbmRleFRvQmlkUHJpY2VbX2Fzc2V0SWRdCiAgICAgICk7CiAgfQoKICAvLy8gQGRldiBSZW1vdmVzIGFuIHNhbGUgZnJvbSB0aGUgbGlzdCBvZiBvcGVuIHNhbGVzLgogIC8vLyBAcGFyYW0gX2Fzc2V0SWQgLSBJRCBvZiB0aGUgdG9rZW4gb24gc2FsZQogIGZ1bmN0aW9uIF9yZW1vdmVTYWxlKHVpbnQyNTYgX2Fzc2V0SWQpIGludGVybmFsIHsKICAgICAgZGVsZXRlIHRva2VuSWRUb1NhbGVbX2Fzc2V0SWRdOwogIH0KCiAgZnVuY3Rpb24gX2JpZCh1aW50MjU2IF9hc3NldElkLCBhZGRyZXNzIF9idXllciwgdWludDI1NiBfYmlkQW1vdW50KSBpbnRlcm5hbCB7CiAgICBDb2xsZWN0aWJsZVNhbGUgc3RvcmFnZSBfc2FsZSA9IHRva2VuSWRUb1NhbGVbX2Fzc2V0SWRdOwogICAgCiAgICByZXF1aXJlKF9iaWRBbW91bnQgPj0gaW5kZXhUb0JpZFByaWNlW19hc3NldElkXSk7CgogICAgdWludDI1NiBfbmV3QmlkUHJpY2UgPSBfYmlkQW1vdW50ICsgaW5kZXhUb1ByaWNlSW5jcmVtZW50W19hc3NldElkXTsKICAgIGluZGV4VG9CaWRQcmljZVtfYXNzZXRJZF0gPSBfbmV3QmlkUHJpY2U7CgogICAgX3NhbGUuaGlnaGVzdEJpZGRlciA9IF9idXllcjsKICAgIF9zYWxlLmVuZGluZ1ByaWNlID0gX25ld0JpZFByaWNlOwoKICAgIGFkZHJlc3MgbGFzdEJpZGRlciA9IGluZGV4VG9CaWRkZXJBZGRyZXNzW19hc3NldElkXTsKICAgIAogICAgaWYobGFzdEJpZGRlciAhPSBhZGRyZXNzKDApKXsKICAgICAgdWludDI1NiBfdmFsdWUgPSBhZGRyZXNzVG9CaWRWYWx1ZVtsYXN0QmlkZGVyXVtfYXNzZXRJZF07CgogICAgICBpbmRleFRvQmlkZGVyQWRkcmVzc1tfYXNzZXRJZF0gPSBfYnV5ZXI7CgogICAgICBhZGRyZXNzVG9CaWRWYWx1ZVtsYXN0QmlkZGVyXVtfYXNzZXRJZF0gPSAwOwogICAgICBhZGRyZXNzVG9CaWRWYWx1ZVtfYnV5ZXJdW19hc3NldElkXSA9IF9iaWRBbW91bnQ7CgogICAgICBsYXN0QmlkZGVyLnRyYW5zZmVyKF92YWx1ZSk7CiAgICB9IGVsc2UgewogICAgICBpbmRleFRvQmlkZGVyQWRkcmVzc1tfYXNzZXRJZF0gPSBfYnV5ZXI7CiAgICAgIGFkZHJlc3NUb0JpZFZhbHVlW19idXllcl1bX2Fzc2V0SWRdID0gX2JpZEFtb3VudDsKICAgIH0KCiAgICAvLyBDaGVjayB0aGF0IHRoZSBiaWQgaXMgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIHRoZSBjdXJyZW50IGJ1eU91dCBwcmljZQogICAgdWludDI1NiBwcmljZSA9IF9jdXJyZW50UHJpY2UoX3NhbGUpOwoKICAgIGlmKF9iaWRBbW91bnQgPj0gcHJpY2UpIHsKICAgICAgX3NhbGUuYnV5ZXIgPSBfYnV5ZXI7CiAgICAgIF9zYWxlLmlzQWN0aXZlID0gZmFsc2U7CgogICAgICBfcmVtb3ZlU2FsZShfYXNzZXRJZCk7CgogICAgICB1aW50MjU2IGJpZEV4Y2VzcyA9IF9iaWRBbW91bnQgLSBwcmljZTsKICAgICAgX2J1eWVyLnRyYW5zZmVyKGJpZEV4Y2Vzcyk7CgogICAgICBTYWxlV2lubmVyKF9idXllciwgX2Fzc2V0SWQsIF9iaWRBbW91bnQpOwogICAgICBfdHJhbnNmZXIoYWRkcmVzcyh0aGlzKSwgX2J1eWVyLCBfYXNzZXRJZCk7CiAgICB9IGVsc2UgewogICAgICB0b2tlbklkVG9TYWxlW19hc3NldElkXSA9IF9zYWxlOwoKICAgICAgQ29sbGVjdGlibGVCaWRTdWNjZXNzKF9idXllciwgX2Fzc2V0SWQsIF9zYWxlLmVuZGluZ1ByaWNlLCBfc2FsZS5pc0FjdGl2ZSk7CiAgICB9CiAgfQoKICAvLy8gQGRldiBSZXR1cm5zIHRydWUgaWYgdGhlIEZUIChFUkM3MjEpIGlzIG9uIHNhbGUuCiAgZnVuY3Rpb24gX2lzT25TYWxlKENvbGxlY3RpYmxlU2FsZSBtZW1vcnkgX3NhbGUpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICByZXR1cm4gKF9zYWxlLnN0YXJ0ZWRBdCA+IDAgJiYgX3NhbGUuaXNBY3RpdmUpOwogIH0KCiAgLy8vIEBkZXYgUmV0dXJucyBjdXJyZW50IHByaWNlIG9mIGEgQ29sbGVjdGlibGUgKEVSQzcyMSkgb24gc2FsZS4gQnJva2VuIGludG8gdHdvCiAgLy8vICBmdW5jdGlvbnMgKHRoaXMgb25lLCB0aGF0IGNvbXB1dGVzIHRoZSBkdXJhdGlvbiBmcm9tIHRoZSBzYWxlCiAgLy8vICBzdHJ1Y3R1cmUsIGFuZCB0aGUgb3RoZXIgdGhhdCBkb2VzIHRoZSBwcmljZSBjb21wdXRhdGlvbikgc28gd2UKICAvLy8gIGNhbiBlYXNpbHkgdGVzdCB0aGF0IHRoZSBwcmljZSBjb21wdXRhdGlvbiB3b3JrcyBjb3JyZWN0bHkuCiAgZnVuY3Rpb24gX2N1cnJlbnRQcmljZShDb2xsZWN0aWJsZVNhbGUgbWVtb3J5IF9zYWxlKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgdWludDI1NiBzZWNvbmRzUGFzc2VkID0gMDsKCiAgICAgIC8vIEEgYml0IG9mIGluc3VyYW5jZSBhZ2FpbnN0IG5lZ2F0aXZlIHZhbHVlcyAob3Igd3JhcGFyb3VuZCkuCiAgICAgIC8vIFByb2JhYmx5IG5vdCBuZWNlc3NhcnkgKHNpbmNlIEV0aGVyZXVtIGd1YXJuYXRlZXMgdGhhdCB0aGUKICAgICAgLy8gbm93IHZhcmlhYmxlIGRvZXNuJ3QgZXZlciBnbyBiYWNrd2FyZHMpLgogICAgICBpZiAobm93ID4gX3NhbGUuc3RhcnRlZEF0KSB7CiAgICAgICAgICBzZWNvbmRzUGFzc2VkID0gbm93IC0gX3NhbGUuc3RhcnRlZEF0OwogICAgICB9CgogICAgICByZXR1cm4gX2NvbXB1dGVDdXJyZW50UHJpY2UoCiAgICAgICAgICBfc2FsZS5zdGFydGluZ1ByaWNlLAogICAgICAgICAgX3NhbGUuZW5kaW5nUHJpY2UsCiAgICAgICAgICBfc2FsZS5kdXJhdGlvbiwKICAgICAgICAgIHNlY29uZHNQYXNzZWQKICAgICAgKTsKICB9CgogIC8vLyBAZGV2IENvbXB1dGVzIHRoZSBjdXJyZW50IHByaWNlIG9mIGFuIHNhbGUuIEZhY3RvcmVkIG91dAogIC8vLyAgZnJvbSBfY3VycmVudFByaWNlIHNvIHdlIGNhbiBydW4gZXh0ZW5zaXZlIHVuaXQgdGVzdHMuCiAgLy8vICBXaGVuIHRlc3RpbmcsIG1ha2UgdGhpcyBmdW5jdGlvbiBwdWJsaWMgYW5kIHR1cm4gb24KICAvLy8gIGBDdXJyZW50IHByaWNlIGNvbXB1dGF0aW9uYCB0ZXN0IHN1aXRlLgogIGZ1bmN0aW9uIF9jb21wdXRlQ3VycmVudFByaWNlKHVpbnQyNTYgX3N0YXJ0aW5nUHJpY2UsIHVpbnQyNTYgX2VuZGluZ1ByaWNlLCB1aW50MjU2IF9kdXJhdGlvbiwgdWludDI1NiBfc2Vjb25kc1Bhc3NlZCkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgIC8vIE5PVEU6IFdlIGRvbid0IHVzZSBTYWZlTWF0aCAob3Igc2ltaWxhcikgaW4gdGhpcyBmdW5jdGlvbiBiZWNhdXNlCiAgICAgIC8vICBhbGwgb2Ygb3VyIHB1YmxpYyBmdW5jdGlvbnMgY2FyZWZ1bGx5IGNhcCB0aGUgbWF4aW11bSB2YWx1ZXMgZm9yCiAgICAgIC8vICB0aW1lIChhdCA2NC1iaXRzKSBhbmQgY3VycmVuY3kgKGF0IDEyOC1iaXRzKS4gX2R1cmF0aW9uIGlzCiAgICAgIC8vICBhbHNvIGtub3duIHRvIGJlIG5vbi16ZXJvIChzZWUgdGhlIHJlcXVpcmUoKSBzdGF0ZW1lbnQgaW4KICAgICAgLy8gIF9hZGRTYWxlKCkpCiAgICAgIGlmIChfc2Vjb25kc1Bhc3NlZCA+PSBfZHVyYXRpb24pIHsKICAgICAgICAgIC8vIFdlJ3ZlIHJlYWNoZWQgdGhlIGVuZCBvZiB0aGUgZHluYW1pYyBwcmljaW5nIHBvcnRpb24KICAgICAgICAgIC8vIG9mIHRoZSBzYWxlLCBqdXN0IHJldHVybiB0aGUgZW5kIHByaWNlLgogICAgICAgICAgcmV0dXJuIF9lbmRpbmdQcmljZTsKICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIFN0YXJ0aW5nIHByaWNlIGNhbiBiZSBoaWdoZXIgdGhhbiBlbmRpbmcgcHJpY2UgKGFuZCBvZnRlbiBpcyEpLCBzbwogICAgICAgICAgLy8gdGhpcyBkZWx0YSBjYW4gYmUgbmVnYXRpdmUuCiAgICAgICAgICBpbnQyNTYgdG90YWxQcmljZUNoYW5nZSA9IGludDI1NihfZW5kaW5nUHJpY2UpIC0gaW50MjU2KF9zdGFydGluZ1ByaWNlKTsKCiAgICAgICAgICAvLyBUaGlzIG11bHRpcGxpY2F0aW9uIGNhbid0IG92ZXJmbG93LCBfc2Vjb25kc1Bhc3NlZCB3aWxsIGVhc2lseSBmaXQgd2l0aGluCiAgICAgICAgICAvLyA2NC1iaXRzLCBhbmQgdG90YWxQcmljZUNoYW5nZSB3aWxsIGVhc2lseSBmaXQgd2l0aGluIDEyOC1iaXRzLCB0aGVpciBwcm9kdWN0CiAgICAgICAgICAvLyB3aWxsIGFsd2F5cyBmaXQgd2l0aGluIDI1Ni1iaXRzLgogICAgICAgICAgaW50MjU2IGN1cnJlbnRQcmljZUNoYW5nZSA9IHRvdGFsUHJpY2VDaGFuZ2UgKiBpbnQyNTYoX3NlY29uZHNQYXNzZWQpIC8gaW50MjU2KF9kdXJhdGlvbik7CgogICAgICAgICAgLy8gY3VycmVudFByaWNlQ2hhbmdlIGNhbiBiZSBuZWdhdGl2ZSwgYnV0IGlmIHNvLCB3aWxsIGhhdmUgYSBtYWduaXR1ZGUKICAgICAgICAgIC8vIGxlc3MgdGhhdCBfc3RhcnRpbmdQcmljZS4gVGh1cywgdGhpcyByZXN1bHQgd2lsbCBhbHdheXMgZW5kIHVwIHBvc2l0aXZlLgogICAgICAgICAgaW50MjU2IGN1cnJlbnRQcmljZSA9IGludDI1Nihfc3RhcnRpbmdQcmljZSkgKyBjdXJyZW50UHJpY2VDaGFuZ2U7CgogICAgICAgICAgcmV0dXJuIHVpbnQyNTYoY3VycmVudFByaWNlKTsKICAgICAgfQogIH0KICAKICAvLy8gQGRldiBFc2Nyb3dzIHRoZSBFUkM3MjEgVG9rZW4sIGFzc2lnbmluZyBvd25lcnNoaXAgdG8gdGhpcyBjb250cmFjdC4KICAvLy8gVGhyb3dzIGlmIHRoZSBlc2Nyb3cgZmFpbHMuCiAgZnVuY3Rpb24gX2VzY3JvdyhhZGRyZXNzIF9vd25lciwgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgewogICAgdHJhbnNmZXJGcm9tKF9vd25lciwgdGhpcywgX3Rva2VuSWQpOwogIH0KCiAgZnVuY3Rpb24gZ2V0QnV5UHJpY2UodWludDI1NiBfYXNzZXRJZCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zKHVpbnQyNTYgX3ByaWNlKXsKICAgIENvbGxlY3RpYmxlU2FsZSBtZW1vcnkgX3NhbGUgPSB0b2tlbklkVG9TYWxlW19hc3NldElkXTsKICAgIAogICAgcmV0dXJuIF9jdXJyZW50UHJpY2UoX3NhbGUpOwogIH0KICAKICBmdW5jdGlvbiBnZXRCaWRQcmljZSh1aW50MjU2IF9hc3NldElkKSBleHRlcm5hbCB2aWV3IHJldHVybnModWludDI1NiBfcHJpY2UpewogICAgcmV0dXJuIGluZGV4VG9CaWRQcmljZVtfYXNzZXRJZF07CiAgfQoKICAvLy8gQGRldiBDcmVhdGVzIGFuZCBiZWdpbnMgYSBuZXcgc2FsZS4KICBmdW5jdGlvbiBfY3JlYXRlU2FsZSh1aW50MjU2IF90b2tlbklkLCB1aW50MjU2IF9zdGFydGluZ1ByaWNlLCB1aW50MjU2IF9lbmRpbmdQcmljZSwgdWludDY0IF9kdXJhdGlvbiwgYWRkcmVzcyBfc2VsbGVyKSBpbnRlcm5hbCB7CiAgICAgIC8vIFNhbml0eSBjaGVjayB0aGF0IG5vIGlucHV0cyBvdmVyZmxvdyBob3cgbWFueSBiaXRzIHdlJ3ZlIGFsbG9jYXRlZAogICAgICAvLyB0byBzdG9yZSB0aGVtIGluIHRoZSBzYWxlIHN0cnVjdC4KICAgICAgcmVxdWlyZShfc3RhcnRpbmdQcmljZSA9PSB1aW50MjU2KHVpbnQxMjgoX3N0YXJ0aW5nUHJpY2UpKSk7CiAgICAgIHJlcXVpcmUoX2VuZGluZ1ByaWNlID09IHVpbnQyNTYodWludDEyOChfZW5kaW5nUHJpY2UpKSk7CiAgICAgIHJlcXVpcmUoX2R1cmF0aW9uID09IHVpbnQyNTYodWludDY0KF9kdXJhdGlvbikpKTsKCiAgICAgIENvbGxlY3RpYmxlU2FsZSBtZW1vcnkgc2FsZSA9IENvbGxlY3RpYmxlU2FsZSgKICAgICAgICAgIF9zZWxsZXIsCiAgICAgICAgICB1aW50MTI4KF9zdGFydGluZ1ByaWNlKSwKICAgICAgICAgIHVpbnQxMjgoX2VuZGluZ1ByaWNlKSwKICAgICAgICAgIHVpbnQ2NChfZHVyYXRpb24pLAogICAgICAgICAgdWludDY0KG5vdyksCiAgICAgICAgICB0cnVlLAogICAgICAgICAgYWRkcmVzcyh0aGlzKSwKICAgICAgICAgIGFkZHJlc3ModGhpcyksCiAgICAgICAgICB1aW50MjU2KF90b2tlbklkKQogICAgICApOwogICAgICBfYWRkU2FsZShfdG9rZW5JZCwgc2FsZSk7CiAgfQoKICBmdW5jdGlvbiBfYnV5KHVpbnQyNTYgX2Fzc2V0SWQsIGFkZHJlc3MgX2J1eWVyLCB1aW50MjU2IF9wcmljZSkgaW50ZXJuYWwgewoKICAgIENvbGxlY3RpYmxlU2FsZSBzdG9yYWdlIF9zYWxlID0gdG9rZW5JZFRvU2FsZVtfYXNzZXRJZF07CiAgICBhZGRyZXNzIGxhc3RCaWRkZXIgPSBpbmRleFRvQmlkZGVyQWRkcmVzc1tfYXNzZXRJZF07CiAgICAKICAgIGlmKGxhc3RCaWRkZXIgIT0gYWRkcmVzcygwKSl7CiAgICAgIHVpbnQyNTYgX3ZhbHVlID0gYWRkcmVzc1RvQmlkVmFsdWVbbGFzdEJpZGRlcl1bX2Fzc2V0SWRdOwoKICAgICAgaW5kZXhUb0JpZGRlckFkZHJlc3NbX2Fzc2V0SWRdID0gX2J1eWVyOwoKICAgICAgYWRkcmVzc1RvQmlkVmFsdWVbbGFzdEJpZGRlcl1bX2Fzc2V0SWRdID0gMDsKICAgICAgYWRkcmVzc1RvQmlkVmFsdWVbX2J1eWVyXVtfYXNzZXRJZF0gPSBfcHJpY2U7CgogICAgICBsYXN0QmlkZGVyLnRyYW5zZmVyKF92YWx1ZSk7CiAgICB9CgogICAgLy8gQ2hlY2sgdGhhdCB0aGUgYmlkIGlzIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byB0aGUgY3VycmVudCBidXlPdXQgcHJpY2UKICAgIHVpbnQyNTYgY3VycmVudFByaWNlID0gX2N1cnJlbnRQcmljZShfc2FsZSk7CgogICAgcmVxdWlyZShfcHJpY2UgPj0gY3VycmVudFByaWNlKTsKICAgIF9zYWxlLmJ1eWVyID0gX2J1eWVyOwogICAgX3NhbGUuaXNBY3RpdmUgPSBmYWxzZTsKCiAgICBfcmVtb3ZlU2FsZShfYXNzZXRJZCk7CgogICAgdWludDI1NiBiaWRFeGNlc3MgPSBfcHJpY2UgLSBjdXJyZW50UHJpY2U7CiAgICBfYnV5ZXIudHJhbnNmZXIoYmlkRXhjZXNzKTsKCiAgICBTYWxlV2lubmVyKF9idXllciwgX2Fzc2V0SWQsIF9wcmljZSk7CiAgICBfdHJhbnNmZXIoYWRkcmVzcyh0aGlzKSwgX2J1eWVyLCBfYXNzZXRJZCk7CiAgfQoKICAvLy8gQGRldiBSZXR1cm5zIHNhbGVzIGluZm8gZm9yIGFuIENTTENvbGxlY3RpYmxlcyAoRVJDNzIxKSBvbiBzYWxlLgogIC8vLyBAcGFyYW0gX2Fzc2V0SWQgLSBJRCBvZiB0aGUgdG9rZW4gb24gc2FsZQogIGZ1bmN0aW9uIGdldFNhbGUodWludDI1NiBfYXNzZXRJZCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChhZGRyZXNzIHNlbGxlciwgdWludDI1NiBzdGFydGluZ1ByaWNlLCB1aW50MjU2IGVuZGluZ1ByaWNlLCB1aW50MjU2IGR1cmF0aW9uLCB1aW50MjU2IHN0YXJ0ZWRBdCwgYm9vbCBpc0FjdGl2ZSwgYWRkcmVzcyBvd25lciwgYWRkcmVzcyBoaWdoZXN0QmlkZGVyKSB7CiAgICAgIENvbGxlY3RpYmxlU2FsZSBtZW1vcnkgc2FsZSA9IHRva2VuSWRUb1NhbGVbX2Fzc2V0SWRdOwogICAgICByZXF1aXJlKF9pc09uU2FsZShzYWxlKSk7CiAgICAgIHJldHVybiAoCiAgICAgICAgICBzYWxlLnNlbGxlciwKICAgICAgICAgIHNhbGUuc3RhcnRpbmdQcmljZSwKICAgICAgICAgIHNhbGUuZW5kaW5nUHJpY2UsCiAgICAgICAgICBzYWxlLmR1cmF0aW9uLAogICAgICAgICAgc2FsZS5zdGFydGVkQXQsCiAgICAgICAgICBzYWxlLmlzQWN0aXZlLAogICAgICAgICAgc2FsZS5idXllciwKICAgICAgICAgIHNhbGUuaGlnaGVzdEJpZGRlcgogICAgICApOwogIH0KfQoKLyogTHVjaWQgU2lnaHQsIEluYy4gRVJDLTcyMSBDb2xsZWN0aWJsZXMuIAogKiBAdGl0bGUgTFNORlQgLSBMdWNpZCBTaWdodCwgSW5jLiBOb24tRnVuZ2libGUgVG9rZW4KICogQGF1dGhvciBGYXpyaSBadWJhaXIgJiBGYXJoYW4gS2h3YWphIChMdWNpZCBTaWdodCwgSW5jLikKICovCmNvbnRyYWN0IENTQ1JhcmVQcmVTYWxlTWFuYWdlciBpcyBDU0NDb2xsZWN0aWJsZVNhbGUgewogIGV2ZW50IFJlZnVuZENsYWltZWQoYWRkcmVzcyBvd25lcik7CgogIGJvb2wgQ1NDUHJlU2FsZUluaXQgPSBmYWxzZTsKCiAgLy8vIEBkZXYgQ29uc3RydWN0b3IgY3JlYXRlcyBhIHJlZmVyZW5jZSB0byB0aGUgTkZUIChFUkM3MjEpIG93bmVyc2hpcCBjb250cmFjdAogIGZ1bmN0aW9uIENTQ1JhcmVQcmVTYWxlTWFuYWdlcigpIHB1YmxpYyB7CiAgICAgIHJlcXVpcmUobXNnLnNlbmRlciAhPSBhZGRyZXNzKDApKTsKICAgICAgcGF1c2VkID0gdHJ1ZTsKICAgICAgZXJyb3IgPSBmYWxzZTsKICAgICAgZ2FtZU1hbmFnZXJQcmltYXJ5ID0gbXNnLnNlbmRlcjsKICB9CgogIGZ1bmN0aW9uIGFkZFRvQXBwcm92ZWRBZGRyZXNzIChhZGRyZXNzIF9uZXdBZGRyKSBvbmx5R2FtZU1hbmFnZXIgewogICAgcmVxdWlyZShfbmV3QWRkciAhPSBhZGRyZXNzKDApKTsKICAgIHJlcXVpcmUoIWFwcHJvdmVkQWRkcmVzc0xpc3RbX25ld0FkZHJdKTsKICAgIGFwcHJvdmVkQWRkcmVzc0xpc3RbX25ld0FkZHJdID0gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIHJlbW92ZUZyb21BcHByb3ZlZEFkZHJlc3MgKGFkZHJlc3MgX25ld0FkZHIpIG9ubHlHYW1lTWFuYWdlciB7CiAgICByZXF1aXJlKF9uZXdBZGRyICE9IGFkZHJlc3MoMCkpOwogICAgcmVxdWlyZShhcHByb3ZlZEFkZHJlc3NMaXN0W19uZXdBZGRyXSk7CiAgICBhcHByb3ZlZEFkZHJlc3NMaXN0W19uZXdBZGRyXSA9IGZhbHNlOwogIH0KCiAgZnVuY3Rpb24gY3JlYXRlUHJlU2FsZVNoaXAoc3RyaW5nIGNvbGxlY3RpYmxlTmFtZSwgdWludDI1NiBzdGFydGluZ1ByaWNlLCB1aW50MjU2IGJpZFByaWNlKSB3aGVuTm90UGF1c2VkIHJldHVybnMgKHVpbnQyNTYpewogICAgcmVxdWlyZShhcHByb3ZlZEFkZHJlc3NMaXN0W21zZy5zZW5kZXJdIHx8IG1zZy5zZW5kZXIgPT0gZ2FtZU1hbmFnZXJQcmltYXJ5IHx8IG1zZy5zZW5kZXIgPT0gZ2FtZU1hbmFnZXJTZWNvbmRhcnkpOwogICAgCiAgICB1aW50MjU2IGFzc2V0SWQgPSBfY3JlYXRlQ29sbGVjdGlibGUoc3RyaW5nVG9CeXRlczMyKGNvbGxlY3RpYmxlTmFtZSksIGFkZHJlc3ModGhpcykpOwoKICAgIGluZGV4VG9QcmljZUluY3JlbWVudFthc3NldElkXSA9IGJpZFByaWNlOwoKICAgIF9jcmVhdGVTYWxlKGFzc2V0SWQsIHN0YXJ0aW5nUHJpY2UsIGJpZFByaWNlLCB1aW50NjQoU0FMRV9EVVJBVElPTiksIGFkZHJlc3ModGhpcykpOwogIH0KCiAgZnVuY3Rpb24oKSBleHRlcm5hbCBwYXlhYmxlIHsKICB9CgogIC8vLyBAZGV2IEJpZCBGdW5jdGlvbiB3aGljaCBjYWxsIHRoZSBpbnRlcm5jYWwgYmlkIGZ1bmN0aW9uCiAgLy8vIGFmdGVyIGRvaW5nIGFsbCB0aGUgcHJlLWNoZWNrcyByZXF1aXJlZCB0byBpbml0aWF0ZSBhIGJpZAogIGZ1bmN0aW9uIGJpZCh1aW50MjU2IF9hc3NldElkKSBleHRlcm5hbCB3aGVuTm90UGF1c2VkIHBheWFibGUgewogICAgcmVxdWlyZShtc2cuc2VuZGVyICE9IGFkZHJlc3MoMCkpOwogICAgcmVxdWlyZShtc2cuc2VuZGVyICE9IGFkZHJlc3ModGhpcykpOwogICAgQ29sbGVjdGlibGVTYWxlIG1lbW9yeSBfc2FsZSA9IHRva2VuSWRUb1NhbGVbX2Fzc2V0SWRdOwogICAgcmVxdWlyZShfaXNPblNhbGUoX3NhbGUpKTsKICAgIAogICAgYWRkcmVzcyBzZWxsZXIgPSBfc2FsZS5zZWxsZXI7CgogICAgX2JpZChfYXNzZXRJZCwgbXNnLnNlbmRlciwgbXNnLnZhbHVlKTsKICB9CgogIC8vLyBAZGV2IEJ1eU5vdyBGdW5jdGlvbiB3aGljaCBjYWxsIHRoZSBpbnRlcm5jYWwgYnV5IGZ1bmN0aW9uCiAgLy8vIGFmdGVyIGRvaW5nIGFsbCB0aGUgcHJlLWNoZWNrcyByZXF1aXJlZCB0byBpbml0aWF0ZSBhIGJ1eQogIGZ1bmN0aW9uIGJ1eU5vdyh1aW50MjU2IF9hc3NldElkKSBleHRlcm5hbCB3aGVuTm90UGF1c2VkIHBheWFibGUgewogICAgcmVxdWlyZShtc2cuc2VuZGVyICE9IGFkZHJlc3MoMCkpOwogICAgcmVxdWlyZShtc2cuc2VuZGVyICE9IGFkZHJlc3ModGhpcykpOwogICAgQ29sbGVjdGlibGVTYWxlIG1lbW9yeSBfc2FsZSA9IHRva2VuSWRUb1NhbGVbX2Fzc2V0SWRdOwogICAgcmVxdWlyZShfaXNPblNhbGUoX3NhbGUpKTsKICAgIAogICAgYWRkcmVzcyBzZWxsZXIgPSBfc2FsZS5zZWxsZXI7CgogICAgX2J1eShfYXNzZXRJZCwgbXNnLnNlbmRlciwgbXNnLnZhbHVlKTsKICB9CgogIC8vLyBAZGV2IE92ZXJyaWRlIHVucGF1c2Ugc28gaXQgcmVxdWlyZXMgYWxsIGV4dGVybmFsIGNvbnRyYWN0IGFkZHJlc3NlcwogIC8vLyAgdG8gYmUgc2V0IGJlZm9yZSBjb250cmFjdCBjYW4gYmUgdW5wYXVzZWQuIEFsc28sIHdlIGNhbid0IGhhdmUKICAvLy8gIG5ld0NvbnRyYWN0QWRkcmVzcyBzZXQgZWl0aGVyLCBiZWNhdXNlIHRoZW4gdGhlIGNvbnRyYWN0IHdhcyB1cGdyYWRlZC4KICAvLy8gQG5vdGljZSBUaGlzIGlzIHB1YmxpYyByYXRoZXIgdGhhbiBleHRlcm5hbCBzbyB3ZSBjYW4gY2FsbCBzdXBlci51bnBhdXNlCiAgLy8vICB3aXRob3V0IHVzaW5nIGFuIGV4cGVuc2l2ZSBDQUxMLgogIGZ1bmN0aW9uIHVucGF1c2UoKSBwdWJsaWMgb25seUdhbWVNYW5hZ2VyIHdoZW5QYXVzZWQgewogICAgICAvLyBBY3R1YWxseSB1bnBhdXNlIHRoZSBjb250cmFjdC4KICAgICAgc3VwZXIudW5wYXVzZSgpOwogIH0KCiAgLy8vIEBkZXYgUmVtb3ZlIGFsbCBFdGhlciBmcm9tIHRoZSBjb250cmFjdCwgd2hpY2ggaXMgdGhlIG93bmVyJ3MgY3V0cwogIC8vLyAgYXMgd2VsbCBhcyBhbnkgRXRoZXIgc2VudCBkaXJlY3RseSB0byB0aGUgY29udHJhY3QgYWRkcmVzcy4KICAvLy8gIEFsd2F5cyB0cmFuc2ZlcnMgdG8gdGhlIE5GVCAoRVJDNzIxKSBjb250cmFjdCwgYnV0IGNhbiBiZSBjYWxsZWQgZWl0aGVyIGJ5CiAgLy8vICB0aGUgb3duZXIgb3IgdGhlIE5GVCAoRVJDNzIxKSBjb250cmFjdC4KICBmdW5jdGlvbiB3aXRoZHJhd0JhbGFuY2UoKSBvbmx5QmFua2VyIHsKICAgICAgLy8gV2UgYXJlIHVzaW5nIHRoaXMgYm9vbGVhbiBtZXRob2QgdG8gbWFrZSBzdXJlIHRoYXQgZXZlbiBpZiBvbmUgZmFpbHMgaXQgd2lsbCBzdGlsbCB3b3JrCiAgICAgIGJhbmtNYW5hZ2VyLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgfQogIAogIGZ1bmN0aW9uIHByZVNhbGVJbml0KCkgb25seUdhbWVNYW5hZ2VyIHsKICAgIHJlcXVpcmUoIUNTQ1ByZVNhbGVJbml0KTsKICAgIHJlcXVpcmUoYWxsUHJlU2FsZUl0ZW1zLmxlbmd0aCA9PSAwKTsKICAgICAgCiAgICBDU0NQcmVTYWxlSW5pdCA9IHRydWU7CgogICAgYnl0ZXMzMls2XSBtZW1vcnkgYXR0cmlidXRlcyA9IFtieXRlczMyKDk5OSksIGJ5dGVzMzIoOTk5KSwgYnl0ZXMzMig5OTkpLCBieXRlczMyKDk5OSksIGJ5dGVzMzIoOTk5KSwgYnl0ZXMzMig5OTkpXTsKICAgIC8vRmlsbCBpbiBpbmRleCAwIHRvIG51bGwgcmVxdWVzdHMKICAgIFJhcmVQcmVTYWxlSXRlbSBtZW1vcnkgX09iaiA9IFJhcmVQcmVTYWxlSXRlbShzdHJpbmdUb0J5dGVzMzIoIkR1bW15IiksIDAsIGFkZHJlc3ModGhpcyksIHRydWUpOwogICAgYWxsUHJlU2FsZUl0ZW1zLnB1c2goX09iaik7CiAgfSAKfQ=='.
	

]
