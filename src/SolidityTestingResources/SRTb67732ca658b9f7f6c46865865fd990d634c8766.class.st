Class {
	#name : #SRTb67732ca658b9f7f6c46865865fd990d634c8766,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTb67732ca658b9f7f6c46865865fd990d634c8766 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgoKbGlicmFyeSBTYWZlTWF0aCB7CiAgICBmdW5jdGlvbiBtdWwodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICB1aW50IGMgPSBhICogYjsKICAgICAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGZ1bmN0aW9uIGRpdih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgICAgIHVpbnQgYyA9IGEgLyBiOwogICAgICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICAgICAgcmV0dXJuIGM7CiAgICB9CgogICAgZnVuY3Rpb24gc3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgYXNzZXJ0KGIgPD0gYSk7CiAgICAgICAgcmV0dXJuIGEgLSBiOwogICAgfQoKICAgIGZ1bmN0aW9uIGFkZCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgYyA9IGEgKyBiOwogICAgICAgIGFzc2VydChjID49IGEpOwogICAgICAgIHJldHVybiBjOwogICAgfQoKfQpjb250cmFjdCBPd25hYmxlIHsKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwoKCiAgICAvKioKICAgICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAgICogYWNjb3VudC4KICAgICAqLwogICAgZnVuY3Rpb24gT3duYWJsZSgpIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9CgoKICAgIC8qKgogICAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAgICovCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQoKCiAgICAvKioKICAgICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgb3duZXIgPSBuZXdPd25lcjsKICAgIH0KCn0KY29udHJhY3QgRVJDMjAgewogICAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwogICAgZXZlbnQgQnVybihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgdWludDI1NiB2YWx1ZSk7Cn0KY29udHJhY3QgUk9LVG9rZW4gaXMgRVJDMjAsIE93bmFibGUgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBuYW1lID0gIlJPSyBUb2tlbiI7CiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IHN5bWJvbCA9ICJST0siOwogICAgdWludDggcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gMTg7CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBJTklUSUFMX1NVUFBMWSA9IDEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDsKCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGludGVybmFsIGFsbG93ZWQ7CgogICAgLyoqCiAgKiBAZGV2IENvbnRydWN0b3IgdGhhdCBnaXZlcyBtc2cuc2VuZGVyIGFsbCBvZiBleGlzdGluZyB0b2tlbnMuCiAgKi8KICAgIGZ1bmN0aW9uIFJPS1Rva2VuKCkgewogICAgICAgIHRvdGFsU3VwcGx5ID0gSU5JVElBTF9TVVBQTFk7CiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBJTklUSUFMX1NVUFBMWTsKICAgIH0KCgogICAgLyoqCiAgICAqIEBkZXYgdHJhbnNmZXIgdG9rZW4gZm9yIGEgc3BlY2lmaWVkIGFkZHJlc3MKICAgICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0by4KICAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF92YWx1ZSA8PSBiYWxhbmNlc1ttc2cuc2VuZGVyXSk7CgogICAgICAgIC8vIFNhZmVNYXRoLnN1YiB3aWxsIHRocm93IGlmIHRoZXJlIGlzIG5vdCBlbm91Z2ggYmFsYW5jZS4KICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAgICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0byBxdWVyeSB0aGUgdGhlIGJhbGFuY2Ugb2YuCiAgICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgICAqLwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgICB9CiAgICAvKioKICAgICAqIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlcgogICAgICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gc2VuZCB0b2tlbnMgZnJvbQogICAgICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHRyYW5zZmVyIHRvCiAgICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgdGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF92YWx1ZSA8PSBiYWxhbmNlc1tfZnJvbV0pOwogICAgICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdKTsKCiAgICAgICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQXBwcm92ZSB0aGUgcGFzc2VkIGFkZHJlc3MgdG8gc3BlbmQgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIG9uIGJlaGFsZiBvZiBtc2cuc2VuZGVyLgogICAgICoKICAgICAqIEJld2FyZSB0aGF0IGNoYW5naW5nIGFuIGFsbG93YW5jZSB3aXRoIHRoaXMgbWV0aG9kIGJyaW5ncyB0aGUgcmlzayB0aGF0IHNvbWVvbmUgbWF5IHVzZSBib3RoIHRoZSBvbGQKICAgICAqIGFuZCB0aGUgbmV3IGFsbG93YW5jZSBieSB1bmZvcnR1bmF0ZSB0cmFuc2FjdGlvbiBvcmRlcmluZy4gT25lIHBvc3NpYmxlIHNvbHV0aW9uIHRvIG1pdGlnYXRlIHRoaXMKICAgICAqIHJhY2UgY29uZGl0aW9uIGlzIHRvIGZpcnN0IHJlZHVjZSB0aGUgc3BlbmRlcidzIGFsbG93YW5jZSB0byAwIGFuZCBzZXQgdGhlIGRlc2lyZWQgdmFsdWUgYWZ0ZXJ3YXJkczoKICAgICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHNwZW50LgogICAgICovCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIHVubG9ja1RyYW5zZmVyKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewoKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgICAqIEBwYXJhbSBfb3duZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCBvd25zIHRoZSBmdW5kcy4KICAgICAqIEBwYXJhbSBfc3BlbmRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAgICogQHJldHVybiBBIHVpbnQyNTYgc3BlY2lmeWluZyB0aGUgYW1vdW50IG9mIHRva2VucyBzdGlsbCBhdmFpbGFibGUgZm9yIHRoZSBzcGVuZGVyLgogICAgICovCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogICAgfQoKICAgIC8qKgogICAgICogYXBwcm92ZSBzaG91bGQgYmUgY2FsbGVkIHdoZW4gYWxsb3dlZFtfc3BlbmRlcl0gPT0gMC4gVG8gaW5jcmVtZW50CiAgICAgKiBhbGxvd2VkIHZhbHVlIGlzIGJldHRlciB0byB1c2UgdGhpcyBmdW5jdGlvbiB0byBhdm9pZCAyIGNhbGxzIChhbmQgd2FpdCB1bnRpbAogICAgICogdGhlIGZpcnN0IHRyYW5zYWN0aW9uIGlzIG1pbmVkKQogICAgICogRnJvbSBNb25vbGl0aERBTyBUb2tlbi5zb2wKICAgICAqLwogICAgZnVuY3Rpb24gaW5jcmVhc2VBcHByb3ZhbCAoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYWRkZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0uYWRkKF9hZGRlZFZhbHVlKTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGRlY3JlYXNlQXBwcm92YWwgKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3N1YnRyYWN0ZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHVpbnQgb2xkVmFsdWUgPSBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXTsKICAgICAgICBpZiAoX3N1YnRyYWN0ZWRWYWx1ZSA+IG9sZFZhbHVlKSB7CiAgICAgICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IG9sZFZhbHVlLnN1Yihfc3VidHJhY3RlZFZhbHVlKTsKICAgICAgICB9CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBidXJuKHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKXsKICAgICAgICByZXF1aXJlKF92YWx1ZSA+IDApOwogICAgICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGJhbGFuY2VzW21zZy5zZW5kZXJdKTsKICAgICAgICAvLyBubyBuZWVkIHRvIHJlcXVpcmUgdmFsdWUgPD0gdG90YWxTdXBwbHksIHNpbmNlIHRoYXQgd291bGQgaW1wbHkgdGhlCiAgICAgICAgLy8gc2VuZGVyJ3MgYmFsYW5jZSBpcyBncmVhdGVyIHRoYW4gdGhlIHRvdGFsU3VwcGx5LCB3aGljaCAqc2hvdWxkKiBiZSBhbiBhc3NlcnRpb24gZmFpbHVyZQoKICAgICAgICBhZGRyZXNzIGJ1cm5lciA9IG1zZy5zZW5kZXI7CiAgICAgICAgYmFsYW5jZXNbYnVybmVyXSA9IGJhbGFuY2VzW2J1cm5lcl0uc3ViKF92YWx1ZSk7CiAgICAgICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5zdWIoX3ZhbHVlKTsKICAgICAgICBCdXJuKGJ1cm5lciwgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KfQpjb250cmFjdCBQYXVzYWJsZSBpcyBPd25hYmxlIHsKICAgIGV2ZW50IFBhdXNlKCk7CgogICAgZXZlbnQgVW5wYXVzZSgpOwoKICAgIGJvb2wgcHVibGljIHBhdXNlZCA9IGZhbHNlOwoKCiAgICAvKioKICAgICAqIEBkZXYgbW9kaWZpZXIgdG8gYWxsb3cgYWN0aW9ucyBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IElTIHBhdXNlZAogICAgICovCiAgICBtb2RpZmllciB3aGVuTm90UGF1c2VkKCkgewogICAgICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgbW9kaWZpZXIgdG8gYWxsb3cgYWN0aW9ucyBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IElTIE5PVCBwYXVzZWQKICAgICAqLwogICAgbW9kaWZpZXIgd2hlblBhdXNlZCgpIHsKICAgICAgICByZXF1aXJlKHBhdXNlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byBwYXVzZSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAgICovCiAgICBmdW5jdGlvbiBwYXVzZSgpIG9ubHlPd25lciB3aGVuTm90UGF1c2VkIHsKICAgICAgICBwYXVzZWQgPSB0cnVlOwogICAgICAgIFBhdXNlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gdW5wYXVzZSwgcmV0dXJucyB0byBub3JtYWwgc3RhdGUKICAgICAqLwogICAgZnVuY3Rpb24gdW5wYXVzZSgpIG9ubHlPd25lciB3aGVuUGF1c2VkIHsKICAgICAgICBwYXVzZWQgPSBmYWxzZTsKICAgICAgICBVbnBhdXNlKCk7CiAgICB9Cn0KY29udHJhY3QgUHVsbFBheW1lbnQgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgcGF5bWVudHM7CgogICAgdWludDI1NiBwdWJsaWMgdG90YWxQYXltZW50czsKCiAgICAvKioKICAgICogQGRldiBDYWxsZWQgYnkgdGhlIHBheWVyIHRvIHN0b3JlIHRoZSBzZW50IGFtb3VudCBhcyBjcmVkaXQgdG8gYmUgcHVsbGVkLgogICAgKiBAcGFyYW0gZGVzdCBUaGUgZGVzdGluYXRpb24gYWRkcmVzcyBvZiB0aGUgZnVuZHMuCiAgICAqIEBwYXJhbSBhbW91bnQgVGhlIGFtb3VudCB0byB0cmFuc2Zlci4KICAgICovCiAgICBmdW5jdGlvbiBhc3luY1NlbmQoYWRkcmVzcyBkZXN0LCB1aW50MjU2IGFtb3VudCkgaW50ZXJuYWwgewogICAgICAgIHBheW1lbnRzW2Rlc3RdID0gcGF5bWVudHNbZGVzdF0uYWRkKGFtb3VudCk7CiAgICAgICAgdG90YWxQYXltZW50cyA9IHRvdGFsUGF5bWVudHMuYWRkKGFtb3VudCk7CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgd2l0aGRyYXcgYWNjdW11bGF0ZWQgYmFsYW5jZSwgY2FsbGVkIGJ5IHBheWVlLgogICAgKi8KICAgIGZ1bmN0aW9uIHdpdGhkcmF3UGF5bWVudHMoKSB7CiAgICAgICAgYWRkcmVzcyBwYXllZSA9IG1zZy5zZW5kZXI7CiAgICAgICAgdWludDI1NiBwYXltZW50ID0gcGF5bWVudHNbcGF5ZWVdOwoKICAgICAgICByZXF1aXJlKHBheW1lbnQgIT0gMCk7CiAgICAgICAgcmVxdWlyZSh0aGlzLmJhbGFuY2UgPj0gcGF5bWVudCk7CgogICAgICAgIHRvdGFsUGF5bWVudHMgPSB0b3RhbFBheW1lbnRzLnN1YihwYXltZW50KTsKICAgICAgICBwYXltZW50c1twYXllZV0gPSAwOwoKICAgICAgICBhc3NlcnQocGF5ZWUuc2VuZChwYXltZW50KSk7CiAgICB9Cn0KCi8qCiogIENyb3dkc2FsZSBTbWFydCBDb250cmFjdCBmb3IgdGhlIFJvY2tjaGFpbiBwcm9qZWN0CiogIEF1dGhvcjogWW9zcmEgSGVsYWwgPHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI1ODIxMzcyYjJhMzk3NjMwM2QzNDM5MzQxODJhMzczYjMzM2IzMDM5MzEzNjc2MzcyYTNmIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPgoqICBDb250cmlidXRvcjogQ2hyaXN0b3BoZSBPemNhbiA8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImYxOTI5OTgzOTg4Mjg1OWU4MTk5OTRkZjllOGI5MjkwOWZiMTkyODM4ODgxODU5ZWM1OTA5ZDlkZGY5MjllOWMiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+CioKKgoqICBNdWx0aVNpZyBhZHZpc29ycyBLZXlzICgzLzUpCioKKiAgQ2hyaXN0b3BoZSBPWkNBTiAgICAgICAgMHg3NWRjQjBCYTc3ZTVmOTlmOGNlNkYwMTMzOENiMjM1REZFOTQyNjBjCiogIEplZmYgR1VJTEJBVUxUICAgICAgICAgIDB4OTRkZEMzMmM2MUJDOWE3OTlDZERlYTg3ZTZhMUQxMzE2MTk4YjBGYQoqICBNYXJrIEhBSE5FTCAgICAgICAgICAgICAweEZhRTM5MDQzQjg2OThDYUE0RjE0MTc2NTlCMDA3MzdmYTE5YjhFQ0MKKiAgUyYjMjMzO2Jhc3RpZW4gQ09MTElHTk9OICAgICAweGQ3MDI4MDEwOEVhRjMyMUUxMDAyNzZGNkQxYjEwNUVlMDg4Q0IwMTYKKiAgUyYjMjMzO2Jhc3RpZW4gSkVIQU4gICAgICAgICAweEU0YjBBNDhEM2IxYWRBMTcwMDBGZDA4MGNkNDJEQjNlODIzMTc1MmMKKgoqCiovCgpjb250cmFjdCBDcm93ZHNhbGUgaXMgUGF1c2FibGUsIFB1bGxQYXltZW50IHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwogICAgUk9LVG9rZW4gcHVibGljIHJvazsKICAgIGFkZHJlc3MgcHVibGljIGVzY3JvdzsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkcmVzcyBvZiBFc2Nyb3cgUHJvdmlkZXIgV2FsbGV0CiAgICBhZGRyZXNzIHB1YmxpYyBib3VudHkgOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFkZHJlc3MgZGVkaWNhdGVkIGZvciBib3VudHkgc2VydmljZXMKICAgIGFkZHJlc3MgcHVibGljIHRlYW07ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRyZXNzIGZvciBST0sgdG9rZW4gYWxsb2NhdGVkIHRvIHRoZSB0ZWFtCiAgICB1aW50MjU2IHB1YmxpYyByYXRlRVRIX1JPSzsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJhdGUgRXRoZXIgcGVyIFJPSyB0b2tlbgogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgbWluaW11bVB1cmNoYXNlID0gMC4xIGV0aGVyOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBNaW5pbXVtIHB1cmNoYXNlIHNpemUgb2YgaW5jb21pbmcgRVRICiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBtYXhGdW5kaW5nR29hbCA9IDEwMDAwMCBldGhlcjsgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE1heGltdW0gZ29hbCBpbiBFdGhlciByYWlzZWQKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IG1pbkZ1bmRpbmdHb2FsID0gMTgwMDAgZXRoZXI7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTWluaW11bSBmdW5kaW5nIGdvYWwgaW4gRXRoZXIgcmFpc2VkCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBzdGFydERhdGUgPSAxNTA5NTM0MDAwOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGVwb2NoIHRpbWVzdGFtcCByZXByZXNlbnRpbmcgdGhlIHN0YXJ0IGRhdGUgKDFzdCBub3ZlbWJlciAyMDE3IDExOjAwIGdtdCkKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IGRlYWRsaW5lID0gMTUxMjEyNjAwMDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZXBvY2ggdGltZXN0YW1wIHJlcHJlc2VudGluZyB0aGUgZW5kIGRhdGUgKDFzdCBkZWNlbWJlciAyMDE3IDExOjAwIGdtdCkKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IHJlZnVuZGVhZGxpbmUgPSAxNTE1OTI3NjAwOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZXBvY2ggdGltZXN0YW1wIHJlcHJlc2VudGluZyB0aGUgZW5kIGRhdGUgb2YgcmVmdW5kIHBlcmlvZCAoMTR0aCBqYW51YXJ5IDIwMTggMTE6MDAgZ210KQogICAgdWludDI1NiBwdWJsaWMgc2F2ZWRCYWxhbmNlID0gMDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUb3RhbCBhbW91bnQgcmFpc2VkIGluIEVUSAogICAgdWludDI1NiBwdWJsaWMgc2F2ZWRCYWxhbmNlVG9rZW4gPSAwOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUb3RhbCBST0sgVG9rZW4gYWxsb2NhdGVkCiAgICBib29sIHB1YmxpYyBjcm93ZHNhbGVjbG9zZWQgPSBmYWxzZTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRvIGZpbmFsaXplIGNyb3dkc2FsZQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBCYWxhbmNlcyBpbiBpbmNvbWluZyBFdGhlcgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlc1Jva1Rva2VuOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBCYWxhbmNlcyBpbiBST0sKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgS1lDbGlzdDsKCiAgICAvLyBFdmVudHMgdG8gcmVjb3JkIG5ldyBjb250cmlidXRpb25zCiAgICBldmVudCBDb250cmlidXRpb24oYWRkcmVzcyBpbmRleGVkIF9jb250cmlidXRvciwgdWludDI1NiBpbmRleGVkIF92YWx1ZSwgdWludDI1NiBpbmRleGVkIF90b2tlbnMpOwoKICAgIC8vIEV2ZW50IHRvIHJlY29yZCBlYWNoIHRpbWUgRXRoZXIgaXMgcGFpZCBvdXQKICAgIGV2ZW50IFBheUV0aGVyKAogICAgYWRkcmVzcyBpbmRleGVkIF9yZWNlaXZlciwKICAgIHVpbnQyNTYgaW5kZXhlZCBfdmFsdWUsCiAgICB1aW50MjU2IGluZGV4ZWQgX3RpbWVzdGFtcAogICAgKTsKCiAgICAvLyBFdmVudCB0byByZWNvcmQgd2hlbiB0b2tlbnMgYXJlIGJ1cm5lZC4KICAgIGV2ZW50IEJ1cm5Ub2tlbnMoCiAgICB1aW50MjU2IGluZGV4ZWQgX3ZhbHVlLAogICAgdWludDI1NiBpbmRleGVkIF90aW1lc3RhbXAKICAgICk7CgogICAgLy8gSW5pdGlhbGl6YXRpb24KICAgIGZ1bmN0aW9uIENyb3dkc2FsZSgpewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgICAgICAvLyBhZGQgYWRkcmVzcyBvZiB0aGUgc3BlY2lmaWMgY29udHJhY3QKICAgICAgICByb2sgPSBST0tUb2tlbigweGM5ZGU0YjdmMGMzZDk5MWU5NjcxNThlNGQ0YmZhNGI1MWVjMGIxMTQpOwogICAgICAgIGVzY3JvdyA9IDB4MDQ5Y2E2NDljOTc3ZWMzNjM2OGYzMTc2MmZmNzIyMGRiMGFhZTc5ZjsKICAgICAgICBib3VudHkgPSAweDUwQ2M2RjJENTQ4RjdlY2MyMmM5ZTlGOTk0RTRDMEYzNGM3ZkU4ZDA7CiAgICAgICAgdGVhbSA9IDB4MzM0NjIxNzFBODE0ZDRlRGE5N0NmM2ExMTJhYkUyMThEMDVjNTNDMjsKICAgICAgICByYXRlRVRIX1JPSyA9IDEwMDA7CiAgICB9CgoKICAgIC8vIERlZmF1bHQgRnVuY3Rpb24sIGRlbGVnYXRlcyB0byBjb250cmlidXRlIGZ1bmN0aW9uIChmb3IgZWFzZSBvZiB1c2UpCiAgICAvLyBXQVJOSU5HOiBOb3QgY29tcGF0aWJsZSB3aXRoIHNtYXJ0IGNvbnRyYWN0IGludm9jYXRpb24sIHdpbGwgZXhjZWVkIGdhcyBzdGlwZW5kIQogICAgLy8gT25seSB1c2UgZnJvbSBleHRlcm5hbCBhY2NvdW50cwogICAgZnVuY3Rpb24oKSBwYXlhYmxlIHdoZW5Ob3RQYXVzZWR7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgPT0gZXNjcm93KXsKICAgICAgICAgICAgYmFsYW5jZXNbdGhpc10gPSBtc2cudmFsdWU7CiAgICAgICAgfQogICAgICAgIGVsc2V7CiAgICAgICAgICAgIGNvbnRyaWJ1dGUobXNnLnNlbmRlcik7CiAgICAgICAgfQogICAgfQoKICAgIC8vIENvbnRyaWJ1dGUgRnVuY3Rpb24sIGFjY2VwdHMgaW5jb21pbmcgcGF5bWVudHMgYW5kIHRyYWNrcyBiYWxhbmNlcyBmb3IgZWFjaCBjb250cmlidXRvcnMKICAgIGZ1bmN0aW9uIGNvbnRyaWJ1dGUoYWRkcmVzcyBjb250cmlidXRvcikgaW50ZXJuYWx7CiAgICAgICAgcmVxdWlyZShpc1N0YXJ0ZWQoKSk7CiAgICAgICAgcmVxdWlyZSghaXNDb21wbGV0ZSgpKTsKICAgICAgICBhc3NlcnQoKHNhdmVkQmFsYW5jZS5hZGQobXNnLnZhbHVlKSkgPD0gbWF4RnVuZGluZ0dvYWwpOwogICAgICAgIGFzc2VydChtc2cudmFsdWUgPj0gbWluaW11bVB1cmNoYXNlKTsKICAgICAgICBiYWxhbmNlc1tjb250cmlidXRvcl0gPSBiYWxhbmNlc1tjb250cmlidXRvcl0uYWRkKG1zZy52YWx1ZSk7CiAgICAgICAgc2F2ZWRCYWxhbmNlID0gc2F2ZWRCYWxhbmNlLmFkZChtc2cudmFsdWUpOwogICAgICAgIHVpbnQyNTYgUm9rdG9rZW4gPSByYXRlRVRIX1JPSy5tdWwobXNnLnZhbHVlKSArIGdldEJvbnVzKHJhdGVFVEhfUk9LLm11bChtc2cudmFsdWUpKTsKICAgICAgICB1aW50MjU2IFJva1RvU2VuZCA9IChSb2t0b2tlbi5tdWwoODApKS5kaXYoMTAwKTsKICAgICAgICBiYWxhbmNlc1Jva1Rva2VuW2NvbnRyaWJ1dG9yXSA9IGJhbGFuY2VzUm9rVG9rZW5bY29udHJpYnV0b3JdLmFkZChSb2tUb1NlbmQpOwogICAgICAgIHNhdmVkQmFsYW5jZVRva2VuID0gc2F2ZWRCYWxhbmNlVG9rZW4uYWRkKFJva3Rva2VuKTsKICAgICAgICBlc2Nyb3cudHJhbnNmZXIobXNnLnZhbHVlKTsKICAgICAgICBQYXlFdGhlcihlc2Nyb3csIG1zZy52YWx1ZSwgbm93KTsKICAgIH0KCgogICAgLy8gRnVuY3Rpb24gdG8gY2hlY2sgaWYgY3Jvd2RzYWxlIGhhcyBzdGFydGVkIHlldAogICAgZnVuY3Rpb24gaXNTdGFydGVkKCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBub3cgPj0gc3RhcnREYXRlOwogICAgfQoKICAgIC8vIEZ1bmN0aW9uIHRvIGNoZWNrIGlmIGNyb3dkc2FsZSBpcyBjb21wbGV0ZSAoCiAgICBmdW5jdGlvbiBpc0NvbXBsZXRlKCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAoc2F2ZWRCYWxhbmNlID49IG1heEZ1bmRpbmdHb2FsKSB8fCAobm93ID4gZGVhZGxpbmUpIHx8IChzYXZlZEJhbGFuY2VUb2tlbiA+PSByb2sudG90YWxTdXBwbHkoKSkgfHwgKGNyb3dkc2FsZWNsb3NlZCA9PSB0cnVlKTsKICAgIH0KCiAgICAvLyBGdW5jdGlvbiB0byB2aWV3IGN1cnJlbnQgdG9rZW4gYmFsYW5jZSBvZiB0aGUgY3Jvd2RzYWxlIGNvbnRyYWN0CiAgICBmdW5jdGlvbiB0b2tlbkJhbGFuY2UoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgICAgICByZXR1cm4gcm9rLmJhbGFuY2VPZihhZGRyZXNzKHRoaXMpKTsKICAgIH0KCiAgICAvLyBGdW5jdGlvbiB0byBjaGVjayBpZiBjcm93ZHNhbGUgaGFzIGJlZW4gc3VjY2Vzc2Z1bCAoaGFzIGluY29taW5nIGNvbnRyaWJ1dGlvbiBiYWxhbmNlIG1ldCwgb3IgZXhjZWVkZWQgdGhlIG1pbmltdW0gZ29hbD8pCiAgICBmdW5jdGlvbiBpc1N1Y2Nlc3NmdWwoKSBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIChzYXZlZEJhbGFuY2UgPj0gbWluRnVuZGluZ0dvYWwpOwogICAgfQoKICAgIC8vIEZ1bmN0aW9uIHRvIGNoZWNrIHRoZSBFdGhlciBiYWxhbmNlIG9mIGEgY29udHJpYnV0b3IKICAgIGZ1bmN0aW9uIGNoZWNrRXRoQmFsYW5jZShhZGRyZXNzIF9jb250cmlidXRvcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19jb250cmlidXRvcl07CiAgICB9CgogICAgLy8gRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGN1cnJlbnQgVG9rZW5zIFNvbGQgaW4gdGhlIElDTwogICAgZnVuY3Rpb24gY2hlY2tSb2tTb2xkKCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiB0b3RhbCkgewogICAgICAgIHJldHVybiAoc2F2ZWRCYWxhbmNlVG9rZW4pOwogICAgICAgIC8vIEZ1bmN0aW9uIHRvIGNoZWNrIHRoZSBjdXJyZW50IFRva2VucyBTb2xkIGluIHRoZSBJQ08KICAgIH0KCiAgICAvLyBGdW5jdGlvbiB0byBjaGVjayB0aGUgY3VycmVudCBUb2tlbnMgYWZmZWN0ZWQgdG8gdGhlIHRlYW0KICAgIGZ1bmN0aW9uIGNoZWNrUm9rVGVhbSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgdG90YWx0ZWFtKSB7CiAgICAgICAgcmV0dXJuIChzYXZlZEJhbGFuY2VUb2tlbi5tdWwoMTkpLmRpdigxMDApKTsKICAgICAgICAvLyBGdW5jdGlvbiB0byBjaGVjayB0aGUgY3VycmVudCBUb2tlbnMgYWZmZWN0ZWQgdG8gdGhlIHRlYW0KICAgIH0KCiAgICAvLyBGdW5jdGlvbiB0byBjaGVjayB0aGUgY3VycmVudCBUb2tlbnMgYWZmZWN0ZWQgdG8gYm91bnR5CiAgICBmdW5jdGlvbiBjaGVja1Jva0JvdW50eSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgdG90YWxib3VudHkpIHsKICAgICAgICByZXR1cm4gKHNhdmVkQmFsYW5jZVRva2VuLmRpdigxMDApKTsKICAgIH0KCiAgICAvLyBGdW5jdGlvbiB0byBjaGVjayB0aGUgcmVmdW5kIHBlcmlvZCBpcyBvdmVyCiAgICBmdW5jdGlvbiByZWZ1bmRQZXJpb2RPdmVyKCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCl7CiAgICAgICAgcmV0dXJuIChub3cgPiByZWZ1bmRlYWRsaW5lKTsKICAgIH0KCiAgICAvLyBGdW5jdGlvbiB0byBjaGVjayB0aGUgcmVmdW5kIHBlcmlvZCBpcyBvdmVyCiAgICBmdW5jdGlvbiByZWZ1bmRQZXJpb2RTdGFydCgpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpewogICAgICAgIHJldHVybiAobm93ID4gZGVhZGxpbmUpOwogICAgfQoKICAgIC8vIGZ1bmN0aW9uIHRvIGNoZWNrIHBlcmNlbnRhZ2Ugb2YgZ29hbCBhY2hpZXZlZAogICAgZnVuY3Rpb24gcGVyY2VudE9mR29hbCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQxNiBnb2FsUGVyY2VudCkgewogICAgICAgIHJldHVybiB1aW50MTYoKHNhdmVkQmFsYW5jZS5tdWwoMTAwKSkuZGl2KG1pbkZ1bmRpbmdHb2FsKSk7CiAgICB9CgogICAgLy8gQ2FsY3VsIHRoZSBST0sgYm9udXMgYWNjb3JkaW5nIHRvIHRoZSBpbnZlc3RtZW50IHBlcmlvZAogICAgZnVuY3Rpb24gZ2V0Qm9udXModWludDI1NiBhbW91bnQpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50IGJvbnVzID0gMDsKICAgICAgICAvLyAgIDUgTm92ZW1iZXIgMjAxNyAxMTowMDowMCBHTVQKICAgICAgICB1aW50IGZpcnN0Ym9udXNkYXRlID0gMTUwOTg3OTYwMDsKICAgICAgICAvLyAgMTAgTm92ZW1iZXIgMjAxNyAxMTowMDowMCBHTVQKICAgICAgICB1aW50IHNlY29uZGJvbnVzZGF0ZSA9IDE1MTAzMTE2MDA7CgogICAgICAgIC8vICBpZiBpbnZlc3RtZW50IGRhdGUgaXMgb24gdGhlIDEwJSBib251cyBwZXJpb2QgdGhlbiByZXR1cm4gYm9udXMKICAgICAgICBpZiAobm93IDw9IGZpcnN0Ym9udXNkYXRlKSB7Ym9udXMgPSBhbW91bnQuZGl2KDEwKTt9CiAgICAgICAgLy8gIGVsc2UgaWYgaW52ZXN0bWVudCBkYXRlIGlzIG9uIHRoZSA1JSBib251cyBwZXJpb2QgdGhlbiByZXR1cm4gYm9udXMKICAgICAgICBlbHNlIGlmIChub3cgPD0gc2Vjb25kYm9udXNkYXRlICYmIG5vdyA+PSBmaXJzdGJvbnVzZGF0ZSkge2JvbnVzID0gYW1vdW50LmRpdigyMCk7fQogICAgICAgIC8vICByZXR1cm4gYW1vdW50IHdpdGhvdXQgYm9udXMKICAgICAgICByZXR1cm4gYm9udXM7CiAgICB9CgogICAgLy8gRnVuY3Rpb24gdG8gc2V0IHRoZSBiYWxhbmNlIG9mIGEgc2VuZGVyCiAgICBmdW5jdGlvbiBzZXRCYWxhbmNlKGFkZHJlc3Mgc2VuZGVyLHVpbnQyNTYgdmFsdWUpIGludGVybmFsewogICAgICAgIGJhbGFuY2VzW3NlbmRlcl0gPSB2YWx1ZTsKICAgIH0KCiAgICAvLyBPbmx5IG93bmVyIHdpbGwgZmluYWxpemUgdGhlIGNyb3dkc2FsZQogICAgZnVuY3Rpb24gZmluYWxpemUoKSBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoaXNTdGFydGVkKCkpOwogICAgICAgIHJlcXVpcmUoIWlzQ29tcGxldGUoKSk7CiAgICAgICAgY3Jvd2RzYWxlY2xvc2VkID0gdHJ1ZTsKICAgIH0KCiAgICAvLyBGdW5jdGlvbiB0byBwYXkgb3V0CiAgICBmdW5jdGlvbiBwYXlvdXQoKSBvbmx5T3duZXIgewogICAgICAgIGlmIChpc1N1Y2Nlc3NmdWwoKSAmJiBpc0NvbXBsZXRlKCkpIHsKICAgICAgICAgICAgcm9rLnRyYW5zZmVyKGJvdW50eSwgY2hlY2tSb2tCb3VudHkoKSk7CiAgICAgICAgICAgIHBheVRlYW0oKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmIChyZWZ1bmRQZXJpb2RPdmVyKCkpIHsKICAgICAgICAgICAgICAgIGVzY3Jvdy50cmFuc2ZlcihzYXZlZEJhbGFuY2UpOwogICAgICAgICAgICAgICAgUGF5RXRoZXIoZXNjcm93LCBzYXZlZEJhbGFuY2UsIG5vdyk7CiAgICAgICAgICAgICAgICByb2sudHJhbnNmZXIoYm91bnR5LCBjaGVja1Jva0JvdW50eSgpKTsKICAgICAgICAgICAgICAgIHBheVRlYW0oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvL0Z1bmN0aW9uIHRvIHBheSBUZWFtCiAgICBmdW5jdGlvbiBwYXlUZWFtKCkgaW50ZXJuYWwgewogICAgICAgIGFzc2VydChjaGVja1Jva1RlYW0oKSA+IDApOwogICAgICAgIHJvay50cmFuc2Zlcih0ZWFtLCBjaGVja1Jva1RlYW0oKSk7CiAgICAgICAgaWYgKGNoZWNrUm9rU29sZCgpIDwgcm9rLnRvdGFsU3VwcGx5KCkpIHsKICAgICAgICAgICAgLy8gYnVybiB0aGUgcmVzdCBvZiBST0sKICAgICAgICAgICAgcm9rLmJ1cm4ocm9rLnRvdGFsU3VwcGx5KCkuc3ViKGNoZWNrUm9rU29sZCgpKSk7CiAgICAgICAgICAgIC8vTG9nIGJ1cm4gb2YgdG9rZW5zCiAgICAgICAgICAgIEJ1cm5Ub2tlbnMocm9rLnRvdGFsU3VwcGx5KCkuc3ViKGNoZWNrUm9rU29sZCgpKSwgbm93KTsKICAgICAgICB9CiAgICB9CgogICAgLy9GdW5jdGlvbiB0byB1cGRhdGUgS1lDIGxpc3QKICAgIGZ1bmN0aW9uIHVwZGF0ZUtZQ2xpc3QoYWRkcmVzc1tdIGFsbG93ZWQpIG9ubHlPd25lcnsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBhbGxvd2VkLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChLWUNsaXN0W2FsbG93ZWRbaV1dID09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICBLWUNsaXN0W2FsbG93ZWRbaV1dID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvL0Z1bmN0aW9uIHRvIGNsYWltIFJPSyB0b2tlbnMKICAgIGZ1bmN0aW9uIGNsYWltKCkgcHVibGljewogICAgICAgIHJlcXVpcmUoaXNDb21wbGV0ZSgpKTsKICAgICAgICByZXF1aXJlKGNoZWNrRXRoQmFsYW5jZShtc2cuc2VuZGVyKSA+IDApOwogICAgICAgIGlmKGNoZWNrRXRoQmFsYW5jZShtc2cuc2VuZGVyKSA8PSAoMyBldGhlcikpewogICAgICAgICAgICByb2sudHJhbnNmZXIobXNnLnNlbmRlcixiYWxhbmNlc1Jva1Rva2VuW21zZy5zZW5kZXJdKTsKICAgICAgICAgICAgYmFsYW5jZXNSb2tUb2tlblttc2cuc2VuZGVyXSA9IDA7CiAgICAgICAgfQogICAgICAgIGVsc2V7CiAgICAgICAgICAgIHJlcXVpcmUoS1lDbGlzdFttc2cuc2VuZGVyXSA9PSB0cnVlKTsKICAgICAgICAgICAgcm9rLnRyYW5zZmVyKG1zZy5zZW5kZXIsYmFsYW5jZXNSb2tUb2tlblttc2cuc2VuZGVyXSk7CiAgICAgICAgICAgIGJhbGFuY2VzUm9rVG9rZW5bbXNnLnNlbmRlcl0gPSAwOwogICAgICAgIH0KICAgIH0KCiAgICAvKiBXaGVuIE1JTl9DQVAgaXMgbm90IHJlYWNoIHRoZSBzbWFydCBjb250cmFjdCB3aWxsIGJlIGNyZWRpdGVkIHRvIG1ha2UgcmVmdW5kIHBvc3NpYmxlIGJ5IGJhY2tlcnMKICAgICAqIDEpIGJhY2tlciBjYWxsIHRoZSAicmVmdW5kIiBmdW5jdGlvbiBvZiB0aGUgQ3Jvd2RzYWxlIGNvbnRyYWN0CiAgICAgKiAyKSBiYWNrZXIgY2FsbCB0aGUgIndpdGhkcmF3UGF5bWVudHMiIGZ1bmN0aW9uIG9mIHRoZSBDcm93ZHNhbGUgY29udHJhY3QgdG8gZ2V0IGEgcmVmdW5kIGluIEVUSAogICAgICovCiAgICBmdW5jdGlvbiByZWZ1bmQoKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoIWlzU3VjY2Vzc2Z1bCgpKTsKICAgICAgICByZXF1aXJlKHJlZnVuZFBlcmlvZFN0YXJ0KCkpOwogICAgICAgIHJlcXVpcmUoIXJlZnVuZFBlcmlvZE92ZXIoKSk7CiAgICAgICAgcmVxdWlyZShjaGVja0V0aEJhbGFuY2UobXNnLnNlbmRlcikgPiAwKTsKICAgICAgICB1aW50IEVUSFRvU2VuZCA9IGNoZWNrRXRoQmFsYW5jZShtc2cuc2VuZGVyKTsKICAgICAgICBzZXRCYWxhbmNlKG1zZy5zZW5kZXIsMCk7CiAgICAgICAgYXN5bmNTZW5kKG1zZy5zZW5kZXIsIEVUSFRvU2VuZCk7CiAgICB9CgogICAgLyogV2hlbiBNSU5fQ0FQIGlzIG5vdCByZWFjaCB0aGUgc21hcnQgY29udHJhY3Qgd2lsbCBiZSBjcmVkaXRlZCB0byBtYWtlIHJlZnVuZCBwb3NzaWJsZSBieSBiYWNrZXJzCiAgICAgKiAxKSBiYWNrZXIgY2FsbCB0aGUgInBhcnRpYWxSZWZ1bmQiIGZ1bmN0aW9uIG9mIHRoZSBDcm93ZHNhbGUgY29udHJhY3Qgd2l0aCB0aGUgcGFydGlhbCBhbW91bnQgb2YgRVRIIHRvIGJlIHJlZnVuZGVkICh2YWx1ZSB3aWxsIGJlIHJlbnNlaWduZWQgaW4gV0VJKQogICAgICogMikgYmFja2VyIGNhbGwgdGhlICJ3aXRoZHJhd1BheW1lbnRzIiBmdW5jdGlvbiBvZiB0aGUgQ3Jvd2RzYWxlIGNvbnRyYWN0IHRvIGdldCBhIHJlZnVuZCBpbiBFVEgKICAgICAqLwogICAgZnVuY3Rpb24gcGFydGlhbFJlZnVuZCh1aW50MjU2IHZhbHVlKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoIWlzU3VjY2Vzc2Z1bCgpKTsKICAgICAgICByZXF1aXJlKHJlZnVuZFBlcmlvZFN0YXJ0KCkpOwogICAgICAgIHJlcXVpcmUoIXJlZnVuZFBlcmlvZE92ZXIoKSk7CiAgICAgICAgcmVxdWlyZShjaGVja0V0aEJhbGFuY2UobXNnLnNlbmRlcikgPj0gdmFsdWUpOwogICAgICAgIHNldEJhbGFuY2UobXNnLnNlbmRlcixjaGVja0V0aEJhbGFuY2UobXNnLnNlbmRlcikuc3ViKHZhbHVlKSk7CiAgICAgICAgYXN5bmNTZW5kKG1zZy5zZW5kZXIsIHZhbHVlKTsKICAgIH0KCn0='.
	

]
