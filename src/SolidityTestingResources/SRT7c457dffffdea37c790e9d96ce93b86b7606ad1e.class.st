Class {
	#name : #SRT7c457dffffdea37c790e9d96ce93b86b7606ad1e,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT7c457dffffdea37c790e9d96ce93b86b7606ad1e >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7Cgpjb250cmFjdCBTYWZlTWF0aCB7CgogICAgZnVuY3Rpb24gc2FmZU11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NiApIHsKICAgICAgICB1aW50MjU2IGMgPSBhICogYjsKICAgICAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGZ1bmN0aW9uIHNhZmVEaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYgKSB7CiAgICAgICAgYXNzZXJ0KGIgPiAwKTsKICAgICAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgICAgICBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBzYWZlU3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2ICkgewogICAgICAgIGFzc2VydChiIDw9IGEpOwogICAgICAgIHJldHVybiBhIC0gYjsKICAgIH0KCiAgICBmdW5jdGlvbiBzYWZlQWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2ICkgewogICAgICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgICAgIGFzc2VydChjID49IGEpOwogICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICAgICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOwogICAgfQoKICAgIGZ1bmN0aW9uIG1pbjY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICAgICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgICB9CgogICAgZnVuY3Rpb24gbWF4MjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOwogICAgfQoKICAgIGZ1bmN0aW9uIG1pbjI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogICAgfQoKICAgIGZ1bmN0aW9uIGFzc2VydChib29sIGFzc2VydGlvbikgaW50ZXJuYWwgewogICAgICAgIGlmICghYXNzZXJ0aW9uKSB7CiAgICAgICAgICAgIHRocm93OwogICAgICAgIH0KICAgIH0KfQoKY29udHJhY3QgRVJDMjAgewoKICAgIC8qIFRoaXMgaXMgYSBzbGlnaHQgY2hhbmdlIHRvIHRoZSBFUkMyMCBiYXNlIHN0YW5kYXJkLgogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHN1cHBseSk7CiAgICBpcyByZXBsYWNlZCB3aXRoOgogICAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgICBUaGlzIGF1dG9tYXRpY2FsbHkgY3JlYXRlcyBhIGdldHRlciBmdW5jdGlvbiBmb3IgdGhlIHRvdGFsU3VwcGx5LgogICAgVGhpcyBpcyBtb3ZlZCB0byB0aGUgYmFzZSBjb250cmFjdCBzaW5jZSBwdWJsaWMgZ2V0dGVyIGZ1bmN0aW9ucyBhcmUgbm90CiAgICBjdXJyZW50bHkgcmVjb2duaXNlZCBhcyBhbiBpbXBsZW1lbnRhdGlvbiBvZiB0aGUgbWF0Y2hpbmcgYWJzdHJhY3QKICAgIGZ1bmN0aW9uIGJ5IHRoZSBjb21waWxlci4KICAgICovCiAgICAvLy8gdG90YWwgYW1vdW50IG9mIHRva2VucwogICAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgZnJvbSB3aGljaCB0aGUgYmFsYW5jZSB3aWxsIGJlIHJldHJpZXZlZAogICAgLy8vIEByZXR1cm4gVGhlIGJhbGFuY2UKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKTsKCiAgICAvLy8gQG5vdGljZSBzZW5kIGBfdmFsdWVgIHRva2VuIHRvIGBfdG9gIGZyb20gYG1zZy5zZW5kZXJgCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VuIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCBvciBub3QKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvLy8gQG5vdGljZSBzZW5kIGBfdmFsdWVgIHRva2VuIHRvIGBfdG9gIGZyb20gYF9mcm9tYCBvbiB0aGUgY29uZGl0aW9uIGl0IGlzIGFwcHJvdmVkIGJ5IGBfZnJvbWAKICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3Mgb2YgdGhlIHNlbmRlcgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbiB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vLyBAbm90aWNlIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgX3NwZW5kZXJgIHRvIHNwZW5kIGBfdmFsdWVgIHRva2VucwogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgYXBwcm92YWwgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IG93bmluZyB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHJldHVybiBBbW91bnQgb2YgcmVtYWluaW5nIHRva2VucyBhbGxvd2VkIHRvIHNwZW50CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKTsKCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpOwp9Cgpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEVSQzIwLCBTYWZlTWF0aCB7CgogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOwogICAgbWFwcGluZyhhZGRyZXNzID0+IG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKCiAgICAvLy8gQGRldiBSZXR1cm5zIG51bWJlciBvZiB0b2tlbnMgb3duZWQgYnkgZ2l2ZW4gYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gX293bmVyIEFkZHJlc3Mgb2YgdG9rZW4gb3duZXIuCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogICAgfQoKICAgIC8vLyBAZGV2IFRyYW5zZmVycyBzZW5kZXIncyB0b2tlbnMgdG8gYSBnaXZlbiBhZGRyZXNzLiBSZXR1cm5zIHN1Y2Nlc3MuCiAgICAvLy8gQHBhcmFtIF90byBBZGRyZXNzIG9mIHRva2VuIHJlY2VpdmVyLgogICAgLy8vIEBwYXJhbSBfdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byB0cmFuc2Zlci4KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGlmIChiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgX3ZhbHVlID4gMCkgewogICAgICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYmFsYW5jZXNbbXNnLnNlbmRlcl0sIF92YWx1ZSk7CiAgICAgICAgICAgIGJhbGFuY2VzW190b10gPSBzYWZlQWRkKGJhbGFuY2VzW190b10sIF92YWx1ZSk7CiAgICAgICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvLy8gQGRldiBBbGxvd3MgYWxsb3dlZCB0aGlyZCBwYXJ0eSB0byB0cmFuc2ZlciB0b2tlbnMgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyLiBSZXR1cm5zIHN1Y2Nlc3MuCiAgICAvLy8gQHBhcmFtIF9mcm9tIEFkZHJlc3MgZnJvbSB3aGVyZSB0b2tlbnMgYXJlIHdpdGhkcmF3bi4KICAgIC8vLyBAcGFyYW0gX3RvIEFkZHJlc3MgdG8gd2hlcmUgdG9rZW5zIGFyZSBzZW50LgogICAgLy8vIEBwYXJhbSBfdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byB0cmFuc2Zlci4KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBpZiAoYmFsYW5jZXNbX2Zyb21dID49IF92YWx1ZSAmJiBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgX3ZhbHVlID4gMCkgewogICAgICAgICAgICBiYWxhbmNlc1tfdG9dID0gc2FmZUFkZChiYWxhbmNlc1tfdG9dLCBfdmFsdWUpOwogICAgICAgICAgICBiYWxhbmNlc1tfZnJvbV0gPSBzYWZlU3ViKGJhbGFuY2VzW19mcm9tXSwgX3ZhbHVlKTsKICAgICAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBzYWZlU3ViKGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdLCBfdmFsdWUpOwogICAgICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8vLyBAZGV2IFNldHMgYXBwcm92ZWQgYW1vdW50IG9mIHRva2VucyBmb3Igc3BlbmRlci4gUmV0dXJucyBzdWNjZXNzLgogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBBZGRyZXNzIG9mIGFsbG93ZWQgYWNjb3VudC4KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIE51bWJlciBvZiBhcHByb3ZlZCB0b2tlbnMuCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sKSB7CiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyBudW1iZXIgb2YgYWxsb3dlZCB0b2tlbnMgZm9yIGdpdmVuIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIF9vd25lciBBZGRyZXNzIG9mIHRva2VuIG93bmVyLgogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBBZGRyZXNzIG9mIHRva2VuIHNwZW5kZXIuCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgICB9Cn0KCmNvbnRyYWN0IE93bmFibGUgewoKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwogICAgYWRkcmVzcyBwdWJsaWMgcGVuZGluZ093bmVyOwoKICAgIGZ1bmN0aW9uIE93bmFibGUoKSB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBvd25lcikgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyBTYWZlIHRyYW5zZmVyIG9mIG93bmVyc2hpcCBpbiAyIHN0ZXBzLiBPbmNlIGNhbGxlZCwgYSBuZXdPd25lciBuZWVkcyB0byBjYWxsIGNsYWltT3duZXJzaGlwKCkgdG8gcHJvdmUgb3duZXJzaGlwLgogICAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHsKICAgICAgICBwZW5kaW5nT3duZXIgPSBuZXdPd25lcjsKICAgIH0KCiAgICBmdW5jdGlvbiBjbGFpbU93bmVyc2hpcCgpIHsKICAgICAgICBpZiAobXNnLnNlbmRlciA9PSBwZW5kaW5nT3duZXIpIHsKICAgICAgICAgICAgb3duZXIgPSBwZW5kaW5nT3duZXI7CiAgICAgICAgICAgIHBlbmRpbmdPd25lciA9IDA7CiAgICAgICAgfQogICAgfQp9Cgpjb250cmFjdCBNdWx0aU93bmFibGUgewoKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgb3duZXJNYXA7CiAgICBhZGRyZXNzW10gcHVibGljIG93bmVyczsKCiAgICBldmVudCBPd25lckFkZGVkKGFkZHJlc3MgaW5kZXhlZCBfbmV3T3duZXIpOwogICAgZXZlbnQgT3duZXJSZW1vdmVkKGFkZHJlc3MgaW5kZXhlZCBfb2xkT3duZXIpOwoKICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgICAgICBpZiAoIWlzT3duZXIobXNnLnNlbmRlcikpIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gTXVsdGlPd25hYmxlKCkgewogICAgICAgIC8vIEFkZCBkZWZhdWx0IG93bmVyCiAgICAgICAgYWRkcmVzcyBvd25lciA9IG1zZy5zZW5kZXI7CiAgICAgICAgb3duZXJNYXBbb3duZXJdID0gdHJ1ZTsKICAgICAgICBvd25lcnMucHVzaChvd25lcik7CiAgICB9CgogICAgZnVuY3Rpb24gb3duZXJDb3VudCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gb3duZXJzLmxlbmd0aDsKICAgIH0KCiAgICBmdW5jdGlvbiBpc093bmVyKGFkZHJlc3Mgb3duZXIpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gb3duZXJNYXBbb3duZXJdOwogICAgfQoKICAgIGZ1bmN0aW9uIGFkZE93bmVyKGFkZHJlc3Mgb3duZXIpIG9ubHlPd25lciByZXR1cm5zIChib29sKSB7CiAgICAgICAgaWYgKCFpc093bmVyKG93bmVyKSAmJiBvd25lciAhPSAwKSB7CiAgICAgICAgICAgIG93bmVyTWFwW293bmVyXSA9IHRydWU7CiAgICAgICAgICAgIG93bmVycy5wdXNoKG93bmVyKTsKCiAgICAgICAgICAgIE93bmVyQWRkZWQob3duZXIpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlbW92ZU93bmVyKGFkZHJlc3Mgb3duZXIpIG9ubHlPd25lciByZXR1cm5zIChib29sKSB7CiAgICAgICAgaWYgKGlzT3duZXIob3duZXIpKSB7CiAgICAgICAgICAgIG93bmVyTWFwW293bmVyXSA9IGZhbHNlOwogICAgICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBvd25lcnMubGVuZ3RoIC0gMTsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAob3duZXJzW2ldID09IG93bmVyKSB7CiAgICAgICAgICAgICAgICAgICAgb3duZXJzW2ldID0gb3duZXJzW293bmVycy5sZW5ndGggLSAxXTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBvd25lcnMubGVuZ3RoIC09IDE7CgogICAgICAgICAgICBPd25lclJlbW92ZWQob3duZXIpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgcmV0dXJuIGZhbHNlOwogICAgfQp9Cgpjb250cmFjdCBQYXVzYWJsZSBpcyBPd25hYmxlIHsKCiAgICBib29sIHB1YmxpYyBwYXVzZWQ7CgogICAgbW9kaWZpZXIgaWZOb3RQYXVzZWQgewogICAgICAgIGlmIChwYXVzZWQpIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgaWZQYXVzZWQgewogICAgICAgIGlmICghcGF1c2VkKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIC8vIENhbGxlZCBieSB0aGUgb3duZXIgb24gZW1lcmdlbmN5LCB0cmlnZ2VycyBwYXVzZWQgc3RhdGUKICAgIGZ1bmN0aW9uIHBhdXNlKCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBwYXVzZWQgPSB0cnVlOwogICAgfQoKICAgIC8vIENhbGxlZCBieSB0aGUgb3duZXIgb24gZW5kIG9mIGVtZXJnZW5jeSwgcmV0dXJucyB0byBub3JtYWwgc3RhdGUKICAgIGZ1bmN0aW9uIHJlc3VtZSgpIGV4dGVybmFsIG9ubHlPd25lciBpZlBhdXNlZCB7CiAgICAgICAgcGF1c2VkID0gZmFsc2U7CiAgICB9Cn0KCmNvbnRyYWN0IFRva2VuU3BlbmRlciB7CiAgICBmdW5jdGlvbiByZWNlaXZlQXBwcm92YWwoYWRkcmVzcyBfZnJvbSwgdWludDI1NiBfdmFsdWUpOwp9Cgpjb250cmFjdCBCc1Rva2VuIGlzIFN0YW5kYXJkVG9rZW4sIE11bHRpT3duYWJsZSB7CgogICAgYm9vbCBwdWJsaWMgbG9ja2VkOwoKICAgIHN0cmluZyBwdWJsaWMgbmFtZTsKICAgIHN0cmluZyBwdWJsaWMgc3ltYm9sOwogICAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgICB1aW50OCBwdWJsaWMgZGVjaW1hbHMgPSAxODsKICAgIHN0cmluZyBwdWJsaWMgdmVyc2lvbiA9ICd2MC4xJzsKCiAgICBhZGRyZXNzIHB1YmxpYyBjcmVhdG9yOwogICAgYWRkcmVzcyBwdWJsaWMgc2VsbGVyOwogICAgdWludDI1NiBwdWJsaWMgdG9rZW5zU29sZDsKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU2FsZXM7CgogICAgZXZlbnQgU2VsbChhZGRyZXNzIGluZGV4ZWQgX3NlbGxlciwgYWRkcmVzcyBpbmRleGVkIF9idXllciwgdWludDI1NiBfdmFsdWUpOwogICAgZXZlbnQgU2VsbGVyQ2hhbmdlZChhZGRyZXNzIGluZGV4ZWQgX29sZFNlbGxlciwgYWRkcmVzcyBpbmRleGVkIF9uZXdTZWxsZXIpOwoKICAgIG1vZGlmaWVyIG9ubHlVbmxvY2tlZCgpIHsKICAgICAgICBpZiAoIWlzT3duZXIobXNnLnNlbmRlcikgJiYgbG9ja2VkKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIEJzVG9rZW4oc3RyaW5nIF9uYW1lLCBzdHJpbmcgX3N5bWJvbCwgdWludDI1NiBfdG90YWxTdXBwbHlOb0RlY2ltYWxzLCBhZGRyZXNzIF9zZWxsZXIpIE11bHRpT3duYWJsZSgpIHsKCiAgICAgICAgLy8gTG9jayB0aGUgdHJhbnNmZXIgZnVuY3Rpb24gZHVyaW5nIHRoZSBwcmVzYWxlL2Nyb3dkc2FsZSB0byBwcmV2ZW50IHNwZWN1bGF0aW9ucy4KICAgICAgICBsb2NrZWQgPSB0cnVlOwoKICAgICAgICBjcmVhdG9yID0gbXNnLnNlbmRlcjsKICAgICAgICBzZWxsZXIgPSBfc2VsbGVyOwoKICAgICAgICBuYW1lID0gX25hbWU7CiAgICAgICAgc3ltYm9sID0gX3N5bWJvbDsKICAgICAgICB0b3RhbFN1cHBseSA9IF90b3RhbFN1cHBseU5vRGVjaW1hbHMgKiAxZTE4OwoKICAgICAgICBiYWxhbmNlc1tzZWxsZXJdID0gdG90YWxTdXBwbHk7CiAgICAgICAgVHJhbnNmZXIoMHgwLCBzZWxsZXIsIHRvdGFsU3VwcGx5KTsKICAgIH0KCiAgICBmdW5jdGlvbiBjaGFuZ2VTZWxsZXIoYWRkcmVzcyBuZXdTZWxsZXIpIG9ubHlPd25lciByZXR1cm5zIChib29sKSB7CiAgICAgICAgaWYgKG5ld1NlbGxlciA9PSAweDAgfHwgc2VsbGVyID09IG5ld1NlbGxlcikgdGhyb3c7CgogICAgICAgIGFkZHJlc3Mgb2xkU2VsbGVyID0gc2VsbGVyOwoKICAgICAgICB1aW50MjU2IHVuc29sZFRva2VucyA9IGJhbGFuY2VzW29sZFNlbGxlcl07CiAgICAgICAgYmFsYW5jZXNbb2xkU2VsbGVyXSA9IDA7CiAgICAgICAgYmFsYW5jZXNbbmV3U2VsbGVyXSA9IHNhZmVBZGQoYmFsYW5jZXNbbmV3U2VsbGVyXSwgdW5zb2xkVG9rZW5zKTsKICAgICAgICBUcmFuc2ZlcihvbGRTZWxsZXIsIG5ld1NlbGxlciwgdW5zb2xkVG9rZW5zKTsKCiAgICAgICAgc2VsbGVyID0gbmV3U2VsbGVyOwogICAgICAgIFNlbGxlckNoYW5nZWQob2xkU2VsbGVyLCBuZXdTZWxsZXIpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIHNlbGxOb0RlY2ltYWxzKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBzZWxsKF90bywgX3ZhbHVlICogMWUxOCk7CiAgICB9CgogICAgZnVuY3Rpb24gc2VsbChhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIG9ubHlPd25lciByZXR1cm5zIChib29sKSB7CiAgICAgICAgaWYgKGJhbGFuY2VzW3NlbGxlcl0gPj0gX3ZhbHVlICYmIF92YWx1ZSA+IDApIHsKICAgICAgICAgICAgYmFsYW5jZXNbc2VsbGVyXSA9IHNhZmVTdWIoYmFsYW5jZXNbc2VsbGVyXSwgX3ZhbHVlKTsKICAgICAgICAgICAgYmFsYW5jZXNbX3RvXSA9IHNhZmVBZGQoYmFsYW5jZXNbX3RvXSwgX3ZhbHVlKTsKICAgICAgICAgICAgVHJhbnNmZXIoc2VsbGVyLCBfdG8sIF92YWx1ZSk7CgogICAgICAgICAgICB0b2tlbnNTb2xkID0gc2FmZUFkZCh0b2tlbnNTb2xkLCBfdmFsdWUpOwogICAgICAgICAgICB0b3RhbFNhbGVzID0gc2FmZUFkZCh0b3RhbFNhbGVzLCAxKTsKICAgICAgICAgICAgU2VsbChzZWxsZXIsIF90bywgX3ZhbHVlKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIG9ubHlVbmxvY2tlZCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyKF90bywgX3ZhbHVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBvbmx5VW5sb2NrZWQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBzdXBlci50cmFuc2ZlckZyb20oX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBsb2NrKCkgb25seU93bmVyIHsKICAgICAgICBsb2NrZWQgPSB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIHVubG9jaygpIG9ubHlPd25lciB7CiAgICAgICAgbG9ja2VkID0gZmFsc2U7CiAgICB9CgogICAgZnVuY3Rpb24gYnVybih1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGlmIChiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgX3ZhbHVlID4gMCkgewogICAgICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYmFsYW5jZXNbbXNnLnNlbmRlcl0sIF92YWx1ZSkgOwogICAgICAgICAgICB0b3RhbFN1cHBseSA9IHNhZmVTdWIodG90YWxTdXBwbHksIF92YWx1ZSk7CiAgICAgICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIDB4MCwgX3ZhbHVlKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKiBBcHByb3ZlIGFuZCB0aGVuIGNvbW11bmljYXRlIHRoZSBhcHByb3ZlZCBjb250cmFjdCBpbiBhIHNpbmdsZSB0eCAqLwogICAgZnVuY3Rpb24gYXBwcm92ZUFuZENhbGwoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHsKICAgICAgICBUb2tlblNwZW5kZXIgc3BlbmRlciA9IFRva2VuU3BlbmRlcihfc3BlbmRlcik7CiAgICAgICAgaWYgKGFwcHJvdmUoX3NwZW5kZXIsIF92YWx1ZSkpIHsKICAgICAgICAgICAgc3BlbmRlci5yZWNlaXZlQXBwcm92YWwobXNnLnNlbmRlciwgX3ZhbHVlKTsKICAgICAgICB9CiAgICB9Cn0KCi8qKgogKiBJbiB0aGlzIHByZXNhbGUgV2UgYXNzdW1lIHRoYXQgRVRIIHJhdGUgaXMgMzIwIFVTRC9FVEgKICovCmNvbnRyYWN0IEJzUHJlc2FsZV9TTk9WIGlzIFNhZmVNYXRoLCBPd25hYmxlLCBQYXVzYWJsZSB7CgogICAgc3RydWN0IEJhY2tlciB7CiAgICAgICAgdWludDI1NiB3ZWlSZWNlaXZlZDsgLy8gQW1vdW50IG9mIHdlaSBnaXZlbiBieSBiYWNrZXIKICAgICAgICB1aW50MjU2IHRva2Vuc1NlbnQ7ICAvLyBBbW91bnQgb2YgdG9rZW5zIHJlY2VpdmVkIGluIHJldHVybiB0byB0aGUgZ2l2ZW4gYW1vdW50IG9mIEVUSC4KICAgIH0KCiAgICAvLyBUT0RPIHJlbmFtZSB0byBidXllcnMuCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gQmFja2VyKSBwdWJsaWMgYmFja2VyczsgLy8gYmFja2VycyBpbmRleGVkIGJ5IHRoZWlyIEVUSCBhZGRyZXNzCgogICAgLy8gKGJ1eWVyRXRoQWRkciA9PiAodW5peFRzID0+IHRva2Vuc1NvbGQpKQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nICh1aW50MjU2ID0+IHVpbnQyNTYpKSBwdWJsaWMgZXh0ZXJuYWxTYWxlczsKCiAgICBCc1Rva2VuIHB1YmxpYyB0b2tlbjsgICAgICAgICAgIC8vIFRva2VuIGNvbnRyYWN0IHJlZmVyZW5jZS4KICAgIGFkZHJlc3MgcHVibGljIGJlbmVmaWNpYXJ5OyAgICAgLy8gQWRkcmVzcyB0aGF0IHdpbGwgcmVjZWl2ZSBFVEggcmFpc2VkIGR1cmluZyB0aGlzIHByZXNhbGUuCiAgICBhZGRyZXNzIHB1YmxpYyBub3RpZmllcjsgICAgICAgIC8vIEFkZHJlc3MgdGhhdCBjYW4gdGhpcyBwcmVzYWxlIGFib3V0IGNoYW5nZWQgZXh0ZXJuYWwgY29uZGl0aW9ucy4KCiAgICB1aW50MjU2IHB1YmxpYyB1c2RQZXJFdGg7CiAgICB1aW50MjU2IHB1YmxpYyB1c2RQZXJFdGhNaW4gPSAyMDA7IC8vIExvd2VzdCBib3VuZGFyeSBvZiBVU0QvRVRIIHJhdGUKICAgIHVpbnQyNTYgcHVibGljIHVzZFBlckV0aE1heCA9IDUwMDsgLy8gSGlnaGVzdCBib3VuZGFyeSBvZiBVU0QvRVRIIHJhdGUKCiAgICBzdHJ1Y3QgVXNkUGVyRXRoTG9nIHsKICAgICAgICB1aW50MjU2IHJhdGU7CiAgICAgICAgdWludDI1NiB0aW1lOwogICAgICAgIGFkZHJlc3MgY2hhbmdlZEJ5OwogICAgfQoKICAgIFVzZFBlckV0aExvZ1tdIHB1YmxpYyB1c2RQZXJFdGhMb2c7IC8vIEhpc3Rvcnkgb2YgdXNlZCByYXRlcyBvZiBVU0QvRVRICgogICAgdWludDI1NiBwdWJsaWMgbWluSW52ZXN0Q2VudHMgPSAxOyAvLyBCZWNhdXNlIDEgdG9rZW4gPSAxIGNlbnQuCiAgICB1aW50MjU2IHB1YmxpYyB0b2tlbnNQZXJDZW50cyAgICAgICAgICAgPSAxLjE1ICogMWUxODsgLy8gKyAxNSUgYm9udXMgZHVyaW5nIHByZXNhbGUuIE9yZGluYXJ5IHByaWNlIGlzIDEgdG9rZW4gcGVyIDEgVVNEIGNlbnQuCiAgICB1aW50MjU2IHB1YmxpYyB0b2tlbnNQZXJDZW50c19ndGU1MGtVc2QgPSAxLjI1ICogMWUxODsgLy8gKyAyNSUgYm9udXMgZm9yIGNvbnRyaWJ1dGlvbiA+PSA1MGsgVVNEIGR1cmluZyBwcmVzYWxlLgogICAgdWludDI1NiBwdWJsaWMgYW1vdW50NTBrVXNkSW5DZW50cyA9IDUwICogMTAwMCAqIDEwMDsgIC8vIDUwayBVU0QgaW4gY2VudHMuCiAgICB1aW50MjU2IHB1YmxpYyBtYXhDYXBJbkNlbnRzICAgICAgID0gMTUgKiAxZTYgKiAxMDA7ICAgLy8gMTVtIFVTRCBpbiBjZW50cy4KCiAgICAvLyBUT0RPIGRvIHdlIGhhdmUgc29tZSBhbW91bnQgb2YgcHJpdmF0ZWx5IHJhaXNlZCBtb25leSBhdCBzdGFydCBvZiBwcmVzYWxlPwogICAgdWludDI1NiBwdWJsaWMgdG90YWxXZWlSZWNlaXZlZCA9IDA7ICAgLy8gVG90YWwgYW1vdW50IG9mIHdlaSByZWNlaXZlZCBkdXJpbmcgdGhpcyBwcmVzYWxlIHNtYXJ0IGNvbnRyYWN0LgogICAgdWludDI1NiBwdWJsaWMgdG90YWxJbkNlbnRzID0gMDsgICAgICAgLy8gVG90YWwgYW1vdW50IG9mIFVTRCByYWlzZWQgZHVyaW5nIHRoaXMgcHJlc2FsZSBpbmNsdWRpbmcgKHdlaSAtPiBVU0QpICsgKGV4dGVybmFsIFVTRCkuCiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFRva2Vuc1NvbGQ7ICAgICAgICAvLyBUb3RhbCBhbW91bnQgb2YgdG9rZW5zIHNvbGQgZHVyaW5nIHRoaXMgcHJlc2FsZS4KICAgIHVpbnQyNTYgcHVibGljIHRvdGFsRXRoU2FsZXM7ICAgICAgICAgIC8vIFRvdGFsIGFtb3VudCBvZiBFVEggY29udHJpYnV0aW9ucyBkdXJpbmcgdGhpcyBwcmVzYWxlLgogICAgdWludDI1NiBwdWJsaWMgdG90YWxFeHRlcm5hbFNhbGVzOyAgICAgLy8gVG90YWwgYW1vdW50IG9mIGV4dGVybmFsIGNvbnRyaWJ1dGlvbnMgKFVTRCwgQlRDLCBldGMuKSBkdXJpbmcgdGhpcyBwcmVzYWxlLgoKICAgIHVpbnQyNTYgcHVibGljIHN0YXJ0VGltZSA9IDE1MDQ1MjY0MDA7IC8vIDIwMTctMDktMDRUMTI6MDA6MDBaCiAgICB1aW50MjU2IHB1YmxpYyBlbmRUaW1lICAgPSAxNTA3MDMyMDAwOyAvLyAyMDE3LTEwLTAzVDEyOjAwOjAwWgogICAgdWludDI1NiBwdWJsaWMgZmluYWxpemVkVGltZSA9IDA7ICAgICAgLy8gVW5peCB0aW1lc3RhbXAgd2hlbiBmaW5hbGl6ZSgpIHdhcyBjYWxsZWQuCgogICAgZXZlbnQgQmVuZWZpY2lhcnlDaGFuZ2VkKGFkZHJlc3MgaW5kZXhlZCBfb2xkQWRkcmVzcywgYWRkcmVzcyBpbmRleGVkIF9uZXdBZGRyZXNzKTsKICAgIGV2ZW50IE5vdGlmaWVyQ2hhbmdlZChhZGRyZXNzIGluZGV4ZWQgX29sZEFkZHJlc3MsIGFkZHJlc3MgaW5kZXhlZCBfbmV3QWRkcmVzcyk7CiAgICBldmVudCBVc2RQZXJFdGhDaGFuZ2VkKHVpbnQyNTYgX29sZFJhdGUsIHVpbnQyNTYgX25ld1JhdGUpOwoKICAgIGV2ZW50IEV0aFJlY2VpdmVkKGFkZHJlc3MgX2J1eWVyLCB1aW50MjU2IF9hbW91bnRJbldlaSk7CiAgICBldmVudCBFeHRlcm5hbFNhbGUoYWRkcmVzcyBfYnV5ZXIsIHVpbnQyNTYgX2Ftb3VudEluVXNkLCB1aW50MjU2IF90b2tlbnNTb2xkLCB1aW50MjU2IF91bml4VHMpOwoKICAgIG1vZGlmaWVyIHJlc3BlY3RUaW1lRnJhbWUoKSB7CiAgICAgICAgaWYgKCFpc1NhbGVPbigpKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGNhbk5vdGlmeSgpIHsKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBvd25lciAmJiBtc2cuc2VuZGVyICE9IG5vdGlmaWVyKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIEJzUHJlc2FsZV9TTk9WKGFkZHJlc3MgX3Rva2VuLCBhZGRyZXNzIF9iZW5lZmljaWFyeSwgdWludDI1NiBfdXNkUGVyRXRoKSB7CiAgICAgICAgdG9rZW4gPSBCc1Rva2VuKF90b2tlbik7CgogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgICAgICBub3RpZmllciA9IG93bmVyOwogICAgICAgIGJlbmVmaWNpYXJ5ID0gX2JlbmVmaWNpYXJ5OwoKICAgICAgICBzZXRVc2RQZXJFdGgoX3VzZFBlckV0aCk7CiAgICB9CgogICAgLy8gT3ZlcnJpZGUgdGhpcyBtZXRob2QgdG8gbW9jayBjdXJyZW50IHRpbWUuCiAgICBmdW5jdGlvbiBnZXROb3coKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIG5vdzsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRCZW5lZmljaWFyeShhZGRyZXNzIF9iZW5lZmljaWFyeSkgb25seU93bmVyIHsKICAgICAgICBCZW5lZmljaWFyeUNoYW5nZWQoYmVuZWZpY2lhcnksIF9iZW5lZmljaWFyeSk7CiAgICAgICAgYmVuZWZpY2lhcnkgPSBfYmVuZWZpY2lhcnk7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0Tm90aWZpZXIoYWRkcmVzcyBfbm90aWZpZXIpIG9ubHlPd25lciB7CiAgICAgICAgTm90aWZpZXJDaGFuZ2VkKG5vdGlmaWVyLCBfbm90aWZpZXIpOwogICAgICAgIG5vdGlmaWVyID0gX25vdGlmaWVyOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldFVzZFBlckV0aCh1aW50MjU2IF91c2RQZXJFdGgpIGNhbk5vdGlmeSB7CiAgICAgICAgaWYgKF91c2RQZXJFdGggPCB1c2RQZXJFdGhNaW4gfHwgX3VzZFBlckV0aCA+IHVzZFBlckV0aE1heCkgdGhyb3c7CgogICAgICAgIFVzZFBlckV0aENoYW5nZWQodXNkUGVyRXRoLCBfdXNkUGVyRXRoKTsKICAgICAgICB1c2RQZXJFdGggPSBfdXNkUGVyRXRoOwogICAgICAgIHVzZFBlckV0aExvZy5wdXNoKFVzZFBlckV0aExvZyh7IHJhdGU6IHVzZFBlckV0aCwgdGltZTogZ2V0Tm93KCksIGNoYW5nZWRCeTogbXNnLnNlbmRlciB9KSk7CiAgICB9CgogICAgZnVuY3Rpb24gdXNkUGVyRXRoTG9nU2l6ZSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gdXNkUGVyRXRoTG9nLmxlbmd0aDsKICAgIH0KCiAgICAvKgogICAgICogVGhlIGZhbGxiYWNrIGZ1bmN0aW9uIGNvcnJlc3BvbmRzIHRvIGEgZG9uYXRpb24gaW4gRVRICiAgICAgKi8KICAgIGZ1bmN0aW9uKCkgcGF5YWJsZSB7CiAgICAgICAgc2VsbFRva2Vuc0ZvckV0aChtc2cuc2VuZGVyLCBtc2cudmFsdWUpOwogICAgfQoKICAgIC8vLyBXZSBkb24ndCBuZWVkIHRvIHVzZSByZXNwZWN0VGltZUZyYW1lIG1vZGlmaWVyIGhlcmUgYXMgd2UgZG8gZm9yIEVUSCBjb250cmlidXRpb25zLAogICAgLy8vIGJlY2F1c2UgZm9yZWlnbiB0cmFuc2FjdGlvbiBjYW4gY2FtZSB3aXRoIGEgZGVsYXkgdGh1cyBpdCdzIGEgcHJvYmxlbSBvZiBvdXRlciBzZXJ2ZXIgdG8gbWFuYWdlIHRpbWUuCiAgICAvLy8gQHBhcmFtIF9idXllciAtIEVUSCBhZGRyZXNzIG9mIGJ1eWVyIHdoZXJlIHdlIHdpbGwgc2VuZCB0b2tlbnMgdG8uCiAgICBmdW5jdGlvbiBleHRlcm5hbFNhbGUoYWRkcmVzcyBfYnV5ZXIsIHVpbnQyNTYgX2Ftb3VudEluVXNkLCB1aW50MjU2IF90b2tlbnNTb2xkTm9EZWNpbWFscywgdWludDI1NiBfdW5peFRzKQogICAgICAgICAgICBpZk5vdFBhdXNlZCBjYW5Ob3RpZnkgewoKICAgICAgICBpZiAoX2J1eWVyID09IDAgfHwgX2Ftb3VudEluVXNkID09IDAgfHwgX3Rva2Vuc1NvbGROb0RlY2ltYWxzID09IDApIHRocm93OwogICAgICAgIGlmIChfdW5peFRzID09IDAgfHwgX3VuaXhUcyA+IGdldE5vdygpKSB0aHJvdzsgLy8gQ2Fubm90IGFjY2VwdCB0aW1lc3RhbXAgb2YgYSBzYWxlIGZyb20gdGhlIGZ1dHVyZS4KCiAgICAgICAgLy8gSWYgdGhpcyBmb3JlaWduIHRyYW5zYWN0aW9uIGhhcyBiZWVuIGFscmVhZHkgcHJvY2Vzc2VkIGluIHRoaXMgY29udHJhY3QuCiAgICAgICAgaWYgKGV4dGVybmFsU2FsZXNbX2J1eWVyXVtfdW5peFRzXSA+IDApIHRocm93OwoKICAgICAgICB0b3RhbEluQ2VudHMgPSBzYWZlQWRkKHRvdGFsSW5DZW50cywgc2FmZU11bChfYW1vdW50SW5Vc2QsIDEwMCkpOwogICAgICAgIGlmICh0b3RhbEluQ2VudHMgPiBtYXhDYXBJbkNlbnRzKSB0aHJvdzsgLy8gSWYgbWF4IGNhcCByZWFjaGVkLgoKICAgICAgICB1aW50MjU2IHRva2Vuc1NvbGQgPSBzYWZlTXVsKF90b2tlbnNTb2xkTm9EZWNpbWFscywgMWUxOCk7CiAgICAgICAgaWYgKCF0b2tlbi5zZWxsKF9idXllciwgdG9rZW5zU29sZCkpIHRocm93OyAvLyBUcmFuc2ZlciB0b2tlbnMgdG8gYnV5ZXIuCgogICAgICAgIHRvdGFsVG9rZW5zU29sZCA9IHNhZmVBZGQodG90YWxUb2tlbnNTb2xkLCB0b2tlbnNTb2xkKTsKICAgICAgICB0b3RhbEV4dGVybmFsU2FsZXMrKzsKCiAgICAgICAgZXh0ZXJuYWxTYWxlc1tfYnV5ZXJdW191bml4VHNdID0gdG9rZW5zU29sZDsKICAgICAgICBFeHRlcm5hbFNhbGUoX2J1eWVyLCBfYW1vdW50SW5Vc2QsIHRva2Vuc1NvbGQsIF91bml4VHMpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNlbGxUb2tlbnNGb3JFdGgoYWRkcmVzcyBfYnV5ZXIsIHVpbnQyNTYgX2Ftb3VudEluV2VpKSBpbnRlcm5hbCBpZk5vdFBhdXNlZCByZXNwZWN0VGltZUZyYW1lIHsKCiAgICAgICAgdWludDI1NiBhbW91bnRJbkNlbnRzID0gd2VpVG9DZW50cyhfYW1vdW50SW5XZWkpOwogICAgICAgIGlmIChhbW91bnRJbkNlbnRzIDwgbWluSW52ZXN0Q2VudHMpIHRocm93OwoKICAgICAgICB0b3RhbEluQ2VudHMgPSBzYWZlQWRkKHRvdGFsSW5DZW50cywgYW1vdW50SW5DZW50cyk7CiAgICAgICAgaWYgKHRvdGFsSW5DZW50cyA+IG1heENhcEluQ2VudHMpIHRocm93OyAvLyBJZiBtYXggY2FwIHJlYWNoZWQuCgogICAgICAgIHVpbnQyNTYgdG9rZW5zU29sZCA9IGNlbnRzVG9Ub2tlbnMoYW1vdW50SW5DZW50cyk7CiAgICAgICAgaWYgKCF0b2tlbi5zZWxsKF9idXllciwgdG9rZW5zU29sZCkpIHRocm93OyAvLyBUcmFuc2ZlciB0b2tlbnMgdG8gYnV5ZXIuCgogICAgICAgIHRvdGFsV2VpUmVjZWl2ZWQgPSBzYWZlQWRkKHRvdGFsV2VpUmVjZWl2ZWQsIF9hbW91bnRJbldlaSk7CiAgICAgICAgdG90YWxUb2tlbnNTb2xkID0gc2FmZUFkZCh0b3RhbFRva2Vuc1NvbGQsIHRva2Vuc1NvbGQpOwogICAgICAgIHRvdGFsRXRoU2FsZXMrKzsKCiAgICAgICAgQmFja2VyIGJhY2tlciA9IGJhY2tlcnNbX2J1eWVyXTsKICAgICAgICBiYWNrZXIudG9rZW5zU2VudCA9IHNhZmVBZGQoYmFja2VyLnRva2Vuc1NlbnQsIHRva2Vuc1NvbGQpOwogICAgICAgIGJhY2tlci53ZWlSZWNlaXZlZCA9IHNhZmVBZGQoYmFja2VyLndlaVJlY2VpdmVkLCBfYW1vdW50SW5XZWkpOyAgLy8gVXBkYXRlIHRoZSB0b3RhbCB3ZWkgY29sbGVjdGVkIGR1cmluZyB0aGUgY3Jvd2RmdW5kaW5nIGZvciB0aGlzIGJhY2tlcgoKICAgICAgICBFdGhSZWNlaXZlZChfYnV5ZXIsIF9hbW91bnRJbldlaSk7CiAgICB9CgogICAgZnVuY3Rpb24gdG90YWxTYWxlcygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gc2FmZUFkZCh0b3RhbEV0aFNhbGVzLCB0b3RhbEV4dGVybmFsU2FsZXMpOwogICAgfQoKICAgIGZ1bmN0aW9uIHdlaVRvQ2VudHModWludDI1NiBfYW1vdW50SW5XZWkpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gc2FmZURpdihzYWZlTXVsKF9hbW91bnRJbldlaSwgdXNkUGVyRXRoICogMTAwKSwgMSBldGhlcik7CiAgICB9CgogICAgZnVuY3Rpb24gY2VudHNUb1Rva2Vucyh1aW50MjU2IF9hbW91bnRJbkNlbnRzKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiByYXRlID0gdG9rZW5zUGVyQ2VudHM7CiAgICAgICAgLy8gR2l2ZSAtMjUlIGRpc2NvdW50IGlmIGJ1eWVyIHNlbnQgbW9yZSB0aGFuIDUwayBVU0QuCiAgICAgICAgaWYgKF9hbW91bnRJbkNlbnRzID49IGFtb3VudDUwa1VzZEluQ2VudHMpIHsKICAgICAgICAgICAgcmF0ZSA9IHRva2Vuc1BlckNlbnRzX2d0ZTUwa1VzZDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNhZmVNdWwoX2Ftb3VudEluQ2VudHMsIHJhdGUpOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzTWF4Q2FwUmVhY2hlZCgpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gdG90YWxJbkNlbnRzID49IG1heENhcEluQ2VudHM7CiAgICB9CgogICAgZnVuY3Rpb24gaXNTYWxlT24oKSBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgdWludDI1NiBfbm93ID0gZ2V0Tm93KCk7CiAgICAgICAgcmV0dXJuIHN0YXJ0VGltZSA8PSBfbm93ICYmIF9ub3cgPD0gZW5kVGltZTsKICAgIH0KCiAgICBmdW5jdGlvbiBpc1NhbGVPdmVyKCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBnZXROb3coKSA+IGVuZFRpbWU7CiAgICB9CgogICAgZnVuY3Rpb24gaXNGaW5hbGl6ZWQoKSBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGZpbmFsaXplZFRpbWUgPiAwOwogICAgfQoKICAgIC8qCiAgICAqIEZpbmFsaXplIHRoZSBwcmVzYWxlLiBSYWlzZWQgbW9uZXkgY2FuIGJlIHNlbnQgdG8gYmVuZWZpY2lhcnkgb25seSBpZiBwcmVzYWxlIGhpdCBlbmQgdGltZSBvciBtYXggY2FwICgxNW0gVVNEKS4KICAgICovCiAgICBmdW5jdGlvbiBmaW5hbGl6ZSgpIG9ubHlPd25lciB7CgogICAgICAgIC8vIENhbm5vdCBmaW5hbGlzZSBiZWZvcmUgZW5kIGRheSBvZiBwcmVzYWxlIHVudGlsIG1heCBjYXAgaXMgcmVhY2hlZC4KICAgICAgICBpZiAoIWlzTWF4Q2FwUmVhY2hlZCgpICYmICFpc1NhbGVPdmVyKCkpIHRocm93OwoKICAgICAgICBiZW5lZmljaWFyeS50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwoKICAgICAgICBmaW5hbGl6ZWRUaW1lID0gZ2V0Tm93KCk7CiAgICB9Cn0KCmNvbnRyYWN0IFNub3ZQcmVzYWxlIGlzIEJzUHJlc2FsZV9TTk9WIHsKCiAgICBmdW5jdGlvbiBTbm92UHJlc2FsZSgpIEJzUHJlc2FsZV9TTk9WKAogICAgICAgIDB4QkRDNWJBQzM5RGJlMTMyQjFFMDMwZTg5OGFFMzgzMDAxN0Q3ZDk2OSwKICAgICAgICAweDk4M0Y2NGE1NTBDRDlENzMzZjI4MjkyNzVmOTRCMUEzNzI4RmU4ODgsCiAgICAgICAgMjg4CiAgICApIHt9Cn0='.
	

]
