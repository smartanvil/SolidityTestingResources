Class {
	#name : #SRT066128b9f7557b5398db3d4ed141f2e64245ffa1,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT066128b9f7557b5398db3d4ed141f2e64245ffa1 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CmNvbnRyYWN0IFRva2VuIHsKICAgIC8qIFRoaXMgaXMgYSBzbGlnaHQgY2hhbmdlIHRvIHRoZSBFUkMyMCBiYXNlIHN0YW5kYXJkLgogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHN1cHBseSk7CiAgICBpcyByZXBsYWNlZCB3aXRoOgogICAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgICBUaGlzIGF1dG9tYXRpY2FsbHkgY3JlYXRlcyBhIGdldHRlciBmdW5jdGlvbiBmb3IgdGhlIHRvdGFsU3VwcGx5LgogICAgVGhpcyBpcyBtb3ZlZCB0byB0aGUgYmFzZSBjb250cmFjdCBzaW5jZSBwdWJsaWMgZ2V0dGVyIGZ1bmN0aW9ucyBhcmUgbm90CiAgICBjdXJyZW50bHkgcmVjb2duaXNlZCBhcyBhbiBpbXBsZW1lbnRhdGlvbiBvZiB0aGUgbWF0Y2hpbmcgYWJzdHJhY3QKICAgIGZ1bmN0aW9uIGJ5IHRoZSBjb21waWxlci4KICAgICovCiAgICAvLy8gdG90YWwgYW1vdW50IG9mIHRva2VucwogICAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgZnJvbSB3aGljaCB0aGUgYmFsYW5jZSB3aWxsIGJlIHJldHJpZXZlZAogICAgLy8vIEByZXR1cm4gVGhlIGJhbGFuY2UKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKTsKCiAgICAvLy8gQG5vdGljZSBzZW5kIGBfdmFsdWVgIHRva2VuIHRvIGBfdG9gIGZyb20gYG1zZy5zZW5kZXJgCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VuIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCBvciBub3QKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvLy8gQG5vdGljZSBzZW5kIGBfdmFsdWVgIHRva2VuIHRvIGBfdG9gIGZyb20gYF9mcm9tYCBvbiB0aGUgY29uZGl0aW9uIGl0IGlzIGFwcHJvdmVkIGJ5IGBfZnJvbWAKICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3Mgb2YgdGhlIHNlbmRlcgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbiB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vLyBAbm90aWNlIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgX3NwZW5kZXJgIHRvIHNwZW5kIGBfdmFsdWVgIHRva2VucwogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgYXBwcm92YWwgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IG93bmluZyB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHJldHVybiBBbW91bnQgb2YgcmVtYWluaW5nIHRva2VucyBhbGxvd2VkIHRvIHNwZW50CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKTsKCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpOwp9Cgpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIFRva2VuIHsKCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIC8vRGVmYXVsdCBhc3N1bWVzIHRvdGFsU3VwcGx5IGNhbid0IGJlIG92ZXIgbWF4ICgyXjI1NiAtIDEpLgogICAgICAgIC8vSWYgeW91ciB0b2tlbiBsZWF2ZXMgb3V0IHRvdGFsU3VwcGx5IGFuZCBjYW4gaXNzdWUgbW9yZSB0b2tlbnMgYXMgdGltZSBnb2VzIG9uLCB5b3UgbmVlZCB0byBjaGVjayBpZiBpdCBkb2Vzbid0IHdyYXAuCiAgICAgICAgLy9SZXBsYWNlIHRoZSBpZiB3aXRoIHRoaXMgb25lIGluc3RlYWQuCiAgICAgICAgLy9pZiAoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPj0gX3ZhbHVlICYmIGJhbGFuY2VzW190b10gKyBfdmFsdWUgPiBiYWxhbmNlc1tfdG9dKSB7CiAgICAgICAgaWYgKGJhbGFuY2VzW21zZy5zZW5kZXJdID49IF92YWx1ZSAmJiBfdmFsdWUgPiAwKSB7CiAgICAgICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdIC09IF92YWx1ZTsKICAgICAgICAgICAgYmFsYW5jZXNbX3RvXSArPSBfdmFsdWU7CiAgICAgICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIHsgcmV0dXJuIGZhbHNlOyB9CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgLy9zYW1lIGFzIGFib3ZlLiBSZXBsYWNlIHRoaXMgbGluZSB3aXRoIHRoZSBmb2xsb3dpbmcgaWYgeW91IHdhbnQgdG8gcHJvdGVjdCBhZ2FpbnN0IHdyYXBwaW5nIHVpbnRzLgogICAgICAgIC8vaWYgKGJhbGFuY2VzW19mcm9tXSA+PSBfdmFsdWUgJiYgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPj0gX3ZhbHVlICYmIGJhbGFuY2VzW190b10gKyBfdmFsdWUgPiBiYWxhbmNlc1tfdG9dKSB7CiAgICAgICAgaWYgKGJhbGFuY2VzW19mcm9tXSA+PSBfdmFsdWUgJiYgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPj0gX3ZhbHVlICYmIF92YWx1ZSA+IDApIHsKICAgICAgICAgICAgYmFsYW5jZXNbX3RvXSArPSBfdmFsdWU7CiAgICAgICAgICAgIGJhbGFuY2VzW19mcm9tXSAtPSBfdmFsdWU7CiAgICAgICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdIC09IF92YWx1ZTsKICAgICAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIHsgcmV0dXJuIGZhbHNlOyB9CiAgICB9CgogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgICAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICAgIH0KCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogICAgfQoKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7Cn0KCmNvbnRyYWN0IEh1bWFuU3RhbmRhcmRUb2tlbiBpcyBTdGFuZGFyZFRva2VuIHsKCiAgICAvKiBQdWJsaWMgdmFyaWFibGVzIG9mIHRoZSB0b2tlbiAqLwoKICAgIC8qCiAgICBOT1RFOgogICAgVGhlIGZvbGxvd2luZyB2YXJpYWJsZXMgYXJlIE9QVElPTkFMIHZhbml0aWVzLiBPbmUgZG9lcyBub3QgaGF2ZSB0byBpbmNsdWRlIHRoZW0uCiAgICBUaGV5IGFsbG93IG9uZSB0byBjdXN0b21pc2UgdGhlIHRva2VuIGNvbnRyYWN0ICYgaW4gbm8gd2F5IGluZmx1ZW5jZXMgdGhlIGNvcmUgZnVuY3Rpb25hbGl0eS4KICAgIFNvbWUgd2FsbGV0cy9pbnRlcmZhY2VzIG1pZ2h0IG5vdCBldmVuIGJvdGhlciB0byBsb29rIGF0IHRoaXMgaW5mb3JtYXRpb24uCiAgICAqLwogICAgc3RyaW5nIHB1YmxpYyBuYW1lOyAgICAgICAgICAgICAgICAgICAvL2ZhbmN5IG5hbWU6IGVnIFNpbW9uIEJ1Y2tzCiAgICB1aW50OCBwdWJsaWMgZGVjaW1hbHM7ICAgICAgICAgICAgICAgIC8vSG93IG1hbnkgZGVjaW1hbHMgdG8gc2hvdy4gaWUuIFRoZXJlIGNvdWxkIDEwMDAgYmFzZSB1bml0cyB3aXRoIDMgZGVjaW1hbHMuIE1lYW5pbmcgMC45ODAgU0JYID0gOTgwIGJhc2UgdW5pdHMuIEl0J3MgbGlrZSBjb21wYXJpbmcgMSB3ZWkgdG8gMSBldGhlci4KICAgIHN0cmluZyBwdWJsaWMgc3ltYm9sOyAgICAgICAgICAgICAgICAgLy9BbiBpZGVudGlmaWVyOiBlZyBTQlgKICAgIHN0cmluZyBwdWJsaWMgdmVyc2lvbiA9ICdIMC4xJzsgICAgICAgLy9odW1hbiAwLjEgc3RhbmRhcmQuIEp1c3QgYW4gYXJiaXRyYXJ5IHZlcnNpb25pbmcgc2NoZW1lLgoKICAgIGZ1bmN0aW9uIEh1bWFuU3RhbmRhcmRUb2tlbigKICAgICAgICB1aW50MjU2IF9pbml0aWFsQW1vdW50LAogICAgICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgICAgIHVpbnQ4IF9kZWNpbWFsVW5pdHMsCiAgICAgICAgc3RyaW5nIF90b2tlblN5bWJvbAogICAgICAgICkgewogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gX2luaXRpYWxBbW91bnQ7ICAgICAgICAgICAgICAgLy8gR2l2ZSB0aGUgY3JlYXRvciBhbGwgaW5pdGlhbCB0b2tlbnMKICAgICAgICB0b3RhbFN1cHBseSA9IF9pbml0aWFsQW1vdW50OyAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSB0b3RhbCBzdXBwbHkKICAgICAgICBuYW1lID0gX3Rva2VuTmFtZTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgbmFtZSBmb3IgZGlzcGxheSBwdXJwb3NlcwogICAgICAgIGRlY2ltYWxzID0gX2RlY2ltYWxVbml0czsgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQW1vdW50IG9mIGRlY2ltYWxzIGZvciBkaXNwbGF5IHB1cnBvc2VzCiAgICAgICAgc3ltYm9sID0gX3Rva2VuU3ltYm9sOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIHN5bWJvbCBmb3IgZGlzcGxheSBwdXJwb3NlcwogICAgfQoKICAgIC8qIEFwcHJvdmVzIGFuZCB0aGVuIGNhbGxzIHRoZSByZWNlaXZpbmcgY29udHJhY3QgKi8KICAgIGZ1bmN0aW9uIGFwcHJvdmVBbmRDYWxsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlLCBieXRlcyBfZXh0cmFEYXRhKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKCiAgICAgICAgLy9jYWxsIHRoZSByZWNlaXZlQXBwcm92YWwgZnVuY3Rpb24gb24gdGhlIGNvbnRyYWN0IHlvdSB3YW50IHRvIGJlIG5vdGlmaWVkLiBUaGlzIGNyYWZ0cyB0aGUgZnVuY3Rpb24gc2lnbmF0dXJlIG1hbnVhbGx5IHNvIG9uZSBkb2Vzbid0IGhhdmUgdG8gaW5jbHVkZSBhIGNvbnRyYWN0IGluIGhlcmUganVzdCBmb3IgdGhpcy4KICAgICAgICAvL3JlY2VpdmVBcHByb3ZhbChhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF92YWx1ZSwgYWRkcmVzcyBfdG9rZW5Db250cmFjdCwgYnl0ZXMgX2V4dHJhRGF0YSkKICAgICAgICAvL2l0IGlzIGFzc3VtZWQgdGhhdCB3aGVuIGRvZXMgdGhpcyB0aGF0IHRoZSBjYWxsICpzaG91bGQqIHN1Y2NlZWQsIG90aGVyd2lzZSBvbmUgd291bGQgdXNlIHZhbmlsbGEgYXBwcm92ZSBpbnN0ZWFkLgogICAgICAgIHJlcXVpcmUoX3NwZW5kZXIuY2FsbChieXRlczQoYnl0ZXMzMihzaGEzKCJyZWNlaXZlQXBwcm92YWwoYWRkcmVzcyx1aW50MjU2LGFkZHJlc3MsYnl0ZXMpIikpKSwgbXNnLnNlbmRlciwgX3ZhbHVlLCB0aGlzLCBfZXh0cmFEYXRhKSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cn0KCi8vLyBAdGl0bGUgU3RhbmRhcmRCb3VudGllcwovLy8gQGRldiBVc2VkIHRvIHBheSBvdXQgaW5kaXZpZHVhbHMgb3IgZ3JvdXBzIGZvciB0YXNrIGZ1bGZpbGxtZW50IHRocm91Z2gKLy8vIHN0ZXB3aXNlIHdvcmsgc3VibWlzc2lvbiwgYWNjZXB0YW5jZSwgYW5kIHBheW1lbnQKLy8vIEBhdXRob3IgTWFyayBCZXlsaW4gPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iMGY2MjZlN2Q2NDIxNmQ2YTc2NjM2NjYxNGY2YzYwNjE3YzZhNjE3Yzc2N2MyMTYxNmE3YiI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+LCBHb24mIzIzMTthbG8gUyYjMjI1OyA8PHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSIzOTVlNTY1NzVhNTg1NTU2MTc0YTU4Nzk1YTU2NTc0YTVjNTc0YTQwNGExNzU3NWM0ZCI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+CmNvbnRyYWN0IFN0YW5kYXJkQm91bnRpZXMgewoKICAvKgogICAqIEV2ZW50cwogICAqLwogIGV2ZW50IEJvdW50eUlzc3VlZCh1aW50IGJvdW50eUlkKTsKICBldmVudCBCb3VudHlBY3RpdmF0ZWQodWludCBib3VudHlJZCwgYWRkcmVzcyBpc3N1ZXIpOwogIGV2ZW50IEJvdW50eUZ1bGZpbGxlZCh1aW50IGJvdW50eUlkLCBhZGRyZXNzIGluZGV4ZWQgZnVsZmlsbGVyLCB1aW50MjU2IGluZGV4ZWQgX2Z1bGZpbGxtZW50SWQpOwogIGV2ZW50IEZ1bGZpbGxtZW50VXBkYXRlZCh1aW50IF9ib3VudHlJZCwgdWludCBfZnVsZmlsbG1lbnRJZCk7CiAgZXZlbnQgRnVsZmlsbG1lbnRBY2NlcHRlZCh1aW50IGJvdW50eUlkLCBhZGRyZXNzIGluZGV4ZWQgZnVsZmlsbGVyLCB1aW50MjU2IGluZGV4ZWQgX2Z1bGZpbGxtZW50SWQpOwogIGV2ZW50IEJvdW50eUtpbGxlZCh1aW50IGJvdW50eUlkLCBhZGRyZXNzIGluZGV4ZWQgaXNzdWVyKTsKICBldmVudCBDb250cmlidXRpb25BZGRlZCh1aW50IGJvdW50eUlkLCBhZGRyZXNzIGluZGV4ZWQgY29udHJpYnV0b3IsIHVpbnQyNTYgdmFsdWUpOwogIGV2ZW50IERlYWRsaW5lRXh0ZW5kZWQodWludCBib3VudHlJZCwgdWludCBuZXdEZWFkbGluZSk7CiAgZXZlbnQgQm91bnR5Q2hhbmdlZCh1aW50IGJvdW50eUlkKTsKICBldmVudCBJc3N1ZXJUcmFuc2ZlcnJlZCh1aW50IF9ib3VudHlJZCwgYWRkcmVzcyBpbmRleGVkIF9uZXdJc3N1ZXIpOwogIGV2ZW50IFBheW91dEluY3JlYXNlZCh1aW50IF9ib3VudHlJZCwgdWludCBfbmV3RnVsZmlsbG1lbnRBbW91bnQpOwoKCiAgLyoKICAgKiBTdG9yYWdlCiAgICovCgogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKICBCb3VudHlbXSBwdWJsaWMgYm91bnRpZXM7CgogIG1hcHBpbmcodWludD0+RnVsZmlsbG1lbnRbXSkgZnVsZmlsbG1lbnRzOwogIG1hcHBpbmcodWludD0+dWludCkgbnVtQWNjZXB0ZWQ7CiAgbWFwcGluZyh1aW50PT5IdW1hblN0YW5kYXJkVG9rZW4pIHRva2VuQ29udHJhY3RzOwoKICAvKgogICAqIEVudW1zCiAgICovCgogIGVudW0gQm91bnR5U3RhZ2VzIHsKICAgICAgRHJhZnQsCiAgICAgIEFjdGl2ZSwKICAgICAgRGVhZAogIH0KCiAgLyoKICAgKiBTdHJ1Y3RzCiAgICovCgogIHN0cnVjdCBCb3VudHkgewogICAgICBhZGRyZXNzIGlzc3VlcjsKICAgICAgdWludCBkZWFkbGluZTsKICAgICAgc3RyaW5nIGRhdGE7CiAgICAgIHVpbnQgZnVsZmlsbG1lbnRBbW91bnQ7CiAgICAgIGFkZHJlc3MgYXJiaXRlcjsKICAgICAgYm9vbCBwYXlzVG9rZW5zOwogICAgICBCb3VudHlTdGFnZXMgYm91bnR5U3RhZ2U7CiAgICAgIHVpbnQgYmFsYW5jZTsKICB9CgogIHN0cnVjdCBGdWxmaWxsbWVudCB7CiAgICAgIGJvb2wgYWNjZXB0ZWQ7CiAgICAgIGFkZHJlc3MgZnVsZmlsbGVyOwogICAgICBzdHJpbmcgZGF0YTsKICB9CgogIC8qCiAgICogTW9kaWZpZXJzCiAgICovCgogIG1vZGlmaWVyIHZhbGlkYXRlTm90VG9vTWFueUJvdW50aWVzKCl7CiAgICByZXF1aXJlKChib3VudGllcy5sZW5ndGggKyAxKSA+IGJvdW50aWVzLmxlbmd0aCk7CiAgICBfOwogIH0KCiAgbW9kaWZpZXIgdmFsaWRhdGVOb3RUb29NYW55RnVsZmlsbG1lbnRzKHVpbnQgX2JvdW50eUlkKXsKICAgIHJlcXVpcmUoKGZ1bGZpbGxtZW50c1tfYm91bnR5SWRdLmxlbmd0aCArIDEpID4gZnVsZmlsbG1lbnRzW19ib3VudHlJZF0ubGVuZ3RoKTsKICAgIF87CiAgfQoKICBtb2RpZmllciB2YWxpZGF0ZUJvdW50eUFycmF5SW5kZXgodWludCBfYm91bnR5SWQpewogICAgcmVxdWlyZShfYm91bnR5SWQgPCBib3VudGllcy5sZW5ndGgpOwogICAgXzsKICB9CgogIG1vZGlmaWVyIG9ubHlJc3N1ZXIodWludCBfYm91bnR5SWQpIHsKICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGJvdW50aWVzW19ib3VudHlJZF0uaXNzdWVyKTsKICAgICAgXzsKICB9CgogIG1vZGlmaWVyIG9ubHlGdWxmaWxsZXIodWludCBfYm91bnR5SWQsIHVpbnQgX2Z1bGZpbGxtZW50SWQpIHsKICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGZ1bGZpbGxtZW50c1tfYm91bnR5SWRdW19mdWxmaWxsbWVudElkXS5mdWxmaWxsZXIpOwogICAgICBfOwogIH0KCiAgbW9kaWZpZXIgYW1vdW50SXNOb3RaZXJvKHVpbnQgX2Ftb3VudCkgewogICAgICByZXF1aXJlKF9hbW91bnQgIT0gMCk7CiAgICAgIF87CiAgfQoKICBtb2RpZmllciB0cmFuc2ZlcnJlZEFtb3VudEVxdWFsc1ZhbHVlKHVpbnQgX2JvdW50eUlkLCB1aW50IF9hbW91bnQpIHsKICAgICAgaWYgKGJvdW50aWVzW19ib3VudHlJZF0ucGF5c1Rva2Vucyl7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPT0gMCk7CiAgICAgICAgdWludCBvbGRCYWxhbmNlID0gdG9rZW5Db250cmFjdHNbX2JvdW50eUlkXS5iYWxhbmNlT2YodGhpcyk7CiAgICAgICAgaWYgKF9hbW91bnQgIT0gMCl7CiAgICAgICAgICByZXF1aXJlKHRva2VuQ29udHJhY3RzW19ib3VudHlJZF0udHJhbnNmZXJGcm9tKG1zZy5zZW5kZXIsIHRoaXMsIF9hbW91bnQpKTsKICAgICAgICB9CiAgICAgICAgcmVxdWlyZSgodG9rZW5Db250cmFjdHNbX2JvdW50eUlkXS5iYWxhbmNlT2YodGhpcykgLSBvbGRCYWxhbmNlKSA9PSBfYW1vdW50KTsKCiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVxdWlyZSgoX2Ftb3VudCAqIDEgd2VpKSA9PSBtc2cudmFsdWUpOwogICAgICB9CiAgICAgIF87CiAgfQoKICBtb2RpZmllciBpc0JlZm9yZURlYWRsaW5lKHVpbnQgX2JvdW50eUlkKSB7CiAgICAgIHJlcXVpcmUobm93IDwgYm91bnRpZXNbX2JvdW50eUlkXS5kZWFkbGluZSk7CiAgICAgIF87CiAgfQoKICBtb2RpZmllciB2YWxpZGF0ZURlYWRsaW5lKHVpbnQgX25ld0RlYWRsaW5lKSB7CiAgICAgIHJlcXVpcmUoX25ld0RlYWRsaW5lID4gbm93KTsKICAgICAgXzsKICB9CgogIG1vZGlmaWVyIGlzQXRTdGFnZSh1aW50IF9ib3VudHlJZCwgQm91bnR5U3RhZ2VzIF9kZXNpcmVkU3RhZ2UpIHsKICAgICAgcmVxdWlyZShib3VudGllc1tfYm91bnR5SWRdLmJvdW50eVN0YWdlID09IF9kZXNpcmVkU3RhZ2UpOwogICAgICBfOwogIH0KCiAgbW9kaWZpZXIgdmFsaWRhdGVGdWxmaWxsbWVudEFycmF5SW5kZXgodWludCBfYm91bnR5SWQsIHVpbnQgX2luZGV4KSB7CiAgICAgIHJlcXVpcmUoX2luZGV4IDwgZnVsZmlsbG1lbnRzW19ib3VudHlJZF0ubGVuZ3RoKTsKICAgICAgXzsKICB9CgogIG1vZGlmaWVyIG5vdFlldEFjY2VwdGVkKHVpbnQgX2JvdW50eUlkLCB1aW50IF9mdWxmaWxsbWVudElkKXsKICAgICAgcmVxdWlyZShmdWxmaWxsbWVudHNbX2JvdW50eUlkXVtfZnVsZmlsbG1lbnRJZF0uYWNjZXB0ZWQgPT0gZmFsc2UpOwogICAgICBfOwogIH0KCiAgLyoKICAgKiBQdWJsaWMgZnVuY3Rpb25zCiAgICovCgoKICAvLy8gQGRldiBTdGFuZGFyZEJvdW50aWVzKCk6IGluc3RhbnRpYXRlcwogIC8vLyBAcGFyYW0gX293bmVyIHRoZSBpc3N1ZXIgb2YgdGhlIHN0YW5kYXJkYm91bnRpZXMgY29udHJhY3QsIHdobyBoYXMgdGhlCiAgLy8vIGFiaWxpdHkgdG8gcmVtb3ZlIGJvdW50aWVzCiAgZnVuY3Rpb24gU3RhbmRhcmRCb3VudGllcyhhZGRyZXNzIF9vd25lcikKICAgICAgcHVibGljCiAgewogICAgICBvd25lciA9IF9vd25lcjsKICB9CgogIC8vLyBAZGV2IGlzc3VlQm91bnR5KCk6IGluc3RhbnRpYXRlcyBhIG5ldyBkcmFmdCBib3VudHkKICAvLy8gQHBhcmFtIF9pc3N1ZXIgdGhlIGFkZHJlc3Mgb2YgdGhlIGludGVuZGVkIGlzc3VlciBvZiB0aGUgYm91bnR5CiAgLy8vIEBwYXJhbSBfZGVhZGxpbmUgdGhlIHVuaXggdGltZXN0YW1wIGFmdGVyIHdoaWNoIGZ1bGZpbGxtZW50cyB3aWxsIG5vIGxvbmdlciBiZSBhY2NlcHRlZAogIC8vLyBAcGFyYW0gX2RhdGEgdGhlIHJlcXVpcmVtZW50cyBvZiB0aGUgYm91bnR5CiAgLy8vIEBwYXJhbSBfZnVsZmlsbG1lbnRBbW91bnQgdGhlIGFtb3VudCBvZiB3ZWkgdG8gYmUgcGFpZCBvdXQgZm9yIGVhY2ggc3VjY2Vzc2Z1bCBmdWxmaWxsbWVudAogIC8vLyBAcGFyYW0gX2FyYml0ZXIgdGhlIGFkZHJlc3Mgb2YgdGhlIGFyYml0ZXIgd2hvIGNhbiBtZWRpYXRlIGNsYWltcwogIC8vLyBAcGFyYW0gX3BheXNUb2tlbnMgd2hldGhlciB0aGUgYm91bnR5IHBheXMgaW4gdG9rZW5zIG9yIGluIEVUSAogIC8vLyBAcGFyYW0gX3Rva2VuQ29udHJhY3QgdGhlIGFkZHJlc3Mgb2YgdGhlIGNvbnRyYWN0IGlmIF9wYXlzVG9rZW5zIGlzIHRydWUKICBmdW5jdGlvbiBpc3N1ZUJvdW50eSgKICAgICAgYWRkcmVzcyBfaXNzdWVyLAogICAgICB1aW50IF9kZWFkbGluZSwKICAgICAgc3RyaW5nIF9kYXRhLAogICAgICB1aW50MjU2IF9mdWxmaWxsbWVudEFtb3VudCwKICAgICAgYWRkcmVzcyBfYXJiaXRlciwKICAgICAgYm9vbCBfcGF5c1Rva2VucywKICAgICAgYWRkcmVzcyBfdG9rZW5Db250cmFjdAogICkKICAgICAgcHVibGljCiAgICAgIHZhbGlkYXRlRGVhZGxpbmUoX2RlYWRsaW5lKQogICAgICBhbW91bnRJc05vdFplcm8oX2Z1bGZpbGxtZW50QW1vdW50KQogICAgICB2YWxpZGF0ZU5vdFRvb01hbnlCb3VudGllcwogICAgICByZXR1cm5zICh1aW50KQogIHsKICAgICAgYm91bnRpZXMucHVzaChCb3VudHkoX2lzc3VlciwgX2RlYWRsaW5lLCBfZGF0YSwgX2Z1bGZpbGxtZW50QW1vdW50LCBfYXJiaXRlciwgX3BheXNUb2tlbnMsIEJvdW50eVN0YWdlcy5EcmFmdCwgMCkpOwogICAgICBpZiAoX3BheXNUb2tlbnMpewogICAgICAgIHRva2VuQ29udHJhY3RzW2JvdW50aWVzLmxlbmd0aCAtIDFdID0gSHVtYW5TdGFuZGFyZFRva2VuKF90b2tlbkNvbnRyYWN0KTsKICAgICAgfQogICAgICBCb3VudHlJc3N1ZWQoYm91bnRpZXMubGVuZ3RoIC0gMSk7CiAgICAgIHJldHVybiAoYm91bnRpZXMubGVuZ3RoIC0gMSk7CiAgfQoKICAvLy8gQGRldiBpc3N1ZUFuZEFjdGl2YXRlQm91bnR5KCk6IGluc3RhbnRpYXRlcyBhIG5ldyBkcmFmdCBib3VudHkKICAvLy8gQHBhcmFtIF9pc3N1ZXIgdGhlIGFkZHJlc3Mgb2YgdGhlIGludGVuZGVkIGlzc3VlciBvZiB0aGUgYm91bnR5CiAgLy8vIEBwYXJhbSBfZGVhZGxpbmUgdGhlIHVuaXggdGltZXN0YW1wIGFmdGVyIHdoaWNoIGZ1bGZpbGxtZW50cyB3aWxsIG5vIGxvbmdlciBiZSBhY2NlcHRlZAogIC8vLyBAcGFyYW0gX2RhdGEgdGhlIHJlcXVpcmVtZW50cyBvZiB0aGUgYm91bnR5CiAgLy8vIEBwYXJhbSBfZnVsZmlsbG1lbnRBbW91bnQgdGhlIGFtb3VudCBvZiB3ZWkgdG8gYmUgcGFpZCBvdXQgZm9yIGVhY2ggc3VjY2Vzc2Z1bCBmdWxmaWxsbWVudAogIC8vLyBAcGFyYW0gX2FyYml0ZXIgdGhlIGFkZHJlc3Mgb2YgdGhlIGFyYml0ZXIgd2hvIGNhbiBtZWRpYXRlIGNsYWltcwogIC8vLyBAcGFyYW0gX3BheXNUb2tlbnMgd2hldGhlciB0aGUgYm91bnR5IHBheXMgaW4gdG9rZW5zIG9yIGluIEVUSAogIC8vLyBAcGFyYW0gX3Rva2VuQ29udHJhY3QgdGhlIGFkZHJlc3Mgb2YgdGhlIGNvbnRyYWN0IGlmIF9wYXlzVG9rZW5zIGlzIHRydWUKICAvLy8gQHBhcmFtIF92YWx1ZSB0aGUgdG90YWwgbnVtYmVyIG9mIHRva2VucyBiZWluZyBkZXBvc2l0ZWQgdXBvbiBhY3RpdmF0aW9uCiAgZnVuY3Rpb24gaXNzdWVBbmRBY3RpdmF0ZUJvdW50eSgKICAgICAgYWRkcmVzcyBfaXNzdWVyLAogICAgICB1aW50IF9kZWFkbGluZSwKICAgICAgc3RyaW5nIF9kYXRhLAogICAgICB1aW50MjU2IF9mdWxmaWxsbWVudEFtb3VudCwKICAgICAgYWRkcmVzcyBfYXJiaXRlciwKICAgICAgYm9vbCBfcGF5c1Rva2VucywKICAgICAgYWRkcmVzcyBfdG9rZW5Db250cmFjdCwKICAgICAgdWludDI1NiBfdmFsdWUKICApCiAgICAgIHB1YmxpYwogICAgICBwYXlhYmxlCiAgICAgIHZhbGlkYXRlRGVhZGxpbmUoX2RlYWRsaW5lKQogICAgICBhbW91bnRJc05vdFplcm8oX2Z1bGZpbGxtZW50QW1vdW50KQogICAgICB2YWxpZGF0ZU5vdFRvb01hbnlCb3VudGllcwogICAgICByZXR1cm5zICh1aW50KQogIHsKICAgICAgcmVxdWlyZSAoX3ZhbHVlID49IF9mdWxmaWxsbWVudEFtb3VudCk7CiAgICAgIGlmIChfcGF5c1Rva2Vucyl7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPT0gMCk7CiAgICAgICAgdG9rZW5Db250cmFjdHNbYm91bnRpZXMubGVuZ3RoXSA9IEh1bWFuU3RhbmRhcmRUb2tlbihfdG9rZW5Db250cmFjdCk7CiAgICAgICAgcmVxdWlyZSh0b2tlbkNvbnRyYWN0c1tib3VudGllcy5sZW5ndGhdLnRyYW5zZmVyRnJvbShtc2cuc2VuZGVyLCB0aGlzLCBfdmFsdWUpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXF1aXJlKChfdmFsdWUgKiAxIHdlaSkgPT0gbXNnLnZhbHVlKTsKICAgICAgfQogICAgICBib3VudGllcy5wdXNoKEJvdW50eShfaXNzdWVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2RlYWRsaW5lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2RhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfZnVsZmlsbG1lbnRBbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfYXJiaXRlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9wYXlzVG9rZW5zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgQm91bnR5U3RhZ2VzLkFjdGl2ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF92YWx1ZSkpOwogICAgICBCb3VudHlJc3N1ZWQoYm91bnRpZXMubGVuZ3RoIC0gMSk7CiAgICAgIENvbnRyaWJ1dGlvbkFkZGVkKGJvdW50aWVzLmxlbmd0aCAtIDEsIG1zZy5zZW5kZXIsIF92YWx1ZSk7CiAgICAgIEJvdW50eUFjdGl2YXRlZChib3VudGllcy5sZW5ndGggLSAxLCBtc2cuc2VuZGVyKTsKICAgICAgcmV0dXJuIChib3VudGllcy5sZW5ndGggLSAxKTsKICB9CgogIG1vZGlmaWVyIGlzTm90RGVhZCh1aW50IF9ib3VudHlJZCkgewogICAgICByZXF1aXJlKGJvdW50aWVzW19ib3VudHlJZF0uYm91bnR5U3RhZ2UgIT0gQm91bnR5U3RhZ2VzLkRlYWQpOwogICAgICBfOwogIH0KCiAgLy8vIEBkZXYgY29udHJpYnV0ZSgpOiBhIGZ1bmN0aW9uIGFsbG93aW5nIGFueW9uZSB0byBjb250cmlidXRlIHRva2VucyB0byBhCiAgLy8vIGJvdW50eSwgYXMgbG9uZyBhcyBpdCBpcyBzdGlsbCBiZWZvcmUgaXRzIGRlYWRsaW5lLiBTaG91bGRuJ3Qga2VlcAogIC8vLyB0aGVtIGJ5IGFjY2lkZW50IChoZW5jZSAndmFsdWUnKS4KICAvLy8gQHBhcmFtIF9ib3VudHlJZCB0aGUgaW5kZXggb2YgdGhlIGJvdW50eQogIC8vLyBAcGFyYW0gX3ZhbHVlIHRoZSBhbW91bnQgYmVpbmcgY29udHJpYnV0ZWQgaW4gZXRoZXIgdG8gcHJldmVudCBhY2NpZGVudGFsIGRlcG9zaXRzCiAgLy8vIEBub3RpY2UgUGxlYXNlIG5vdGUgeW91IGZ1bmRzIHdpbGwgYmUgYXQgdGhlIG1lcmN5IG9mIHRoZSBpc3N1ZXIKICAvLy8gIGFuZCBjYW4gYmUgZHJhaW5lZCBhdCBhbnkgbW9tZW50LiBCZSBjYXJlZnVsIQogIGZ1bmN0aW9uIGNvbnRyaWJ1dGUgKHVpbnQgX2JvdW50eUlkLCB1aW50IF92YWx1ZSkKICAgICAgcGF5YWJsZQogICAgICBwdWJsaWMKICAgICAgdmFsaWRhdGVCb3VudHlBcnJheUluZGV4KF9ib3VudHlJZCkKICAgICAgaXNCZWZvcmVEZWFkbGluZShfYm91bnR5SWQpCiAgICAgIGlzTm90RGVhZChfYm91bnR5SWQpCiAgICAgIGFtb3VudElzTm90WmVybyhfdmFsdWUpCiAgICAgIHRyYW5zZmVycmVkQW1vdW50RXF1YWxzVmFsdWUoX2JvdW50eUlkLCBfdmFsdWUpCiAgewogICAgICBib3VudGllc1tfYm91bnR5SWRdLmJhbGFuY2UgKz0gX3ZhbHVlOwoKICAgICAgQ29udHJpYnV0aW9uQWRkZWQoX2JvdW50eUlkLCBtc2cuc2VuZGVyLCBfdmFsdWUpOwogIH0KCiAgLy8vIEBub3RpY2UgU2VuZCBmdW5kcyB0byBhY3RpdmF0ZSB0aGUgYnVnIGJvdW50eQogIC8vLyBAZGV2IGFjdGl2YXRlQm91bnR5KCk6IGFjdGl2YXRlIGEgYm91bnR5IHNvIGl0IG1heSBwYXkgb3V0CiAgLy8vIEBwYXJhbSBfYm91bnR5SWQgdGhlIGluZGV4IG9mIHRoZSBib3VudHkKICAvLy8gQHBhcmFtIF92YWx1ZSB0aGUgYW1vdW50IGJlaW5nIGNvbnRyaWJ1dGVkIGluIGV0aGVyIHRvIHByZXZlbnQKICAvLy8gYWNjaWRlbnRhbCBkZXBvc2l0cwogIGZ1bmN0aW9uIGFjdGl2YXRlQm91bnR5KHVpbnQgX2JvdW50eUlkLCB1aW50IF92YWx1ZSkKICAgICAgcGF5YWJsZQogICAgICBwdWJsaWMKICAgICAgdmFsaWRhdGVCb3VudHlBcnJheUluZGV4KF9ib3VudHlJZCkKICAgICAgaXNCZWZvcmVEZWFkbGluZShfYm91bnR5SWQpCiAgICAgIG9ubHlJc3N1ZXIoX2JvdW50eUlkKQogICAgICB0cmFuc2ZlcnJlZEFtb3VudEVxdWFsc1ZhbHVlKF9ib3VudHlJZCwgX3ZhbHVlKQogIHsKICAgICAgYm91bnRpZXNbX2JvdW50eUlkXS5iYWxhbmNlICs9IF92YWx1ZTsKICAgICAgcmVxdWlyZSAoYm91bnRpZXNbX2JvdW50eUlkXS5iYWxhbmNlID49IGJvdW50aWVzW19ib3VudHlJZF0uZnVsZmlsbG1lbnRBbW91bnQpOwogICAgICB0cmFuc2l0aW9uVG9TdGF0ZShfYm91bnR5SWQsIEJvdW50eVN0YWdlcy5BY3RpdmUpOwoKICAgICAgQ29udHJpYnV0aW9uQWRkZWQoX2JvdW50eUlkLCBtc2cuc2VuZGVyLCBfdmFsdWUpOwogICAgICBCb3VudHlBY3RpdmF0ZWQoX2JvdW50eUlkLCBtc2cuc2VuZGVyKTsKICB9CgogIG1vZGlmaWVyIG5vdElzc3Vlck9yQXJiaXRlcih1aW50IF9ib3VudHlJZCkgewogICAgICByZXF1aXJlKG1zZy5zZW5kZXIgIT0gYm91bnRpZXNbX2JvdW50eUlkXS5pc3N1ZXIgJiYgbXNnLnNlbmRlciAhPSBib3VudGllc1tfYm91bnR5SWRdLmFyYml0ZXIpOwogICAgICBfOwogIH0KCiAgLy8vIEBkZXYgZnVsZmlsbEJvdW50eSgpOiBzdWJtaXQgYSBmdWxmaWxsbWVudCBmb3IgdGhlIGdpdmVuIGJvdW50eQogIC8vLyBAcGFyYW0gX2JvdW50eUlkIHRoZSBpbmRleCBvZiB0aGUgYm91bnR5CiAgLy8vIEBwYXJhbSBfZGF0YSB0aGUgZGF0YSBhcnRpZmFjdHMgcmVwcmVzZW50aW5nIHRoZSBmdWxmaWxsbWVudCBvZiB0aGUgYm91bnR5CiAgZnVuY3Rpb24gZnVsZmlsbEJvdW50eSh1aW50IF9ib3VudHlJZCwgc3RyaW5nIF9kYXRhKQogICAgICBwdWJsaWMKICAgICAgdmFsaWRhdGVCb3VudHlBcnJheUluZGV4KF9ib3VudHlJZCkKICAgICAgdmFsaWRhdGVOb3RUb29NYW55RnVsZmlsbG1lbnRzKF9ib3VudHlJZCkKICAgICAgaXNBdFN0YWdlKF9ib3VudHlJZCwgQm91bnR5U3RhZ2VzLkFjdGl2ZSkKICAgICAgaXNCZWZvcmVEZWFkbGluZShfYm91bnR5SWQpCiAgICAgIG5vdElzc3Vlck9yQXJiaXRlcihfYm91bnR5SWQpCiAgewogICAgICBmdWxmaWxsbWVudHNbX2JvdW50eUlkXS5wdXNoKEZ1bGZpbGxtZW50KGZhbHNlLCBtc2cuc2VuZGVyLCBfZGF0YSkpOwoKICAgICAgQm91bnR5RnVsZmlsbGVkKF9ib3VudHlJZCwgbXNnLnNlbmRlciwgKGZ1bGZpbGxtZW50c1tfYm91bnR5SWRdLmxlbmd0aCAtIDEpKTsKICB9CgogIC8vLyBAZGV2IHVwZGF0ZUZ1bGZpbGxtZW50KCk6IFN1Ym1pdCB1cGRhdGVkIGRhdGEgZm9yIGEgZ2l2ZW4gZnVsZmlsbG1lbnQKICAvLy8gQHBhcmFtIF9ib3VudHlJZCB0aGUgaW5kZXggb2YgdGhlIGJvdW50eQogIC8vLyBAcGFyYW0gX2Z1bGZpbGxtZW50SWQgdGhlIGluZGV4IG9mIHRoZSBmdWxmaWxsbWVudAogIC8vLyBAcGFyYW0gX2RhdGEgdGhlIG5ldyBkYXRhIGJlaW5nIHN1Ym1pdHRlZAogIGZ1bmN0aW9uIHVwZGF0ZUZ1bGZpbGxtZW50KHVpbnQgX2JvdW50eUlkLCB1aW50IF9mdWxmaWxsbWVudElkLCBzdHJpbmcgX2RhdGEpCiAgICAgIHB1YmxpYwogICAgICB2YWxpZGF0ZUJvdW50eUFycmF5SW5kZXgoX2JvdW50eUlkKQogICAgICB2YWxpZGF0ZUZ1bGZpbGxtZW50QXJyYXlJbmRleChfYm91bnR5SWQsIF9mdWxmaWxsbWVudElkKQogICAgICBvbmx5RnVsZmlsbGVyKF9ib3VudHlJZCwgX2Z1bGZpbGxtZW50SWQpCiAgICAgIG5vdFlldEFjY2VwdGVkKF9ib3VudHlJZCwgX2Z1bGZpbGxtZW50SWQpCiAgewogICAgICBmdWxmaWxsbWVudHNbX2JvdW50eUlkXVtfZnVsZmlsbG1lbnRJZF0uZGF0YSA9IF9kYXRhOwogICAgICBGdWxmaWxsbWVudFVwZGF0ZWQoX2JvdW50eUlkLCBfZnVsZmlsbG1lbnRJZCk7CiAgfQoKICBtb2RpZmllciBvbmx5SXNzdWVyT3JBcmJpdGVyKHVpbnQgX2JvdW50eUlkKSB7CiAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBib3VudGllc1tfYm91bnR5SWRdLmlzc3VlciB8fAogICAgICAgICAobXNnLnNlbmRlciA9PSBib3VudGllc1tfYm91bnR5SWRdLmFyYml0ZXIgJiYgYm91bnRpZXNbX2JvdW50eUlkXS5hcmJpdGVyICE9IGFkZHJlc3MoMCkpKTsKICAgICAgXzsKICB9CgogIG1vZGlmaWVyIGZ1bGZpbGxtZW50Tm90WWV0QWNjZXB0ZWQodWludCBfYm91bnR5SWQsIHVpbnQgX2Z1bGZpbGxtZW50SWQpIHsKICAgICAgcmVxdWlyZShmdWxmaWxsbWVudHNbX2JvdW50eUlkXVtfZnVsZmlsbG1lbnRJZF0uYWNjZXB0ZWQgPT0gZmFsc2UpOwogICAgICBfOwogIH0KCiAgbW9kaWZpZXIgZW5vdWdoRnVuZHNUb1BheSh1aW50IF9ib3VudHlJZCkgewogICAgICByZXF1aXJlKGJvdW50aWVzW19ib3VudHlJZF0uYmFsYW5jZSA+PSBib3VudGllc1tfYm91bnR5SWRdLmZ1bGZpbGxtZW50QW1vdW50KTsKICAgICAgXzsKICB9CgogIC8vLyBAZGV2IGFjY2VwdEZ1bGZpbGxtZW50KCk6IGFjY2VwdCBhIGdpdmVuIGZ1bGZpbGxtZW50CiAgLy8vIEBwYXJhbSBfYm91bnR5SWQgdGhlIGluZGV4IG9mIHRoZSBib3VudHkKICAvLy8gQHBhcmFtIF9mdWxmaWxsbWVudElkIHRoZSBpbmRleCBvZiB0aGUgZnVsZmlsbG1lbnQgYmVpbmcgYWNjZXB0ZWQKICBmdW5jdGlvbiBhY2NlcHRGdWxmaWxsbWVudCh1aW50IF9ib3VudHlJZCwgdWludCBfZnVsZmlsbG1lbnRJZCkKICAgICAgcHVibGljCiAgICAgIHZhbGlkYXRlQm91bnR5QXJyYXlJbmRleChfYm91bnR5SWQpCiAgICAgIHZhbGlkYXRlRnVsZmlsbG1lbnRBcnJheUluZGV4KF9ib3VudHlJZCwgX2Z1bGZpbGxtZW50SWQpCiAgICAgIG9ubHlJc3N1ZXJPckFyYml0ZXIoX2JvdW50eUlkKQogICAgICBpc0F0U3RhZ2UoX2JvdW50eUlkLCBCb3VudHlTdGFnZXMuQWN0aXZlKQogICAgICBmdWxmaWxsbWVudE5vdFlldEFjY2VwdGVkKF9ib3VudHlJZCwgX2Z1bGZpbGxtZW50SWQpCiAgICAgIGVub3VnaEZ1bmRzVG9QYXkoX2JvdW50eUlkKQogIHsKICAgICAgZnVsZmlsbG1lbnRzW19ib3VudHlJZF1bX2Z1bGZpbGxtZW50SWRdLmFjY2VwdGVkID0gdHJ1ZTsKICAgICAgbnVtQWNjZXB0ZWRbX2JvdW50eUlkXSsrOwogICAgICBib3VudGllc1tfYm91bnR5SWRdLmJhbGFuY2UgLT0gYm91bnRpZXNbX2JvdW50eUlkXS5mdWxmaWxsbWVudEFtb3VudDsKICAgICAgaWYgKGJvdW50aWVzW19ib3VudHlJZF0ucGF5c1Rva2Vucyl7CiAgICAgICAgcmVxdWlyZSh0b2tlbkNvbnRyYWN0c1tfYm91bnR5SWRdLnRyYW5zZmVyKGZ1bGZpbGxtZW50c1tfYm91bnR5SWRdW19mdWxmaWxsbWVudElkXS5mdWxmaWxsZXIsIGJvdW50aWVzW19ib3VudHlJZF0uZnVsZmlsbG1lbnRBbW91bnQpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBmdWxmaWxsbWVudHNbX2JvdW50eUlkXVtfZnVsZmlsbG1lbnRJZF0uZnVsZmlsbGVyLnRyYW5zZmVyKGJvdW50aWVzW19ib3VudHlJZF0uZnVsZmlsbG1lbnRBbW91bnQpOwogICAgICB9CiAgICAgIEZ1bGZpbGxtZW50QWNjZXB0ZWQoX2JvdW50eUlkLCBtc2cuc2VuZGVyLCBfZnVsZmlsbG1lbnRJZCk7CiAgfQoKICAvLy8gQGRldiBraWxsQm91bnR5KCk6IGRyYWlucyB0aGUgY29udHJhY3Qgb2YgaXQncyByZW1haW5pbmcKICAvLy8gZnVuZHMsIGFuZCBtb3ZlcyB0aGUgYm91bnR5IGludG8gc3RhZ2UgMyAoZGVhZCkgc2luY2UgaXQgd2FzCiAgLy8vIGVpdGhlciBraWxsZWQgaW4gZHJhZnQgc3RhZ2UsIG9yIG5ldmVyIGFjY2VwdGVkIGFueSBmdWxmaWxsbWVudHMKICAvLy8gQHBhcmFtIF9ib3VudHlJZCB0aGUgaW5kZXggb2YgdGhlIGJvdW50eQogIGZ1bmN0aW9uIGtpbGxCb3VudHkodWludCBfYm91bnR5SWQpCiAgICAgIHB1YmxpYwogICAgICB2YWxpZGF0ZUJvdW50eUFycmF5SW5kZXgoX2JvdW50eUlkKQogICAgICBvbmx5SXNzdWVyKF9ib3VudHlJZCkKICB7CiAgICAgIHRyYW5zaXRpb25Ub1N0YXRlKF9ib3VudHlJZCwgQm91bnR5U3RhZ2VzLkRlYWQpOwogICAgICB1aW50IG9sZEJhbGFuY2UgPSBib3VudGllc1tfYm91bnR5SWRdLmJhbGFuY2U7CiAgICAgIGJvdW50aWVzW19ib3VudHlJZF0uYmFsYW5jZSA9IDA7CiAgICAgIGlmIChvbGRCYWxhbmNlID4gMCl7CiAgICAgICAgaWYgKGJvdW50aWVzW19ib3VudHlJZF0ucGF5c1Rva2Vucyl7CiAgICAgICAgICByZXF1aXJlKHRva2VuQ29udHJhY3RzW19ib3VudHlJZF0udHJhbnNmZXIoYm91bnRpZXNbX2JvdW50eUlkXS5pc3N1ZXIsIG9sZEJhbGFuY2UpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYm91bnRpZXNbX2JvdW50eUlkXS5pc3N1ZXIudHJhbnNmZXIob2xkQmFsYW5jZSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIEJvdW50eUtpbGxlZChfYm91bnR5SWQsIG1zZy5zZW5kZXIpOwogIH0KCiAgbW9kaWZpZXIgbmV3RGVhZGxpbmVJc1ZhbGlkKHVpbnQgX2JvdW50eUlkLCB1aW50IF9uZXdEZWFkbGluZSkgewogICAgICByZXF1aXJlKF9uZXdEZWFkbGluZSA+IGJvdW50aWVzW19ib3VudHlJZF0uZGVhZGxpbmUpOwogICAgICBfOwogIH0KCiAgLy8vIEBkZXYgZXh0ZW5kRGVhZGxpbmUoKTogYWxsb3dzIHRoZSBpc3N1ZXIgdG8gYWRkIG1vcmUgdGltZSB0byB0aGUKICAvLy8gYm91bnR5LCBhbGxvd2luZyBpdCB0byBjb250aW51ZSBhY2NlcHRpbmcgZnVsZmlsbG1lbnRzCiAgLy8vIEBwYXJhbSBfYm91bnR5SWQgdGhlIGluZGV4IG9mIHRoZSBib3VudHkKICAvLy8gQHBhcmFtIF9uZXdEZWFkbGluZSB0aGUgbmV3IGRlYWRsaW5lIGluIHRpbWVzdGFtcCBmb3JtYXQKICBmdW5jdGlvbiBleHRlbmREZWFkbGluZSh1aW50IF9ib3VudHlJZCwgdWludCBfbmV3RGVhZGxpbmUpCiAgICAgIHB1YmxpYwogICAgICB2YWxpZGF0ZUJvdW50eUFycmF5SW5kZXgoX2JvdW50eUlkKQogICAgICBvbmx5SXNzdWVyKF9ib3VudHlJZCkKICAgICAgbmV3RGVhZGxpbmVJc1ZhbGlkKF9ib3VudHlJZCwgX25ld0RlYWRsaW5lKQogIHsKICAgICAgYm91bnRpZXNbX2JvdW50eUlkXS5kZWFkbGluZSA9IF9uZXdEZWFkbGluZTsKCiAgICAgIERlYWRsaW5lRXh0ZW5kZWQoX2JvdW50eUlkLCBfbmV3RGVhZGxpbmUpOwogIH0KCiAgLy8vIEBkZXYgdHJhbnNmZXJJc3N1ZXIoKTogYWxsb3dzIHRoZSBpc3N1ZXIgdG8gdHJhbnNmZXIgb3duZXJzaGlwIG9mIHRoZQogIC8vLyBib3VudHkgdG8gc29tZSBuZXcgYWRkcmVzcwogIC8vLyBAcGFyYW0gX2JvdW50eUlkIHRoZSBpbmRleCBvZiB0aGUgYm91bnR5CiAgLy8vIEBwYXJhbSBfbmV3SXNzdWVyIHRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgaXNzdWVyCiAgZnVuY3Rpb24gdHJhbnNmZXJJc3N1ZXIodWludCBfYm91bnR5SWQsIGFkZHJlc3MgX25ld0lzc3VlcikKICAgICAgcHVibGljCiAgICAgIHZhbGlkYXRlQm91bnR5QXJyYXlJbmRleChfYm91bnR5SWQpCiAgICAgIG9ubHlJc3N1ZXIoX2JvdW50eUlkKQogIHsKICAgICAgYm91bnRpZXNbX2JvdW50eUlkXS5pc3N1ZXIgPSBfbmV3SXNzdWVyOwogICAgICBJc3N1ZXJUcmFuc2ZlcnJlZChfYm91bnR5SWQsIF9uZXdJc3N1ZXIpOwogIH0KCgogIC8vLyBAZGV2IGNoYW5nZUJvdW50eURlYWRsaW5lKCk6IGFsbG93cyB0aGUgaXNzdWVyIHRvIGNoYW5nZSBhIGJvdW50eSdzIGRlYWRsaW5lCiAgLy8vIEBwYXJhbSBfYm91bnR5SWQgdGhlIGluZGV4IG9mIHRoZSBib3VudHkKICAvLy8gQHBhcmFtIF9uZXdEZWFkbGluZSB0aGUgbmV3IGRlYWRsaW5lIGZvciB0aGUgYm91bnR5CiAgZnVuY3Rpb24gY2hhbmdlQm91bnR5RGVhZGxpbmUodWludCBfYm91bnR5SWQsIHVpbnQgX25ld0RlYWRsaW5lKQogICAgICBwdWJsaWMKICAgICAgdmFsaWRhdGVCb3VudHlBcnJheUluZGV4KF9ib3VudHlJZCkKICAgICAgb25seUlzc3VlcihfYm91bnR5SWQpCiAgICAgIHZhbGlkYXRlRGVhZGxpbmUoX25ld0RlYWRsaW5lKQogICAgICBpc0F0U3RhZ2UoX2JvdW50eUlkLCBCb3VudHlTdGFnZXMuRHJhZnQpCiAgewogICAgICBib3VudGllc1tfYm91bnR5SWRdLmRlYWRsaW5lID0gX25ld0RlYWRsaW5lOwogICAgICBCb3VudHlDaGFuZ2VkKF9ib3VudHlJZCk7CiAgfQoKICAvLy8gQGRldiBjaGFuZ2VEYXRhKCk6IGFsbG93cyB0aGUgaXNzdWVyIHRvIGNoYW5nZSBhIGJvdW50eSdzIGRhdGEKICAvLy8gQHBhcmFtIF9ib3VudHlJZCB0aGUgaW5kZXggb2YgdGhlIGJvdW50eQogIC8vLyBAcGFyYW0gX25ld0RhdGEgdGhlIG5ldyByZXF1aXJlbWVudHMgb2YgdGhlIGJvdW50eQogIGZ1bmN0aW9uIGNoYW5nZUJvdW50eURhdGEodWludCBfYm91bnR5SWQsIHN0cmluZyBfbmV3RGF0YSkKICAgICAgcHVibGljCiAgICAgIHZhbGlkYXRlQm91bnR5QXJyYXlJbmRleChfYm91bnR5SWQpCiAgICAgIG9ubHlJc3N1ZXIoX2JvdW50eUlkKQogICAgICBpc0F0U3RhZ2UoX2JvdW50eUlkLCBCb3VudHlTdGFnZXMuRHJhZnQpCiAgewogICAgICBib3VudGllc1tfYm91bnR5SWRdLmRhdGEgPSBfbmV3RGF0YTsKICAgICAgQm91bnR5Q2hhbmdlZChfYm91bnR5SWQpOwogIH0KCiAgLy8vIEBkZXYgY2hhbmdlQm91bnR5ZnVsZmlsbG1lbnRBbW91bnQoKTogYWxsb3dzIHRoZSBpc3N1ZXIgdG8gY2hhbmdlIGEgYm91bnR5J3MgZnVsZmlsbG1lbnQgYW1vdW50CiAgLy8vIEBwYXJhbSBfYm91bnR5SWQgdGhlIGluZGV4IG9mIHRoZSBib3VudHkKICAvLy8gQHBhcmFtIF9uZXdGdWxmaWxsbWVudEFtb3VudCB0aGUgbmV3IGZ1bGZpbGxtZW50IGFtb3VudAogIGZ1bmN0aW9uIGNoYW5nZUJvdW50eUZ1bGZpbGxtZW50QW1vdW50KHVpbnQgX2JvdW50eUlkLCB1aW50IF9uZXdGdWxmaWxsbWVudEFtb3VudCkKICAgICAgcHVibGljCiAgICAgIHZhbGlkYXRlQm91bnR5QXJyYXlJbmRleChfYm91bnR5SWQpCiAgICAgIG9ubHlJc3N1ZXIoX2JvdW50eUlkKQogICAgICBpc0F0U3RhZ2UoX2JvdW50eUlkLCBCb3VudHlTdGFnZXMuRHJhZnQpCiAgewogICAgICBib3VudGllc1tfYm91bnR5SWRdLmZ1bGZpbGxtZW50QW1vdW50ID0gX25ld0Z1bGZpbGxtZW50QW1vdW50OwogICAgICBCb3VudHlDaGFuZ2VkKF9ib3VudHlJZCk7CiAgfQoKICAvLy8gQGRldiBjaGFuZ2VCb3VudHlBcmJpdGVyKCk6IGFsbG93cyB0aGUgaXNzdWVyIHRvIGNoYW5nZSBhIGJvdW50eSdzIGFyYml0ZXIKICAvLy8gQHBhcmFtIF9ib3VudHlJZCB0aGUgaW5kZXggb2YgdGhlIGJvdW50eQogIC8vLyBAcGFyYW0gX25ld0FyYml0ZXIgdGhlIG5ldyBhZGRyZXNzIG9mIHRoZSBhcmJpdGVyCiAgZnVuY3Rpb24gY2hhbmdlQm91bnR5QXJiaXRlcih1aW50IF9ib3VudHlJZCwgYWRkcmVzcyBfbmV3QXJiaXRlcikKICAgICAgcHVibGljCiAgICAgIHZhbGlkYXRlQm91bnR5QXJyYXlJbmRleChfYm91bnR5SWQpCiAgICAgIG9ubHlJc3N1ZXIoX2JvdW50eUlkKQogICAgICBpc0F0U3RhZ2UoX2JvdW50eUlkLCBCb3VudHlTdGFnZXMuRHJhZnQpCiAgewogICAgICBib3VudGllc1tfYm91bnR5SWRdLmFyYml0ZXIgPSBfbmV3QXJiaXRlcjsKICAgICAgQm91bnR5Q2hhbmdlZChfYm91bnR5SWQpOwogIH0KCiAgLy8vIEBkZXYgY2hhbmdlQm91bnR5UGF5c1Rva2VucygpOiBhbGxvd3MgdGhlIGlzc3VlciB0byBjaGFuZ2UgYSBib3VudHkncyBpc3N1ZXIKICAvLy8gQHBhcmFtIF9ib3VudHlJZCB0aGUgaW5kZXggb2YgdGhlIGJvdW50eQogIC8vLyBAcGFyYW0gX25ld1BheXNUb2tlbnMgdGhlIG5ldyBib29sIGZvciB3aGV0aGVyIHRoZSBjb250cmFjdCBwYXlzIHRva2VucwogIC8vLyBAcGFyYW0gX25ld1Rva2VuQ29udHJhY3QgdGhlIG5ldyBhZGRyZXNzIG9mIHRoZSB0b2tlbgogIGZ1bmN0aW9uIGNoYW5nZUJvdW50eVBheXNUb2tlbnModWludCBfYm91bnR5SWQsIGJvb2wgX25ld1BheXNUb2tlbnMsIGFkZHJlc3MgX25ld1Rva2VuQ29udHJhY3QpCiAgICAgIHB1YmxpYwogICAgICB2YWxpZGF0ZUJvdW50eUFycmF5SW5kZXgoX2JvdW50eUlkKQogICAgICBvbmx5SXNzdWVyKF9ib3VudHlJZCkKICAgICAgaXNBdFN0YWdlKF9ib3VudHlJZCwgQm91bnR5U3RhZ2VzLkRyYWZ0KQogIHsKICAgICAgSHVtYW5TdGFuZGFyZFRva2VuIG9sZFRva2VuID0gdG9rZW5Db250cmFjdHNbX2JvdW50eUlkXTsKICAgICAgYm9vbCBvbGRQYXlzVG9rZW5zID0gYm91bnRpZXNbX2JvdW50eUlkXS5wYXlzVG9rZW5zOwogICAgICBib3VudGllc1tfYm91bnR5SWRdLnBheXNUb2tlbnMgPSBfbmV3UGF5c1Rva2VuczsKICAgICAgdG9rZW5Db250cmFjdHNbX2JvdW50eUlkXSA9IEh1bWFuU3RhbmRhcmRUb2tlbihfbmV3VG9rZW5Db250cmFjdCk7CiAgICAgIGlmIChib3VudGllc1tfYm91bnR5SWRdLmJhbGFuY2UgPiAwKXsKICAgICAgICB1aW50IG9sZEJhbGFuY2UgPSBib3VudGllc1tfYm91bnR5SWRdLmJhbGFuY2U7CiAgICAgICAgYm91bnRpZXNbX2JvdW50eUlkXS5iYWxhbmNlID0gMDsKICAgICAgICBpZiAob2xkUGF5c1Rva2Vucyl7CiAgICAgICAgICAgIHJlcXVpcmUob2xkVG9rZW4udHJhbnNmZXIoYm91bnRpZXNbX2JvdW50eUlkXS5pc3N1ZXIsIG9sZEJhbGFuY2UpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBib3VudGllc1tfYm91bnR5SWRdLmlzc3Vlci50cmFuc2ZlcihvbGRCYWxhbmNlKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgQm91bnR5Q2hhbmdlZChfYm91bnR5SWQpOwogIH0KCiAgbW9kaWZpZXIgbmV3RnVsZmlsbG1lbnRBbW91bnRJc0luY3JlYXNlKHVpbnQgX2JvdW50eUlkLCB1aW50IF9uZXdGdWxmaWxsbWVudEFtb3VudCkgewogICAgICByZXF1aXJlKGJvdW50aWVzW19ib3VudHlJZF0uZnVsZmlsbG1lbnRBbW91bnQgPCBfbmV3RnVsZmlsbG1lbnRBbW91bnQpOwogICAgICBfOwogIH0KCiAgLy8vIEBkZXYgaW5jcmVhc2VQYXlvdXQoKTogYWxsb3dzIHRoZSBpc3N1ZXIgdG8gaW5jcmVhc2UgYSBnaXZlbiBmdWxmaWxsbWVudAogIC8vLyBhbW91bnQgaW4gdGhlIGFjdGl2ZSBzdGFnZQogIC8vLyBAcGFyYW0gX2JvdW50eUlkIHRoZSBpbmRleCBvZiB0aGUgYm91bnR5CiAgLy8vIEBwYXJhbSBfbmV3RnVsZmlsbG1lbnRBbW91bnQgdGhlIG5ldyBmdWxmaWxsbWVudCBhbW91bnQKICAvLy8gQHBhcmFtIF92YWx1ZSB0aGUgdmFsdWUgb2YgdGhlIGFkZGl0aW9uYWwgZGVwb3NpdCBiZWluZyBhZGRlZAogIGZ1bmN0aW9uIGluY3JlYXNlUGF5b3V0KHVpbnQgX2JvdW50eUlkLCB1aW50IF9uZXdGdWxmaWxsbWVudEFtb3VudCwgdWludCBfdmFsdWUpCiAgICAgIHB1YmxpYwogICAgICBwYXlhYmxlCiAgICAgIHZhbGlkYXRlQm91bnR5QXJyYXlJbmRleChfYm91bnR5SWQpCiAgICAgIG9ubHlJc3N1ZXIoX2JvdW50eUlkKQogICAgICBuZXdGdWxmaWxsbWVudEFtb3VudElzSW5jcmVhc2UoX2JvdW50eUlkLCBfbmV3RnVsZmlsbG1lbnRBbW91bnQpCiAgICAgIHRyYW5zZmVycmVkQW1vdW50RXF1YWxzVmFsdWUoX2JvdW50eUlkLCBfdmFsdWUpCiAgewogICAgICBib3VudGllc1tfYm91bnR5SWRdLmJhbGFuY2UgKz0gX3ZhbHVlOwogICAgICByZXF1aXJlKGJvdW50aWVzW19ib3VudHlJZF0uYmFsYW5jZSA+PSBfbmV3RnVsZmlsbG1lbnRBbW91bnQpOwogICAgICBib3VudGllc1tfYm91bnR5SWRdLmZ1bGZpbGxtZW50QW1vdW50ID0gX25ld0Z1bGZpbGxtZW50QW1vdW50OwogICAgICBQYXlvdXRJbmNyZWFzZWQoX2JvdW50eUlkLCBfbmV3RnVsZmlsbG1lbnRBbW91bnQpOwogIH0KCiAgLy8vIEBkZXYgZ2V0RnVsZmlsbG1lbnQoKTogUmV0dXJucyB0aGUgZnVsZmlsbG1lbnQgYXQgYSBnaXZlbiBpbmRleAogIC8vLyBAcGFyYW0gX2JvdW50eUlkIHRoZSBpbmRleCBvZiB0aGUgYm91bnR5CiAgLy8vIEBwYXJhbSBfZnVsZmlsbG1lbnRJZCB0aGUgaW5kZXggb2YgdGhlIGZ1bGZpbGxtZW50IHRvIHJldHVybgogIC8vLyBAcmV0dXJuIFJldHVybnMgYSB0dXBsZSBmb3IgdGhlIGZ1bGZpbGxtZW50CiAgZnVuY3Rpb24gZ2V0RnVsZmlsbG1lbnQodWludCBfYm91bnR5SWQsIHVpbnQgX2Z1bGZpbGxtZW50SWQpCiAgICAgIHB1YmxpYwogICAgICBjb25zdGFudAogICAgICB2YWxpZGF0ZUJvdW50eUFycmF5SW5kZXgoX2JvdW50eUlkKQogICAgICB2YWxpZGF0ZUZ1bGZpbGxtZW50QXJyYXlJbmRleChfYm91bnR5SWQsIF9mdWxmaWxsbWVudElkKQogICAgICByZXR1cm5zIChib29sLCBhZGRyZXNzLCBzdHJpbmcpCiAgewogICAgICByZXR1cm4gKGZ1bGZpbGxtZW50c1tfYm91bnR5SWRdW19mdWxmaWxsbWVudElkXS5hY2NlcHRlZCwKICAgICAgICAgICAgICBmdWxmaWxsbWVudHNbX2JvdW50eUlkXVtfZnVsZmlsbG1lbnRJZF0uZnVsZmlsbGVyLAogICAgICAgICAgICAgIGZ1bGZpbGxtZW50c1tfYm91bnR5SWRdW19mdWxmaWxsbWVudElkXS5kYXRhKTsKICB9CgogIC8vLyBAZGV2IGdldEJvdW50eSgpOiBSZXR1cm5zIHRoZSBkZXRhaWxzIG9mIHRoZSBib3VudHkKICAvLy8gQHBhcmFtIF9ib3VudHlJZCB0aGUgaW5kZXggb2YgdGhlIGJvdW50eQogIC8vLyBAcmV0dXJuIFJldHVybnMgYSB0dXBsZSBmb3IgdGhlIGJvdW50eQogIGZ1bmN0aW9uIGdldEJvdW50eSh1aW50IF9ib3VudHlJZCkKICAgICAgcHVibGljCiAgICAgIGNvbnN0YW50CiAgICAgIHZhbGlkYXRlQm91bnR5QXJyYXlJbmRleChfYm91bnR5SWQpCiAgICAgIHJldHVybnMgKGFkZHJlc3MsIHVpbnQsIHVpbnQsIGJvb2wsIHVpbnQsIHVpbnQpCiAgewogICAgICByZXR1cm4gKGJvdW50aWVzW19ib3VudHlJZF0uaXNzdWVyLAogICAgICAgICAgICAgIGJvdW50aWVzW19ib3VudHlJZF0uZGVhZGxpbmUsCiAgICAgICAgICAgICAgYm91bnRpZXNbX2JvdW50eUlkXS5mdWxmaWxsbWVudEFtb3VudCwKICAgICAgICAgICAgICBib3VudGllc1tfYm91bnR5SWRdLnBheXNUb2tlbnMsCiAgICAgICAgICAgICAgdWludChib3VudGllc1tfYm91bnR5SWRdLmJvdW50eVN0YWdlKSwKICAgICAgICAgICAgICBib3VudGllc1tfYm91bnR5SWRdLmJhbGFuY2UpOwogIH0KCiAgLy8vIEBkZXYgZ2V0Qm91bnR5QXJiaXRlcigpOiBSZXR1cm5zIHRoZSBhcmJpdGVyIG9mIHRoZSBib3VudHkKICAvLy8gQHBhcmFtIF9ib3VudHlJZCB0aGUgaW5kZXggb2YgdGhlIGJvdW50eQogIC8vLyBAcmV0dXJuIFJldHVybnMgYW4gYWRkcmVzcyBmb3IgdGhlIGFyYml0ZXIgb2YgdGhlIGJvdW50eQogIGZ1bmN0aW9uIGdldEJvdW50eUFyYml0ZXIodWludCBfYm91bnR5SWQpCiAgICAgIHB1YmxpYwogICAgICBjb25zdGFudAogICAgICB2YWxpZGF0ZUJvdW50eUFycmF5SW5kZXgoX2JvdW50eUlkKQogICAgICByZXR1cm5zIChhZGRyZXNzKQogIHsKICAgICAgcmV0dXJuIChib3VudGllc1tfYm91bnR5SWRdLmFyYml0ZXIpOwogIH0KCiAgLy8vIEBkZXYgZ2V0Qm91bnR5RGF0YSgpOiBSZXR1cm5zIHRoZSBkYXRhIG9mIHRoZSBib3VudHkKICAvLy8gQHBhcmFtIF9ib3VudHlJZCB0aGUgaW5kZXggb2YgdGhlIGJvdW50eQogIC8vLyBAcmV0dXJuIFJldHVybnMgYSBzdHJpbmcgZm9yIHRoZSBib3VudHkgZGF0YQogIGZ1bmN0aW9uIGdldEJvdW50eURhdGEodWludCBfYm91bnR5SWQpCiAgICAgIHB1YmxpYwogICAgICBjb25zdGFudAogICAgICB2YWxpZGF0ZUJvdW50eUFycmF5SW5kZXgoX2JvdW50eUlkKQogICAgICByZXR1cm5zIChzdHJpbmcpCiAgewogICAgICByZXR1cm4gKGJvdW50aWVzW19ib3VudHlJZF0uZGF0YSk7CiAgfQoKICAvLy8gQGRldiBnZXRCb3VudHlUb2tlbigpOiBSZXR1cm5zIHRoZSB0b2tlbiBjb250cmFjdCBvZiB0aGUgYm91bnR5CiAgLy8vIEBwYXJhbSBfYm91bnR5SWQgdGhlIGluZGV4IG9mIHRoZSBib3VudHkKICAvLy8gQHJldHVybiBSZXR1cm5zIGFuIGFkZHJlc3MgZm9yIHRoZSB0b2tlbiB0aGF0IHRoZSBib3VudHkgdXNlcwogIGZ1bmN0aW9uIGdldEJvdW50eVRva2VuKHVpbnQgX2JvdW50eUlkKQogICAgICBwdWJsaWMKICAgICAgY29uc3RhbnQKICAgICAgdmFsaWRhdGVCb3VudHlBcnJheUluZGV4KF9ib3VudHlJZCkKICAgICAgcmV0dXJucyAoYWRkcmVzcykKICB7CiAgICAgIHJldHVybiAodG9rZW5Db250cmFjdHNbX2JvdW50eUlkXSk7CiAgfQoKICAvLy8gQGRldiBnZXROdW1Cb3VudGllcygpIHJldHVybnMgdGhlIG51bWJlciBvZiBib3VudGllcyBpbiB0aGUgcmVnaXN0cnkKICAvLy8gQHJldHVybiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgYm91bnRpZXMKICBmdW5jdGlvbiBnZXROdW1Cb3VudGllcygpCiAgICAgIHB1YmxpYwogICAgICBjb25zdGFudAogICAgICByZXR1cm5zICh1aW50KQogIHsKICAgICAgcmV0dXJuIGJvdW50aWVzLmxlbmd0aDsKICB9CgogIC8vLyBAZGV2IGdldE51bUZ1bGZpbGxtZW50cygpIHJldHVybnMgdGhlIG51bWJlciBvZiBmdWxmaWxsbWVudHMgZm9yIGEgZ2l2ZW4gbWlsZXN0b25lCiAgLy8vIEBwYXJhbSBfYm91bnR5SWQgdGhlIGluZGV4IG9mIHRoZSBib3VudHkKICAvLy8gQHJldHVybiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgZnVsZmlsbG1lbnRzCiAgZnVuY3Rpb24gZ2V0TnVtRnVsZmlsbG1lbnRzKHVpbnQgX2JvdW50eUlkKQogICAgICBwdWJsaWMKICAgICAgY29uc3RhbnQKICAgICAgdmFsaWRhdGVCb3VudHlBcnJheUluZGV4KF9ib3VudHlJZCkKICAgICAgcmV0dXJucyAodWludCkKICB7CiAgICAgIHJldHVybiBmdWxmaWxsbWVudHNbX2JvdW50eUlkXS5sZW5ndGg7CiAgfQoKICAvKgogICAqIEludGVybmFsIGZ1bmN0aW9ucwogICAqLwoKICAvLy8gQGRldiB0cmFuc2l0aW9uVG9TdGF0ZSgpOiB0cmFuc2l0aW9ucyB0aGUgY29udHJhY3QgdG8gdGhlCiAgLy8vIHN0YXRlIHBhc3NlZCBpbiB0aGUgcGFyYW1ldGVyIGBfbmV3U3RhZ2VgIGdpdmVuIHRoZQogIC8vLyBjb25kaXRpb25zIHN0YXRlZCBpbiB0aGUgYm9keSBvZiB0aGUgZnVuY3Rpb24KICAvLy8gQHBhcmFtIF9ib3VudHlJZCB0aGUgaW5kZXggb2YgdGhlIGJvdW50eQogIC8vLyBAcGFyYW0gX25ld1N0YWdlIHRoZSBuZXcgc3RhZ2UgdG8gdHJhbnNpdGlvbiB0bwogIGZ1bmN0aW9uIHRyYW5zaXRpb25Ub1N0YXRlKHVpbnQgX2JvdW50eUlkLCBCb3VudHlTdGFnZXMgX25ld1N0YWdlKQogICAgICBpbnRlcm5hbAogIHsKICAgICAgYm91bnRpZXNbX2JvdW50eUlkXS5ib3VudHlTdGFnZSA9IF9uZXdTdGFnZTsKICB9Cn0='.
	

]
