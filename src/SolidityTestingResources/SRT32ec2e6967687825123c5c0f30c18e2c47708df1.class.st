Class {
	#name : #SRT32ec2e6967687825123c5c0f30c18e2c47708df1,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT32ec2e6967687825123c5c0f30c18e2c47708df1 >> base64 [
	^ 'Ly8gVGhpcyBpcyB0aGUgY29kZSBmb3QgdGhlIHNtYXJ0IGNvbnRyYWN0IAovLyB1c2VkIGZvciB0aGUgUmVhbGlzdG8gSUNPIAovLwovLyBAYXV0aG9yOiBQYXZlbCBNZXRlbGl0c3luCi8vIFNlcHRlbWJlciAyMDE3CgoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgoKLy8gaW1wb3J0ICIuL2xpYnJhcnkuc29sIjsKCgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqIAogKiBTb3VyY2U6IFplcHBlbGluIFNvbGlkaXR5CiAqLwoKbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGRpdih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtaW42NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtYXgyNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBwZXJjZW50KHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYyAvIDEwMDsKICB9Cn0KCgovKioKICogQHRpdGxlIEVSQzIwQmFzaWMKICogQGRldiBTaW1wbGVyIHZlcnNpb24gb2YgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8xNzkKICovCgogLyogZnJvbSBPcGVuWmVwcGVsaW4gbGlicmFyeSAqLwogLyogaHR0cHM6Ly9naXRodWIuY29tL09wZW5aZXBwZWxpbi96ZXBwZWxpbi1zb2xpZGl0eSAqLwoKY29udHJhY3QgRVJDMjBCYXNpYyB7CiAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSByZXR1cm5zIChib29sKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKfQoKLy9pbXBvcnQgIi4vUmVhbGlzdG9Ub2tlbi5zb2wiOwoKCi8qCiAgICBDb3B5cmlnaHQgMjAxNiwgSm9yZGkgQmF5bGluYQoKICAgIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5CiAgICBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQogICAgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3IKICAgIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCgogICAgVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCiAgICBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgogICAgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQogICAgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KCiAgICBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQogICAgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uCiAqLwoKLy8vIEB0aXRsZSBNaW5pTWVUb2tlbiBDb250cmFjdAovLy8gQGF1dGhvciBKb3JkaSBCYXlsaW5hCi8vLyBAZGV2IFRoaXMgdG9rZW4gY29udHJhY3QncyBnb2FsIGlzIHRvIG1ha2UgaXQgZWFzeSBmb3IgYW55b25lIHRvIGNsb25lIHRoaXMKLy8vICB0b2tlbiB1c2luZyB0aGUgdG9rZW4gZGlzdHJpYnV0aW9uIGF0IGEgZ2l2ZW4gYmxvY2ssIHRoaXMgd2lsbCBhbGxvdyBEQU8ncwovLy8gIGFuZCBEQXBwcyB0byB1cGdyYWRlIHRoZWlyIGZlYXR1cmVzIGluIGEgZGVjZW50cmFsaXplZCBtYW5uZXIgd2l0aG91dAovLy8gIGFmZmVjdGluZyB0aGUgb3JpZ2luYWwgdG9rZW4KLy8vIEBkZXYgSXQgaXMgRVJDMjAgY29tcGxpYW50LCBidXQgc3RpbGwgbmVlZHMgdG8gdW5kZXIgZ28gZnVydGhlciB0ZXN0aW5nLgoKCi8vLyBAZGV2IFRoZSB0b2tlbiBjb250cm9sbGVyIGNvbnRyYWN0IG11c3QgaW1wbGVtZW50IHRoZXNlIGZ1bmN0aW9ucwpjb250cmFjdCBUb2tlbkNvbnRyb2xsZXIgewogICAgLy8vIEBub3RpY2UgQ2FsbGVkIHdoZW4gYF9vd25lcmAgc2VuZHMgZXRoZXIgdG8gdGhlIE1pbmlNZSBUb2tlbiBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCBzZW50IHRoZSBldGhlciB0byBjcmVhdGUgdG9rZW5zCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSBldGhlciBpcyBhY2NlcHRlZCwgZmFsc2UgaWYgaXQgdGhyb3dzCiAgICBmdW5jdGlvbiBwcm94eVBheW1lbnQoYWRkcmVzcyBfb3duZXIpIHBheWFibGUgcmV0dXJucyhib29sKTsKCiAgICAvLy8gQG5vdGljZSBOb3RpZmllcyB0aGUgY29udHJvbGxlciBhYm91dCBhIHRva2VuIHRyYW5zZmVyIGFsbG93aW5nIHRoZQogICAgLy8vICBjb250cm9sbGVyIHRvIHJlYWN0IGlmIGRlc2lyZWQKICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIG9yaWdpbiBvZiB0aGUgdHJhbnNmZXIKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBkZXN0aW5hdGlvbiBvZiB0aGUgdHJhbnNmZXIKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRoZSB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gRmFsc2UgaWYgdGhlIGNvbnRyb2xsZXIgZG9lcyBub3QgYXV0aG9yaXplIHRoZSB0cmFuc2ZlcgogICAgZnVuY3Rpb24gb25UcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfYW1vdW50KSByZXR1cm5zKGJvb2wpOwoKICAgIC8vLyBAbm90aWNlIE5vdGlmaWVzIHRoZSBjb250cm9sbGVyIGFib3V0IGFuIGFwcHJvdmFsIGFsbG93aW5nIHRoZQogICAgLy8vICBjb250cm9sbGVyIHRvIHJlYWN0IGlmIGRlc2lyZWQKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgY2FsbHMgYGFwcHJvdmUoKWAKICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIHNwZW5kZXIgaW4gdGhlIGBhcHByb3ZlKClgIGNhbGwKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IGluIHRoZSBgYXBwcm92ZSgpYCBjYWxsCiAgICAvLy8gQHJldHVybiBGYWxzZSBpZiB0aGUgY29udHJvbGxlciBkb2VzIG5vdCBhdXRob3JpemUgdGhlIGFwcHJvdmFsCiAgICBmdW5jdGlvbiBvbkFwcHJvdmUoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2Ftb3VudCkKICAgICAgICByZXR1cm5zKGJvb2wpOwp9Cgpjb250cmFjdCBDb250cm9sbGVkIHsKICAgIC8vLyBAbm90aWNlIFRoZSBhZGRyZXNzIG9mIHRoZSBjb250cm9sbGVyIGlzIHRoZSBvbmx5IGFkZHJlc3MgdGhhdCBjYW4gY2FsbAogICAgLy8vICBhIGZ1bmN0aW9uIHdpdGggdGhpcyBtb2RpZmllcgogICAgbW9kaWZpZXIgb25seUNvbnRyb2xsZXIgeyByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY29udHJvbGxlcik7IF87IH0KCiAgICBhZGRyZXNzIHB1YmxpYyBjb250cm9sbGVyOwoKICAgIGZ1bmN0aW9uIENvbnRyb2xsZWQoKSB7IGNvbnRyb2xsZXIgPSBtc2cuc2VuZGVyO30KCiAgICAvLy8gQG5vdGljZSBDaGFuZ2VzIHRoZSBjb250cm9sbGVyIG9mIHRoZSBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfbmV3Q29udHJvbGxlciBUaGUgbmV3IGNvbnRyb2xsZXIgb2YgdGhlIGNvbnRyYWN0CiAgICBmdW5jdGlvbiBjaGFuZ2VDb250cm9sbGVyKGFkZHJlc3MgX25ld0NvbnRyb2xsZXIpIG9ubHlDb250cm9sbGVyIHsKICAgICAgICBjb250cm9sbGVyID0gX25ld0NvbnRyb2xsZXI7CiAgICB9Cn0KCmNvbnRyYWN0IEFwcHJvdmVBbmRDYWxsRmFsbEJhY2sgewogICAgZnVuY3Rpb24gcmVjZWl2ZUFwcHJvdmFsKGFkZHJlc3MgZnJvbSwgdWludDI1NiBfYW1vdW50LCBhZGRyZXNzIF90b2tlbiwgYnl0ZXMgX2RhdGEpOwp9CgovLy8gQGRldiBUaGUgYWN0dWFsIHRva2VuIGNvbnRyYWN0LCB0aGUgZGVmYXVsdCBjb250cm9sbGVyIGlzIHRoZSBtc2cuc2VuZGVyCi8vLyAgdGhhdCBkZXBsb3lzIHRoZSBjb250cmFjdCwgc28gdXN1YWxseSB0aGlzIHRva2VuIHdpbGwgYmUgZGVwbG95ZWQgYnkgYQovLy8gIHRva2VuIGNvbnRyb2xsZXIgY29udHJhY3QsIHdoaWNoIEdpdmV0aCB3aWxsIGNhbGwgYSAiQ2FtcGFpZ24iCmNvbnRyYWN0IE1pbmlNZVRva2VuIGlzIENvbnRyb2xsZWQgewoKICAgIHN0cmluZyBwdWJsaWMgbmFtZTsgICAgICAgICAgICAgICAgLy9UaGUgVG9rZW4ncyBuYW1lOiBlLmcuIERpZ2l4REFPIFRva2VucwogICAgdWludDggcHVibGljIGRlY2ltYWxzOyAgICAgICAgICAgICAvL051bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgc21hbGxlc3QgdW5pdAogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7ICAgICAgICAgICAgICAvL0FuIGlkZW50aWZpZXI6IGUuZy4gUkVQCiAgICBzdHJpbmcgcHVibGljIHZlcnNpb24gPSAnTU1UXzAuMSc7IC8vQW4gYXJiaXRyYXJ5IHZlcnNpb25pbmcgc2NoZW1lCgoKICAgIC8vLyBAZGV2IGBDaGVja3BvaW50YCBpcyB0aGUgc3RydWN0dXJlIHRoYXQgYXR0YWNoZXMgYSBibG9jayBudW1iZXIgdG8gYQogICAgLy8vICBnaXZlbiB2YWx1ZSwgdGhlIGJsb2NrIG51bWJlciBhdHRhY2hlZCBpcyB0aGUgb25lIHRoYXQgbGFzdCBjaGFuZ2VkIHRoZQogICAgLy8vICB2YWx1ZQogICAgc3RydWN0ICBDaGVja3BvaW50IHsKCiAgICAgICAgLy8gYGZyb21CbG9ja2AgaXMgdGhlIGJsb2NrIG51bWJlciB0aGF0IHRoZSB2YWx1ZSB3YXMgZ2VuZXJhdGVkIGZyb20KICAgICAgICB1aW50MTI4IGZyb21CbG9jazsKCiAgICAgICAgLy8gYHZhbHVlYCBpcyB0aGUgYW1vdW50IG9mIHRva2VucyBhdCBhIHNwZWNpZmljIGJsb2NrIG51bWJlcgogICAgICAgIHVpbnQxMjggdmFsdWU7CiAgICB9CgogICAgLy8gYHBhcmVudFRva2VuYCBpcyB0aGUgVG9rZW4gYWRkcmVzcyB0aGF0IHdhcyBjbG9uZWQgdG8gcHJvZHVjZSB0aGlzIHRva2VuOwogICAgLy8gIGl0IHdpbGwgYmUgMHgwIGZvciBhIHRva2VuIHRoYXQgd2FzIG5vdCBjbG9uZWQKICAgIE1pbmlNZVRva2VuIHB1YmxpYyBwYXJlbnRUb2tlbjsKCiAgICAvLyBgcGFyZW50U25hcFNob3RCbG9ja2AgaXMgdGhlIGJsb2NrIG51bWJlciBmcm9tIHRoZSBQYXJlbnQgVG9rZW4gdGhhdCB3YXMKICAgIC8vICB1c2VkIHRvIGRldGVybWluZSB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gb2YgdGhlIENsb25lIFRva2VuCiAgICB1aW50IHB1YmxpYyBwYXJlbnRTbmFwU2hvdEJsb2NrOwoKICAgIC8vIGBjcmVhdGlvbkJsb2NrYCBpcyB0aGUgYmxvY2sgbnVtYmVyIHRoYXQgdGhlIENsb25lIFRva2VuIHdhcyBjcmVhdGVkCiAgICB1aW50IHB1YmxpYyBjcmVhdGlvbkJsb2NrOwoKICAgIC8vIGBiYWxhbmNlc2AgaXMgdGhlIG1hcCB0aGF0IHRyYWNrcyB0aGUgYmFsYW5jZSBvZiBlYWNoIGFkZHJlc3MsIGluIHRoaXMKICAgIC8vICBjb250cmFjdCB3aGVuIHRoZSBiYWxhbmNlIGNoYW5nZXMgdGhlIGJsb2NrIG51bWJlciB0aGF0IHRoZSBjaGFuZ2UKICAgIC8vICBvY2N1cnJlZCBpcyBhbHNvIGluY2x1ZGVkIGluIHRoZSBtYXAKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gQ2hlY2twb2ludFtdKSBiYWxhbmNlczsKCiAgICAvLyBgYWxsb3dlZGAgdHJhY2tzIGFueSBleHRyYSB0cmFuc2ZlciByaWdodHMgYXMgaW4gYWxsIEVSQzIwIHRva2VucwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwoKICAgIC8vIFRyYWNrcyB0aGUgaGlzdG9yeSBvZiB0aGUgYHRvdGFsU3VwcGx5YCBvZiB0aGUgdG9rZW4KICAgIENoZWNrcG9pbnRbXSB0b3RhbFN1cHBseUhpc3Rvcnk7CgogICAgLy8gRmxhZyB0aGF0IGRldGVybWluZXMgaWYgdGhlIHRva2VuIGlzIHRyYW5zZmVyYWJsZSBvciBub3QuCiAgICBib29sIHB1YmxpYyB0cmFuc2ZlcnNFbmFibGVkOwoKICAgIC8vIFRoZSBmYWN0b3J5IHVzZWQgdG8gY3JlYXRlIG5ldyBjbG9uZSB0b2tlbnMKICAgIE1pbmlNZVRva2VuRmFjdG9yeSBwdWJsaWMgdG9rZW5GYWN0b3J5OwoKLy8vLy8vLy8vLy8vLy8vLwovLyBDb25zdHJ1Y3RvcgovLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgQ29uc3RydWN0b3IgdG8gY3JlYXRlIGEgTWluaU1lVG9rZW4KICAgIC8vLyBAcGFyYW0gX3Rva2VuRmFjdG9yeSBUaGUgYWRkcmVzcyBvZiB0aGUgTWluaU1lVG9rZW5GYWN0b3J5IGNvbnRyYWN0IHRoYXQKICAgIC8vLyAgd2lsbCBjcmVhdGUgdGhlIENsb25lIHRva2VuIGNvbnRyYWN0cywgdGhlIHRva2VuIGZhY3RvcnkgbmVlZHMgdG8gYmUKICAgIC8vLyAgZGVwbG95ZWQgZmlyc3QKICAgIC8vLyBAcGFyYW0gX3BhcmVudFRva2VuIEFkZHJlc3Mgb2YgdGhlIHBhcmVudCB0b2tlbiwgc2V0IHRvIDB4MCBpZiBpdCBpcyBhCiAgICAvLy8gIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfcGFyZW50U25hcFNob3RCbG9jayBCbG9jayBvZiB0aGUgcGFyZW50IHRva2VuIHRoYXQgd2lsbAogICAgLy8vICBkZXRlcm1pbmUgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBjbG9uZSB0b2tlbiwgc2V0IHRvIDAgaWYgaXQKICAgIC8vLyAgaXMgYSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3Rva2VuTmFtZSBOYW1lIG9mIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX2RlY2ltYWxVbml0cyBOdW1iZXIgb2YgZGVjaW1hbHMgb2YgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5TeW1ib2wgVG9rZW4gU3ltYm9sIGZvciB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF90cmFuc2ZlcnNFbmFibGVkIElmIHRydWUsIHRva2VucyB3aWxsIGJlIGFibGUgdG8gYmUgdHJhbnNmZXJyZWQKICAgIGZ1bmN0aW9uIE1pbmlNZVRva2VuKAogICAgICAgIGFkZHJlc3MgX3Rva2VuRmFjdG9yeSwKICAgICAgICBhZGRyZXNzIF9wYXJlbnRUb2tlbiwKICAgICAgICB1aW50IF9wYXJlbnRTbmFwU2hvdEJsb2NrLAogICAgICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgICAgIHVpbnQ4IF9kZWNpbWFsVW5pdHMsCiAgICAgICAgc3RyaW5nIF90b2tlblN5bWJvbCwKICAgICAgICBib29sIF90cmFuc2ZlcnNFbmFibGVkCiAgICApIHsKICAgICAgICB0b2tlbkZhY3RvcnkgPSBNaW5pTWVUb2tlbkZhY3RvcnkoX3Rva2VuRmFjdG9yeSk7CiAgICAgICAgbmFtZSA9IF90b2tlbk5hbWU7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBuYW1lCiAgICAgICAgZGVjaW1hbHMgPSBfZGVjaW1hbFVuaXRzOyAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBkZWNpbWFscwogICAgICAgIHN5bWJvbCA9IF90b2tlblN5bWJvbDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgc3ltYm9sCiAgICAgICAgcGFyZW50VG9rZW4gPSBNaW5pTWVUb2tlbihfcGFyZW50VG9rZW4pOwogICAgICAgIHBhcmVudFNuYXBTaG90QmxvY2sgPSBfcGFyZW50U25hcFNob3RCbG9jazsKICAgICAgICB0cmFuc2ZlcnNFbmFibGVkID0gX3RyYW5zZmVyc0VuYWJsZWQ7CiAgICAgICAgY3JlYXRpb25CbG9jayA9IGJsb2NrLm51bWJlcjsKICAgIH0KCgovLy8vLy8vLy8vLy8vLy8vLy8vCi8vIEVSQzIwIE1ldGhvZHMKLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIFNlbmQgYF9hbW91bnRgIHRva2VucyB0byBgX3RvYCBmcm9tIGBtc2cuc2VuZGVyYAogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCBvciBub3QKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUodHJhbnNmZXJzRW5hYmxlZCk7CiAgICAgICAgcmV0dXJuIGRvVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfYW1vdW50KTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBTZW5kIGBfYW1vdW50YCB0b2tlbnMgdG8gYF90b2AgZnJvbSBgX2Zyb21gIG9uIHRoZSBjb25kaXRpb24gaXQKICAgIC8vLyAgaXMgYXBwcm92ZWQgYnkgYF9mcm9tYAogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBob2xkaW5nIHRoZSB0b2tlbnMgYmVpbmcgdHJhbnNmZXJyZWQKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50CiAgICApIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewoKICAgICAgICAvLyBUaGUgY29udHJvbGxlciBvZiB0aGlzIGNvbnRyYWN0IGNhbiBtb3ZlIHRva2VucyBhcm91bmQgYXQgd2lsbCwKICAgICAgICAvLyAgdGhpcyBpcyBpbXBvcnRhbnQgdG8gcmVjb2duaXplISBDb25maXJtIHRoYXQgeW91IHRydXN0IHRoZQogICAgICAgIC8vICBjb250cm9sbGVyIG9mIHRoaXMgY29udHJhY3QsIHdoaWNoIGluIG1vc3Qgc2l0dWF0aW9ucyBzaG91bGQgYmUKICAgICAgICAvLyAgYW5vdGhlciBvcGVuIHNvdXJjZSBzbWFydCBjb250cmFjdCBvciAweDAKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBjb250cm9sbGVyKSB7CiAgICAgICAgICAgIHJlcXVpcmUodHJhbnNmZXJzRW5hYmxlZCk7CgogICAgICAgICAgICAvLyBUaGUgc3RhbmRhcmQgRVJDIDIwIHRyYW5zZmVyRnJvbSBmdW5jdGlvbmFsaXR5CiAgICAgICAgICAgIGlmIChhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA8IF9hbW91bnQpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gLT0gX2Ftb3VudDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRvVHJhbnNmZXIoX2Zyb20sIF90bywgX2Ftb3VudCk7CiAgICB9CgogICAgLy8vIEBkZXYgVGhpcyBpcyB0aGUgYWN0dWFsIHRyYW5zZmVyIGZ1bmN0aW9uIGluIHRoZSB0b2tlbiBjb250cmFjdCwgaXQgY2FuCiAgICAvLy8gIG9ubHkgYmUgY2FsbGVkIGJ5IG90aGVyIGZ1bmN0aW9ucyBpbiB0aGlzIGNvbnRyYWN0LgogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBob2xkaW5nIHRoZSB0b2tlbnMgYmVpbmcgdHJhbnNmZXJyZWQKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIGRvVHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX2Ftb3VudAogICAgKSBpbnRlcm5hbCByZXR1cm5zKGJvb2wpIHsKCiAgICAgICAgICAgaWYgKF9hbW91bnQgPT0gMCkgewogICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICB9CgogICAgICAgICAgIHJlcXVpcmUocGFyZW50U25hcFNob3RCbG9jayA8IGJsb2NrLm51bWJlcik7CgogICAgICAgICAgIC8vIERvIG5vdCBhbGxvdyB0cmFuc2ZlciB0byAweDAgb3IgdGhlIHRva2VuIGNvbnRyYWN0IGl0c2VsZgogICAgICAgICAgIHJlcXVpcmUoKF90byAhPSAwKSAmJiAoX3RvICE9IGFkZHJlc3ModGhpcykpKTsKCiAgICAgICAgICAgLy8gSWYgdGhlIGFtb3VudCBiZWluZyB0cmFuc2ZlcmVkIGlzIG1vcmUgdGhhbiB0aGUgYmFsYW5jZSBvZiB0aGUKICAgICAgICAgICAvLyAgYWNjb3VudCB0aGUgdHJhbnNmZXIgcmV0dXJucyBmYWxzZQogICAgICAgICAgIHZhciBwcmV2aW91c0JhbGFuY2VGcm9tID0gYmFsYW5jZU9mQXQoX2Zyb20sIGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgaWYgKHByZXZpb3VzQmFsYW5jZUZyb20gPCBfYW1vdW50KSB7CiAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICB9CgogICAgICAgICAgIC8vIEFsZXJ0cyB0aGUgdG9rZW4gY29udHJvbGxlciBvZiB0aGUgdHJhbnNmZXIKICAgICAgICAgICBpZiAoaXNDb250cmFjdChjb250cm9sbGVyKSkgewogICAgICAgICAgICAgICByZXF1aXJlKFRva2VuQ29udHJvbGxlcihjb250cm9sbGVyKS5vblRyYW5zZmVyKF9mcm9tLCBfdG8sIF9hbW91bnQpKTsKICAgICAgICAgICB9CgogICAgICAgICAgIC8vIEZpcnN0IHVwZGF0ZSB0aGUgYmFsYW5jZSBhcnJheSB3aXRoIHRoZSBuZXcgdmFsdWUgZm9yIHRoZSBhZGRyZXNzCiAgICAgICAgICAgLy8gIHNlbmRpbmcgdGhlIHRva2VucwogICAgICAgICAgIHVwZGF0ZVZhbHVlQXROb3coYmFsYW5jZXNbX2Zyb21dLCBwcmV2aW91c0JhbGFuY2VGcm9tIC0gX2Ftb3VudCk7CgogICAgICAgICAgIC8vIFRoZW4gdXBkYXRlIHRoZSBiYWxhbmNlIGFycmF5IHdpdGggdGhlIG5ldyB2YWx1ZSBmb3IgdGhlIGFkZHJlc3MKICAgICAgICAgICAvLyAgcmVjZWl2aW5nIHRoZSB0b2tlbnMKICAgICAgICAgICB2YXIgcHJldmlvdXNCYWxhbmNlVG8gPSBiYWxhbmNlT2ZBdChfdG8sIGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgcmVxdWlyZShwcmV2aW91c0JhbGFuY2VUbyArIF9hbW91bnQgPj0gcHJldmlvdXNCYWxhbmNlVG8pOyAvLyBDaGVjayBmb3Igb3ZlcmZsb3cKICAgICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KGJhbGFuY2VzW190b10sIHByZXZpb3VzQmFsYW5jZVRvICsgX2Ftb3VudCk7CgogICAgICAgICAgIC8vIEFuIGV2ZW50IHRvIG1ha2UgdGhlIHRyYW5zZmVyIGVhc3kgdG8gZmluZCBvbiB0aGUgYmxvY2tjaGFpbgogICAgICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF9hbW91bnQpOwoKICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0J3MgYmFsYW5jZSBpcyBiZWluZyByZXF1ZXN0ZWQKICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlIG9mIGBfb3duZXJgIGF0IHRoZSBjdXJyZW50IGJsb2NrCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgICAgIHJldHVybiBiYWxhbmNlT2ZBdChfb3duZXIsIGJsb2NrLm51bWJlcik7CiAgICB9CgogICAgLy8vIEBub3RpY2UgYG1zZy5zZW5kZXJgIGFwcHJvdmVzIGBfc3BlbmRlcmAgdG8gc3BlbmQgYF9hbW91bnRgIHRva2VucyBvbgogICAgLy8vICBpdHMgYmVoYWxmLiBUaGlzIGlzIGEgbW9kaWZpZWQgdmVyc2lvbiBvZiB0aGUgRVJDMjAgYXBwcm92ZSBmdW5jdGlvbgogICAgLy8vICB0byBiZSBhIGxpdHRsZSBiaXQgc2FmZXIKICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgYXBwcm92ZWQgZm9yIHRyYW5zZmVyCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSBhcHByb3ZhbCB3YXMgc3VjY2Vzc2Z1bAogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF9hbW91bnQpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUodHJhbnNmZXJzRW5hYmxlZCk7CgogICAgICAgIC8vIFRvIGNoYW5nZSB0aGUgYXBwcm92ZSBhbW91bnQgeW91IGZpcnN0IGhhdmUgdG8gcmVkdWNlIHRoZSBhZGRyZXNzZXNgCiAgICAgICAgLy8gIGFsbG93YW5jZSB0byB6ZXJvIGJ5IGNhbGxpbmcgYGFwcHJvdmUoX3NwZW5kZXIsMClgIGlmIGl0IGlzIG5vdAogICAgICAgIC8vICBhbHJlYWR5IDAgdG8gbWl0aWdhdGUgdGhlIHJhY2UgY29uZGl0aW9uIGRlc2NyaWJlZCBoZXJlOgogICAgICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgICAgIHJlcXVpcmUoKF9hbW91bnQgPT0gMCkgfHwgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID09IDApKTsKCiAgICAgICAgLy8gQWxlcnRzIHRoZSB0b2tlbiBjb250cm9sbGVyIG9mIHRoZSBhcHByb3ZlIGZ1bmN0aW9uIGNhbGwKICAgICAgICBpZiAoaXNDb250cmFjdChjb250cm9sbGVyKSkgewogICAgICAgICAgICByZXF1aXJlKFRva2VuQ29udHJvbGxlcihjb250cm9sbGVyKS5vbkFwcHJvdmUobXNnLnNlbmRlciwgX3NwZW5kZXIsIF9hbW91bnQpKTsKICAgICAgICB9CgogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX2Ftb3VudDsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX2Ftb3VudCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgVGhpcyBmdW5jdGlvbiBtYWtlcyBpdCBlYXN5IHRvIHJlYWQgdGhlIGBhbGxvd2VkW11gIG1hcAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgdGhhdCBvd25zIHRoZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIEFtb3VudCBvZiByZW1haW5pbmcgdG9rZW5zIG9mIF9vd25lciB0aGF0IF9zcGVuZGVyIGlzIGFsbG93ZWQKICAgIC8vLyAgdG8gc3BlbmQKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcgogICAgKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgX3NwZW5kZXJgIHRvIHNlbmQgYF9hbW91bnRgIHRva2VucyBvbgogICAgLy8vICBpdHMgYmVoYWxmLCBhbmQgdGhlbiBhIGZ1bmN0aW9uIGlzIHRyaWdnZXJlZCBpbiB0aGUgY29udHJhY3QgdGhhdCBpcwogICAgLy8vICBiZWluZyBhcHByb3ZlZCwgYF9zcGVuZGVyYC4gVGhpcyBhbGxvd3MgdXNlcnMgdG8gdXNlIHRoZWlyIHRva2VucyB0bwogICAgLy8vICBpbnRlcmFjdCB3aXRoIGNvbnRyYWN0cyBpbiBvbmUgZnVuY3Rpb24gY2FsbCBpbnN0ZWFkIG9mIHR3bwogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgY29udHJhY3QgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgYXBwcm92ZWQgZm9yIHRyYW5zZmVyCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSBmdW5jdGlvbiBjYWxsIHdhcyBzdWNjZXNzZnVsCiAgICBmdW5jdGlvbiBhcHByb3ZlQW5kQ2FsbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF9hbW91bnQsIGJ5dGVzIF9leHRyYURhdGEKICAgICkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmVxdWlyZShhcHByb3ZlKF9zcGVuZGVyLCBfYW1vdW50KSk7CgogICAgICAgIEFwcHJvdmVBbmRDYWxsRmFsbEJhY2soX3NwZW5kZXIpLnJlY2VpdmVBcHByb3ZhbCgKICAgICAgICAgICAgbXNnLnNlbmRlciwKICAgICAgICAgICAgX2Ftb3VudCwKICAgICAgICAgICAgdGhpcywKICAgICAgICAgICAgX2V4dHJhRGF0YQogICAgICAgICk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAZGV2IFRoaXMgZnVuY3Rpb24gbWFrZXMgaXQgZWFzeSB0byBnZXQgdGhlIHRvdGFsIG51bWJlciBvZiB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIFRoZSB0b3RhbCBudW1iZXIgb2YgdG9rZW5zCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gdG90YWxTdXBwbHlBdChibG9jay5udW1iZXIpOwogICAgfQoKCi8vLy8vLy8vLy8vLy8vLy8KLy8gUXVlcnkgYmFsYW5jZSBhbmQgdG90YWxTdXBwbHkgaW4gSGlzdG9yeQovLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBkZXYgUXVlcmllcyB0aGUgYmFsYW5jZSBvZiBgX293bmVyYCBhdCBhIHNwZWNpZmljIGBfYmxvY2tOdW1iZXJgCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBmcm9tIHdoaWNoIHRoZSBiYWxhbmNlIHdpbGwgYmUgcmV0cmlldmVkCiAgICAvLy8gQHBhcmFtIF9ibG9ja051bWJlciBUaGUgYmxvY2sgbnVtYmVyIHdoZW4gdGhlIGJhbGFuY2UgaXMgcXVlcmllZAogICAgLy8vIEByZXR1cm4gVGhlIGJhbGFuY2UgYXQgYF9ibG9ja051bWJlcmAKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZkF0KGFkZHJlc3MgX293bmVyLCB1aW50IF9ibG9ja051bWJlcikgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50KSB7CgogICAgICAgIC8vIFRoZXNlIG5leHQgZmV3IGxpbmVzIGFyZSB1c2VkIHdoZW4gdGhlIGJhbGFuY2Ugb2YgdGhlIHRva2VuIGlzCiAgICAgICAgLy8gIHJlcXVlc3RlZCBiZWZvcmUgYSBjaGVjayBwb2ludCB3YXMgZXZlciBjcmVhdGVkIGZvciB0aGlzIHRva2VuLCBpdAogICAgICAgIC8vICByZXF1aXJlcyB0aGF0IHRoZSBgcGFyZW50VG9rZW4uYmFsYW5jZU9mQXRgIGJlIHF1ZXJpZWQgYXQgdGhlCiAgICAgICAgLy8gIGdlbmVzaXMgYmxvY2sgZm9yIHRoYXQgdG9rZW4gYXMgdGhpcyBjb250YWlucyBpbml0aWFsIGJhbGFuY2Ugb2YKICAgICAgICAvLyAgdGhpcyB0b2tlbgogICAgICAgIGlmICgoYmFsYW5jZXNbX293bmVyXS5sZW5ndGggPT0gMCkKICAgICAgICAgICAgfHwgKGJhbGFuY2VzW19vd25lcl1bMF0uZnJvbUJsb2NrID4gX2Jsb2NrTnVtYmVyKSkgewogICAgICAgICAgICBpZiAoYWRkcmVzcyhwYXJlbnRUb2tlbikgIT0gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHBhcmVudFRva2VuLmJhbGFuY2VPZkF0KF9vd25lciwgbWluKF9ibG9ja051bWJlciwgcGFyZW50U25hcFNob3RCbG9jaykpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gSGFzIG5vIHBhcmVudAogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgLy8gVGhpcyB3aWxsIHJldHVybiB0aGUgZXhwZWN0ZWQgYmFsYW5jZSBkdXJpbmcgbm9ybWFsIHNpdHVhdGlvbnMKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZ2V0VmFsdWVBdChiYWxhbmNlc1tfb3duZXJdLCBfYmxvY2tOdW1iZXIpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQG5vdGljZSBUb3RhbCBhbW91bnQgb2YgdG9rZW5zIGF0IGEgc3BlY2lmaWMgYF9ibG9ja051bWJlcmAuCiAgICAvLy8gQHBhcmFtIF9ibG9ja051bWJlciBUaGUgYmxvY2sgbnVtYmVyIHdoZW4gdGhlIHRvdGFsU3VwcGx5IGlzIHF1ZXJpZWQKICAgIC8vLyBAcmV0dXJuIFRoZSB0b3RhbCBhbW91bnQgb2YgdG9rZW5zIGF0IGBfYmxvY2tOdW1iZXJgCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseUF0KHVpbnQgX2Jsb2NrTnVtYmVyKSBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsKCiAgICAgICAgLy8gVGhlc2UgbmV4dCBmZXcgbGluZXMgYXJlIHVzZWQgd2hlbiB0aGUgdG90YWxTdXBwbHkgb2YgdGhlIHRva2VuIGlzCiAgICAgICAgLy8gIHJlcXVlc3RlZCBiZWZvcmUgYSBjaGVjayBwb2ludCB3YXMgZXZlciBjcmVhdGVkIGZvciB0aGlzIHRva2VuLCBpdAogICAgICAgIC8vICByZXF1aXJlcyB0aGF0IHRoZSBgcGFyZW50VG9rZW4udG90YWxTdXBwbHlBdGAgYmUgcXVlcmllZCBhdCB0aGUKICAgICAgICAvLyAgZ2VuZXNpcyBibG9jayBmb3IgdGhpcyB0b2tlbiBhcyB0aGF0IGNvbnRhaW5zIHRvdGFsU3VwcGx5IG9mIHRoaXMKICAgICAgICAvLyAgdG9rZW4gYXQgdGhpcyBibG9jayBudW1iZXIuCiAgICAgICAgaWYgKCh0b3RhbFN1cHBseUhpc3RvcnkubGVuZ3RoID09IDApCiAgICAgICAgICAgIHx8ICh0b3RhbFN1cHBseUhpc3RvcnlbMF0uZnJvbUJsb2NrID4gX2Jsb2NrTnVtYmVyKSkgewogICAgICAgICAgICBpZiAoYWRkcmVzcyhwYXJlbnRUb2tlbikgIT0gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHBhcmVudFRva2VuLnRvdGFsU3VwcGx5QXQobWluKF9ibG9ja051bWJlciwgcGFyZW50U25hcFNob3RCbG9jaykpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgLy8gVGhpcyB3aWxsIHJldHVybiB0aGUgZXhwZWN0ZWQgdG90YWxTdXBwbHkgZHVyaW5nIG5vcm1hbCBzaXR1YXRpb25zCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGdldFZhbHVlQXQodG90YWxTdXBwbHlIaXN0b3J5LCBfYmxvY2tOdW1iZXIpOwogICAgICAgIH0KICAgIH0KCi8vLy8vLy8vLy8vLy8vLy8KLy8gQ2xvbmUgVG9rZW4gTWV0aG9kCi8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBDcmVhdGVzIGEgbmV3IGNsb25lIHRva2VuIHdpdGggdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIGJlaW5nCiAgICAvLy8gIHRoaXMgdG9rZW4gYXQgYF9zbmFwc2hvdEJsb2NrYAogICAgLy8vIEBwYXJhbSBfY2xvbmVUb2tlbk5hbWUgTmFtZSBvZiB0aGUgY2xvbmUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX2Nsb25lRGVjaW1hbFVuaXRzIE51bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgc21hbGxlc3QgdW5pdAogICAgLy8vIEBwYXJhbSBfY2xvbmVUb2tlblN5bWJvbCBTeW1ib2wgb2YgdGhlIGNsb25lIHRva2VuCiAgICAvLy8gQHBhcmFtIF9zbmFwc2hvdEJsb2NrIEJsb2NrIHdoZW4gdGhlIGRpc3RyaWJ1dGlvbiBvZiB0aGUgcGFyZW50IHRva2VuIGlzCiAgICAvLy8gIGNvcGllZCB0byBzZXQgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBuZXcgY2xvbmUgdG9rZW47CiAgICAvLy8gIGlmIHRoZSBibG9jayBpcyB6ZXJvIHRoYW4gdGhlIGFjdHVhbCBibG9jaywgdGhlIGN1cnJlbnQgYmxvY2sgaXMgdXNlZAogICAgLy8vIEBwYXJhbSBfdHJhbnNmZXJzRW5hYmxlZCBUcnVlIGlmIHRyYW5zZmVycyBhcmUgYWxsb3dlZCBpbiB0aGUgY2xvbmUKICAgIC8vLyBAcmV0dXJuIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgTWluaU1lVG9rZW4gQ29udHJhY3QKICAgIGZ1bmN0aW9uIGNyZWF0ZUNsb25lVG9rZW4oCiAgICAgICAgc3RyaW5nIF9jbG9uZVRva2VuTmFtZSwKICAgICAgICB1aW50OCBfY2xvbmVEZWNpbWFsVW5pdHMsCiAgICAgICAgc3RyaW5nIF9jbG9uZVRva2VuU3ltYm9sLAogICAgICAgIHVpbnQgX3NuYXBzaG90QmxvY2ssCiAgICAgICAgYm9vbCBfdHJhbnNmZXJzRW5hYmxlZAogICAgICAgICkgcmV0dXJucyhhZGRyZXNzKSB7CiAgICAgICAgaWYgKF9zbmFwc2hvdEJsb2NrID09IDApIF9zbmFwc2hvdEJsb2NrID0gYmxvY2subnVtYmVyOwogICAgICAgIE1pbmlNZVRva2VuIGNsb25lVG9rZW4gPSB0b2tlbkZhY3RvcnkuY3JlYXRlQ2xvbmVUb2tlbigKICAgICAgICAgICAgdGhpcywKICAgICAgICAgICAgX3NuYXBzaG90QmxvY2ssCiAgICAgICAgICAgIF9jbG9uZVRva2VuTmFtZSwKICAgICAgICAgICAgX2Nsb25lRGVjaW1hbFVuaXRzLAogICAgICAgICAgICBfY2xvbmVUb2tlblN5bWJvbCwKICAgICAgICAgICAgX3RyYW5zZmVyc0VuYWJsZWQKICAgICAgICAgICAgKTsKCiAgICAgICAgY2xvbmVUb2tlbi5jaGFuZ2VDb250cm9sbGVyKG1zZy5zZW5kZXIpOwoKICAgICAgICAvLyBBbiBldmVudCB0byBtYWtlIHRoZSB0b2tlbiBlYXN5IHRvIGZpbmQgb24gdGhlIGJsb2NrY2hhaW4KICAgICAgICBOZXdDbG9uZVRva2VuKGFkZHJlc3MoY2xvbmVUb2tlbiksIF9zbmFwc2hvdEJsb2NrKTsKICAgICAgICByZXR1cm4gYWRkcmVzcyhjbG9uZVRva2VuKTsKICAgIH0KCi8vLy8vLy8vLy8vLy8vLy8KLy8gR2VuZXJhdGUgYW5kIGRlc3Ryb3kgdG9rZW5zCi8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBHZW5lcmF0ZXMgYF9hbW91bnRgIHRva2VucyB0aGF0IGFyZSBhc3NpZ25lZCB0byBgX293bmVyYAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIGJlIGFzc2lnbmVkIHRoZSBuZXcgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIHF1YW50aXR5IG9mIHRva2VucyBnZW5lcmF0ZWQKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIHRva2VucyBhcmUgZ2VuZXJhdGVkIGNvcnJlY3RseQogICAgZnVuY3Rpb24gZ2VuZXJhdGVUb2tlbnMoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2Ftb3VudAogICAgKSBvbmx5Q29udHJvbGxlciByZXR1cm5zIChib29sKSB7CiAgICAgICAgdWludCBjdXJUb3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5KCk7CiAgICAgICAgcmVxdWlyZShjdXJUb3RhbFN1cHBseSArIF9hbW91bnQgPj0gY3VyVG90YWxTdXBwbHkpOyAvLyBDaGVjayBmb3Igb3ZlcmZsb3cKICAgICAgICB1aW50IHByZXZpb3VzQmFsYW5jZVRvID0gYmFsYW5jZU9mKF9vd25lcik7CiAgICAgICAgcmVxdWlyZShwcmV2aW91c0JhbGFuY2VUbyArIF9hbW91bnQgPj0gcHJldmlvdXNCYWxhbmNlVG8pOyAvLyBDaGVjayBmb3Igb3ZlcmZsb3cKICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KHRvdGFsU3VwcGx5SGlzdG9yeSwgY3VyVG90YWxTdXBwbHkgKyBfYW1vdW50KTsKICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KGJhbGFuY2VzW19vd25lcl0sIHByZXZpb3VzQmFsYW5jZVRvICsgX2Ftb3VudCk7CiAgICAgICAgVHJhbnNmZXIoMCwgX293bmVyLCBfYW1vdW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCgogICAgLy8vIEBub3RpY2UgQnVybnMgYF9hbW91bnRgIHRva2VucyBmcm9tIGBfb3duZXJgCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgbG9zZSB0aGUgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIHF1YW50aXR5IG9mIHRva2VucyB0byBidXJuCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSB0b2tlbnMgYXJlIGJ1cm5lZCBjb3JyZWN0bHkKICAgIGZ1bmN0aW9uIGRlc3Ryb3lUb2tlbnMoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2Ftb3VudAogICAgKSBvbmx5Q29udHJvbGxlciByZXR1cm5zIChib29sKSB7CiAgICAgICAgdWludCBjdXJUb3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5KCk7CiAgICAgICAgcmVxdWlyZShjdXJUb3RhbFN1cHBseSA+PSBfYW1vdW50KTsKICAgICAgICB1aW50IHByZXZpb3VzQmFsYW5jZUZyb20gPSBiYWxhbmNlT2YoX293bmVyKTsKICAgICAgICByZXF1aXJlKHByZXZpb3VzQmFsYW5jZUZyb20gPj0gX2Ftb3VudCk7CiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyh0b3RhbFN1cHBseUhpc3RvcnksIGN1clRvdGFsU3VwcGx5IC0gX2Ftb3VudCk7CiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfb3duZXJdLCBwcmV2aW91c0JhbGFuY2VGcm9tIC0gX2Ftb3VudCk7CiAgICAgICAgVHJhbnNmZXIoX293bmVyLCAwLCBfYW1vdW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCi8vLy8vLy8vLy8vLy8vLy8KLy8gRW5hYmxlIHRva2VucyB0cmFuc2ZlcnMKLy8vLy8vLy8vLy8vLy8vLwoKCiAgICAvLy8gQG5vdGljZSBFbmFibGVzIHRva2VuIGhvbGRlcnMgdG8gdHJhbnNmZXIgdGhlaXIgdG9rZW5zIGZyZWVseSBpZiB0cnVlCiAgICAvLy8gQHBhcmFtIF90cmFuc2ZlcnNFbmFibGVkIFRydWUgaWYgdHJhbnNmZXJzIGFyZSBhbGxvd2VkIGluIHRoZSBjbG9uZQogICAgZnVuY3Rpb24gZW5hYmxlVHJhbnNmZXJzKGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQpIG9ubHlDb250cm9sbGVyIHsKICAgICAgICB0cmFuc2ZlcnNFbmFibGVkID0gX3RyYW5zZmVyc0VuYWJsZWQ7CiAgICB9CgovLy8vLy8vLy8vLy8vLy8vCi8vIEludGVybmFsIGhlbHBlciBmdW5jdGlvbnMgdG8gcXVlcnkgYW5kIHNldCBhIHZhbHVlIGluIGEgc25hcHNob3QgYXJyYXkKLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAZGV2IGBnZXRWYWx1ZUF0YCByZXRyaWV2ZXMgdGhlIG51bWJlciBvZiB0b2tlbnMgYXQgYSBnaXZlbiBibG9jayBudW1iZXIKICAgIC8vLyBAcGFyYW0gY2hlY2twb2ludHMgVGhlIGhpc3Rvcnkgb2YgdmFsdWVzIGJlaW5nIHF1ZXJpZWQKICAgIC8vLyBAcGFyYW0gX2Jsb2NrIFRoZSBibG9jayBudW1iZXIgdG8gcmV0cmlldmUgdGhlIHZhbHVlIGF0CiAgICAvLy8gQHJldHVybiBUaGUgbnVtYmVyIG9mIHRva2VucyBiZWluZyBxdWVyaWVkCiAgICBmdW5jdGlvbiBnZXRWYWx1ZUF0KENoZWNrcG9pbnRbXSBzdG9yYWdlIGNoZWNrcG9pbnRzLCB1aW50IF9ibG9jawogICAgKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgaWYgKGNoZWNrcG9pbnRzLmxlbmd0aCA9PSAwKSByZXR1cm4gMDsKCiAgICAgICAgLy8gU2hvcnRjdXQgZm9yIHRoZSBhY3R1YWwgdmFsdWUKICAgICAgICBpZiAoX2Jsb2NrID49IGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aC0xXS5mcm9tQmxvY2spCiAgICAgICAgICAgIHJldHVybiBjaGVja3BvaW50c1tjaGVja3BvaW50cy5sZW5ndGgtMV0udmFsdWU7CiAgICAgICAgaWYgKF9ibG9jayA8IGNoZWNrcG9pbnRzWzBdLmZyb21CbG9jaykgcmV0dXJuIDA7CgogICAgICAgIC8vIEJpbmFyeSBzZWFyY2ggb2YgdGhlIHZhbHVlIGluIHRoZSBhcnJheQogICAgICAgIHVpbnQgbWluID0gMDsKICAgICAgICB1aW50IG1heCA9IGNoZWNrcG9pbnRzLmxlbmd0aC0xOwogICAgICAgIHdoaWxlIChtYXggPiBtaW4pIHsKICAgICAgICAgICAgdWludCBtaWQgPSAobWF4ICsgbWluICsgMSkvIDI7CiAgICAgICAgICAgIGlmIChjaGVja3BvaW50c1ttaWRdLmZyb21CbG9jazw9X2Jsb2NrKSB7CiAgICAgICAgICAgICAgICBtaW4gPSBtaWQ7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtYXggPSBtaWQtMTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gY2hlY2twb2ludHNbbWluXS52YWx1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBgdXBkYXRlVmFsdWVBdE5vd2AgdXNlZCB0byB1cGRhdGUgdGhlIGBiYWxhbmNlc2AgbWFwIGFuZCB0aGUKICAgIC8vLyAgYHRvdGFsU3VwcGx5SGlzdG9yeWAKICAgIC8vLyBAcGFyYW0gY2hlY2twb2ludHMgVGhlIGhpc3Rvcnkgb2YgZGF0YSBiZWluZyB1cGRhdGVkCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgbmV3IG51bWJlciBvZiB0b2tlbnMKICAgIGZ1bmN0aW9uIHVwZGF0ZVZhbHVlQXROb3coQ2hlY2twb2ludFtdIHN0b3JhZ2UgY2hlY2twb2ludHMsIHVpbnQgX3ZhbHVlCiAgICApIGludGVybmFsICB7CiAgICAgICAgaWYgKChjaGVja3BvaW50cy5sZW5ndGggPT0gMCkKICAgICAgICB8fCAoY2hlY2twb2ludHNbY2hlY2twb2ludHMubGVuZ3RoIC0xXS5mcm9tQmxvY2sgPCBibG9jay5udW1iZXIpKSB7CiAgICAgICAgICAgICAgIENoZWNrcG9pbnQgc3RvcmFnZSBuZXdDaGVja1BvaW50ID0gY2hlY2twb2ludHNbIGNoZWNrcG9pbnRzLmxlbmd0aCsrIF07CiAgICAgICAgICAgICAgIG5ld0NoZWNrUG9pbnQuZnJvbUJsb2NrID0gIHVpbnQxMjgoYmxvY2subnVtYmVyKTsKICAgICAgICAgICAgICAgbmV3Q2hlY2tQb2ludC52YWx1ZSA9IHVpbnQxMjgoX3ZhbHVlKTsKICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICBDaGVja3BvaW50IHN0b3JhZ2Ugb2xkQ2hlY2tQb2ludCA9IGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aC0xXTsKICAgICAgICAgICAgICAgb2xkQ2hlY2tQb2ludC52YWx1ZSA9IHVpbnQxMjgoX3ZhbHVlKTsKICAgICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gZGV0ZXJtaW5lIGlmIGFuIGFkZHJlc3MgaXMgYSBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfYWRkciBUaGUgYWRkcmVzcyBiZWluZyBxdWVyaWVkCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIGBfYWRkcmAgaXMgYSBjb250cmFjdAogICAgZnVuY3Rpb24gaXNDb250cmFjdChhZGRyZXNzIF9hZGRyKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKGJvb2wpIHsKICAgICAgICB1aW50IHNpemU7CiAgICAgICAgaWYgKF9hZGRyID09IDApIHJldHVybiBmYWxzZTsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHNpemUgOj0gZXh0Y29kZXNpemUoX2FkZHIpCiAgICAgICAgfQogICAgICAgIHJldHVybiBzaXplPjA7CiAgICB9CgogICAgLy8vIEBkZXYgSGVscGVyIGZ1bmN0aW9uIHRvIHJldHVybiBhIG1pbiBiZXR3ZW4gdGhlIHR3byB1aW50cwogICAgZnVuY3Rpb24gbWluKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgICB9CgogICAgLy8vIEBub3RpY2UgVGhlIGZhbGxiYWNrIGZ1bmN0aW9uOiBJZiB0aGUgY29udHJhY3QncyBjb250cm9sbGVyIGhhcyBub3QgYmVlbgogICAgLy8vICBzZXQgdG8gMCwgdGhlbiB0aGUgYHByb3h5UGF5bWVudGAgbWV0aG9kIGlzIGNhbGxlZCB3aGljaCByZWxheXMgdGhlCiAgICAvLy8gIGV0aGVyIGFuZCBjcmVhdGVzIHRva2VucyBhcyBkZXNjcmliZWQgaW4gdGhlIHRva2VuIGNvbnRyb2xsZXIgY29udHJhY3QKICAgIGZ1bmN0aW9uICgpICBwYXlhYmxlIHsKICAgICAgICByZXF1aXJlKGlzQ29udHJhY3QoY29udHJvbGxlcikpOwogICAgICAgIHJlcXVpcmUoVG9rZW5Db250cm9sbGVyKGNvbnRyb2xsZXIpLnByb3h5UGF5bWVudC52YWx1ZShtc2cudmFsdWUpKG1zZy5zZW5kZXIpKTsKICAgIH0KCi8vLy8vLy8vLy8KLy8gU2FmZXR5IE1ldGhvZHMKLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIFRoaXMgbWV0aG9kIGNhbiBiZSB1c2VkIGJ5IHRoZSBjb250cm9sbGVyIHRvIGV4dHJhY3QgbWlzdGFrZW5seQogICAgLy8vICBzZW50IHRva2VucyB0byB0aGlzIGNvbnRyYWN0LgogICAgLy8vIEBwYXJhbSBfdG9rZW4gVGhlIGFkZHJlc3Mgb2YgdGhlIHRva2VuIGNvbnRyYWN0IHRoYXQgeW91IHdhbnQgdG8gcmVjb3ZlcgogICAgLy8vICBzZXQgdG8gMCBpbiBjYXNlIHlvdSB3YW50IHRvIGV4dHJhY3QgZXRoZXIuCiAgICBmdW5jdGlvbiBjbGFpbVRva2VucyhhZGRyZXNzIF90b2tlbikgb25seUNvbnRyb2xsZXIgewogICAgICAgIGlmIChfdG9rZW4gPT0gMHgwKSB7CiAgICAgICAgICAgIGNvbnRyb2xsZXIudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgTWluaU1lVG9rZW4gdG9rZW4gPSBNaW5pTWVUb2tlbihfdG9rZW4pOwogICAgICAgIHVpbnQgYmFsYW5jZSA9IHRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgICAgICB0b2tlbi50cmFuc2Zlcihjb250cm9sbGVyLCBiYWxhbmNlKTsKICAgICAgICBDbGFpbWVkVG9rZW5zKF90b2tlbiwgY29udHJvbGxlciwgYmFsYW5jZSk7CiAgICB9CgovLy8vLy8vLy8vLy8vLy8vCi8vIEV2ZW50cwovLy8vLy8vLy8vLy8vLy8vCiAgICBldmVudCBDbGFpbWVkVG9rZW5zKGFkZHJlc3MgaW5kZXhlZCBfdG9rZW4sIGFkZHJlc3MgaW5kZXhlZCBfY29udHJvbGxlciwgdWludCBfYW1vdW50KTsKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfYW1vdW50KTsKICAgIGV2ZW50IE5ld0Nsb25lVG9rZW4oYWRkcmVzcyBpbmRleGVkIF9jbG9uZVRva2VuLCB1aW50IF9zbmFwc2hvdEJsb2NrKTsKICAgIGV2ZW50IEFwcHJvdmFsKAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIF9zcGVuZGVyLAogICAgICAgIHVpbnQyNTYgX2Ftb3VudAogICAgICAgICk7Cgp9CgoKLy8vLy8vLy8vLy8vLy8vLwovLyBNaW5pTWVUb2tlbkZhY3RvcnkKLy8vLy8vLy8vLy8vLy8vLwoKLy8vIEBkZXYgVGhpcyBjb250cmFjdCBpcyB1c2VkIHRvIGdlbmVyYXRlIGNsb25lIGNvbnRyYWN0cyBmcm9tIGEgY29udHJhY3QuCi8vLyAgSW4gc29saWRpdHkgdGhpcyBpcyB0aGUgd2F5IHRvIGNyZWF0ZSBhIGNvbnRyYWN0IGZyb20gYSBjb250cmFjdCBvZiB0aGUKLy8vICBzYW1lIGNsYXNzCmNvbnRyYWN0IE1pbmlNZVRva2VuRmFjdG9yeSB7CgogICAgLy8vIEBub3RpY2UgVXBkYXRlIHRoZSBEQXBwIGJ5IGNyZWF0aW5nIGEgbmV3IHRva2VuIHdpdGggbmV3IGZ1bmN0aW9uYWxpdGllcwogICAgLy8vICB0aGUgbXNnLnNlbmRlciBiZWNvbWVzIHRoZSBjb250cm9sbGVyIG9mIHRoaXMgY2xvbmUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3BhcmVudFRva2VuIEFkZHJlc3Mgb2YgdGhlIHRva2VuIGJlaW5nIGNsb25lZAogICAgLy8vIEBwYXJhbSBfc25hcHNob3RCbG9jayBCbG9jayBvZiB0aGUgcGFyZW50IHRva2VuIHRoYXQgd2lsbAogICAgLy8vICBkZXRlcm1pbmUgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBjbG9uZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5OYW1lIE5hbWUgb2YgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfZGVjaW1hbFVuaXRzIE51bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF90b2tlblN5bWJvbCBUb2tlbiBTeW1ib2wgZm9yIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgSWYgdHJ1ZSwgdG9rZW5zIHdpbGwgYmUgYWJsZSB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyB0b2tlbiBjb250cmFjdAogICAgZnVuY3Rpb24gY3JlYXRlQ2xvbmVUb2tlbigKICAgICAgICBhZGRyZXNzIF9wYXJlbnRUb2tlbiwKICAgICAgICB1aW50IF9zbmFwc2hvdEJsb2NrLAogICAgICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgICAgIHVpbnQ4IF9kZWNpbWFsVW5pdHMsCiAgICAgICAgc3RyaW5nIF90b2tlblN5bWJvbCwKICAgICAgICBib29sIF90cmFuc2ZlcnNFbmFibGVkCiAgICApIHJldHVybnMgKE1pbmlNZVRva2VuKSB7CiAgICAgICAgTWluaU1lVG9rZW4gbmV3VG9rZW4gPSBuZXcgTWluaU1lVG9rZW4oCiAgICAgICAgICAgIHRoaXMsCiAgICAgICAgICAgIF9wYXJlbnRUb2tlbiwKICAgICAgICAgICAgX3NuYXBzaG90QmxvY2ssCiAgICAgICAgICAgIF90b2tlbk5hbWUsCiAgICAgICAgICAgIF9kZWNpbWFsVW5pdHMsCiAgICAgICAgICAgIF90b2tlblN5bWJvbCwKICAgICAgICAgICAgX3RyYW5zZmVyc0VuYWJsZWQKICAgICAgICAgICAgKTsKCiAgICAgICAgbmV3VG9rZW4uY2hhbmdlQ29udHJvbGxlcihtc2cuc2VuZGVyKTsKICAgICAgICByZXR1cm4gbmV3VG9rZW47CiAgICB9Cn0KCmNvbnRyYWN0IFJlYWxpc3RvVG9rZW4gaXMgTWluaU1lVG9rZW4geyAKCiAgLy8gd2UgdXNlIHRoaXMgdmFyaWFibGUgdG8gc3RvcmUgdGhlIG51bWJlciBvZiB0aGUgZmluYWxpemF0aW9uIGJsb2NrCiAgdWludDI1NiBwdWJsaWMgY2hlY2twb2ludEJsb2NrOwoKICAvLyBhZGRyZXNzIHdoaWNoIGlzIGFsbG93ZWQgdG8gdHJpZ2dlciB0b2tlbnMgZ2VuZXJhdGlvbgogIGFkZHJlc3MgcHVibGljIG1heUdlbmVyYXRlQWRkcjsKCiAgLy8gZmxhZwogIGJvb2wgdG9rZW5HZW5lcmF0aW9uRW5hYmxlZDsgLy88LSBhZGRlZCBhZnRlciBmaXJzdCBhdWRpdAoKCiAgbW9kaWZpZXIgbWF5R2VuZXJhdGUoKSB7CiAgICByZXF1aXJlICggKG1zZy5zZW5kZXIgPT0gbWF5R2VuZXJhdGVBZGRyKSAmJgogICAgICAgICAgICAgICh0b2tlbkdlbmVyYXRpb25FbmFibGVkID09IHRydWUpICk7IC8vPC0gYWRkZWQgYWZ0ZXIgZmlyc3QgYXVkaXQKICAgIF87CiAgfQoKICAvLyBDb25zdHJ1Y3RvcgogIGZ1bmN0aW9uIFJlYWxpc3RvVG9rZW4oYWRkcmVzcyBfdG9rZW5GYWN0b3J5KSAKICAgIE1pbmlNZVRva2VuKAogICAgICBfdG9rZW5GYWN0b3J5LAogICAgICAweDAsCiAgICAgIDAsCiAgICAgICJSZWFsaXN0byBUb2tlbiIsCiAgICAgIDE4LCAvLyBkZWNpbWFscwogICAgICAiUkVBIiwKICAgICAgLy8gU0hPVUxEIFRSQU5TRkVSUyBCRSBFTkFCTEVEPyAtLSBOTwogICAgICBmYWxzZSl7CiAgICB0b2tlbkdlbmVyYXRpb25FbmFibGVkID0gdHJ1ZTsKICAgIGNvbnRyb2xsZXIgPSBtc2cuc2VuZGVyOwogICAgbWF5R2VuZXJhdGVBZGRyID0gY29udHJvbGxlcjsKICB9CgogIGZ1bmN0aW9uIHNldEdlbmVyYXRlQWRkcihhZGRyZXNzIF9hZGRyKSBvbmx5Q29udHJvbGxlcnsKICAgIC8vIHdlIGNhbiBhcHBvaW50IGFuIGFkZHJlc3MgdG8gYmUgYWxsb3dlZCB0byBnZW5lcmF0ZSB0b2tlbnMKICAgIHJlcXVpcmUoIF9hZGRyICE9IDB4MCApOwogICAgbWF5R2VuZXJhdGVBZGRyID0gX2FkZHI7CiAgfQoKCiAgLy8vIEBub3RpY2UgdGhpcyBpcyBkZWZhdWx0IGZ1bmN0aW9uIGNhbGxlZCB3aGVuIEVUSCBpcyBzZW5kIHRvIHRoaXMgY29udHJhY3QKICAvLy8gICB3ZSB1c2UgdGhlIGNhbXBhaWduIGNvbnRyYWN0IGZvciBzZWxsaW5nIHRva2VucwogIGZ1bmN0aW9uICgpIHBheWFibGUgewogICAgcmV2ZXJ0KCk7CiAgfQoKICAKICAvLy8gQG5vdGljZSBUaGlzIGZ1bmN0aW9uIGlzIGNvcHktcGFzdGUgb2YgdGhlIGdlbmVyYXRlVG9rZW5zIG9mIHRoZSBvcmlnaW5hbCBNaW5pTWkgY29udHJhY3QKICAvLy8gICBleGNlcHQgaXQgdXNlcyBtYXlHZW5lcmF0ZSBtb2RpZmllciAob3JpZ2luYWwgdXNlcyBvbmx5Q29udHJvbGxlcikKICAvLy8gdGhpcyBpcyBiZWNhdXNlIHdlIGRvbid0IHdhbnQgdGhlIFNhbGUgY2FtcGFpZ24gY29udHJhY3QgdG8gYmUgdGhlIGNvbnRyb2xsZXIKICBmdW5jdGlvbiBnZW5lcmF0ZV90b2tlbl9mb3IoYWRkcmVzcyBfYWRkclRvLCB1aW50IF9hbW91bnQpIG1heUdlbmVyYXRlIHJldHVybnMgKGJvb2wpIHsKICAgIAogICAgLy9iYWxhbmNlc1tfYWRkcl0gKz0gX2Ftb3VudDsKICAgCiAgICB1aW50IGN1clRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkoKTsKICAgIHJlcXVpcmUoY3VyVG90YWxTdXBwbHkgKyBfYW1vdW50ID49IGN1clRvdGFsU3VwcGx5KTsgLy8gQ2hlY2sgZm9yIG92ZXJmbG93ICAgIAogICAgdWludCBwcmV2aW91c0JhbGFuY2VUbyA9IGJhbGFuY2VPZihfYWRkclRvKTsKICAgIHJlcXVpcmUocHJldmlvdXNCYWxhbmNlVG8gKyBfYW1vdW50ID49IHByZXZpb3VzQmFsYW5jZVRvKTsgLy8gQ2hlY2sgZm9yIG92ZXJmbG93CiAgICB1cGRhdGVWYWx1ZUF0Tm93KHRvdGFsU3VwcGx5SGlzdG9yeSwgY3VyVG90YWxTdXBwbHkgKyBfYW1vdW50KTsKICAgIHVwZGF0ZVZhbHVlQXROb3coYmFsYW5jZXNbX2FkZHJUb10sIHByZXZpb3VzQmFsYW5jZVRvICsgX2Ftb3VudCk7CiAgICBUcmFuc2ZlcigwLCBfYWRkclRvLCBfYW1vdW50KTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8gb3ZlcndyaXRlcyB0aGUgb3JpZ2luYWwgZnVuY3Rpb24KICBmdW5jdGlvbiBnZW5lcmF0ZVRva2VucyhhZGRyZXNzIF9vd25lciwgdWludCBfYW1vdW50CiAgICApIG9ubHlDb250cm9sbGVyIHJldHVybnMgKGJvb2wpIHsKICAgIHJldmVydCgpOwogICAgZ2VuZXJhdGVfdG9rZW5fZm9yKF9vd25lciwgX2Ftb3VudCk7ICAgIAogIH0KCgogIC8vIHBlcm1hbmVudGx5IGRpc2FibGVzIGdlbmVyYXRpb24gb2YgbmV3IHRva2VucwogIGZ1bmN0aW9uIGZpbmFsaXplKCkgbWF5R2VuZXJhdGUgewogICAgdG9rZW5HZW5lcmF0aW9uRW5hYmxlZCA9IGZhbHNlOyAvLzwtIGFkZGVkIGFmdGVyIGZpcnN0IGF1ZGl0CiAgICBjaGVja3BvaW50QmxvY2sgPSBibG9jay5udW1iZXI7CiAgfSAgCn0KCgoKCi8vaW1wb3J0ICIuL0xpbmVhclRva2VuVmF1bHQuc29sIjsKCgoKLy8gc2ltcGxlIHRpbWUgbG9ja2VkIHZhdWx0IGFsbG93cyBjb250cm9sbGVkIGV4dHJhY3Rpb24gb2YgdG9rZW5zIGR1cmluZyBhIHBlcmlvZCBvZiB0aW1lCgoKLy8gQ29udHJvbGxlZCBpcyBpbXBsZW1lbnRlZCBpbiBNaW5pTWVUb2tlbi5zb2wgCmNvbnRyYWN0IFRva2VuVmF1bHQgaXMgQ29udHJvbGxlZCB7Cgl1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCgoJLy9hZGRyZXNzIGNhbXBhaWduQWRkcjsKCVRva2VuQ2FtcGFpZ24gY2FtcGFpZ247CgkvL3VpbnQyNTYgdFVubG9jayA9IDA7Cgl1aW50MjU2IHREdXJhdGlvbjsKCXVpbnQyNTYgdExvY2sgPSAxMiAqIDMwICogKDEgZGF5cyk7IC8vIDEyIG1vbnRocyAKCU1pbmlNZVRva2VuIHRva2VuOwoKCXVpbnQyNTYgZXh0cmFjdGVkID0gMDsKCglldmVudCBFeHRyYWN0KGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX2Ftb3VudCk7CgoJZnVuY3Rpb24gVG9rZW5WYXVsdCgKCQlhZGRyZXNzIF90b2tlbkFkZHJlc3MsCgkgCWFkZHJlc3MgX2NhbXBhaWduQWRkcmVzcywKCSAJdWludDI1NiBfdER1cmF0aW9uCgkgCSkgewoKCQkJcmVxdWlyZSggX3REdXJhdGlvbiA+IDApOwoJCQl0RHVyYXRpb24gPSBfdER1cmF0aW9uOwoKCQkJLy9jYW1wYWlnbkFkZHIgPSBfY2FtcGFpZ25BZGRyZXNzOwoJCQl0b2tlbiA9IFJlYWxpc3RvVG9rZW4oX3Rva2VuQWRkcmVzcyk7CgkJCWNhbXBhaWduID0gVG9rZW5DYW1wYWlnbihfY2FtcGFpZ25BZGRyZXNzKTsKCQl9CgoJLy8vIFdFIERPTlQgVVNFIElUIEFOWU1PUkUKCS8vLyBzYWxlIGNhbXBhaWduIGNhbGxzIHRoaXMgZnVuY3Rpb24gdG8gc2V0IHRoZSB0aW1lIGxvY2sKCS8vLyBAcGFyYW0gX3RVbmxvY2sgLSBVbml4IHRpbWVzdGFtcCBvZiB0aGUgZmlyc3QgZGF0ZSAKCS8vLwkJCQkJCQlvbiB3aGljaCB0b2tlbnMgYmVjb21lIGF2YWlsYWJsZQoJLy9mdW5jdGlvbiBzZXRUaW1lTG9jayh1aW50MjU2IF90VW5sb2NrKXsKCQkvLyBwcmV2ZW50IGNoYW5nZSBvZiB0aGUgdGltZXN0YW1wIGJ5IGFueWJvZHkgb3RoZXIgdGhhbiB0b2tlbiBzYWxlIGNvbnRyYWN0CgkJLy8gb25jZSB1bmxvY2sgdGltZSBpcyBzZXQgaXQgY2Fubm90IGJlIGNoYW5nZWQKCQkvL3JlcXVpcmUoIChtc2cuc2VuZGVyID09IGNhbXBhaWduQWRkcikgJiYgKHRVbmxvY2sgPT0gMCkpOwoJLy8JdFVubG9jayA9IF90VW5sb2NrOwoJLy99CgoJLy8vIEBub3RpY2UgU2VuZCBhbGwgYXZhaWxhYmxlIHRva2VucyB0byBhIGdpdmVuIGFkZHJlc3MKCWZ1bmN0aW9uIGV4dHJhY3QoYWRkcmVzcyBfdG8pIG9ubHlDb250cm9sbGVyIHsKCQkKCQlyZXF1aXJlIChfdG8gIT0gMHgwKTsKCgkJdWludDI1NiBhdmFpbGFibGUgPSBhdmFpbGFibGVOb3coKTsKCQoJCXJlcXVpcmUoIGF2YWlsYWJsZSA+IDAgKTsKCgkJZXh0cmFjdGVkID0gZXh0cmFjdGVkLmFkZChhdmFpbGFibGUpOwoJCWFzc2VydCggdG9rZW4udHJhbnNmZXIoX3RvLCBhdmFpbGFibGUpICk7CgkJCgoJCUV4dHJhY3QoX3RvLCBhdmFpbGFibGUpOwoKCX0KCgkvLyByZXR1cm5zIGFtb3VudCBvZiB0b2tlbnMgaGVsZCBpbiB0aGlzIHZhdWx0CglmdW5jdGlvbiBiYWxhbmNlKCkgcmV0dXJucyAodWludDI1Nil7CgkJcmV0dXJuIHRva2VuLmJhbGFuY2VPZihhZGRyZXNzKHRoaXMpKTsKCX0KCglmdW5jdGlvbiBnZXRfdW5sb2NrX3RpbWUoKSByZXR1cm5zICh1aW50MjU2KXsKCQlyZXR1cm4gY2FtcGFpZ24udEZpbmFsaXplZCgpICsgdExvY2s7Cgl9CgoJLy8gcmV0dXJucyBhbW91bnQgb2YgdG9rZW5zIGF2YWlsYWJsZSBmb3IgZXh0cmFjdGlvbiBub3cKCWZ1bmN0aW9uIGF2YWlsYWJsZU5vdygpIHJldHVybnMgKHVpbnQyNTYpewoJCQoJCXVpbnQyNTYgdFVubG9jayA9IGdldF91bmxvY2tfdGltZSgpOwoJCXVpbnQyNTYgdE5vdyA9IG5vdzsKCgkJLy8gaWYgYmVmb3JlIHVubG9jayB0aW1lIG9yIHVubG9jayB0aW1lIGlzIG5vdCBzZXQgID0+IDAgaXMgYXZhaWxhYmxlIAoJCWlmICh0Tm93IDwgdFVubG9jayApIHsgcmV0dXJuIDA7IH0KCgkJdWludDI1NiByZW1haW5pbmcgPSBiYWxhbmNlKCk7CgoJCS8vIGlmIGFmdGVyIGxvbmdlciB0aGFuIHREdXJhdGlvbiBzaW5jZSB1bmxvY2sgdGltZSA9PiBldmVyeXRoaW5nIHRoYXQgaXMgbGVmdCBpcyBhdmFpbGFibGUKCQlpZiAodE5vdyA+IHRVbmxvY2sgKyB0RHVyYXRpb24pIHsgcmV0dXJuIHJlbWFpbmluZzsgfQoKCQkvLyBvdGhlcndpc2U6CgkJLy8gY29tcHV0ZSBob3cgbWFueSBleHRyYWN0aW9ucyByZW1haW5pbmcgYmFzZWQgb24gdGltZQoKCQkJLy8gdGltZSBkZWx0YQoJCXVpbnQyNTYgdCA9ICh0Tm93LnN1Yih0VW5sb2NrKSkubXVsKHJlbWFpbmluZy5hZGQoZXh0cmFjdGVkKSk7CgkJcmV0dXJuICh0LmRpdih0RHVyYXRpb24pKS5zdWIoZXh0cmFjdGVkKTsKCX0KCn0KCgpjb250cmFjdCByZWFfdG9rZW5faW50ZXJmYWNlewogIHVpbnQ4IHB1YmxpYyBkZWNpbWFsczsKICBmdW5jdGlvbiBnZW5lcmF0ZV90b2tlbl9mb3IoYWRkcmVzcyBfYWRkcix1aW50IF9hbW91bnQpIHJldHVybnMgKGJvb2wpOwogIGZ1bmN0aW9uIGZpbmFsaXplKCk7Cn0KCgovLyBDb250cm9sbGVkIGlzIGltcGxlbWVudGVkIGluIE1pbmlNZVRva2VuLnNvbApjb250cmFjdCBUb2tlbkNhbXBhaWduIGlzIENvbnRyb2xsZWR7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIC8vIHRoaXMgaXMgb3VyIHRva2VuCiAgcmVhX3Rva2VuX2ludGVyZmFjZSBwdWJsaWMgdG9rZW47CgogIFRva2VuVmF1bHQgdGVhbVZhdWx0OwoKIAogIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgLy8KICAvLyBjb25zdGFudHMgcmVsYXRlZCB0byB0b2tlbiBzYWxlCgogIC8vIGFmdGVyIHNsYWUgZW5kcywgYWRkaXRpb25hbCB0b2tlbnMgd2lsbCBiZSBnZW5lcmF0ZWQKICAvLyBhY2NvcmRpbmcgdG8gdGhlIGZvbGxvd2luZyBydWxlcywKICAvLyB3aGVyZSAxMDAlIGNvcnJlc3BvbmQgdG8gdGhlIG51bWJlciBvZiBzb2xkIHRva2VucwoKICAvLyBwZXJjZW50IG9mIHRva2VucyB0byBiZSBnZW5lcmF0ZWQgZm9yIHRoZSB0ZWFtCiAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgUFJDVF9URUFNID0gMTA7CiAgLy8gcGVyY2VudCBvZiB0b2tlbnMgdG8gYmUgZ2VuZXJhdGVkIGZvciBib3VudHkKICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBQUkNUX0JPVU5UWSA9IDM7CiAKICAvLyB3ZSBrZWVwIEVUSCBpbiB0aGUgY29udHJhY3QgdW50aWwgdGhlIHNhbGUgaXMgZmluYWxpemVkCiAgLy8gaG93ZXZlciBhIHNtYWxsIHBhcnQgb2YgZXZlcnkgY29udHJpYnV0aW9uIGdvZXMgdG8gb3BwZXJhdGlvbmFsIGNvc3RzCiAgLy8gcGVyY2VudCBvZiBFVEggZ29pbmcgdG8gb3BlcmF0aW9uYWwgYWNjb3VudAogIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFBSQ1RfRVRIX09QID0gMTA7CgogIHVpbnQ4IHB1YmxpYyBjb25zdGFudCBkZWNpbWFscyA9IDE4OwogIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IHNjYWxlID0gKHVpbnQyNTYoMTApICoqIGRlY2ltYWxzKTsKCgogIC8vIGhvdyBtYW55IHRva2VucyBmb3Igb25lIEVUSAogIC8vIHdlIG1heSBhZGp1c3QgdGhpcyBudW1iZXIgYmVmb3JlIGRlcGxveW1lbnQgYmFzZWQgb24gdGhlIG1hcmtldCBjb25kaXRpb25zCiAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgYmFzZVJhdGUgPSAzMzA7IC8vPC0tIHVuc2NhbGVkCgogIC8vIHdlIHdhbnQgdG8gbGltaXQgdGhlIG51bWJlciBvZiBhdmFpbGFibGUgdG9rZW5zIGR1cmluZyB0aGUgYm9udXMgc3RhZ2UgCiAgLy8gcGF5bWVudHMgZHVyaW5nIHRoZSBib251cyBzdGFnZSB3aWxsIG5vdCBiZSBhY2NlcHRlZCBhZnRlciB0aGUgVG9rZW5UcmVzaG9sZCBpcyByZWFjaGVkIG9yIGV4Y2VlZGVkCiAgLy8gd2UgbWF5IGFkanVzdCB0aGlzIG51bWJlciBiZWZvcmUgZGVwbG95bWVudCBiYXNlZCBvbiB0aGUgbWFya2V0IGNvbmRpdGlvbnMKCiAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgYm9udXNUb2tlblRocmVzaG9sZCA9IDIwMDAwMDAgKiBzY2FsZSA7IC8vPC0tLSBuZXcgCgogIC8vIG1pbm1hbCBjb250cmlidXRpb24sIFdlaQogIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IG1pbkNvbnRyaWJ1dGlvbiA9ICgxIGV0aGVyKSAvIDEwMDsKCiAgLy8gYm9udXMgc3RydWN0dXJlLCBXZWkKICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBib251c01pbkNvbnRyaWJ1dGlvbiA9ICgxIGV0aGVyKSAvMTA7CiAgLy8gCiAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgYm9udXNBZGQgPSA5OTsgLy8gKyAzMCUgPC0tIGNvcnJlY3RlZAogIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IHN0YWdlXzFfYWRkID0gNTA7Ly8gKyAxNSwxNSUgPC0tIGNvcnJlY3RlZAogIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IHN0YWdlXzJfYWRkID0gMzM7Ly8gKyAxMCUKICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBzdGFnZV8zX2FkZCA9IDE4Oy8vICsgNSw0NSUKICAKICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogIC8vCiAgLy8gZm9sb3dpbmcgYWRkcmVzc2VzIG5lZWQgdG8gYmUgc2V0IGluIHRoZSBjb25zdHJ1Y3RvcgogIC8vIHdlIGFsc28gaGF2ZSBzZXR0ZXIgZnVuY3Rpb25zIHdoaWNoIGFsbG93IHRvIGNoYW5nZQogIC8vIGFuIGFkZHJlc3MgaWYgaXQgaXMgY29tcHJvbWlzZWQgb3Igc29tZXRoaW5nIGhhcHBlbnMKCiAgLy8gZGVzdGluYXRpb24gZm9yIHRlYW0ncyBzaGFyZQogIC8vIHRoaXMgc2hvdWxkIHBvaW50IHRvIGFuIGluc3RhbmNlIG9mIFRva2VuVmF1bHQgY29udHJhY3QKICBhZGRyZXNzIHB1YmxpYyB0ZWFtVmF1bHRBZGRyID0gMHgwOwogIAogIC8vIGRlc3RpbmF0aW9uIGZvciByZXdhcmQgdG9rZW5zCiAgYWRkcmVzcyBwdWJsaWMgYm91bnR5VmF1bHRBZGRyOwoKICAvLyBkZXN0aW5hdGlvbiBmb3IgY29sbGVjdGVkIEV0aGVyCiAgYWRkcmVzcyBwdWJsaWMgdHJ1c3RlZVZhdWx0QWRkcjsKICAKICAvLyBkZXN0aW5hdGlvbiBmb3Igb3BlcmF0aW9uYWwgY29zdHMgYWNjb3VudAogIGFkZHJlc3MgcHVibGljIG9wVmF1bHRBZGRyOwogIAoKICAvLyBhZHJlc3Mgb2Ygb3VyIHRva2VuCiAgYWRkcmVzcyBwdWJsaWMgdG9rZW5BZGRyOwoKCiAgLy8gYWRkcmVzcyBvZiBvdXIgYml0Y29pbiBwYXltZW50IHByb2Nlc3Npbmcgcm9ib3QKICAvLyB0aGUgcm9ib3QgaXMgYWxsb3dlZCB0byBnZW5lcmF0ZSB0b2tlbnMgd2l0aG91dAogIC8vIHNlbmRpbmcgZXRoZXIKICAvLyB3ZSBkbyBpdCB0byBoYXZlIG1vcmUgZ3JhbnVsYXIgcmlnaHRzIGNvbnRyb2xsIAogIGFkZHJlc3MgcHVibGljIHJvYm90QWRkcjsKICAKICAKICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAvLyBSZWFsdGVkIHRvIENhbXBhaWduCgoKICAvLyBAY2hlY2sgZW5zdXJlIHRoYXQgc3RhdGUgdHJhbnNpdGlvbnMgYXJlIAogIC8vIG9ubHkgaW4gb25lIGRpcmVjdGlvbgogIC8vIDQgLSBwYXNzaXZlLCBub3QgYWNjZXB0aW5nIGZ1bmRzCiAgLy8gMyAtIGlzIG5vdCB1c2VkCiAgLy8gMiAtIGFjdGl2ZSBtYWluIHNhbGUsIGFjY2VwdGluZyBmdW5kcwogIC8vIDEgLSBjbG9zZWQsIG5vdCBhY2NlcHRpbmcgZnVuZHMgCiAgLy8gMCAtIGZpbmFsaXplZCwgbm90IGFjY2VwdGluZyBmdW5kcwogIHVpbnQ4IHB1YmxpYyBjYW1wYWlnblN0YXRlID0gNDsgCiAgYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CgogIC8vIGtlZXBzIHRyYWNrIG9mIHRva2VucyBnZW5lcmF0ZWQgc28gZmFyLCBzY2FsZWQgdmFsdWUKICB1aW50MjU2IHB1YmxpYyB0b2tlbnNHZW5lcmF0ZWQgPSAwOwoKICAvLyB0b3RhbCBFdGhlciByYWlzZWQgKD0gRXRoZXIgcGFpZCBpbnRvIHRoZSBjb250cmFjdCkKICB1aW50MjU2IHB1YmxpYyBhbW91bnRSYWlzZWQgPSAwOyAKCiAgCiAgLy8gdGhpcyBpcyB0aGUgYWRkcmVzcyB3aGVyZSB0aGUgZnVuZHMgCiAgLy8gd2lsbCBiZSB0cmFuc2ZlcmVkIGFmdGVyIHRoZSBzYWxlIGVuZHMKICAKICAvLyB0aW1lIGluIHNlY29uZHMgc2luY2UgZXBvY2ggCiAgLy8gc2V0IHRvIG1pZG5pZ2h0IG9mIHNhdHVyZGF5IEphbnVhcnkgMXN0LCA0MDAwCiAgdWludDI1NiBwdWJsaWMgdENhbXBhaWduU3RhcnQgPSA2NDA2MDU4ODgwMDsKICB1aW50MjU2IHB1YmxpYyB0Qm9udXNTdGFnZUVuZCA9IDcgKiAoMSBkYXlzKTsKICB1aW50MjU2IHB1YmxpYyB0UmVnU2FsZVN0YXJ0ID0gOCAqICgxIGRheXMpOwogIHVpbnQyNTYgcHVibGljIHRfMXN0X1N0YWdlRW5kID0gMTUgKiAoMSBkYXlzKTsKICB1aW50MjU2IHB1YmxpYyB0XzJuZF9TdGFnZUVuZCA9IDIyKiAoMSBkYXlzKTsKICB1aW50MjU2IHB1YmxpYyB0XzNyZF9TdGFnZUVuZCA9IDI5ICogKDEgZGF5cyk7CiAgdWludDI1NiBwdWJsaWMgdENhbXBhaWduRW5kID0gMzggKiAoMSBkYXlzKTsKICB1aW50MjU2IHB1YmxpYyB0RmluYWxpemVkID0gNjQwNjA1ODg4MDA7CgogIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAvLwogIC8vIE1vZGlmaWVycwoKICAvLy8gQG5vdGljZSBUaGUgcm9ib3QgaXMgYWxsb3dlZCB0byBnZW5lcmF0ZSB0b2tlbnMgCiAgLy8vICAgd2l0aG91dCBzZW5kaW5nIGV0aGVyCiAgLy8vICBXZSBkbyBpdCB0byBoYXZlIG1vcmUgZ3JhbnVsYXIgcmlnaHRzIGNvbnRyb2xsIAogIG1vZGlmaWVyIG9ubHlSb2JvdCAoKSB7IAogICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gcm9ib3RBZGRyKTsgCiAgIF87CiAgfQoKICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgLy8KICAvLyBFdmVudHMKIAogIGV2ZW50IENhbXBhaWduT3Blbih1aW50MjU2IHRpbWUpOwogIGV2ZW50IENhbXBhaWduQ2xvc2VkKHVpbnQyNTYgdGltZSk7CiAgZXZlbnQgQ2FtcGFpZ25QYXVzZCh1aW50MjU2IHRpbWUpOwogIGV2ZW50IENhbXBhaWduUmVzdW1lZCh1aW50MjU2IHRpbWUpOwogIGV2ZW50IFRva2VuR3JhbnRlZChhZGRyZXNzIGluZGV4ZWQgYmFja2VyLCB1aW50IGFtb3VudCwgc3RyaW5nIHJlZik7CiAgZXZlbnQgVG9rZW5HcmFudGVkKGFkZHJlc3MgaW5kZXhlZCBiYWNrZXIsIHVpbnQgYW1vdW50KTsKICBldmVudCBUb3RhbFJhaXNlZCh1aW50IHJhaXNlZCk7CiAgZXZlbnQgRmluYWxpemVkKHVpbnQyNTYgdGltZSk7CiAgZXZlbnQgQ2xhaW1lZFRva2VucyhhZGRyZXNzIGluZGV4ZWQgX3Rva2VuLCBhZGRyZXNzIGluZGV4ZWQgX2NvbnRyb2xsZXIsIHVpbnQgX2Ftb3VudCk7CiAKCiAgLy8vIEBub3RpY2UgQ29uc3RydWN0b3IKICAvLy8gQHBhcmFtIF90b2tlbkFkZHJlc3MgT3VyIHRva2VuJ3MgYWRkcmVzcwogIC8vLyBAcGFyYW0gIF90cnVzdGVlQWRkcmVzcyBUZWFtIHNoYXJlIAogIC8vLyBAcGFyYW0gIF9vcEFkZHJlc3MgVGVhbSBzaGFyZSAKICAvLy8gQHBhcmFtICBfYm91bnR5QWRkcmVzcyBUZWFtIHNoYXJlIAogIC8vLyBAcGFyYW0gIF9yb2JvdEFkZHJlc3MgQWRkcmVzcyBvZiBvdXIgcHJvY2Vzc2luZyBiYWNrZW5kCiAgZnVuY3Rpb24gVG9rZW5DYW1wYWlnbigKICAgIGFkZHJlc3MgX3Rva2VuQWRkcmVzcywKICAgIGFkZHJlc3MgX3RydXN0ZWVBZGRyZXNzLAogICAgYWRkcmVzcyBfb3BBZGRyZXNzLAogICAgYWRkcmVzcyBfYm91bnR5QWRkcmVzcywKICAgIGFkZHJlc3MgX3JvYm90QWRkcmVzcykKICB7CgogICAgY29udHJvbGxlciA9IG1zZy5zZW5kZXI7CiAgICAKICAgIC8vLyBzZXQgYWRkcmVzc2VzICAgICAKICAgIHRva2VuQWRkciA9IF90b2tlbkFkZHJlc3M7CiAgICAvL3RlYW1WYXVsdEFkZHIgPSBfdGVhbUFkZHJlc3M7CiAgICB0cnVzdGVlVmF1bHRBZGRyID0gX3RydXN0ZWVBZGRyZXNzOyAKICAgIG9wVmF1bHRBZGRyID0gX29wQWRkcmVzczsKICAgIGJvdW50eVZhdWx0QWRkciA9IF9ib3VudHlBZGRyZXNzOwogICAgcm9ib3RBZGRyID0gX3JvYm90QWRkcmVzczsKCiAgICAvLy8gcmVmZXJlbmNlIG91ciB0b2tlbgogICAgdG9rZW4gPSByZWFfdG9rZW5faW50ZXJmYWNlKHRva2VuQWRkcik7CiAgIAogICAgLy8gYWRqdXN0ICdjb25zdGFudHMnIGZvciBkZWNpbWFscyB1c2VkCiAgICAvLyBkZWNpbWFscyA9IHRva2VuLmRlY2ltYWxzKCk7IC8vIHNob3VsZCBiZSAxOAogICAKICB9CgoKICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogIC8vLwogIC8vLyBGdW5jdGlvbnMgdGhhdCBkbyBub3QgY2hhbmdlIGNvbnRyYWN0IHN0YXRlCiAgZnVuY3Rpb24gZ2V0X3ByZXNhbGVfZ29hbCgpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpewogICAgaWYgKChub3cgPD0gdEJvbnVzU3RhZ2VFbmQpICYmICh0b2tlbnNHZW5lcmF0ZWQgPj0gYm9udXNUb2tlblRocmVzaG9sZCkpewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9CgogIC8vLyBAbm90aWNlIGNvbXB1dGVzIHRoZSBjdXJyZW50IHJhdGUKICAvLy8gIGFjY29yZGluZyB0byB0aW1lIHBhc3NlZCBzaW5jZSB0aGUgc3RhcnQKICAvLy8gQHJldHVybiBhbW91bnQgb2YgdG9rZW5zIHBlciBFVEgKICBmdW5jdGlvbiBnZXRfcmF0ZSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpewogICAgCiAgICAvLyBvYnZpb3VzbHkgb25lIGdldHMgMCB0b2tlbnMKICAgIC8vIGlmIGNhbXBhaWduIG5vdCB5ZXQgc3RhcnRlZAogICAgLy8gb3IgaXMgYWxyZWFkeSBvdmVyCiAgICBpZiAobm93IDwgdENhbXBhaWduU3RhcnQpIHJldHVybiAwOwogICAgaWYgKG5vdyA+IHRDYW1wYWlnbkVuZCkgcmV0dXJuIDA7CiAgICAKICAgIC8vIGNvbXB1dGUgcmF0ZSBwZXIgRVRIIGJhc2VkIG9uIHRpbWUKICAgIC8vIGFzc3VtZXMgdGhhdCB0aW1lIG1hcmtzIGFyZSBpbmNyZWFzaW5nCiAgICAvLyBmcm9tIHRCb251c1N0YWdlRW5kIHRocm91Z2ggdF8zcmRfU3RhZ2VFbmQKICAgIC8vIGFkanVzdCBieSBmYWN0b3IgJ3NjYWxlJyBkZXBlbmRpbmcgb24gdG9rZW4ncyBkZWNpbWFscwogICAgLy8gTk9URTogY2FuJ3QgY2F1c2Ugb3ZlcmZsb3cgc2luY2UgYWxsIG51bWJlcnMgYXJlIGtub3duIGF0IGNvbXBpbGUgdGltZQogICAgaWYgKG5vdyA8PSB0Qm9udXNTdGFnZUVuZCkKICAgICAgcmV0dXJuIHNjYWxlICogKGJhc2VSYXRlICsgYm9udXNBZGQpOwoKICAgIGlmIChub3cgPD0gdF8xc3RfU3RhZ2VFbmQpCiAgICAgIHJldHVybiBzY2FsZSAqIChiYXNlUmF0ZSArIHN0YWdlXzFfYWRkKTsKICAgIAogICAgZWxzZSBpZiAobm93IDw9IHRfMm5kX1N0YWdlRW5kKQogICAgICByZXR1cm4gc2NhbGUgKiAoYmFzZVJhdGUgKyBzdGFnZV8yX2FkZCk7CiAgICAKICAgIGVsc2UgaWYgKG5vdyA8PSB0XzNyZF9TdGFnZUVuZCkKICAgICAgcmV0dXJuIHNjYWxlICogKGJhc2VSYXRlICsgc3RhZ2VfM19hZGQpOwogICAgCiAgICBlbHNlIAogICAgICByZXR1cm4gYmFzZVJhdGUgKiBzY2FsZTsgCiAgfQoKCiAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgLy8vCiAgLy8vIEZ1bmN0aW9ucyB0aGF0IGNoYW5nZSBjb250cmFjdCBzdGF0ZQoKICAvLy8KICAvLy8gU2V0dGVycwogIC8vLwoKCiAgLy8vIHRoaXMgaXMgb25seSBmb3IgZW1lcmdlbmN5IGNhc2UKICBmdW5jdGlvbiBzZXRSb2JvdEFkZHIoYWRkcmVzcyBfbmV3Um9ib3RBZGRyKSBwdWJsaWMgb25seUNvbnRyb2xsZXIgewogICAgcmVxdWlyZSggX25ld1JvYm90QWRkciAhPSAweDAgKTsKICAgIHJvYm90QWRkciA9IF9uZXdSb2JvdEFkZHI7CiAgfQoKICAvLyB3ZSBoYXZlIHRvIHNldCB0ZWFtIHRva2VuIGFkZHJlc3MgYmVmb3JlIGNhbXBhaWduIHN0YXJ0CiAgZnVuY3Rpb24gc2V0VGVhbUFkZHIoYWRkcmVzcyBfbmV3VGVhbUFkZHIpIHB1YmxpYyBvbmx5Q29udHJvbGxlciB7CiAgICAgcmVxdWlyZSggY2FtcGFpZ25TdGF0ZSA+IDIgJiYgX25ld1RlYW1BZGRyICE9IDB4MCApOwogICAgIHRlYW1WYXVsdEFkZHIgPSBfbmV3VGVhbUFkZHI7CiAgICAgdGVhbVZhdWx0ID0gVG9rZW5WYXVsdCh0ZWFtVmF1bHRBZGRyKTsKICB9CiAKCgogIC8vLyBAbm90aWNlICBQdXRzIGNhbXBhaWduIGludG8gYWN0aXZlIHN0YXRlICAKICAvLy8gIG9ubHkgY29udHJvbGxlciBjYW4gZG8gdGhhdAogIC8vLyAgb25seSBwb3NzaWJsZSBpZiB0ZWFtIHRva2VuIFZhdWx0IGlzIHNldCB1cAogIC8vLyAgV0FSTklORzogdXN1YWwgY2F2ZWF0cyBhcHBseSB0byB0aGUgRXRoZXJldW0ncyBpbnRlcnByZXRhdGlvbiBvZiB0aW1lCiAgZnVuY3Rpb24gc3RhcnRTYWxlKCkgcHVibGljIG9ubHlDb250cm9sbGVyIHsKICAgIC8vIHdlIG9ubHkgY2FuIHN0YXJ0IGlmIHRlYW0gdG9rZW4gVmF1bHQgYWRkcmVzcyBpcyBzZXQKICAgIHJlcXVpcmUoIGNhbXBhaWduU3RhdGUgPiAyICYmIHRlYW1WYXVsdEFkZHIgIT0gMHgwKTsKCiAgICBjYW1wYWlnblN0YXRlID0gMjsKCiAgICB1aW50MjU2IHROb3cgPSBub3c7CiAgICAvLyBhc3N1bWUgdGltZXN0YW1wcyB3aWxsIG5vdCBjYXVzZSBvdmVyZmxvdwogICAgdENhbXBhaWduU3RhcnQgPSB0Tm93OwogICAgdEJvbnVzU3RhZ2VFbmQgKz0gdE5vdzsKICAgIHRSZWdTYWxlU3RhcnQgKz0gdE5vdzsKICAgIHRfMXN0X1N0YWdlRW5kICs9IHROb3c7CiAgICB0XzJuZF9TdGFnZUVuZCArPSB0Tm93OwogICAgdF8zcmRfU3RhZ2VFbmQgKz0gdE5vdzsKICAgIHRDYW1wYWlnbkVuZCArPSB0Tm93OwoKICAgIENhbXBhaWduT3Blbihub3cpOwogIH0KCgogIC8vLyBAbm90aWNlIFBhdXNlIHNhbGUKICAvLy8gICBqdXN0IGluIGNhc2Ugd2UgaGF2ZSBzb21lIHRyb3VibGVzIAogIC8vLyAgIE5vdGUgdGhhdCB0aW1lIG1hcmtzIGFyZSBub3QgdXBkYXRlZAogIGZ1bmN0aW9uIHBhdXNlU2FsZSgpIHB1YmxpYyBvbmx5Q29udHJvbGxlciB7CiAgICByZXF1aXJlKCBjYW1wYWlnblN0YXRlICA9PSAyICk7CiAgICBwYXVzZWQgPSB0cnVlOwogICAgQ2FtcGFpZ25QYXVzZChub3cpOwogIH0KCgogIC8vLyBAbm90aWNlIFJlc3VtZSBzYWxlCiAgZnVuY3Rpb24gcmVzdW1lU2FsZSgpIHB1YmxpYyBvbmx5Q29udHJvbGxlciB7CiAgICByZXF1aXJlKCBjYW1wYWlnblN0YXRlICA9PSAyICk7CiAgICBwYXVzZWQgPSBmYWxzZTsKICAgIENhbXBhaWduUmVzdW1lZChub3cpOwogIH0KCgoKICAvLy8gQG5vdGljZSBQdXRzIHRoZSBjYW1hcGlnbiBpbnRvIGNsb3NlZCBzdGF0ZQogIC8vLyAgIG9ubHkgY29udHJvbGxlciBjYW4gZG8gc28KICAvLy8gICBvbmx5IHBvc3NpYmxlIGZyb20gdGhlIGFjdGl2ZSBzdGF0ZQogIC8vLyAgIHdlIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24gaWYgd2Ugd2FudCB0byBzdG9wIHNhbGUgYmVmb3JlIGVuZCB0aW1lIAogIC8vLyAgIGFuZCBiZSBhYmxlIHRvIHBlcmZvcm0gJ2ZpbmFsaXplQ2FtcGFpZ24oKScgaW1tZWRpYXRlbHkKICBmdW5jdGlvbiBjbG9zZVNhbGUoKSBwdWJsaWMgb25seUNvbnRyb2xsZXIgewogICAgcmVxdWlyZSggY2FtcGFpZ25TdGF0ZSAgPT0gMiApOwogICAgY2FtcGFpZ25TdGF0ZSA9IDE7CgogICAgQ2FtcGFpZ25DbG9zZWQobm93KTsKICB9ICAgCgoKCiAgLy8vIEBub3RpY2UgRmluYWxpemVzIHRoZSBjYW1wYWlnbgogIC8vLyAgIEdldCBmdW5kcyBvdXQsIGdlbmVyYXRlcyB0ZWFtLCBib3VudHkgYW5kIHJlc2VydmUgdG9rZW5zCiAgZnVuY3Rpb24gZmluYWxpemVDYW1wYWlnbigpIHB1YmxpYyB7ICAgICAKICAgICAgCiAgICAgIC8vLyBvbmx5IGlmIHNhbGUgd2FzIGNsb3NlZCBvciA0OCBob3VycyA9IDI4ODAgbWludXRlcyBoYXZlIHBhc3NlZCBzaW5jZSBjYW1wYWlnbiBlbmQKICAgICAgLy8vIHdlIGxlYXZlIHRoaXMgdGltZSB0byBjb21wbGV0ZSBwb3NzaWJseSBwZW5kaW5nIG9yZGVycwogICAgICAvLy8gZnJvbSBvZmZjaGFpbiBjb250cmlidXRpb25zIAogICAgICAKICAgICAgcmVxdWlyZSAoIChjYW1wYWlnblN0YXRlID09IDEpIHx8CiAgICAgICAgICAgICAgICAoKGNhbXBhaWduU3RhdGUgIT0gMCkgJiYgKG5vdyA+IHRDYW1wYWlnbkVuZCArICgyODgwIG1pbnV0ZXMpKSkpOwogICAgICAKICAgICAgY2FtcGFpZ25TdGF0ZSA9IDA7CgogICAgIAoKICAgICAgLy8gZm9yd2FyZCBmdW5kcyB0byB0aGUgdHJ1c3RlZSAKICAgICAgLy8gc2luY2Ugd2UgZm9yd2FyZCBhIGZyYWN0aW9uIG9mIHRoZSBpbmNvbW1pbmcgZXRoZXIgb24gZXZlcnkgY29udHJpYnV0aW9uCiAgICAgIC8vICdhbW91bnRSYWlzZWQnIElTIE5PVCBlcXVhbCB0byB0aGUgY29udHJhY3QncyBiYWxhbmNlCiAgICAgIC8vIHdlIHVzZSAndGhpcy5iYWxhbmNlJyBpbnN0ZWFkCgogICAgICB0cnVzdGVlVmF1bHRBZGRyLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICAgIAogICAgICAKICAgICAgdWludDI1NiBib3VudHlUb2tlbnMgPSAodG9rZW5zR2VuZXJhdGVkLm11bChQUkNUX0JPVU5UWSkpLmRpdigxMDApOwogICAgICAKICAgICAgdWludDI1NiB0ZWFtVG9rZW5zID0gKHRva2Vuc0dlbmVyYXRlZC5tdWwoUFJDVF9URUFNKSkuZGl2KDEwMCk7CiAgICAgIAogICAgICAvLyBnZW5lcmF0ZSBib3VudHkgdG9rZW5zIAogICAgICBhc3NlcnQoIGRvX2dyYW50X3Rva2Vucyhib3VudHlWYXVsdEFkZHIsIGJvdW50eVRva2VucykgKTsKICAgICAgLy8gZ2VuZXJhdGUgdGVhbSB0b2tlbnMKICAgICAgLy8gdGltZSBsb2NrIHRlYW0gdG9rZW5zIGJlZm9yZSB0cmFuc2ZlcgogICAgICAKICAgICAgLy8gd2UgZG9udCB1c2UgaXQgYW55bW9yZQogICAgICAvL3RlYW1WYXVsdC5zZXRUaW1lTG9jayggdENhbXBhaWduRW5kICsgNiAqICg2IG1pbnV0ZXMpKTsgIAogICAgICAKICAgICAgdEZpbmFsaXplZCA9IG5vdzsKCiAgICAgIC8vIGdlbmVyYXRlIGFsbCB0aGUgdG9rZW5zCiAgICAgIGFzc2VydCggZG9fZ3JhbnRfdG9rZW5zKHRlYW1WYXVsdEFkZHIsIHRlYW1Ub2tlbnMpICk7CiAgICAgIAogICAgICAvLyBwcmV2ZW50IGZ1cnRoZXIgdG9rZW4gZ2VuZXJhdGlvbgogICAgICB0b2tlbi5maW5hbGl6ZSgpOyAgICAgCgogICAgICAvLyBub3RpZnkgdGhlIHdvcmxkCiAgICAgIEZpbmFsaXplZCh0RmluYWxpemVkKTsKICAgfQoKCiAgLy8vIEBub3RpY2UgdHJpZ2dlcnMgdG9rZW4gZ2VuZXJhdG9uIGZvciB0aGUgcmVjaXBpZW50CiAgLy8vICBjYW4gYmUgY2FsbGVkIG9ubHkgZnJvbSB0aGUgdG9rZW4gc2FsZSBjb250cmFjdCBpdHNlbGYKICAvLy8gIHNpZGUgZWZmZWN0OiBpbmNyZWFzZXMgdGhlIGdlbmVyYXRlZCB0b2tlbnMgY291bnRlciAKICAvLy8gIENBVVRJT046IHdlIGRvIG5vdCBjaGVjayBjYW1wYWlnbiBzdGF0ZSBhbmQgcGFyYW1ldGVycyBhc3N1bWluZyB0aGF0J3MgY2FsZWUncyB0YXNrCiAgZnVuY3Rpb24gZG9fZ3JhbnRfdG9rZW5zKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9uVG9rZW5zKSBpbnRlcm5hbCByZXR1cm5zIChib29sKXsKICAgIAogICAgcmVxdWlyZSggdG9rZW4uZ2VuZXJhdGVfdG9rZW5fZm9yKF90bywgX25Ub2tlbnMpICk7CiAgICAKICAgIHRva2Vuc0dlbmVyYXRlZCA9IHRva2Vuc0dlbmVyYXRlZC5hZGQoX25Ub2tlbnMpOwogICAgCiAgICByZXR1cm4gdHJ1ZTsKICB9CgoKICAvLy8gIEBub3RpY2UgcHJvY2Vzc2VzIHRoZSBjb250cmlidXRpb24KICAvLy8gICBjaGVja3MgY2FtcGFpZ24gc3RhdGUsIHRpbWUgd2luZG93IGFuZCBtaW5pbWFsIGNvbnRyaWJ1dGlvbgogIC8vLyAgIHRocm93cyBpZiBvbmUgb2YgdGhlIGNvbmRpdGlvbnMgZmFpbHMKICBmdW5jdGlvbiBwcm9jZXNzX2NvbnRyaWJ1dGlvbihhZGRyZXNzIF90b0FkZHIpIGludGVybmFsIHsKICAgIAogICAgcmVxdWlyZSAoKGNhbXBhaWduU3RhdGUgPT0gMikgICAvLyBhY3RpdmUgbWFpbiBzYWxlCiAgICAgICAgICYmIChub3cgPD0gdENhbXBhaWduRW5kKSAgIC8vIHdpdGhpbiB0aW1lIHdpbmRvdwogICAgICAgICAmJiAocGF1c2VkID09IGZhbHNlKSk7ICAgICAvLyBub3Qgb24gaG9sZAogICAgICAKCiAgICAvLyBjb250cmlidXRpb25zIGFyZSBub3QgcG9zc2libGUgYmVmb3JlIHJlZ3VsYXIgc2FsZSBzdGFydHMgCiAgICBpZiAoIChub3cgPiB0Qm9udXNTdGFnZUVuZCkgJiYgLy88LS0tIG5ldwogICAgICAgICAobm93IDwgdFJlZ1NhbGVTdGFydCkpeyAvLzwtLS0gbmV3CiAgICAgIHJldmVydCgpOyAvLzwtLS0gbmV3CiAgICB9CgogICAgLy8gZHVyaW5nIHRoZSBib251cyBwaGFzZSB3ZSByZXF1aXJlIGEgbWluaW1hbCBldGggY29udHJpYnV0aW9uIAogICAgaWYgKChub3cgPD0gdEJvbnVzU3RhZ2VFbmQpICYmIAogICAgICAgICgobXNnLnZhbHVlIDwgYm9udXNNaW5Db250cmlidXRpb24gKSB8fAogICAgICAgICh0b2tlbnNHZW5lcmF0ZWQgPj0gYm9udXNUb2tlblRocmVzaG9sZCkpKSAvLzwtLS0gbmV3LCByZXZlcnQgaWYgYm9udXNUaHJlc2hvbGQgaXMgZXhjZWVkZWQgCiAgICB7CiAgICAgIHJldmVydCgpOwogICAgfSAgICAgIAoKICAgIAogIAogICAgLy8gb3RoZXJ3aXNlIHdlIGNoZWNrIHRoYXQgRXRoIHNlbnQgaXMgc3VmZmljaWVudCB0byBnZW5lcmF0ZSBhdCBsZWFzdCBvbmUgdG9rZW4KICAgIC8vIHRob3VnaCBvdXIgdG9rZW4gaGFzIGRlY2ltYWxzIHdlIGRvbid0IHdhbnQgbmFub2NvbnRyaWJ1dGlvbnMKICAgIHJlcXVpcmUgKCBtc2cudmFsdWUgPj0gbWluQ29udHJpYnV0aW9uICk7CgogICAgLy8gY29tcHV0ZSB0aGUgcmF0ZQogICAgLy8gTk9URTogcmF0ZSBpcyBzY2FsZWQgdG8gYWNjb3VudCBmb3IgdG9rZW4gZGVjaW1hbHMKICAgIHVpbnQyNTYgcmF0ZSA9IGdldF9yYXRlKCk7CiAgICAKICAgIC8vIGNvbXB1dGUgdGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgZ2VuZXJhdGVkCiAgICB1aW50MjU2IG5Ub2tlbnMgPSAocmF0ZS5tdWwobXNnLnZhbHVlKSkuZGl2KDEgZXRoZXIpOwogICAgCiAgICAvLyBjb21wdXRlIHRoZSBmcmFjdGlvbiBvZiBFVEggZ29pbmcgdG8gb3AgYWNjb3VudAogICAgdWludDI1NiBvcEV0aCA9IChQUkNUX0VUSF9PUC5tdWwobXNnLnZhbHVlKSkuZGl2KDEwMCk7CgogICAgLy8gdHJhbnNmZXIgdG8gb3AgYWNjb3VudCAKICAgIG9wVmF1bHRBZGRyLnRyYW5zZmVyKG9wRXRoKTsKICAgIAogICAgLy8gQHRvZG8gY2hlY2sgc3VjY2VzcyAoTk9URSB3ZSBoYXZlIG5vIGNhcCBub3cgc28gc3VjY2VzcyBpcyBhc3N1bWVkKQogICAgLy8gc2lkZSBlZmZlY3Q6IGRvX2dyYW50X3Rva2VucyB1cGRhdGVzIHRoZSAidG9rZW5zR2VuZXJhdGVkIiB2YXJpYWJsZQogICAgcmVxdWlyZSggZG9fZ3JhbnRfdG9rZW5zKF90b0FkZHIsIG5Ub2tlbnMpICk7CgoKICAgIGFtb3VudFJhaXNlZCA9IGFtb3VudFJhaXNlZC5hZGQobXNnLnZhbHVlKTsKICAgIAogICAgLy8gbm90aWZ5IHRoZSB3b3JsZAogICAgVG9rZW5HcmFudGVkKF90b0FkZHIsIG5Ub2tlbnMpOwogICAgVG90YWxSYWlzZWQoYW1vdW50UmFpc2VkKTsKICB9CgoKICAvLy8gQG5vdGljZSBHbmVuZXJhdGUgdG9rZW4gIm1hbnVhbGx5IiB3aXRob3V0IHBheW1lbnQKICAvLy8gIFdlIGludGVuZCB0byB1c2UgdGhpcyB0byBnZW5lcmF0ZSB0b2tlbnMgZnJvbSBCaXRjb2luIGNvbnRyaWJ1dGlvbnMgd2l0aG91dCAKICAvLy8gIHdpdGhvdXQgRXRoZXIgYmVpbmcgc2VudCB0byB0aGlzIGNvbnRyYWN0CiAgLy8vICBOb3RlIHRoYXQgdGhpcyBmdW5jdGlvbiBjYW4gYmUgdHJpZ2dlcmVkIG9ubHkgYnkgb3VyIEJUQyBwcm9jZXNzaW5nIHJvYm90LiAgCiAgLy8vICBBIHN0cmluZyByZWZlcmVuY2UgaXMgcGFzc2VkIGFuZCBsb2dnZWQgZm9yIGJldHRlciBib29rIGtlZXBpbmcKICAvLy8gIHNpZGUgZWZmZWN0OiBpbmNyZWFzZXMgdGhlIGdlbmVyYXRlZCB0b2tlbnMgY291bnRlciB2aWEgZG9fZ3JhbnRfdG9rZW5zCiAgLy8vIEBwYXJhbSBfdG9BZGRyIGJlbmlmaWNpYXJ5IGFkZHJlc3MKICAvLy8gQHBhcmFtIF9uVG9rZW5zIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgZ2VuZXJhdGVkCiAgLy8vIEBwYXJhbSBfcmVmIHBheW1lbnQgcmVmZXJlbmNlIGUuZy4gQml0Y29pbiBhZGRyZXNzIHVzZWQgZm9yIGNvbnRyaWJ1dGlvbiAKICBmdW5jdGlvbiBncmFudF90b2tlbl9mcm9tX29mZmNoYWluKGFkZHJlc3MgX3RvQWRkciwgdWludCBfblRva2Vucywgc3RyaW5nIF9yZWYpIHB1YmxpYyBvbmx5Um9ib3QgewogICAgcmVxdWlyZSAoIChjYW1wYWlnblN0YXRlID09IDIpCiAgICAgICAgICAgICAgfHwoY2FtcGFpZ25TdGF0ZSA9PSAxKSk7CgogICAgZG9fZ3JhbnRfdG9rZW5zKF90b0FkZHIsIF9uVG9rZW5zKTsKICAgIFRva2VuR3JhbnRlZChfdG9BZGRyLCBfblRva2VucywgX3JlZik7CiAgfQoKCiAgLy8vIEBub3RpY2UgVGhpcyBmdW5jdGlvbiBoYW5kbGVzIHJlY2VpdmluZyBFdGhlciBpbiBmYXZvciBvZiBhIHRoaXJkIHBhcnR5IGFkZHJlc3MKICAvLy8gICB3ZSBjYW4gdXNlIHRoaXMgZnVuY3Rpb24gZm9yIGJ1eWluZyB0b2tlbnMgb24gYmVoYWxmCiAgLy8vIEBwYXJhbSBfdG9BZGRyIHRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgcmVjZWl2ZSB0b2tlbnMKICBmdW5jdGlvbiBwcm94eV9jb250cmlidXRpb24oYWRkcmVzcyBfdG9BZGRyKSBwdWJsaWMgcGF5YWJsZSB7CiAgICByZXF1aXJlICggX3RvQWRkciAhPSAweDAgKTsKICAgIC8vLyBwcmV2ZW50IGNvbnRyYWN0cyBmcm9tIGJ1eWluZyB0b2tlbnMKICAgIC8vLyB3ZSBhc3N1bWUgaXQgaXMgc3RpbGwgdXNhYmxlIGZvciBhIHdoaWxlCiAgICAvLy8gd2UgYWtub3dsZWRnZSB0aGUgZmFjdCB0aGF0IHRoaXMgcHJldmVudHMgQUxMIGNvbnRyYWN0cyBpbmNsdWRpbmcgTXVsdGlTaWcncwogICAgLy8vIGZyb20gY29udHJpYnV0aW5nLCBpdCBpcyBpbnRlbmRlZCBhbmQgd2UgYWRkIGEgY29ycmVzcG9uZGluZyBzdGF0ZW1lbnQgCiAgICAvLy8gdG8gb3VyIFRlcm1zIGFuZCB0aGUgSUNPIHNpdGUKICAgIHJlcXVpcmUoIG1zZy5zZW5kZXIgPT0gdHgub3JpZ2luICk7CiAgICBwcm9jZXNzX2NvbnRyaWJ1dGlvbihfdG9BZGRyKTsKICB9CgoKICAvLy8gQG5vdGljZSBUaGlzIGZ1bmN0aW9uIGhhbmRsZXMgcmVjZWl2aW5nIEV0aGVyCiAgZnVuY3Rpb24gKCkgcGF5YWJsZSB7CiAgICAvLy8gcHJldmVudCBjb250cmFjdHMgZnJvbSBidXlpbmcgdG9rZW5zCiAgICAvLy8gd2UgYXNzdW1lIGl0IGlzIHN0aWxsIHVzYWJsZSBmb3IgYSB3aGlsZQogICAgLy8vIHdlIGFrbm93bGVkZ2UgdGhlIGZhY3QgdGhhdCB0aGlzIHByZXZlbnRzIEFMTCBjb250cmFjdHMgaW5jbHVkaW5nIE11bHRpU2lnJ3MKICAgIC8vLyBmcm9tIGNvbnRyaWJ1dGluZywgaXQgaXMgaW50ZW5kZWQgYW5kIHdlIGFkZCBhIGNvcnJlc3BvbmRpbmcgc3RhdGVtZW50IAogICAgLy8vIHRvIG91ciBUZXJtcyBhbmQgdGhlIElDTyBzaXRlCiAgICByZXF1aXJlKCBtc2cuc2VuZGVyID09IHR4Lm9yaWdpbiApOwogICAgcHJvY2Vzc19jb250cmlidXRpb24obXNnLnNlbmRlcik7ICAKICB9CgogIC8vLy8vLy8vLy8KICAvLyBTYWZldHkgTWV0aG9kcwogIC8vLy8vLy8vLy8KCiAgLyogaW5zcGlyZWQgYnkgTWluaU1lVG9rZW4uc29sICovCgogIC8vLyBAbm90aWNlIFRoaXMgbWV0aG9kIGNhbiBiZSB1c2VkIGJ5IHRoZSBjb250cm9sbGVyIHRvIGV4dHJhY3QgbWlzdGFrZW5seQogIC8vLyAgc2VudCB0b2tlbnMgdG8gdGhpcyBjb250cmFjdC4KICBmdW5jdGlvbiBjbGFpbVRva2VucyhhZGRyZXNzIF90b2tlbkFkZHIpIHB1YmxpYyBvbmx5Q29udHJvbGxlciB7CiAgICAgCiAgICAgLy8gaWYgKF90b2tlbiA9PSAweDApIHsKICAgICAvLyAgICAgY29udHJvbGxlci50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwogICAgIC8vICAgICByZXR1cm47CiAgICAgLy8gfQoKICAgICAgRVJDMjBCYXNpYyBzb21lX3Rva2VuID0gRVJDMjBCYXNpYyhfdG9rZW5BZGRyKTsKICAgICAgdWludCBiYWxhbmNlID0gc29tZV90b2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgICAgIHNvbWVfdG9rZW4udHJhbnNmZXIoY29udHJvbGxlciwgYmFsYW5jZSk7CiAgICAgIENsYWltZWRUb2tlbnMoX3Rva2VuQWRkciwgY29udHJvbGxlciwgYmFsYW5jZSk7CiAgfQp9'.
	

]
