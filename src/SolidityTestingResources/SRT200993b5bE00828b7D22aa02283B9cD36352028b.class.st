Class {
	#name : #SRT200993b5bE00828b7D22aa02283B9cD36352028b,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT200993b5bE00828b7D22aa02283B9cD36352028b >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7Cgpjb250cmFjdCBPd25lZCB7Cgltb2RpZmllciBvbmx5X293bmVyIHsKCQlpZiAobXNnLnNlbmRlciAhPSBvd25lcikKCQkJcmV0dXJuOwoJCV87IAoJfQoKCWV2ZW50IE5ld093bmVyKGFkZHJlc3MgaW5kZXhlZCBvbGQsIGFkZHJlc3MgaW5kZXhlZCBjdXJyZW50KTsKCglmdW5jdGlvbiBzZXRPd25lcihhZGRyZXNzIF9uZXcpIG9ubHlfb3duZXIgeyBOZXdPd25lcihvd25lciwgX25ldyk7IG93bmVyID0gX25ldzsgfQoKCWFkZHJlc3MgcHVibGljIG93bmVyID0gbXNnLnNlbmRlcjsKfQoKbGlicmFyeSBNYXRoIHsKICBmdW5jdGlvbiBtYXg2NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWluNjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsKICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWF4MjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtaW4yNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogIH0KfQoKbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKCiAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIHByZXZpb3VzT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBuZXdPd25lcik7CgoKICAvKioKICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgKiBhY2NvdW50LgogICAqLwogIGZ1bmN0aW9uIE93bmFibGUoKSB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KCgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOwogICAgb3duZXIgPSBuZXdPd25lcjsKICB9Cgp9Cgpjb250cmFjdCBQYXVzYWJsZSBpcyBPd25hYmxlIHsKICBldmVudCBQYXVzZSgpOwogIGV2ZW50IFVucGF1c2UoKTsKCiAgYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CgoKICAvKioKICAgKiBAZGV2IG1vZGlmaWVyIHRvIGFsbG93IGFjdGlvbnMgb25seSB3aGVuIHRoZSBjb250cmFjdCBJUyBwYXVzZWQKICAgKi8KICBtb2RpZmllciB3aGVuTm90UGF1c2VkKCkgewogICAgcmVxdWlyZSghcGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IG1vZGlmaWVyIHRvIGFsbG93IGFjdGlvbnMgb25seSB3aGVuIHRoZSBjb250cmFjdCBJUyBOT1QgcGF1c2VkCiAgICovCiAgbW9kaWZpZXIgd2hlblBhdXNlZCB7CiAgICByZXF1aXJlKHBhdXNlZCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHBhdXNlLCB0cmlnZ2VycyBzdG9wcGVkIHN0YXRlCiAgICovCiAgZnVuY3Rpb24gcGF1c2UoKSBvbmx5T3duZXIgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sKSB7CiAgICBwYXVzZWQgPSB0cnVlOwogICAgUGF1c2UoKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHVucGF1c2UsIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgICovCiAgZnVuY3Rpb24gdW5wYXVzZSgpIG9ubHlPd25lciB3aGVuUGF1c2VkIHJldHVybnMgKGJvb2wpIHsKICAgIHBhdXNlZCA9IGZhbHNlOwogICAgVW5wYXVzZSgpOwogICAgcmV0dXJuIHRydWU7CiAgfQp9Cgpjb250cmFjdCBMZWdhbExhenlTY2hlZHVsZXIgaXMgT3duYWJsZSB7CiAgICB1aW50NjQgcHVibGljIGxhc3RVcGRhdGU7CiAgICB1aW50NjQgcHVibGljIGludGVydmFsRHVyYXRpb247CiAgICBib29sIHNjaGVkdWxlckVuYWJsZWQgPSBmYWxzZTsKICAgIGZ1bmN0aW9uKCkgaW50ZXJuYWwgY2FsbGJhY2s7CgogICAgZXZlbnQgTG9nUmVnaXN0ZXJlZEludGVydmFsKHVpbnQ2NCBkYXRlLCB1aW50NjQgZHVyYXRpb24pOwogICAgZXZlbnQgTG9nUHJvY2Vzc2VkSW50ZXJ2YWwodWludDY0IGRhdGUsIHVpbnQ2NCBpbnRlcnZhbHMpOyAgICAKICAgIC8qKgogICAgKiBUcmlnZ2VycyB0aGUgcmVnaXN0ZXJlZCBjYWxsYmFjayBmdW5jdGlvbiBmb3IgdGhlIG51bWJlciBvZiBwZXJpb2RzIHBhc3NlZCBzaW5jZSBsYXN0IHVwZGF0ZQogICAgKi8KICAgIG1vZGlmaWVyIGludGVydmFsVHJpZ2dlcigpIHsKICAgICAgICB1aW50NjQgY3VycmVudFRpbWUgPSB1aW50NjQobm93KTsKICAgICAgICB1aW50NjQgcmVxdWlyZWRJbnRlcnZhbHMgPSAoY3VycmVudFRpbWUgLSBsYXN0VXBkYXRlKSAvIGludGVydmFsRHVyYXRpb247CiAgICAgICAgaWYoIHNjaGVkdWxlckVuYWJsZWQgJiYgKHJlcXVpcmVkSW50ZXJ2YWxzID4gMCkpIHsKICAgICAgICAgICAgTG9nUHJvY2Vzc2VkSW50ZXJ2YWwobGFzdFVwZGF0ZSwgcmVxdWlyZWRJbnRlcnZhbHMpOwogICAgICAgICAgICB3aGlsZSAocmVxdWlyZWRJbnRlcnZhbHMtLSA+IDApIHsKICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGFzdFVwZGF0ZSA9IGN1cnJlbnRUaW1lOwogICAgICAgIH0KICAgICAgICBfOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBMZWdhbExhenlTY2hlZHVsZXIoKSB7CiAgICAgICAgbGFzdFVwZGF0ZSA9IHVpbnQ2NChub3cpOwogICAgfQoKICAgIGZ1bmN0aW9uIGVuYWJsZVNjaGVkdWxlcigpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIHNjaGVkdWxlckVuYWJsZWQgPSB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlZ2lzdGVySW50ZXJ2YWxDYWxsKHVpbnQ2NCBfaW50ZXJ2YWxEdXJhdGlvbiwgZnVuY3Rpb24oKSBpbnRlcm5hbCBfY2FsbGJhY2spIGludGVybmFsIHsKICAgICAgICBsYXN0VXBkYXRlID0gdWludDY0KG5vdyk7CiAgICAgICAgaW50ZXJ2YWxEdXJhdGlvbiA9IF9pbnRlcnZhbER1cmF0aW9uOwogICAgICAgIGNhbGxiYWNrID0gX2NhbGxiYWNrOwogICAgICAgIExvZ1JlZ2lzdGVyZWRJbnRlcnZhbChsYXN0VXBkYXRlLCBpbnRlcnZhbER1cmF0aW9uKTsgICAgICAgIAogICAgfQp9Cgpjb250cmFjdCBSZWZ1bmRWYXVsdCBpcyBPd25hYmxlIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgZW51bSBTdGF0ZSB7IEFjdGl2ZSwgUmVmdW5kaW5nLCBDbG9zZWQgfQoKICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBkZXBvc2l0ZWQ7CiAgYWRkcmVzcyBwdWJsaWMgd2FsbGV0OwogIFN0YXRlIHB1YmxpYyBzdGF0ZTsKCiAgZXZlbnQgQ2xvc2VkKCk7CiAgZXZlbnQgUmVmdW5kc0VuYWJsZWQoKTsKICBldmVudCBSZWZ1bmRlZChhZGRyZXNzIGluZGV4ZWQgYmVuZWZpY2lhcnksIHVpbnQyNTYgd2VpQW1vdW50KTsKCiAgZnVuY3Rpb24gUmVmdW5kVmF1bHQoYWRkcmVzcyBfd2FsbGV0KSB7CiAgICByZXF1aXJlKF93YWxsZXQgIT0gMHgwKTsKICAgIHdhbGxldCA9IF93YWxsZXQ7CiAgICBzdGF0ZSA9IFN0YXRlLkFjdGl2ZTsKICB9CgogIGZ1bmN0aW9uIGRlcG9zaXQoYWRkcmVzcyBpbnZlc3Rvcikgb25seU93bmVyIHB1YmxpYyBwYXlhYmxlIHsKICAgIHJlcXVpcmUoc3RhdGUgPT0gU3RhdGUuQWN0aXZlKTsKICAgIGRlcG9zaXRlZFtpbnZlc3Rvcl0gPSBkZXBvc2l0ZWRbaW52ZXN0b3JdLmFkZChtc2cudmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gY2xvc2UoKSBvbmx5T3duZXIgewogICAgcmVxdWlyZShzdGF0ZSA9PSBTdGF0ZS5BY3RpdmUpOwogICAgc3RhdGUgPSBTdGF0ZS5DbG9zZWQ7CiAgICBDbG9zZWQoKTsKICAgIHdhbGxldC50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwogIH0KCiAgZnVuY3Rpb24gZW5hYmxlUmVmdW5kcygpIG9ubHlPd25lciB7CiAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLkFjdGl2ZSk7CiAgICBzdGF0ZSA9IFN0YXRlLlJlZnVuZGluZzsKICAgIFJlZnVuZHNFbmFibGVkKCk7CiAgfQoKICBmdW5jdGlvbiByZWZ1bmQoYWRkcmVzcyBpbnZlc3RvcikgcHVibGljIHsKICAgIHJlcXVpcmUoc3RhdGUgPT0gU3RhdGUuUmVmdW5kaW5nKTsKICAgIHVpbnQyNTYgZGVwb3NpdGVkVmFsdWUgPSBkZXBvc2l0ZWRbaW52ZXN0b3JdOwogICAgZGVwb3NpdGVkW2ludmVzdG9yXSA9IDA7CiAgICBpbnZlc3Rvci50cmFuc2ZlcihkZXBvc2l0ZWRWYWx1ZSk7CiAgICBSZWZ1bmRlZChpbnZlc3RvciwgZGVwb3NpdGVkVmFsdWUpOwogIH0KfQoKY29udHJhY3QgTGVnYWxUR0UgaXMgT3duYWJsZSwgUGF1c2FibGUgewogIC8qKgogICogVGhlIHNhZmUgbWF0aCBsaWJyYXJ5IGZvciBzYWZldHkgbWF0aCBvcGVydGF0aW9ucyBwcm92aWRlZCBieSBaZXBwZWxpbgogICovCiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CiAgLyoqIFN0YXRlIG1hY2hpbmUKICAgKiAtIFByZXBhcmVQcmVDb250cmlidXRpb246IER1cmluZyB0aGlzIHBoYXNlIFNtYXJ0T25lIGFkanVzdCBjb252ZXJzaW9uUmF0ZSBhbmQgc3RhcnQvZW5kIGRhdGUKICAgKiAtIFByZUNvbnRyaWJ1dGlvbjogRHVyaW5nIHRoaXMgcGhhc2Ugb25seSByZWdpc3RlcmVkIHVzZXJzIGNhbiBjb250cmlidXRlIHRvIHRoZSBUR0UgYW5kIHRoZXJlZm9yZSByZWNlaXZlIGEgYm9udXMgdW50aWwgY2FwIG9yIGVuZCBkYXRlIGlzIHJlYWNoZWQKICAgKiAtIFByZXBhcmVDb250cmlidXRpb246IER1cmluZyB0aGlzIHBoYXNlIFNtYXJ0T25lIGFkanVzdHMgY29udmVyc2lvblJhdGUgYnkgdGhlIEVUSFVTRCBkZXByZWNpYXRpb24gZHVyaW5nIFByZUNvbnRyaWJ1dGlvbiBhbmQgY2hhbmdlIHN0YXJ0IGFuZCBlbmQgZGF0ZSBpbiBjYXNlIG9mIGFuIHVuZm9yc2VlbiBldmVudCAKICAgKiAtIENvbnRyaWJ1dGlvbjogRHVyaW5nIHRoaXMgYWxsIHVzZXJzIGNhbiBjb250cmlidXRlIHVudGlsIGNhcCBvciBlbmQgZGF0ZSBpcyByZWFjaGVkCiAgICogLSBBdWRpdGluZzogU21hcnRPbmUgYXdhaXRzIHJlY29tbWVuZGF0aW9uIGJ5IGF1ZGl0b3IgYW5kIGJvYXJkIG9mIGZvdW5kYXRpb24gd2lsbCB0aGVuIGZpbmFsaXplIGNvbnRyaWJ1dGlvbiBvciBlbmFibGUgcmVmdW5kaW5nCiAgICogLSBGaW5hbGl6ZWQ6IFRva2VuIGFyZSByZWxlYXNlZAogICAqIC0gUmVmdW5kaW5nOiBSZWZ1bmRzIGNhbiBiZSBjbGFpbWVkCiAgICovCiAgZW51bSBTdGF0ZXN7UHJlcGFyZVByZUNvbnRyaWJ1dGlvbiwgUHJlQ29udHJpYnV0aW9uLCBQcmVwYXJlQ29udHJpYnV0aW9uLCBDb250cmlidXRpb24sIEF1ZGl0aW5nLCBGaW5hbGl6ZWQsIFJlZnVuZGluZ30KCiAgZW51bSBWZXJpZmljYXRpb25MZXZlbCB7IE5vbmUsIFNNU1ZlcmlmaWVkLCBLWUNWZXJpZmllZCB9CgogLyoqCiAgKiBXaGVuZXZlciB0aGUgc3RhdGUgb2YgdGhlIGNvbnRyYWN0IGNoYW5nZXMsIHRoaXMgZXZlbnQgd2lsbCBiZSBmaXJlZC4KICAqLwogIGV2ZW50IExvZ1N0YXRlQ2hhbmdlKFN0YXRlcyBfc3RhdGVzKTsKCgogIC8qKgogICogVGhpcyBldmVudCBpcyBmaXJlZCB3aGVuIGEgdXNlciBoYXMgYmVlbiBzdWNjZXNzZnVsbHkgdmVyaWZpZWQgYnkgdGhlIGV4dGVybmFsIEtZQyB2ZXJpZmljYXRpb24gcHJvY2VzcwogICovCiAgZXZlbnQgTG9nS1lDQ29uZmlybWF0aW9uKGFkZHJlc3Mgc2VuZGVyKTsKCiAgLyoqCiAgKiBXaGVuZXZlciBhIGxlZ2FsVG9rZW4gaXMgYXNzaWduZWQgdG8gdGhpcyBjb250cmFjdCwgdGhpcyBldmVudCB3aWxsIGJlIGZpcmVkLgogICovCiAgZXZlbnQgTG9nVG9rZW5Bc3NpZ25lZChhZGRyZXNzIHNlbmRlciwgYWRkcmVzcyBuZXdUb2tlbik7CgogIC8qKgogICogRXZlcnkgdGltZWQgdHJhbnNpdGlvbiBtdXN0IGJlIGxvZ2VkIGZvciBhdWRpdGluZyAKICAqLwogIGV2ZW50IExvZ1RpbWVkVHJhbnNpdGlvbih1aW50IF9ub3csIFN0YXRlcyBfbmV3U3RhdGUpOwogIAogIC8qKgogICogVGhpcyBldmVudCBpcyBmaXJlZCB3aGVuIFByZUNvbnRyaWJ1dGlvbiBkYXRhIGlzIGNoYW5nZWQgZHVyaW5nIHRoZSBQcmVwYXJlUHJlQ29udHJpYnV0aW9uIHBoYXNlCiAgKi8KICBldmVudCBMb2dQcmVwYXJlUHJlQ29udHJpYnV0aW9uKGFkZHJlc3Mgc2VuZGVyLCB1aW50IGNvbnZlcnNpb25SYXRlLCB1aW50IHN0YXJ0RGF0ZSwgdWludCBlbmREYXRlKTsKCiAgLyoqCiAgKiBBIHVzZXIgaGFzIHRyYW5zZmVyZWQgRXRoZXIgYW5kIHJlY2VpdmVkIHVucmVsZWFzZWFkIHRva2VucyBpbiByZXR1cm4KICAqLwogIGV2ZW50IExvZ0NvbnRyaWJ1dGlvbihhZGRyZXNzIGNvbnRyaWJ1dG9yLCB1aW50MjU2IHdlaUFtb3VudCwgdWludDI1NiB0b2tlbkFtb3VudCwgVmVyaWZpY2F0aW9uTGV2ZWwgdmVyaWZpY2F0aW9uTGV2ZWwsIFN0YXRlcyBfc3RhdGUpOwoKICAvKioKICAqIFRoaXMgZXZlbnQgd2lsbCBiZSBmaXJlZCB3aGVuIFNtYXJ0T25lIGZpbmFsaXplcyB0aGUgVEdFIAogICovCiAgZXZlbnQgTG9nRmluYWxpemVkKGFkZHJlc3Mgc2VuZGVyKTsKCiAgLyoqCiAgKiBUaGlzIGV2ZW50IHdpbGwgYmUgZmlyZWQgd2hlbiB0aGUgYXVkaXRvciBjb25maXJtcyB0aGUgY29uZmlybXMgcmVndWxhcml0eSBjb25maXJtaXR5IAogICovCiAgZXZlbnQgTG9nUmVndWxhcml0eUNvbmZpcm1hdGlvbihhZGRyZXNzIHNlbmRlciwgYm9vbCBfcmVndWxhcml0eSwgYnl0ZXMzMiBfY29tbWVudCk7CiAgCiAgLyoqCiAgKiBUaGlzIGV2ZW50IHdpbGwgYmUgZmlyZWQgd2hlbiByZWZ1bmRpbmcgaXMgZW5hYmxlZCBieSB0aGUgYXVkaXRvciAKICAqLwogIGV2ZW50IExvZ1JlZnVuZHNFbmFibGVkKGFkZHJlc3Mgc2VuZGVyKTsKCiAgLyoqCiAgKiBUaGlzIGV2ZW50IGlzIGZpcmVkIHdoZW4gUHJlQ29udHJpYnV0aW9uIGRhdGEgaXMgY2hhbmdlZCBkdXJpbmcgdGhlIFByZXBhcmVQcmVDb250cmlidXRpb24gcGhhc2UKICAqLwogIGV2ZW50IExvZ1ByZXBhcmVDb250cmlidXRpb24oYWRkcmVzcyBzZW5kZXIsIHVpbnQgY29udmVyc2lvblJhdGUsIHVpbnQgc3RhcnREYXRlLCB1aW50IGVuZERhdGUpOwoKICAvKioKICAqIFRoaXMgcmVmdW5kIHZhdWx0IHVzZWQgdG8gaG9sZCBmdW5kcyB3aGlsZSBUR0UgaXMgcnVubmluZy4KICAqIFVzZXMgdGhlIGRlZmF1bHQgaW1wbGVtZW50YXRpb24gcHJvdmlkZWQgYnkgdGhlIE9wZW5aZXBwZWxpbiBjb21tdW5pdHkuCiAgKi8gCiAgUmVmdW5kVmF1bHQgcHVibGljIHZhdWx0OwoKICAvKioKICAqIERlZmluZXMgdGhlIHN0YXRlIG9mIHRoZSBjb25vdHJpYnV0aW9uIHByb2Nlc3MKICAqLwogIFN0YXRlcyBwdWJsaWMgc3RhdGU7CgogIC8qKgogICogVGhlIHRva2VuIHdlIGFyZSBnaXZpbmcgdGhlIGNvbnRyaWJ1dG9ycyBpbiByZXR1cm4gZm9yIHRoZWlyIGNvbnRyaWJ1dGlvbnMKICAqLyAKICBMZWdhbFRva2VuIHB1YmxpYyB0b2tlbjsKICAKICAvKioKICAqIFRoZSBjb250cmFjdCBwcm92aWRlZCBieSBQYXJpdHkgVGVjaCAoR2F2IFdvb2RzKSB0byB2ZXJpZnkgdGhlIG1vYmlsZSBudW1iZXIgZHVyaW5nIHVzZXIgcmVnaXN0cmF0aW9uCiAgKi8gCiAgUHJvb2ZPZlNNUyBwdWJsaWMgcHJvb2ZPZlNNUzsKCiAgLyoqIAogICogVGhlIGNvbnRyaWJ1dGlvbiAod2VpKSB3aWxsIGJlIGZvcndhcmRlZCB0byB0aGlzIGFkZHJlc3MgYWZ0ZXIgdGhlIHRva2VuIGhhcyBiZWVuIGZpbmFsaXplZCBieSB0aGUgZm91bmRhdGlvbiBib2FyZAogICovCiAgYWRkcmVzcyBwdWJsaWMgbXVsdGlzaWdXYWxsZXQ7CgogIC8qKiAKICAqIE1heGltdW0gYW1vdW50IG9mIHdlaSB0aGlzIFRHRSBjYW4gcmFpc2UuCiAgKi8KICB1aW50MjU2IHB1YmxpYyB0b2tlbkNhcDsKCiAgLyoqIAogICogVGhlIGFtb3VudCBvZiB3ZWkgYSBjb250cmlidXRvciBoYXMgY29udHJpYnV0ZWQuIAogICogVXNlZCB0byBjaGVjayB3aGV0aGVyIHRoZSB0b3RhbCBvZiBjb250cmlidXRpb25zIHBlciB1c2VyIGV4Y2VlZHMgdGhlIG1heCBsaW1pdCAoZGVwZW5kaW5nIG9uIGhpcyB2ZXJpZmljYXRpb24gbGV2ZWwpCiAgKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyB3ZWlQZXJDb250cmlidXRvcjsKCiAgLyoqIAogICogTWluaW11bSBhbW91bnQgb2YgdG9rZW5zIGEgY29udHJpYnV0b3IgaXMgYWJsZSB0byBidXkKICAqLwogIHVpbnQyNTYgcHVibGljIG1pbldlaVBlckNvbnRyaWJ1dG9yOwoKICAvKiogCiAgKiBNYXhpbXVtIGFtb3VudCBvZiB0b2tlbnMgYW4gU01TIHZlcmlmaWVkIHVzZXIgY2FuIGNvbnRyaWJ1dGUuCiAgKi8KICB1aW50MjU2IHB1YmxpYyBtYXhXZWlTTVNWZXJpZmllZDsKCiAgLyoqIAogICogTWF4aW11bSBhbW91bnQgb2YgdG9rZW5zIGFuIG5vbmUtdmVyaWZpZWQgdXNlciBjYW4gY29udHJpYnV0ZS4KICAqLwogIHVpbnQyNTYgcHVibGljIG1heFdlaVVudmVyaWZpZWQ7CgogIC8qIAogICogVGhlIG51bWJlciBvZiB0b2tlbiB1bml0cyBhIGNvbnRyaWJ1dG9yIHJlY2VpdmVzIHBlciBFVEhFUiBkdXJpbmcgcHJlLWNvbnRyaWJ0aW9uIHBoYXNlCiAgKi8gCiAgdWludCBwdWJsaWMgcHJlU2FsZUNvbnZlcnNpb25SYXRlOwoKICAvKiAKICAqIFRoZSBVTklYIHRpbWVzdGFtcCAoaW4gc2Vjb25kcykgZGVmaW5pbmcgd2hlbiB0aGUgcHJlLWNvbnRyaWJ1dGlvbiBwaGFzZSB3aWxsIHN0YXJ0CiAgKi8KICB1aW50IHB1YmxpYyBwcmVTYWxlU3RhcnREYXRlOwoKICAvKiAKICAqIFRoZSBVTklYIHRpbWVzdGFtcCAoaW4gc2Vjb25kcykgZGVmaW5pbmcgd2hlbiB0aGUgVEdFIHdpbGwgZW5kCiAgKi8KICB1aW50IHB1YmxpYyBwcmVTYWxlRW5kRGF0ZTsKCiAgLyogCiAgKiBUaGUgbnVtYmVyIG9mIHRva2VuIHVuaXRzIGEgY29udHJpYnV0b3IgcmVjZWl2ZXMgcGVyIEVUSEVSIGR1cmluZyBjb250cmlidXRpb24gcGhhc2UKICAqLyAKICB1aW50IHB1YmxpYyBzYWxlQ29udmVyc2lvblJhdGU7CgogIC8qIAogICogVGhlIFVOSVggdGltZXN0YW1wIChpbiBzZWNvbmRzKSBkZWZpbmluZyB3aGVuIHRoZSBUR0Ugd2lsbCBzdGFydAogICovCiAgdWludCBwdWJsaWMgc2FsZVN0YXJ0RGF0ZTsKCiAgLyogCiAgKiBUaGUgVU5JWCB0aW1lc3RhbXAgKGluIHNlY29uZHMpIGRlZmluaW5nIHdoZW4gdGhlIFRHRSB3b3VsZCBlbmQgaWYgY2FwIHdpbGwgbm90IGJlIHJlYWNoZWQKICAqLwogIHVpbnQgcHVibGljIHNhbGVFbmREYXRlOwoKICAvKiAKICAqIFRoZSBib251cyBhIHNtcyB2ZXJpZmllZCB1c2VyIHdpbGwgcmVjZWl2ZSBmb3IgYSBjb250cmlidXRpb24gZHVyaW5nIHByZS1jb250cmlidXRpb24gcGhhc2UgaW4gYmFzZSBwb2ludHMKICAqLwogIHVpbnQgcHVibGljIHNtc1ZlcmlmaWVkQm9udXNCcHM7CgogIC8qIAogICogVGhlIGJvbnVzIGEga3ljIHZlcmlmaWVkIHVzZXIgd2lsbCByZWNlaXZlIGZvciBhIGNvbnRyaWJ1dGlvbiBkdXJpbmcgcHJlLWNvbnRyaWJ1dGlvbiBwaGFzZSBpbiBiYXNlIHBvaW50cwogICovCiAgdWludCBwdWJsaWMga3ljVmVyaWZpZWRCb251c0JwczsKCiAgLyoqCiAgKiBUb3RhbCBwZXJjZW50IG9mIHRva2VucyBtaW50ZWQgdG8gdGhlIHRlYW0gYXQgdGhlIGVuZCBvZiB0aGUgc2FsZSBhcyBiYXNlIHBvaW50cwogICogMUJQIC0+IDAuMDElCiAgKi8KICB1aW50IHB1YmxpYyBtYXhUZWFtQm9udXNCcHM7CgogIC8qKgogICogT25seSB0aGUgZm91bmRhdGlvbiBib2FyZCBpcyBhYmxlIHRvIGZpbmFsaXplIHRoZSBUR0UuCiAgKiBUd28gb2YgZm91ciBtZW1iZXJzIGhhdmUgdG8gY29uZmlybSB0aGUgZmluYWxpemF0aW9uLiBUaGVyZWZvcmUgYSBtdWx0aXNpZyBjb250cmFjdCBpcyB1c2VkLgogICovCiAgYWRkcmVzcyBwdWJsaWMgZm91bmRhdGlvbkJvYXJkOwoKICAvKioKICAqIE9ubHkgdGhlIEtZQyBjb25maXJtYXRpb24gYWNjb3VudCBpcyBhbGxvd2VkIHRvIGNvbmZpcm0gYSBzdWNjZXNzZnVsbCBLWUMgdmVyaWZpY2F0aW9uCiAgKi8KICBhZGRyZXNzIHB1YmxpYyBreWNDb25maXJtZXI7CgogIC8qKgogICogT25jZSB0aGUgY29udHJpYnV0aW9uIGhhcyBlbmRlZCBhbiBhdWRpdG9yIHdpbGwgdmVyaWZ5IHdoZXRoZXIgYWxsIHJlZ3VsYXRpb25zIGhhdmUgYmVlbiBmdWxsZmlsbGVkCiAgKi8KICBhZGRyZXNzIHB1YmxpYyBhdWRpdG9yOwoKICAvKioKICAqIFRoZSB0b2tlbnMgZm9yIHRoZSBpbnNpdHV0aW9uYWwgaW52ZXN0b3JzIHdpbGwgYmUgYWxsb2NhdGVkIHRvIHRoaXMgd2FsbGV0CiAgKi8KICBhZGRyZXNzIHB1YmxpYyBpbnN0Q29udFdhbGxldDsKCiAgLyoqCiAgKiBUaGlzIGZsYWcgaXN0IHNldCBieSBhdWRpdG9yIGJlZm9yZSBmaW5hbGl6aW5nIHRoZSBUR0UgdG8gaW5kaWNhdGUgd2hldGhlciBhbGwgcmVndWFsdGlvbnMgaGF2ZSBiZWVuIGZ1bGZpbGxlZAogICovCiAgYm9vbCBwdWJsaWMgcmVndWxhdGlvbnNGdWxmaWxsZWQ7CgogIC8qKgogICogVGhlIGF1ZGl0b3IgY2FuIGNvbW1lbnQgdGhlIGNvbmZpcm1hdGlvbiAoZS5nLiBpbiBjYXNlIG9mIGRldmlhdGlvbnMpCiAgKi8KICBieXRlczMyIHB1YmxpYyBhdWRpdG9yQ29tbWVudDsKCiAgLyoqCiAgKiBUaGUgdG90YWwgbnVtYmVyIG9mIGluc3RpdHV0aW9uYWwgYW5kIHB1YmxpYyB0b2tlbnMgc29sZCBkdXJpbmcgcHJlLSBhbmQgY29udHJpYnV0aW9uIHBoYXNlCiAgKi8KICB1aW50MjU2IHB1YmxpYyB0b2tlbnNTb2xkID0gMDsKCiAgLyoKICAqIFRoZSBudW1iZXIgb2YgdG9rZW5zIHByZSBhbGxvY2F0ZWQgdG8gaW5zaXR1dGlvbmFsIGNvbnRyaWJ1dG9ycwogICovCiAgdWludCBwdWJsaWMgaW5zdENvbnRBbGxvY2F0ZWRUb2tlbnM7CgogIC8qKgogICogVGhlIGFtb3VudCBvZiB3ZWkgdG90YWxseSByYWlzZWQgYnkgdGhlIHB1YmxpYyBUR0UKICAqLwogIHVpbnQyNTYgcHVibGljIHdlaVJhaXNlZCA9IDA7CgogIC8qIAogICogVGhlIGFtb3VudCBvZiB3ZWkgcmFpc2VkIGR1cmluZyB0aGUgcHJlQ29udHJpYnV0aW9uIHBoYXNlIAogICovCiAgdWludDI1NiBwdWJsaWMgcHJlU2FsZVdlaVJhaXNlZCA9IDA7CgogIC8qCiAgKiBIb3cgbXVjaCB3ZWkgd2UgaGF2ZSBnaXZlbiBiYWNrIHRvIGNvbnRyaWJ1dG9ycy4KICAqLwogIHVpbnQyNTYgcHVibGljIHdlaVJlZnVuZGVkID0gMDsKCiAgLyoKICAqIFRoZSBudW1iZXIgb2YgdG9rZW5zIGFsbG9jYXRlZCB0byB0aGUgdGVhbSB3aGVuIHRoZSBUR0Ugd2FzIGZpbmFsaXplZC4KICAqIFRoZSBjYWxjdWxhdGlvbiBpcyBiYXNlZCBvbiB0aGUgcHJlZGVmaW5lZCBtYXhUZWFtQm9udXNCcHMKICAqLwogIHVpbnQgcHVibGljIHRlYW1Cb251c0FsbG9jYXRlZFRva2VuczsKCiAgLyoqCiAgKiBUaGUgbnVtYmVyIG9mIGNvbnRyaWJ1dG9ycyB3aGljaCBoYXZlIGNvbnRyaWJ1dGVkIHRvIHRoZSBUR0UKICAqLwogIHVpbnQgcHVibGljIG51bWJlck9mQ29udHJpYnV0b3JzID0gMDsKCiAgLyoqCiAgKiBkaWN0aW9uYXJ5IHRoYXQgbWFwcyBhZGRyZXNzZXMgdG8gY29udHJpYnV0b3JzIHdoaWNoIGhhdmUgc3VjZXNzZnVsbHkgYmVlbiB2ZXJpZmllZCBieSB0aGUgZXh0ZXJuYWwgS1lDIHByb2Nlc3MgCiAgKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBreWNSZWdpc3RlcmVkQ29udHJpYnV0b3JzOwoKICBzdHJ1Y3QgVGVhbUJvbnVzIHsKICAgIGFkZHJlc3MgdG9BZGRyZXNzOwogICAgdWludDY0IHRva2VuQnBzOwogICAgdWludDY0IGNsaWZmRGF0ZTsKICAgIHVpbnQ2NCB2ZXN0aW5nRGF0ZTsKICB9CgogIC8qCiAgKiBEZWZpbmVzIHRoZSBwZXJjZW50YWdlIChiYXNlIHBvaW50cykgZGlzdHJpYnV0aW9uIG9mIHRoZSB0ZWFtLWFsbG9jYXRlZCBib251cyByZXdhcmRzIGFtb25nIG1lbWJlcnMgd2hpY2ggd2lsbCBiZSB2ZXN0ZWQgLi4KICAqIDEgQnAgLT4gMC4wMSUKICAqLwogIFRlYW1Cb251c1tdIHB1YmxpYyB0ZWFtQm9udXNlczsKCiAgLyoqCiAgICogQGRldiBDaGVjayB3aGV0aGVyIHRoZSBUR0UgaXMgY3VycmVudGx5IGluIHRoZSBzdGF0ZSBwcm92aWRlZAogICAqLwoKIGZ1bmN0aW9uIExlZ2FsVEdFIChhZGRyZXNzIF9mb3VuZGF0aW9uQm9hcmQsIGFkZHJlc3MgX211bHRpc2lnV2FsbGV0LCBhZGRyZXNzIF9pbnN0Q29udFdhbGxldCwgdWludDI1NiBfaW5zdENvbnRBbGxvY2F0ZWRUb2tlbnMsIHVpbnQyNTYgX3Rva2VuQ2FwLCB1aW50MjU2IF9zbXNWZXJpZmllZEJvbnVzQnBzLCB1aW50MjU2IF9reWNWZXJpZmllZEJvbnVzQnBzLCB1aW50MjU2IF9tYXhUZWFtQm9udXNCcHMsIGFkZHJlc3MgX2F1ZGl0b3IsIGFkZHJlc3MgX2t5Y0NvbmZpcm1lciwgUHJvb2ZPZlNNUyBfcHJvb2ZPZlNNUywgUmVmdW5kVmF1bHQgX3ZhdWx0KSB7CiAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIC0tIFZhbGlkYXRlIGFsbCB2YXJpYWJsZXMgd2hpY2ggYXJlIG5vdCBwYXNzZWQgdG8gdGhlIGNvbnN0cnVjdG9yIGZpcnN0CiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gdGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgdXNlZCBmb3IgYXVkaXRpbmcKICAgIHJlcXVpcmUoX2ZvdW5kYXRpb25Cb2FyZCAhPSAweDApOwogICAgCiAgICAvLyB0aGUgYWRkcmVzcyBvZiB0aGUgbXVsdGlzaWcgbXVzdCBub3QgYmUgJ3VuZGVmaW5lZCcKICAgIHJlcXVpcmUoX211bHRpc2lnV2FsbGV0ICE9IDB4MCk7CgogICAgLy8gdGhlIGFkZHJlc3Mgb2YgdGhlIHdhbGxldCBmb3IgY29uc3RpdHV0aW9uYWwgY29udHJpYnV0b3JzIG11c3Qgbm90IGJlICd1bmRlZmluZWQnCiAgICByZXF1aXJlKF9pbnN0Q29udFdhbGxldCAhPSAweDApOwoKICAgIC8vIHRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IHVzZWQgZm9yIGF1ZGl0aW5nCiAgICByZXF1aXJlKF9hdWRpdG9yICE9IDB4MCk7CiAgICAKICAgIC8vIHRoZSBhZGRyZXNzIG9mIHRoZSBjYXAgZm9yIHRoaXMgVEdFIG11c3Qgbm90IGJlICd1bmRlZmluZWQnCiAgICByZXF1aXJlKF90b2tlbkNhcCA+IDApOyAKCiAgICAvLyBwcmUtY29udHJpYnV0aW9uIGFuZCBjb250cmlidXRpb24gcGhhc2VzIG11c3Qgbm90IG92ZXJsYXAKICAgIC8vIHJlcXVpcmUoX3ByZVNhbGVTdGFydERhdGUgPD0gX3ByZVNhbGVFbmREYXRlKTsKCiAgICBtdWx0aXNpZ1dhbGxldCA9IF9tdWx0aXNpZ1dhbGxldDsKICAgIGluc3RDb250V2FsbGV0ID0gX2luc3RDb250V2FsbGV0OwogICAgaW5zdENvbnRBbGxvY2F0ZWRUb2tlbnMgPSBfaW5zdENvbnRBbGxvY2F0ZWRUb2tlbnM7CiAgICB0b2tlbkNhcCA9IF90b2tlbkNhcDsKICAgIHNtc1ZlcmlmaWVkQm9udXNCcHMgPSBfc21zVmVyaWZpZWRCb251c0JwczsKICAgIGt5Y1ZlcmlmaWVkQm9udXNCcHMgPSBfa3ljVmVyaWZpZWRCb251c0JwczsKICAgIG1heFRlYW1Cb251c0JwcyA9IF9tYXhUZWFtQm9udXNCcHM7CiAgICBhdWRpdG9yID0gX2F1ZGl0b3I7CiAgICBmb3VuZGF0aW9uQm9hcmQgPSBfZm91bmRhdGlvbkJvYXJkOwogICAga3ljQ29uZmlybWVyID0gX2t5Y0NvbmZpcm1lcjsKICAgIHByb29mT2ZTTVMgPSBfcHJvb2ZPZlNNUzsKCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gLS0gSW5pdGlhbGl6ZSBhbGwgdmFyaWFibGVzIHdoaWNoIGFyZSBub3QgcGFzc2VkIHRvIHRoZSBjb25zdHJ1Y3RvciBmaXJzdAogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIHN0YXRlID0gU3RhdGVzLlByZXBhcmVQcmVDb250cmlidXRpb247CiAgICB2YXVsdCA9IF92YXVsdDsKICB9CgogIC8qKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICogQWxsIGxvZ2ljIHJlbGF0ZWQgdG8gdGhlIFRHRSBjb250cmlidXRpb24gaXMgY3VycmVudGx5IHBsYWNlZCBiZWxvdy4KICAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovCgogIGZ1bmN0aW9uIHNldE1heFdlaUZvclZlcmlmaWNhdGlvbkxldmVscyh1aW50IF9taW5XZWlQZXJDb250cmlidXRvciwgdWludCBfbWF4V2VpVW52ZXJpZmllZCwgdWludCAgX21heFdlaVNNU1ZlcmlmaWVkKSBwdWJsaWMgb25seU93bmVyIGluU3RhdGUoU3RhdGVzLlByZXBhcmVQcmVDb250cmlidXRpb24pIHsKICAgIHJlcXVpcmUoX21pbldlaVBlckNvbnRyaWJ1dG9yID49IDApOwogICAgcmVxdWlyZShfbWF4V2VpVW52ZXJpZmllZCA+IF9taW5XZWlQZXJDb250cmlidXRvcik7CiAgICByZXF1aXJlKF9tYXhXZWlTTVNWZXJpZmllZCA+IF9taW5XZWlQZXJDb250cmlidXRvcik7CgogICAgLy8gdGhlIG1pbmltdW0gbnVtYmVyIG9mIHdlaSBhbiB1bnZlcmlmaWVkIHVzZXIgY2FuIGNvbnRyaWJ1dGUKICAgIG1pbldlaVBlckNvbnRyaWJ1dG9yID0gX21pbldlaVBlckNvbnRyaWJ1dG9yOwoKICAgIC8vIHRoZSBtYXhpbXVtIG51bWJlciBvZiB3ZWkgYW4gdW52ZXJpZmllZCB1c2VyIGNhbiBjb250cmlidXRlCiAgICBtYXhXZWlVbnZlcmlmaWVkID0gX21heFdlaVVudmVyaWZpZWQ7CgogICAgLy8gdGhlIG1heGltdW0gbnVtYmVyIG9mIHdlaSBhbiBTTVMgdmVyaWZpZWQgdXNlciBjYW4gY29udHJpYnV0ZSAgICAKICAgIG1heFdlaVNNU1ZlcmlmaWVkID0gX21heFdlaVNNU1ZlcmlmaWVkOwogIH0KCiAgZnVuY3Rpb24gc2V0TGVnYWxUb2tlbihMZWdhbFRva2VuIF9sZWdhbFRva2VuKSBwdWJsaWMgb25seU93bmVyIGluU3RhdGUoU3RhdGVzLlByZXBhcmVQcmVDb250cmlidXRpb24pIHsKICAgIHRva2VuID0gX2xlZ2FsVG9rZW47CiAgICBpZiAoIGluc3RDb250QWxsb2NhdGVkVG9rZW5zID4gMCApIHsKICAgICAgLy8gbWludCB0aGUgcHJlIGFsbG9jYXRlZCB0b2tlbnMgZm9yIHRoZSBpbnN0aXR1dGlvbmFsIGludmVzdG9ycwogICAgICB0b2tlbi5taW50KGluc3RDb250V2FsbGV0LCBpbnN0Q29udEFsbG9jYXRlZFRva2Vucyk7CiAgICAgIHRva2Vuc1NvbGQgKz0gaW5zdENvbnRBbGxvY2F0ZWRUb2tlbnM7CiAgICB9ICAgIAogICAgTG9nVG9rZW5Bc3NpZ25lZChtc2cuc2VuZGVyLCBfbGVnYWxUb2tlbik7CiAgfQoKICBmdW5jdGlvbiB2YWxpZGF0ZVByZUNvbnRyaWJ1dGlvbih1aW50IF9wcmVTYWxlQ29udmVyc2lvblJhdGUsIHVpbnQgX3ByZVNhbGVTdGFydERhdGUsIHVpbnQgX3ByZVNhbGVFbmREYXRlKSBjb25zdGFudCBpbnRlcm5hbCB7CiAgICAvLyB0aGUgcHJlLWNvbnRyaWJ1dGlvbiBjb252ZXJzaW9uIHJhdGUgbXVzdCBub3QgYmUgJ3VuZGVmaW5lZCcKICAgIHJlcXVpcmUoX3ByZVNhbGVDb252ZXJzaW9uUmF0ZSA+PSAwKTsKCiAgICAvLyB0aGUgcHJlLWNvbnRyaWJ1dGlvbiBzdGFydCBkYXRlIG11c3Qgbm90IGJlIGluIHRoZSBwYXN0CiAgICByZXF1aXJlKF9wcmVTYWxlU3RhcnREYXRlID49IG5vdyk7CgogICAgLy8gdGhlIHByZS1jb250cmlidXRpb24gc3RhcnQgZGF0ZSBtdXN0IG5vdCBiZSBpbiB0aGUgcGFzdAogICAgcmVxdWlyZShfcHJlU2FsZUVuZERhdGUgPj0gX3ByZVNhbGVTdGFydERhdGUpOwogIH0KCiAgZnVuY3Rpb24gdmFsaWRhdGVDb250cmlidXRpb24odWludCBfc2FsZUNvbnZlcnNpb25SYXRlLCB1aW50IF9zYWxlU3RhcnREYXRlLCB1aW50IF9zYWxlRW5kRGF0ZSkgY29uc3RhbnQgaW50ZXJuYWwgewogICAgLy8gdGhlIGNvbnRyaWJ1dGlvbiBjb252ZXJzaW9uIHJhdGUgbXVzdCBub3QgYmUgJ3VuZGVmaW5lZCcKICAgIHJlcXVpcmUoX3NhbGVDb252ZXJzaW9uUmF0ZSA+PSAwKTsKCiAgICAvLyB0aGUgY29udHJpYnV0aW9uIHN0YXJ0IGRhdGUgbXVzdCBub3QgYmUgaW4gdGhlIHBhc3QKICAgIHJlcXVpcmUoX3NhbGVTdGFydERhdGUgPj0gbm93KTsKCiAgICAvLyB0aGUgY29udHJpYnV0aW9uIGVuZCBkYXRlIG11c3Qgbm90IGJlIGJlZm9yZSBzdGFydCBkYXRlIAogICAgcmVxdWlyZShfc2FsZUVuZERhdGUgPj0gX3NhbGVTdGFydERhdGUpOwogIH0KCiAgZnVuY3Rpb24gaXNOb3dCZWZvcmUodWludCBfZGF0ZSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuICggbm93IDwgX2RhdGUgKTsKICB9CgogIGZ1bmN0aW9uIGV2YWxUcmFuc2l0aW9uU3RhdGUoKSBwdWJsaWMgcmV0dXJucyAoU3RhdGVzKSB7CiAgICAvLyBvbmNlIHRoZSBUR0UgaXMgaW4gc3RhdGUgZmluYWxpemVkIG9yIHJlZnVuZGluZywgdGhlcmUgaXMgbm93IHdheSB0byB0cmFuc2l0IHRvIGFub3RoZXIgc3RhdGUhCiAgICBpZiAoIGhhc1N0YXRlKFN0YXRlcy5GaW5hbGl6ZWQpKQogICAgICByZXR1cm4gU3RhdGVzLkZpbmFsaXplZDsKICAgIGlmICggaGFzU3RhdGUoU3RhdGVzLlJlZnVuZGluZykpCiAgICAgIHJldHVybiBTdGF0ZXMuUmVmdW5kaW5nOwogICAgaWYgKCBpc0NhcFJlYWNoZWQoKSkgCiAgICAgIHJldHVybiBTdGF0ZXMuQXVkaXRpbmc7CiAgICBpZiAoIGlzTm93QmVmb3JlKHByZVNhbGVTdGFydERhdGUpKQogICAgICByZXR1cm4gU3RhdGVzLlByZXBhcmVQcmVDb250cmlidXRpb247IAogICAgaWYgKCBpc05vd0JlZm9yZShwcmVTYWxlRW5kRGF0ZSkpCiAgICAgIHJldHVybiBTdGF0ZXMuUHJlQ29udHJpYnV0aW9uOwogICAgaWYgKCBpc05vd0JlZm9yZShzYWxlU3RhcnREYXRlKSkgIAogICAgICByZXR1cm4gU3RhdGVzLlByZXBhcmVDb250cmlidXRpb247CiAgICBpZiAoIGlzTm93QmVmb3JlKHNhbGVFbmREYXRlKSkgICAgCiAgICAgIHJldHVybiBTdGF0ZXMuQ29udHJpYnV0aW9uOwogICAgcmV0dXJuIFN0YXRlcy5BdWRpdGluZzsKICB9CgogIG1vZGlmaWVyIHN0YXRlVHJhbnNpdGlvbnMoKSB7CiAgICBTdGF0ZXMgZXZhbHVhdGVkU3RhdGUgPSBldmFsVHJhbnNpdGlvblN0YXRlKCk7CiAgICBzZXRTdGF0ZShldmFsdWF0ZWRTdGF0ZSk7CiAgICBfOwogIH0KCiAgZnVuY3Rpb24gaGFzU3RhdGUoU3RhdGVzIF9zdGF0ZSkgY29uc3RhbnQgcHJpdmF0ZSByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gKHN0YXRlID09IF9zdGF0ZSk7CiAgfQoKICBmdW5jdGlvbiBzZXRTdGF0ZShTdGF0ZXMgX3N0YXRlKSBwcml2YXRlIHsKICAJaWYgKCBfc3RhdGUgIT0gc3RhdGUgKSB7CiAgICAgIHN0YXRlID0gX3N0YXRlOwoJICBMb2dTdGF0ZUNoYW5nZShzdGF0ZSk7CgkgIH0KICB9CgogIG1vZGlmaWVyIGluU3RhdGUoU3RhdGVzICBfc3RhdGUpIHsKICAgIHJlcXVpcmUoaGFzU3RhdGUoX3N0YXRlKSk7CiAgICBfOwogIH0KCiAgZnVuY3Rpb24gdXBkYXRlU3RhdGUoKSBwdWJsaWMgc3RhdGVUcmFuc2l0aW9ucyB7CiAgfSAgCiAgCiAgLyoqCiAgICogQGRldiBDaGVja3Mgd2hldGhlciBjb250cmFjdCBpcyBpbiBhIHN0YXRlIGluIHdoaWNoIGNvbnRyaWJ1dGlvbnMgd2lsbCBiZSBhY2NlcHRlZAogICAqLwogIG1vZGlmaWVyIGluUHJlT3JDb250cmlidXRpb25TdGF0ZSgpIHsKICAgIHJlcXVpcmUoaGFzU3RhdGUoU3RhdGVzLlByZUNvbnRyaWJ1dGlvbikgfHwgKGhhc1N0YXRlKFN0YXRlcy5Db250cmlidXRpb24pKSk7CiAgICBfOwogIH0KICBtb2RpZmllciBpblByZVByZXBhcmVPclByZUNvbnRyaWJ1dGlvblN0YXRlKCkgewogICAgcmVxdWlyZShoYXNTdGF0ZShTdGF0ZXMuUHJlcGFyZVByZUNvbnRyaWJ1dGlvbikgfHwgKGhhc1N0YXRlKFN0YXRlcy5QcmVDb250cmlidXRpb24pKSk7CiAgICBfOwogIH0KCiAgbW9kaWZpZXIgaW5QcmVwYXJlU3RhdGUoKSB7CiAgICAvLyB3ZSBjYW4gcmVsYXkgb24gc3RhdGUgc2luY2UgbW9kaWZlciBzaW5jZSBhbHJlYWR5IGV2YWx1YXRlZCBieSBzdGF0ZVRyYW5zaXRpb25zIG1vZGlmaWVyCiAgICByZXF1aXJlKGhhc1N0YXRlKFN0YXRlcy5QcmVwYXJlUHJlQ29udHJpYnV0aW9uKSB8fCAoaGFzU3RhdGUoU3RhdGVzLlByZXBhcmVDb250cmlidXRpb24pKSk7CiAgICBfOwogIH0KICAvKiogCiAgKiBUaGlzIG1vZGlmaWVyIG1ha2VzIHN1cmUgdGhhdCBub3QgbW9yZSB0b2tlbnMgYXMgc3BlY2lmaWVkIGNhbiBiZSBhbGxvY2F0ZWQKICAqLwogIG1vZGlmaWVyIHRlYW1Cb251c0xpbWl0KHVpbnQ2NCBfdG9rZW5CcHMpIHsKICAgIHVpbnQgdGVhbUJvbnVzQnBzID0gMDsgCiAgICBmb3IgKCB1aW50IGkgPSAwOyBpIDwgdGVhbUJvbnVzZXMubGVuZ3RoOyBpKysgKSB7CiAgICAgIHRlYW1Cb251c0JwcyA9IHRlYW1Cb251c0Jwcy5hZGQodGVhbUJvbnVzZXNbaV0udG9rZW5CcHMpOwogICAgfQogICAgcmVxdWlyZShtYXhUZWFtQm9udXNCcHMgPj0gdGVhbUJvbnVzQnBzKTsKICAgIF87CiAgfQoKICAvKioKICAqIEFsbG9jYXRlcyB0aGUgdGVhbSBib251cyB3aXRoIGEgc3BlY2lmaWMgdmVzdGluZyBydWxlCiAgKi8KICBmdW5jdGlvbiBhbGxvY2F0ZVRlYW1Cb251cyhhZGRyZXNzIF90b0FkZHJlc3MsIHVpbnQ2NCBfdG9rZW5CcHMsIHVpbnQ2NCBfY2xpZmZEYXRlLCB1aW50NjQgX3Zlc3RpbmdEYXRlKSBwdWJsaWMgb25seU93bmVyIHRlYW1Cb251c0xpbWl0KF90b2tlbkJwcykgaW5TdGF0ZShTdGF0ZXMuUHJlcGFyZVByZUNvbnRyaWJ1dGlvbikgewogICAgdGVhbUJvbnVzZXMucHVzaChUZWFtQm9udXMoX3RvQWRkcmVzcywgX3Rva2VuQnBzLCBfY2xpZmZEYXRlLCBfdmVzdGluZ0RhdGUpKTsKICB9CgogIC8qKgogICogVGhpcyBtZXRob2QgY2FuIG9wdGlvbmFsIGJlIGNhbGxlZCBieSB0aGUgb3duZXIgdG8gYWRqdXN0IHRoZSBjb252ZXJzaW9uUmF0ZSwgc3RhcnREYXRlIGFuZCBlbmREYXRlIGJlZm9yZSBjb250cmlidXRpb24gcGhhc2Ugc3RhcnRzLgogICogUHJlLWNvbmRpdGlvbnM6CiAgKiAtIENhbGxlciBpcyBvd25lciAoZGVwbG95ZXIpCiAgKiAtIFRHRSBpcyBpbiBzdGF0ZSBQcmVDb250cmlidXRpb24KICAqIFBvc3QtY29uZGl0aW9uczoKICAqLwogIGZ1bmN0aW9uIHByZXBhcmVQcmVDb250cmlidXRpb24odWludCBfcHJlU2FsZUNvbnZlcnNpb25SYXRlLCB1aW50IF9wcmVTYWxlU3RhcnREYXRlLCB1aW50IF9wcmVTYWxlRW5kRGF0ZSkgcHVibGljIG9ubHlPd25lciBpblN0YXRlKFN0YXRlcy5QcmVwYXJlUHJlQ29udHJpYnV0aW9uKSB7CiAgICB2YWxpZGF0ZVByZUNvbnRyaWJ1dGlvbihfcHJlU2FsZUNvbnZlcnNpb25SYXRlLCBfcHJlU2FsZVN0YXJ0RGF0ZSwgX3ByZVNhbGVFbmREYXRlKTsgICAgCiAgICBwcmVTYWxlQ29udmVyc2lvblJhdGUgPSBfcHJlU2FsZUNvbnZlcnNpb25SYXRlOwogICAgcHJlU2FsZVN0YXJ0RGF0ZSA9IF9wcmVTYWxlU3RhcnREYXRlOwogICAgcHJlU2FsZUVuZERhdGUgPSBfcHJlU2FsZUVuZERhdGU7CiAgICBMb2dQcmVwYXJlUHJlQ29udHJpYnV0aW9uKG1zZy5zZW5kZXIsIHByZVNhbGVDb252ZXJzaW9uUmF0ZSwgcHJlU2FsZVN0YXJ0RGF0ZSwgcHJlU2FsZUVuZERhdGUpOwogIH0KCiAgLyoqCiAgKiBUaGlzIG1ldGhvZCBjYW4gb3B0aW9uYWwgYmUgY2FsbGVkIGJ5IHRoZSBvd25lciB0byBhZGp1c3QgdGhlIGNvbnZlcnNpb25SYXRlLCBzdGFydERhdGUgYW5kIGVuZERhdGUgYmVmb3JlIHByZSBjb250cmlidXRpb24gcGhhc2Ugc3RhcnRzLgogICogUHJlLWNvbmRpdGlvbnM6CiAgKiAtIENhbGxlciBpcyBvd25lciAoZGVwbG95ZXIpCiAgKiAtIENyb3dkc2FsZSBpcyBpbiBzdGF0ZSBQcmVwYXJlUHJlQ29udHJpYnV0aW9uCiAgKiBQb3N0LWNvbmRpdGlvbnM6CiAgKi8KICBmdW5jdGlvbiBwcmVwYXJlQ29udHJpYnV0aW9uKHVpbnQgX3NhbGVDb252ZXJzaW9uUmF0ZSwgdWludCBfc2FsZVN0YXJ0RGF0ZSwgdWludCBfc2FsZUVuZERhdGUpIHB1YmxpYyBvbmx5T3duZXIgaW5QcmVwYXJlU3RhdGUgewogICAgdmFsaWRhdGVDb250cmlidXRpb24oX3NhbGVDb252ZXJzaW9uUmF0ZSwgX3NhbGVTdGFydERhdGUsIF9zYWxlRW5kRGF0ZSk7CiAgICBzYWxlQ29udmVyc2lvblJhdGUgPSBfc2FsZUNvbnZlcnNpb25SYXRlOwogICAgc2FsZVN0YXJ0RGF0ZSA9IF9zYWxlU3RhcnREYXRlOwogICAgc2FsZUVuZERhdGUgPSBfc2FsZUVuZERhdGU7CgogICAgTG9nUHJlcGFyZUNvbnRyaWJ1dGlvbihtc2cuc2VuZGVyLCBzYWxlQ29udmVyc2lvblJhdGUsIHNhbGVTdGFydERhdGUsIHNhbGVFbmREYXRlKTsKICB9CgogIC8vIGZhbGxiYWNrIGZ1bmN0aW9uIGNhbiBiZSB1c2VkIHRvIGJ1eSB0b2tlbnMKICBmdW5jdGlvbiAoKSBwYXlhYmxlIHB1YmxpYyB7CiAgICBjb250cmlidXRlKCk7ICAKICB9CiAgZnVuY3Rpb24gZ2V0V2VpUGVyQ29udHJpYnV0b3IoYWRkcmVzcyBfY29udHJpYnV0b3IpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgCXJldHVybiB3ZWlQZXJDb250cmlidXRvcltfY29udHJpYnV0b3JdOwogIH0KCiAgZnVuY3Rpb24gY29udHJpYnV0ZSgpIHdoZW5Ob3RQYXVzZWQgc3RhdGVUcmFuc2l0aW9ucyBpblByZU9yQ29udHJpYnV0aW9uU3RhdGUgcHVibGljIHBheWFibGUgewogICAgcmVxdWlyZShtc2cuc2VuZGVyICE9IDB4MCk7CiAgICByZXF1aXJlKG1zZy52YWx1ZSA+PSBtaW5XZWlQZXJDb250cmlidXRvcik7CgogICAgVmVyaWZpY2F0aW9uTGV2ZWwgdmVyaWZpY2F0aW9uTGV2ZWwgPSBnZXRWZXJpZmljYXRpb25MZXZlbCgpOwogICAgCiAgICAvLyB3ZSBvbmx5IGFsbG93IHZlcmlmaWVkIHVzZXJzIHRvIHBhcnRpY2lwYXRlIGR1cmluZyBwcmUtY29udHJpYnV0aW9uIHBoYXNlCiAgICByZXF1aXJlKGhhc1N0YXRlKFN0YXRlcy5Db250cmlidXRpb24pIHx8IHZlcmlmaWNhdGlvbkxldmVsID4gVmVyaWZpY2F0aW9uTGV2ZWwuTm9uZSk7CgogICAgLy8gd2UgbmVlZCB0byBrZWVwIHRyYWNrIG9mIGFsbCBjb250cmlidXRpb25zIHBlciB1c2VyIHRvIGxpbWl0IHRvdGFsIGNvbnRyaWJ1dGlvbnMKICAgIHdlaVBlckNvbnRyaWJ1dG9yW21zZy5zZW5kZXJdID0gd2VpUGVyQ29udHJpYnV0b3JbbXNnLnNlbmRlcl0uYWRkKG1zZy52YWx1ZSk7CgogICAgLy8gdGhlIHRvdGFsIGFtb3VudCBvZiBFVEggYSBLWUMgdmVyaWZpZWQgdXNlciBjYW4gY29udHJpYnV0ZSBpcyB1bmxpbWl0ZWQsIHNvIHdlIGRvIG5vdCBuZWVkIHRvIGNoZWNrCgogICAgaWYgKCB2ZXJpZmljYXRpb25MZXZlbCA9PSBWZXJpZmljYXRpb25MZXZlbC5TTVNWZXJpZmllZCApIHsKICAgICAgLy8gdGhlIHRvdGFsIGFtb3VudCBvZiBFVEggYSBub24tS1lDIHVzZXIgY2FuIGNvbnRyaWJ1dGUgaXMgbGltaXRlZCB0byBtYXhXZWlQZXJDb250cmlidXRvcgogICAgICByZXF1aXJlKHdlaVBlckNvbnRyaWJ1dG9yW21zZy5zZW5kZXJdIDw9IG1heFdlaVNNU1ZlcmlmaWVkKTsKICAgIH0KCiAgICBpZiAoIHZlcmlmaWNhdGlvbkxldmVsID09IFZlcmlmaWNhdGlvbkxldmVsLk5vbmUgKSB7CiAgICAgIC8vIHRoZSB0b3RhbCBhbW91bnQgb2YgRVRIIGEgbm9uLXZlcmlmaWVkIHVzZXIgY2FuIGNvbnRyaWJ1dGUgaXMgbGltaXRlZCB0byBtYXhXZWlVbnZlcmlmaWVkCiAgICAgIHJlcXVpcmUod2VpUGVyQ29udHJpYnV0b3JbbXNnLnNlbmRlcl0gPD0gbWF4V2VpVW52ZXJpZmllZCk7CiAgICB9CgogICAgaWYgKGhhc1N0YXRlKFN0YXRlcy5QcmVDb250cmlidXRpb24pKSB7CiAgICAgIHByZVNhbGVXZWlSYWlzZWQgPSBwcmVTYWxlV2VpUmFpc2VkLmFkZChtc2cudmFsdWUpOwogICAgfQoKICAgIHdlaVJhaXNlZCA9IHdlaVJhaXNlZC5hZGQobXNnLnZhbHVlKTsKCiAgICAvLyBjYWxjdWxhdGUgdGhlIHRva2VuIGFtb3VudCB0byBiZSBjcmVhdGVkCiAgICB1aW50MjU2IHRva2VuQW1vdW50ID0gY2FsY3VsYXRlVG9rZW5BbW91bnQobXNnLnZhbHVlLCB2ZXJpZmljYXRpb25MZXZlbCk7CgogICAgdG9rZW5zU29sZCA9IHRva2Vuc1NvbGQuYWRkKHRva2VuQW1vdW50KTsKCiAgICBpZiAoIHRva2VuLmJhbGFuY2VPZihtc2cuc2VuZGVyKSA9PSAwICkgewogICAgICAgbnVtYmVyT2ZDb250cmlidXRvcnMrKzsKICAgIH0KCiAgICBpZiAoIGlzQ2FwUmVhY2hlZCgpKSB7CiAgICAgIHVwZGF0ZVN0YXRlKCk7CiAgICB9CgogICAgdG9rZW4ubWludChtc2cuc2VuZGVyLCB0b2tlbkFtb3VudCk7CgogICAgZm9yd2FyZEZ1bmRzKCk7CgogICAgTG9nQ29udHJpYnV0aW9uKG1zZy5zZW5kZXIsIG1zZy52YWx1ZSwgdG9rZW5BbW91bnQsIHZlcmlmaWNhdGlvbkxldmVsLCBzdGF0ZSk7ICAgIAogIH0KCiAKICBmdW5jdGlvbiBjYWxjdWxhdGVUb2tlbkFtb3VudCh1aW50MjU2IF93ZWlBbW91bnQsIFZlcmlmaWNhdGlvbkxldmVsIF92ZXJpZmljYXRpb25MZXZlbCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgY29udmVyc2lvblJhdGUgPSBzYWxlQ29udmVyc2lvblJhdGU7CiAgICBpZiAoIHN0YXRlID09IFN0YXRlcy5QcmVDb250cmlidXRpb24pIHsKICAgICAgY29udmVyc2lvblJhdGUgPSBwcmVTYWxlQ29udmVyc2lvblJhdGU7CiAgICB9CiAgICB1aW50MjU2IHRva2VuQW1vdW50ID0gX3dlaUFtb3VudC5tdWwoY29udmVyc2lvblJhdGUpOwogICAgCiAgICAvLyBhbiBhbm9ueW1vdXMgdXNlciAoTGV2ZWwtMCkgZ2V0cyBubyBib251cwogICAgdWludDI1NiBib251c1Rva2VuQW1vdW50ID0gMDsKCiAgICBpZiAoIF92ZXJpZmljYXRpb25MZXZlbCA9PSBWZXJpZmljYXRpb25MZXZlbC5TTVNWZXJpZmllZCApIHsKICAgICAgLy8gYSBTTVMgdmVyaWZpZWQgdXNlciAoTGV2ZWwtMSkgZ2V0cyBhIGJvbnVzCiAgICAgIGJvbnVzVG9rZW5BbW91bnQgPSB0b2tlbkFtb3VudC5tdWwoc21zVmVyaWZpZWRCb251c0JwcykuZGl2KDEwMDAwKTsKICAgIH0gZWxzZSBpZiAoIF92ZXJpZmljYXRpb25MZXZlbCA9PSBWZXJpZmljYXRpb25MZXZlbC5LWUNWZXJpZmllZCApIHsKICAgICAgLy8gYSBLWUMgdmVyaWZpZWQgdXNlciAoTGV2ZWwtMikgZ2V0cyB0aGUgaGlnaGVzdCBib251cwogICAgICBib251c1Rva2VuQW1vdW50ID0gdG9rZW5BbW91bnQubXVsKGt5Y1ZlcmlmaWVkQm9udXNCcHMpLmRpdigxMDAwMCk7CiAgICB9CiAgICByZXR1cm4gdG9rZW5BbW91bnQuYWRkKGJvbnVzVG9rZW5BbW91bnQpOwogIH0KCiAgZnVuY3Rpb24gZ2V0VmVyaWZpY2F0aW9uTGV2ZWwoKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAoVmVyaWZpY2F0aW9uTGV2ZWwpIHsKICAgIGlmIChreWNSZWdpc3RlcmVkQ29udHJpYnV0b3JzW21zZy5zZW5kZXJdKSB7CiAgICAgIHJldHVybiBWZXJpZmljYXRpb25MZXZlbC5LWUNWZXJpZmllZDsKICAgIH0gZWxzZSBpZiAocHJvb2ZPZlNNUy5jZXJ0aWZpZWQobXNnLnNlbmRlcikpIHsKICAgICAgcmV0dXJuIFZlcmlmaWNhdGlvbkxldmVsLlNNU1ZlcmlmaWVkOwogICAgfQogICAgcmV0dXJuIFZlcmlmaWNhdGlvbkxldmVsLk5vbmU7CiAgfQoKICBtb2RpZmllciBvbmx5S3ljQ29uZmlybWVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGt5Y0NvbmZpcm1lcik7CiAgICBfOwogIH0KCiAgZnVuY3Rpb24gY29uZmlybUtZQyhhZGRyZXNzIGFkZHJlc3NJZCkgb25seUt5Y0NvbmZpcm1lciBpblByZVByZXBhcmVPclByZUNvbnRyaWJ1dGlvblN0YXRlKCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIExvZ0tZQ0NvbmZpcm1hdGlvbihtc2cuc2VuZGVyKTsKICAgIHJldHVybiBreWNSZWdpc3RlcmVkQ29udHJpYnV0b3JzW2FkZHJlc3NJZF0gPSB0cnVlOwogIH0KCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIEFsbCBmdW5jdGlvbnMgcmVsYXRlZCB0byB0aGUgVEdFIGNhcCBjb21lIGhlcmUKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICBmdW5jdGlvbiBpc0NhcFJlYWNoZWQoKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICBpZiAodG9rZW5zU29sZCA+PSB0b2tlbkNhcCkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CgovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBFdmVyeXRoaW5nIHdoaWNoIGlzIHJlbGF0ZWQgdG9mIHRoZSBhdWRpdGluZyBwcm9jZXNzIGNvbWVzIGhlcmUuCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIGZvdW5kYXRpb24gYm9hcmQKICAgKi8KICBtb2RpZmllciBvbmx5Rm91bmRhdGlvbkJvYXJkKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGZvdW5kYXRpb25Cb2FyZCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIGF1ZGl0b3IuCiAgICovCiAgbW9kaWZpZXIgb25seUF1ZGl0b3IoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYXVkaXRvcik7CiAgICBfOwogIH0KICAKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBhdWRpdG9yIGhhcyBub3QgeWV0IGNvbmZpcm1lZCBUR0UKICAgKi8KICBtb2RpZmllciBhdWRpdG9yQ29uZmlybWVkKCkgewogICAgcmVxdWlyZShhdWRpdG9yQ29tbWVudCAhPSAweDApOwogICAgXzsKICB9CgogLyoKICogQWZ0ZXIgdGhlIFRHRSByZWFjaGVzIHN0YXRlICdhdWRpdGluZycsIHRoZSBhdWRpdG9yIHdpbGwgdmVyaWZ5IHRoZSBsZWdhbCBhbmQgcmVndWxhdG9yeSBvYmxpZ2F0aW9ucyAKICovCiBmdW5jdGlvbiBjb25maXJtTGF3ZnVsbmVzcyhib29sIF9yZWd1bGF0aW9uc0Z1bGZpbGxlZCwgYnl0ZXMzMiBfYXVkaXRvckNvbW1lbnQpIHB1YmxpYyBvbmx5QXVkaXRvciBzdGF0ZVRyYW5zaXRpb25zIGluU3RhdGUgKCBTdGF0ZXMuQXVkaXRpbmcgKSB7CiAgICByZWd1bGF0aW9uc0Z1bGZpbGxlZCA9IF9yZWd1bGF0aW9uc0Z1bGZpbGxlZDsKICAgIGF1ZGl0b3JDb21tZW50ID0gX2F1ZGl0b3JDb21tZW50OwogICAgTG9nUmVndWxhcml0eUNvbmZpcm1hdGlvbihtc2cuc2VuZGVyLCBfcmVndWxhdGlvbnNGdWxmaWxsZWQsIF9hdWRpdG9yQ29tbWVudCk7CiAgfQoKICAvKioKICAgKiBBZnRlciB0aGUgYXVkaXRvciBoYXMgdmVyaWZpZWQgdGhlIHRoZSBsZWdhbCBhbmQgcmVndWxhdG9yeSBvYmxpZ2F0aW9ucyBvZiB0aGUgVEdFLCB0aGUgZm91bmRhdGlvbiBib2FyZCBpcyBhYmxlIHRvIGZpbmFsaXplIHRoZSBUR0UuCiAgICogVGhlIGZpbmFsaXphdGlvbiBjb25zaXN0cyBvZiB0aGUgZm9sbG93aW5nIHN0ZXBzOgogICAqIC0gVHJhbnNpdCBzdGF0ZQogICAqIC0gY2xvc2UgdGhlIFJlZnVuZFZhdWx0IGFuZCB0cmFuc2ZlciBmdW5kcyB0byB0aGUgZm91bmRhdGlvbiB3YWxsZXQKICAgKiAtIHJlbGVhc2UgdG9rZW5zIChtYWtlIHRyYW5zZmVyYWJsZSkKICAgKiAtIGVuYWJsZSBzY2hlZHVsZXIgZm9yIHRoZSBpbmZsYXRpb24gY29tcGVuc2F0aW9uCiAgICogLSBNaW4gdGhlIGRlZmluZWQgYW1vdW50IG9mIHRva2VuIHBlciB0ZWFtIGFuZCBtYWtlIHRoZW0gdmVzdGFibGUKICAgKi8KICBmdW5jdGlvbiBmaW5hbGl6ZSgpIHB1YmxpYyBvbmx5Rm91bmRhdGlvbkJvYXJkIHN0YXRlVHJhbnNpdGlvbnMgaW5TdGF0ZSAoIFN0YXRlcy5BdWRpdGluZyApIGF1ZGl0b3JDb25maXJtZWQgewogICAgc2V0U3RhdGUoU3RhdGVzLkZpbmFsaXplZCk7CiAgICAvLyBNYWtlIHRva2VuIHRyYW5zZmVyYWJsZSBvdGhlcndpc2UgdGhlIHRyYW5zZmVyIGNhbGwgdXNlZCB3aGVuIGdyYW50aW5nIHZlc3RpbmcgdG8gdGVhbXMgd2lsbCBiZSByZWplY3RlZC4KICAgIHRva2VuLnJlbGVhc2VUb2tlblRyYW5zZmVyKCk7CiAgICAKICAgIC8vIG1pbnQgYm9udXN1cyBmb3IgCiAgICBhbGxvY2F0ZVRlYW1Cb251c1Rva2VucygpOwoKICAgIC8vIHRoZSBmdW5kcyBjYW4gbm93IGJlIHRyYW5zZmVyZWQgdG8gdGhlIG11bHRpc2lnIHdhbGxldCBvZiB0aGUgZm91bmRhdGlvbgogICAgdmF1bHQuY2xvc2UoKTsKCiAgICAvLyBkaXNhYmxlIG1pbnRpbmcgZm9yIHRoZSBUR0UgKHRob3VnaCB0b2tlbnMgd2lsbCBzdGlsbCBiZSBtaW50ZWQgdG8gY29tcGVuc2F0ZSBhbiBpbmZsYXRpb24gcGVyaW9kKSAKICAgIHRva2VuLmZpbmlzaE1pbnRpbmcoKTsKCiAgICAvLyBub3cgd2UgY2FuIHNhZmVseSBlbmFibGUgdGhlIHNoY2VkdWxlciBmb3IgaW5mbGF0aW9uIGNvbXBlbnNhdGlvbgogICAgdG9rZW4uZW5hYmxlU2NoZWR1bGVyKCk7CgogICAgLy8gcGFzcyBvd25lcnNoaXAgZnJvbSBjb250cmFjdCB0byBTbWFydE9uZQogICAgdG9rZW4udHJhbnNmZXJPd25lcnNoaXAob3duZXIpOwoKICAgIExvZ0ZpbmFsaXplZChtc2cuc2VuZGVyKTsKICB9CgogIGZ1bmN0aW9uIGVuYWJsZVJlZnVuZHMoKSBwdWJsaWMgb25seUZvdW5kYXRpb25Cb2FyZCBzdGF0ZVRyYW5zaXRpb25zIGluU3RhdGUgKCBTdGF0ZXMuQXVkaXRpbmcgKSBhdWRpdG9yQ29uZmlybWVkIHsKICAgIHNldFN0YXRlKFN0YXRlcy5SZWZ1bmRpbmcpOwoKICAgIExvZ1JlZnVuZHNFbmFibGVkKG1zZy5zZW5kZXIpOwoKICAgIC8vIG5vIG5lZWQgdG8gdHJpZ2dlciBldmVudCBoZXJlIHNpbmNlIHRoaXMgYWxscmVhZHkgZG9uZSBpbiBSZWZ1bmRWYXVsdCAoc2VlIGV2ZW50IFJlZnVuZHNFbmFibGVkKSAKICAgIHZhdWx0LmVuYWJsZVJlZnVuZHMoKTsgCiAgfQogIAoKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gUG9zdGFsbG9jYXRpb24gUmV3YXJkIFRva2VucwovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogIAogIC8qKiAKICAqIENhbGxlZCBvbmNlIGJ5IFRHRSBmaW5hbGl6ZSgpIGlmIHRoZSBzYWxlIHdhcyBzdWNjZXNzLgogICovCiAgZnVuY3Rpb24gYWxsb2NhdGVUZWFtQm9udXNUb2tlbnMoKSBwcml2YXRlIHsKCiAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCB0ZWFtQm9udXNlcy5sZW5ndGg7IGkrKykgewogICAgICAvLyBIb3cgbWFueSAlIG9mIHRva2VucyB0aGUgdGVhbSBtZW1iZXIgcmVjZWl2ZSBhcyByZXdhcmRzCiAgICAgIHVpbnQgX3RlYW1Cb251c1Rva2VucyA9ICh0b2tlbnNTb2xkLm11bCh0ZWFtQm9udXNlc1tpXS50b2tlbkJwcykpLmRpdigxMDAwMCk7CgogICAgICAvLyBtaW50IG5ldyB0b2tlbnMgZm9yIGNvbnRyaWJ1dG9ycwogICAgICB0b2tlbi5taW50KHRoaXMsIF90ZWFtQm9udXNUb2tlbnMpOwogICAgICB0b2tlbi5ncmFudFZlc3RlZFRva2Vucyh0ZWFtQm9udXNlc1tpXS50b0FkZHJlc3MsIF90ZWFtQm9udXNUb2tlbnMsIHVpbnQ2NChub3cpLCB0ZWFtQm9udXNlc1tpXS5jbGlmZkRhdGUsIHRlYW1Cb251c2VzW2ldLnZlc3RpbmdEYXRlLCBmYWxzZSwgZmFsc2UpOwogICAgICB0ZWFtQm9udXNBbGxvY2F0ZWRUb2tlbnMgPSB0ZWFtQm9udXNBbGxvY2F0ZWRUb2tlbnMuYWRkKF90ZWFtQm9udXNUb2tlbnMpOwogICAgfQogIH0KCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAvLyBBbGwgZnVuY3Rpb25zIHJlbGF0ZWQgdG8gUmVmdW5kaW5nIGNhbiBiZSBmb3VuZCBoZXJlLiAKICAvLyBVc2VzIHNvbWUgc2xpZ2h0bHkgbW9kaWZlZCBsb2dpYyBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9PcGVuWmVwcGVsaW4vemVwcGVsaW4tc29saWRpdHkvYmxvYi9tYXN0ZXIvY29udHJhY3RzL2Nyb3dkc2FsZS9SZWZ1bmRhYmxlVEdFLnNvbAogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgogIC8qKiBXZSdyZSBvdmVycmlkaW5nIHRoZSBmdW5kIGZvcndhcmRpbmcgZnJvbSBUR0UuCiAgKiBJbiBhZGRpdGlvbiB0byBzZW5kaW5nIHRoZSBmdW5kcywgd2Ugd2FudCB0byBjYWxsCiAgKiB0aGUgUmVmdW5kVmF1bHQgZGVwb3NpdCBmdW5jdGlvbgogICovCiAgZnVuY3Rpb24gZm9yd2FyZEZ1bmRzKCkgaW50ZXJuYWwgewogICAgdmF1bHQuZGVwb3NpdC52YWx1ZShtc2cudmFsdWUpKG1zZy5zZW5kZXIpOwogIH0KCiAgLyoqCiAgKiBJZiBUR0Ugd2FzIG5vdCBzdWNjZXNzZnVsbCByZWZ1bmRpbmcgcHJvY2VzcyB3aWxsIGJlIHJlbGVhc2VkIGJ5IFNtYXJ0T25lCiAgKi8KICBmdW5jdGlvbiBjbGFpbVJlZnVuZCgpIHB1YmxpYyBzdGF0ZVRyYW5zaXRpb25zIGluU3RhdGUgKCBTdGF0ZXMuUmVmdW5kaW5nICkgewogICAgLy8gd29ya2Fyb3VuZCBzaW5jZSB2YXVsdCByZWZ1bmQgZG9lcyBub3QgcmV0dXJuIHJlZnVuZCB2YWx1ZQogICAgd2VpUmVmdW5kZWQgPSB3ZWlSZWZ1bmRlZC5hZGQodmF1bHQuZGVwb3NpdGVkKG1zZy5zZW5kZXIpKTsKICAgIHZhdWx0LnJlZnVuZChtc2cuc2VuZGVyKTsKICB9Cn0KCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKfQoKY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwp9Cgpjb250cmFjdCBCYXNpY1Rva2VuIGlzIEVSQzIwQmFzaWMgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CgogIC8qKgogICogQGRldiB0cmFuc2ZlciB0b2tlbiBmb3IgYSBzcGVjaWZpZWQgYWRkcmVzcwogICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0by4KICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCB0byBiZSB0cmFuc2ZlcnJlZC4KICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwoKICAgIC8vIFNhZmVNYXRoLnN1YiB3aWxsIHRocm93IGlmIHRoZXJlIGlzIG5vdCBlbm91Z2ggYmFsYW5jZS4KICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgKiBAZGV2IEdldHMgdGhlIGJhbGFuY2Ugb2YgdGhlIHNwZWNpZmllZCBhZGRyZXNzLgogICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0byBxdWVyeSB0aGUgdGhlIGJhbGFuY2Ugb2YuCiAgKiBAcmV0dXJuIEFuIHVpbnQyNTYgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb3duZWQgYnkgdGhlIHBhc3NlZCBhZGRyZXNzLgogICovCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICB9Cgp9Cgpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEVSQzIwLCBCYXNpY1Rva2VuIHsKCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwoKCiAgLyoqCiAgICogQGRldiBUcmFuc2ZlciB0b2tlbnMgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyCiAgICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gc2VuZCB0b2tlbnMgZnJvbQogICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAqIEBwYXJhbSBfdmFsdWUgdWludDI1NiB0aGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKCiAgICB1aW50MjU2IF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsKCiAgICAvLyBDaGVjayBpcyBub3QgbmVlZGVkIGJlY2F1c2Ugc3ViKF9hbGxvd2FuY2UsIF92YWx1ZSkgd2lsbCBhbHJlYWR5IHRocm93IGlmIHRoaXMgY29uZGl0aW9uIGlzIG5vdCBtZXQKICAgIC8vIHJlcXVpcmUgKF92YWx1ZSA8PSBfYWxsb3dhbmNlKTsKCiAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gX2FsbG93YW5jZS5zdWIoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgQXBwcm92ZSB0aGUgcGFzc2VkIGFkZHJlc3MgdG8gc3BlbmQgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIG9uIGJlaGFsZiBvZiBtc2cuc2VuZGVyLgogICAqCiAgICogQmV3YXJlIHRoYXQgY2hhbmdpbmcgYW4gYWxsb3dhbmNlIHdpdGggdGhpcyBtZXRob2QgYnJpbmdzIHRoZSByaXNrIHRoYXQgc29tZW9uZSBtYXkgdXNlIGJvdGggdGhlIG9sZAogICAqIGFuZCB0aGUgbmV3IGFsbG93YW5jZSBieSB1bmZvcnR1bmF0ZSB0cmFuc2FjdGlvbiBvcmRlcmluZy4gT25lIHBvc3NpYmxlIHNvbHV0aW9uIHRvIG1pdGlnYXRlIHRoaXMKICAgKiByYWNlIGNvbmRpdGlvbiBpcyB0byBmaXJzdCByZWR1Y2UgdGhlIHNwZW5kZXIncyBhbGxvd2FuY2UgdG8gMCBhbmQgc2V0IHRoZSBkZXNpcmVkIHZhbHVlIGFmdGVyd2FyZHM6CiAgICogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAgKi8KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBjaGVjayB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAqIEBwYXJhbSBfb3duZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCBvd25zIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3NwZW5kZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcmV0dXJuIEEgdWludDI1NiBzcGVjaWZ5aW5nIHRoZSBhbW91bnQgb2YgdG9rZW5zIHN0aWxsIGF2YWlsYWJsZSBmb3IgdGhlIHNwZW5kZXIuCiAgICovCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogIH0KCiAgLyoqCiAgICogYXBwcm92ZSBzaG91bGQgYmUgY2FsbGVkIHdoZW4gYWxsb3dlZFtfc3BlbmRlcl0gPT0gMC4gVG8gaW5jcmVtZW50CiAgICogYWxsb3dlZCB2YWx1ZSBpcyBiZXR0ZXIgdG8gdXNlIHRoaXMgZnVuY3Rpb24gdG8gYXZvaWQgMiBjYWxscyAoYW5kIHdhaXQgdW50aWwKICAgKiB0aGUgZmlyc3QgdHJhbnNhY3Rpb24gaXMgbWluZWQpCiAgICogRnJvbSBNb25vbGl0aERBTyBUb2tlbi5zb2wKICAgKi8KICBmdW5jdGlvbiBpbmNyZWFzZUFwcHJvdmFsIChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hZGRlZFZhbHVlKQogICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdLmFkZChfYWRkZWRWYWx1ZSk7CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiBkZWNyZWFzZUFwcHJvdmFsIChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9zdWJ0cmFjdGVkVmFsdWUpCiAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIHVpbnQgb2xkVmFsdWUgPSBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXTsKICAgIGlmIChfc3VidHJhY3RlZFZhbHVlID4gb2xkVmFsdWUpIHsKICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSAwOwogICAgfSBlbHNlIHsKICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBvbGRWYWx1ZS5zdWIoX3N1YnRyYWN0ZWRWYWx1ZSk7CiAgICB9CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgcmV0dXJuIHRydWU7CiAgfQoKfQoKY29udHJhY3QgTWludGFibGVUb2tlbiBpcyBTdGFuZGFyZFRva2VuLCBPd25hYmxlIHsKICBldmVudCBNaW50KGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiBhbW91bnQpOwogIGV2ZW50IE1pbnRGaW5pc2hlZCgpOwoKICBib29sIHB1YmxpYyBtaW50aW5nRmluaXNoZWQgPSBmYWxzZTsKCgogIG1vZGlmaWVyIGNhbk1pbnQoKSB7CiAgICByZXF1aXJlKCFtaW50aW5nRmluaXNoZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gbWludCB0b2tlbnMKICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCByZWNlaXZlIHRoZSBtaW50ZWQgdG9rZW5zLgogICAqIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIG1pbnQuCiAgICogQHJldHVybiBBIGJvb2xlYW4gdGhhdCBpbmRpY2F0ZXMgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bC4KICAgKi8KICBmdW5jdGlvbiBtaW50KGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIG9ubHlPd25lciBjYW5NaW50IHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LmFkZChfYW1vdW50KTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfYW1vdW50KTsKICAgIE1pbnQoX3RvLCBfYW1vdW50KTsKICAgIFRyYW5zZmVyKDB4MCwgX3RvLCBfYW1vdW50KTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBzdG9wIG1pbnRpbmcgbmV3IHRva2Vucy4KICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bC4KICAgKi8KICBmdW5jdGlvbiBmaW5pc2hNaW50aW5nKCkgb25seU93bmVyIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBtaW50aW5nRmluaXNoZWQgPSB0cnVlOwogICAgTWludEZpbmlzaGVkKCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KCmNvbnRyYWN0IExpbWl0ZWRUcmFuc2ZlclRva2VuIGlzIEVSQzIwIHsKCiAgLyoqCiAgICogQGRldiBDaGVja3Mgd2hldGhlciBpdCBjYW4gdHJhbnNmZXIgb3Igb3RoZXJ3aXNlIHRocm93cy4KICAgKi8KICBtb2RpZmllciBjYW5UcmFuc2ZlcihhZGRyZXNzIF9zZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSB7CiAgICByZXF1aXJlKF92YWx1ZSA8PSB0cmFuc2ZlcmFibGVUb2tlbnMoX3NlbmRlciwgdWludDY0KG5vdykpKTsKICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgQ2hlY2tzIG1vZGlmaWVyIGFuZCBhbGxvd3MgdHJhbnNmZXIgaWYgdG9rZW5zIGFyZSBub3QgbG9ja2VkLgogICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHJlY2VpdmUgdGhlIHRva2Vucy4KICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgY2FuVHJhbnNmZXIobXNnLnNlbmRlciwgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyKF90bywgX3ZhbHVlKTsKICB9CgogIC8qKgogICogQGRldiBDaGVja3MgbW9kaWZpZXIgYW5kIGFsbG93cyB0cmFuc2ZlciBpZiB0b2tlbnMgYXJlIG5vdCBsb2NrZWQuCiAgKiBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHNlbmQgdGhlIHRva2Vucy4KICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHJlY2VpdmUgdGhlIHRva2Vucy4KICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQuCiAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBjYW5UcmFuc2ZlcihfZnJvbSwgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogIH0KCiAgLyoqCiAgICogQGRldiBEZWZhdWx0IHRyYW5zZmVyYWJsZSB0b2tlbnMgZnVuY3Rpb24gcmV0dXJucyBhbGwgdG9rZW5zIGZvciBhIGhvbGRlciAobm8gbGltaXQpLgogICAqIEBkZXYgT3ZlcndyaXRpbmcgdHJhbnNmZXJhYmxlVG9rZW5zKGFkZHJlc3MgaG9sZGVyLCB1aW50NjQgdGltZSkgaXMgdGhlIHdheSB0byBwcm92aWRlIHRoZQogICAqIHNwZWNpZmljIGxvZ2ljIGZvciBsaW1pdGluZyB0b2tlbiB0cmFuc2ZlcmFiaWxpdHkgZm9yIGEgaG9sZGVyIG92ZXIgdGltZS4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcmFibGVUb2tlbnMoYWRkcmVzcyBob2xkZXIsIHVpbnQ2NCB0aW1lKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGJhbGFuY2VPZihob2xkZXIpOwogIH0KfQoKY29udHJhY3QgVmVzdGVkVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiwgTGltaXRlZFRyYW5zZmVyVG9rZW4sIE93bmFibGUgewoKICB1aW50MjU2IE1BWF9HUkFOVFNfUEVSX0FERFJFU1MgPSAyMDsKCiAgc3RydWN0IFRva2VuR3JhbnQgewogICAgYWRkcmVzcyBncmFudGVyOyAgICAgLy8gMjAgYnl0ZXMKICAgIHVpbnQyNTYgdmFsdWU7ICAgICAgIC8vIDMyIGJ5dGVzCiAgICB1aW50NjQgY2xpZmY7CiAgICB1aW50NjQgdmVzdGluZzsKICAgIHVpbnQ2NCBzdGFydDsgICAgICAgIC8vIDMgKiA4ID0gMjQgYnl0ZXMKICAgIGJvb2wgcmV2b2thYmxlOwogICAgYm9vbCBidXJuc09uUmV2b2tlOyAgLy8gMiAqIDEgPSAyIGJpdHM/IG9yIDIgYnl0ZXM/CiAgfSAvLyB0b3RhbCA3OCBieXRlcyA9IDMgc3N0b3JlIHBlciBvcGVyYXRpb24gKDMyIHBlciBzc3RvcmUpCgogIG1hcHBpbmcgKGFkZHJlc3MgPT4gVG9rZW5HcmFudFtdKSBwdWJsaWMgZ3JhbnRzOwoKICBldmVudCBOZXdUb2tlbkdyYW50KGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgZ3JhbnRJZCk7CgogIC8qKgogICAqIEBkZXYgR3JhbnQgdG9rZW5zIHRvIGEgc3BlY2lmaWVkIGFkZHJlc3MKICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggdGhlIHRva2VucyB3aWxsIGJlIGdyYW50ZWQgdG8uCiAgICogQHBhcmFtIF92YWx1ZSB1aW50MjU2IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGdyYW50ZWQuCiAgICogQHBhcmFtIF9zdGFydCB1aW50NjQgVGltZSBvZiB0aGUgYmVnaW5uaW5nIG9mIHRoZSBncmFudC4KICAgKiBAcGFyYW0gX2NsaWZmIHVpbnQ2NCBUaW1lIG9mIHRoZSBjbGlmZiBwZXJpb2QuCiAgICogQHBhcmFtIF92ZXN0aW5nIHVpbnQ2NCBUaGUgdmVzdGluZyBwZXJpb2QuCiAgICovCiAgZnVuY3Rpb24gZ3JhbnRWZXN0ZWRUb2tlbnMoCiAgICBhZGRyZXNzIF90bywKICAgIHVpbnQyNTYgX3ZhbHVlLAogICAgdWludDY0IF9zdGFydCwKICAgIHVpbnQ2NCBfY2xpZmYsCiAgICB1aW50NjQgX3Zlc3RpbmcsCiAgICBib29sIF9yZXZva2FibGUsCiAgICBib29sIF9idXJuc09uUmV2b2tlCiAgKSBvbmx5T3duZXIgcHVibGljIHsKCiAgICAvLyBDaGVjayBmb3IgZGF0ZSBpbmNvbnNpc3RlbmNpZXMgdGhhdCBtYXkgY2F1c2UgdW5leHBlY3RlZCBiZWhhdmlvcgogICAgcmVxdWlyZShfY2xpZmYgPj0gX3N0YXJ0ICYmIF92ZXN0aW5nID49IF9jbGlmZik7CgogICAgcmVxdWlyZSh0b2tlbkdyYW50c0NvdW50KF90bykgPCBNQVhfR1JBTlRTX1BFUl9BRERSRVNTKTsgICAvLyBUbyBwcmV2ZW50IGEgdXNlciBiZWluZyBzcGFtbWVkIGFuZCBoYXZlIGhpcyBiYWxhbmNlIGxvY2tlZCAob3V0IG9mIGdhcyBhdHRhY2sgd2hlbiBjYWxjdWxhdGluZyB2ZXN0aW5nKS4KCiAgICB1aW50MjU2IGNvdW50ID0gZ3JhbnRzW190b10ucHVzaCgKICAgICAgICAgICAgICAgIFRva2VuR3JhbnQoCiAgICAgICAgICAgICAgICAgIF9yZXZva2FibGUgPyBtc2cuc2VuZGVyIDogMCwgLy8gYXZvaWQgc3RvcmluZyBhbiBleHRyYSAyMCBieXRlcyB3aGVuIGl0IGlzIG5vbi1yZXZva2FibGUKICAgICAgICAgICAgICAgICAgX3ZhbHVlLAogICAgICAgICAgICAgICAgICBfY2xpZmYsCiAgICAgICAgICAgICAgICAgIF92ZXN0aW5nLAogICAgICAgICAgICAgICAgICBfc3RhcnQsCiAgICAgICAgICAgICAgICAgIF9yZXZva2FibGUsCiAgICAgICAgICAgICAgICAgIF9idXJuc09uUmV2b2tlCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgKTsKCiAgICB0cmFuc2ZlcihfdG8sIF92YWx1ZSk7CgogICAgTmV3VG9rZW5HcmFudChtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSwgY291bnQgLSAxKTsKICB9CgogIC8qKgogICAqIEBkZXYgUmV2b2tlIHRoZSBncmFudCBvZiB0b2tlbnMgb2YgYSBzcGVjaWZlZCBhZGRyZXNzLgogICAqIEBwYXJhbSBfaG9sZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgaGF2ZSBpdHMgdG9rZW5zIHJldm9rZWQuCiAgICogQHBhcmFtIF9ncmFudElkIFRoZSBpZCBvZiB0aGUgdG9rZW4gZ3JhbnQuCiAgICovCiAgZnVuY3Rpb24gcmV2b2tlVG9rZW5HcmFudChhZGRyZXNzIF9ob2xkZXIsIHVpbnQyNTYgX2dyYW50SWQpIHB1YmxpYyB7CiAgICBUb2tlbkdyYW50IHN0b3JhZ2UgZ3JhbnQgPSBncmFudHNbX2hvbGRlcl1bX2dyYW50SWRdOwoKICAgIHJlcXVpcmUoZ3JhbnQucmV2b2thYmxlKTsKICAgIHJlcXVpcmUoZ3JhbnQuZ3JhbnRlciA9PSBtc2cuc2VuZGVyKTsgLy8gT25seSBncmFudGVyIGNhbiByZXZva2UgaXQKCiAgICBhZGRyZXNzIHJlY2VpdmVyID0gZ3JhbnQuYnVybnNPblJldm9rZSA/IDB4ZGVhZCA6IG1zZy5zZW5kZXI7CgogICAgdWludDI1NiBub25WZXN0ZWQgPSBub25WZXN0ZWRUb2tlbnMoZ3JhbnQsIHVpbnQ2NChub3cpKTsKCiAgICAvLyByZW1vdmUgZ3JhbnQgZnJvbSBhcnJheQogICAgZGVsZXRlIGdyYW50c1tfaG9sZGVyXVtfZ3JhbnRJZF07CiAgICBncmFudHNbX2hvbGRlcl1bX2dyYW50SWRdID0gZ3JhbnRzW19ob2xkZXJdW2dyYW50c1tfaG9sZGVyXS5sZW5ndGguc3ViKDEpXTsKICAgIGdyYW50c1tfaG9sZGVyXS5sZW5ndGggLT0gMTsKCiAgICBiYWxhbmNlc1tyZWNlaXZlcl0gPSBiYWxhbmNlc1tyZWNlaXZlcl0uYWRkKG5vblZlc3RlZCk7CiAgICBiYWxhbmNlc1tfaG9sZGVyXSA9IGJhbGFuY2VzW19ob2xkZXJdLnN1Yihub25WZXN0ZWQpOwoKICAgIFRyYW5zZmVyKF9ob2xkZXIsIHJlY2VpdmVyLCBub25WZXN0ZWQpOwogIH0KCgogIC8qKgogICAqIEBkZXYgQ2FsY3VsYXRlIHRoZSB0b3RhbCBhbW91bnQgb2YgdHJhbnNmZXJhYmxlIHRva2VucyBvZiBhIGhvbGRlciBhdCBhIGdpdmVuIHRpbWUKICAgKiBAcGFyYW0gaG9sZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgb2YgdGhlIGhvbGRlcgogICAqIEBwYXJhbSB0aW1lIHVpbnQ2NCBUaGUgc3BlY2lmaWMgdGltZS4KICAgKiBAcmV0dXJuIEFuIHVpbnQyNTYgcmVwcmVzZW50aW5nIGEgaG9sZGVyJ3MgdG90YWwgYW1vdW50IG9mIHRyYW5zZmVyYWJsZSB0b2tlbnMuCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJhYmxlVG9rZW5zKGFkZHJlc3MgaG9sZGVyLCB1aW50NjQgdGltZSkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgZ3JhbnRJbmRleCA9IHRva2VuR3JhbnRzQ291bnQoaG9sZGVyKTsKCiAgICBpZiAoZ3JhbnRJbmRleCA9PSAwKSAKICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyYWJsZVRva2Vucyhob2xkZXIsIHRpbWUpOyAvLyBzaG9ydGN1dCBmb3IgaG9sZGVyIHdpdGhvdXQgZ3JhbnRzCgogICAgLy8gSXRlcmF0ZSB0aHJvdWdoIGFsbCB0aGUgZ3JhbnRzIHRoZSBob2xkZXIgaGFzLCBhbmQgYWRkIGFsbCBub24tdmVzdGVkIHRva2VucwogICAgdWludDI1NiBub25WZXN0ZWQgPSAwOwogICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgZ3JhbnRJbmRleDsgaSsrKSB7CiAgICAgIG5vblZlc3RlZCA9IFNhZmVNYXRoLmFkZChub25WZXN0ZWQsIG5vblZlc3RlZFRva2VucyhncmFudHNbaG9sZGVyXVtpXSwgdGltZSkpOwogICAgfQoKICAgIC8vIEJhbGFuY2UgLSB0b3RhbE5vblZlc3RlZCBpcyB0aGUgYW1vdW50IG9mIHRva2VucyBhIGhvbGRlciBjYW4gdHJhbnNmZXIgYXQgYW55IGdpdmVuIHRpbWUKICAgIHVpbnQyNTYgdmVzdGVkVHJhbnNmZXJhYmxlID0gU2FmZU1hdGguc3ViKGJhbGFuY2VPZihob2xkZXIpLCBub25WZXN0ZWQpOwoKICAgIC8vIFJldHVybiB0aGUgbWluaW11bSBvZiBob3cgbWFueSB2ZXN0ZWQgY2FuIHRyYW5zZmVyIGFuZCBvdGhlciB2YWx1ZQogICAgLy8gaW4gY2FzZSB0aGVyZSBhcmUgb3RoZXIgbGltaXRpbmcgdHJhbnNmZXJhYmlsaXR5IGZhY3RvcnMgKGRlZmF1bHQgaXMgYmFsYW5jZU9mKQogICAgcmV0dXJuIE1hdGgubWluMjU2KHZlc3RlZFRyYW5zZmVyYWJsZSwgc3VwZXIudHJhbnNmZXJhYmxlVG9rZW5zKGhvbGRlciwgdGltZSkpOwogIH0KCiAgLyoqCiAgICogQGRldiBDaGVjayB0aGUgYW1vdW50IG9mIGdyYW50cyB0aGF0IGFuIGFkZHJlc3MgaGFzLgogICAqIEBwYXJhbSBfaG9sZGVyIFRoZSBob2xkZXIgb2YgdGhlIGdyYW50cy4KICAgKiBAcmV0dXJuIEEgdWludDI1NiByZXByZXNlbnRpbmcgdGhlIHRvdGFsIGFtb3VudCBvZiBncmFudHMuCiAgICovCiAgZnVuY3Rpb24gdG9rZW5HcmFudHNDb3VudChhZGRyZXNzIF9ob2xkZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGluZGV4KSB7CiAgICByZXR1cm4gZ3JhbnRzW19ob2xkZXJdLmxlbmd0aDsKICB9CgogIC8qKgogICAqIEBkZXYgQ2FsY3VsYXRlIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIGF0IGEgc3BlY2lmaWMgdGltZQogICAqIEBwYXJhbSB0b2tlbnMgdWludDI1NiBUaGUgYW1vdW50IG9mIHRva2VucyBncmFudGVkCiAgICogQHBhcmFtIHRpbWUgdWludDY0IFRoZSB0aW1lIHRvIGJlIGNoZWNrZWQKICAgKiBAcGFyYW0gc3RhcnQgdWludDY0IFRoZSB0aW1lIHJlcHJlc2VudGluZyB0aGUgYmVnaW5uaW5nIG9mIHRoZSBncmFudAogICAqIEBwYXJhbSBjbGlmZiB1aW50NjQgIFRoZSBjbGlmZiBwZXJpb2QsIHRoZSBwZXJpb2QgYmVmb3JlIG5vdGhpbmcgY2FuIGJlIHBhaWQgb3V0CiAgICogQHBhcmFtIHZlc3RpbmcgdWludDY0IFRoZSB2ZXN0aW5nIHBlcmlvZAogICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIG9mIGEgc3BlY2lmaWMgZ3JhbnQKICAgKiAgdHJhbnNmZXJhYmxlVG9rZW5zCiAgICogICB8ICAgICAgICAgICAgICAgICAgICAgICAgIF8vLS0tLS0tLS0gICB2ZXN0ZWRUb2tlbnMgcmVjdAogICAqICAgfCAgICAgICAgICAgICAgICAgICAgICAgXy8KICAgKiAgIHwgICAgICAgICAgICAgICAgICAgICBfLwogICAqICAgfCAgICAgICAgICAgICAgICAgICBfLwogICAqICAgfCAgICAgICAgICAgICAgICAgXy8KICAgKiAgIHwgICAgICAgICAgICAgICAgLwogICAqICAgfCAgICAgICAgICAgICAgLnwKICAgKiAgIHwgICAgICAgICAgICAuICB8CiAgICogICB8ICAgICAgICAgIC4gICAgfAogICAqICAgfCAgICAgICAgLiAgICAgIHwKICAgKiAgIHwgICAgICAuICAgICAgICB8CiAgICogICB8ICAgIC4gICAgICAgICAgfAogICAqICAgKz09PSs9PT09PT09PT09PSstLS0tLS0tLS0rLS0tLS0tLS0tLT4gdGltZQogICAqICAgICAgU3RhcnQgICAgICAgQ2xpZmYgICAgVmVzdGluZwogICAqLwogIGZ1bmN0aW9uIGNhbGN1bGF0ZVZlc3RlZFRva2VucygKICAgIHVpbnQyNTYgdG9rZW5zLAogICAgdWludDI1NiB0aW1lLAogICAgdWludDI1NiBzdGFydCwKICAgIHVpbnQyNTYgY2xpZmYsCiAgICB1aW50MjU2IHZlc3RpbmcpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAvLyBTaG9ydGN1dHMgZm9yIGJlZm9yZSBjbGlmZiBhbmQgYWZ0ZXIgdmVzdGluZyBjYXNlcy4KICAgICAgaWYgKHRpbWUgPCBjbGlmZikgcmV0dXJuIDA7CiAgICAgIGlmICh0aW1lID49IHZlc3RpbmcpIHJldHVybiB0b2tlbnM7CgogICAgICAvLyBJbnRlcnBvbGF0ZSBhbGwgdmVzdGVkIHRva2Vucy4KICAgICAgLy8gQXMgYmVmb3JlIGNsaWZmIHRoZSBzaG9ydGN1dCByZXR1cm5zIDAsIHdlIGNhbiB1c2UganVzdCBjYWxjdWxhdGUgYSB2YWx1ZQogICAgICAvLyBpbiB0aGUgdmVzdGluZyByZWN0IChhcyBzaG93biBpbiBhYm92ZSdzIGZpZ3VyZSkKCiAgICAgIC8vIHZlc3RlZFRva2VucyA9ICh0b2tlbnMgKiAodGltZSAtIHN0YXJ0KSkgLyAodmVzdGluZyAtIHN0YXJ0KQogICAgICB1aW50MjU2IHZlc3RlZFRva2VucyA9IFNhZmVNYXRoLmRpdigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2FmZU1hdGgubXVsKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTYWZlTWF0aC5zdWIodGltZSwgc3RhcnQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2FmZU1hdGguc3ViKHZlc3RpbmcsIHN0YXJ0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwoKICAgICAgcmV0dXJuIHZlc3RlZFRva2VuczsKICB9CgogIC8qKgogICAqIEBkZXYgR2V0IGFsbCBpbmZvcm1hdGlvbiBhYm91dCBhIHNwZWNpZmljIGdyYW50LgogICAqIEBwYXJhbSBfaG9sZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgaGF2ZSBpdHMgdG9rZW5zIHJldm9rZWQuCiAgICogQHBhcmFtIF9ncmFudElkIFRoZSBpZCBvZiB0aGUgdG9rZW4gZ3JhbnQuCiAgICogQHJldHVybiBSZXR1cm5zIGFsbCB0aGUgdmFsdWVzIHRoYXQgcmVwcmVzZW50IGEgVG9rZW5HcmFudChhZGRyZXNzLCB2YWx1ZSwgc3RhcnQsIGNsaWZmLAogICAqIHJldm9rYWJpbGl0eSwgYnVybnNPblJldm9rZSwgYW5kIHZlc3RpbmcpIHBsdXMgdGhlIHZlc3RlZCB2YWx1ZSBhdCB0aGUgY3VycmVudCB0aW1lLgogICAqLwogIGZ1bmN0aW9uIHRva2VuR3JhbnQoYWRkcmVzcyBfaG9sZGVyLCB1aW50MjU2IF9ncmFudElkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcyBncmFudGVyLCB1aW50MjU2IHZhbHVlLCB1aW50MjU2IHZlc3RlZCwgdWludDY0IHN0YXJ0LCB1aW50NjQgY2xpZmYsIHVpbnQ2NCB2ZXN0aW5nLCBib29sIHJldm9rYWJsZSwgYm9vbCBidXJuc09uUmV2b2tlKSB7CiAgICBUb2tlbkdyYW50IHN0b3JhZ2UgZ3JhbnQgPSBncmFudHNbX2hvbGRlcl1bX2dyYW50SWRdOwoKICAgIGdyYW50ZXIgPSBncmFudC5ncmFudGVyOwogICAgdmFsdWUgPSBncmFudC52YWx1ZTsKICAgIHN0YXJ0ID0gZ3JhbnQuc3RhcnQ7CiAgICBjbGlmZiA9IGdyYW50LmNsaWZmOwogICAgdmVzdGluZyA9IGdyYW50LnZlc3Rpbmc7CiAgICByZXZva2FibGUgPSBncmFudC5yZXZva2FibGU7CiAgICBidXJuc09uUmV2b2tlID0gZ3JhbnQuYnVybnNPblJldm9rZTsKCiAgICB2ZXN0ZWQgPSB2ZXN0ZWRUb2tlbnMoZ3JhbnQsIHVpbnQ2NChub3cpKTsKICB9CgogIC8qKgogICAqIEBkZXYgR2V0IHRoZSBhbW91bnQgb2YgdmVzdGVkIHRva2VucyBhdCBhIHNwZWNpZmljIHRpbWUuCiAgICogQHBhcmFtIGdyYW50IFRva2VuR3JhbnQgVGhlIGdyYW50IHRvIGJlIGNoZWNrZWQuCiAgICogQHBhcmFtIHRpbWUgVGhlIHRpbWUgdG8gYmUgY2hlY2tlZAogICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIG9mIGEgc3BlY2lmaWMgZ3JhbnQgYXQgYSBzcGVjaWZpYyB0aW1lLgogICAqLwogIGZ1bmN0aW9uIHZlc3RlZFRva2VucyhUb2tlbkdyYW50IGdyYW50LCB1aW50NjQgdGltZSkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gY2FsY3VsYXRlVmVzdGVkVG9rZW5zKAogICAgICBncmFudC52YWx1ZSwKICAgICAgdWludDI1Nih0aW1lKSwKICAgICAgdWludDI1NihncmFudC5zdGFydCksCiAgICAgIHVpbnQyNTYoZ3JhbnQuY2xpZmYpLAogICAgICB1aW50MjU2KGdyYW50LnZlc3RpbmcpCiAgICApOwogIH0KCiAgLyoqCiAgICogQGRldiBDYWxjdWxhdGUgdGhlIGFtb3VudCBvZiBub24gdmVzdGVkIHRva2VucyBhdCBhIHNwZWNpZmljIHRpbWUuCiAgICogQHBhcmFtIGdyYW50IFRva2VuR3JhbnQgVGhlIGdyYW50IHRvIGJlIGNoZWNrZWQuCiAgICogQHBhcmFtIHRpbWUgdWludDY0IFRoZSB0aW1lIHRvIGJlIGNoZWNrZWQKICAgKiBAcmV0dXJuIEFuIHVpbnQyNTYgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb2Ygbm9uIHZlc3RlZCB0b2tlbnMgb2YgYSBzcGVjaWZpYyBncmFudCBvbiB0aGUKICAgKiBwYXNzZWQgdGltZSBmcmFtZS4KICAgKi8KICBmdW5jdGlvbiBub25WZXN0ZWRUb2tlbnMoVG9rZW5HcmFudCBncmFudCwgdWludDY0IHRpbWUpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGdyYW50LnZhbHVlLnN1Yih2ZXN0ZWRUb2tlbnMoZ3JhbnQsIHRpbWUpKTsKICB9CgogIC8qKgogICAqIEBkZXYgQ2FsY3VsYXRlIHRoZSBkYXRlIHdoZW4gdGhlIGhvbGRlciBjYW4gdHJhbnNmZXIgYWxsIGl0cyB0b2tlbnMKICAgKiBAcGFyYW0gaG9sZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgb2YgdGhlIGhvbGRlcgogICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGRhdGUgb2YgdGhlIGxhc3QgdHJhbnNmZXJhYmxlIHRva2Vucy4KICAgKi8KICBmdW5jdGlvbiBsYXN0VG9rZW5Jc1RyYW5zZmVyYWJsZURhdGUoYWRkcmVzcyBob2xkZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50NjQgZGF0ZSkgewogICAgZGF0ZSA9IHVpbnQ2NChub3cpOwogICAgdWludDI1NiBncmFudEluZGV4ID0gZ3JhbnRzW2hvbGRlcl0ubGVuZ3RoOwogICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgZ3JhbnRJbmRleDsgaSsrKSB7CiAgICAgIGRhdGUgPSBNYXRoLm1heDY0KGdyYW50c1tob2xkZXJdW2ldLnZlc3RpbmcsIGRhdGUpOwogICAgfQogIH0KfQoKY29udHJhY3QgQ2VydGlmaWVyIHsKCWV2ZW50IENvbmZpcm1lZChhZGRyZXNzIGluZGV4ZWQgd2hvKTsKCWV2ZW50IFJldm9rZWQoYWRkcmVzcyBpbmRleGVkIHdobyk7CglmdW5jdGlvbiBjZXJ0aWZpZWQoYWRkcmVzcyBfd2hvKSBjb25zdGFudCByZXR1cm5zIChib29sKTsKCS8vIGZ1bmN0aW9uIGdldChhZGRyZXNzIF93aG8sIHN0cmluZyBfZmllbGQpIGNvbnN0YW50IHJldHVybnMgKGJ5dGVzMzIpIHt9CgkvLyBmdW5jdGlvbiBnZXRBZGRyZXNzKGFkZHJlc3MgX3dobywgc3RyaW5nIF9maWVsZCkgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcykge30KCS8vIGZ1bmN0aW9uIGdldFVpbnQoYWRkcmVzcyBfd2hvLCBzdHJpbmcgX2ZpZWxkKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7fQp9Cgpjb250cmFjdCBTaW1wbGVDZXJ0aWZpZXIgaXMgT3duZWQsIENlcnRpZmllciB7CgoJbW9kaWZpZXIgb25seV9kZWxlZ2F0ZSB7CgkJYXNzZXJ0KG1zZy5zZW5kZXIgPT0gZGVsZWdhdGUpOwoJCV87IAoJfQoJbW9kaWZpZXIgb25seV9jZXJ0aWZpZWQoYWRkcmVzcyBfd2hvKSB7CgkJaWYgKCFjZXJ0c1tfd2hvXS5hY3RpdmUpCgkJCXJldHVybjsKCQlfOyAKCX0KCglzdHJ1Y3QgQ2VydGlmaWNhdGlvbiB7CgkJYm9vbCBhY3RpdmU7CgkJbWFwcGluZyAoc3RyaW5nID0+IGJ5dGVzMzIpIG1ldGE7Cgl9CgoJZnVuY3Rpb24gY2VydGlmeShhZGRyZXNzIF93aG8pIG9ubHlfZGVsZWdhdGUgewoJCWNlcnRzW193aG9dLmFjdGl2ZSA9IHRydWU7CgkJQ29uZmlybWVkKF93aG8pOwoJfQoJZnVuY3Rpb24gcmV2b2tlKGFkZHJlc3MgX3dobykgb25seV9kZWxlZ2F0ZSBvbmx5X2NlcnRpZmllZChfd2hvKSB7CgkJY2VydHNbX3dob10uYWN0aXZlID0gZmFsc2U7CgkJUmV2b2tlZChfd2hvKTsKCX0KCWZ1bmN0aW9uIGNlcnRpZmllZChhZGRyZXNzIF93aG8pIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsgcmV0dXJuIGNlcnRzW193aG9dLmFjdGl2ZTsgfQoJLy8gZnVuY3Rpb24gZ2V0KGFkZHJlc3MgX3dobywgc3RyaW5nIF9maWVsZCkgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMzMikgeyByZXR1cm4gY2VydHNbX3dob10ubWV0YVtfZmllbGRdOyB9CgkvLyBmdW5jdGlvbiBnZXRBZGRyZXNzKGFkZHJlc3MgX3dobywgc3RyaW5nIF9maWVsZCkgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcykgeyByZXR1cm4gYWRkcmVzcyhjZXJ0c1tfd2hvXS5tZXRhW19maWVsZF0pOyB9CgkvLyBmdW5jdGlvbiBnZXRVaW50KGFkZHJlc3MgX3dobywgc3RyaW5nIF9maWVsZCkgY29uc3RhbnQgcmV0dXJucyAodWludCkgeyByZXR1cm4gdWludChjZXJ0c1tfd2hvXS5tZXRhW19maWVsZF0pOyB9CglmdW5jdGlvbiBzZXREZWxlZ2F0ZShhZGRyZXNzIF9uZXcpIG9ubHlfb3duZXIgeyBkZWxlZ2F0ZSA9IF9uZXc7IH0KCgltYXBwaW5nIChhZGRyZXNzID0+IENlcnRpZmljYXRpb24pIGNlcnRzOwoJLy8gU28gdGhhdCB0aGUgc2VydmVyIHBvc3RpbmcgcHV6emxlcyBkb2Vzbid0IGhhdmUgYWNjZXNzIHRvIHRoZSBFVEguCglhZGRyZXNzIHB1YmxpYyBkZWxlZ2F0ZSA9IG1zZy5zZW5kZXI7Cn0KCmNvbnRyYWN0IFByb29mT2ZTTVMgaXMgU2ltcGxlQ2VydGlmaWVyIHsKCgltb2RpZmllciB3aGVuX2ZlZV9wYWlkIHsKCQlpZiAobXNnLnZhbHVlIDwgZmVlKSAgewoJCVJlcXVpcmVkRmVlTm90TWV0KGZlZSwgbXNnLnZhbHVlKTsKCQkJcmV0dXJuOwoJCX0KCQlfOyAKCX0KCWV2ZW50IFJlcXVpcmVkRmVlTm90TWV0KHVpbnQgcmVxdWlyZWQsIHVpbnQgcHJvdmlkZWQpOwoJZXZlbnQgUmVxdWVzdGVkKGFkZHJlc3MgaW5kZXhlZCB3aG8pOwoJZXZlbnQgUHV6emxlZChhZGRyZXNzIHdobywgYnl0ZXMzMiBwdXp6bGUpOwoKCWV2ZW50IExvZ0FkZHJlc3MoYWRkcmVzcyB0ZXN0KTsKCglmdW5jdGlvbiByZXF1ZXN0KCkgcGF5YWJsZSB3aGVuX2ZlZV9wYWlkIHsKCQlpZiAoY2VydHNbbXNnLnNlbmRlcl0uYWN0aXZlKSB7CgkJCXJldHVybjsKCQl9CgkJUmVxdWVzdGVkKG1zZy5zZW5kZXIpOwoJfQoKCWZ1bmN0aW9uIHB1enpsZSAoYWRkcmVzcyBfd2hvLCBieXRlczMyIF9wdXp6bGUpIG9ubHlfZGVsZWdhdGUgewoJCXB1enpsZXNbX3dob10gPSBfcHV6emxlOwoJCVB1enpsZWQoX3dobywgX3B1enpsZSk7Cgl9CgoJZnVuY3Rpb24gY29uZmlybShieXRlczMyIF9jb2RlKSByZXR1cm5zIChib29sKSB7CgkJTG9nQWRkcmVzcyhtc2cuc2VuZGVyKTsKCQlpZiAocHV6emxlc1ttc2cuc2VuZGVyXSAhPSBzaGEzKF9jb2RlKSkKCQkJcmV0dXJuOwoKCQlkZWxldGUgcHV6emxlc1ttc2cuc2VuZGVyXTsKCQljZXJ0c1ttc2cuc2VuZGVyXS5hY3RpdmUgPSB0cnVlOwoJCUNvbmZpcm1lZChtc2cuc2VuZGVyKTsKCQlyZXR1cm4gdHJ1ZTsKCX0KCglmdW5jdGlvbiBzZXRGZWUodWludCBfbmV3KSBvbmx5X293bmVyIHsKCQlmZWUgPSBfbmV3OwoJfQoKCWZ1bmN0aW9uIGRyYWluKCkgb25seV9vd25lciB7CgkJcmVxdWlyZShtc2cuc2VuZGVyLnNlbmQodGhpcy5iYWxhbmNlKSk7Cgl9CgoJZnVuY3Rpb24gY2VydGlmaWVkKGFkZHJlc3MgX3dobykgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewoJCXJldHVybiBjZXJ0c1tfd2hvXS5hY3RpdmU7Cgl9CgoJbWFwcGluZyAoYWRkcmVzcyA9PiBieXRlczMyKSBwdXp6bGVzOwoKCXVpbnQgcHVibGljIGZlZSA9IDMwIGZpbm5leTsKfQoKY29udHJhY3QgTGVnYWxUb2tlbiBpcyBMZWdhbExhenlTY2hlZHVsZXIsIE1pbnRhYmxlVG9rZW4sIFZlc3RlZFRva2VuIHsKICAgIC8qKgogICAgKiBUaGUgbmFtZSBvZiB0aGUgdG9rZW4KICAgICovCiAgICBieXRlczMyIHB1YmxpYyBuYW1lOwoKICAgIC8qKgogICAgKiBUaGUgc3ltYm9sIHVzZWQgZm9yIGV4Y2hhbmdlCiAgICAqLwogICAgYnl0ZXMzMiBwdWJsaWMgc3ltYm9sOwoKICAgIC8qKgogICAgKiBVc2UgdG8gY29udmVydCB0byBudW1iZXIgb2YgdG9rZW5zLgogICAgKi8KICAgIHVpbnQgcHVibGljIGRlY2ltYWxzID0gMTg7CgogICAgLyoqCiAgICAqIFRoZSB5ZWFybHkgZXhwZWN0ZWQgaW5mbGF0aW9uIHJhdGUgaW4gYmFzZSBwb2ludHMuCiAgICAqLwogICAgdWludDMyIHB1YmxpYyBpbmZsYXRpb25Db21wQlBTOwoKICAgIC8qKgogICAgKiBUaGUgdG9rZW5zIGFyZSBsb2NrZWQgdW50aWwgdGhlIGVuZCBvZiB0aGUgVEdFLgogICAgKiBUaGUgY29udHJhY3QgY2FuIHJlbGVhc2UgdGhlIHRva2VucyBpZiBUR0Ugc3VjY2Vzc2Z1bC4gSWYgZmFsc2Ugd2UgYXJlIGluIHRyYW5zZmVyIGxvY2sgdXAgcGVyaW9kLgogICAgKi8KICAgIGJvb2wgcHVibGljIHJlbGVhc2VkID0gZmFsc2U7CgogICAgLyoqCiAgICAqIEFubnVhbGx5IG5ldyBtaW50ZWQgdG9rZW5zIHdpbGwgYmUgdHJhbnNmZXJyZWQgdG8gdGhpcyB3YWxsZXQuCiAgICAqIFB1YmxpY2F0aW9ucyB3aWxsIGJlIHJld2FyZGVkIHdpdGggZnVuZHMgKGluY2VudGl2ZXMpLiAgCiAgICAqLwogICAgYWRkcmVzcyBwdWJsaWMgcmV3YXJkV2FsbGV0OwoKICAgIC8qKgogICAgKiBOYW1lIGFuZCBzeW1ib2wgd2VyZSB1cGRhdGVkLiAKICAgICovCiAgICBldmVudCBVcGRhdGVkVG9rZW5JbmZvcm1hdGlvbihieXRlczMyIG5ld05hbWUsIGJ5dGVzMzIgbmV3U3ltYm9sKTsKCiAgICAvKioKICAgICogQGRldiBDb25zdHJ1Y3RvciB0aGF0IGdpdmVzIG1zZy5zZW5kZXIgYWxsIG9mIGV4aXN0aW5nIHRva2Vucy4gCiAgICAqLwogICAgZnVuY3Rpb24gTGVnYWxUb2tlbihhZGRyZXNzIF9yZXdhcmRXYWxsZXQsIHVpbnQzMiBfaW5mbGF0aW9uQ29tcEJQUywgdWludDMyIF9pbmZsYXRpb25Db21wSW50ZXJ2YWwpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIHNldFRva2VuSW5mb3JtYXRpb24oIkxlZ2FsIFRva2VuIiwgIkxHTCIpOwogICAgICAgIHRvdGFsU3VwcGx5ID0gMDsgICAgICAgIAogICAgICAgIHJld2FyZFdhbGxldCA9IF9yZXdhcmRXYWxsZXQ7CiAgICAgICAgaW5mbGF0aW9uQ29tcEJQUyA9IF9pbmZsYXRpb25Db21wQlBTOwogICAgICAgIHJlZ2lzdGVySW50ZXJ2YWxDYWxsKF9pbmZsYXRpb25Db21wSW50ZXJ2YWwsIG1pbnRJbmZsYXRpb25QZXJpb2QpOwogICAgfSAgICAKCiAgICAvKioKICAgICogVGhpcyBmdW5jdGlvbiBhbGxvd3MgdGhlIHRva2VuIG93bmVyIHRvIHJlbmFtZSB0aGUgdG9rZW4gYWZ0ZXIgdGhlIG9wZXJhdGlvbnMKICAgICogaGF2ZSBiZWVuIGNvbXBsZXRlZCBhbmQgdGhlbiBwb2ludCB0aGUgYXVkaWVuY2UgdG8gdXNlIHRoZSB0b2tlbiBjb250cmFjdC4KICAgICovCiAgICBmdW5jdGlvbiBzZXRUb2tlbkluZm9ybWF0aW9uKGJ5dGVzMzIgX25hbWUsIGJ5dGVzMzIgX3N5bWJvbCkgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgbmFtZSA9IF9uYW1lOwogICAgICAgIHN5bWJvbCA9IF9zeW1ib2w7CiAgICAgICAgVXBkYXRlZFRva2VuSW5mb3JtYXRpb24obmFtZSwgc3ltYm9sKTsKICAgIH0KCiAgICAvKioKICAgICogTWludCBuZXcgdG9rZW5zIGZvciB0aGUgcHJlZGVmaW5lZCBpbmZsYXRpb24gcGVyaW9kIGFuZCBhc3NpZ24gdGhlbSB0byB0aGUgcmV3YXJkIHdhbGxldC4gCiAgICAqLwogICAgZnVuY3Rpb24gbWludEluZmxhdGlvblBlcmlvZCgpIHByaXZhdGUgewogICAgICAgIHVpbnQyNTYgdG9rZW5zVG9NaW50ID0gdG90YWxTdXBwbHkubXVsKGluZmxhdGlvbkNvbXBCUFMpLmRpdigxMDAwMCk7CiAgICAgICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5hZGQodG9rZW5zVG9NaW50KTsKICAgICAgICBiYWxhbmNlc1tyZXdhcmRXYWxsZXRdID0gYmFsYW5jZXNbcmV3YXJkV2FsbGV0XS5hZGQodG9rZW5zVG9NaW50KTsKICAgICAgICBNaW50KHJld2FyZFdhbGxldCwgdG9rZW5zVG9NaW50KTsKICAgICAgICBUcmFuc2ZlcigweDAsIHJld2FyZFdhbGxldCwgdG9rZW5zVG9NaW50KTsKICAgIH0gICAgIAogICAgCiAgICBmdW5jdGlvbiBzZXRSZXdhcmRXYWxsZXQoYWRkcmVzcyBfcmV3YXJkV2FsbGV0KSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICByZXdhcmRXYWxsZXQgPSBfcmV3YXJkV2FsbGV0OwogICAgfQoKICAgIC8qKgogICAgKiBMaW1pdCB0b2tlbiB0cmFuc2ZlciB1bnRpbCB0aGUgVEdFIGlzIG92ZXIuCiAgICAqLwogICAgbW9kaWZpZXIgdG9rZW5SZWxlYXNlZChhZGRyZXNzIF9zZW5kZXIpIHsKICAgICAgICByZXF1aXJlKHJlbGVhc2VkKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qKgogICAgKiBUaGlzIHdpbGwgbWFrZSB0aGUgdG9rZW5zIHRyYW5zZmVyYWJsZQogICAgKi8KICAgIGZ1bmN0aW9uIHJlbGVhc2VUb2tlblRyYW5zZmVyKCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcmVsZWFzZWQgPSB0cnVlOwogICAgfQoKICAgIC8vIGVycm9yOiBjYW5UcmFuc2Zlcihtc2cuc2VuZGVyLCBfdmFsdWUpCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHB1YmxpYyB0b2tlblJlbGVhc2VkKG1zZy5zZW5kZXIpIGludGVydmFsVHJpZ2dlciByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICAvLyBDYWxscyBTdGFuZGFyZFRva2VuLnRyYW5zZmVyKCkKICAgICAgICAvLyBlcnJvcjogc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcHVibGljIHRva2VuUmVsZWFzZWQoX2Zyb20pIGludGVydmFsVHJpZ2dlciByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICAvLyBDYWxscyBTdGFuZGFyZFRva2VuLnRyYW5zZmVyRm9ybSgpCiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyB0b2tlblJlbGVhc2VkKG1zZy5zZW5kZXIpIGludGVydmFsVHJpZ2dlciByZXR1cm5zIChib29sKSB7CiAgICAgICAgLy8gY2FsbHMgU3RhbmRhcmRUb2tlbi5hcHByb3ZlKC4uKQogICAgICAgIHJldHVybiBzdXBlci5hcHByb3ZlKF9zcGVuZGVyLCBfdmFsdWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICAgICAgLy8gY2FsbHMgU3RhbmRhcmRUb2tlbi5hbGxvd2FuY2UoLi4pCiAgICAgICAgcmV0dXJuIHN1cGVyLmFsbG93YW5jZShfb3duZXIsIF9zcGVuZGVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBpbmNyZWFzZUFwcHJvdmFsIChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hZGRlZFZhbHVlKSBwdWJsaWMgdG9rZW5SZWxlYXNlZChtc2cuc2VuZGVyKSBpbnRlcnZhbFRyaWdnZXIgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgLy8gY2FsbHMgU3RhbmRhcmRUb2tlbi5pbmNyZWFzZUFwcHJvdmFsKC4uKQogICAgICAgIHJldHVybiBzdXBlci5pbmNyZWFzZUFwcHJvdmFsKF9zcGVuZGVyLCBfYWRkZWRWYWx1ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gZGVjcmVhc2VBcHByb3ZhbCAoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfc3VidHJhY3RlZFZhbHVlKSBwdWJsaWMgdG9rZW5SZWxlYXNlZChtc2cuc2VuZGVyKSBpbnRlcnZhbFRyaWdnZXIgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgLy8gY2FsbHMgU3RhbmRhcmRUb2tlbi5kZWNyZWFzZUFwcHJvdmFsKC4uKQogICAgICAgIHJldHVybiBzdXBlci5kZWNyZWFzZUFwcHJvdmFsKF9zcGVuZGVyLCBfc3VidHJhY3RlZFZhbHVlKTsKICAgIH0KfQ=='.
	

]
